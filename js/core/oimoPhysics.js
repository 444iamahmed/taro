function $extend(_,t){function i(){}i.prototype=_;var o=new i;for(var a in t)o[a]=t[a];return t.toString!==Object.prototype.toString&&(o.toString=t.toString),o}var oimo_collision_broadphase_BroadPhase=function(o){this._type=o,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new oimo_collision_broadphase__$BroadPhase_ConvexSweepGeometry,this._aabb=new oimo_collision_broadphase__$BroadPhase_AabbGeometry,this.identity=new oimo_common_Transform,this.zero=new oimo_common_Vec3,this.rayCastHit=new oimo_collision_geometry_RayCastHit};oimo_collision_broadphase_BroadPhase.prototype={createProxy:function(){return null},destroyProxy:function(){},moveProxy:function(){},isOverlapping:function(o,t){return o._aabbMinX<t._aabbMaxX&&o._aabbMaxX>t._aabbMinX&&o._aabbMinY<t._aabbMaxY&&o._aabbMaxY>t._aabbMinY&&o._aabbMinZ<t._aabbMaxZ&&o._aabbMaxZ>t._aabbMinZ},collectPairs:function(){},getProxyPairList:function(){return this._proxyPairList},isIncremental:function(){return this._incremental},getTestCount:function(){return this._testCount},rayCast:function(){},convexCast:function(){},aabbTest:function(){}};var oimo_collision_geometry_Geometry=function(o){this._type=o,this._volume=0};oimo_collision_geometry_Geometry.prototype={_updateMass:function(){},_computeAabb:function(){},_rayCastLocal:function(){return!1},getType:function(){return this._type},getVolume:function(){return this._volume},rayCast:function(P,t,i,o){var a=P,l,T,S,C,q,R;l=a.x,T=a.y,S=a.z;var E=t,f,j,N,F,D,W;if(C=E.x,q=E.y,R=E.z,l-=i._positionX,T-=i._positionY,S-=i._positionZ,C-=i._positionX,q-=i._positionY,R-=i._positionZ,f=i._rotation00*l+i._rotation10*T+i._rotation20*S,j=i._rotation01*l+i._rotation11*T+i._rotation21*S,N=i._rotation02*l+i._rotation12*T+i._rotation22*S,l=f,T=j,S=N,F=i._rotation00*C+i._rotation10*q+i._rotation20*R,D=i._rotation01*C+i._rotation11*q+i._rotation21*R,W=i._rotation02*C+i._rotation12*q+i._rotation22*R,C=F,q=D,R=W,this._rayCastLocal(l,T,S,C,q,R,o)){var G=o.position,z,O,H,J,U,Q;z=G.x,O=G.y,H=G.z;var K=o.normal,B,$,tt,ot,at,it;J=K.x,U=K.y,Q=K.z,B=i._rotation00*z+i._rotation01*O+i._rotation02*H,$=i._rotation10*z+i._rotation11*O+i._rotation12*H,tt=i._rotation20*z+i._rotation21*O+i._rotation22*H,z=B,O=$,H=tt,ot=i._rotation00*J+i._rotation01*U+i._rotation02*Q,at=i._rotation10*J+i._rotation11*U+i._rotation12*Q,it=i._rotation20*J+i._rotation21*U+i._rotation22*Q,J=ot,U=at,Q=it,z+=i._positionX,O+=i._positionY,H+=i._positionZ;var nt=o.position;nt.x=z,nt.y=O,nt.z=H;var k=o.normal;return k.x=J,k.y=U,k.z=Q,!0}return!1}};var oimo_collision_geometry_ConvexGeometry=function(o){oimo_collision_geometry_Geometry.call(this,o),this._gjkMargin=oimo_common_Setting.defaultGJKMargin,this._useGjkRayCast=!1};oimo_collision_geometry_ConvexGeometry.__super__=oimo_collision_geometry_Geometry,oimo_collision_geometry_ConvexGeometry.prototype=$extend(oimo_collision_geometry_Geometry.prototype,{getGjkMergin:function(){return this._gjkMargin},setGjkMergin:function(o){0>o&&(o=0),this._gjkMargin=o},computeLocalSupportingVertex:function(){},rayCast:function(n,t,i,o){return this._useGjkRayCast?oimo_collision_narrowphase_detector_gjkepa_GjkEpa.instance.rayCast(this,i,n,t,o):oimo_collision_geometry_Geometry.prototype.rayCast.call(this,n,t,i,o)}});var oimo_collision_broadphase__$BroadPhase_ConvexSweepGeometry=function(){oimo_collision_geometry_ConvexGeometry.call(this,-1)};oimo_collision_broadphase__$BroadPhase_ConvexSweepGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_broadphase__$BroadPhase_ConvexSweepGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{init:function(c,t,i){var o,p,m;this.c=c;var b=i,x,d,y;o=b.x,p=b.y,m=b.z,x=t._rotation00*o+t._rotation10*p+t._rotation20*m,d=t._rotation01*o+t._rotation11*p+t._rotation21*m,y=t._rotation02*o+t._rotation12*p+t._rotation22*m,this.localTranslation=new oimo_common_Vec3;var f=this.localTranslation;f.x=x,f.y=d,f.z=y,this._gjkMargin=c._gjkMargin},computeLocalSupportingVertex:function(e,t){this.c.computeLocalSupportingVertex(e,t);var i=this.localTranslation;if(0<e.x*i.x+e.y*i.y+e.z*i.z){var o=this.localTranslation,a=t.x+o.x,n=t.y+o.y,r=t.z+o.z;t.x=a,t.y=n,t.z=r}}});var oimo_collision_broadphase__$BroadPhase_AabbGeometry=function(){oimo_collision_geometry_ConvexGeometry.call(this,-1),this.min=new oimo_common_Vec3,this.max=new oimo_common_Vec3};oimo_collision_broadphase__$BroadPhase_AabbGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_broadphase__$BroadPhase_AabbGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{computeLocalSupportingVertex:function(o,t){t.x=0<o.x?this.max.x:this.min.x,t.y=0<o.y?this.max.y:this.min.y,t.z=0<o.z?this.max.z:this.min.z}});var oimo_collision_broadphase_BroadPhaseProxyCallback=function(){};oimo_collision_broadphase_BroadPhaseProxyCallback.prototype={process:function(){}};var oimo_collision_broadphase_BroadPhaseType=function(){},oimo_collision_broadphase_Proxy=function(o,t){this.userData=o,this._id=t,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0};oimo_collision_broadphase_Proxy.prototype={getId:function(){return this._id},getFatAabb:function(){var o=new oimo_collision_geometry_Aabb;return o._minX=this._aabbMinX,o._minY=this._aabbMinY,o._minZ=this._aabbMinZ,o._maxX=this._aabbMaxX,o._maxY=this._aabbMaxY,o._maxZ=this._aabbMaxZ,o},getFatAabbTo:function(o){o._minX=this._aabbMinX,o._minY=this._aabbMinY,o._minZ=this._aabbMinZ,o._maxX=this._aabbMaxX,o._maxY=this._aabbMaxY,o._maxZ=this._aabbMaxZ}};var oimo_collision_broadphase_ProxyPair=function(){this._p1=null,this._p2=null};oimo_collision_broadphase_ProxyPair.prototype={getProxy1:function(){return this._p1},getProxy2:function(){return this._p2},getNext:function(){return this._next}};var oimo_collision_broadphase_bruteforce_BruteForceBroadPhase=function(){oimo_collision_broadphase_BroadPhase.call(this,1),this._incremental=!1};oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.__super__=oimo_collision_broadphase_BroadPhase,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype=$extend(oimo_collision_broadphase_BroadPhase.prototype,{createProxy:function(a,t){var i=new oimo_collision_broadphase_Proxy(a,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ,i},destroyProxy:function(a){this._numProxies--;var t=a._prev,i=a._next;null!=t&&(t._next=i),null!=i&&(i._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null,a.userData=null},moveProxy:function(o,t){o._aabbMinX=t._minX,o._aabbMinY=t._minY,o._aabbMinZ=t._minZ,o._aabbMaxX=t._maxX,o._aabbMaxY=t._maxY,o._aabbMaxZ=t._maxZ},collectPairs:function(){var e=this._proxyPairList;if(null!=e){for(;e._p1=null,e._p2=null,null!=(e=e._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var r=this._proxyList;null!=r;){for(var l=r._next,o=r._next,c;null!=o;){if(c=o._next,this._testCount++,r._aabbMinX<o._aabbMaxX&&r._aabbMaxX>o._aabbMinX&&r._aabbMinY<o._aabbMaxY&&r._aabbMaxY>o._aabbMinY&&r._aabbMinZ<o._aabbMaxZ&&r._aabbMaxZ>o._aabbMinZ){var p=this._proxyPairPool;null==p?p=new oimo_collision_broadphase_ProxyPair:(this._proxyPairPool=p._next,p._next=null);var m=p;null==this._proxyPairList?this._proxyPairList=m:(m._next=this._proxyPairList,this._proxyPairList=m),m._p1=r,m._p2=o}o=c}r=l}},rayCast:function(H,t,i){var o=H,h,U,Q,K,$,tt;h=o.x,U=o.y,Q=o.z;var ot=t;K=ot.x,$=ot.y,tt=ot.z;for(var l=this._proxyList;null!=l;){var at=l._next,p=h,v=U,y=Q,b=K,f=$,d=tt,x=p<b?p:b,u=v<f?v:f,g=y<d?y:d,M=p>b?p:b,X=v>f?v:f,z=y>d?y:d,Y=l._aabbMinX,Z=l._aabbMinY,I=l._aabbMinZ,V=l._aabbMaxX,L=l._aabbMaxY,w=l._aabbMaxZ,B;if(Y>M||V<x||Z>X||L<u||I>z||w<g)B=!1;else{var it=b-p,P=f-v,S=d-y,C=0>it?-it:it,T=0>P?-P:P,j=0>S?-S:S,R=.5*(V-Y),q=.5*(L-Z),E=.5*(w-I),D=p-.5*(V+Y),J=v-.5*(L+Z),F=y-.5*(w+I),N=J*S-F*P,G,nt;if(0<(0>N?-N:N)-(q*j+E*T))nt=!0;else{var _t=F*it-D*S;nt=0<(0>_t?-_t:_t)-(E*C+R*j)}if(nt)G=!0;else{var O=D*P-J*it;G=0<(0>O?-O:O)-(R*T+q*C)}B=!G}B&&i.process(l),l=at}},convexCast:function(l,t,i,o){for(var a=this._proxyList;null!=a;){var c=a._next,s=this._aabb.min;s.x=a._aabbMinX,s.y=a._aabbMinY,s.z=a._aabbMinZ;var _=this._aabb.max;_.x=a._aabbMaxX,_.y=a._aabbMaxY,_.z=a._aabbMaxZ,this._convexSweep.init(l,t,i);var r=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.instance;0==r.computeClosestPointsImpl(this._convexSweep,this._aabb,t,this.identity,null,!1)&&0>=r.distance&&o.process(a),a=c}},aabbTest:function(n,t){for(var i=this._proxyList,_;null!=i;)_=i._next,n._minX<i._aabbMaxX&&n._maxX>i._aabbMinX&&n._minY<i._aabbMaxY&&n._maxY>i._aabbMinY&&n._minZ<i._aabbMaxZ&&n._maxZ>i._aabbMinZ&&t.process(i),i=_}});var oimo_collision_broadphase_bvh_BvhBroadPhase=function(){oimo_collision_broadphase_BroadPhase.call(this,2),this._incremental=!0,this._tree=new oimo_collision_broadphase_bvh_BvhTree;var o=Array(1024);this.movedProxies=o,this.numMovedProxies=0};oimo_collision_broadphase_bvh_BvhBroadPhase.__super__=oimo_collision_broadphase_BroadPhase,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype=$extend(oimo_collision_broadphase_BroadPhase.prototype,{collide:function(e,t){this._testCount++;var i=0==e._height,o=0==t._height;if(e==t)return i?void 0:(this.collide(e._children[0],t),void this.collide(e._children[1],t));if(e._aabbMinX<t._aabbMaxX&&e._aabbMaxX>t._aabbMinX&&e._aabbMinY<t._aabbMaxY&&e._aabbMaxY>t._aabbMinY&&e._aabbMinZ<t._aabbMaxZ&&e._aabbMaxZ>t._aabbMinZ){if(i&&o){var a=e._proxy,n=t._proxy,s=this._proxyPairPool;null==s?s=new oimo_collision_broadphase_ProxyPair:(this._proxyPairPool=s._next,s._next=null);var l=s;return null==this._proxyPairList?this._proxyPairList=l:(l._next=this._proxyPairList,this._proxyPairList=l),l._p1=a,void(l._p2=n)}o||e._height>t._height?(this.collide(e._children[0],t),this.collide(e._children[1],t)):(this.collide(t._children[0],e),this.collide(t._children[1],e))}},rayCastRecursive:function(H,t,i,o,a,n,s,_){var r=k=t,y=Q=i,b=K=o,f=$=a,d=tt=n,x=ot=s,u=r<f?r:f,g=y<d?y:d,M=b<x?b:x,X=r>f?r:f,z=y>d?y:d,Y=b>x?b:x,Z=H._aabbMinX,I=H._aabbMinY,V=H._aabbMinZ,L=H._aabbMaxX,w=H._aabbMaxY,B=H._aabbMaxZ,k,Q,K,$,tt,ot,at;if(Z>X||L<u||I>z||w<g||V>Y||B<M)at=!1;else{var it=f-r,S=d-y,C=x-b,T=0>it?-it:it,j=0>S?-S:S,R=0>C?-C:C,q=.5*(L-Z),E=.5*(w-I),D=.5*(B-V),J=r-.5*(L+Z),F=y-.5*(w+I),N=b-.5*(B+V),G=F*C-N*S,O,nt;if(0<(0>G?-G:G)-(E*R+D*j))nt=!0;else{var _t=N*it-J*C;nt=0<(0>_t?-_t:_t)-(D*T+q*R)}if(nt)O=!0;else{var W=J*S-F*it;O=0<(0>W?-W:W)-(q*j+E*T)}at=!O}at&&(0==H._height?_.process(H._proxy):(this.rayCastRecursive(H._children[0],k,Q,K,$,tt,ot,_),this.rayCastRecursive(H._children[1],k,Q,K,$,tt,ot,_)))},convexCastRecursive:function(e,t,i,o,a){var n=this._aabb.min;n.x=e._aabbMinX,n.y=e._aabbMinY,n.z=e._aabbMinZ;var s=this._aabb.max;s.x=e._aabbMaxX,s.y=e._aabbMaxY,s.z=e._aabbMaxZ,this._convexSweep.init(t,i,o);var _=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&0>=_.distance&&(0==e._height?a.process(e._proxy):(this.convexCastRecursive(e._children[0],t,i,o,a),this.convexCastRecursive(e._children[1],t,i,o,a)))},aabbTestRecursive:function(a,t,i){a._aabbMinX<t._maxX&&a._aabbMaxX>t._minX&&a._aabbMinY<t._maxY&&a._aabbMaxY>t._minY&&a._aabbMinZ<t._maxZ&&a._aabbMaxZ>t._minZ&&(0==a._height?i.process(a._proxy):(this.aabbTestRecursive(a._children[0],t,i),this.aabbTestRecursive(a._children[1],t,i)))},createProxy:function(bt,t){var i=new oimo_collision_broadphase_bvh_BvhProxy(bt,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ;var o=oimo_common_Setting.bvhProxyPadding,_,xt,dt;_=o,xt=o,dt=o,i._aabbMinX-=_,i._aabbMinY-=xt,i._aabbMinZ-=dt,i._aabbMaxX+=_,i._aabbMaxY+=xt,i._aabbMaxZ+=dt;var yt=this._tree,r=yt._nodePool;null==r?r=new oimo_collision_broadphase_bvh_BvhNode:(yt._nodePool=r._next,r._next=null);var ft=r;if(ft._proxy=i,i._leaf=ft,ft._aabbMinX=i._aabbMinX,ft._aabbMinY=i._aabbMinY,ft._aabbMinZ=i._aabbMinZ,ft._aabbMaxX=i._aabbMaxX,ft._aabbMaxY=i._aabbMaxY,ft._aabbMaxZ=i._aabbMaxZ,yt._numLeaves++,null==yt.leafList?(yt.leafList=ft,yt.leafListLast=ft):(yt.leafListLast._nextLeaf=ft,ft._prevLeaf=yt.leafListLast,yt.leafListLast=ft),null==yt._root)yt._root=ft;else{for(var h=yt._root,gt;0<h._height&&(gt=yt._strategy._decideInsertion(h,ft),-1!=gt);)h=h._children[gt];var vt=h._parent,m=yt._nodePool;null==m?m=new oimo_collision_broadphase_bvh_BvhNode:(yt._nodePool=m._next,m._next=null);var Xt=m;if(null==vt)yt._root=Xt;else{var ut=h._childIndex;vt._children[ut]=Xt,Xt._parent=vt,Xt._childIndex=ut}var y=h._childIndex;Xt._children[y]=h,h._parent=Xt,h._childIndex=y;var b=1^h._childIndex;for(Xt._children[b]=ft,ft._parent=Xt,ft._childIndex=b;null!=Xt;){if(yt._strategy._balancingEnabled)if(2>Xt._height)Xt=Xt;else{var f=Xt._parent,d=Xt._children[0],x=Xt._children[1],u=d._height-x._height,g=Xt._childIndex;if(1<u){var M=d._children[0],X=d._children[1];if(M._height>X._height){d._children[1]=Xt,Xt._parent=d,Xt._childIndex=1,Xt._children[0]=X,X._parent=Xt,X._childIndex=0;var z=d._children[0],Y=d._children[1];d._aabbMinX=z._aabbMinX<Y._aabbMinX?z._aabbMinX:Y._aabbMinX,d._aabbMinY=z._aabbMinY<Y._aabbMinY?z._aabbMinY:Y._aabbMinY,d._aabbMinZ=z._aabbMinZ<Y._aabbMinZ?z._aabbMinZ:Y._aabbMinZ,d._aabbMaxX=z._aabbMaxX>Y._aabbMaxX?z._aabbMaxX:Y._aabbMaxX,d._aabbMaxY=z._aabbMaxY>Y._aabbMaxY?z._aabbMaxY:Y._aabbMaxY,d._aabbMaxZ=z._aabbMaxZ>Y._aabbMaxZ?z._aabbMaxZ:Y._aabbMaxZ;var Z=d._children[0]._height,I=d._children[1]._height;d._height=(Z>I?Z:I)+1;var V=Xt._children[0],L=Xt._children[1];Xt._aabbMinX=V._aabbMinX<L._aabbMinX?V._aabbMinX:L._aabbMinX,Xt._aabbMinY=V._aabbMinY<L._aabbMinY?V._aabbMinY:L._aabbMinY,Xt._aabbMinZ=V._aabbMinZ<L._aabbMinZ?V._aabbMinZ:L._aabbMinZ,Xt._aabbMaxX=V._aabbMaxX>L._aabbMaxX?V._aabbMaxX:L._aabbMaxX,Xt._aabbMaxY=V._aabbMaxY>L._aabbMaxY?V._aabbMaxY:L._aabbMaxY,Xt._aabbMaxZ=V._aabbMaxZ>L._aabbMaxZ?V._aabbMaxZ:L._aabbMaxZ;var w=Xt._children[0]._height,B=Xt._children[1]._height;Xt._height=(w>B?w:B)+1}else{d._children[0]=Xt,Xt._parent=d,Xt._childIndex=0,Xt._children[0]=M,M._parent=Xt,M._childIndex=0;var k=d._children[0],A=d._children[1];d._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,d._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,d._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,d._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,d._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,d._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;var P=d._children[0]._height,S=d._children[1]._height;d._height=(P>S?P:S)+1;var C=Xt._children[0],T=Xt._children[1];Xt._aabbMinX=C._aabbMinX<T._aabbMinX?C._aabbMinX:T._aabbMinX,Xt._aabbMinY=C._aabbMinY<T._aabbMinY?C._aabbMinY:T._aabbMinY,Xt._aabbMinZ=C._aabbMinZ<T._aabbMinZ?C._aabbMinZ:T._aabbMinZ,Xt._aabbMaxX=C._aabbMaxX>T._aabbMaxX?C._aabbMaxX:T._aabbMaxX,Xt._aabbMaxY=C._aabbMaxY>T._aabbMaxY?C._aabbMaxY:T._aabbMaxY,Xt._aabbMaxZ=C._aabbMaxZ>T._aabbMaxZ?C._aabbMaxZ:T._aabbMaxZ;var j=Xt._children[0]._height,R=Xt._children[1]._height;Xt._height=(j>R?j:R)+1}null==f?(yt._root=d,d._parent=null):(f._children[g]=d,d._parent=f,d._childIndex=g),Xt=d}else if(-1>u){var q=x._children[0],E=x._children[1];if(q._height>E._height){x._children[1]=Xt,Xt._parent=x,Xt._childIndex=1,Xt._children[1]=E,E._parent=Xt,E._childIndex=1;var D=x._children[0],J=x._children[1];x._aabbMinX=D._aabbMinX<J._aabbMinX?D._aabbMinX:J._aabbMinX,x._aabbMinY=D._aabbMinY<J._aabbMinY?D._aabbMinY:J._aabbMinY,x._aabbMinZ=D._aabbMinZ<J._aabbMinZ?D._aabbMinZ:J._aabbMinZ,x._aabbMaxX=D._aabbMaxX>J._aabbMaxX?D._aabbMaxX:J._aabbMaxX,x._aabbMaxY=D._aabbMaxY>J._aabbMaxY?D._aabbMaxY:J._aabbMaxY,x._aabbMaxZ=D._aabbMaxZ>J._aabbMaxZ?D._aabbMaxZ:J._aabbMaxZ;var F=x._children[0]._height,N=x._children[1]._height;x._height=(F>N?F:N)+1;var G=Xt._children[0],O=Xt._children[1];Xt._aabbMinX=G._aabbMinX<O._aabbMinX?G._aabbMinX:O._aabbMinX,Xt._aabbMinY=G._aabbMinY<O._aabbMinY?G._aabbMinY:O._aabbMinY,Xt._aabbMinZ=G._aabbMinZ<O._aabbMinZ?G._aabbMinZ:O._aabbMinZ,Xt._aabbMaxX=G._aabbMaxX>O._aabbMaxX?G._aabbMaxX:O._aabbMaxX,Xt._aabbMaxY=G._aabbMaxY>O._aabbMaxY?G._aabbMaxY:O._aabbMaxY,Xt._aabbMaxZ=G._aabbMaxZ>O._aabbMaxZ?G._aabbMaxZ:O._aabbMaxZ;var W=Xt._children[0]._height,U=Xt._children[1]._height;Xt._height=(W>U?W:U)+1}else{x._children[0]=Xt,Xt._parent=x,Xt._childIndex=0,Xt._children[1]=q,q._parent=Xt,q._childIndex=1;var H=x._children[0],Q=x._children[1];x._aabbMinX=H._aabbMinX<Q._aabbMinX?H._aabbMinX:Q._aabbMinX,x._aabbMinY=H._aabbMinY<Q._aabbMinY?H._aabbMinY:Q._aabbMinY,x._aabbMinZ=H._aabbMinZ<Q._aabbMinZ?H._aabbMinZ:Q._aabbMinZ,x._aabbMaxX=H._aabbMaxX>Q._aabbMaxX?H._aabbMaxX:Q._aabbMaxX,x._aabbMaxY=H._aabbMaxY>Q._aabbMaxY?H._aabbMaxY:Q._aabbMaxY,x._aabbMaxZ=H._aabbMaxZ>Q._aabbMaxZ?H._aabbMaxZ:Q._aabbMaxZ;var $=x._children[0]._height,K=x._children[1]._height;x._height=($>K?$:K)+1;var tt=Xt._children[0],it=Xt._children[1];Xt._aabbMinX=tt._aabbMinX<it._aabbMinX?tt._aabbMinX:it._aabbMinX,Xt._aabbMinY=tt._aabbMinY<it._aabbMinY?tt._aabbMinY:it._aabbMinY,Xt._aabbMinZ=tt._aabbMinZ<it._aabbMinZ?tt._aabbMinZ:it._aabbMinZ,Xt._aabbMaxX=tt._aabbMaxX>it._aabbMaxX?tt._aabbMaxX:it._aabbMaxX,Xt._aabbMaxY=tt._aabbMaxY>it._aabbMaxY?tt._aabbMaxY:it._aabbMaxY,Xt._aabbMaxZ=tt._aabbMaxZ>it._aabbMaxZ?tt._aabbMaxZ:it._aabbMaxZ;var ot=Xt._children[0]._height,at=Xt._children[1]._height;Xt._height=(ot>at?ot:at)+1}null==f?(yt._root=x,x._parent=null):(f._children[g]=x,x._parent=f,x._childIndex=g),Xt=x}else Xt=Xt}var nt=Xt._children[0]._height,st=Xt._children[1]._height;Xt._height=(nt>st?nt:st)+1;var _t=Xt._children[0],rt=Xt._children[1];Xt._aabbMinX=_t._aabbMinX<rt._aabbMinX?_t._aabbMinX:rt._aabbMinX,Xt._aabbMinY=_t._aabbMinY<rt._aabbMinY?_t._aabbMinY:rt._aabbMinY,Xt._aabbMinZ=_t._aabbMinZ<rt._aabbMinZ?_t._aabbMinZ:rt._aabbMinZ,Xt._aabbMaxX=_t._aabbMaxX>rt._aabbMaxX?_t._aabbMaxX:rt._aabbMaxX,Xt._aabbMaxY=_t._aabbMaxY>rt._aabbMaxY?_t._aabbMaxY:rt._aabbMaxY,Xt._aabbMaxZ=_t._aabbMaxZ>rt._aabbMaxZ?_t._aabbMaxZ:rt._aabbMaxZ,Xt=Xt._parent}}if(!i._moved){if(i._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var et=this.numMovedProxies<<1,zt=Array(et),lt=0,Yt=this.numMovedProxies,mt;lt<Yt;)mt=lt++,zt[mt]=this.movedProxies[mt],this.movedProxies[mt]=null;this.movedProxies=zt}this.movedProxies[this.numMovedProxies++]=i}return i},destroyProxy:function(nt){this._numProxies--;var t=nt._prev,i=nt._next;null!=t&&(t._next=i),null!=i&&(i._prev=t),nt==this._proxyList&&(this._proxyList=this._proxyList._next),nt==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),nt._next=null,nt._prev=null;var o=nt,a=this._tree,n=o._leaf;a._numLeaves--;var s=n._prevLeaf,_=n._nextLeaf;if(null!=s&&(s._nextLeaf=_),null!=_&&(_._prevLeaf=s),n==a.leafList&&(a.leafList=a.leafList._nextLeaf),n==a.leafListLast&&(a.leafListLast=a.leafListLast._prevLeaf),n._nextLeaf=null,n._prevLeaf=null,a._root==n)a._root=null;else{var r=n._parent,e=r._children[1^n._childIndex],h=r._parent;if(null==h)e._parent=null,e._childIndex=0,a._root=e,r._next=null,r._childIndex=0,r._children[0]=null,r._children[1]=null,r._childIndex=0,r._parent=null,r._height=0,r._proxy=null,r._next=a._nodePool,a._nodePool=r;else{e._parent=h;var l=r._childIndex;h._children[l]=e,e._parent=h,e._childIndex=l,r._next=null,r._childIndex=0,r._children[0]=null,r._children[1]=null,r._childIndex=0,r._parent=null,r._height=0,r._proxy=null,r._next=a._nodePool,a._nodePool=r;for(var c=h;null!=c;){if(a._strategy._balancingEnabled)if(2>c._height)c=c;else{var _t=c._parent,p=c._children[0],v=c._children[1],y=p._height-v._height,b=c._childIndex;if(1<y){var f=p._children[0],d=p._children[1];if(f._height>d._height){p._children[1]=c,c._parent=p,c._childIndex=1,c._children[0]=d,d._parent=c,d._childIndex=0;var x=p._children[0],u=p._children[1];p._aabbMinX=x._aabbMinX<u._aabbMinX?x._aabbMinX:u._aabbMinX,p._aabbMinY=x._aabbMinY<u._aabbMinY?x._aabbMinY:u._aabbMinY,p._aabbMinZ=x._aabbMinZ<u._aabbMinZ?x._aabbMinZ:u._aabbMinZ,p._aabbMaxX=x._aabbMaxX>u._aabbMaxX?x._aabbMaxX:u._aabbMaxX,p._aabbMaxY=x._aabbMaxY>u._aabbMaxY?x._aabbMaxY:u._aabbMaxY,p._aabbMaxZ=x._aabbMaxZ>u._aabbMaxZ?x._aabbMaxZ:u._aabbMaxZ;var g=p._children[0]._height,M=p._children[1]._height;p._height=(g>M?g:M)+1;var X=c._children[0],z=c._children[1];c._aabbMinX=X._aabbMinX<z._aabbMinX?X._aabbMinX:z._aabbMinX,c._aabbMinY=X._aabbMinY<z._aabbMinY?X._aabbMinY:z._aabbMinY,c._aabbMinZ=X._aabbMinZ<z._aabbMinZ?X._aabbMinZ:z._aabbMinZ,c._aabbMaxX=X._aabbMaxX>z._aabbMaxX?X._aabbMaxX:z._aabbMaxX,c._aabbMaxY=X._aabbMaxY>z._aabbMaxY?X._aabbMaxY:z._aabbMaxY,c._aabbMaxZ=X._aabbMaxZ>z._aabbMaxZ?X._aabbMaxZ:z._aabbMaxZ;var Y=c._children[0]._height,Z=c._children[1]._height;c._height=(Y>Z?Y:Z)+1}else{p._children[0]=c,c._parent=p,c._childIndex=0,c._children[0]=f,f._parent=c,f._childIndex=0;var I=p._children[0],V=p._children[1];p._aabbMinX=I._aabbMinX<V._aabbMinX?I._aabbMinX:V._aabbMinX,p._aabbMinY=I._aabbMinY<V._aabbMinY?I._aabbMinY:V._aabbMinY,p._aabbMinZ=I._aabbMinZ<V._aabbMinZ?I._aabbMinZ:V._aabbMinZ,p._aabbMaxX=I._aabbMaxX>V._aabbMaxX?I._aabbMaxX:V._aabbMaxX,p._aabbMaxY=I._aabbMaxY>V._aabbMaxY?I._aabbMaxY:V._aabbMaxY,p._aabbMaxZ=I._aabbMaxZ>V._aabbMaxZ?I._aabbMaxZ:V._aabbMaxZ;var L=p._children[0]._height,w=p._children[1]._height;p._height=(L>w?L:w)+1;var B=c._children[0],k=c._children[1];c._aabbMinX=B._aabbMinX<k._aabbMinX?B._aabbMinX:k._aabbMinX,c._aabbMinY=B._aabbMinY<k._aabbMinY?B._aabbMinY:k._aabbMinY,c._aabbMinZ=B._aabbMinZ<k._aabbMinZ?B._aabbMinZ:k._aabbMinZ,c._aabbMaxX=B._aabbMaxX>k._aabbMaxX?B._aabbMaxX:k._aabbMaxX,c._aabbMaxY=B._aabbMaxY>k._aabbMaxY?B._aabbMaxY:k._aabbMaxY,c._aabbMaxZ=B._aabbMaxZ>k._aabbMaxZ?B._aabbMaxZ:k._aabbMaxZ;var A=c._children[0]._height,P=c._children[1]._height;c._height=(A>P?A:P)+1}null==_t?(a._root=p,p._parent=null):(_t._children[b]=p,p._parent=_t,p._childIndex=b),c=p}else if(-1>y){var S=v._children[0],C=v._children[1];if(S._height>C._height){v._children[1]=c,c._parent=v,c._childIndex=1,c._children[1]=C,C._parent=c,C._childIndex=1;var T=v._children[0],j=v._children[1];v._aabbMinX=T._aabbMinX<j._aabbMinX?T._aabbMinX:j._aabbMinX,v._aabbMinY=T._aabbMinY<j._aabbMinY?T._aabbMinY:j._aabbMinY,v._aabbMinZ=T._aabbMinZ<j._aabbMinZ?T._aabbMinZ:j._aabbMinZ,v._aabbMaxX=T._aabbMaxX>j._aabbMaxX?T._aabbMaxX:j._aabbMaxX,v._aabbMaxY=T._aabbMaxY>j._aabbMaxY?T._aabbMaxY:j._aabbMaxY,v._aabbMaxZ=T._aabbMaxZ>j._aabbMaxZ?T._aabbMaxZ:j._aabbMaxZ;var R=v._children[0]._height,q=v._children[1]._height;v._height=(R>q?R:q)+1;var E=c._children[0],D=c._children[1];c._aabbMinX=E._aabbMinX<D._aabbMinX?E._aabbMinX:D._aabbMinX,c._aabbMinY=E._aabbMinY<D._aabbMinY?E._aabbMinY:D._aabbMinY,c._aabbMinZ=E._aabbMinZ<D._aabbMinZ?E._aabbMinZ:D._aabbMinZ,c._aabbMaxX=E._aabbMaxX>D._aabbMaxX?E._aabbMaxX:D._aabbMaxX,c._aabbMaxY=E._aabbMaxY>D._aabbMaxY?E._aabbMaxY:D._aabbMaxY,c._aabbMaxZ=E._aabbMaxZ>D._aabbMaxZ?E._aabbMaxZ:D._aabbMaxZ;var J=c._children[0]._height,F=c._children[1]._height;c._height=(J>F?J:F)+1}else{v._children[0]=c,c._parent=v,c._childIndex=0,c._children[1]=S,S._parent=c,S._childIndex=1;var N=v._children[0],G=v._children[1];v._aabbMinX=N._aabbMinX<G._aabbMinX?N._aabbMinX:G._aabbMinX,v._aabbMinY=N._aabbMinY<G._aabbMinY?N._aabbMinY:G._aabbMinY,v._aabbMinZ=N._aabbMinZ<G._aabbMinZ?N._aabbMinZ:G._aabbMinZ,v._aabbMaxX=N._aabbMaxX>G._aabbMaxX?N._aabbMaxX:G._aabbMaxX,v._aabbMaxY=N._aabbMaxY>G._aabbMaxY?N._aabbMaxY:G._aabbMaxY,v._aabbMaxZ=N._aabbMaxZ>G._aabbMaxZ?N._aabbMaxZ:G._aabbMaxZ;var O=v._children[0]._height,W=v._children[1]._height;v._height=(O>W?O:W)+1;var U=c._children[0],H=c._children[1];c._aabbMinX=U._aabbMinX<H._aabbMinX?U._aabbMinX:H._aabbMinX,c._aabbMinY=U._aabbMinY<H._aabbMinY?U._aabbMinY:H._aabbMinY,c._aabbMinZ=U._aabbMinZ<H._aabbMinZ?U._aabbMinZ:H._aabbMinZ,c._aabbMaxX=U._aabbMaxX>H._aabbMaxX?U._aabbMaxX:H._aabbMaxX,c._aabbMaxY=U._aabbMaxY>H._aabbMaxY?U._aabbMaxY:H._aabbMaxY,c._aabbMaxZ=U._aabbMaxZ>H._aabbMaxZ?U._aabbMaxZ:H._aabbMaxZ;var Q=c._children[0]._height,$=c._children[1]._height;c._height=(Q>$?Q:$)+1}null==_t?(a._root=v,v._parent=null):(_t._children[b]=v,v._parent=_t,v._childIndex=b),c=v}else c=c}var K=c._children[0]._height,tt=c._children[1]._height;c._height=(K>tt?K:tt)+1;var it=c._children[0],ot=c._children[1];c._aabbMinX=it._aabbMinX<ot._aabbMinX?it._aabbMinX:ot._aabbMinX,c._aabbMinY=it._aabbMinY<ot._aabbMinY?it._aabbMinY:ot._aabbMinY,c._aabbMinZ=it._aabbMinZ<ot._aabbMinZ?it._aabbMinZ:ot._aabbMinZ,c._aabbMaxX=it._aabbMaxX>ot._aabbMaxX?it._aabbMaxX:ot._aabbMaxX,c._aabbMaxY=it._aabbMaxY>ot._aabbMaxY?it._aabbMaxY:ot._aabbMaxY,c._aabbMaxZ=it._aabbMaxZ>ot._aabbMaxZ?it._aabbMaxZ:ot._aabbMaxZ,c=c._parent}}}o._leaf=null,n._next=null,n._childIndex=0,n._children[0]=null,n._children[1]=null,n._childIndex=0,n._parent=null,n._height=0,n._proxy=null,n._next=a._nodePool,a._nodePool=n,o.userData=null,o._next=null,o._prev=null,o._moved&&(o._moved=!1)},moveProxy:function(X,t,i){var o=X;if(!(o._aabbMinX<=t._minX&&o._aabbMaxX>=t._maxX&&o._aabbMinY<=t._minY&&o._aabbMaxY>=t._maxY&&o._aabbMinZ<=t._minZ&&o._aabbMaxZ>=t._maxZ)){o._aabbMinX=t._minX,o._aabbMinY=t._minY,o._aabbMinZ=t._minZ,o._aabbMaxX=t._maxX,o._aabbMaxY=t._maxY,o._aabbMaxZ=t._maxZ;var a=oimo_common_Setting.bvhProxyPadding,r,z,Y;if(r=a,z=a,Y=a,o._aabbMinX-=r,o._aabbMinY-=z,o._aabbMinZ-=Y,o._aabbMaxX+=r,o._aabbMaxY+=z,o._aabbMaxZ+=Y,null!=i){var Z,I,V,L,B,k,A,P,T;0,0,0;var w=i;L=0<(Z=w.x)?0:Z,B=0<(I=w.y)?0:I,k=0<(V=w.z)?0:V,A=0>Z?0:Z,P=0>I?0:I,T=0>V?0:V,o._aabbMinX+=L,o._aabbMinY+=B,o._aabbMinZ+=k,o._aabbMaxX+=A,o._aabbMaxY+=P,o._aabbMaxZ+=T}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var f=this.numMovedProxies<<1,d=Array(f),x=0,S=this.numMovedProxies,g;x<S;)g=x++,d[g]=this.movedProxies[g],this.movedProxies[g]=null;this.movedProxies=d}this.movedProxies[this.numMovedProxies++]=o}}},collectPairs:function(){var to=this._proxyPairList;if(null!=to){for(;to._p1=null,to._p2=null,null!=(to=to._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(2>this._numProxies)){for(var oo=this.numMovedProxies/this._numProxies<oimo_common_Setting.bvhIncrementalCollisionThreshold,i=0,ao=this.numMovedProxies;i<ao;){var a=i++,n=this.movedProxies[a];if(n._moved){var s=this._tree,_=n._leaf;s._numLeaves--;var r=_._prevLeaf,e=_._nextLeaf;if(null!=r&&(r._nextLeaf=e),null!=e&&(e._prevLeaf=r),_==s.leafList&&(s.leafList=s.leafList._nextLeaf),_==s.leafListLast&&(s.leafListLast=s.leafListLast._prevLeaf),_._nextLeaf=null,_._prevLeaf=null,s._root==_)s._root=null;else{var h=_._parent,l=h._children[1^_._childIndex],c=h._parent;if(null==c)l._parent=null,l._childIndex=0,s._root=l,h._next=null,h._childIndex=0,h._children[0]=null,h._children[1]=null,h._childIndex=0,h._parent=null,h._height=0,h._proxy=null,h._next=s._nodePool,s._nodePool=h;else{l._parent=c;var m=h._childIndex;c._children[m]=l,l._parent=c,l._childIndex=m,h._next=null,h._childIndex=0,h._children[0]=null,h._children[1]=null,h._childIndex=0,h._parent=null,h._height=0,h._proxy=null,h._next=s._nodePool,s._nodePool=h;for(var p=c;null!=p;){if(s._strategy._balancingEnabled)if(2>p._height)p=p;else{var io=p._parent,y=p._children[0],b=p._children[1],f=y._height-b._height,d=p._childIndex;if(1<f){var x=y._children[0],u=y._children[1];if(x._height>u._height){y._children[1]=p,p._parent=y,p._childIndex=1,p._children[0]=u,u._parent=p,u._childIndex=0;var g=y._children[0],M=y._children[1];y._aabbMinX=g._aabbMinX<M._aabbMinX?g._aabbMinX:M._aabbMinX,y._aabbMinY=g._aabbMinY<M._aabbMinY?g._aabbMinY:M._aabbMinY,y._aabbMinZ=g._aabbMinZ<M._aabbMinZ?g._aabbMinZ:M._aabbMinZ,y._aabbMaxX=g._aabbMaxX>M._aabbMaxX?g._aabbMaxX:M._aabbMaxX,y._aabbMaxY=g._aabbMaxY>M._aabbMaxY?g._aabbMaxY:M._aabbMaxY,y._aabbMaxZ=g._aabbMaxZ>M._aabbMaxZ?g._aabbMaxZ:M._aabbMaxZ;var X=y._children[0]._height,z=y._children[1]._height;y._height=(X>z?X:z)+1;var Y=p._children[0],Z=p._children[1];p._aabbMinX=Y._aabbMinX<Z._aabbMinX?Y._aabbMinX:Z._aabbMinX,p._aabbMinY=Y._aabbMinY<Z._aabbMinY?Y._aabbMinY:Z._aabbMinY,p._aabbMinZ=Y._aabbMinZ<Z._aabbMinZ?Y._aabbMinZ:Z._aabbMinZ,p._aabbMaxX=Y._aabbMaxX>Z._aabbMaxX?Y._aabbMaxX:Z._aabbMaxX,p._aabbMaxY=Y._aabbMaxY>Z._aabbMaxY?Y._aabbMaxY:Z._aabbMaxY,p._aabbMaxZ=Y._aabbMaxZ>Z._aabbMaxZ?Y._aabbMaxZ:Z._aabbMaxZ;var I=p._children[0]._height,V=p._children[1]._height;p._height=(I>V?I:V)+1}else{y._children[0]=p,p._parent=y,p._childIndex=0,p._children[0]=x,x._parent=p,x._childIndex=0;var L=y._children[0],w=y._children[1];y._aabbMinX=L._aabbMinX<w._aabbMinX?L._aabbMinX:w._aabbMinX,y._aabbMinY=L._aabbMinY<w._aabbMinY?L._aabbMinY:w._aabbMinY,y._aabbMinZ=L._aabbMinZ<w._aabbMinZ?L._aabbMinZ:w._aabbMinZ,y._aabbMaxX=L._aabbMaxX>w._aabbMaxX?L._aabbMaxX:w._aabbMaxX,y._aabbMaxY=L._aabbMaxY>w._aabbMaxY?L._aabbMaxY:w._aabbMaxY,y._aabbMaxZ=L._aabbMaxZ>w._aabbMaxZ?L._aabbMaxZ:w._aabbMaxZ;var B=y._children[0]._height,k=y._children[1]._height;y._height=(B>k?B:k)+1;var A=p._children[0],P=p._children[1];p._aabbMinX=A._aabbMinX<P._aabbMinX?A._aabbMinX:P._aabbMinX,p._aabbMinY=A._aabbMinY<P._aabbMinY?A._aabbMinY:P._aabbMinY,p._aabbMinZ=A._aabbMinZ<P._aabbMinZ?A._aabbMinZ:P._aabbMinZ,p._aabbMaxX=A._aabbMaxX>P._aabbMaxX?A._aabbMaxX:P._aabbMaxX,p._aabbMaxY=A._aabbMaxY>P._aabbMaxY?A._aabbMaxY:P._aabbMaxY,p._aabbMaxZ=A._aabbMaxZ>P._aabbMaxZ?A._aabbMaxZ:P._aabbMaxZ;var S=p._children[0]._height,C=p._children[1]._height;p._height=(S>C?S:C)+1}null==io?(s._root=y,y._parent=null):(io._children[d]=y,y._parent=io,y._childIndex=d),p=y}else if(-1>f){var T=b._children[0],j=b._children[1];if(T._height>j._height){b._children[1]=p,p._parent=b,p._childIndex=1,p._children[1]=j,j._parent=p,j._childIndex=1;var R=b._children[0],q=b._children[1];b._aabbMinX=R._aabbMinX<q._aabbMinX?R._aabbMinX:q._aabbMinX,b._aabbMinY=R._aabbMinY<q._aabbMinY?R._aabbMinY:q._aabbMinY,b._aabbMinZ=R._aabbMinZ<q._aabbMinZ?R._aabbMinZ:q._aabbMinZ,b._aabbMaxX=R._aabbMaxX>q._aabbMaxX?R._aabbMaxX:q._aabbMaxX,b._aabbMaxY=R._aabbMaxY>q._aabbMaxY?R._aabbMaxY:q._aabbMaxY,b._aabbMaxZ=R._aabbMaxZ>q._aabbMaxZ?R._aabbMaxZ:q._aabbMaxZ;var E=b._children[0]._height,D=b._children[1]._height;b._height=(E>D?E:D)+1;var J=p._children[0],F=p._children[1];p._aabbMinX=J._aabbMinX<F._aabbMinX?J._aabbMinX:F._aabbMinX,p._aabbMinY=J._aabbMinY<F._aabbMinY?J._aabbMinY:F._aabbMinY,p._aabbMinZ=J._aabbMinZ<F._aabbMinZ?J._aabbMinZ:F._aabbMinZ,p._aabbMaxX=J._aabbMaxX>F._aabbMaxX?J._aabbMaxX:F._aabbMaxX,p._aabbMaxY=J._aabbMaxY>F._aabbMaxY?J._aabbMaxY:F._aabbMaxY,p._aabbMaxZ=J._aabbMaxZ>F._aabbMaxZ?J._aabbMaxZ:F._aabbMaxZ;var N=p._children[0]._height,G=p._children[1]._height;p._height=(N>G?N:G)+1}else{b._children[0]=p,p._parent=b,p._childIndex=0,p._children[1]=T,T._parent=p,T._childIndex=1;var O=b._children[0],W=b._children[1];b._aabbMinX=O._aabbMinX<W._aabbMinX?O._aabbMinX:W._aabbMinX,b._aabbMinY=O._aabbMinY<W._aabbMinY?O._aabbMinY:W._aabbMinY,b._aabbMinZ=O._aabbMinZ<W._aabbMinZ?O._aabbMinZ:W._aabbMinZ,b._aabbMaxX=O._aabbMaxX>W._aabbMaxX?O._aabbMaxX:W._aabbMaxX,b._aabbMaxY=O._aabbMaxY>W._aabbMaxY?O._aabbMaxY:W._aabbMaxY,b._aabbMaxZ=O._aabbMaxZ>W._aabbMaxZ?O._aabbMaxZ:W._aabbMaxZ;var U=b._children[0]._height,H=b._children[1]._height;b._height=(U>H?U:H)+1;var Q=p._children[0],$=p._children[1];p._aabbMinX=Q._aabbMinX<$._aabbMinX?Q._aabbMinX:$._aabbMinX,p._aabbMinY=Q._aabbMinY<$._aabbMinY?Q._aabbMinY:$._aabbMinY,p._aabbMinZ=Q._aabbMinZ<$._aabbMinZ?Q._aabbMinZ:$._aabbMinZ,p._aabbMaxX=Q._aabbMaxX>$._aabbMaxX?Q._aabbMaxX:$._aabbMaxX,p._aabbMaxY=Q._aabbMaxY>$._aabbMaxY?Q._aabbMaxY:$._aabbMaxY,p._aabbMaxZ=Q._aabbMaxZ>$._aabbMaxZ?Q._aabbMaxZ:$._aabbMaxZ;var K=p._children[0]._height,tt=p._children[1]._height;p._height=(K>tt?K:tt)+1}null==io?(s._root=b,b._parent=null):(io._children[d]=b,b._parent=io,b._childIndex=d),p=b}else p=p}var it=p._children[0]._height,ot=p._children[1]._height;p._height=(it>ot?it:ot)+1;var at=p._children[0],nt=p._children[1];p._aabbMinX=at._aabbMinX<nt._aabbMinX?at._aabbMinX:nt._aabbMinX,p._aabbMinY=at._aabbMinY<nt._aabbMinY?at._aabbMinY:nt._aabbMinY,p._aabbMinZ=at._aabbMinZ<nt._aabbMinZ?at._aabbMinZ:nt._aabbMinZ,p._aabbMaxX=at._aabbMaxX>nt._aabbMaxX?at._aabbMaxX:nt._aabbMaxX,p._aabbMaxY=at._aabbMaxY>nt._aabbMaxY?at._aabbMaxY:nt._aabbMaxY,p._aabbMaxZ=at._aabbMaxZ>nt._aabbMaxZ?at._aabbMaxZ:nt._aabbMaxZ,p=p._parent}}}n._leaf=null,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=s._nodePool,s._nodePool=_;var st=this._tree,_t=st._nodePool;null==_t?_t=new oimo_collision_broadphase_bvh_BvhNode:(st._nodePool=_t._next,_t._next=null);var no=_t;if(no._proxy=n,n._leaf=no,no._aabbMinX=n._aabbMinX,no._aabbMinY=n._aabbMinY,no._aabbMinZ=n._aabbMinZ,no._aabbMaxX=n._aabbMaxX,no._aabbMaxY=n._aabbMaxY,no._aabbMaxZ=n._aabbMaxZ,st._numLeaves++,null==st.leafList?(st.leafList=no,st.leafListLast=no):(st.leafListLast._nextLeaf=no,no._prevLeaf=st.leafListLast,st.leafListLast=no),null==st._root)st._root=no;else{for(var et=st._root,_o;0<et._height&&(_o=st._strategy._decideInsertion(et,no),-1!=_o);)et=et._children[_o];var eo=et._parent,ct=st._nodePool;null==ct?ct=new oimo_collision_broadphase_bvh_BvhNode:(st._nodePool=ct._next,ct._next=null);var ro=ct;if(null==eo)st._root=ro;else{var so=et._childIndex;eo._children[so]=ro,ro._parent=eo,ro._childIndex=so}var vt=et._childIndex;ro._children[vt]=et,et._parent=ro,et._childIndex=vt;var yt=1^et._childIndex;for(ro._children[yt]=no,no._parent=ro,no._childIndex=yt;null!=ro;){if(st._strategy._balancingEnabled)if(2>ro._height)ro=ro;else{var bt=ro._parent,ft=ro._children[0],dt=ro._children[1],xt=ft._height-dt._height,ut=ro._childIndex;if(1<xt){var gt=ft._children[0],Mt=ft._children[1];if(gt._height>Mt._height){ft._children[1]=ro,ro._parent=ft,ro._childIndex=1,ro._children[0]=Mt,Mt._parent=ro,Mt._childIndex=0;var Xt=ft._children[0],zt=ft._children[1];ft._aabbMinX=Xt._aabbMinX<zt._aabbMinX?Xt._aabbMinX:zt._aabbMinX,ft._aabbMinY=Xt._aabbMinY<zt._aabbMinY?Xt._aabbMinY:zt._aabbMinY,ft._aabbMinZ=Xt._aabbMinZ<zt._aabbMinZ?Xt._aabbMinZ:zt._aabbMinZ,ft._aabbMaxX=Xt._aabbMaxX>zt._aabbMaxX?Xt._aabbMaxX:zt._aabbMaxX,ft._aabbMaxY=Xt._aabbMaxY>zt._aabbMaxY?Xt._aabbMaxY:zt._aabbMaxY,ft._aabbMaxZ=Xt._aabbMaxZ>zt._aabbMaxZ?Xt._aabbMaxZ:zt._aabbMaxZ;var Yt=ft._children[0]._height,Zt=ft._children[1]._height;ft._height=(Yt>Zt?Yt:Zt)+1;var It=ro._children[0],Vt=ro._children[1];ro._aabbMinX=It._aabbMinX<Vt._aabbMinX?It._aabbMinX:Vt._aabbMinX,ro._aabbMinY=It._aabbMinY<Vt._aabbMinY?It._aabbMinY:Vt._aabbMinY,ro._aabbMinZ=It._aabbMinZ<Vt._aabbMinZ?It._aabbMinZ:Vt._aabbMinZ,ro._aabbMaxX=It._aabbMaxX>Vt._aabbMaxX?It._aabbMaxX:Vt._aabbMaxX,ro._aabbMaxY=It._aabbMaxY>Vt._aabbMaxY?It._aabbMaxY:Vt._aabbMaxY,ro._aabbMaxZ=It._aabbMaxZ>Vt._aabbMaxZ?It._aabbMaxZ:Vt._aabbMaxZ;var Lt=ro._children[0]._height,wt=ro._children[1]._height;ro._height=(Lt>wt?Lt:wt)+1}else{ft._children[0]=ro,ro._parent=ft,ro._childIndex=0,ro._children[0]=gt,gt._parent=ro,gt._childIndex=0;var Bt=ft._children[0],kt=ft._children[1];ft._aabbMinX=Bt._aabbMinX<kt._aabbMinX?Bt._aabbMinX:kt._aabbMinX,ft._aabbMinY=Bt._aabbMinY<kt._aabbMinY?Bt._aabbMinY:kt._aabbMinY,ft._aabbMinZ=Bt._aabbMinZ<kt._aabbMinZ?Bt._aabbMinZ:kt._aabbMinZ,ft._aabbMaxX=Bt._aabbMaxX>kt._aabbMaxX?Bt._aabbMaxX:kt._aabbMaxX,ft._aabbMaxY=Bt._aabbMaxY>kt._aabbMaxY?Bt._aabbMaxY:kt._aabbMaxY,ft._aabbMaxZ=Bt._aabbMaxZ>kt._aabbMaxZ?Bt._aabbMaxZ:kt._aabbMaxZ;var At=ft._children[0]._height,Pt=ft._children[1]._height;ft._height=(At>Pt?At:Pt)+1;var St=ro._children[0],Ct=ro._children[1];ro._aabbMinX=St._aabbMinX<Ct._aabbMinX?St._aabbMinX:Ct._aabbMinX,ro._aabbMinY=St._aabbMinY<Ct._aabbMinY?St._aabbMinY:Ct._aabbMinY,ro._aabbMinZ=St._aabbMinZ<Ct._aabbMinZ?St._aabbMinZ:Ct._aabbMinZ,ro._aabbMaxX=St._aabbMaxX>Ct._aabbMaxX?St._aabbMaxX:Ct._aabbMaxX,ro._aabbMaxY=St._aabbMaxY>Ct._aabbMaxY?St._aabbMaxY:Ct._aabbMaxY,ro._aabbMaxZ=St._aabbMaxZ>Ct._aabbMaxZ?St._aabbMaxZ:Ct._aabbMaxZ;var Tt=ro._children[0]._height,jt=ro._children[1]._height;ro._height=(Tt>jt?Tt:jt)+1}null==bt?(st._root=ft,ft._parent=null):(bt._children[ut]=ft,ft._parent=bt,ft._childIndex=ut),ro=ft}else if(-1>xt){var Rt=dt._children[0],qt=dt._children[1];if(Rt._height>qt._height){dt._children[1]=ro,ro._parent=dt,ro._childIndex=1,ro._children[1]=qt,qt._parent=ro,qt._childIndex=1;var Et=dt._children[0],Dt=dt._children[1];dt._aabbMinX=Et._aabbMinX<Dt._aabbMinX?Et._aabbMinX:Dt._aabbMinX,dt._aabbMinY=Et._aabbMinY<Dt._aabbMinY?Et._aabbMinY:Dt._aabbMinY,dt._aabbMinZ=Et._aabbMinZ<Dt._aabbMinZ?Et._aabbMinZ:Dt._aabbMinZ,dt._aabbMaxX=Et._aabbMaxX>Dt._aabbMaxX?Et._aabbMaxX:Dt._aabbMaxX,dt._aabbMaxY=Et._aabbMaxY>Dt._aabbMaxY?Et._aabbMaxY:Dt._aabbMaxY,dt._aabbMaxZ=Et._aabbMaxZ>Dt._aabbMaxZ?Et._aabbMaxZ:Dt._aabbMaxZ;var Jt=dt._children[0]._height,Ft=dt._children[1]._height;dt._height=(Jt>Ft?Jt:Ft)+1;var Nt=ro._children[0],Gt=ro._children[1];ro._aabbMinX=Nt._aabbMinX<Gt._aabbMinX?Nt._aabbMinX:Gt._aabbMinX,ro._aabbMinY=Nt._aabbMinY<Gt._aabbMinY?Nt._aabbMinY:Gt._aabbMinY,ro._aabbMinZ=Nt._aabbMinZ<Gt._aabbMinZ?Nt._aabbMinZ:Gt._aabbMinZ,ro._aabbMaxX=Nt._aabbMaxX>Gt._aabbMaxX?Nt._aabbMaxX:Gt._aabbMaxX,ro._aabbMaxY=Nt._aabbMaxY>Gt._aabbMaxY?Nt._aabbMaxY:Gt._aabbMaxY,ro._aabbMaxZ=Nt._aabbMaxZ>Gt._aabbMaxZ?Nt._aabbMaxZ:Gt._aabbMaxZ;var Ot=ro._children[0]._height,Wt=ro._children[1]._height;ro._height=(Ot>Wt?Ot:Wt)+1}else{dt._children[0]=ro,ro._parent=dt,ro._childIndex=0,ro._children[1]=Rt,Rt._parent=ro,Rt._childIndex=1;var Ut=dt._children[0],Ht=dt._children[1];dt._aabbMinX=Ut._aabbMinX<Ht._aabbMinX?Ut._aabbMinX:Ht._aabbMinX,dt._aabbMinY=Ut._aabbMinY<Ht._aabbMinY?Ut._aabbMinY:Ht._aabbMinY,dt._aabbMinZ=Ut._aabbMinZ<Ht._aabbMinZ?Ut._aabbMinZ:Ht._aabbMinZ,dt._aabbMaxX=Ut._aabbMaxX>Ht._aabbMaxX?Ut._aabbMaxX:Ht._aabbMaxX,dt._aabbMaxY=Ut._aabbMaxY>Ht._aabbMaxY?Ut._aabbMaxY:Ht._aabbMaxY,dt._aabbMaxZ=Ut._aabbMaxZ>Ht._aabbMaxZ?Ut._aabbMaxZ:Ht._aabbMaxZ;var Qt=dt._children[0]._height,$t=dt._children[1]._height;dt._height=(Qt>$t?Qt:$t)+1;var Kt=ro._children[0],lo=ro._children[1];ro._aabbMinX=Kt._aabbMinX<lo._aabbMinX?Kt._aabbMinX:lo._aabbMinX,ro._aabbMinY=Kt._aabbMinY<lo._aabbMinY?Kt._aabbMinY:lo._aabbMinY,ro._aabbMinZ=Kt._aabbMinZ<lo._aabbMinZ?Kt._aabbMinZ:lo._aabbMinZ,ro._aabbMaxX=Kt._aabbMaxX>lo._aabbMaxX?Kt._aabbMaxX:lo._aabbMaxX,ro._aabbMaxY=Kt._aabbMaxY>lo._aabbMaxY?Kt._aabbMaxY:lo._aabbMaxY,ro._aabbMaxZ=Kt._aabbMaxZ>lo._aabbMaxZ?Kt._aabbMaxZ:lo._aabbMaxZ;var co=ro._children[0]._height,po=ro._children[1]._height;ro._height=(co>po?co:po)+1}null==bt?(st._root=dt,dt._parent=null):(bt._children[ut]=dt,dt._parent=bt,dt._childIndex=ut),ro=dt}else ro=ro}var mo=ro._children[0]._height,bo=ro._children[1]._height;ro._height=(mo>bo?mo:bo)+1;var xo=ro._children[0],yo=ro._children[1];ro._aabbMinX=xo._aabbMinX<yo._aabbMinX?xo._aabbMinX:yo._aabbMinX,ro._aabbMinY=xo._aabbMinY<yo._aabbMinY?xo._aabbMinY:yo._aabbMinY,ro._aabbMinZ=xo._aabbMinZ<yo._aabbMinZ?xo._aabbMinZ:yo._aabbMinZ,ro._aabbMaxX=xo._aabbMaxX>yo._aabbMaxX?xo._aabbMaxX:yo._aabbMaxX,ro._aabbMaxY=xo._aabbMaxY>yo._aabbMaxY?xo._aabbMaxY:yo._aabbMaxY,ro._aabbMaxZ=xo._aabbMaxZ>yo._aabbMaxZ?xo._aabbMaxZ:yo._aabbMaxZ,ro=ro._parent}}oo&&this.collide(this._tree._root,n._leaf),n._moved=!1}this.movedProxies[a]=null}oo||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}},rayCast:function(c,t,i){if(null!=this._tree._root){var o=c,p,m,b,x,d,y;p=o.x,m=o.y,b=o.z;var f=t;x=f.x,d=f.y,y=f.z,this.rayCastRecursive(this._tree._root,p,m,b,x,d,y,i)}},convexCast:function(n,t,i,o){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,n,t,i,o)},aabbTest:function(o,t){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,o,t)},getTreeBalance:function(){return this._tree._getBalance()}});var oimo_collision_broadphase_bvh_BvhInsertionStrategy=function(){},oimo_collision_broadphase_bvh_BvhNode=function(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var o=[,,];this._children=o,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0},oimo_collision_broadphase_bvh_BvhProxy=function(o,t){oimo_collision_broadphase_Proxy.call(this,o,t),this._leaf=null,this._moved=!1};oimo_collision_broadphase_bvh_BvhProxy.__super__=oimo_collision_broadphase_Proxy,oimo_collision_broadphase_bvh_BvhProxy.prototype=$extend(oimo_collision_broadphase_Proxy.prototype,{});var oimo_collision_broadphase_bvh_BvhStrategy=function(){this._insertionStrategy=0,this._balancingEnabled=!1};oimo_collision_broadphase_bvh_BvhStrategy.prototype={_decideInsertion:function(z,t){switch(this._insertionStrategy){case 0:var i,W,H;i=t._aabbMinX+t._aabbMaxX,W=t._aabbMinY+t._aabbMaxY,H=t._aabbMinZ+t._aabbMaxZ;var U=z._children[0],c=z._children[1],m,Q,K,$,tt,ot;return m=U._aabbMinX+U._aabbMaxX,Q=U._aabbMinY+U._aabbMaxY,K=U._aabbMinZ+U._aabbMaxZ,$=c._aabbMinX+c._aabbMaxX,tt=c._aabbMinY+c._aabbMaxY,ot=c._aabbMinZ+c._aabbMaxZ,(m-=i)*m+(Q-=W)*Q+(K-=H)*K<($-=i)*$+(tt-=W)*tt+(ot-=H)*ot?0:1;case 1:var at=z._children[0],x=z._children[1],u=z._aabbMaxX-z._aabbMinX,g=z._aabbMaxY-z._aabbMinY,M=z._aabbMaxZ-z._aabbMinZ,X,it,nt,_t,et,rt;X=z._aabbMinX<t._aabbMinX?z._aabbMinX:t._aabbMinX,it=z._aabbMinY<t._aabbMinY?z._aabbMinY:t._aabbMinY,nt=z._aabbMinZ<t._aabbMinZ?z._aabbMinZ:t._aabbMinZ,_t=z._aabbMaxX>t._aabbMaxX?z._aabbMaxX:t._aabbMaxX;var st=(et=z._aabbMaxY>t._aabbMaxY?z._aabbMaxY:t._aabbMaxY)-it,Y=(rt=z._aabbMaxZ>t._aabbMaxZ?z._aabbMaxZ:t._aabbMaxZ)-nt,Z=2*((_t-X)*(st+Y)+st*Y),I=2*Z,V=2*(Z-2*(u*(g+M)+g*M)),L=V;if(X=at._aabbMinX<t._aabbMinX?at._aabbMinX:t._aabbMinX,it=at._aabbMinY<t._aabbMinY?at._aabbMinY:t._aabbMinY,nt=at._aabbMinZ<t._aabbMinZ?at._aabbMinZ:t._aabbMinZ,_t=at._aabbMaxX>t._aabbMaxX?at._aabbMaxX:t._aabbMaxX,et=at._aabbMaxY>t._aabbMaxY?at._aabbMaxY:t._aabbMaxY,rt=at._aabbMaxZ>t._aabbMaxZ?at._aabbMaxZ:t._aabbMaxZ,0==at._height){var lt=et-it,B=rt-nt;L+=2*((_t-X)*(lt+B)+lt*B)}else{var k=_t-X,A=et-it,P=rt-nt,S=at._aabbMaxX-at._aabbMinX,C=at._aabbMaxY-at._aabbMinY,T=at._aabbMaxZ-at._aabbMinZ;L+=2*(k*(A+P)+A*P)-2*(S*(C+T)+C*T)}var j=V;if(X=x._aabbMinX<t._aabbMinX?x._aabbMinX:t._aabbMinX,it=x._aabbMinY<t._aabbMinY?x._aabbMinY:t._aabbMinY,nt=x._aabbMinZ<t._aabbMinZ?x._aabbMinZ:t._aabbMinZ,_t=x._aabbMaxX>t._aabbMaxX?x._aabbMaxX:t._aabbMaxX,et=x._aabbMaxY>t._aabbMaxY?x._aabbMaxY:t._aabbMaxY,rt=x._aabbMaxZ>t._aabbMaxZ?x._aabbMaxZ:t._aabbMaxZ,0==x._height){var ct=et-it,q=rt-nt;j+=2*((_t-X)*(ct+q)+ct*q)}else{var E=_t-X,D=et-it,J=rt-nt,F=x._aabbMaxX-x._aabbMinX,N=x._aabbMaxY-x._aabbMinY,G=x._aabbMaxZ-x._aabbMinZ;j+=2*(E*(D+J)+D*J)-2*(F*(N+G)+N*G)}return I<L?I<j?-1:1:L<j?0:1;default:return console.log("BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1;}},_splitLeaves:function(c,t,i){var o=1/(i-t),_,v,B;_=0,v=0,B=0;for(var k=t,A,P,T,S;k<i;)S=c[k++],S._tmpX=S._aabbMaxX+S._aabbMinX,S._tmpY=S._aabbMaxY+S._aabbMinY,S._tmpZ=S._aabbMaxZ+S._aabbMinZ,_+=S._tmpX,v+=S._tmpY,B+=S._tmpZ;_*=o,v*=o,B*=o,A=0,P=0,T=0;for(var C=t;C<i;){var q=c[C++],d,R,E;d=q._tmpX-_,R=q._tmpY-v,E=q._tmpZ-B,A+=d*=d,P+=R*=R,T+=E*=E}var j=P,x=T,u=t,N=i-1;if(A>j){if(A>x)for(var F=_;;){for(;;){if(c[u]._tmpX<=F)break;++u}for(;;){if(c[N]._tmpX>=F)break;--N}if(u>=N)break;var X=c[u];c[u]=c[N],c[N]=X,++u,--N}else for(var z=B;;){for(;;){if(c[u]._tmpZ<=z)break;++u}for(;;){if(c[N]._tmpZ>=z)break;--N}if(u>=N)break;var Y=c[u];c[u]=c[N],c[N]=Y,++u,--N}}else if(j>x)for(var Z=v;;){for(;;){if(c[u]._tmpY<=Z)break;++u}for(;;){if(c[N]._tmpY>=Z)break;--N}if(u>=N)break;var I=c[u];c[u]=c[N],c[N]=I,++u,--N}else for(var V=B;;){for(;;){if(c[u]._tmpZ<=V)break;++u}for(;;){if(c[N]._tmpZ>=V)break;--N}if(u>=N)break;var L=c[u];c[u]=c[N],c[N]=L,++u,--N}return u}};var oimo_collision_broadphase_bvh_BvhTree=function(){this._root=null,this._numLeaves=0,this._strategy=new oimo_collision_broadphase_bvh_BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null;var o=Array(1024);this.tmp=o};oimo_collision_broadphase_bvh_BvhTree.prototype={_print:function(p,t){if(null==t&&(t=""),null!=p)if(0==p._height)console.log("BvhTree.hx:39:",t+p._proxy._id);else{var m,b,x,d;if(this._print(p._children[0],t+"  "),b=p._aabbMaxX-p._aabbMinX,x=p._aabbMaxY-p._aabbMinY,d=p._aabbMaxZ-p._aabbMinZ,0<b*(x+d)+x*d){var y,f,g;y=p._aabbMaxX-p._aabbMinX,f=p._aabbMaxY-p._aabbMinY,g=p._aabbMaxZ-p._aabbMinZ,m=(0|1e3*(y*(f+g)+f*g)+.5)/1e3}else{var v,X,u;v=p._aabbMaxX-p._aabbMinX,X=p._aabbMaxY-p._aabbMinY,u=p._aabbMaxZ-p._aabbMinZ,m=(0|1e3*(v*(X+u)+X*u)-.5)/1e3}console.log("BvhTree.hx:42:",t+"#"+p._height+", "+m),this._print(p._children[1],t+"  ")}},_getBalance:function(){return this.getBalanceRecursive(this._root)},deleteRecursive:function(a){if(0==a._height){var t=a._prevLeaf,i=a._nextLeaf;return null!=t&&(t._nextLeaf=i),null!=i&&(i._prevLeaf=t),a==this.leafList&&(this.leafList=this.leafList._nextLeaf),a==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),a._nextLeaf=null,a._prevLeaf=null,a._proxy._leaf=null,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,void(this._nodePool=a)}this.deleteRecursive(a._children[0]),this.deleteRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a},decomposeRecursive:function(o){return 0==o._height?(o._childIndex=0,void(o._parent=null)):void(this.decomposeRecursive(o._children[0]),this.decomposeRecursive(o._children[1]),o._next=null,o._childIndex=0,o._children[0]=null,o._children[1]=null,o._childIndex=0,o._parent=null,o._height=0,o._proxy=null,o._next=this._nodePool,this._nodePool=o)},buildTopDownRecursive:function(b,t,i){if(1==i-t){var o=b[t],a=o._proxy;return o._aabbMinX=a._aabbMinX,o._aabbMinY=a._aabbMinY,o._aabbMinZ=a._aabbMinZ,o._aabbMaxX=a._aabbMaxX,o._aabbMaxY=a._aabbMaxY,o._aabbMaxZ=a._aabbMaxZ,o}var n=this._strategy._splitLeaves(b,t,i),s=this.buildTopDownRecursive(b,t,n),_=this.buildTopDownRecursive(b,n,i),r=this._nodePool;null==r?r=new oimo_collision_broadphase_bvh_BvhNode:(this._nodePool=r._next,r._next=null);var x=r;x._children[0]=s,s._parent=x,s._childIndex=0,x._children[1]=_,_._parent=x,_._childIndex=1;var d=x._children[0],l=x._children[1];x._aabbMinX=d._aabbMinX<l._aabbMinX?d._aabbMinX:l._aabbMinX,x._aabbMinY=d._aabbMinY<l._aabbMinY?d._aabbMinY:l._aabbMinY,x._aabbMinZ=d._aabbMinZ<l._aabbMinZ?d._aabbMinZ:l._aabbMinZ,x._aabbMaxX=d._aabbMaxX>l._aabbMaxX?d._aabbMaxX:l._aabbMaxX,x._aabbMaxY=d._aabbMaxY>l._aabbMaxY?d._aabbMaxY:l._aabbMaxY,x._aabbMaxZ=d._aabbMaxZ>l._aabbMaxZ?d._aabbMaxZ:l._aabbMaxZ;var c=x._children[0]._height,m=x._children[1]._height;return x._height=(c>m?c:m)+1,x},getBalanceRecursive:function(o){if(null==o||0==o._height)return 0;var t=o._children[0]._height-o._children[1]._height;return 0>t&&(t=-t),t+this.getBalanceRecursive(o._children[0])+this.getBalanceRecursive(o._children[1])}};var oimo_collision_geometry_Aabb=function(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0};oimo_collision_geometry_Aabb.prototype={init:function(n,t){var i=n;this._minX=i.x,this._minY=i.y,this._minZ=i.z;var o=t;return this._maxX=o.x,this._maxY=o.y,this._maxZ=o.z,this},getMin:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,o},getMinTo:function(o){var t=o;t.x=this._minX,t.y=this._minY,t.z=this._minZ},setMin:function(o){var t=o;return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this},getMax:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,o},getMaxTo:function(o){var t=o;t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ},setMax:function(o){var t=o;return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this},getCenter:function(){var _=new oimo_common_Vec3,a,e,r;a=this._minX+this._maxX,e=this._minY+this._maxY,r=this._minZ+this._maxZ,a*=.5,e*=.5,r*=.5;var s=_;return s.x=a,s.y=e,s.z=r,_},getCenterTo:function(_){var t,e,r;t=this._minX+this._maxX,e=this._minY+this._maxY,r=this._minZ+this._maxZ,t*=.5,e*=.5,r*=.5;var s=_;s.x=t,s.y=e,s.z=r},getExtents:function(){var _=new oimo_common_Vec3,a,e,r;a=this._maxX-this._minX,e=this._maxY-this._minY,r=this._maxZ-this._minZ,a*=.5,e*=.5,r*=.5;var s=_;return s.x=a,s.y=e,s.z=r,_},getExtentsTo:function(_){var t,e,r;t=this._maxX-this._minX,e=this._maxY-this._minY,r=this._maxZ-this._minZ,t*=.5,e*=.5,r*=.5;var s=_;s.x=t,s.y=e,s.z=r},combine:function(o){return this._minX=this._minX<o._minX?this._minX:o._minX,this._minY=this._minY<o._minY?this._minY:o._minY,this._minZ=this._minZ<o._minZ?this._minZ:o._minZ,this._maxX=this._maxX>o._maxX?this._maxX:o._maxX,this._maxY=this._maxY>o._maxY?this._maxY:o._maxY,this._maxZ=this._maxZ>o._maxZ?this._maxZ:o._maxZ,this},combined:function(o){var t=new oimo_collision_geometry_Aabb;return t._minX=this._minX<o._minX?this._minX:o._minX,t._minY=this._minY<o._minY?this._minY:o._minY,t._minZ=this._minZ<o._minZ?this._minZ:o._minZ,t._maxX=this._maxX>o._maxX?this._maxX:o._maxX,t._maxY=this._maxY>o._maxY?this._maxY:o._maxY,t._maxZ=this._maxZ>o._maxZ?this._maxZ:o._maxZ,t},overlap:function(o){return this._minX<o._maxX&&this._maxX>o._minX&&this._minY<o._maxY&&this._maxY>o._minY&&this._minZ<o._maxZ&&this._maxZ>o._minZ},getIntersection:function(o){var t=new oimo_collision_geometry_Aabb;return t._minX=this._minX>o._minX?this._minX:o._minX,t._minY=this._minY>o._minY?this._minY:o._minY,t._minZ=this._minZ>o._minZ?this._minZ:o._minZ,t._maxX=this._maxX<o._maxX?this._maxX:o._maxX,t._maxY=this._maxY<o._maxY?this._maxY:o._maxY,t._maxZ=this._maxZ<o._maxZ?this._maxZ:o._maxZ,t},getIntersectionTo:function(o,t){t._minX=this._minX>o._minX?this._minX:o._minX,t._minY=this._minY>o._minY?this._minY:o._minY,t._minZ=this._minZ>o._minZ?this._minZ:o._minZ,t._maxX=this._maxX<o._maxX?this._maxX:o._maxX,t._maxY=this._maxY<o._maxY?this._maxY:o._maxY,t._maxZ=this._maxZ<o._maxZ?this._maxZ:o._maxZ},copyFrom:function(o){return this._minX=o._minX,this._minY=o._minY,this._minZ=o._minZ,this._maxX=o._maxX,this._maxY=o._maxY,this._maxZ=o._maxZ,this},clone:function(){var o=new oimo_collision_geometry_Aabb;return o._minX=this._minX,o._minY=this._minY,o._minZ=this._minZ,o._maxX=this._maxX,o._maxY=this._maxY,o._maxZ=this._maxZ,o}};var oimo_collision_geometry_BoxGeometry=function(a){oimo_collision_geometry_ConvexGeometry.call(this,1);var t=a;this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=a.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=a.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=a.z,this._updateMass();var i=a.x<a.y?a.z<a.x?a.z:a.x:a.z<a.y?a.z:a.y;this._gjkMargin>.2*i&&(this._gjkMargin=.2*i)};oimo_collision_geometry_BoxGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_geometry_BoxGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{getHalfExtents:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,o},getHalfExtentsTo:function(o){var t=o;t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ},_updateMass:function(){var a,n,_;this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ),a=this._halfExtentsX*this._halfExtentsX,n=this._halfExtentsY*this._halfExtentsY,_=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(n+_),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(_+a),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(a+n)},_computeAabb:function(b,t){var i,x,d,y,f,g,X,u,z,Y,Z,I,M;Y=t._rotation00*this._halfAxisXX+t._rotation01*this._halfAxisXY+t._rotation02*this._halfAxisXZ,x=t._rotation10*this._halfAxisXX+t._rotation11*this._halfAxisXY+t._rotation12*this._halfAxisXZ,d=t._rotation20*this._halfAxisXX+t._rotation21*this._halfAxisXY+t._rotation22*this._halfAxisXZ,Z=(i=0>(i=Y)?-i:i)+(y=0>(y=t._rotation00*this._halfAxisYX+t._rotation01*this._halfAxisYY+t._rotation02*this._halfAxisYZ)?-y:y),I=(x=0>x?-x:x)+(f=0>(f=t._rotation10*this._halfAxisYX+t._rotation11*this._halfAxisYY+t._rotation12*this._halfAxisYZ)?-f:f),M=(d=0>d?-d:d)+(g=0>(g=t._rotation20*this._halfAxisYX+t._rotation21*this._halfAxisYY+t._rotation22*this._halfAxisYZ)?-g:g),Z+=X=0>(X=t._rotation00*this._halfAxisZX+t._rotation01*this._halfAxisZY+t._rotation02*this._halfAxisZZ)?-X:X,I+=u=0>(u=t._rotation10*this._halfAxisZX+t._rotation11*this._halfAxisZY+t._rotation12*this._halfAxisZZ)?-u:u,M+=z=0>(z=t._rotation20*this._halfAxisZX+t._rotation21*this._halfAxisZY+t._rotation22*this._halfAxisZZ)?-z:z,b._minX=t._positionX-Z,b._minY=t._positionY-I,b._minZ=t._positionZ-M,b._maxX=t._positionX+Z,b._maxY=t._positionY+I,b._maxZ=t._positionZ+M},computeLocalSupportingVertex:function(e,t){var i,l,c,p,m,b;i=this._gjkMargin,l=this._gjkMargin,c=this._gjkMargin,i=i<this._halfExtentsX?i:this._halfExtentsX,l=l<this._halfExtentsY?l:this._halfExtentsY,c=c<this._halfExtentsZ?c:this._halfExtentsZ,p=this._halfExtentsX-i,m=this._halfExtentsY-l,b=this._halfExtentsZ-c,t.x=0<e.x?p:-p,t.y=0<e.y?m:-m,t.z=0<e.z?b:-b},_rayCastLocal:function(l,t,i,o,a,n,s){var _=l,r=t,e=i,c=this._halfExtentsX,p=this._halfExtentsY,m=this._halfExtentsZ,y=o-_,b=a-r,f=n-e,d=0,v=0,h=0,q=1,E=1,N=1;if(!(-1e-6<y&&1e-6>y)){var F=1/y,Y=(-c-_)*F,D=(c-_)*F;if(Y>D){var W=Y;Y=D,D=W}0<Y&&(d=Y),1>D&&(q=D)}else if(_<=-c||_>=c)return!1;if(!(-1e-6<b&&1e-6>b)){var V=1/b,L=(-p-r)*V,G=(p-r)*V;if(L>G){var O=L;L=G,G=O}0<L&&(v=L),1>G&&(E=G)}else if(r<=-p||r>=p)return!1;if(!(-1e-6<f&&1e-6>f)){var k=1/f,A=(-m-e)*k,H=(m-e)*k;if(A>H){var J=A;A=H,H=J}0<A&&(h=A),1>H&&(N=H)}else if(e<=-m||e>=m)return!1;if(1<=d||1<=v||1<=h||0>=q||0>=E||0>=N)return!1;var C=d,U=q,Q=0;return(v>C&&(C=v,Q=1),h>C&&(C=h,Q=2),E<U&&(U=E),N<U&&(U=N),!(C>U))&&0!=C&&(0==Q?s.normal.init(0<y?-1:1,0,0):1===Q?s.normal.init(0,0<b?-1:1,0):2===Q?s.normal.init(0,0,0<f?-1:1):void 0,s.position.init(_+C*y,r+C*b,e+C*f),s.fraction=C,!0)}});var oimo_collision_geometry_CapsuleGeometry=function(o,t){oimo_collision_geometry_ConvexGeometry.call(this,4),this._radius=o,this._halfHeight=t,this._gjkMargin=this._radius,this._updateMass()};oimo_collision_geometry_CapsuleGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_geometry_CapsuleGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var e=this._radius*this._radius,t=this._halfHeight*this._halfHeight,i=6.28318530717958*e*this._halfHeight,o=4*(3.14159265358979*e*this._radius)/3;this._volume=i+o;var a=0==this._volume?0:1/this._volume,n=a*(i*(.25*e+t/3)+o*(.4*e+.75*(this._halfHeight*this._radius)+t));this._inertiaCoeff00=n,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=a*(.5*(i*e)+.4*(o*e)),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=n},_computeAabb:function(e,t){var i,l,c,p,m,b;i=this._radius,l=this._radius,c=this._radius,p=0>(p=t._rotation01)?-p:p,m=0>(m=t._rotation11)?-m:m,b=0>(b=t._rotation21)?-b:b,i+=p*=this._halfHeight,l+=m*=this._halfHeight,c+=b*=this._halfHeight,e._minX=t._positionX-i,e._minY=t._positionY-l,e._minZ=t._positionZ-c,e._maxX=t._positionX+i,e._maxY=t._positionY+l,e._maxZ=t._positionZ+c},computeLocalSupportingVertex:function(o,t){0<o.y?t.init(0,this._halfHeight,0):t.init(0,-this._halfHeight,0)},_rayCastLocal:function(l,t,i,o,a,n,s){var _=l,r=t,e=i,c=this._halfHeight,p=o-_,m=n-e,b=0,y=1,v=p*p+m*m,h=_*p+e*m,W=_*_+e*e-this._radius*this._radius,H=h*h-v*W;if(0>H)return!1;if(0<v){var U=Math.sqrt(H);if(y=(-h+U)/v,1<=(b=(-h-U)/v)||0>=y)return!1}else{if(0<=W)return!1;b=0,y=1}var X=r+(a-r)*b,k,Q,K,$,tt,ot,at,it;if(X>-c&&X<c){if(0<b){k=b;var nt=s.normal.init(_+p*k,0,e+m*k),A=Math.sqrt(nt.x*nt.x+nt.y*nt.y+nt.z*nt.z);0<A&&(A=1/A);var _t=nt.x*A,S=nt.y*A,C=nt.z*A;return nt.x=_t,nt.y=S,nt.z=C,s.position.init(_+k*p,X,e+k*m),s.fraction=k,!0}return!1}if(0,0,0>(H=(h=(K=l-0)*(ot=o-l)+($=t-(Q=0>X?-c:c))*(at=a-t)+(tt=i-0)*(it=n-i))*h-(v=ot*ot+at*at+it*it)*(W=K*K+$*$+tt*tt-this._radius*this._radius)))return!1;var T=(-h-Math.sqrt(H))/v,F,et,rt,st,lt,ct;if(0>T||1<T)return!1;var pt=(F=K+ot*T)*F+(et=$+at*T)*et+(rt=tt+it*T)*rt;0<pt&&(pt=1/Math.sqrt(pt)),st=F*pt,lt=et*pt,ct=rt*pt,F+=0,et+=Q,rt+=0;var mt=s.position;mt.x=F,mt.y=et,mt.z=rt;var G=s.normal;return G.x=st,G.y=lt,G.z=ct,s.fraction=T,!0}});var oimo_collision_geometry_ConeGeometry=function(o,t){oimo_collision_geometry_ConvexGeometry.call(this,3),this._radius=o,this._halfHeight=t,this.sinTheta=o/Math.sqrt(o*o+4*t*t),this.cosTheta=2*t/Math.sqrt(o*o+4*t*t),this._updateMass()};oimo_collision_geometry_ConeGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_geometry_ConeGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var o=this._radius*this._radius,t=4*(this._halfHeight*this._halfHeight);this._volume=2*(3.14159265358979*o*this._halfHeight)/3,this._inertiaCoeff00=.05*(3*o+2*t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*o,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*o+2*t)},_computeAabb:function(Z,t){var i=(Y=t._rotation01)*Y,X=(I=t._rotation11)*I,z=(V=t._rotation21)*V,Y,I,V,L,B,k,A,P,T,w,S,C,q,R,E,j,N,F,D,W,G;A=Math.sqrt(1-i),P=Math.sqrt(1-X),T=Math.sqrt(1-z),A*=this._radius,P*=this._radius,T*=this._radius,w=-(L=Y*this._halfHeight),S=-(B=I*this._halfHeight),C=-(k=V*this._halfHeight),q=-L,R=-B,E=-k,j=(j=(w-=A)>(q+=A)?w:q)>L?j:L,N=(N=(S-=P)>(R+=P)?S:R)>B?N:B,F=(F=(C-=T)>(E+=T)?C:E)>k?F:k,D=(D=w<q?w:q)<L?D:L,W=(W=S<R?S:R)<B?W:B,G=(G=C<E?C:E)<k?G:k,Z._minX=t._positionX+D,Z._minY=t._positionY+W,Z._minZ=t._positionZ+G,Z._maxX=t._positionX+j,Z._maxY=t._positionY+N,Z._maxZ=t._positionZ+F},computeLocalSupportingVertex:function(p,t){var i=p.x,o=p.y,a=p.z;if(0<o&&o*o>this.sinTheta*this.sinTheta*(i*i+o*o+a*a))return t.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(0>t.y&&(t.y=0));var n=p.x,s=p.z,_=n*n+s*s,r=2*this._halfHeight,e=(r-this._gjkMargin)/r*this._radius-this._gjkMargin/this.cosTheta;0>e&&(e=0);var m=0<_?e/Math.sqrt(_):0,l=this._halfHeight-this._gjkMargin;0>l&&(l=0),t.x=n*m,t.y=-l,t.z=s*m},_rayCastLocal:function(l,t,i,o,a,n,s){var _=l,r=t,c=i,m=this._halfHeight,p=o-_,v=a-r,y=n-c,b=0,h=1;if(!(-1e-6<v&&1e-6>v)){var N=1/v,x=(-m-r)*N,F=(m-r)*N;if(x>F){var W=x;x=F,F=W}0<x&&(b=x),1>F&&(h=F)}else if(r<=-m||r>=m)return!1;if(1<=b||0>=h)return!1;var M=0,G=0;r-=m;var O=this.cosTheta*this.cosTheta,Z=O*(p*p+v*v+y*y)-v*v,I=O*(_*p+r*v+c*y)-r*v,V=O*(_*_+r*r+c*c)-r*r,L=I*I-Z*V,w;if(0!=Z){if(0>L)return!1;var H=Math.sqrt(L);if(0>Z){if(0<v){if(M=0,0>=(G=(-I+H)/Z))return!1;}else if(G=1,1<=(M=(-I-H)/Z))return!1;}else if(G=(-I+H)/Z,1<=(M=(-I-H)/Z)||0>=G)return!1}else{var B=-V/(2*I);if(0<I){if(M=0,G=B,0>=B)return!1;}else if(M=B,G=1,1<=B)return!1}if(r+=m,G<=b||h<=M)return!1;if(M<b){if(0==(w=b))return!1;s.normal.init(0,0<v?-1:1,0)}else{if(0==(w=M))return!1;var k=s.normal.init(_+p*w,0,c+y*w),A=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);0<A&&(A=1/A);var J=k.x*A,S=k.y*A,C=k.z*A;k.x=J,k.y=S,k.z=C;var T=k,j=this.cosTheta,R=T.x*j,q=T.y*j,E=T.z*j;T.x=R,T.y=q,T.z=E,s.normal.y+=this.sinTheta}return s.position.init(_+w*p,r+w*v,c+w*y),s.fraction=w,!0}});var oimo_collision_geometry_ConvexHullGeometry=function(e){oimo_collision_geometry_ConvexGeometry.call(this,5),this._numVertices=e.length;var t=this._numVertices,i=Array(t);this._vertices=i;var o=this._numVertices,a=Array(o);this._tmpVertices=a;for(var n=0,l=this._numVertices,_;n<l;)_=n++,this._vertices[_]=e[_],this._tmpVertices[_]=new oimo_common_Vec3;this._useGjkRayCast=!0,this._updateMass()};oimo_collision_geometry_ConvexHullGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_geometry_ConvexHullGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{getVertices:function(){return this._vertices},_updateMass:function(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var b=this._vertices[0].x,x=this._vertices[0].y,d=this._vertices[0].z,f=this._vertices[0].x,g=this._vertices[0].y,X=this._vertices[0].z,u=1,z=this._numVertices;u<z;){var r=u++,e=this._vertices[r].x,Y=this._vertices[r].y,l=this._vertices[r].z;e<b?b=e:e>f&&(f=e),Y<x?x=Y:Y>g&&(g=Y),l<d?d=l:l>X&&(X=l)}var c=f-b,Z=g-x,I=X-d;this._volume=c*Z*I;var M=.25*((b+f)*(b+f)+(x+g)*(x+g)+(d+X)*(d+X));c=.25*(c*c),Z=.25*(Z*Z),I=.25*(I*I),this._inertiaCoeff00=.3333333333333333*(Z+I)+M,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(I+c)+M,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(c+Z)+M},_computeAabb:function(X,t){var i,z,Y,Z,I,M,V,L,B,k,A,P;V=this._gjkMargin,L=this._gjkMargin,B=this._gjkMargin;var T=this._vertices[0],f,w,S;k=T.x,A=T.y,P=T.z,f=t._rotation00*k+t._rotation01*A+t._rotation02*P,w=t._rotation10*k+t._rotation11*A+t._rotation12*P,S=t._rotation20*k+t._rotation21*A+t._rotation22*P,i=f+=t._positionX,z=w+=t._positionY,Y=S+=t._positionZ,Z=f,I=w,M=S;for(var C=1,q=this._numVertices;C<q;){var x=C++,u=this._vertices[x];k=u.x,A=u.y,P=u.z,f=t._rotation00*k+t._rotation01*A+t._rotation02*P,w=t._rotation10*k+t._rotation11*A+t._rotation12*P,S=t._rotation20*k+t._rotation21*A+t._rotation22*P,i=i<(f+=t._positionX)?i:f,z=z<(w+=t._positionY)?z:w,Y=Y<(S+=t._positionZ)?Y:S,Z=Z>f?Z:f,I=I>w?I:w,M=M>S?M:S}X._minX=i-V,X._minY=z-L,X._minZ=Y-B,X._maxX=Z+V,X._maxY=I+L,X._maxZ=M+B},computeLocalSupportingVertex:function(c,t){for(var i=this._vertices[0],o=i.x*c.x+i.y*c.y+i.z*c.z,p=0,m=1,b=this._numVertices;m<b;){var _=m++,r=this._vertices[_],e=r.x*c.x+r.y*c.y+r.z*c.z;e>o&&(o=e,p=_)}var x=this._vertices[p];t.x=x.x,t.y=x.y,t.z=x.z}});var oimo_collision_geometry_CylinderGeometry=function(o,t){oimo_collision_geometry_ConvexGeometry.call(this,2),this._radius=o,this._halfHeight=t,this._updateMass()};oimo_collision_geometry_CylinderGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_geometry_CylinderGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var o=this._radius*this._radius,t=4*(this._halfHeight*this._halfHeight);this._volume=2*(3.14159265358979*o*this._halfHeight),this._inertiaCoeff00=.08333333333333333*(3*o+t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*o,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*o+t)},_computeAabb:function(b,t){var i=(p=0>(p=t._rotation01)?-p:p)*p,c=(x=0>(x=t._rotation11)?-x:x)*x,m=(d=0>(d=t._rotation21)?-d:d)*d,p,x,d,y,f,g,v,X,u;y=Math.sqrt(1-i),f=Math.sqrt(1-c),g=Math.sqrt(1-m),y*=this._radius,f*=this._radius,g*=this._radius,v=y+p*this._halfHeight,X=f+x*this._halfHeight,u=g+d*this._halfHeight,b._minX=t._positionX-v,b._minY=t._positionY-X,b._minZ=t._positionZ-u,b._maxX=t._positionX+v,b._maxY=t._positionY+X,b._maxZ=t._positionZ+u},computeLocalSupportingVertex:function(e,t){var i=e.x,o=e.z,a=i*i+o*o,n=this._radius-this._gjkMargin;0>n&&(n=0);var l=0<a?n/Math.sqrt(a):0,_=this._halfHeight-this._gjkMargin;0>_&&(_=0),t.x=i*l,t.y=0<e.y?_:-_,t.z=o*l},_rayCastLocal:function(l,t,i,o,a,n,s){var _=l,r=t,e=i,c=this._halfHeight,p=o-_,m=a-r,y=n-e,b=0,v=1;if(!(-1e-6<m&&1e-6>m)){var h=1/m,x=(-c-r)*h,T=(c-r)*h;if(x>T){var C=x;x=T,T=C}0<x&&(b=x),1>T&&(v=T)}else if(r<=-c||r>=c)return!1;if(1<=b||0>=v)return!1;var M=0,q=1,R=p*p+y*y,Z=_*p+e*y,I=_*_+e*e-this._radius*this._radius,V=Z*Z-R*I,L;if(0>V)return!1;if(0<R){var E=Math.sqrt(V);if(q=(-Z+E)/R,1<=(M=(-Z-E)/R)||0>=q)return!1}else{if(0<=I)return!1;M=0,q=1}if(q<=b||v<=M)return!1;if(M<b){if(0==(L=b))return!1;s.normal.init(0,0<m?-1:1,0)}else{if(0==(L=M))return!1;var w=s.normal.init(_+p*L,0,e+y*L),B=Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z);0<B&&(B=1/B);var j=w.x*B,A=w.y*B,P=w.z*B;w.x=j,w.y=A,w.z=P}return s.position.init(_+L*p,r+L*m,e+L*y),s.fraction=L,!0}});var oimo_collision_geometry_GeometryType=function(){},oimo_collision_geometry_RayCastHit=function(){this.position=new oimo_common_Vec3,this.normal=new oimo_common_Vec3,this.fraction=0},oimo_collision_geometry_SphereGeometry=function(o){oimo_collision_geometry_ConvexGeometry.call(this,0),this._radius=o,this._gjkMargin=this._radius,this._updateMass()};oimo_collision_geometry_SphereGeometry.__super__=oimo_collision_geometry_ConvexGeometry,oimo_collision_geometry_SphereGeometry.prototype=$extend(oimo_collision_geometry_ConvexGeometry.prototype,{getRadius:function(){return this._radius},_updateMass:function(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius},_computeAabb:function(_,t){var i,e,r;i=this._radius,e=this._radius,r=this._radius,_._minX=t._positionX-i,_._minY=t._positionY-e,_._minZ=t._positionZ-r,_._maxX=t._positionX+i,_._maxY=t._positionY+e,_._maxZ=t._positionZ+r},computeLocalSupportingVertex:function(o,t){t.zero()},_rayCastLocal:function(X,t,i,o,a,n,s){var _=(m=o-X)*m+(z=a-t)*z+(Y=n-i)*Y,l=X*m+t*z+i*Y,c=l*l-_*(X*X+t*t+i*i-this._radius*this._radius),m,z,Y;if(0>c)return!1;var Z=(-l-Math.sqrt(c))/_,x,I,V,L,B,k;if(0>Z||1<Z)return!1;var A=(x=X+m*Z)*x+(I=t+z*Z)*I+(V=i+Y*Z)*V;0<A&&(A=1/Math.sqrt(A)),L=x*A,B=I*A,k=V*A;var P=s.position;P.x=x,P.y=I,P.z=V;var g=s.normal;return g.x=L,g.y=B,g.z=k,s.fraction=Z,!0}});var oimo_collision_narrowphase_CollisionMatrix=function(){var _=Array(8);this.detectors=_;for(var t=0;6>t;){var e=t++,o=this.detectors,a=Array(8);o[e]=a}var n=new oimo_collision_narrowphase_detector_GjkEpaDetector;this.detectors[0][0]=new oimo_collision_narrowphase_detector_SphereSphereDetector,this.detectors[0][1]=new oimo_collision_narrowphase_detector_SphereBoxDetector(!1),this.detectors[0][2]=n,this.detectors[0][3]=n,this.detectors[0][4]=new oimo_collision_narrowphase_detector_SphereCapsuleDetector(!1),this.detectors[0][5]=n,this.detectors[1][0]=new oimo_collision_narrowphase_detector_SphereBoxDetector(!0),this.detectors[1][1]=new oimo_collision_narrowphase_detector_BoxBoxDetector,this.detectors[1][2]=n,this.detectors[1][3]=n,this.detectors[1][4]=n,this.detectors[1][5]=n,this.detectors[2][0]=n,this.detectors[2][1]=n,this.detectors[2][2]=n,this.detectors[2][3]=n,this.detectors[2][4]=n,this.detectors[2][5]=n,this.detectors[3][0]=n,this.detectors[3][1]=n,this.detectors[3][2]=n,this.detectors[3][3]=n,this.detectors[3][4]=n,this.detectors[3][5]=n,this.detectors[4][0]=new oimo_collision_narrowphase_detector_SphereCapsuleDetector(!0),this.detectors[4][1]=n,this.detectors[4][2]=n,this.detectors[4][3]=n,this.detectors[4][4]=new oimo_collision_narrowphase_detector_CapsuleCapsuleDetector,this.detectors[4][5]=n,this.detectors[5][0]=n,this.detectors[5][1]=n,this.detectors[5][2]=n,this.detectors[5][3]=n,this.detectors[5][4]=n,this.detectors[5][5]=n};oimo_collision_narrowphase_CollisionMatrix.prototype={getDetector:function(o,t){return this.detectors[o][t]}};var oimo_collision_narrowphase_DetectorResult=function(){this.numPoints=0,this.normal=new oimo_common_Vec3;var _=oimo_common_Setting.maxManifoldPoints,t=Array(_);this.points=t,this.incremental=!1;for(var i=0,e=oimo_common_Setting.maxManifoldPoints,a;i<e;)a=i++,this.points[a]=new oimo_collision_narrowphase_DetectorResultPoint};oimo_collision_narrowphase_DetectorResult.prototype={getMaxDepth:function(){for(var n=0,_=0,e=this.numPoints,o;_<e;)o=_++,this.points[o].depth>n&&(n=this.points[o].depth);return n},clear:function(){this.numPoints=0;for(var a=0,n=this.points,i;a<n.length;)i=n[a],++a,i.position1.zero(),i.position2.zero(),i.depth=0,i.id=0;this.normal.zero()}};var oimo_collision_narrowphase_DetectorResultPoint=function(){this.position1=new oimo_common_Vec3,this.position2=new oimo_common_Vec3,this.depth=0,this.id=0},oimo_collision_narrowphase_detector_Detector=function(o){this.swapped=o};oimo_collision_narrowphase_detector_Detector.prototype={setNormal:function(l,t,i,o){var a=l.normal;if(a.x=t,a.y=i,a.z=o,this.swapped){var n=l.normal,s=-n.x,_=-n.y,r=-n.z;n.x=s,n.y=_,n.z=r}},addPoint:function(b,t,i,o,a,n,s,_,r){var e=b.points[b.numPoints++];if(e.depth=_,e.id=r,this.swapped){var x=e.position1;x.x=a,x.y=n,x.z=s;var l=e.position2;l.x=t,l.y=i,l.z=o}else{var c=e.position1;c.x=t,c.y=i,c.z=o;var m=e.position2;m.x=a,m.y=n,m.z=s}},detectImpl:function(){},detect:function(l,t,i,o,a,n){l.numPoints=0;for(var s=0,c=l.points,r;s<c.length;)r=c[s],++s,r.position1.zero(),r.position2.zero(),r.depth=0,r.id=0;l.normal.zero(),this.swapped?this.detectImpl(l,i,t,a,o,n):this.detectImpl(l,t,i,o,a,n)}};var oimo_collision_narrowphase_detector_BoxBoxDetector=function(){oimo_collision_narrowphase_detector_Detector.call(this,!1),this.clipper=new oimo_collision_narrowphase_detector__$BoxBoxDetector_FaceClipper};oimo_collision_narrowphase_detector_BoxBoxDetector.__super__=oimo_collision_narrowphase_detector_Detector,oimo_collision_narrowphase_detector_BoxBoxDetector.prototype=$extend(oimo_collision_narrowphase_detector_Detector.prototype,{detectImpl:function(s,t,i,o,a){var n=t,Yn=i,Zn,In,Vn,Ln,Bn,kn,An,Pn,Tn,wn,Sn,Cn,qn,Rn,En,jn,Nn,Fn,Dn,Wn,Gn,On,Hn,Jn,Un,Qn,Kn;s.incremental=!1,Zn=o._positionX,In=o._positionY,Vn=o._positionZ,An=(Ln=a._positionX)-Zn,Pn=(Bn=a._positionY)-In,Tn=(kn=a._positionZ)-Vn,wn=o._rotation00,Sn=o._rotation10,Cn=o._rotation20,qn=o._rotation01,Rn=o._rotation11,En=o._rotation21,jn=o._rotation02,Nn=o._rotation12,Fn=o._rotation22,Dn=a._rotation00,Wn=a._rotation10,Gn=a._rotation20,On=a._rotation01,Hn=a._rotation11,Jn=a._rotation21,Un=a._rotation02,Qn=a._rotation12,Kn=a._rotation22;var $n=n._halfExtentsX,t_=n._halfExtentsY,o_=n._halfExtentsZ,a_=Yn._halfExtentsX,i_=Yn._halfExtentsY,n_=Yn._halfExtentsZ,__,e_,r_,s_,l_,c_,p_,m_,b_,x_,d_,y_,f_,g_,v_,X_,u_,z_;__=wn*$n,e_=Sn*$n,r_=Cn*$n,s_=qn*t_,l_=Rn*t_,c_=En*t_,p_=jn*o_,m_=Nn*o_,b_=Fn*o_;var Y_=1/0,Z_=-1,I_=0,M_,h_,V_;M_=0,h_=0,V_=0;var L_=$n,B_=wn*(x_=Dn*a_)+Sn*(d_=Wn*a_)+Cn*(y_=Gn*a_),k_=wn*(f_=On*i_)+Sn*(g_=Hn*i_)+Cn*(v_=Jn*i_),A_=wn*(X_=Un*n_)+Sn*(u_=Qn*n_)+Cn*(z_=Kn*n_);0>B_&&(B_=-B_),0>k_&&(k_=-k_),0>A_&&(A_=-A_);var P_=B_+k_+A_,T_=wn*An+Sn*Pn+Cn*Tn,w_=L_+P_,ft=0>T_,dt=ft?-T_:T_;if(dt<w_){var xt=w_-dt;xt<Y_&&(Y_=xt,Z_=0,M_=wn,h_=Sn,V_=Cn,I_=ft?-1:1);var ut=qn*x_+Rn*d_+En*y_,S_=qn*f_+Rn*g_+En*v_,C_=qn*X_+Rn*u_+En*z_;0>ut&&(ut=-ut),0>S_&&(S_=-S_),0>C_&&(C_=-C_);var q_=(L_=t_)+(P_=ut+S_+C_),zt=0>(T_=qn*An+Rn*Pn+En*Tn),Yt=zt?-T_:T_;if(Yt<q_){var Zt=q_-Yt;Zt<Y_&&(Y_=Zt,Z_=1,M_=qn,h_=Rn,V_=En,I_=zt?-1:1);var It=jn*x_+Nn*d_+Fn*y_,R_=jn*f_+Nn*g_+Fn*v_,E_=jn*X_+Nn*u_+Fn*z_;0>It&&(It=-It),0>R_&&(R_=-R_),0>E_&&(E_=-E_);var j_=(L_=o_)+(P_=It+R_+E_),Bt=0>(T_=jn*An+Nn*Pn+Fn*Tn),kt=Bt?-T_:T_;if(kt<j_){var At=j_-kt;At<Y_&&(Y_=At,Z_=2,M_=jn,h_=Nn,V_=Fn,I_=Bt?-1:1),Y_>oimo_common_Setting.linearSlop?Y_-=oimo_common_Setting.linearSlop:Y_=0;var Pt=Dn*__+Wn*e_+Gn*r_,N_=Dn*s_+Wn*l_+Gn*c_,F_=Dn*p_+Wn*m_+Gn*b_;0>Pt&&(Pt=-Pt),0>N_&&(N_=-N_),0>F_&&(F_=-F_);var D_=(L_=Pt+N_+F_)+(P_=a_),jt=0>(T_=Dn*An+Wn*Pn+Gn*Tn),Rt=jt?-T_:T_;if(Rt<D_){var qt=D_-Rt;qt<Y_&&(Y_=qt,Z_=3,M_=Dn,h_=Wn,V_=Gn,I_=jt?-1:1);var Et=On*__+Hn*e_+Jn*r_,W_=On*s_+Hn*l_+Jn*c_,G_=On*p_+Hn*m_+Jn*b_;0>Et&&(Et=-Et),0>W_&&(W_=-W_),0>G_&&(G_=-G_);var O_=(L_=Et+W_+G_)+(P_=i_),Nt=0>(T_=On*An+Hn*Pn+Jn*Tn),Gt=Nt?-T_:T_;if(Gt<O_){var Ot=O_-Gt;Ot<Y_&&(Y_=Ot,Z_=4,M_=On,h_=Hn,V_=Jn,I_=Nt?-1:1);var Wt=Un*__+Qn*e_+Kn*r_,H_=Un*s_+Qn*l_+Kn*c_,J_=Un*p_+Qn*m_+Kn*b_;0>Wt&&(Wt=-Wt),0>H_&&(H_=-H_),0>J_&&(J_=-J_);var U_=(L_=Wt+H_+J_)+(P_=n_),$t=0>(T_=Un*An+Qn*Pn+Kn*Tn),Kt=$t?-T_:T_;if(Kt<U_){var ti=U_-Kt,Mi,Q_,K_,$_,te,oe,ae,ie,ne,_e,ee,re,se,le,ce,pe,me,be,xe,de,ye;if(ti<Y_&&(Y_=ti,Z_=5,M_=Un,h_=Qn,V_=Kn,I_=$t?-1:1),Y_>oimo_common_Setting.linearSlop?Y_-=oimo_common_Setting.linearSlop:Y_=0,Q_=Cn*Dn-wn*Gn,K_=wn*Wn-Sn*Dn,0!=(Mi=Sn*Gn-Cn*Wn)||0!=Q_||0!=K_){var fe=Mi*Mi+Q_*Q_+K_*K_;0<fe&&(fe=1/Math.sqrt(fe));var ge=(Mi*=fe)*s_+(Q_*=fe)*l_+(K_*=fe)*c_,ve=Mi*p_+Q_*m_+K_*b_;0>ge&&(ge=-ge),0>ve&&(ve=-ve);var Xe=Mi*f_+Q_*g_+K_*v_,ue=Mi*X_+Q_*u_+K_*z_;0>Xe&&(Xe=-Xe),0>ue&&(ue=-ue);var ze=(L_=ge+ve)+(P_=Xe+ue),Vi=0>(T_=Mi*An+Q_*Pn+K_*Tn),Li=Vi?-T_:T_;if(!(Li<ze))return;var wi=ze-Li;wi<Y_&&(Y_=wi,Z_=6,M_=Mi,h_=Q_,V_=K_,I_=Vi?-1:1)}if(Q_=Cn*On-wn*Jn,K_=wn*Hn-Sn*On,0!=(Mi=Sn*Jn-Cn*Hn)||0!=Q_||0!=K_){var Bi=Mi*Mi+Q_*Q_+K_*K_;0<Bi&&(Bi=1/Math.sqrt(Bi));var Ye=(Mi*=Bi)*s_+(Q_*=Bi)*l_+(K_*=Bi)*c_,Ze=Mi*p_+Q_*m_+K_*b_;0>Ye&&(Ye=-Ye),0>Ze&&(Ze=-Ze);var Ie=Mi*x_+Q_*d_+K_*y_,Me=Mi*X_+Q_*u_+K_*z_;0>Ie&&(Ie=-Ie),0>Me&&(Me=-Me);var he=(L_=Ye+Ze)+(P_=Ie+Me),Ti=0>(T_=Mi*An+Q_*Pn+K_*Tn),ji=Ti?-T_:T_;if(!(ji<he))return;var Ri=he-ji;Ri<Y_&&(Y_=Ri,Z_=7,M_=Mi,h_=Q_,V_=K_,I_=Ti?-1:1)}if(Q_=Cn*Un-wn*Kn,K_=wn*Qn-Sn*Un,0!=(Mi=Sn*Kn-Cn*Qn)||0!=Q_||0!=K_){var qi=Mi*Mi+Q_*Q_+K_*K_;0<qi&&(qi=1/Math.sqrt(qi));var Ve=(Mi*=qi)*s_+(Q_*=qi)*l_+(K_*=qi)*c_,Le=Mi*p_+Q_*m_+K_*b_;0>Ve&&(Ve=-Ve),0>Le&&(Le=-Le);var Be=Mi*x_+Q_*d_+K_*y_,ke=Mi*f_+Q_*g_+K_*v_;0>Be&&(Be=-Be),0>ke&&(ke=-ke);var Ae=(L_=Ve+Le)+(P_=Be+ke),Gi=0>(T_=Mi*An+Q_*Pn+K_*Tn),Oi=Gi?-T_:T_;if(!(Oi<Ae))return;var Wi=Ae-Oi;Wi<Y_&&(Y_=Wi,Z_=8,M_=Mi,h_=Q_,V_=K_,I_=Gi?-1:1)}if(Q_=En*Dn-qn*Gn,K_=qn*Wn-Rn*Dn,0!=(Mi=Rn*Gn-En*Wn)||0!=Q_||0!=K_){var Ui=Mi*Mi+Q_*Q_+K_*K_;0<Ui&&(Ui=1/Math.sqrt(Ui));var Pe=(Mi*=Ui)*__+(Q_*=Ui)*e_+(K_*=Ui)*r_,Te=Mi*p_+Q_*m_+K_*b_;0>Pe&&(Pe=-Pe),0>Te&&(Te=-Te);var we=Mi*f_+Q_*g_+K_*v_,Se=Mi*X_+Q_*u_+K_*z_;0>we&&(we=-we),0>Se&&(Se=-Se);var Ce=(L_=Pe+Te)+(P_=we+Se),io=0>(T_=Mi*An+Q_*Pn+K_*Tn),oo=io?-T_:T_;if(!(oo<Ce))return;var ao=Ce-oo;ao<Y_&&(Y_=ao,Z_=9,M_=Mi,h_=Q_,V_=K_,I_=io?-1:1)}if(Q_=En*On-qn*Jn,K_=qn*Hn-Rn*On,0!=(Mi=Rn*Jn-En*Hn)||0!=Q_||0!=K_){var no=Mi*Mi+Q_*Q_+K_*K_;0<no&&(no=1/Math.sqrt(no));var qe=(Mi*=no)*__+(Q_*=no)*e_+(K_*=no)*r_,Re=Mi*p_+Q_*m_+K_*b_;0>qe&&(qe=-qe),0>Re&&(Re=-Re);var Ee=Mi*x_+Q_*d_+K_*y_,je=Mi*X_+Q_*u_+K_*z_;0>Ee&&(Ee=-Ee),0>je&&(je=-je);var Ne=(L_=qe+Re)+(P_=Ee+je),lo=0>(T_=Mi*An+Q_*Pn+K_*Tn),co=lo?-T_:T_;if(!(co<Ne))return;var mo=Ne-co;mo<Y_&&(Y_=mo,Z_=10,M_=Mi,h_=Q_,V_=K_,I_=lo?-1:1)}if(Q_=En*Un-qn*Kn,K_=qn*Qn-Rn*Un,0!=(Mi=Rn*Kn-En*Qn)||0!=Q_||0!=K_){var po=Mi*Mi+Q_*Q_+K_*K_;0<po&&(po=1/Math.sqrt(po));var Fe=(Mi*=po)*__+(Q_*=po)*e_+(K_*=po)*r_,De=Mi*p_+Q_*m_+K_*b_;0>Fe&&(Fe=-Fe),0>De&&(De=-De);var We=Mi*x_+Q_*d_+K_*y_,Ge=Mi*f_+Q_*g_+K_*v_;0>We&&(We=-We),0>Ge&&(Ge=-Ge);var Oe=(L_=Fe+De)+(P_=We+Ge),uo=0>(T_=Mi*An+Q_*Pn+K_*Tn),go=uo?-T_:T_;if(!(go<Oe))return;var Mo=Oe-go;Mo<Y_&&(Y_=Mo,Z_=11,M_=Mi,h_=Q_,V_=K_,I_=uo?-1:1)}if(Q_=Fn*Dn-jn*Gn,K_=jn*Wn-Nn*Dn,0!=(Mi=Nn*Gn-Fn*Wn)||0!=Q_||0!=K_){var Xo=Mi*Mi+Q_*Q_+K_*K_;0<Xo&&(Xo=1/Math.sqrt(Xo));var He=(Mi*=Xo)*__+(Q_*=Xo)*e_+(K_*=Xo)*r_,Je=Mi*s_+Q_*l_+K_*c_;0>He&&(He=-He),0>Je&&(Je=-Je);var Ue=Mi*f_+Q_*g_+K_*v_,Qe=Mi*X_+Q_*u_+K_*z_;0>Ue&&(Ue=-Ue),0>Qe&&(Qe=-Qe);var Ke=(L_=He+Je)+(P_=Ue+Qe),Lo=0>(T_=Mi*An+Q_*Pn+K_*Tn),wo=Lo?-T_:T_;if(!(wo<Ke))return;var Bo=Ke-wo;Bo<Y_&&(Y_=Bo,Z_=12,M_=Mi,h_=Q_,V_=K_,I_=Lo?-1:1)}if(Q_=Fn*On-jn*Jn,K_=jn*Hn-Nn*On,0!=(Mi=Nn*Jn-Fn*Hn)||0!=Q_||0!=K_){var ko=Mi*Mi+Q_*Q_+K_*K_;0<ko&&(ko=1/Math.sqrt(ko));var $e=(Mi*=ko)*__+(Q_*=ko)*e_+(K_*=ko)*r_,tr=Mi*s_+Q_*l_+K_*c_;0>$e&&($e=-$e),0>tr&&(tr=-tr);var or=Mi*x_+Q_*d_+K_*y_,ar=Mi*X_+Q_*u_+K_*z_;0>or&&(or=-or),0>ar&&(ar=-ar);var ir=(L_=$e+tr)+(P_=or+ar),jo=0>(T_=Mi*An+Q_*Pn+K_*Tn),Ro=jo?-T_:T_;if(!(Ro<ir))return;var qo=ir-Ro;qo<Y_&&(Y_=qo,Z_=13,M_=Mi,h_=Q_,V_=K_,I_=jo?-1:1)}if(Q_=Fn*Un-jn*Kn,K_=jn*Qn-Nn*Un,0!=(Mi=Nn*Kn-Fn*Qn)||0!=Q_||0!=K_){var Eo=Mi*Mi+Q_*Q_+K_*K_;0<Eo&&(Eo=1/Math.sqrt(Eo));var nr=(Mi*=Eo)*__+(Q_*=Eo)*e_+(K_*=Eo)*r_,_r=Mi*s_+Q_*l_+K_*c_;0>nr&&(nr=-nr),0>_r&&(_r=-_r);var er=Mi*x_+Q_*d_+K_*y_,rr=Mi*f_+Q_*g_+K_*v_;0>er&&(er=-er),0>rr&&(rr=-rr);var sr=(L_=nr+_r)+(P_=er+rr),Oo=0>(T_=Mi*An+Q_*Pn+K_*Tn),Wo=Oo?-T_:T_;if(!(Wo<sr))return;var Uo=sr-Wo;Uo<Y_&&(Y_=Uo,Z_=14,M_=Mi,h_=Q_,V_=K_,I_=Oo?-1:1)}if(6<=Z_){M_*=I_,h_*=I_,V_*=I_;var Ho=0|(Z_-6)/3,ma=Z_-6-3*Ho,pa,lr,cr,pr,mr,br,xr,dr,yr,fr,gr,vr,Xr,ur,zr;switch(Ho){case 0:xr=wn,dr=Sn,yr=Cn;var Yr=0<p_*M_+m_*h_+b_*V_;0<s_*M_+l_*h_+c_*V_?Yr?(pa=s_+p_,lr=l_+m_,cr=c_+b_):(pa=s_-p_,lr=l_-m_,cr=c_-b_):Yr?(pa=p_-s_,lr=m_-l_,cr=b_-c_):(pa=-(pa=s_+p_),lr=-(lr=l_+m_),cr=-(cr=c_+b_));break;case 1:xr=qn,dr=Rn,yr=En;var va=0<p_*M_+m_*h_+b_*V_;0<__*M_+e_*h_+r_*V_?va?(pa=__+p_,lr=e_+m_,cr=r_+b_):(pa=__-p_,lr=e_-m_,cr=r_-b_):va?(pa=p_-__,lr=m_-e_,cr=b_-r_):(pa=-(pa=__+p_),lr=-(lr=e_+m_),cr=-(cr=r_+b_));break;default:xr=jn,dr=Nn,yr=Fn;var ya=0<s_*M_+l_*h_+c_*V_;0<__*M_+e_*h_+r_*V_?ya?(pa=__+s_,lr=e_+l_,cr=r_+c_):(pa=__-s_,lr=e_-l_,cr=r_-c_):ya?(pa=s_-__,lr=l_-e_,cr=c_-r_):(pa=-(pa=__+s_),lr=-(lr=e_+l_),cr=-(cr=r_+c_));}switch(pa=Zn+pa,lr=In+lr,cr=Vn+cr,ma){case 0:fr=Dn,gr=Wn,vr=Gn;var ba=0<X_*M_+u_*h_+z_*V_;0<f_*M_+g_*h_+v_*V_?ba?(pr=f_+X_,mr=g_+u_,br=v_+z_):(pr=f_-X_,mr=g_-u_,br=v_-z_):ba?(pr=X_-f_,mr=u_-g_,br=z_-v_):(pr=-(pr=f_+X_),mr=-(mr=g_+u_),br=-(br=v_+z_));break;case 1:fr=On,gr=Hn,vr=Jn;var fa=0<X_*M_+u_*h_+z_*V_;0<x_*M_+d_*h_+y_*V_?fa?(pr=x_+X_,mr=d_+u_,br=y_+z_):(pr=x_-X_,mr=d_-u_,br=y_-z_):fa?(pr=X_-x_,mr=u_-d_,br=z_-y_):(pr=-(pr=x_+X_),mr=-(mr=d_+u_),br=-(br=y_+z_));break;default:fr=Un,gr=Qn,vr=Kn;var da=0<f_*M_+g_*h_+v_*V_;0<x_*M_+d_*h_+y_*V_?da?(pr=x_+f_,mr=d_+g_,br=y_+v_):(pr=x_-f_,mr=d_-g_,br=y_-v_):da?(pr=f_-x_,mr=g_-d_,br=v_-y_):(pr=-(pr=x_+f_),mr=-(mr=d_+g_),br=-(br=y_+v_));}var xa=xr*fr+dr*gr+yr*vr,La=xr*(Xr=pa-(pr=Ln-pr))+dr*(ur=lr-(mr=Bn-mr))+yr*(zr=cr-(br=kn-br)),wa=fr*Xr+gr*ur+vr*zr,Ba=1/(1-xa*xa),ka=(xa*wa-La)*Ba,Aa=(wa-xa*La)*Ba,Pa,Zr,Ir,Mr,hr,Vr,Lr,Br,kr;return Pa=pa+xr*ka,Zr=lr+dr*ka,Ir=cr+yr*ka,Mr=pr+fr*Aa,hr=mr+gr*Aa,Vr=br+vr*Aa,Lr=-M_,Br=-h_,kr=-V_,this.setNormal(s,Lr,Br,kr),void this.addPoint(s,Pa,Zr,Ir,Mr,hr,Vr,Y_,4)}if(3<=Z_){I_=-I_,An=-An,Pn=-Pn,Tn=-Tn;var Ar=n;n=Yn,Yn=Ar;var Sa=$n;$n=a_,a_=Sa;var Ca=t_;t_=i_,i_=Ca;var Ta=o_;o_=n_,n_=Ta,$_=Zn,te=In,oe=Vn,Zn=Ln,In=Bn,Vn=kn,Ln=$_,Bn=te,kn=oe,$_=wn,te=Sn,oe=Cn,wn=Dn,Sn=Wn,Cn=Gn,Dn=$_,Wn=te,Gn=oe,$_=qn,te=Rn,oe=En,qn=On,Rn=Hn,En=Jn,On=$_,Hn=te,Jn=oe,$_=jn,te=Nn,oe=Fn,jn=Un,Nn=Qn,Fn=Kn,Un=$_,Qn=te,Kn=oe,$_=__,te=e_,oe=r_,__=x_,e_=d_,r_=y_,x_=$_,d_=te,y_=oe,$_=s_,te=l_,oe=c_,s_=f_,l_=g_,c_=v_,f_=$_,g_=te,v_=oe,$_=p_,te=m_,oe=b_,p_=X_,m_=u_,b_=z_,X_=$_,u_=te,z_=oe,Z_-=3,ae=!0}else ae=!1;if(0===Z_?(ie=__,ne=e_,_e=r_,ee=wn,re=Sn,se=Cn,le=qn,ce=Rn,pe=En,me=jn,be=Nn,xe=Fn,de=t_,ye=o_):1===Z_?(ie=s_,ne=l_,_e=c_,ee=qn,re=Rn,se=En,le=jn,ce=Nn,pe=Fn,me=wn,be=Sn,xe=Cn,de=o_,ye=$n):(ie=p_,ne=m_,_e=b_,ee=jn,re=Nn,se=Fn,le=wn,ce=Sn,pe=Cn,me=qn,be=Rn,xe=En,de=$n,ye=t_),0>I_){ie=-ie,ne=-ne,_e=-_e,ee=-ee,re=-re,se=-se,$_=le,te=ce,oe=pe,le=me,ce=be,pe=xe,me=$_,be=te,xe=oe;var ja=de;de=ye,ye=ja}ie+=Zn,ne+=In,_e+=Vn;var Ra=1,Pr=0,Tr=ee*Dn+re*Wn+se*Gn,wr,Sr,Cr,qr,Rr,Er,jr,Nr,Fr,Dr,Wr,Gr;switch(Tr<Ra&&(Ra=Tr,Pr=0),-Tr<Ra&&(Ra=-Tr,Pr=1),(Tr=ee*On+re*Hn+se*Jn)<Ra&&(Ra=Tr,Pr=2),-Tr<Ra&&(Ra=-Tr,Pr=3),(Tr=ee*Un+re*Qn+se*Kn)<Ra&&(Ra=Tr,Pr=4),-Tr<Ra&&(Ra=-Tr,Pr=5),Pr){case 0:wr=x_+f_,Sr=d_+g_,Cr=y_+v_,wr+=X_,Sr+=u_,Cr+=z_,qr=x_-f_,Rr=d_-g_,Er=y_-v_,qr+=X_,Rr+=u_,Er+=z_,jr=x_-f_,Nr=d_-g_,Fr=y_-v_,jr-=X_,Nr-=u_,Fr-=z_,Dr=x_+f_,Wr=d_+g_,Gr=y_+v_,Dr-=X_,Wr-=u_,Gr-=z_;break;case 1:wr=f_-x_,Sr=g_-d_,Cr=v_-y_,wr+=X_,Sr+=u_,Cr+=z_,qr=f_-x_,Rr=g_-d_,Er=v_-y_,qr-=X_,Rr-=u_,Er-=z_,jr=-(jr=x_+f_),Nr=-(Nr=d_+g_),Fr=-(Fr=y_+v_),jr-=X_,Nr-=u_,Fr-=z_,Dr=-(Dr=x_+f_),Wr=-(Wr=d_+g_),Gr=-(Gr=y_+v_),Dr+=X_,Wr+=u_,Gr+=z_;break;case 2:wr=x_+f_,Sr=d_+g_,Cr=y_+v_,wr+=X_,Sr+=u_,Cr+=z_,qr=x_+f_,Rr=d_+g_,Er=y_+v_,qr-=X_,Rr-=u_,Er-=z_,jr=f_-x_,Nr=g_-d_,Fr=v_-y_,jr-=X_,Nr-=u_,Fr-=z_,Dr=f_-x_,Wr=g_-d_,Gr=v_-y_,Dr+=X_,Wr+=u_,Gr+=z_;break;case 3:wr=x_-f_,Sr=d_-g_,Cr=y_-v_,wr+=X_,Sr+=u_,Cr+=z_,qr=-(qr=x_+f_),Rr=-(Rr=d_+g_),Er=-(Er=y_+v_),qr+=X_,Rr+=u_,Er+=z_,jr=-(jr=x_+f_),Nr=-(Nr=d_+g_),Fr=-(Fr=y_+v_),jr-=X_,Nr-=u_,Fr-=z_,Dr=x_-f_,Wr=d_-g_,Gr=y_-v_,Dr-=X_,Wr-=u_,Gr-=z_;break;case 4:wr=x_+f_,Sr=d_+g_,Cr=y_+v_,wr+=X_,Sr+=u_,Cr+=z_,qr=f_-x_,Rr=g_-d_,Er=v_-y_,qr+=X_,Rr+=u_,Er+=z_,jr=-(jr=x_+f_),Nr=-(Nr=d_+g_),Fr=-(Fr=y_+v_),jr+=X_,Nr+=u_,Fr+=z_,Dr=x_-f_,Wr=d_-g_,Gr=y_-v_,Dr+=X_,Wr+=u_,Gr+=z_;break;default:wr=x_+f_,Sr=d_+g_,Cr=y_+v_,wr-=X_,Sr-=u_,Cr-=z_,qr=x_-f_,Rr=d_-g_,Er=y_-v_,qr-=X_,Rr-=u_,Er-=z_,jr=-(jr=x_+f_),Nr=-(Nr=d_+g_),Fr=-(Fr=y_+v_),jr-=X_,Nr-=u_,Fr-=z_,Dr=f_-x_,Wr=g_-d_,Gr=v_-y_,Dr-=X_,Wr-=u_,Gr-=z_;}wr+=An,Sr+=Pn,Cr+=Tn,qr+=An,Rr+=Pn,Er+=Tn,jr+=An,Nr+=Pn,Fr+=Tn,Dr+=An,Wr+=Pn,Gr+=Tn;var Or=this.clipper;Or.w=de,Or.h=ye,Or.numVertices=0,Or.numTmpVertices=0;var on=this.clipper,an=on.vertices[on.numVertices++];an.x=wr*le+Sr*ce+Cr*pe,an.y=wr*me+Sr*be+Cr*xe,an.wx=wr,an.wy=Sr,an.wz=Cr;var nn=this.clipper,sn=nn.vertices[nn.numVertices++];sn.x=qr*le+Rr*ce+Er*pe,sn.y=qr*me+Rr*be+Er*xe,sn.wx=qr,sn.wy=Rr,sn.wz=Er;var _n=this.clipper,rn=_n.vertices[_n.numVertices++];rn.x=jr*le+Nr*ce+Fr*pe,rn.y=jr*me+Nr*be+Fr*xe,rn.wx=jr,rn.wy=Nr,rn.wz=Fr;var en=this.clipper,mn=en.vertices[en.numVertices++],pn,Hr,Jr;mn.x=Dr*le+Wr*ce+Gr*pe,mn.y=Dr*me+Wr*be+Gr*xe,mn.wx=Dr,mn.wy=Wr,mn.wz=Gr,this.clipper.clip(),this.clipper.reduce(),ae?(pn=ee,Hr=re,Jr=se):(pn=-ee,Hr=-re,Jr=-se),this.setNormal(s,pn,Hr,Jr);for(var Ur=0,Qr=this.clipper.numVertices;Ur<Qr;){var yn=Ur++,xn=this.clipper.vertices[yn],un,Kr,$r;un=xn.wx,Kr=xn.wy,$r=xn.wz;var ts=(ie-(un+=Zn))*ee+(ne-(Kr+=In))*re+(_e-($r+=Vn))*se,zn,os,as;zn=un+ee*ts,os=Kr+re*ts,as=$r+se*ts,ts>-oimo_common_Setting.contactPersistenceThreshold&&(ae?this.addPoint(s,un,Kr,$r,zn,os,as,ts,yn):this.addPoint(s,zn,os,as,un,Kr,$r,ts,yn))}}}}}}}}});var oimo_collision_narrowphase_detector__$BoxBoxDetector_IncidentVertex=function(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0},oimo_collision_narrowphase_detector__$BoxBoxDetector_FaceClipper=function(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var n=Array(8);this.vertices=n;var t=Array(8);this.tmpVertices=t;for(var i=0,_;8>i;)_=i++,this.vertices[_]=new oimo_collision_narrowphase_detector__$BoxBoxDetector_IncidentVertex,this.tmpVertices[_]=new oimo_collision_narrowphase_detector__$BoxBoxDetector_IncidentVertex};oimo_collision_narrowphase_detector__$BoxBoxDetector_FaceClipper.prototype={clip:function(){for(var ot=0,at=this.numVertices;ot<at;){var i=ot++,o=this.vertices[i],a=this.vertices[(i+1)%this.numVertices],n=this.w+o.x,s=this.w+a.x;if(0<n&&0<s){var _=this.tmpVertices[this.numTmpVertices++];_.x=o.x,_.y=o.y,_.wx=o.wx,_.wy=o.wy,_.wz=o.wz}else if(0<n&&0>=s){var r=this.tmpVertices[this.numTmpVertices++];r.x=o.x,r.y=o.y,r.wx=o.wx,r.wy=o.wy,r.wz=o.wz;var e=n/(n-s),h=this.tmpVertices[this.numTmpVertices++];h.x=o.x+(a.x-o.x)*e,h.y=o.y+(a.y-o.y)*e,h.wx=o.wx+(a.wx-o.wx)*e,h.wy=o.wy+(a.wy-o.wy)*e,h.wz=o.wz+(a.wz-o.wz)*e}else if(0>=n&&0<s){var l=n/(n-s),c=this.tmpVertices[this.numTmpVertices++];c.x=o.x+(a.x-o.x)*l,c.y=o.y+(a.y-o.y)*l,c.wx=o.wx+(a.wx-o.wx)*l,c.wy=o.wy+(a.wy-o.wy)*l,c.wz=o.wz+(a.wz-o.wz)*l}}var m=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=m,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var p=0,nt=this.numVertices;p<nt;){var y=p++,b=this.vertices[y],f=this.vertices[(y+1)%this.numVertices],d=this.w-b.x,x=this.w-f.x;if(0<d&&0<x){var u=this.tmpVertices[this.numTmpVertices++];u.x=b.x,u.y=b.y,u.wx=b.wx,u.wy=b.wy,u.wz=b.wz}else if(0<d&&0>=x){var g=this.tmpVertices[this.numTmpVertices++];g.x=b.x,g.y=b.y,g.wx=b.wx,g.wy=b.wy,g.wz=b.wz;var M=d/(d-x),X=this.tmpVertices[this.numTmpVertices++];X.x=b.x+(f.x-b.x)*M,X.y=b.y+(f.y-b.y)*M,X.wx=b.wx+(f.wx-b.wx)*M,X.wy=b.wy+(f.wy-b.wy)*M,X.wz=b.wz+(f.wz-b.wz)*M}else if(0>=d&&0<x){var z=d/(d-x),Y=this.tmpVertices[this.numTmpVertices++];Y.x=b.x+(f.x-b.x)*z,Y.y=b.y+(f.y-b.y)*z,Y.wx=b.wx+(f.wx-b.wx)*z,Y.wy=b.wy+(f.wy-b.wy)*z,Y.wz=b.wz+(f.wz-b.wz)*z}}var Z=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=Z,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var I=0,_t=this.numVertices;I<_t;){var L=I++,w=this.vertices[L],B=this.vertices[(L+1)%this.numVertices],k=this.h+w.y,A=this.h+B.y;if(0<k&&0<A){var P=this.tmpVertices[this.numTmpVertices++];P.x=w.x,P.y=w.y,P.wx=w.wx,P.wy=w.wy,P.wz=w.wz}else if(0<k&&0>=A){var S=this.tmpVertices[this.numTmpVertices++];S.x=w.x,S.y=w.y,S.wx=w.wx,S.wy=w.wy,S.wz=w.wz;var C=k/(k-A),T=this.tmpVertices[this.numTmpVertices++];T.x=w.x+(B.x-w.x)*C,T.y=w.y+(B.y-w.y)*C,T.wx=w.wx+(B.wx-w.wx)*C,T.wy=w.wy+(B.wy-w.wy)*C,T.wz=w.wz+(B.wz-w.wz)*C}else if(0>=k&&0<A){var j=k/(k-A),R=this.tmpVertices[this.numTmpVertices++];R.x=w.x+(B.x-w.x)*j,R.y=w.y+(B.y-w.y)*j,R.wx=w.wx+(B.wx-w.wx)*j,R.wy=w.wy+(B.wy-w.wy)*j,R.wz=w.wz+(B.wz-w.wz)*j}}var q=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=q,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var E=0,et=this.numVertices;E<et;){var J=E++,F=this.vertices[J],N=this.vertices[(J+1)%this.numVertices],G=this.h-F.y,O=this.h-N.y;if(0<G&&0<O){var W=this.tmpVertices[this.numTmpVertices++];W.x=F.x,W.y=F.y,W.wx=F.wx,W.wy=F.wy,W.wz=F.wz}else if(0<G&&0>=O){var U=this.tmpVertices[this.numTmpVertices++];U.x=F.x,U.y=F.y,U.wx=F.wx,U.wy=F.wy,U.wz=F.wz;var H=G/(G-O),Q=this.tmpVertices[this.numTmpVertices++];Q.x=F.x+(N.x-F.x)*H,Q.y=F.y+(N.y-F.y)*H,Q.wx=F.wx+(N.wx-F.wx)*H,Q.wy=F.wy+(N.wy-F.wy)*H,Q.wz=F.wz+(N.wz-F.wz)*H}else if(0>=G&&0<O){var $=G/(G-O),K=this.tmpVertices[this.numTmpVertices++];K.x=F.x+(N.x-F.x)*$,K.y=F.y+(N.y-F.y)*$,K.wx=F.wx+(N.wx-F.wx)*$,K.wy=F.wy+(N.wy-F.wy)*$,K.wz=F.wz+(N.wz-F.wz)*$}}var tt=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=tt,this.numVertices=this.numTmpVertices,this.numTmpVertices=0},reduce:function(){if(!(4>this.numVertices)){for(var x=-1/0,g=1/0,X=-1/0,u=1/0,z=null,Y=null,Z=null,I=null,M=0,V=this.numVertices;M<V;){var h=M++,l=this.vertices[h],c=1*l.x+1*l.y,m=-1*l.x+1*l.y;c>x&&(x=c,z=l),c<g&&(g=c,Y=l),m>X&&(X=m,Z=l),m<u&&(u=m,I=l)}var p=this.tmpVertices[this.numTmpVertices++];p.x=z.x,p.y=z.y,p.wx=z.wx,p.wy=z.wy,p.wz=z.wz;var v=this.tmpVertices[this.numTmpVertices++];v.x=Z.x,v.y=Z.y,v.wx=Z.wx,v.wy=Z.wy,v.wz=Z.wz;var y=this.tmpVertices[this.numTmpVertices++];y.x=Y.x,y.y=Y.y,y.wx=Y.wx,y.wy=Y.wy,y.wz=Y.wz;var b=this.tmpVertices[this.numTmpVertices++];b.x=I.x,b.y=I.y,b.wx=I.wx,b.wy=I.wy,b.wz=I.wz;var f=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=f,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}};var oimo_collision_narrowphase_detector_BoxBoxDetectorMacro=function(){},oimo_collision_narrowphase_detector_CachedDetectorData=function(){};oimo_collision_narrowphase_detector_CachedDetectorData.prototype={_clear:function(){null!=this._gjkCache&&this._gjkCache.clear()}};var oimo_collision_narrowphase_detector_CapsuleCapsuleDetector=function(){oimo_collision_narrowphase_detector_Detector.call(this,!1)};oimo_collision_narrowphase_detector_CapsuleCapsuleDetector.__super__=oimo_collision_narrowphase_detector_Detector,oimo_collision_narrowphase_detector_CapsuleCapsuleDetector.prototype=$extend(oimo_collision_narrowphase_detector_Detector.prototype,{detectImpl:function(s,t,i,o,a){var n=t,m=i,p,lt,ct,pt,mt,bt;s.incremental=!1,p=o._rotation01,lt=o._rotation11,ct=o._rotation21,pt=a._rotation01,mt=a._rotation11,bt=a._rotation21;var xt=n._halfHeight,k=m._halfHeight,A=n._radius,P=m._radius,S,dt,yt,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt,Vt,Lt,Bt,kt,At;S=o._positionX+p*-xt,dt=o._positionY+lt*-xt,yt=o._positionZ+ct*-xt,ft=o._positionX+p*xt,gt=o._positionY+lt*xt,vt=o._positionZ+ct*xt;var Pt=-((Yt=S-(Xt=a._positionX+pt*-k))*(Mt=ft-S)+(Zt=dt-(ut=a._positionY+mt*-k))*(Vt=gt-dt)+(It=yt-(zt=a._positionZ+bt*-k))*(Lt=vt-yt)),O=Yt*(Bt=a._positionX+pt*k-Xt)+Zt*(kt=a._positionY+mt*k-ut)+It*(At=a._positionZ+bt*k-zt),W=4*(xt*xt),U=Mt*Bt+Vt*kt+Lt*At,H=4*(k*k),Q,Tt,wt,St,Ct,qt,Rt,Et,jt,Nt,Ft;if(0==W&&0==H)Q=0,Tt=0;else if(0==W)Q=0,0>(Tt=O)?Tt=0:Tt>H?Tt=1:Tt/=H;else if(0==H)Tt=0,0>(Q=Pt)?Q=0:Q>W?Q=1:Q/=W;else{var Dt=W*H-U*U;0==Dt?Q=0:0>(Q=U*O+H*Pt)?Q=0:Q>Dt?Q=1:Q/=Dt,0>(Tt=Q*U+O)?(Tt=0,0>(Q=Pt)?Q=0:Q>W?Q=1:Q/=W):Tt>H?(Tt=1,0>(Q=U+Pt)?Q=0:Q>W?Q=1:Q/=W):Tt/=H}var $=(jt=(wt=S+Mt*Q)-(qt=Xt+Bt*Tt))*jt+(Nt=(St=dt+Vt*Q)-(Rt=ut+kt*Tt))*Nt+(Ft=(Ct=yt+Lt*Q)-(Et=zt+At*Tt))*Ft;if(!($>=(A+P)*(A+P))){var K=Math.sqrt($),ht,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt;0<K?(ht=jt*(1/K),Wt=Nt*(1/K),Gt=Ft*(1/K)):(ht=1,Wt=0,Gt=0),this.setNormal(s,ht,Wt,Gt),Ot=wt+ht*-A,Ht=St+Wt*-A,Jt=Ct+Gt*-A,Ut=qt+ht*P,Qt=Rt+Wt*P,Kt=Et+Gt*P,this.addPoint(s,Ot,Ht,Jt,Ut,Qt,Kt,A+P-K,0)}}});var oimo_collision_narrowphase_detector_GjkEpaDetector=function(){oimo_collision_narrowphase_detector_Detector.call(this,!1)};oimo_collision_narrowphase_detector_GjkEpaDetector.__super__=oimo_collision_narrowphase_detector_Detector,oimo_collision_narrowphase_detector_GjkEpaDetector.prototype=$extend(oimo_collision_narrowphase_detector_Detector.prototype,{detectImpl:function(z,t,i,o,a,n){var s=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.instance,_=t,r=i,e=s.computeClosestPointsImpl(_,r,o,a,oimo_common_Setting.enableGJKCaching?n:null,!0);if(z.incremental=!0,e==oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.SUCCEEDED){var Y=_._gjkMargin,l=r._gjkMargin;if(!(s.distance>Y+l)){var c=s.closestPoint1,d,Z,I,h,V,L;d=c.x,Z=c.y,I=c.z;var B=s.closestPoint2,M,k,A;if(0!=(M=d-(h=B.x))*M+(k=Z-(V=B.y))*k+(A=I-(L=B.z))*A){0>s.distance&&(M=-M,k=-k,A=-A);var P=M*M+k*k+A*A;0<P&&(P=1/Math.sqrt(P)),M*=P,k*=P,A*=P,this.setNormal(z,M,k,A),d+=M*-_._gjkMargin,Z+=k*-_._gjkMargin,I+=A*-_._gjkMargin,h+=M*r._gjkMargin,V+=k*r._gjkMargin,L+=A*r._gjkMargin,this.addPoint(z,d,Z,I,h,V,L,_._gjkMargin+r._gjkMargin-s.distance,0)}}}else console.log("GjkEpaDetector.hx:28:","GJK/EPA failed: status="+e)}});var oimo_collision_narrowphase_detector_SphereBoxDetector=function(o){oimo_collision_narrowphase_detector_Detector.call(this,o)};oimo_collision_narrowphase_detector_SphereBoxDetector.__super__=oimo_collision_narrowphase_detector_Detector,oimo_collision_narrowphase_detector_SphereBoxDetector.prototype=$extend(oimo_collision_narrowphase_detector_Detector.prototype,{detectImpl:function(s,t,i,o,a){var n=i,p,m,bt,xt,dt,ft;s.incremental=!1,xt=-(p=n._halfExtentsX),dt=-(m=n._halfExtentsY),ft=-(bt=n._halfExtentsZ);var gt=t._radius,z,Xt,ut,zt,Yt,Zt,It,Mt,Vt,Lt;if(z=o._positionX-a._positionX,Xt=o._positionY-a._positionY,ut=o._positionZ-a._positionZ,It=a._rotation00*z+a._rotation10*Xt+a._rotation20*ut,Yt=a._rotation01*z+a._rotation11*Xt+a._rotation21*ut,Zt=a._rotation02*z+a._rotation12*Xt+a._rotation22*ut,xt<(zt=It)&&p>zt&&dt<Yt&&m>Yt&&ft<Zt&&bt>Zt){var Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et,jt,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt,$t,to;return Bt=p-(Bt=0>zt?-zt:zt),kt=m-(kt=0>Yt?-Yt:Yt),At=bt-(At=0>Zt?-Zt:Zt),(Bt<kt?Bt<At?(0<zt?(Pt=1,Tt=0,wt=0):(Pt=-1,Tt=0,wt=0),Ct=0,qt=1,Rt=1,St=Bt):(0<Zt?(Pt=0,Tt=0,wt=1):(Pt=0,Tt=0,wt=-1),Ct=1,qt=1,Rt=0,St=At):kt<At?(0<Yt?(Pt=0,Tt=1,wt=0):(Pt=0,Tt=-1,wt=0),Ct=1,qt=0,Rt=1,St=kt):(0<Zt?(Pt=0,Tt=0,wt=1):(Pt=0,Tt=0,wt=-1),Ct=1,qt=1,Rt=0,St=At),Et=Pt*p,jt=Tt*m,Nt=wt*bt,Et+=Ct*zt,jt+=qt*Yt,Nt+=Rt*Zt,Ft=a._rotation00*Et+a._rotation01*jt+a._rotation02*Nt,Dt=a._rotation10*Et+a._rotation11*jt+a._rotation12*Nt,Wt=a._rotation20*Et+a._rotation21*jt+a._rotation22*Nt,Gt=a._rotation00*Pt+a._rotation01*Tt+a._rotation02*wt,Ot=a._rotation10*Pt+a._rotation11*Tt+a._rotation12*wt,Ht=a._rotation20*Pt+a._rotation21*Tt+a._rotation22*wt,this.setNormal(s,Gt,Ot,Ht),Jt=o._positionX+Gt*-gt,Ut=o._positionY+Ot*-gt,Qt=o._positionZ+Ht*-gt,Kt=a._positionX+Ft,$t=a._positionY+Dt,to=a._positionZ+Wt,void this.addPoint(s,Jt,Ut,Qt,Kt,$t,to,St,0))}var oo=(ao=zt-(Mt=(Mt=zt<(p-=1e-9)?zt:p)>(xt+=1e-9)?Mt:xt))*ao+(io=Yt-(Vt=(Vt=Yt<(m-=1e-9)?Yt:m)>(dt+=1e-9)?Vt:dt))*io+(no=Zt-(Lt=(Lt=Zt<(bt-=1e-9)?Zt:bt)>(ft+=1e-9)?Lt:ft))*no,ao,io,no;if(!(oo>=gt*gt)){var _o,eo,ro,so,lo,co,po,mo,bo;oo=Math.sqrt(oo),_o=a._rotation00*Mt+a._rotation01*Vt+a._rotation02*Lt,eo=a._rotation10*Mt+a._rotation11*Vt+a._rotation12*Lt,ro=a._rotation20*Mt+a._rotation21*Vt+a._rotation22*Lt;var xo=(so=a._rotation00*ao+a._rotation01*io+a._rotation02*no)*so+(lo=a._rotation10*ao+a._rotation11*io+a._rotation12*no)*lo+(co=a._rotation20*ao+a._rotation21*io+a._rotation22*no)*co,yo,fo,go,vo,Xo,uo;0<xo&&(xo=1/Math.sqrt(xo)),po=so*xo,mo=lo*xo,bo=co*xo,this.setNormal(s,po,mo,bo),yo=o._positionX+po*-gt,fo=o._positionY+mo*-gt,go=o._positionZ+bo*-gt,vo=a._positionX+_o,Xo=a._positionY+eo,uo=a._positionZ+ro,this.addPoint(s,yo,fo,go,vo,Xo,uo,gt-oo,0)}}});var oimo_collision_narrowphase_detector_SphereCapsuleDetector=function(o){oimo_collision_narrowphase_detector_Detector.call(this,o)};oimo_collision_narrowphase_detector_SphereCapsuleDetector.__super__=oimo_collision_narrowphase_detector_Detector,oimo_collision_narrowphase_detector_SphereCapsuleDetector.prototype=$extend(oimo_collision_narrowphase_detector_Detector.prototype,{detectImpl:function(_,t,i,o,a){var n=i;_.incremental=!1;var r=n._halfHeight,s=t._radius,g=n._radius,u,M,N,F,D,W,G,O,H,J,U,Q;u=a._rotation01,M=a._rotation11,N=a._rotation21,F=o._positionX,D=o._positionY,W=o._positionZ,G=a._positionX+u*-r,O=a._positionY+M*-r,H=a._positionZ+N*-r;var K=4*(r*r),L=(F-G)*(J=a._positionX+u*r-G)+(D-O)*(U=a._positionY+M*r-O)+(W-H)*(Q=a._positionZ+N*r-H),$,tt,ot,at,it,nt;0>L?L=0:L>K?L=1:L/=K;var _t=(at=F-($=G+J*L))*at+(it=D-(tt=O+U*L))*it+(nt=W-(ot=H+Q*L))*nt;if(!(_t>=(s+g)*(s+g))){var B=Math.sqrt(_t),E,et,rt,st,lt,ct,pt,mt,bt;0<B?(E=at*(1/B),et=it*(1/B),rt=nt*(1/B)):(E=1,et=0,rt=0),this.setNormal(_,E,et,rt),st=F+E*-s,lt=D+et*-s,ct=W+rt*-s,pt=$+E*g,mt=tt+et*g,bt=ot+rt*g,this.addPoint(_,st,lt,ct,pt,mt,bt,s+g-B,0)}}});var oimo_collision_narrowphase_detector_SphereSphereDetector=function(){oimo_collision_narrowphase_detector_Detector.call(this,!1)};oimo_collision_narrowphase_detector_SphereSphereDetector.__super__=oimo_collision_narrowphase_detector_Detector,oimo_collision_narrowphase_detector_SphereSphereDetector.prototype=$extend(oimo_collision_narrowphase_detector_Detector.prototype,{detectImpl:function(s,t,i,o,a){var n,l,z;s.incremental=!1,n=o._positionX-a._positionX,l=o._positionY-a._positionY,z=o._positionZ-a._positionZ;var Y=t._radius,c=i._radius,m=n*n+l*l+z*z;if(!(m>=(Y+c)*(Y+c))){var p=Math.sqrt(m),X,Z,I,h,V,L,B,k,A;0<p?(X=n*(1/p),Z=l*(1/p),I=z*(1/p)):(X=1,Z=0,I=0),this.setNormal(s,X,Z,I),h=o._positionX+X*-Y,V=o._positionY+Z*-Y,L=o._positionZ+I*-Y,B=a._positionX+X*c,k=a._positionY+Z*c,A=a._positionZ+I*c,this.addPoint(s,h,V,L,B,k,A,Y+c-p,0)}}});var oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedron=function(){var o=oimo_common_Setting.maxEPAVertices,t=Array(o);this._vertices=t,this._center=new oimo_common_Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null};oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedron.prototype={dumpHoleEdge:function(){},validate:function(){for(var n=this._triangleList;null!=n;){for(var _=n._next,i=0,e;3>i;){if(e=i++,n._vertices[e]._tmpEdgeLoopOuterTriangle=null,n._vertices[e]._tmpEdgeLoopNext=null,-1==n._adjacentPairIndex[e])return this._status=2,!1;if(null==n._adjacentTriangles[e])return this._status=3,!1}n=_}return!0},findEdgeLoop:function(B,t,i){if(t._tmpDfsId!=B){t._tmpDfsId=B;var o=t.tmp;o.x=i.x,o.y=i.y,o.z=i.z;var a=o,n=t._vertices[0].v,s=a.x-n.x,_=a.y-n.y,r=a.z-n.z;a.x=s,a.y=_,a.z=r;var e=t.tmp,h=t._normal;if(t._tmpDfsVisible=0<e.x*h.x+e.y*h.y+e.z*h.z,t._tmpDfsVisible){for(var l=0;3>l;){var k=l++,m=t._adjacentTriangles[k];if(null!=m){var p=m.tmp;p.x=i.x,p.y=i.y,p.z=i.z;var v=p,y=m._vertices[0].v,b=v.x-y.x,f=v.y-y.y,d=v.z-y.z;v.x=b,v.y=f,v.z=d;var x=m.tmp,u=m._normal;if(m._tmpDfsVisible=0<x.x*u.x+x.y*u.y+x.z*u.z,m._tmpDfsVisible)this.findEdgeLoop(B,m,i);else{var g=t._nextIndex[k],M=t._vertices[k],X=t._vertices[g];M._tmpEdgeLoopNext=X,M._tmpEdgeLoopOuterTriangle=m}}}for(var z=0;3>z;){var A=z++,Z=t._adjacentTriangles[A];if(null!=Z){var I=t._adjacentPairIndex[A];Z._adjacentTriangles[I]=null,Z._adjacentPairIndex[I]=-1,t._adjacentTriangles[A]=null,t._adjacentPairIndex[A]=-1}}this._numTriangles--;var V=t._prev,L=t._next;null!=V&&(V._next=L),null!=L&&(L._prev=V),t==this._triangleList&&(this._triangleList=this._triangleList._next),t==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=this._trianglePool,this._trianglePool=t}else this._status=6}},_init:function(A,t,i,o){this._status=0,this._numVertices=4,this._vertices[0]=A,this._vertices[1]=t,this._vertices[2]=i,this._vertices[3]=o;var a=this._center,n=A.v;a.x=n.x,a.y=n.y,a.z=n.z;var s=a,_=t.v,r=s.x+_.x,e=s.y+_.y,h=s.z+_.z;s.x=r,s.y=e,s.z=h;var l=s,c=i.v,m=l.x+c.x,p=l.y+c.y,v=l.z+c.z;l.x=m,l.y=p,l.z=v;var y=l,b=o.v,f=y.x+b.x,d=y.y+b.y,x=y.z+b.z;y.x=f,y.y=d,y.z=x;var u=y,g=.25*u.x,M=.25*u.y,X=.25*u.z;u.x=g,u.y=M,u.z=X;var z=this._trianglePool;null==z?z=new oimo_collision_narrowphase_detector_gjkepa_EpaTriangle:(this._trianglePool=z._next,z._next=null);var P=z,Z=this._trianglePool;null==Z?Z=new oimo_collision_narrowphase_detector_gjkepa_EpaTriangle:(this._trianglePool=Z._next,Z._next=null);var T=Z,V=this._trianglePool;null==V?V=new oimo_collision_narrowphase_detector_gjkepa_EpaTriangle:(this._trianglePool=V._next,V._next=null);var S=V,w=this._trianglePool;null==w?w=new oimo_collision_narrowphase_detector_gjkepa_EpaTriangle:(this._trianglePool=w._next,w._next=null);var C=w;return P.init(A,t,i,this._center,!0)||(this._status=1),T.init(A,t,o,this._center,!0)||(this._status=1),S.init(A,i,o,this._center,!0)||(this._status=1),C.init(t,i,o,this._center,!0)||(this._status=1),P.setAdjacentTriangle(T)||(this._status=1),P.setAdjacentTriangle(S)||(this._status=1),P.setAdjacentTriangle(C)||(this._status=1),T.setAdjacentTriangle(S)||(this._status=1),T.setAdjacentTriangle(C)||(this._status=1),S.setAdjacentTriangle(C)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=P,this._triangleListLast=P):(this._triangleListLast._next=P,P._prev=this._triangleListLast,this._triangleListLast=P),this._numTriangles++,null==this._triangleList?(this._triangleList=T,this._triangleListLast=T):(this._triangleListLast._next=T,T._prev=this._triangleListLast,this._triangleListLast=T),this._numTriangles++,null==this._triangleList?(this._triangleList=S,this._triangleListLast=S):(this._triangleListLast._next=S,S._prev=this._triangleListLast,this._triangleListLast=S),this._numTriangles++,null==this._triangleList?(this._triangleList=C,this._triangleListLast=C):(this._triangleListLast._next=C,C._prev=this._triangleListLast,this._triangleListLast=C),0==this._status},_addVertex:function(n,t){this._vertices[this._numVertices++]=n;var i=t._vertices[0];if(this.findEdgeLoop(this._numVertices,t,n.v),0!=this._status)return!1;for(var o=i,l=null,c=null;;){if(null==o._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==o._tmpEdgeLoopOuterTriangle)return this._status=5,!1;var p=this._trianglePool;null==p?p=new oimo_collision_narrowphase_detector_gjkepa_EpaTriangle:(this._trianglePool=p._next,p._next=null);var m=p;if(null==c&&(c=m),m.init(o,o._tmpEdgeLoopNext,n,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=m,this._triangleListLast=m):(this._triangleListLast._next=m,m._prev=this._triangleListLast,this._triangleListLast=m),m.setAdjacentTriangle(o._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=l&&(m.setAdjacentTriangle(l)||(this._status=1)),l=m,(o=o._tmpEdgeLoopNext)==i)break}return l.setAdjacentTriangle(c)||(this._status=1),0==this._status&&this.validate()},_dumpAsObjModel:function(){}};var oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState=function(){},oimo_collision_narrowphase_detector_gjkepa_EpaTriangle=function(){this.id=++oimo_collision_narrowphase_detector_gjkepa_EpaTriangle.count,this._next=null,this._prev=null,this._normal=new oimo_common_Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var n=[,,,];this._vertices=n;var t=[,,,];this._adjacentTriangles=t;var i=[,,,];this._adjacentPairIndex=i,this.tmp=new oimo_common_Vec3;var o=[,,,];this._nextIndex=o,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0};oimo_collision_narrowphase_detector_gjkepa_EpaTriangle.prototype={init:function(to,t,oo,ao,a){var io,no,_o,eo,ro,so,lo,co,po;null==a&&(a=!1);var mo=to.v;io=mo.x,no=mo.y,_o=mo.z;var v=t.v;eo=v.x,ro=v.y,so=v.z;var y=oo.v;lo=y.x,co=y.y,po=y.z;var b=ao,Z=!1,bo,xo,yo,fo,go,vo,Xo,uo,zo;if(0>(io-b.x)*(Xo=(xo=ro-no)*(vo=po-_o)-(yo=so-_o)*(go=co-no))+(no-b.y)*(uo=yo*(fo=lo-io)-(bo=eo-io)*vo)+(_o-b.z)*(zo=bo*go-xo*fo))if(a){var Yo=t;t=oo,oo=Yo,Xo*=-1,uo*=-1,zo*=-1}else Z=!0;this._vertices[0]=to,this._vertices[1]=t,this._vertices[2]=oo;var V=this._normal;V.x=Xo,V.y=uo,V.z=zo;var L=to.v,W=t.v,U=oo.v,H=this.tmp,Q=L,$,Zo,Io,Mo,ho,Vo,Lo,Bo,ko,Ao,Po,To,wo,So,Co,qo,Ro,Eo;$=Q.x,Zo=Q.y,Io=Q.z;var jo=W;Mo=jo.x,ho=jo.y,Vo=jo.z;var K=U,at,No,Fo;Lo=K.x;var Do=Mo*((So=(Bo=K.y)-ho)*(Fo=(Ao=Mo-$)*So-(Po=ho-Zo)*(wo=Lo-Mo))-(Co=(ko=K.z)-Vo)*(No=(To=Vo-Io)*wo-Ao*Co))+ho*(Co*(at=Po*Co-To*So)-wo*Fo)+Vo*(wo*No-So*at),rt=Lo*((Ro=Zo-Bo)*Fo-(Eo=Io-ko)*No)+Bo*(Eo*at-(qo=$-Lo)*Fo)+ko*(qo*No-Ro*at),et=-1,Wo,Go,Oo;if(Wo=0,Go=0,Oo=0,0>$*(Po*Fo-To*No)+Zo*(To*at-Ao*Fo)+Io*(Ao*No-Po*at)){var Ho=L,bt,Jo,Uo,Qo,Ko,$o;bt=Ho.x,Jo=Ho.y,Uo=Ho.z;var ta=W,gt=(oa=(Qo=ta.x)-bt)*bt+(aa=(Ko=ta.y)-Jo)*Jo+(ia=($o=ta.z)-Uo)*Uo,oa,aa,ia,na;if(0>(gt=-gt/(oa*oa+aa*aa+ia*ia))){var _a=H;_a.x=bt,_a.y=Jo,_a.z=Uo,na=1}else if(1<gt){var Xt=H;Xt.x=Qo,Xt.y=Ko,Xt.z=$o,na=2}else{var zt,ea,ra;zt=bt+oa*gt,ea=Jo+aa*gt,ra=Uo+ia*gt;var sa=H;sa.x=zt,sa.y=ea,sa.z=ra,na=3}na,et=H.x*H.x+H.y*H.y+H.z*H.z;var Vt=H;Wo=Vt.x,Go=Vt.y,Oo=Vt.z}if(0>Do){var Lt=W,Ct,la,ca,pa,ma,ba;Ct=Lt.x,la=Lt.y,ca=Lt.z;var xa=U,Et=(da=(pa=xa.x)-Ct)*Ct+(ya=(ma=xa.y)-la)*la+(fa=(ba=xa.z)-ca)*ca,da,ya,fa,ga;if(0>(Et=-Et/(da*da+ya*ya+fa*fa))){var va=H;va.x=Ct,va.y=la,va.z=ca,ga=1}else if(1<Et){var Jt=H;Jt.x=pa,Jt.y=ma,Jt.z=ba,ga=2}else{var Ft,Xa,ua;Ft=Ct+da*Et,Xa=la+ya*Et,ua=ca+fa*Et;var za=H;za.x=Ft,za.y=Xa,za.z=ua,ga=3}var Wt=H.x*H.x+H.y*H.y+H.z*H.z;if(0>et||Wt<et){ga<<1,et=Wt;var Ut=H;Wo=Ut.x,Go=Ut.y,Oo=Ut.z}}if(0>rt){var Ht=L,Ya,Za,Ia,Ma,ha,Va;Ya=Ht.x,Za=Ht.y,Ia=Ht.z;var La=U,Ba=(ka=(Ma=La.x)-Ya)*Ya+(Aa=(ha=La.y)-Za)*Za+(Pa=(Va=La.z)-Ia)*Ia,ka,Aa,Pa,Ta;if(0>(Ba=-Ba/(ka*ka+Aa*Aa+Pa*Pa))){var wa=H;wa.x=Ya,wa.y=Za,wa.z=Ia,Ta=1}else if(1<Ba){var Sa=H;Sa.x=Ma,Sa.y=ha,Sa.z=Va,Ta=2}else{var Ca,qa,Ra;Ca=Ya+ka*Ba,qa=Za+Aa*Ba,Ra=Ia+Pa*Ba;var Ea=H;Ea.x=Ca,Ea.y=qa,Ea.z=Ra,Ta=3}var ja=H.x*H.x+H.y*H.y+H.z*H.z;if(0>et||ja<et){1&Ta|(2&Ta)<<1,et=ja;var Na=H;Wo=Na.x,Go=Na.y,Oo=Na.z}}if(0<et){var Fa=H;Fa.x=Wo,Fa.y=Go,Fa.z=Oo}else{var Da=at*at+No*No+Fo*Fo;0<Da&&(Da=1/Math.sqrt(Da));var Wa=(at*=Da)*at+(No*=Da)*No+(Fo*=Da)*Fo;Wo=at*(Wa=($*at+Zo*No+Io*Fo)/Wa),Go=No*Wa,Oo=Fo*Wa;var Ga=H;Ga.x=Wo,Ga.y=Go,Ga.z=Oo}var Oa=this.tmp;return this._distanceSq=Oa.x*Oa.x+Oa.y*Oa.y+Oa.z*Oa.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!Z},setAdjacentTriangle:function(e){for(var t=0,l=0;3>l;)for(var c=l++,a=0;3>a;){var p=a++,s=this._nextIndex[c],_=this._nextIndex[p];this._vertices[c]==e._vertices[_]&&this._vertices[s]==e._vertices[p]&&(this._adjacentTriangles[c]=e,this._adjacentPairIndex[c]=p,e._adjacentTriangles[p]=this,e._adjacentPairIndex[p]=c,++t)}return 1==t},removeAdjacentTriangles:function(){for(var n=0;3>n;){var _=n++,i=this._adjacentTriangles[_];if(null!=i){var o=this._adjacentPairIndex[_];i._adjacentTriangles[o]=null,i._adjacentPairIndex[o]=-1,this._adjacentTriangles[_]=null,this._adjacentPairIndex[_]=-1}}},removeReferences:function(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0},dump:function(){}};var oimo_collision_narrowphase_detector_gjkepa_EpaVertex=function(){this.randId=0|1e5*Math.random(),this.v=new oimo_common_Vec3,this.w1=new oimo_common_Vec3,this.w2=new oimo_common_Vec3};oimo_collision_narrowphase_detector_gjkepa_EpaVertex.prototype={init:function(_,t,i){var o=this.v;o.x=_.x,o.y=_.y,o.z=_.z;var a=this.w1;a.x=t.x,a.y=t.y,a.z=t.z;var n=this.w2;return n.x=i.x,n.y=i.y,n.z=i.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this},removeReferences:function(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};var oimo_collision_narrowphase_detector_gjkepa_GjkCache=function(){this.prevClosestDir=new oimo_common_Vec3};oimo_collision_narrowphase_detector_gjkepa_GjkCache.prototype={clear:function(){this.prevClosestDir.zero()}};var oimo_common_Vec3=function(a,n,_){null==_&&(_=0),null==n&&(n=0),null==a&&(a=0),this.x=a,this.y=n,this.z=_,oimo_common_Vec3.numCreations++};oimo_common_Vec3.prototype={init:function(a,t,i){return this.x=a,this.y=t,this.z=i,this},zero:function(){return this.x=0,this.y=0,this.z=0,this},add:function(o){return new oimo_common_Vec3(this.x+o.x,this.y+o.y,this.z+o.z)},addScaled:function(o,t){return new oimo_common_Vec3(this.x+o.x*t,this.y+o.y*t,this.z+o.z*t)},sub:function(o){return new oimo_common_Vec3(this.x-o.x,this.y-o.y,this.z-o.z)},scale:function(o){return new oimo_common_Vec3(this.x*o,this.y*o,this.z*o)},scale3:function(a,t,i){return new oimo_common_Vec3(this.x*a,this.y*t,this.z*i)},dot:function(o){return this.x*o.x+this.y*o.y+this.z*o.z},cross:function(o){return new oimo_common_Vec3(this.y*o.z-this.z*o.y,this.z*o.x-this.x*o.z,this.x*o.y-this.y*o.x)},addEq:function(n){var t=this.x+n.x,i=this.y+n.y,o=this.z+n.z;return this.x=t,this.y=i,this.z=o,this},addScaledEq:function(_,t){var i=this.x+_.x*t,o=this.y+_.y*t,a=this.z+_.z*t;return this.x=i,this.y=o,this.z=a,this},subEq:function(n){var t=this.x-n.x,i=this.y-n.y,o=this.z-n.z;return this.x=t,this.y=i,this.z=o,this},scaleEq:function(n){var t=this.x*n,i=this.y*n,o=this.z*n;return this.x=t,this.y=i,this.z=o,this},scale3Eq:function(_,t,i){var o=this.x*_,a=this.y*t,n=this.z*i;return this.x=o,this.y=a,this.z=n,this},crossEq:function(n){var t=this.y*n.z-this.z*n.y,i=this.z*n.x-this.x*n.z,o=this.x*n.y-this.y*n.x;return this.x=t,this.y=i,this.z=o,this},mulMat3:function(o){return new oimo_common_Vec3(this.x*o.e00+this.y*o.e01+this.z*o.e02,this.x*o.e10+this.y*o.e11+this.z*o.e12,this.x*o.e20+this.y*o.e21+this.z*o.e22)},mulMat4:function(o){return new oimo_common_Vec3(this.x*o.e00+this.y*o.e01+this.z*o.e02+o.e03,this.x*o.e10+this.y*o.e11+this.z*o.e12+o.e13,this.x*o.e20+this.y*o.e21+this.z*o.e22+o.e23)},mulTransform:function(l){var t,c,p,m,b,x;t=this.x,c=this.y,p=this.z,m=l._rotation00*t+l._rotation01*c+l._rotation02*p,b=l._rotation10*t+l._rotation11*c+l._rotation12*p,x=l._rotation20*t+l._rotation21*c+l._rotation22*p,t=m,c=b,p=x,t+=l._positionX,c+=l._positionY,p+=l._positionZ;var d=new oimo_common_Vec3,r=d;return r.x=t,r.y=c,r.z=p,d},mulMat3Eq:function(n){var t=this.x*n.e00+this.y*n.e01+this.z*n.e02,i=this.x*n.e10+this.y*n.e11+this.z*n.e12,o=this.x*n.e20+this.y*n.e21+this.z*n.e22;return this.x=t,this.y=i,this.z=o,this},mulMat4Eq:function(n){var t=this.x*n.e00+this.y*n.e01+this.z*n.e02+n.e03,i=this.x*n.e10+this.y*n.e11+this.z*n.e12+n.e13,o=this.x*n.e20+this.y*n.e21+this.z*n.e22+n.e23;return this.x=t,this.y=i,this.z=o,this},mulTransformEq:function(e){var t,r,l,c,p,m;return t=this.x,r=this.y,l=this.z,c=e._rotation00*t+e._rotation01*r+e._rotation02*l,p=e._rotation10*t+e._rotation11*r+e._rotation12*l,m=e._rotation20*t+e._rotation21*r+e._rotation22*l,t=c,r=p,l=m,t+=e._positionX,r+=e._positionY,l+=e._positionZ,(this.x=t,this.y=r,this.z=l,this)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalized:function(){var o=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0<o&&(o=1/o),new oimo_common_Vec3(this.x*o,this.y*o,this.z*o)},normalize:function(){var n=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);0<n&&(n=1/n);var _=this.x*n,i=this.y*n,o=this.z*n;return this.x=_,this.y=i,this.z=o,this},negate:function(){return new oimo_common_Vec3(-this.x,-this.y,-this.z)},negateEq:function(){var a=-this.x,t=-this.y,i=-this.z;return this.x=a,this.y=t,this.z=i,this},copyFrom:function(o){return this.x=o.x,this.y=o.y,this.z=o.z,this},clone:function(){return new oimo_common_Vec3(this.x,this.y,this.z)},toString:function(){return"Vec3["+(0<this.x?(0|1e7*this.x+.5)/1e7:(0|1e7*this.x-.5)/1e7)+", "+(0<this.y?(0|1e7*this.y+.5)/1e7:(0|1e7*this.y-.5)/1e7)+", "+(0<this.z?(0|1e7*this.z+.5)/1e7:(0|1e7*this.z-.5)/1e7)+"]"}};var oimo_common_Transform=function(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1};oimo_common_Transform.prototype={identity:function(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this},getPosition:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,o},getPositionTo:function(o){var t=o;t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ},setPosition:function(o){var t=o;return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this},translate:function(_){var t=_,n,e,r;n=t.x,e=t.y,r=t.z,this._positionX+=n,this._positionY+=e,this._positionZ+=r},getRotation:function(){var o=new oimo_common_Mat3,t=o;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,o},getRotationTo:function(o){var t=o;t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22},setRotation:function(o){var t=o;return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this},setRotationXyz:function(c){var t=c,n,p,m;n=t.x,p=t.y,m=t.z;var b=Math.sin(n),s=Math.sin(p),_=Math.sin(m),r=Math.cos(n),e=Math.cos(p),x=Math.cos(m);this._rotation00=e*x,this._rotation01=-e*_,this._rotation02=s,this._rotation10=r*_+x*b*s,this._rotation11=r*x-b*s*_,this._rotation12=-e*b,this._rotation20=b*_-r*x*s,this._rotation21=x*b+r*s*_,this._rotation22=r*e},rotate:function(g){var t=g,x,X,u,z,Y,Z,I,M,V,L,B,k,A,P,T,w,S,C;x=t.e00,X=t.e01,u=t.e02,z=t.e10,Y=t.e11,Z=t.e12,I=t.e20,M=t.e21,V=t.e22,L=x*this._rotation00+X*this._rotation10+u*this._rotation20,B=x*this._rotation01+X*this._rotation11+u*this._rotation21,k=x*this._rotation02+X*this._rotation12+u*this._rotation22,A=z*this._rotation00+Y*this._rotation10+Z*this._rotation20,P=z*this._rotation01+Y*this._rotation11+Z*this._rotation21,T=z*this._rotation02+Y*this._rotation12+Z*this._rotation22,w=I*this._rotation00+M*this._rotation10+V*this._rotation20,S=I*this._rotation01+M*this._rotation11+V*this._rotation21,C=I*this._rotation02+M*this._rotation12+V*this._rotation22,this._rotation00=L,this._rotation01=B,this._rotation02=k,this._rotation10=A,this._rotation11=P,this._rotation12=T,this._rotation20=w,this._rotation21=S,this._rotation22=C},rotateXyz:function(L){var t=L,p,B,k,A,P,T,w,S,C,q,R,E;p=t.x,B=t.y,k=t.z;var j=Math.sin(p),X=Math.sin(B),z=Math.sin(k),Y=Math.cos(p),Z=Math.cos(B),I=Math.cos(k),V,N,F,D,W,G,O,H,J;P=-Z*z,T=X,w=Y*z+I*j*X,S=Y*I-j*X*z,C=-Z*j,q=j*z-Y*I*X,R=I*j+Y*X*z,E=Y*Z,V=(A=Z*I)*this._rotation00+P*this._rotation10+T*this._rotation20,N=A*this._rotation01+P*this._rotation11+T*this._rotation21,F=A*this._rotation02+P*this._rotation12+T*this._rotation22,D=w*this._rotation00+S*this._rotation10+C*this._rotation20,W=w*this._rotation01+S*this._rotation11+C*this._rotation21,G=w*this._rotation02+S*this._rotation12+C*this._rotation22,O=q*this._rotation00+R*this._rotation10+E*this._rotation20,H=q*this._rotation01+R*this._rotation11+E*this._rotation21,J=q*this._rotation02+R*this._rotation12+E*this._rotation22,this._rotation00=V,this._rotation01=N,this._rotation02=F,this._rotation10=D,this._rotation11=W,this._rotation12=G,this._rotation20=O,this._rotation21=H,this._rotation22=J},getOrientation:function(){var c=new oimo_common_Quat,s=this._rotation00,_=this._rotation11,r=this._rotation22,e=s+_+r,p,m,b,x,d;0<e?(x=.5*(d=Math.sqrt(e+1)),d=.5/d,p=(this._rotation21-this._rotation12)*d,m=(this._rotation02-this._rotation20)*d,b=(this._rotation10-this._rotation01)*d):s>_?s>r?(p=.5*(d=Math.sqrt(s-_-r+1)),d=.5/d,m=(this._rotation01+this._rotation10)*d,b=(this._rotation02+this._rotation20)*d,x=(this._rotation21-this._rotation12)*d):(b=.5*(d=Math.sqrt(r-s-_+1)),d=.5/d,p=(this._rotation02+this._rotation20)*d,m=(this._rotation12+this._rotation21)*d,x=(this._rotation10-this._rotation01)*d):_>r?(m=.5*(d=Math.sqrt(_-r-s+1)),d=.5/d,p=(this._rotation01+this._rotation10)*d,b=(this._rotation12+this._rotation21)*d,x=(this._rotation02-this._rotation20)*d):(b=.5*(d=Math.sqrt(r-s-_+1)),d=.5/d,p=(this._rotation02+this._rotation20)*d,m=(this._rotation12+this._rotation21)*d,x=(this._rotation10-this._rotation01)*d);var y=c;return y.x=p,y.y=m,y.z=b,y.w=x,c},getOrientationTo:function(c){var t=this._rotation00,_=this._rotation11,r=this._rotation22,e=t+_+r,p,m,b,x,d;0<e?(x=.5*(d=Math.sqrt(e+1)),d=.5/d,p=(this._rotation21-this._rotation12)*d,m=(this._rotation02-this._rotation20)*d,b=(this._rotation10-this._rotation01)*d):t>_?t>r?(p=.5*(d=Math.sqrt(t-_-r+1)),d=.5/d,m=(this._rotation01+this._rotation10)*d,b=(this._rotation02+this._rotation20)*d,x=(this._rotation21-this._rotation12)*d):(b=.5*(d=Math.sqrt(r-t-_+1)),d=.5/d,p=(this._rotation02+this._rotation20)*d,m=(this._rotation12+this._rotation21)*d,x=(this._rotation10-this._rotation01)*d):_>r?(m=.5*(d=Math.sqrt(_-r-t+1)),d=.5/d,p=(this._rotation01+this._rotation10)*d,b=(this._rotation12+this._rotation21)*d,x=(this._rotation02-this._rotation20)*d):(b=.5*(d=Math.sqrt(r-t-_+1)),d=.5/d,p=(this._rotation02+this._rotation20)*d,m=(this._rotation12+this._rotation21)*d,x=(this._rotation10-this._rotation01)*d);var y=c;y.x=p,y.y=m,y.z=b,y.w=x},setOrientation:function(x){var t=x,s=(f=t.x,v=t.y,X=t.z,u=t.w,2*f),_=2*v,r=2*X,e=f*s,d=v*_,l=X*r,c=f*_,m=v*r,p=f*r,g=u*s,y=u*_,b=u*r,f,v,X,u;return this._rotation00=1-d-l,this._rotation01=c-b,this._rotation02=p+y,this._rotation10=c+b,this._rotation11=1-e-l,this._rotation12=m-g,this._rotation20=p-y,this._rotation21=m+g,this._rotation22=1-e-d,this},clone:function(){var o=new oimo_common_Transform;return o._positionX=this._positionX,o._positionY=this._positionY,o._positionZ=this._positionZ,o._rotation00=this._rotation00,o._rotation01=this._rotation01,o._rotation02=this._rotation02,o._rotation10=this._rotation10,o._rotation11=this._rotation11,o._rotation12=this._rotation12,o._rotation20=this._rotation20,o._rotation21=this._rotation21,o._rotation22=this._rotation22,o},copyFrom:function(o){return this._positionX=o._positionX,this._positionY=o._positionY,this._positionZ=o._positionZ,this._rotation00=o._rotation00,this._rotation01=o._rotation01,this._rotation02=o._rotation02,this._rotation10=o._rotation10,this._rotation11=o._rotation11,this._rotation12=o._rotation12,this._rotation20=o._rotation20,this._rotation21=o._rotation21,this._rotation22=o._rotation22,this}};var oimo_common_Setting=function(){},oimo_collision_narrowphase_detector_gjkepa_GjkEpa=function(){var _=[,,,,];this.s=_;var t=[,,,,];this.w1=t;var i=[,,,,];this.w2=i;var o=[,,,];this.baseDirs=o,this.baseDirs[0]=new oimo_common_Vec3(1,0,0),this.baseDirs[1]=new oimo_common_Vec3(0,1,0),this.baseDirs[2]=new oimo_common_Vec3(0,0,1),this.tl1=new oimo_common_Vec3,this.tl2=new oimo_common_Vec3,this.rayX=new oimo_common_Vec3,this.rayR=new oimo_common_Vec3,this.tempTransform=new oimo_common_Transform;for(var a=0,e;4>a;)e=a++,this.s[e]=new oimo_common_Vec3,this.w1[e]=new oimo_common_Vec3,this.w2[e]=new oimo_common_Vec3;this.dir=new oimo_common_Vec3,this.closest=new oimo_common_Vec3,this.closestPoint1=new oimo_common_Vec3,this.closestPoint2=new oimo_common_Vec3,this.polyhedron=new oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedron};oimo_collision_narrowphase_detector_gjkepa_GjkEpa.getInstance=function(){return oimo_collision_narrowphase_detector_gjkepa_GjkEpa.instance},oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype={computeClosestPointsImpl:function(pl,t,i,o,a,n){this.c1=pl,this.c2=t,this.tf1=i,this.tf2=o;var s=this.s,_=this.w1,r=this.w2,e=this.closest,h=this.dir;if(null==a?h.zero():(null==a._gjkCache&&(a._gjkCache=new oimo_collision_narrowphase_detector_gjkepa_GjkCache),this.loadCache(a._gjkCache)),0==h.x*h.x+h.y*h.y+h.z*h.z){var l,ml,bl;l=o._positionX-i._positionX,ml=o._positionY-i._positionY,bl=o._positionZ-i._positionZ;var xl=h;xl.x=l,xl.y=ml,xl.z=bl,1e-6>h.x*h.x+h.y*h.y+h.z*h.z&&h.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var v=this.s[this.simplexSize],y=this.w1[this.simplexSize];v.x=y.x,v.y=y.y,v.z=y.z;var b=v,f=this.w2[this.simplexSize],d=b.x-f.x,x=b.y-f.y,u=b.z-f.z;b.x=d,b.y=x,b.z=u,this.simplexSize=1;for(var g=0,dl;40>g;){switch(dl=0,this.simplexSize){case 1:var yl=s[0];e.x=yl.x,e.y=yl.y,e.z=yl.z,dl=1;break;case 2:var z=s[0],B,fl,gl,vl,Xl,ul;B=z.x,fl=z.y,gl=z.z;var zl=s[1],S=(Yl=(vl=zl.x)-B)*B+(Zl=(Xl=zl.y)-fl)*fl+(Il=(ul=zl.z)-gl)*gl,Yl,Zl,Il;if(0>(S=-S/(Yl*Yl+Zl*Zl+Il*Il))){var Ml=e;Ml.x=B,Ml.y=fl,Ml.z=gl,dl=1}else if(1<S){var T=e;T.x=vl,T.y=Xl,T.z=ul,dl=2}else{var j,Vl,Ll;j=B+Yl*S,Vl=fl+Zl*S,Ll=gl+Il*S;var Bl=e;Bl.x=j,Bl.y=Vl,Bl.z=Ll,dl=3}break;case 3:var D=s[0],rt=s[1],et=s[2],ht=D,lt,kl,Al,Pl,Tl,wl,Sl,Cl,ql,Rl,El,jl,Nl,Fl,Dl,Wl,Gl,Ol;lt=ht.x,kl=ht.y,Al=ht.z;var Hl=rt;Pl=Hl.x,Tl=Hl.y,wl=Hl.z;var ct=et,yt,Jl,Ul;Sl=ct.x;var Ql=Pl*((Fl=(Cl=ct.y)-Tl)*(Ul=(Rl=Pl-lt)*Fl-(El=Tl-kl)*(Nl=Sl-Pl))-(Dl=(ql=ct.z)-wl)*(Jl=(jl=wl-Al)*Nl-Rl*Dl))+Tl*(Dl*(yt=El*Dl-jl*Fl)-Nl*Ul)+wl*(Nl*Jl-Fl*yt),xt=Sl*((Gl=kl-Cl)*Ul-(Ol=Al-ql)*Jl)+Cl*(Ol*yt-(Wl=lt-Sl)*Ul)+ql*(Wl*Jl-Gl*yt),ut=-1,Kl=0,$l,tc,oc;if($l=0,tc=0,oc=0,0>lt*(El*Ul-jl*Jl)+kl*(jl*yt-Rl*Ul)+Al*(Rl*Jl-El*yt)){var ac=D,Lt,ic,nc,_c,ec,rc;Lt=ac.x,ic=ac.y,nc=ac.z;var sc=rt,Pt=(lc=(_c=sc.x)-Lt)*Lt+(cc=(ec=sc.y)-ic)*ic+(pc=(rc=sc.z)-nc)*nc,lc,cc,pc,mc;if(0>(Pt=-Pt/(lc*lc+cc*cc+pc*pc))){var bc=e;bc.x=Lt,bc.y=ic,bc.z=nc,mc=1}else if(1<Pt){var Ct=e;Ct.x=_c,Ct.y=ec,Ct.z=rc,mc=2}else{var Tt,xc,dc;Tt=Lt+lc*Pt,xc=ic+cc*Pt,dc=nc+pc*Pt;var yc=e;yc.x=Tt,yc.y=xc,yc.z=dc,mc=3}Kl=mc,ut=e.x*e.x+e.y*e.y+e.z*e.z;var Et=e;$l=Et.x,tc=Et.y,oc=Et.z}if(0>Ql){var Dt=rt,Ut,fc,gc,vc,Xc,uc;Ut=Dt.x,fc=Dt.y,gc=Dt.z;var zc=et,ti=(Yc=(vc=zc.x)-Ut)*Ut+(Zc=(Xc=zc.y)-fc)*fc+(Ic=(uc=zc.z)-gc)*gc,Yc,Zc,Ic,Mc;if(0>(ti=-ti/(Yc*Yc+Zc*Zc+Ic*Ic))){var hc=e;hc.x=Ut,hc.y=fc,hc.z=gc,Mc=1}else if(1<ti){var oi=e;oi.x=vc,oi.y=Xc,oi.z=uc,Mc=2}else{var ai,Vc,Lc;ai=Ut+Yc*ti,Vc=fc+Zc*ti,Lc=gc+Ic*ti;var Bc=e;Bc.x=ai,Bc.y=Vc,Bc.z=Lc,Mc=3}var ri=e.x*e.x+e.y*e.y+e.z*e.z;if(0>ut||ri<ut){Kl=Mc<<1,ut=ri;var ei=e;$l=ei.x,tc=ei.y,oc=ei.z}}if(0>xt){var hi=D,bi,kc,Ac,Pc,Tc,wc;bi=hi.x,kc=hi.y,Ac=hi.z;var Sc=et,gi=(Cc=(Pc=Sc.x)-bi)*bi+(qc=(Tc=Sc.y)-kc)*kc+(Rc=(wc=Sc.z)-Ac)*Ac,Cc,qc,Rc,Ec;if(0>(gi=-gi/(Cc*Cc+qc*qc+Rc*Rc))){var jc=e;jc.x=bi,jc.y=kc,jc.z=Ac,Ec=1}else if(1<gi){var Xi=e;Xi.x=Pc,Xi.y=Tc,Xi.z=wc,Ec=2}else{var zi,Nc,Fc;zi=bi+Cc*gi,Nc=kc+qc*gi,Fc=Ac+Rc*gi;var Dc=e;Dc.x=zi,Dc.y=Nc,Dc.z=Fc,Ec=3}var Vi=e.x*e.x+e.y*e.y+e.z*e.z;if(0>ut||Vi<ut){Kl=1&Ec|(2&Ec)<<1,ut=Vi;var Li=e;$l=Li.x,tc=Li.y,oc=Li.z}}if(0<ut){var wi=e;wi.x=$l,wi.y=tc,wi.z=oc,dl=Kl}else{var Bi=yt*yt+Jl*Jl+Ul*Ul;0<Bi&&(Bi=1/Math.sqrt(Bi));var Wc=(yt*=Bi)*yt+(Jl*=Bi)*Jl+(Ul*=Bi)*Ul;$l=yt*(Wc=(lt*yt+kl*Jl+Al*Ul)/Wc),tc=Jl*Wc,oc=Ul*Wc;var Gc=e;Gc.x=$l,Gc.y=tc,Gc.z=oc,dl=7}break;case 4:var Pi=s[0],eo=s[1],ho=s[2],lo=s[3],co=Pi,mo,Oc,Hc,Jc,Uc,Qc,Kc,$c,tp,op,ap,ip,np,_p,ep,rp,sp,lp,cp,pp,mp,bp,xp,dp,yp,fp,gp;mo=co.x,Oc=co.y,Hc=co.z;var vp=eo;Jc=vp.x,Uc=vp.y,Qc=vp.z;var po=ho;Kc=po.x,$c=po.y,tp=po.z;var vo=lo,xo,Xp,up;(op=vo.x)-Kc,(ap=vo.y)-$c,(ip=vo.z)-tp;var zp=0<(np=Jc-mo)*(xo=(fp=ap-Uc)*(dp=tp-Qc)-(gp=ip-Qc)*(xp=$c-Uc))+(_p=Uc-Oc)*(Xp=gp*(bp=Kc-Jc)-(yp=op-Jc)*dp)+(ep=Qc-Hc)*(up=yp*xp-fp*bp)?1:-1,Xo=mo*((sp=$c-Oc)*(mp=ip-Hc)-(lp=tp-Hc)*(pp=ap-Oc))+Oc*(lp*(cp=op-mo)-(rp=Kc-mo)*mp)+Hc*(rp*pp-sp*cp),zo=mo*(pp*ep-mp*_p)+Oc*(mp*np-cp*ep)+Hc*(cp*_p-pp*np),Yo=Jc*xo+Uc*Xp+Qc*up,Zo=-1,Yp=0,Zp,Ip,Mp;if(Zp=0,Ip=0,Mp=0,0>(mo*(_p*lp-ep*sp)+Oc*(ep*rp-np*lp)+Hc*(np*sp-_p*rp))*zp){var hp=Pi,Oo,Vp,Lp,Bp,kp,Ap,Pp,Tp,wp,Sp,Cp,qp,Rp,Ep,jp,Np,Fp,Dp;Oo=hp.x,Vp=hp.y,Lp=hp.z;var Wp=eo;Bp=Wp.x,kp=Wp.y,Ap=Wp.z;var Wo=ho,$o,Gp,Op;Pp=Wo.x;var Hp=Bp*((Ep=(Tp=Wo.y)-kp)*(Op=(Sp=Bp-Oo)*Ep-(Cp=kp-Vp)*(Rp=Pp-Bp))-(jp=(wp=Wo.z)-Ap)*(Gp=(qp=Ap-Lp)*Rp-Sp*jp))+kp*(jp*($o=Cp*jp-qp*Ep)-Rp*Op)+Ap*(Rp*Gp-Ep*$o),aa=Pp*((Fp=Vp-Tp)*Op-(Dp=Lp-wp)*Gp)+Tp*(Dp*$o-(Np=Oo-Pp)*Op)+wp*(Np*Gp-Fp*$o),na=-1,Jp=0,Up,Qp,Kp,$p;if(Up=0,Qp=0,Kp=0,0>Oo*(Cp*Op-qp*Gp)+Vp*(qp*$o-Sp*Op)+Lp*(Sp*Gp-Cp*$o)){var tm=Pi,pa,om,am,im,nm,_m;pa=tm.x,om=tm.y,am=tm.z;var em=eo,da=(rm=(im=em.x)-pa)*pa+(sm=(nm=em.y)-om)*om+(lm=(_m=em.z)-am)*am,rm,sm,lm,cm;if(0>(da=-da/(rm*rm+sm*sm+lm*lm))){var pm=e;pm.x=pa,pm.y=om,pm.z=am,cm=1}else if(1<da){var ua=e;ua.x=im,ua.y=nm,ua.z=_m,cm=2}else{var ga,mm,bm;ga=pa+rm*da,mm=om+sm*da,bm=am+lm*da;var xm=e;xm.x=ga,xm.y=mm,xm.z=bm,cm=3}Jp=cm,na=e.x*e.x+e.y*e.y+e.z*e.z;var Ya=e;Up=Ya.x,Qp=Ya.y,Kp=Ya.z}if(0>Hp){var Za=eo,Aa,dm,ym,fm,gm,vm;Aa=Za.x,dm=Za.y,ym=Za.z;var Xm=ho,ja=(um=(fm=Xm.x)-Aa)*Aa+(zm=(gm=Xm.y)-dm)*dm+(Ym=(vm=Xm.z)-ym)*ym,um,zm,Ym,Zm;if(0>(ja=-ja/(um*um+zm*zm+Ym*Ym))){var Im=e;Im.x=Aa,Im.y=dm,Im.z=ym,Zm=1}else if(1<ja){var qa=e;qa.x=fm,qa.y=gm,qa.z=vm,Zm=2}else{var Ea,Mm,hm;Ea=Aa+um*ja,Mm=dm+zm*ja,hm=ym+Ym*ja;var Vm=e;Vm.x=Ea,Vm.y=Mm,Vm.z=hm,Zm=3}var Na=e.x*e.x+e.y*e.y+e.z*e.z;if(0>na||Na<na){Jp=Zm<<1,na=Na;var Ga=e;Up=Ga.x,Qp=Ga.y,Kp=Ga.z}}if(0>aa){var Oa=Pi,tn,Lm,Bm,km,Am,Pm;tn=Oa.x,Lm=Oa.y,Bm=Oa.z;var Tm=ho,_n=(wm=(km=Tm.x)-tn)*tn+(Sm=(Am=Tm.y)-Lm)*Lm+(Cm=(Pm=Tm.z)-Bm)*Bm,wm,Sm,Cm,qm;if(0>(_n=-_n/(wm*wm+Sm*Sm+Cm*Cm))){var Rm=e;Rm.x=tn,Rm.y=Lm,Rm.z=Bm,qm=1}else if(1<_n){var en=e;en.x=km,en.y=Am,en.z=Pm,qm=2}else{var hn,Em,jm;hn=tn+wm*_n,Em=Lm+Sm*_n,jm=Bm+Cm*_n;var Nm=e;Nm.x=hn,Nm.y=Em,Nm.z=jm,qm=3}var pn=e.x*e.x+e.y*e.y+e.z*e.z;if(0>na||pn<na){Jp=1&qm|(2&qm)<<1,na=pn;var vn=e;Up=vn.x,Qp=vn.y,Kp=vn.z}}if(0<na){var yn=e;yn.x=Up,yn.y=Qp,yn.z=Kp,$p=Jp}else{var bn=$o*$o+Gp*Gp+Op*Op;0<bn&&(bn=1/Math.sqrt(bn));var Fm=($o*=bn)*$o+(Gp*=bn)*Gp+(Op*=bn)*Op;Up=$o*(Fm=(Oo*$o+Vp*Gp+Lp*Op)/Fm),Qp=Gp*Fm,Kp=Op*Fm;var Dm=e;Dm.x=Up,Dm.y=Qp,Dm.z=Kp,$p=7}Yp=$p,Zo=e.x*e.x+e.y*e.y+e.z*e.z;var xn=e;Zp=xn.x,Ip=xn.y,Mp=xn.z}if(0>Xo*zp){var un=Pi,Rn,Wm,Gm,Om,Hm,Jm,Um,Qm,Km,$m,tb,ob,ab,ib,nb,_b,eb,rb;Rn=un.x,Wm=un.y,Gm=un.z;var sb=ho;Om=sb.x,Hm=sb.y,Jm=sb.z;var qn=lo,Fn,lb,cb;Um=qn.x;var pb=Om*((ib=(Qm=qn.y)-Hm)*(cb=($m=Om-Rn)*ib-(tb=Hm-Wm)*(ab=Um-Om))-(nb=(Km=qn.z)-Jm)*(lb=(ob=Jm-Gm)*ab-$m*nb))+Hm*(nb*(Fn=tb*nb-ob*ib)-ab*cb)+Jm*(ab*lb-ib*Fn),Un=Um*((eb=Wm-Qm)*cb-(rb=Gm-Km)*lb)+Qm*(rb*Fn-(_b=Rn-Um)*cb)+Km*(_b*lb-eb*Fn),Hn=-1,mb=0,bb,xb,db,yb;if(bb=0,xb=0,db=0,0>Rn*(tb*cb-ob*lb)+Wm*(ob*Fn-$m*cb)+Gm*($m*lb-tb*Fn)){var fb=Pi,ss,gb,vb,Xb,ub,zb;ss=fb.x,gb=fb.y,vb=fb.z;var Yb=ho,ls=(Zb=(Xb=Yb.x)-ss)*ss+(Ib=(ub=Yb.y)-gb)*gb+(Mb=(zb=Yb.z)-vb)*vb,Zb,Ib,Mb,hb;if(0>(ls=-ls/(Zb*Zb+Ib*Ib+Mb*Mb))){var Vb=e;Vb.x=ss,Vb.y=gb,Vb.z=vb,hb=1}else if(1<ls){var ms=e;ms.x=Xb,ms.y=ub,ms.z=zb,hb=2}else{var ps,Lb,Bb;ps=ss+Zb*ls,Lb=gb+Ib*ls,Bb=vb+Mb*ls;var kb=e;kb.x=ps,kb.y=Lb,kb.z=Bb,hb=3}mb=hb,Hn=e.x*e.x+e.y*e.y+e.z*e.z;var fs=e;bb=fs.x,xb=fs.y,db=fs.z}if(0>pb){var ds=ho,Ys,Ab,Pb,Tb,wb,Sb;Ys=ds.x,Ab=ds.y,Pb=ds.z;var Cb=lo,ws=(qb=(Tb=Cb.x)-Ys)*Ys+(Rb=(wb=Cb.y)-Ab)*Ab+(Eb=(Sb=Cb.z)-Pb)*Pb,qb,Rb,Eb,jb;if(0>(ws=-ws/(qb*qb+Rb*Rb+Eb*Eb))){var Nb=e;Nb.x=Ys,Nb.y=Ab,Nb.z=Pb,jb=1}else if(1<ws){var ks=e;ks.x=Tb,ks.y=wb,ks.z=Sb,jb=2}else{var As,Fb,Db;As=Ys+qb*ws,Fb=Ab+Rb*ws,Db=Pb+Eb*ws;var Wb=e;Wb.x=As,Wb.y=Fb,Wb.z=Db,jb=3}var Ts=e.x*e.x+e.y*e.y+e.z*e.z;if(0>Hn||Ts<Hn){mb=jb<<1,Hn=Ts;var js=e;bb=js.x,xb=js.y,db=js.z}}if(0>Un){var Rs=Pi,Gs,Gb,Ob,Hb,Jb,Ub;Gs=Rs.x,Gb=Rs.y,Ob=Rs.z;var Qb=lo,Qs=(Kb=(Hb=Qb.x)-Gs)*Gs+($b=(Jb=Qb.y)-Gb)*Gb+(tx=(Ub=Qb.z)-Ob)*Ob,Kb,$b,tx,ox;if(0>(Qs=-Qs/(Kb*Kb+$b*$b+tx*tx))){var ax=e;ax.x=Gs,ax.y=Gb,ax.z=Ob,ox=1}else if(1<Qs){var Ks=e;Ks.x=Hb,Ks.y=Jb,Ks.z=Ub,ox=2}else{var t_,ix,nx;t_=Gs+Kb*Qs,ix=Gb+$b*Qs,nx=Ob+tx*Qs;var _x=e;_x.x=t_,_x.y=ix,_x.z=nx,ox=3}var n_=e.x*e.x+e.y*e.y+e.z*e.z;if(0>Hn||n_<Hn){mb=1&ox|(2&ox)<<1,Hn=n_;var s_=e;bb=s_.x,xb=s_.y,db=s_.z}}if(0<Hn){var __=e;__.x=bb,__.y=xb,__.z=db,yb=mb}else{var r_=Fn*Fn+lb*lb+cb*cb;0<r_&&(r_=1/Math.sqrt(r_));var ex=(Fn*=r_)*Fn+(lb*=r_)*lb+(cb*=r_)*cb;bb=Fn*(ex=(Rn*Fn+Wm*lb+Gm*cb)/ex),xb=lb*ex,db=cb*ex;var rx=e;rx.x=bb,rx.y=xb,rx.z=db,yb=7}var l_=e.x*e.x+e.y*e.y+e.z*e.z;if(0>Zo||l_<Zo){Yp=1&yb|(6&yb)<<1,Zo=l_;var c_=e;Zp=c_.x,Ip=c_.y,Mp=c_.z}}if(0>zo*zp){var m_=Pi,B_,sx,lx,cx,px,mx,bx,xx,dx,yx,fx,gx,vx,Xx,ux,zx,Yx,Zx;B_=m_.x,sx=m_.y,lx=m_.z;var Ix=eo;cx=Ix.x,px=Ix.y,mx=Ix.z;var k_=lo,C_,Mx,hx;bx=k_.x;var Vx=cx*((Xx=(xx=k_.y)-px)*(hx=(yx=cx-B_)*Xx-(fx=px-sx)*(vx=bx-cx))-(ux=(dx=k_.z)-mx)*(Mx=(gx=mx-lx)*vx-yx*ux))+px*(ux*(C_=fx*ux-gx*Xx)-vx*hx)+mx*(vx*Mx-Xx*C_),E_=bx*((Yx=sx-xx)*hx-(Zx=lx-dx)*Mx)+xx*(Zx*C_-(zx=B_-bx)*hx)+dx*(zx*Mx-Yx*C_),D_=-1,Lx=0,Bx,kx,Ax,Px;if(Bx=0,kx=0,Ax=0,0>B_*(fx*hx-gx*Mx)+sx*(gx*C_-yx*hx)+lx*(yx*Mx-fx*C_)){var Tx=Pi,Q_,wx,Sx,Cx,qx,Rx;Q_=Tx.x,wx=Tx.y,Sx=Tx.z;var Ex=eo,or=(jx=(Cx=Ex.x)-Q_)*Q_+(Nx=(qx=Ex.y)-wx)*wx+(Fx=(Rx=Ex.z)-Sx)*Sx,jx,Nx,Fx,Dx;if(0>(or=-or/(jx*jx+Nx*Nx+Fx*Fx))){var Wx=e;Wx.x=Q_,Wx.y=wx,Wx.z=Sx,Dx=1}else if(1<or){var nr=e;nr.x=Cx,nr.y=qx,nr.z=Rx,Dx=2}else{var sr,Gx,Ox;sr=Q_+jx*or,Gx=wx+Nx*or,Ox=Sx+Fx*or;var Hx=e;Hx.x=sr,Hx.y=Gx,Hx.z=Ox,Dx=3}Lx=Dx,D_=e.x*e.x+e.y*e.y+e.z*e.z;var hr=e;Bx=hr.x,kx=hr.y,Ax=hr.z}if(0>Vx){var lr=eo,fr,Jx,Ux,Qx,Kx,$x;fr=lr.x,Jx=lr.y,Ux=lr.z;var td=lo,Mr=(od=(Qx=td.x)-fr)*fr+(ad=(Kx=td.y)-Jx)*Jx+(id=($x=td.z)-Ux)*Ux,od,ad,id,nd;if(0>(Mr=-Mr/(od*od+ad*ad+id*id))){var _d=e;_d.x=fr,_d.y=Jx,_d.z=Ux,nd=1}else if(1<Mr){var zr=e;zr.x=Qx,zr.y=Kx,zr.z=$x,nd=2}else{var Yr,ed,rd;Yr=fr+od*Mr,ed=Jx+ad*Mr,rd=Ux+id*Mr;var sd=e;sd.x=Yr,sd.y=ed,sd.z=rd,nd=3}var Lr=e.x*e.x+e.y*e.y+e.z*e.z;if(0>D_||Lr<D_){Lx=nd<<1,D_=Lr;var wr=e;Bx=wr.x,kx=wr.y,Ax=wr.z}}if(0>E_){var Br=Pi,jr,ld,cd,pd,md,bd;jr=Br.x,ld=Br.y,cd=Br.z;var xd=lo,Jr=(dd=(pd=xd.x)-jr)*jr+(yd=(md=xd.y)-ld)*ld+(fd=(bd=xd.z)-cd)*cd,dd,yd,fd,gd;if(0>(Jr=-Jr/(dd*dd+yd*yd+fd*fd))){var vd=e;vd.x=jr,vd.y=ld,vd.z=cd,gd=1}else if(1<Jr){var Nr=e;Nr.x=pd,Nr.y=md,Nr.z=bd,gd=2}else{var Gr,Xd,ud;Gr=jr+dd*Jr,Xd=ld+yd*Jr,ud=cd+fd*Jr;var zd=e;zd.x=Gr,zd.y=Xd,zd.z=ud,gd=3}var Hr=e.x*e.x+e.y*e.y+e.z*e.z;if(0>D_||Hr<D_){Lx=1&gd|(2&gd)<<1,D_=Hr;var Qr=e;Bx=Qr.x,kx=Qr.y,Ax=Qr.z}}if(0<D_){var $r=e;$r.x=Bx,$r.y=kx,$r.z=Ax,Px=Lx}else{var Kr=C_*C_+Mx*Mx+hx*hx;0<Kr&&(Kr=1/Math.sqrt(Kr));var Yd=(C_*=Kr)*C_+(Mx*=Kr)*Mx+(hx*=Kr)*hx;Bx=C_*(Yd=(B_*C_+sx*Mx+lx*hx)/Yd),kx=Mx*Yd,Ax=hx*Yd;var Zd=e;Zd.x=Bx,Zd.y=kx,Zd.z=Ax,Px=7}var oe=e.x*e.x+e.y*e.y+e.z*e.z;if(0>Zo||oe<Zo){Yp=3&Px|(4&Px)<<1,Zo=oe;var ae=e;Zp=ae.x,Ip=ae.y,Mp=ae.z}}if(0>Yo*zp){var ne=eo,Xe,Id,Md,hd,Vd,Ld,Bd,kd,Ad,Pd,Td,wd,Sd,Cd,qd,Rd,Ed,jd;Xe=ne.x,Id=ne.y,Md=ne.z;var Nd=ho;hd=Nd.x,Vd=Nd.y,Ld=Nd.z;var ze=lo,Ve,Fd,Dd;Bd=ze.x;var Wd=hd*((Cd=(kd=ze.y)-Vd)*(Dd=(Pd=hd-Xe)*Cd-(Td=Vd-Id)*(Sd=Bd-hd))-(qd=(Ad=ze.z)-Ld)*(Fd=(wd=Ld-Md)*Sd-Pd*qd))+Vd*(qd*(Ve=Td*qd-wd*Cd)-Sd*Dd)+Ld*(Sd*Fd-Cd*Ve),Ae=Bd*((Ed=Id-kd)*Dd-(jd=Md-Ad)*Fd)+kd*(jd*Ve-(Rd=Xe-Bd)*Dd)+Ad*(Rd*Fd-Ed*Ve),Pe=-1,Gd=0,Od,Hd,Jd,Ud;if(Od=0,Hd=0,Jd=0,0>Xe*(Td*Dd-wd*Fd)+Id*(wd*Ve-Pd*Dd)+Md*(Pd*Fd-Td*Ve)){var Qd=eo,Je,Kd,$d,ty,oy,ay;Je=Qd.x,Kd=Qd.y,$d=Qd.z;var iy=ho,We=(ny=(ty=iy.x)-Je)*Je+(_y=(oy=iy.y)-Kd)*Kd+(ey=(ay=iy.z)-$d)*$d,ny,_y,ey,ry;if(0>(We=-We/(ny*ny+_y*_y+ey*ey))){var sy=e;sy.x=Je,sy.y=Kd,sy.z=$d,ry=1}else if(1<We){var He=e;He.x=ty,He.y=oy,He.z=ay,ry=2}else{var Qe,ly,cy;Qe=Je+ny*We,ly=Kd+_y*We,cy=$d+ey*We;var py=e;py.x=Qe,py.y=ly,py.z=cy,ry=3}Gd=ry,Pe=e.x*e.x+e.y*e.y+e.z*e.z;var my=e;Od=my.x,Hd=my.y,Jd=my.z}if(0>Wd){var by=ho,xy,dy,yy,fy,gy,vy;xy=by.x,dy=by.y,yy=by.z;var Xy=lo,uy=(zy=(fy=Xy.x)-xy)*xy+(Yy=(gy=Xy.y)-dy)*dy+(Zy=(vy=Xy.z)-yy)*yy,zy,Yy,Zy,Iy;if(0>(uy=-uy/(zy*zy+Yy*Yy+Zy*Zy))){var My=e;My.x=xy,My.y=dy,My.z=yy,Iy=1}else if(1<uy){var hy=e;hy.x=fy,hy.y=gy,hy.z=vy,Iy=2}else{var Vy,Ly,By;Vy=xy+zy*uy,Ly=dy+Yy*uy,By=yy+Zy*uy;var ky=e;ky.x=Vy,ky.y=Ly,ky.z=By,Iy=3}var Ay=e.x*e.x+e.y*e.y+e.z*e.z;if(0>Pe||Ay<Pe){Gd=Iy<<1,Pe=Ay;var Py=e;Od=Py.x,Hd=Py.y,Jd=Py.z}}if(0>Ae){var Ty=eo,wy,Sy,Cy,qy,Ry,Ey;wy=Ty.x,Sy=Ty.y,Cy=Ty.z;var jy=lo,Ny=(Fy=(qy=jy.x)-wy)*wy+(Dy=(Ry=jy.y)-Sy)*Sy+(Wy=(Ey=jy.z)-Cy)*Cy,Fy,Dy,Wy,Gy;if(0>(Ny=-Ny/(Fy*Fy+Dy*Dy+Wy*Wy))){var Oy=e;Oy.x=wy,Oy.y=Sy,Oy.z=Cy,Gy=1}else if(1<Ny){var Hy=e;Hy.x=qy,Hy.y=Ry,Hy.z=Ey,Gy=2}else{var Jy,Uy,Qy;Jy=wy+Fy*Ny,Uy=Sy+Dy*Ny,Qy=Cy+Wy*Ny;var Ky=e;Ky.x=Jy,Ky.y=Uy,Ky.z=Qy,Gy=3}var $y=e.x*e.x+e.y*e.y+e.z*e.z;if(0>Pe||$y<Pe){Gd=1&Gy|(2&Gy)<<1,Pe=$y;var tf=e;Od=tf.x,Hd=tf.y,Jd=tf.z}}if(0<Pe){var of=e;of.x=Od,of.y=Hd,of.z=Jd,Ud=Gd}else{var af=Ve*Ve+Fd*Fd+Dd*Dd;0<af&&(af=1/Math.sqrt(af));var nf=(Ve*=af)*Ve+(Fd*=af)*Fd+(Dd*=af)*Dd;Od=Ve*(nf=(Xe*Ve+Id*Fd+Md*Dd)/nf),Hd=Fd*nf,Jd=Dd*nf;var _f=e;_f.x=Od,_f.y=Hd,_f.z=Jd,Ud=7}var ef=e.x*e.x+e.y*e.y+e.z*e.z;if(0>Zo||ef<Zo){Yp=Ud<<1,Zo=ef;var rf=e;Zp=rf.x,Ip=rf.y,Mp=rf.z}}if(0<Zo){var sf=e;sf.x=Zp,sf.y=Ip,sf.z=Mp,dl=Yp}else e.zero(),dl=15;}if(1e-8>e.x*e.x+e.y*e.y+e.z*e.z){if(!n)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();}if(4==this.simplexSize){var lf=this.computeDepth(pl,t,i,o,s,_,r);return 0==lf?(this.distance=-this.depth,0):(this.distance=0,lf)}return this.distance=0,1}this.shrinkSimplex(dl),h.x=e.x,h.y=e.y,h.z=e.z;var cf=h,pf=-cf.x,tl=-cf.y,il=-cf.z;cf.x=pf,cf.y=tl,cf.z=il,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var ol=this.s[this.simplexSize],al=this.w1[this.simplexSize];ol.x=al.x,ol.y=al.y,ol.z=al.z;var nl=ol,sl=this.w2[this.simplexSize],_l=nl.x-sl.x,rl=nl.y-sl.y,el=nl.z-sl.z;if(nl.x=_l,nl.y=rl,nl.z=el,1e-8>h.x*h.x+h.y*h.y+h.z*h.z)throw new Error("!?");var hl=e.x*h.x+e.y*h.y+e.z*h.z,ll=s[this.simplexSize];if(1e-8>ll.x*h.x+ll.y*h.y+ll.z*h.z-hl)return this.interpolateClosestPoints(),this.distance=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),null!=a&&null!=a._gjkCache&&this.saveCache(a._gjkCache),0;this.simplexSize++,++g}return 2},convexCastImpl:function(tc,t,i,o,a,n,s){this.c1=tc,this.c2=t,this.tf1=i,this.tf2=o;var _=this.s,l=(this.w1,this.w2,this.closest),c=this.dir,m,oc,ac;m=o._positionX-i._positionX,oc=o._positionY-i._positionY,ac=o._positionZ-i._positionZ;var ic=c;if(ic.x=m,ic.y=oc,ic.z=ac,1e-6>c.x*c.x+c.y*c.y+c.z*c.z&&c.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{var p=this.w1[this.simplexSize];p.x=this.tf1._positionX,p.y=this.tf1._positionY,p.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var v=this.s[this.simplexSize],y=this.w1[this.simplexSize];v.x=y.x,v.y=y.y,v.z=y.z;var b=v,f=this.w2[this.simplexSize],d=b.x-f.x,x=b.y-f.y,u=b.z-f.z;b.x=d,b.y=x,b.z=u,this.simplexSize=1;var g=0,nc=0,_c=this.rayX,z=this.rayR;_c.zero(),z.x=n.x,z.y=n.y,z.z=n.z;var Y=z,Z=Y.x-a.x,I=Y.y-a.y,V=Y.z-a.z;for(Y.x=Z,Y.y=I,Y.z=V;40>g;){var L=0;switch(this.simplexSize){case 1:var ec=_[0];l.x=ec.x,l.y=ec.y,l.z=ec.z,L=1;break;case 2:var B=_[0],j,rc,sc,lc,cc,pc;j=B.x,rc=B.y,sc=B.z;var mc=_[1],D=(bc=(lc=mc.x)-j)*j+(xc=(cc=mc.y)-rc)*rc+(dc=(pc=mc.z)-sc)*sc,bc,xc,dc;if(0>(D=-D/(bc*bc+xc*xc+dc*dc))){var yc=l;yc.x=j,yc.y=rc,yc.z=sc,L=1}else if(1<D){var F=l;F.x=lc,F.y=cc,F.z=pc,L=2}else{var N,fc,gc;N=j+bc*D,fc=rc+xc*D,gc=sc+dc*D;var vc=l;vc.x=N,vc.y=fc,vc.z=gc,L=3}break;case 3:var U=_[0],vt=_[1],yt=_[2],bt=U,ft,Xc,uc,zc,Yc,Zc,Ic,Mc,hc,Vc,Lc,Bc,kc,Ac,Pc,Tc,wc,Sc;ft=bt.x,Xc=bt.y,uc=bt.z;var Cc=vt;zc=Cc.x,Yc=Cc.y,Zc=Cc.z;var dt=yt,Mt,qc,Rc;Ic=dt.x;var Ec=zc*((Ac=(Mc=dt.y)-Yc)*(Rc=(Vc=zc-ft)*Ac-(Lc=Yc-Xc)*(kc=Ic-zc))-(Pc=(hc=dt.z)-Zc)*(qc=(Bc=Zc-uc)*kc-Vc*Pc))+Yc*(Pc*(Mt=Lc*Pc-Bc*Ac)-kc*Rc)+Zc*(kc*qc-Ac*Mt),Zt=Ic*((wc=Xc-Mc)*Rc-(Sc=uc-hc)*qc)+Mc*(Sc*Mt-(Tc=ft-Ic)*Rc)+hc*(Tc*qc-wc*Mt),It=-1,jc=0,Nc,Fc,Dc;if(Nc=0,Fc=0,Dc=0,0>ft*(Lc*Rc-Bc*qc)+Xc*(Bc*Mt-Vc*Rc)+uc*(Vc*qc-Lc*Mt)){var Wc=U,Ct,Gc,Oc,Hc,Jc,Uc;Ct=Wc.x,Gc=Wc.y,Oc=Wc.z;var Qc=vt,Et=(Kc=(Hc=Qc.x)-Ct)*Ct+($c=(Jc=Qc.y)-Gc)*Gc+(tp=(Uc=Qc.z)-Oc)*Oc,Kc,$c,tp,op;if(0>(Et=-Et/(Kc*Kc+$c*$c+tp*tp))){var ap=l;ap.x=Ct,ap.y=Gc,ap.z=Oc,op=1}else if(1<Et){var Jt=l;Jt.x=Hc,Jt.y=Jc,Jt.z=Uc,op=2}else{var Ft,ip,np;Ft=Ct+Kc*Et,ip=Gc+$c*Et,np=Oc+tp*Et;var _p=l;_p.x=Ft,_p.y=ip,_p.z=np,op=3}jc=op,It=l.x*l.x+l.y*l.y+l.z*l.z;var Wt=l;Nc=Wt.x,Fc=Wt.y,Dc=Wt.z}if(0>Ec){var Ut=vt,oi,ep,rp,sp,lp,cp;oi=Ut.x,ep=Ut.y,rp=Ut.z;var pp=yt,ri=(mp=(sp=pp.x)-oi)*oi+(bp=(lp=pp.y)-ep)*ep+(xp=(cp=pp.z)-rp)*rp,mp,bp,xp,dp;if(0>(ri=-ri/(mp*mp+bp*bp+xp*xp))){var yp=l;yp.x=oi,yp.y=ep,yp.z=rp,dp=1}else if(1<ri){var hi=l;hi.x=sp,hi.y=lp,hi.z=cp,dp=2}else{var li,fp,gp;li=oi+mp*ri,fp=ep+bp*ri,gp=rp+xp*ri;var vp=l;vp.x=li,vp.y=fp,vp.z=gp,dp=3}var vi=l.x*l.x+l.y*l.y+l.z*l.z;if(0>It||vi<It){jc=dp<<1,It=vi;var yi=l;Nc=yi.x,Fc=yi.y,Dc=yi.z}}if(0>Zt){var bi=U,Xi,Xp,up,zp,Yp,Zp;Xi=bi.x,Xp=bi.y,up=bi.z;var Ip=yt,Vi=(Mp=(zp=Ip.x)-Xi)*Xi+(hp=(Yp=Ip.y)-Xp)*Xp+(Vp=(Zp=Ip.z)-up)*up,Mp,hp,Vp,Lp;if(0>(Vi=-Vi/(Mp*Mp+hp*hp+Vp*Vp))){var Bp=l;Bp.x=Xi,Bp.y=Xp,Bp.z=up,Lp=1}else if(1<Vi){var wi=l;wi.x=zp,wi.y=Yp,wi.z=Zp,Lp=2}else{var Bi,kp,Ap;Bi=Xi+Mp*Vi,kp=Xp+hp*Vi,Ap=up+Vp*Vi;var Pp=l;Pp.x=Bi,Pp.y=kp,Pp.z=Ap,Lp=3}var Si=l.x*l.x+l.y*l.y+l.z*l.z;if(0>It||Si<It){jc=1&Lp|(2&Lp)<<1,It=Si;var Ci=l;Nc=Ci.x,Fc=Ci.y,Dc=Ci.z}}if(0<It){var Ti=l;Ti.x=Nc,Ti.y=Fc,Ti.z=Dc,L=jc}else{var ji=Mt*Mt+qc*qc+Rc*Rc;0<ji&&(ji=1/Math.sqrt(ji));var Tp=(Mt*=ji)*Mt+(qc*=ji)*qc+(Rc*=ji)*Rc;Nc=Mt*(Tp=(ft*Mt+Xc*qc+uc*Rc)/Tp),Fc=qc*Tp,Dc=Rc*Tp;var wp=l;wp.x=Nc,wp.y=Fc,wp.z=Dc,L=7}break;case 4:var Ei=_[0],yo=_[1],bo=_[2],fo=_[3],xo=Ei,uo,Sp,Cp,qp,Rp,Ep,jp,Np,Fp,Dp,Wp,Gp,Op,Hp,Jp,Up,Qp,Kp,$p,tm,om,am,im,nm,_m,em,rm;uo=xo.x,Sp=xo.y,Cp=xo.z;var sm=yo;qp=sm.x,Rp=sm.y,Ep=sm.z;var go=bo;jp=go.x,Np=go.y,Fp=go.z;var Mo=fo,Zo,lm,cm;(Dp=Mo.x)-jp,(Wp=Mo.y)-Np,(Gp=Mo.z)-Fp;var pm=0<(Op=qp-uo)*(Zo=(em=Wp-Rp)*(nm=Fp-Ep)-(rm=Gp-Ep)*(im=Np-Rp))+(Hp=Rp-Sp)*(lm=rm*(am=jp-qp)-(_m=Dp-qp)*nm)+(Jp=Ep-Cp)*(cm=_m*im-em*am)?1:-1,wo=uo*((Qp=Np-Sp)*(om=Gp-Cp)-(Kp=Fp-Cp)*(tm=Wp-Sp))+Sp*(Kp*($p=Dp-uo)-(Up=jp-uo)*om)+Cp*(Up*tm-Qp*$p),Bo=uo*(tm*Jp-om*Hp)+Sp*(om*Op-$p*Jp)+Cp*($p*Hp-tm*Op),ko=qp*Zo+Rp*lm+Ep*cm,Ao=-1,mm=0,bm,xm,dm;if(bm=0,xm=0,dm=0,0>(uo*(Hp*Kp-Jp*Qp)+Sp*(Jp*Up-Op*Kp)+Cp*(Op*Qp-Hp*Up))*pm){var ym=Ei,ta,fm,gm,vm,Xm,um,zm,Ym,Zm,Im,Mm,hm,Vm,Lm,Bm,km,Am,Pm;ta=ym.x,fm=ym.y,gm=ym.z;var Tm=yo;vm=Tm.x,Xm=Tm.y,um=Tm.z;var ia=bo,sa,wm,Sm;zm=ia.x;var Cm=vm*((Lm=(Ym=ia.y)-Xm)*(Sm=(Im=vm-ta)*Lm-(Mm=Xm-fm)*(Vm=zm-vm))-(Bm=(Zm=ia.z)-um)*(wm=(hm=um-gm)*Vm-Im*Bm))+Xm*(Bm*(sa=Mm*Bm-hm*Lm)-Vm*Sm)+um*(Vm*wm-Lm*sa),la=zm*((Am=fm-Ym)*Sm-(Pm=gm-Zm)*wm)+Ym*(Pm*sa-(km=ta-zm)*Sm)+Zm*(km*wm-Am*sa),ca=-1,qm=0,Rm,Em,jm,Nm;if(Rm=0,Em=0,jm=0,0>ta*(Mm*Sm-hm*wm)+fm*(hm*sa-Im*Sm)+gm*(Im*wm-Mm*sa)){var Fm=Ei,ua,Dm,Wm,Gm,Om,Hm;ua=Fm.x,Dm=Fm.y,Wm=Fm.z;var Jm=yo,Ya=(Um=(Gm=Jm.x)-ua)*ua+(Qm=(Om=Jm.y)-Dm)*Dm+(Km=(Hm=Jm.z)-Wm)*Wm,Um,Qm,Km,$m;if(0>(Ya=-Ya/(Um*Um+Qm*Qm+Km*Km))){var tb=l;tb.x=ua,tb.y=Dm,tb.z=Wm,$m=1}else if(1<Ya){var Ia=l;Ia.x=Gm,Ia.y=Om,Ia.z=Hm,$m=2}else{var Va,ob,ab;Va=ua+Um*Ya,ob=Dm+Qm*Ya,ab=Wm+Km*Ya;var ib=l;ib.x=Va,ib.y=ob,ib.z=ab,$m=3}qm=$m,ca=l.x*l.x+l.y*l.y+l.z*l.z;var ka=l;Rm=ka.x,Em=ka.y,jm=ka.z}if(0>Cm){var Aa=yo,qa,nb,_b,eb,rb,sb;qa=Aa.x,nb=Aa.y,_b=Aa.z;var lb=bo,Na=(cb=(eb=lb.x)-qa)*qa+(pb=(rb=lb.y)-nb)*nb+(mb=(sb=lb.z)-_b)*_b,cb,pb,mb,bb;if(0>(Na=-Na/(cb*cb+pb*pb+mb*mb))){var xb=l;xb.x=qa,xb.y=nb,xb.z=_b,bb=1}else if(1<Na){var Oa=l;Oa.x=eb,Oa.y=rb,Oa.z=sb,bb=2}else{var Wa,db,yb;Wa=qa+cb*Na,db=nb+pb*Na,yb=_b+mb*Na;var fb=l;fb.x=Wa,fb.y=db,fb.z=yb,bb=3}var $a=l.x*l.x+l.y*l.y+l.z*l.z;if(0>ca||$a<ca){qm=bb<<1,ca=$a;var Ka=l;Rm=Ka.x,Em=Ka.y,jm=Ka.z}}if(0>la){var tn=Ei,en,gb,vb,Xb,ub,zb;en=tn.x,gb=tn.y,vb=tn.z;var Yb=bo,pn=(Zb=(Xb=Yb.x)-en)*en+(Ib=(ub=Yb.y)-gb)*gb+(Mb=(zb=Yb.z)-vb)*vb,Zb,Ib,Mb,hb;if(0>(pn=-pn/(Zb*Zb+Ib*Ib+Mb*Mb))){var Vb=l;Vb.x=en,Vb.y=gb,Vb.z=vb,hb=1}else if(1<pn){var yn=l;yn.x=Xb,yn.y=ub,yn.z=zb,hb=2}else{var bn,Lb,Bb;bn=en+Zb*pn,Lb=gb+Ib*pn,Bb=vb+Mb*pn;var kb=l;kb.x=bn,kb.y=Lb,kb.z=Bb,hb=3}var un=l.x*l.x+l.y*l.y+l.z*l.z;if(0>ca||un<ca){qm=1&hb|(2&hb)<<1,ca=un;var gn=l;Rm=gn.x,Em=gn.y,jm=gn.z}}if(0<ca){var Mn=l;Mn.x=Rm,Mn.y=Em,Mn.z=jm,Nm=qm}else{var Xn=sa*sa+wm*wm+Sm*Sm;0<Xn&&(Xn=1/Math.sqrt(Xn));var Ab=(sa*=Xn)*sa+(wm*=Xn)*wm+(Sm*=Xn)*Sm;Rm=sa*(Ab=(ta*sa+fm*wm+gm*Sm)/Ab),Em=wm*Ab,jm=Sm*Ab;var Pb=l;Pb.x=Rm,Pb.y=Em,Pb.z=jm,Nm=7}mm=Nm,Ao=l.x*l.x+l.y*l.y+l.z*l.z;var Zn=l;bm=Zn.x,xm=Zn.y,dm=Zn.z}if(0>wo*pm){var In=Ei,Gn,Tb,wb,Sb,Cb,qb,Rb,Eb,jb,Nb,Fb,Db,Wb,Gb,Ob,Hb,Jb,Ub;Gn=In.x,Tb=In.y,wb=In.z;var Qb=bo;Sb=Qb.x,Cb=Qb.y,qb=Qb.z;var On=fo,Qn,Kb,$b;Rb=On.x;var tx=Sb*((Gb=(Eb=On.y)-Cb)*($b=(Nb=Sb-Gn)*Gb-(Fb=Cb-Tb)*(Wb=Rb-Sb))-(Ob=(jb=On.z)-qb)*(Kb=(Db=qb-wb)*Wb-Nb*Ob))+Cb*(Ob*(Qn=Fb*Ob-Db*Gb)-Wb*$b)+qb*(Wb*Kb-Gb*Qn),os=Rb*((Jb=Tb-Eb)*$b-(Ub=wb-jb)*Kb)+Eb*(Ub*Qn-(Hb=Gn-Rb)*$b)+jb*(Hb*Kb-Jb*Qn),as=-1,ox=0,ax,ix,nx,_x;if(ax=0,ix=0,nx=0,0>Gn*(Fb*$b-Db*Kb)+Tb*(Db*Qn-Nb*$b)+wb*(Nb*Kb-Fb*Qn)){var ex=Ei,ms,rx,sx,lx,cx,px;ms=ex.x,rx=ex.y,sx=ex.z;var mx=bo,fs=(bx=(lx=mx.x)-ms)*ms+(xx=(cx=mx.y)-rx)*rx+(dx=(px=mx.z)-sx)*sx,bx,xx,dx,yx;if(0>(fs=-fs/(bx*bx+xx*xx+dx*dx))){var fx=l;fx.x=ms,fx.y=rx,fx.z=sx,yx=1}else if(1<fs){var xs=l;xs.x=lx,xs.y=cx,xs.z=px,yx=2}else{var us,gx,vx;us=ms+bx*fs,gx=rx+xx*fs,vx=sx+dx*fs;var Xx=l;Xx.x=us,Xx.y=gx,Xx.z=vx,yx=3}ox=yx,as=l.x*l.x+l.y*l.y+l.z*l.z;var zs=l;ax=zs.x,ix=zs.y,nx=zs.z}if(0>tx){var Ys=bo,ks,ux,zx,Yx,Zx,Ix;ks=Ys.x,ux=Ys.y,zx=Ys.z;var Mx=fo,Ts=(hx=(Yx=Mx.x)-ks)*ks+(Vx=(Zx=Mx.y)-ux)*ux+(Lx=(Ix=Mx.z)-zx)*zx,hx,Vx,Lx,Bx;if(0>(Ts=-Ts/(hx*hx+Vx*Vx+Lx*Lx))){var kx=l;kx.x=ks,kx.y=ux,kx.z=zx,Bx=1}else if(1<Ts){var Rs=l;Rs.x=Yx,Rs.y=Zx,Rs.z=Ix,Bx=2}else{var qs,Ax,Px;qs=ks+hx*Ts,Ax=ux+Vx*Ts,Px=zx+Lx*Ts;var Tx=l;Tx.x=qs,Tx.y=Ax,Tx.z=Px,Bx=3}var Fs=l.x*l.x+l.y*l.y+l.z*l.z;if(0>as||Fs<as){ox=Bx<<1,as=Fs;var Ns=l;ax=Ns.x,ix=Ns.y,nx=Ns.z}}if(0>os){var Gs=Ei,Ks,wx,Sx,Cx,qx,Rx;Ks=Gs.x,wx=Gs.y,Sx=Gs.z;var Ex=fo,n_=(jx=(Cx=Ex.x)-Ks)*Ks+(Nx=(qx=Ex.y)-wx)*wx+(Fx=(Rx=Ex.z)-Sx)*Sx,jx,Nx,Fx,Dx;if(0>(n_=-n_/(jx*jx+Nx*Nx+Fx*Fx))){var Wx=l;Wx.x=Ks,Wx.y=wx,Wx.z=Sx,Dx=1}else if(1<n_){var __=l;__.x=Cx,__.y=qx,__.z=Rx,Dx=2}else{var r_,Gx,Ox;r_=Ks+jx*n_,Gx=wx+Nx*n_,Ox=Sx+Fx*n_;var Hx=l;Hx.x=r_,Hx.y=Gx,Hx.z=Ox,Dx=3}var c_=l.x*l.x+l.y*l.y+l.z*l.z;if(0>as||c_<as){ox=1&Dx|(2&Dx)<<1,as=c_;var m_=l;ax=m_.x,ix=m_.y,nx=m_.z}}if(0<as){var p_=l;p_.x=ax,p_.y=ix,p_.z=nx,_x=ox}else{var v_=Qn*Qn+Kb*Kb+$b*$b;0<v_&&(v_=1/Math.sqrt(v_));var Jx=(Qn*=v_)*Qn+(Kb*=v_)*Kb+($b*=v_)*$b;ax=Qn*(Jx=(Gn*Qn+Tb*Kb+wb*$b)/Jx),ix=Kb*Jx,nx=$b*Jx;var Ux=l;Ux.x=ax,Ux.y=ix,Ux.z=nx,_x=7}var f_=l.x*l.x+l.y*l.y+l.z*l.z;if(0>Ao||f_<Ao){mm=1&_x|(6&_x)<<1,Ao=f_;var d_=l;bm=d_.x,xm=d_.y,dm=d_.z}}if(0>Bo*pm){var x_=Ei,j_,Qx,Kx,$x,td,od,ad,id,nd,_d,ed,rd,sd,ld,cd,pd,md,bd;j_=x_.x,Qx=x_.y,Kx=x_.z;var xd=yo;$x=xd.x,td=xd.y,od=xd.z;var R_=fo,J_,dd,yd;ad=R_.x;var fd=$x*((ld=(id=R_.y)-td)*(yd=(_d=$x-j_)*ld-(ed=td-Qx)*(sd=ad-$x))-(cd=(nd=R_.z)-od)*(dd=(rd=od-Kx)*sd-_d*cd))+td*(cd*(J_=ed*cd-rd*ld)-sd*yd)+od*(sd*dd-ld*J_),W_=ad*((md=Qx-id)*yd-(bd=Kx-nd)*dd)+id*(bd*J_-(pd=j_-ad)*yd)+nd*(pd*dd-md*J_),U_=-1,gd=0,vd,Xd,ud,zd;if(vd=0,Xd=0,ud=0,0>j_*(ed*yd-rd*dd)+Qx*(rd*J_-_d*yd)+Kx*(_d*dd-ed*J_)){var Yd=Ei,nr,Zd,Id,Md,hd,Vd;nr=Yd.x,Zd=Yd.y,Id=Yd.z;var Ld=yo,hr=(Bd=(Md=Ld.x)-nr)*nr+(kd=(hd=Ld.y)-Zd)*Zd+(Ad=(Vd=Ld.z)-Id)*Id,Bd,kd,Ad,Pd;if(0>(hr=-hr/(Bd*Bd+kd*kd+Ad*Ad))){var Td=l;Td.x=nr,Td.y=Zd,Td.z=Id,Pd=1}else if(1<hr){var cr=l;cr.x=Md,cr.y=hd,cr.z=Vd,Pd=2}else{var mr,wd,Sd;mr=nr+Bd*hr,wd=Zd+kd*hr,Sd=Id+Ad*hr;var Cd=l;Cd.x=mr,Cd.y=wd,Cd.z=Sd,Pd=3}gd=Pd,U_=l.x*l.x+l.y*l.y+l.z*l.z;var br=l;vd=br.x,Xd=br.y,ud=br.z}if(0>fd){var fr=yo,zr,qd,Rd,Ed,jd,Nd;zr=fr.x,qd=fr.y,Rd=fr.z;var Fd=fo,Lr=(Dd=(Ed=Fd.x)-zr)*zr+(Wd=(jd=Fd.y)-qd)*qd+(Gd=(Nd=Fd.z)-Rd)*Rd,Dd,Wd,Gd,Od;if(0>(Lr=-Lr/(Dd*Dd+Wd*Wd+Gd*Gd))){var Hd=l;Hd.x=zr,Hd.y=qd,Hd.z=Rd,Od=1}else if(1<Lr){var Br=l;Br.x=Ed,Br.y=jd,Br.z=Nd,Od=2}else{var kr,Jd,Ud;kr=zr+Dd*Lr,Jd=qd+Wd*Lr,Ud=Rd+Gd*Lr;var Qd=l;Qd.x=kr,Qd.y=Jd,Qd.z=Ud,Od=3}var Cr=l.x*l.x+l.y*l.y+l.z*l.z;if(0>U_||Cr<U_){gd=Od<<1,U_=Cr;var Tr=l;vd=Tr.x,Xd=Tr.y,ud=Tr.z}}if(0>W_){var jr=Ei,Nr,Kd,$d,ty,oy,ay;Nr=jr.x,Kd=jr.y,$d=jr.z;var iy=fo,Hr=(ny=(ty=iy.x)-Nr)*Nr+(_y=(oy=iy.y)-Kd)*Kd+(ey=(ay=iy.z)-$d)*$d,ny,_y,ey,ry;if(0>(Hr=-Hr/(ny*ny+_y*_y+ey*ey))){var sy=l;sy.x=Nr,sy.y=Kd,sy.z=$d,ry=1}else if(1<Hr){var $r=l;$r.x=ty,$r.y=oy,$r.z=ay,ry=2}else{var Kr,ly,cy;Kr=Nr+ny*Hr,ly=Kd+_y*Hr,cy=$d+ey*Hr;var py=l;py.x=Kr,py.y=ly,py.z=cy,ry=3}var ae=l.x*l.x+l.y*l.y+l.z*l.z;if(0>U_||ae<U_){gd=1&ry|(2&ry)<<1,U_=ae;var ne=l;vd=ne.x,Xd=ne.y,ud=ne.z}}if(0<U_){var se=l;se.x=vd,se.y=Xd,se.z=ud,zd=gd}else{var _e=J_*J_+dd*dd+yd*yd;0<_e&&(_e=1/Math.sqrt(_e));var my=(J_*=_e)*J_+(dd*=_e)*dd+(yd*=_e)*yd;vd=J_*(my=(j_*J_+Qx*dd+Kx*yd)/my),Xd=dd*my,ud=yd*my;var by=l;by.x=vd,by.y=Xd,by.z=ud,zd=7}var he=l.x*l.x+l.y*l.y+l.z*l.z;if(0>Ao||he<Ao){mm=3&zd|(4&zd)<<1,Ao=he;var le=l;bm=le.x,xm=le.y,dm=le.z}}if(0>ko*pm){var ce=yo,we,xy,dy,yy,fy,gy,vy,Xy,uy,zy,Yy,Zy,Iy,My,hy,Vy,Ly,By;we=ce.x,xy=ce.y,dy=ce.z;var ky=bo;yy=ky.x,fy=ky.y,gy=ky.z;var Be=fo,Se,Ay,Py;vy=Be.x;var Ty=yy*((My=(Xy=Be.y)-fy)*(Py=(zy=yy-we)*My-(Yy=fy-xy)*(Iy=vy-yy))-(hy=(uy=Be.z)-gy)*(Ay=(Zy=gy-dy)*Iy-zy*hy))+fy*(hy*(Se=Yy*hy-Zy*My)-Iy*Py)+gy*(Iy*Ay-My*Se),qe=vy*((Ly=xy-Xy)*Py-(By=dy-uy)*Ay)+Xy*(By*Se-(Vy=we-vy)*Py)+uy*(Vy*Ay-Ly*Se),Ee=-1,wy=0,Sy,Cy,qy,Ry;if(Sy=0,Cy=0,qy=0,0>we*(Yy*Py-Zy*Ay)+xy*(Zy*Se-zy*Py)+dy*(zy*Ay-Yy*Se)){var Ey=yo,He,jy,Ny,Fy,Dy,Wy;He=Ey.x,jy=Ey.y,Ny=Ey.z;var Gy=bo,Oy=(Hy=(Fy=Gy.x)-He)*He+(Jy=(Dy=Gy.y)-jy)*jy+(Uy=(Wy=Gy.z)-Ny)*Ny,Hy,Jy,Uy,Qy;if(0>(Oy=-Oy/(Hy*Hy+Jy*Jy+Uy*Uy))){var Ky=l;Ky.x=He,Ky.y=jy,Ky.z=Ny,Qy=1}else if(1<Oy){var $y=l;$y.x=Fy,$y.y=Dy,$y.z=Wy,Qy=2}else{var tf,of,af;tf=He+Hy*Oy,of=jy+Jy*Oy,af=Ny+Uy*Oy;var nf=l;nf.x=tf,nf.y=of,nf.z=af,Qy=3}wy=Qy,Ee=l.x*l.x+l.y*l.y+l.z*l.z;var _f=l;Sy=_f.x,Cy=_f.y,qy=_f.z}if(0>Ty){var ef=bo,rf,sf,lf,cf,pf,mf;rf=ef.x,sf=ef.y,lf=ef.z;var bf=fo,xf=(df=(cf=bf.x)-rf)*rf+(yf=(pf=bf.y)-sf)*sf+(ff=(mf=bf.z)-lf)*lf,df,yf,ff,gf;if(0>(xf=-xf/(df*df+yf*yf+ff*ff))){var vf=l;vf.x=rf,vf.y=sf,vf.z=lf,gf=1}else if(1<xf){var Xf=l;Xf.x=cf,Xf.y=pf,Xf.z=mf,gf=2}else{var uf,zf,Yf;uf=rf+df*xf,zf=sf+yf*xf,Yf=lf+ff*xf;var Zf=l;Zf.x=uf,Zf.y=zf,Zf.z=Yf,gf=3}var If=l.x*l.x+l.y*l.y+l.z*l.z;if(0>Ee||If<Ee){wy=gf<<1,Ee=If;var Mf=l;Sy=Mf.x,Cy=Mf.y,qy=Mf.z}}if(0>qe){var hf=yo,Vf,Lf,Bf,kf,Af,Pf;Vf=hf.x,Lf=hf.y,Bf=hf.z;var Tf=fo,wf=(Sf=(kf=Tf.x)-Vf)*Vf+(Cf=(Af=Tf.y)-Lf)*Lf+(qf=(Pf=Tf.z)-Bf)*Bf,Sf,Cf,qf,Rf;if(0>(wf=-wf/(Sf*Sf+Cf*Cf+qf*qf))){var Ef=l;Ef.x=Vf,Ef.y=Lf,Ef.z=Bf,Rf=1}else if(1<wf){var jf=l;jf.x=kf,jf.y=Af,jf.z=Pf,Rf=2}else{var Nf,Ff,Df;Nf=Vf+Sf*wf,Ff=Lf+Cf*wf,Df=Bf+qf*wf;var Wf=l;Wf.x=Nf,Wf.y=Ff,Wf.z=Df,Rf=3}var Gf=l.x*l.x+l.y*l.y+l.z*l.z;if(0>Ee||Gf<Ee){wy=1&Rf|(2&Rf)<<1,Ee=Gf;var Of=l;Sy=Of.x,Cy=Of.y,qy=Of.z}}if(0<Ee){var Hf=l;Hf.x=Sy,Hf.y=Cy,Hf.z=qy,Ry=wy}else{var Jf=Se*Se+Ay*Ay+Py*Py;0<Jf&&(Jf=1/Math.sqrt(Jf));var Uf=(Se*=Jf)*Se+(Ay*=Jf)*Ay+(Py*=Jf)*Py;Sy=Se*(Uf=(we*Se+xy*Ay+dy*Py)/Uf),Cy=Ay*Uf,qy=Py*Uf;var Qf=l;Qf.x=Sy,Qf.y=Cy,Qf.z=qy,Ry=7}var il=l.x*l.x+l.y*l.y+l.z*l.z;if(0>Ao||il<Ao){mm=Ry<<1,Ao=il;var ol=l;bm=ol.x,xm=ol.y,dm=ol.z}}if(0<Ao){var al=l;al.x=bm,al.y=xm,al.z=dm,L=mm}else l.zero(),L=15;}if(this.shrinkSimplex(L),1e-8>l.x*l.x+l.y*l.y+l.z*l.z){if(0==nc||4==this.simplexSize)return s.fraction=nc,!1;this.interpolateClosestPoints(),s.fraction=nc;var nl=s.normal;nl.x=c.x,nl.y=c.y,nl.z=c.z;var sl=nl,_l=Math.sqrt(sl.x*sl.x+sl.y*sl.y+sl.z*sl.z);0<_l&&(_l=1/_l);var Kf=sl.x*_l,el=sl.y*_l,hl=sl.z*_l;sl.x=Kf,sl.y=el,sl.z=hl;var ll=s.position,cl=this.closestPoint1;ll.x=cl.x,ll.y=cl.y,ll.z=cl.z;var ml=ll,pl=ml.x+a.x*nc,vl=ml.y+a.y*nc,yl=ml.z+a.z*nc;return ml.x=pl,ml.y=vl,ml.z=yl,!0}c.x=l.x,c.y=l.y,c.z=l.z;var bl=c,fl=-bl.x,dl=-bl.y,xl=-bl.z;if(bl.x=fl,bl.y=dl,bl.z=xl,null!=this.c1)this.computeWitnessPoint1(!0);else{var ul=this.w1[this.simplexSize];ul.x=this.tf1._positionX,ul.y=this.tf1._positionY,ul.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var gl=this.s[this.simplexSize],Ml=this.w1[this.simplexSize];gl.x=Ml.x,gl.y=Ml.y,gl.z=Ml.z;var Xl=gl,zl=this.w2[this.simplexSize],Yl=Xl.x-zl.x,Zl=Xl.y-zl.y,Il=Xl.z-zl.z;Xl.x=Yl,Xl.y=Zl,Xl.z=Il;var Vl=_[this.simplexSize],Ll=Vl.x-_c.x,wl=Vl.y-_c.y,Bl=Vl.z-_c.z;if(Vl.x=Ll,Vl.y=wl,Vl.z=Bl,1e-8>c.x*c.x+c.y*c.y+c.z*c.z)throw new Error("!?");var kl=_[this.simplexSize],Al=c,Pl=kl.x*Al.x+kl.y*Al.y+kl.z*Al.z;if(0>Pl){if(0<=z.x*Al.x+z.y*Al.y+z.z*Al.z)return!1;var Sl=Pl/(z.x*Al.x+z.y*Al.y+z.z*Al.z);if(1<=(nc+=Sl))return!1;var Cl=_c.x+z.x*Sl,Tl=_c.y+z.y*Sl,jl=_c.z+z.z*Sl;_c.x=Cl,_c.y=Tl,_c.z=jl;for(var Rl=0,$f=this.simplexSize+1;Rl<$f;){var El=_[Rl++],Dl=-Sl,Jl=El.x+z.x*Dl,Fl=El.y+z.y*Dl,Nl=El.z+z.z*Dl;El.x=Jl,El.y=Fl,El.z=Nl}}for(var Gl=!1,tg=0,og=this.simplexSize;tg<og;){var Ul=tg++,Hl=_[Ul].x-_[this.simplexSize].x,Ql=_[Ul].y-_[this.simplexSize].y,$l=_[Ul].z-_[this.simplexSize].z;if(1e-8>Hl*Hl+Ql*Ql+$l*$l){Gl=!0;break}}Gl||this.simplexSize++,++g}return!1},interpolateClosestPoints:function(){switch(this.simplexSize){case 1:var to=this.closestPoint1,t=this.w1[0];to.x=t.x,to.y=t.y,to.z=t.z;var i=this.closestPoint2,o=this.w2[0];i.x=o.x,i.y=o.y,i.z=o.z;break;case 2:var a=this.closest,Y,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo,go,vo,Xo,uo;Y=a.x,oo=a.y,ao=a.z;var zo=this.s[0];io=zo.x,no=zo.y,_o=zo.z;var Z=this.w1[0];eo=Z.x,ro=Z.y,so=Z.z;var I=this.w2[0];lo=I.x,co=I.y,po=I.z;var V=this.s[1];mo=V.x,bo=V.y,xo=V.z;var L=this.w1[1];yo=L.x,fo=L.y,go=L.z;var w=this.w2[1];vo=w.x,Xo=w.y,uo=w.z;var B=this.s[2];B.x,B.y,B.z;var k=this.w1[2];k.x,k.y,k.z;var A=this.w2[2],T,Yo,Zo;A.x,A.y,A.z;var Io=(T=mo-io)*T+(Yo=bo-no)*Yo+(Zo=xo-_o)*Zo;0!=Io&&(Io=1/Io);var Mo=((Y-io)*T+(oo-no)*Yo+(ao-_o)*Zo)*Io,N,ho,Vo,Lo,Bo,ko;N=eo+(yo-eo)*Mo,ho=ro+(fo-ro)*Mo,Vo=so+(go-so)*Mo,Lo=lo+(vo-lo)*Mo,Bo=co+(Xo-co)*Mo,ko=po+(uo-po)*Mo;var Ao=this.closestPoint1;Ao.x=N,Ao.y=ho,Ao.z=Vo;var G=this.closestPoint2;G.x=Lo,G.y=Bo,G.z=ko;break;case 3:var O=this.closest,gt,Po,To,wo,So,Co,qo,Ro,Eo,jo,No,Fo,Do,Wo,Go,Oo,Ho,Jo,Uo,Qo,Ko,$o,ta,oa,aa,ia,na;gt=O.x,Po=O.y,To=O.z;var _a=this.s[0];wo=_a.x,So=_a.y,Co=_a.z;var Mt=this.w1[0];qo=Mt.x,Ro=Mt.y,Eo=Mt.z;var Xt=this.w2[0];jo=Xt.x,No=Xt.y,Fo=Xt.z;var zt=this.s[1];Do=zt.x,Wo=zt.y,Go=zt.z;var Yt=this.w1[1];Oo=Yt.x,Ho=Yt.y,Jo=Yt.z;var Zt=this.w2[1];Uo=Zt.x,Qo=Zt.y,Ko=Zt.z;var It=this.s[2];$o=It.x,ta=It.y,oa=It.z;var Vt=this.w1[2];aa=Vt.x,ia=Vt.y,na=Vt.z;var Lt=this.w2[2],Rt=(ea=Do-wo)*ea+(ra=Wo-So)*ra+(sa=Go-Co)*sa,qt=ea*(la=$o-wo)+ra*(ca=ta-So)+sa*(pa=oa-Co),Et=la*la+ca*ca+pa*pa,Dt=ea*(ma=gt-wo)+ra*(ba=Po-So)+sa*(xa=To-Co),Jt=la*ma+ca*ba+pa*xa,Ft=Rt*Et-qt*qt,ea,ra,sa,la,ca,pa,ma,ba,xa;0!=Ft&&(Ft=1/Ft);var da=(Dt*Et-Jt*qt)*Ft,$t=(-Dt*qt+Jt*Rt)*Ft,Kt,ya,fa,ga,va,Xa;Kt=qo+(Oo-qo)*da,ya=Ro+(Ho-Ro)*da,fa=Eo+(Jo-Eo)*da,Kt+=(aa-qo)*$t,ya+=(ia-Ro)*$t,fa+=(na-Eo)*$t,ga=jo+(Uo-jo)*da,va=No+(Qo-No)*da,Xa=Fo+(Ko-Fo)*da,ga+=(Lt.x-jo)*$t,va+=(Lt.y-No)*$t,Xa+=(Lt.z-Fo)*$t;var ua=this.closestPoint1;ua.x=Kt,ua.y=ya,ua.z=fa;var za=this.closestPoint2;za.x=ga,za.y=va,za.z=Xa;break;default:throw new Error("!?");}},loadCache:function(a){var t=this.dir,i=a.prevClosestDir;t.x=i.x,t.y=i.y,t.z=i.z},saveCache:function(e){var t=e.prevClosestDir,i=this.closest;t.x=i.x,t.y=i.y,t.z=i.z;var o=t,a=-o.x,n=-o.y,r=-o.z;o.x=a,o.y=n,o.z=r},shrinkSimplex:function(xt){switch(this.simplexSize=xt,this.simplexSize=(5&this.simplexSize)+(5&this.simplexSize>>1),this.simplexSize=(3&this.simplexSize)+(3&this.simplexSize>>2),xt){case 2:var t=this.s[0],i=this.s[1];t.x=i.x,t.y=i.y,t.z=i.z;var o=this.w1[0],a=this.w1[1];o.x=a.x,o.y=a.y,o.z=a.z;var n=this.w2[0],s=this.w2[1];n.x=s.x,n.y=s.y,n.z=s.z;break;case 4:var _=this.s[0],r=this.s[2];_.x=r.x,_.y=r.y,_.z=r.z;var e=this.w1[0],h=this.w1[2];e.x=h.x,e.y=h.y,e.z=h.z;var l=this.w2[0],c=this.w2[2];l.x=c.x,l.y=c.y,l.z=c.z;break;case 5:var m=this.s[1],p=this.s[2];m.x=p.x,m.y=p.y,m.z=p.z;var v=this.w1[1],y=this.w1[2];v.x=y.x,v.y=y.y,v.z=y.z;var b=this.w2[1],f=this.w2[2];b.x=f.x,b.y=f.y,b.z=f.z;break;case 6:var d=this.s[0],x=this.s[2];d.x=x.x,d.y=x.y,d.z=x.z;var u=this.w1[0],g=this.w1[2];u.x=g.x,u.y=g.y,u.z=g.z;var M=this.w2[0],X=this.w2[2];M.x=X.x,M.y=X.y,M.z=X.z;break;case 8:var z=this.s[0],Y=this.s[3];z.x=Y.x,z.y=Y.y,z.z=Y.z;var Z=this.w1[0],I=this.w1[3];Z.x=I.x,Z.y=I.y,Z.z=I.z;var V=this.w2[0],L=this.w2[3];V.x=L.x,V.y=L.y,V.z=L.z;break;case 9:var w=this.s[1],B=this.s[3];w.x=B.x,w.y=B.y,w.z=B.z;var k=this.w1[1],A=this.w1[3];k.x=A.x,k.y=A.y,k.z=A.z;var P=this.w2[1],S=this.w2[3];P.x=S.x,P.y=S.y,P.z=S.z;break;case 10:var C=this.s[0],T=this.s[3];C.x=T.x,C.y=T.y,C.z=T.z;var j=this.w1[0],R=this.w1[3];j.x=R.x,j.y=R.y,j.z=R.z;var q=this.w2[0],E=this.w2[3];q.x=E.x,q.y=E.y,q.z=E.z;break;case 11:var D=this.s[2],J=this.s[3];D.x=J.x,D.y=J.y,D.z=J.z;var F=this.w1[2],N=this.w1[3];F.x=N.x,F.y=N.y,F.z=N.z;var G=this.w2[2],O=this.w2[3];G.x=O.x,G.y=O.y,G.z=O.z;break;case 12:var W=this.s[0],U=this.s[2];W.x=U.x,W.y=U.y,W.z=U.z;var H=this.w1[0],Q=this.w1[2];H.x=Q.x,H.y=Q.y,H.z=Q.z;var $=this.w2[0],K=this.w2[2];$.x=K.x,$.y=K.y,$.z=K.z;var tt=this.s[1],it=this.s[3];tt.x=it.x,tt.y=it.y,tt.z=it.z;var ot=this.w1[1],at=this.w1[3];ot.x=at.x,ot.y=at.y,ot.z=at.z;var nt=this.w2[1],st=this.w2[3];nt.x=st.x,nt.y=st.y,nt.z=st.z;break;case 13:var _t=this.s[1],rt=this.s[3];_t.x=rt.x,_t.y=rt.y,_t.z=rt.z;var et=this.w1[1],gt=this.w1[3];et.x=gt.x,et.y=gt.y,et.z=gt.z;var lt=this.w2[1],ct=this.w2[3];lt.x=ct.x,lt.y=ct.y,lt.z=ct.z;break;case 14:var mt=this.s[0],pt=this.s[3];mt.x=pt.x,mt.y=pt.y,mt.z=pt.z;var vt=this.w1[0],yt=this.w1[3];vt.x=yt.x,vt.y=yt.y,vt.z=yt.z;var bt=this.w2[0],ft=this.w2[3];bt.x=ft.x,bt.y=ft.y,bt.z=ft.z;}},computeWitnessPoint1:function(L){var t=this.dir,p,B,k,A,P,T,w,S,C,q,R,E;A=t.x,P=t.y,T=t.z,w=this.tf1._rotation00*A+this.tf1._rotation10*P+this.tf1._rotation20*T,S=this.tf1._rotation01*A+this.tf1._rotation11*P+this.tf1._rotation21*T,C=this.tf1._rotation02*A+this.tf1._rotation12*P+this.tf1._rotation22*T;var j=this.dir;if(j.x=w,j.y=S,j.z=C,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),L){var v=this.dir,y=Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z);0<y&&(y=1/y);var N=v.x*y,f=v.y*y,d=v.z*y;v.x=N,v.y=f,v.z=d;var x=this.w1[this.simplexSize],u=this.dir,g=this.c1._gjkMargin,M=x.x+u.x*g,X=x.y+u.y*g,z=x.z+u.z*g;x.x=M,x.y=X,x.z=z}var Y=this.w1[this.simplexSize];p=Y.x,B=Y.y,k=Y.z,q=this.tf1._rotation00*p+this.tf1._rotation01*B+this.tf1._rotation02*k,R=this.tf1._rotation10*p+this.tf1._rotation11*B+this.tf1._rotation12*k,E=this.tf1._rotation20*p+this.tf1._rotation21*B+this.tf1._rotation22*k,q+=this.tf1._positionX,R+=this.tf1._positionY,E+=this.tf1._positionZ;var Z=this.w1[this.simplexSize];Z.x=q,Z.y=R,Z.z=E;var I=this.dir;I.x=A,I.y=P,I.z=T},computeWitnessPoint2:function(L){var t=this.dir,p,B,k,A,P,T,w,S,C,q,R,E;A=t.x,P=t.y,T=t.z,w=-(w=this.tf2._rotation00*A+this.tf2._rotation10*P+this.tf2._rotation20*T),S=-(S=this.tf2._rotation01*A+this.tf2._rotation11*P+this.tf2._rotation21*T),C=-(C=this.tf2._rotation02*A+this.tf2._rotation12*P+this.tf2._rotation22*T);var j=this.dir;if(j.x=w,j.y=S,j.z=C,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),L){var v=this.dir,y=Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z);0<y&&(y=1/y);var N=v.x*y,f=v.y*y,d=v.z*y;v.x=N,v.y=f,v.z=d;var x=this.w2[this.simplexSize],u=this.dir,g=this.c2._gjkMargin,M=x.x+u.x*g,X=x.y+u.y*g,z=x.z+u.z*g;x.x=M,x.y=X,x.z=z}var Y=this.w2[this.simplexSize];p=Y.x,B=Y.y,k=Y.z,q=this.tf2._rotation00*p+this.tf2._rotation01*B+this.tf2._rotation02*k,R=this.tf2._rotation10*p+this.tf2._rotation11*B+this.tf2._rotation12*k,E=this.tf2._rotation20*p+this.tf2._rotation21*B+this.tf2._rotation22*k,q+=this.tf2._positionX,R+=this.tf2._positionY,E+=this.tf2._positionZ;var Z=this.w2[this.simplexSize];Z.x=q,Z.y=R,Z.z=E;var I=this.dir;I.x=A,I.y=P,I.z=T},pointToTetrahedron:function(){for(var X=0;3>X;){var z=X++,i=this.dir,o=this.baseDirs[z];i.x=o.x,i.y=o.y,i.z=o.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var a=this.s[this.simplexSize],n=this.w1[this.simplexSize];a.x=n.x,a.y=n.y,a.z=n.z;var s=a,_=this.w2[this.simplexSize],r=s.x-_.x,e=s.y-_.y,Y=s.z-_.z;if(s.x=r,s.y=e,s.z=Y,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var l=this.dir,c=-l.x,m=-l.y,p=-l.z;l.x=c,l.y=m,l.z=p,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var v=this.s[this.simplexSize],y=this.w1[this.simplexSize];v.x=y.x,v.y=y.y,v.z=y.z;var b=v,f=this.w2[this.simplexSize],d=b.x-f.x,x=b.y-f.y,u=b.z-f.z;if(b.x=d,b.y=x,b.z=u,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}},lineToTetrahedron:function(){var E=this.dir,h,N,F,D,W,G,O,H,J;h=E.x,N=E.y,F=E.z;var U=this.s[0];D=U.x,W=U.y,G=U.z;var l=this.s[1];O=D-l.x,H=W-l.y,J=G-l.z;for(var c=0;3>c;){var Q=c++,x=this.baseDirs[Q],u,K,$,tt,ot,at;u=x.x,K=x.y,tt=H*($=x.z)-J*K,ot=J*u-O*$,at=O*K-H*u;var it=this.dir;it.x=tt,it.y=ot,it.z=at,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var g=this.s[this.simplexSize],M=this.w1[this.simplexSize];g.x=M.x,g.y=M.y,g.z=M.z;var X=g,z=this.w2[this.simplexSize],Y=X.x-z.x,Z=X.y-z.y,I=X.z-z.z;if(X.x=Y,X.y=Z,X.z=I,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var V=this.dir,L=-V.x,w=-V.y,B=-V.z;V.x=L,V.y=w,V.z=B,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var k=this.s[this.simplexSize],A=this.w1[this.simplexSize];k.x=A.x,k.y=A.y,k.z=A.z;var P=k,S=this.w2[this.simplexSize],C=P.x-S.x,T=P.y-S.y,j=P.z-S.z;if(P.x=C,P.y=T,P.z=j,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}var R=this.dir;R.x=h,R.y=N,R.z=F},triangleToTetrahedron:function(){var N=this.dir,a,F,W;for(a=N.x,F=N.y,W=N.z;;){var G=this.s[0],d,O,H,U,Q,K,$,tt,ot,at,it,nt,_t,et;d=G.x,O=G.y,H=G.z;var rt=this.s[1];U=rt.x,Q=rt.y,K=rt.z;var x=this.s[2],X,st,lt;$=x.x,tt=x.y,X=(at=Q-O)*(et=x.z-H)-(it=K-H)*(_t=tt-O),st=it*(nt=$-d)-(ot=U-d)*et,lt=ot*_t-at*nt;var ct=this.dir;ct.x=X,ct.y=st,ct.z=lt,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var z=this.s[this.simplexSize],Y=this.w1[this.simplexSize];z.x=Y.x,z.y=Y.y,z.z=Y.z;var Z=z,I=this.w2[this.simplexSize],V=Z.x-I.x,L=Z.y-I.y,w=Z.z-I.z;if(Z.x=V,Z.y=L,Z.z=w,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var B=this.dir,k=-B.x,A=-B.y,P=-B.z;B.x=k,B.y=A,B.z=P,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var S=this.s[this.simplexSize],C=this.w1[this.simplexSize];S.x=C.x,S.y=C.y,S.z=C.z;var T=S,j=this.w2[this.simplexSize],R=T.x-j.x,q=T.y-j.y,E=T.z-j.z;if(T.x=R,T.y=q,T.z=E,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var D=this.dir;D.x=a,D.y=F,D.z=W},isValidTetrahedron:function(){var l=this.s[1].x-this.s[0].x,t=this.s[1].y-this.s[0].y,i=this.s[1].z-this.s[0].z,o=this.s[2].x-this.s[0].x,a=this.s[2].y-this.s[0].y,n=this.s[2].z-this.s[0].z,s=this.s[3].x-this.s[0].x,_=this.s[3].y-this.s[0].y,r=this.s[3].z-this.s[0].z,e=l*(a*r-n*_)-t*(o*r-n*s)+i*(o*_-a*s);return 1e-12<e||-1e-12>e},computeDepth:function(to,t,i,o,a,n,s){for(var _=this.polyhedron,r;0<_._numTriangles;){r=_._triangleList,_._numTriangles--;var oo=r._prev,h=r._next;null!=oo&&(oo._next=h),null!=h&&(h._prev=oo),r==_._triangleList&&(_._triangleList=_._triangleList._next),r==_._triangleListLast&&(_._triangleListLast=_._triangleListLast._prev),r._next=null,r._prev=null,r.removeReferences(),r._next=_._trianglePool,_._trianglePool=r}for(;0<_._numVertices;){var l=_._vertices[--_._numVertices];l.removeReferences(),l._next=_._vertexPool,_._vertexPool=l}var c=this.polyhedron,m=this.polyhedron,p=m._vertexPool;null==p?p=new oimo_collision_narrowphase_detector_gjkepa_EpaVertex:(m._vertexPool=p._next,p._next=null);var ao=p.init(a[0],n[0],s[0]),y=this.polyhedron,b=y._vertexPool;null==b?b=new oimo_collision_narrowphase_detector_gjkepa_EpaVertex:(y._vertexPool=b._next,b._next=null);var io=b.init(a[1],n[1],s[1]),d=this.polyhedron,x=d._vertexPool;null==x?x=new oimo_collision_narrowphase_detector_gjkepa_EpaVertex:(d._vertexPool=x._next,x._next=null);var no=x.init(a[2],n[2],s[2]),g=this.polyhedron,M=g._vertexPool;if(null==M?M=new oimo_collision_narrowphase_detector_gjkepa_EpaVertex:(g._vertexPool=M._next,M._next=null),!c._init(ao,io,no,M.init(a[3],n[3],s[3])))return oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var _o=this.s[0],z=this.w1[0],Y=this.w2[0],Z=0;40>Z;){for(var eo=this.polyhedron._triangleList,ro=1/0,so=null,lo;null!=eo;)lo=eo._next,eo._distanceSq<ro&&(ro=eo._distanceSq,so=eo),eo=lo;var co=so,k=this.dir,A=co._normal;k.x=A.x,k.y=A.y,k.z=A.z;var P=k,S=Math.sqrt(P.x*P.x+P.y*P.y+P.z*P.z);0<S&&(S=1/S);var po=P.x*S,T=P.y*S,j=P.z*S;P.x=po,P.y=T,P.z=j,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var R=this.s[this.simplexSize],q=this.w1[this.simplexSize];R.x=q.x,R.y=q.y,R.z=q.z;var E=R,D=this.w2[this.simplexSize],J=E.x-D.x,F=E.y-D.y,N=E.z-D.z;E.x=J,E.y=F,E.z=N;var G=co._vertices[0],O=co._vertices[1],W=co._vertices[2],U=G.v,H=this.dir,Q=U.x*H.x+U.y*H.y+U.z*H.z,$=this.dir;if(1e-6>_o.x*$.x+_o.y*$.y+_o.z*$.z-Q||39==Z){var K=this.closest,tt=this.dir;K.x=tt.x,K.y=tt.y,K.z=tt.z;var it=K,st=this.dir,_t=G.v,rt=this.dir,et=(st.x*_t.x+st.y*_t.y+st.z*_t.z)/(rt.x*rt.x+rt.y*rt.y+rt.z*rt.z),ht=it.x*et,lt=it.y*et,ct=it.z*et,mt,mo,bo;it.x=ht,it.y=lt,it.z=ct;var xo=this.closest,Tt,yo,fo,go,vo,Xo,uo,zo,Yo,Zo,Io,Mo,ho,Vo,Lo,Bo,ko,Ao,Po,To,wo,So,Co,qo;mt=xo.x,mo=xo.y,bo=xo.z;var Ro=G.v;Tt=Ro.x,yo=Ro.y,fo=Ro.z;var jt=G.w1;go=jt.x,vo=jt.y,Xo=jt.z;var Rt=G.w2;uo=Rt.x,zo=Rt.y,Yo=Rt.z;var qt=O.v;Zo=qt.x,Io=qt.y,Mo=qt.z;var Et=O.w1;ho=Et.x,Vo=Et.y,Lo=Et.z;var Dt=O.w2;Bo=Dt.x,ko=Dt.y,Ao=Dt.z;var Jt=W.v;Po=Jt.x,To=Jt.y,wo=Jt.z;var Ft=W.w1;So=Ft.x,Co=Ft.y,qo=Ft.z;var Nt=W.w2,Eo=(Go=Zo-Tt)*Go+(Oo=Io-yo)*Oo+(Ho=Mo-fo)*Ho,jo=Go*(Jo=Po-Tt)+Oo*(Uo=To-yo)+Ho*(Qo=wo-fo),No=Jo*Jo+Uo*Uo+Qo*Qo,Fo=Go*(Ko=mt-Tt)+Oo*($o=mo-yo)+Ho*(ta=bo-fo),Do=Jo*Ko+Uo*$o+Qo*ta,Wo=Eo*No-jo*jo,Go,Oo,Ho,Jo,Uo,Qo,Ko,$o,ta;0!=Wo&&(Wo=1/Wo);var oa=(Fo*No-Do*jo)*Wo,aa=(-Fo*jo+Do*Eo)*Wo,ia,na,_a,ea,ra,sa;ia=go+(ho-go)*oa,na=vo+(Vo-vo)*oa,_a=Xo+(Lo-Xo)*oa,ia+=(So-go)*aa,na+=(Co-vo)*aa,_a+=(qo-Xo)*aa,ea=uo+(Bo-uo)*oa,ra=zo+(ko-zo)*oa,sa=Yo+(Ao-Yo)*oa,ea+=(Nt.x-uo)*aa,ra+=(Nt.y-zo)*aa,sa+=(Nt.z-Yo)*aa;var la=this.closestPoint1;la.x=ia,la.y=na,la.z=_a;var ca=this.closestPoint2;ca.x=ea,ca.y=ra,ca.z=sa;var pa=this.closest;return this.depth=Math.sqrt(pa.x*pa.x+pa.y*pa.y+pa.z*pa.z),oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.SUCCEEDED}var ma=this.polyhedron,ba=ma._vertexPool;null==ba?ba=new oimo_collision_narrowphase_detector_gjkepa_EpaVertex:(ma._vertexPool=ba._next,ba._next=null);var xa=ba.init(_o,z,Y);if(!this.polyhedron._addVertex(xa,co))return oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++Z}return oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.EPA_DID_NOT_CONVERGE},computeClosestPoints:function(_,t,i,o,a){return this.computeClosestPointsImpl(_,t,i,o,a,!0)},computeDistance:function(_,t,i,o,a){return this.computeClosestPointsImpl(_,t,i,o,a,!1)},convexCast:function(e,t,i,o,a,n,r){return this.convexCastImpl(e,t,i,o,a,n,r)},rayCast:function(_,t,i,o,a){var n=this.tempTransform,s=i;n._positionX=s.x,n._positionY=s.y,n._positionZ=s.z;var r=this.tl1,e=this.tl2;r.x=o.x,r.y=o.y,r.z=o.z;var b=r,l=b.x-i.x,c=b.y-i.y,m=b.z-i.z;return b.x=l,b.y=c,b.z=m,e.zero(),this.convexCastImpl(null,_,n,t,r,e,a)}};var oimo_collision_narrowphase_detector_gjkepa_GjkEpaLog=function(){},oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState=function(){},oimo_collision_narrowphase_detector_gjkepa_SimplexUtil=function(){};oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin2=function(g,t,i){var o=g,X,z,Y,Z,I,M;X=o.x,z=o.y,Y=o.z;var h=t,b=(V=(Z=h.x)-X)*X+(L=(I=h.y)-z)*z+(B=(M=h.z)-Y)*Y,V,L,B,k,A,P;if(0>(b=-b/(V*V+L*L+B*B))){var T=i;return T.x=X,T.y=z,T.z=Y,1}if(1<b){var d=i;return d.x=Z,d.y=I,d.z=M,2}k=X+V*b,A=z+L*b,P=Y+B*b;var x=i;return x.x=k,x.y=A,x.z=P,3},oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin3=function(Wt,t,i,o){var a=Wt,M,Ot,Ht,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo,ro,so,lo,co;M=a.x,Ot=a.y,Ht=a.z;var po=t;Ut=po.x,Qt=po.y,Kt=po.z;var X=i,I,mo,bo;$t=X.x;var xo=Ut*((eo=(to=X.y)-Qt)*(bo=(ao=Ut-M)*eo-(io=Qt-Ot)*(_o=$t-Ut))-(ro=(oo=X.z)-Kt)*(mo=(no=Kt-Ht)*_o-ao*ro))+Qt*(ro*(I=io*ro-no*eo)-_o*bo)+Kt*(_o*mo-eo*I),B=$t*((lo=Ot-to)*bo-(co=Ht-oo)*mo)+to*(co*I-(so=M-$t)*bo)+oo*(so*mo-lo*I),k=-1,yo=0,fo,go,vo;if(fo=0,go=0,vo=0,0>M*(io*bo-no*mo)+Ot*(no*I-ao*bo)+Ht*(ao*mo-io*I)){var Xo=Wt,E,uo,zo,Yo,Zo,Io;E=Xo.x,uo=Xo.y,zo=Xo.z;var Mo=t,G=(ho=(Yo=Mo.x)-E)*E+(Vo=(Zo=Mo.y)-uo)*uo+(Lo=(Io=Mo.z)-zo)*zo,ho,Vo,Lo,Bo;if(0>(G=-G/(ho*ho+Vo*Vo+Lo*Lo))){var ko=o;ko.x=E,ko.y=uo,ko.z=zo,Bo=1}else if(1<G){var W=o;W.x=Yo,W.y=Zo,W.z=Io,Bo=2}else{var U,Ao,Po;U=E+ho*G,Ao=uo+Vo*G,Po=zo+Lo*G;var To=o;To.x=U,To.y=Ao,To.z=Po,Bo=3}yo=Bo,k=o.x*o.x+o.y*o.y+o.z*o.z;var K=o;fo=K.x,go=K.y,vo=K.z}if(0>xo){var tt=t,rt,wo,So,Co,qo,Ro;rt=tt.x,wo=tt.y,So=tt.z;var Eo=i,mt=(jo=(Co=Eo.x)-rt)*rt+(No=(qo=Eo.y)-wo)*wo+(Fo=(Ro=Eo.z)-So)*So,jo,No,Fo,Do;if(0>(mt=-mt/(jo*jo+No*No+Fo*Fo))){var Wo=o;Wo.x=rt,Wo.y=wo,Wo.z=So,Do=1}else if(1<mt){var vt=o;vt.x=Co,vt.y=qo,vt.z=Ro,Do=2}else{var yt,Go,Oo;yt=rt+jo*mt,Go=wo+No*mt,Oo=So+Fo*mt;var Ho=o;Ho.x=yt,Ho.y=Go,Ho.z=Oo,Do=3}var xt=o.x*o.x+o.y*o.y+o.z*o.z;if(0>k||xt<k){yo=Do<<1,k=xt;var ut=o;fo=ut.x,go=ut.y,vo=ut.z}}if(0>B){var gt=Wt,Vt,Jo,Uo,Qo,Ko,$o;Vt=gt.x,Jo=gt.y,Uo=gt.z;var ta=i,At=(oa=(Qo=ta.x)-Vt)*Vt+(aa=(Ko=ta.y)-Jo)*Jo+(ia=($o=ta.z)-Uo)*Uo,oa,aa,ia,na;if(0>(At=-At/(oa*oa+aa*aa+ia*ia))){var _a=o;_a.x=Vt,_a.y=Jo,_a.z=Uo,na=1}else if(1<At){var St=o;St.x=Qo,St.y=Ko,St.z=$o,na=2}else{var Ct,ea,ra;Ct=Vt+oa*At,ea=Jo+aa*At,ra=Uo+ia*At;var sa=o;sa.x=Ct,sa.y=ea,sa.z=ra,na=3}var qt=o.x*o.x+o.y*o.y+o.z*o.z;if(0>k||qt<k){yo=1&na|(2&na)<<1,k=qt;var Et=o;fo=Et.x,go=Et.y,vo=Et.z}}if(0<k){var Dt=o;return Dt.x=fo,Dt.y=go,Dt.z=vo,yo}var Jt=I*I+mo*mo+bo*bo;0<Jt&&(Jt=1/Math.sqrt(Jt));var la=(I*=Jt)*I+(mo*=Jt)*mo+(bo*=Jt)*bo;fo=I*(la=(M*I+Ot*mo+Ht*bo)/la),go=mo*la,vo=bo*la;var ca=o;return ca.x=fo,ca.y=go,ca.z=vo,7},oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin4=function(te,t,i,o,a){var n=te,k,oe,ae,ie,ne,_e,ee,re,se,le,ce,pe,me,be,xe,de,ye,fe,ge,ve,Xe,ue,ze,Ye,Ze,Ie,Me;k=n.x,oe=n.y,ae=n.z;var he=t;ie=he.x,ne=he.y,_e=he.z;var A=i;ee=A.x,re=A.y,se=A.z;var P=o,j,Ve,Le;le=P.x,ce=P.y,pe=P.z;var Be=0<(me=ie-k)*(j=(Ie=ce-ne)*(Ye=se-_e)-(Me=pe-_e)*(ze=re-ne))+(be=ne-oe)*(Ve=Me*(ue=ee-ie)-(Ze=le-ie)*Ye)+(xe=_e-ae)*(Le=Ze*ze-Ie*ue)?1:-1,D=k*((ye=re-oe)*(Xe=pe-ae)-(fe=se-ae)*(ve=ce-oe))+oe*(fe*(ge=le-k)-(de=ee-k)*Xe)+ae*(de*ve-ye*ge),J=k*(ve*xe-Xe*be)+oe*(Xe*me-ge*xe)+ae*(ge*be-ve*me),F=ie*j+ne*Ve+_e*Le,N=-1,ke=0,Ae,Pe,Te;if(Ae=0,Pe=0,Te=0,0>(k*(be*fe-xe*ye)+oe*(xe*de-me*fe)+ae*(me*ye-be*de))*Be){var we=te,mt,Se,Ce,qe,Re,Ee,je,Ne,Fe,De,We,Ge,Oe,He,Je,Ue,Qe,Ke;mt=we.x,Se=we.y,Ce=we.z;var $e=t;qe=$e.x,Re=$e.y,Ee=$e.z;var pt=i,ft,xr,dr;je=pt.x;var gr=qe*((He=(Ne=pt.y)-Re)*(dr=(De=qe-mt)*He-(We=Re-Se)*(Oe=je-qe))-(Je=(Fe=pt.z)-Ee)*(xr=(Ge=Ee-Ce)*Oe-De*Je))+Re*(Je*(ft=We*Je-Ge*He)-Oe*dr)+Ee*(Oe*xr-He*ft),Mt=je*((Qe=Se-Ne)*dr-(Ke=Ce-Fe)*xr)+Ne*(Ke*ft-(Ue=mt-je)*dr)+Fe*(Ue*xr-Qe*ft),Xt=-1,Xr=0,ur,zr,Yr,Zr;if(ur=0,zr=0,Yr=0,0>mt*(We*dr-Ge*xr)+Se*(Ge*ft-De*dr)+Ce*(De*xr-We*ft)){var Ir=te,kt,Mr,Vr,Lr,Br,kr;kt=Ir.x,Mr=Ir.y,Vr=Ir.z;var Ar=t,Tt=(Pr=(Lr=Ar.x)-kt)*kt+(Tr=(Br=Ar.y)-Mr)*Mr+(wr=(kr=Ar.z)-Vr)*Vr,Pr,Tr,wr,Sr;if(0>(Tt=-Tt/(Pr*Pr+Tr*Tr+wr*wr))){var Cr=a;Cr.x=kt,Cr.y=Mr,Cr.z=Vr,Sr=1}else if(1<Tt){var Rt=a;Rt.x=Lr,Rt.y=Br,Rt.z=kr,Sr=2}else{var qt,qr,Rr;qt=kt+Pr*Tt,qr=Mr+Tr*Tt,Rr=Vr+wr*Tt;var Er=a;Er.x=qt,Er.y=qr,Er.z=Rr,Sr=3}Xr=Sr,Xt=a.x*a.x+a.y*a.y+a.z*a.z;var Ft=a;ur=Ft.x,zr=Ft.y,Yr=Ft.z}if(0>gr){var Nt=t,$t,jr,Nr,Fr,Dr,Wr;$t=Nt.x,jr=Nt.y,Nr=Nt.z;var Gr=i,ai=(Or=(Fr=Gr.x)-$t)*$t+(Hr=(Dr=Gr.y)-jr)*jr+(Jr=(Wr=Gr.z)-Nr)*Nr,Or,Hr,Jr,Ur;if(0>(ai=-ai/(Or*Or+Hr*Hr+Jr*Jr))){var Qr=a;Qr.x=$t,Qr.y=jr,Qr.z=Nr,Ur=1}else if(1<ai){var si=a;si.x=Fr,si.y=Dr,si.z=Wr,Ur=2}else{var _i,Kr,$r;_i=$t+Or*ai,Kr=jr+Hr*ai,$r=Nr+Jr*ai;var tl=a;tl.x=_i,tl.y=Kr,tl.z=$r,Ur=3}var li=a.x*a.x+a.y*a.y+a.z*a.z;if(0>Xt||li<Xt){Xr=Ur<<1,Xt=li;var ci=a;ur=ci.x,zr=ci.y,Yr=ci.z}}if(0>Mt){var mi=te,xi,ol,al,il,nl,_l;xi=mi.x,ol=mi.y,al=mi.z;var el=i,zi=(rl=(il=el.x)-xi)*xi+(sl=(nl=el.y)-ol)*ol+(ll=(_l=el.z)-al)*al,rl,sl,ll,cl;if(0>(zi=-zi/(rl*rl+sl*sl+ll*ll))){var pl=a;pl.x=xi,pl.y=ol,pl.z=al,cl=1}else if(1<zi){var Zi=a;Zi.x=il,Zi.y=nl,Zi.z=_l,cl=2}else{var Ii,ml,bl;Ii=xi+rl*zi,ml=ol+sl*zi,bl=al+ll*zi;var xl=a;xl.x=Ii,xl.y=ml,xl.z=bl,cl=3}var Bi=a.x*a.x+a.y*a.y+a.z*a.z;if(0>Xt||Bi<Xt){Xr=1&cl|(2&cl)<<1,Xt=Bi;var ki=a;ur=ki.x,zr=ki.y,Yr=ki.z}}if(0<Xt){var Ai=a;Ai.x=ur,Ai.y=zr,Ai.z=Yr,Zr=Xr}else{var Pi=ft*ft+xr*xr+dr*dr;0<Pi&&(Pi=1/Math.sqrt(Pi));var dl=(ft*=Pi)*ft+(xr*=Pi)*xr+(dr*=Pi)*dr;ur=ft*(dl=(mt*ft+Se*xr+Ce*dr)/dl),zr=xr*dl,Yr=dr*dl;var yl=a;yl.x=ur,yl.y=zr,yl.z=Yr,Zr=7}ke=Zr,N=a.x*a.x+a.y*a.y+a.z*a.z;var Ti=a;Ae=Ti.x,Pe=Ti.y,Te=Ti.z}if(0>D*Be){var ji=te,ao,fl,gl,vl,Xl,ul,zl,Yl,Zl,Il,Ml,hl,Vl,Ll,Bl,kl,Al,Pl;ao=ji.x,fl=ji.y,gl=ji.z;var Tl=i;vl=Tl.x,Xl=Tl.y,ul=Tl.z;var no=o,eo,wl,Sl;zl=no.x;var Cl=vl*((Ll=(Yl=no.y)-Xl)*(Sl=(Il=vl-ao)*Ll-(Ml=Xl-fl)*(Vl=zl-vl))-(Bl=(Zl=no.z)-ul)*(wl=(hl=ul-gl)*Vl-Il*Bl))+Xl*(Bl*(eo=Ml*Bl-hl*Ll)-Vl*Sl)+ul*(Vl*wl-Ll*eo),po=zl*((Al=fl-Yl)*Sl-(Pl=gl-Zl)*wl)+Yl*(Pl*eo-(kl=ao-zl)*Sl)+Zl*(kl*wl-Al*eo),vo=-1,ql=0,Rl,El,jl,Nl;if(Rl=0,El=0,jl=0,0>ao*(Ml*Sl-hl*wl)+fl*(hl*eo-Il*Sl)+gl*(Il*wl-Ml*eo)){var Fl=te,zo,Dl,Wl,Gl,Ol,Hl;zo=Fl.x,Dl=Fl.y,Wl=Fl.z;var Jl=i,Lo=(Ul=(Gl=Jl.x)-zo)*zo+(Ql=(Ol=Jl.y)-Dl)*Dl+(Kl=(Hl=Jl.z)-Wl)*Wl,Ul,Ql,Kl,$l;if(0>(Lo=-Lo/(Ul*Ul+Ql*Ql+Kl*Kl))){var tc=a;tc.x=zo,tc.y=Dl,tc.z=Wl,$l=1}else if(1<Lo){var Bo=a;Bo.x=Gl,Bo.y=Ol,Bo.z=Hl,$l=2}else{var ko,oc,ac;ko=zo+Ul*Lo,oc=Dl+Ql*Lo,ac=Wl+Kl*Lo;var ic=a;ic.x=ko,ic.y=oc,ic.z=ac,$l=3}ql=$l,vo=a.x*a.x+a.y*a.y+a.z*a.z;var Co=a;Rl=Co.x,El=Co.y,jl=Co.z}if(0>Cl){var To=i,Fo,nc,_c,ec,rc,sc;Fo=To.x,nc=To.y,_c=To.z;var lc=o,Uo=(cc=(ec=lc.x)-Fo)*Fo+(pc=(rc=lc.y)-nc)*nc+(mc=(sc=lc.z)-_c)*_c,cc,pc,mc,bc;if(0>(Uo=-Uo/(cc*cc+pc*pc+mc*mc))){var xc=a;xc.x=Fo,xc.y=nc,xc.z=_c,bc=1}else if(1<Uo){var Qo=a;Qo.x=ec,Qo.y=rc,Qo.z=sc,bc=2}else{var $o,dc,yc;$o=Fo+cc*Uo,dc=nc+pc*Uo,yc=_c+mc*Uo;var fc=a;fc.x=$o,fc.y=dc,fc.z=yc,bc=3}var oa=a.x*a.x+a.y*a.y+a.z*a.z;if(0>vo||oa<vo){ql=bc<<1,vo=oa;var aa=a;Rl=aa.x,El=aa.y,jl=aa.z}}if(0>po){var na=te,ca,gc,vc,Xc,uc,zc;ca=na.x,gc=na.y,vc=na.z;var Yc=o,ba=(Zc=(Xc=Yc.x)-ca)*ca+(Ic=(uc=Yc.y)-gc)*gc+(Mc=(zc=Yc.z)-vc)*vc,Zc,Ic,Mc,hc;if(0>(ba=-ba/(Zc*Zc+Ic*Ic+Mc*Mc))){var Vc=a;Vc.x=ca,Vc.y=gc,Vc.z=vc,hc=1}else if(1<ba){var da=a;da.x=Xc,da.y=uc,da.z=zc,hc=2}else{var xa,Lc,Bc;xa=ca+Zc*ba,Lc=gc+Ic*ba,Bc=vc+Mc*ba;var kc=a;kc.x=xa,kc.y=Lc,kc.z=Bc,hc=3}var Xa=a.x*a.x+a.y*a.y+a.z*a.z;if(0>vo||Xa<vo){ql=1&hc|(2&hc)<<1,vo=Xa;var za=a;Rl=za.x,El=za.y,jl=za.z}}if(0<vo){var Ya=a;Ya.x=Rl,Ya.y=El,Ya.z=jl,Nl=ql}else{var Za=eo*eo+wl*wl+Sl*Sl;0<Za&&(Za=1/Math.sqrt(Za));var Ac=(eo*=Za)*eo+(wl*=Za)*wl+(Sl*=Za)*Sl;Rl=eo*(Ac=(ao*eo+fl*wl+gl*Sl)/Ac),El=wl*Ac,jl=Sl*Ac;var Pc=a;Pc.x=Rl,Pc.y=El,Pc.z=jl,Nl=7}var La=a.x*a.x+a.y*a.y+a.z*a.z;if(0>N||La<N){ke=1&Nl|(6&Nl)<<1,N=La;var wa=a;Ae=wa.x,Pe=wa.y,Te=wa.z}}if(0>J*Be){var Ba=te,Ha,Tc,wc,Sc,Cc,qc,Rc,Ec,jc,Nc,Fc,Dc,Wc,Gc,Oc,Hc,Jc,Uc;Ha=Ba.x,Tc=Ba.y,wc=Ba.z;var Qc=t;Sc=Qc.x,Cc=Qc.y,qc=Qc.z;var Qa=o,on,Kc,$c;Rc=Qa.x;var tp=Sc*((Gc=(Ec=Qa.y)-Cc)*($c=(Nc=Sc-Ha)*Gc-(Fc=Cc-Tc)*(Wc=Rc-Sc))-(Oc=(jc=Qa.z)-qc)*(Kc=(Dc=qc-wc)*Wc-Nc*Oc))+Cc*(Oc*(on=Fc*Oc-Dc*Gc)-Wc*$c)+qc*(Wc*Kc-Gc*on),rn=Rc*((Jc=Tc-Ec)*$c-(Uc=wc-jc)*Kc)+Ec*(Uc*on-(Hc=Ha-Rc)*$c)+jc*(Hc*Kc-Jc*on),en=-1,op=0,ap,ip,np,_p;if(ap=0,ip=0,np=0,0>Ha*(Fc*$c-Dc*Kc)+Tc*(Dc*on-Nc*$c)+wc*(Nc*Kc-Fc*on)){var ep=te,fn,rp,sp,lp,cp,pp;fn=ep.x,rp=ep.y,sp=ep.z;var mp=t,Mn=(bp=(lp=mp.x)-fn)*fn+(xp=(cp=mp.y)-rp)*rp+(dp=(pp=mp.z)-sp)*sp,bp,xp,dp,yp;if(0>(Mn=-Mn/(bp*bp+xp*xp+dp*dp))){var fp=a;fp.x=fn,fp.y=rp,fp.z=sp,yp=1}else if(1<Mn){var zn=a;zn.x=lp,zn.y=cp,zn.z=pp,yp=2}else{var Yn,gp,vp;Yn=fn+bp*Mn,gp=rp+xp*Mn,vp=sp+dp*Mn;var Xp=a;Xp.x=Yn,Xp.y=gp,Xp.z=vp,yp=3}op=yp,en=a.x*a.x+a.y*a.y+a.z*a.z;var Ln=a;ap=Ln.x,ip=Ln.y,np=Ln.z}if(0>tp){var wn=t,Tn,up,zp,Yp,Zp,Ip;Tn=wn.x,up=wn.y,zp=wn.z;var Mp=o,Dn=(hp=(Yp=Mp.x)-Tn)*Tn+(Vp=(Zp=Mp.y)-up)*up+(Lp=(Ip=Mp.z)-zp)*zp,hp,Vp,Lp,Bp;if(0>(Dn=-Dn/(hp*hp+Vp*Vp+Lp*Lp))){var kp=a;kp.x=Tn,kp.y=up,kp.z=zp,Bp=1}else if(1<Dn){var Fn=a;Fn.x=Yp,Fn.y=Zp,Fn.z=Ip,Bp=2}else{var Nn,Ap,Pp;Nn=Tn+hp*Dn,Ap=up+Vp*Dn,Pp=zp+Lp*Dn;var Tp=a;Tp.x=Nn,Tp.y=Ap,Tp.z=Pp,Bp=3}var Un=a.x*a.x+a.y*a.y+a.z*a.z;if(0>en||Un<en){op=Bp<<1,en=Un;var Hn=a;ap=Hn.x,ip=Hn.y,np=Hn.z}}if(0>rn){var Qn=te,ns,wp,Sp,Cp,qp,Rp;ns=Qn.x,wp=Qn.y,Sp=Qn.z;var Ep=o,hs=(jp=(Cp=Ep.x)-ns)*ns+(Np=(qp=Ep.y)-wp)*wp+(Fp=(Rp=Ep.z)-Sp)*Sp,jp,Np,Fp,Dp;if(0>(hs=-hs/(jp*jp+Np*Np+Fp*Fp))){var Wp=a;Wp.x=ns,Wp.y=wp,Wp.z=Sp,Dp=1}else if(1<hs){var cs=a;cs.x=Cp,cs.y=qp,cs.z=Rp,Dp=2}else{var ms,Gp,Op;ms=ns+jp*hs,Gp=wp+Np*hs,Op=Sp+Fp*hs;var Hp=a;Hp.x=ms,Hp.y=Gp,Hp.z=Op,Dp=3}var bs=a.x*a.x+a.y*a.y+a.z*a.z;if(0>en||bs<en){op=1&Dp|(2&Dp)<<1,en=bs;var fs=a;ap=fs.x,ip=fs.y,np=fs.z}}if(0<en){var ds=a;ds.x=ap,ds.y=ip,ds.z=np,_p=op}else{var xs=on*on+Kc*Kc+$c*$c;0<xs&&(xs=1/Math.sqrt(xs));var Jp=(on*=xs)*on+(Kc*=xs)*Kc+($c*=xs)*$c;ap=on*(Jp=(Ha*on+Tc*Kc+wc*$c)/Jp),ip=Kc*Jp,np=$c*Jp;var Up=a;Up.x=ap,Up.y=ip,Up.z=np,_p=7}var Ms=a.x*a.x+a.y*a.y+a.z*a.z;if(0>N||Ms<N){ke=3&_p|(4&_p)<<1,N=Ms;var Xs=a;Ae=Xs.x,Pe=Xs.y,Te=Xs.z}}if(0>F*Be){var zs=t,Js,Qp,Kp,$p,tm,om,am,im,nm,_m,em,rm,sm,lm,cm,pm,mm,bm;Js=zs.x,Qp=zs.y,Kp=zs.z;var xm=i;$p=xm.x,tm=xm.y,om=xm.z;var Fs=o,Ws,dm,ym;am=Fs.x;var fm=$p*((lm=(im=Fs.y)-tm)*(ym=(_m=$p-Js)*lm-(em=tm-Qp)*(sm=am-$p))-(cm=(nm=Fs.z)-om)*(dm=(rm=om-Kp)*sm-_m*cm))+tm*(cm*(Ws=em*cm-rm*lm)-sm*ym)+om*(sm*dm-lm*Ws),Ks=am*((mm=Qp-im)*ym-(bm=Kp-nm)*dm)+im*(bm*Ws-(pm=Js-am)*ym)+nm*(pm*dm-mm*Ws),t_=-1,gm=0,vm,Xm,um,zm;if(vm=0,Xm=0,um=0,0>Js*(em*ym-rm*dm)+Qp*(rm*Ws-_m*ym)+Kp*(_m*dm-em*Ws)){var Ym=t,h_,Zm,Im,Mm,hm,Vm;h_=Ym.x,Zm=Ym.y,Im=Ym.z;var Lm=i,v_=(Bm=(Mm=Lm.x)-h_)*h_+(km=(hm=Lm.y)-Zm)*Zm+(Am=(Vm=Lm.z)-Im)*Im,Bm,km,Am,Pm;if(0>(v_=-v_/(Bm*Bm+km*km+Am*Am))){var Tm=a;Tm.x=h_,Tm.y=Zm,Tm.z=Im,Pm=1}else if(1<v_){var b_=a;b_.x=Mm,b_.y=hm,b_.z=Vm,Pm=2}else{var f_,wm,Sm;f_=h_+Bm*v_,wm=Zm+km*v_,Sm=Im+Am*v_;var Cm=a;Cm.x=f_,Cm.y=wm,Cm.z=Sm,Pm=3}gm=Pm,t_=a.x*a.x+a.y*a.y+a.z*a.z;var g_=a;vm=g_.x,Xm=g_.y,um=g_.z}if(0>fm){var M_=i,L_,qm,Rm,Em,jm,Nm;L_=M_.x,qm=M_.y,Rm=M_.z;var Fm=o,P_=(Dm=(Em=Fm.x)-L_)*L_+(Wm=(jm=Fm.y)-qm)*qm+(Gm=(Nm=Fm.z)-Rm)*Rm,Dm,Wm,Gm,Om;if(0>(P_=-P_/(Dm*Dm+Wm*Wm+Gm*Gm))){var Hm=a;Hm.x=L_,Hm.y=qm,Hm.z=Rm,Om=1}else if(1<P_){var C_=a;C_.x=Em,C_.y=jm,C_.z=Nm,Om=2}else{var T_,Jm,Um;T_=L_+Dm*P_,Jm=qm+Wm*P_,Um=Rm+Gm*P_;var Qm=a;Qm.x=T_,Qm.y=Jm,Qm.z=Um,Om=3}var E_=a.x*a.x+a.y*a.y+a.z*a.z;if(0>t_||E_<t_){gm=Om<<1,t_=E_;var D_=a;vm=D_.x,Xm=D_.y,um=D_.z}}if(0>Ks){var J_=t,H_,Km,$m,tb,ob,ab;H_=J_.x,Km=J_.y,$m=J_.z;var ib=o,ir=(nb=(tb=ib.x)-H_)*H_+(_b=(ob=ib.y)-Km)*Km+(eb=(ab=ib.z)-$m)*$m,nb,_b,eb,rb;if(0>(ir=-ir/(nb*nb+_b*_b+eb*eb))){var sb=a;sb.x=H_,sb.y=Km,sb.z=$m,rb=1}else if(1<ir){var ar=a;ar.x=tb,ar.y=ob,ar.z=ab,rb=2}else{var nr,lb,cb;nr=H_+nb*ir,lb=Km+_b*ir,cb=$m+eb*ir;var pb=a;pb.x=nr,pb.y=lb,pb.z=cb,rb=3}var er=a.x*a.x+a.y*a.y+a.z*a.z;if(0>t_||er<t_){gm=1&rb|(2&rb)<<1,t_=er;var hr=a;vm=hr.x,Xm=hr.y,um=hr.z}}if(0<t_){var lr=a;lr.x=vm,lr.y=Xm,lr.z=um,zm=gm}else{var cr=Ws*Ws+dm*dm+ym*ym;0<cr&&(cr=1/Math.sqrt(cr));var mb=(Ws*=cr)*Ws+(dm*=cr)*dm+(ym*=cr)*ym;vm=Ws*(mb=(Js*Ws+Qp*dm+Kp*ym)/mb),Xm=dm*mb,um=ym*mb;var bb=a;bb.x=vm,bb.y=Xm,bb.z=um,zm=7}var vr=a.x*a.x+a.y*a.y+a.z*a.z;if(0>N||vr<N){ke=zm<<1,N=vr;var yr=a;Ae=yr.x,Pe=yr.y,Te=yr.z}}if(0<N){var br=a;return br.x=Ae,br.y=Pe,br.z=Te,ke}return a.zero(),15};var oimo_common_Mat3=function(l,c,p,m,b,x,d,y,f){null==f&&(f=1),null==y&&(y=0),null==d&&(d=0),null==x&&(x=0),null==b&&(b=1),null==m&&(m=0),null==p&&(p=0),null==c&&(c=0),null==l&&(l=1),this.e00=l,this.e01=c,this.e02=p,this.e10=m,this.e11=b,this.e12=x,this.e20=d,this.e21=y,this.e22=f,oimo_common_Mat3.numCreations++};oimo_common_Mat3.prototype={init:function(l,t,i,o,a,n,s,_,r){return this.e00=l,this.e01=t,this.e02=i,this.e10=o,this.e11=a,this.e12=n,this.e20=s,this.e21=_,this.e22=r,this},identity:function(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this},add:function(o){return new oimo_common_Mat3(this.e00+o.e00,this.e01+o.e01,this.e02+o.e02,this.e10+o.e10,this.e11+o.e11,this.e12+o.e12,this.e20+o.e20,this.e21+o.e21,this.e22+o.e22)},sub:function(o){return new oimo_common_Mat3(this.e00-o.e00,this.e01-o.e01,this.e02-o.e02,this.e10-o.e10,this.e11-o.e11,this.e12-o.e12,this.e20-o.e20,this.e21-o.e21,this.e22-o.e22)},scale:function(o){return new oimo_common_Mat3(this.e00*o,this.e01*o,this.e02*o,this.e10*o,this.e11*o,this.e12*o,this.e20*o,this.e21*o,this.e22*o)},mul:function(o){return new oimo_common_Mat3(this.e00*o.e00+this.e01*o.e10+this.e02*o.e20,this.e00*o.e01+this.e01*o.e11+this.e02*o.e21,this.e00*o.e02+this.e01*o.e12+this.e02*o.e22,this.e10*o.e00+this.e11*o.e10+this.e12*o.e20,this.e10*o.e01+this.e11*o.e11+this.e12*o.e21,this.e10*o.e02+this.e11*o.e12+this.e12*o.e22,this.e20*o.e00+this.e21*o.e10+this.e22*o.e20,this.e20*o.e01+this.e21*o.e11+this.e22*o.e21,this.e20*o.e02+this.e21*o.e12+this.e22*o.e22)},addEq:function(l){var t=this.e00+l.e00,i=this.e01+l.e01,o=this.e02+l.e02,a=this.e10+l.e10,n=this.e11+l.e11,s=this.e12+l.e12,_=this.e20+l.e20,r=this.e21+l.e21,e=this.e22+l.e22;return this.e00=t,this.e01=i,this.e02=o,this.e10=a,this.e11=n,this.e12=s,this.e20=_,this.e21=r,this.e22=e,this},subEq:function(l){var t=this.e00-l.e00,i=this.e01-l.e01,o=this.e02-l.e02,a=this.e10-l.e10,n=this.e11-l.e11,s=this.e12-l.e12,_=this.e20-l.e20,r=this.e21-l.e21,e=this.e22-l.e22;return this.e00=t,this.e01=i,this.e02=o,this.e10=a,this.e11=n,this.e12=s,this.e20=_,this.e21=r,this.e22=e,this},scaleEq:function(l){var t=this.e00*l,i=this.e01*l,o=this.e02*l,a=this.e10*l,n=this.e11*l,s=this.e12*l,_=this.e20*l,r=this.e21*l,e=this.e22*l;return this.e00=t,this.e01=i,this.e02=o,this.e10=a,this.e11=n,this.e12=s,this.e20=_,this.e21=r,this.e22=e,this},mulEq:function(l){var t=this.e00*l.e00+this.e01*l.e10+this.e02*l.e20,i=this.e00*l.e01+this.e01*l.e11+this.e02*l.e21,o=this.e00*l.e02+this.e01*l.e12+this.e02*l.e22,a=this.e10*l.e00+this.e11*l.e10+this.e12*l.e20,n=this.e10*l.e01+this.e11*l.e11+this.e12*l.e21,s=this.e10*l.e02+this.e11*l.e12+this.e12*l.e22,_=this.e20*l.e00+this.e21*l.e10+this.e22*l.e20,r=this.e20*l.e01+this.e21*l.e11+this.e22*l.e21,e=this.e20*l.e02+this.e21*l.e12+this.e22*l.e22;return this.e00=t,this.e01=i,this.e02=o,this.e10=a,this.e11=n,this.e12=s,this.e20=_,this.e21=r,this.e22=e,this},prependScale:function(a,t,i){return new oimo_common_Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*t,this.e11*t,this.e12*t,this.e20*i,this.e21*i,this.e22*i)},appendScale:function(a,t,i){return new oimo_common_Mat3(this.e00*a,this.e01*t,this.e02*i,this.e10*a,this.e11*t,this.e12*i,this.e20*a,this.e21*t,this.e22*i)},prependRotation:function(b,t,i,o){var a=Math.sin(b),n=Math.cos(b),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,x=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,d=o*o*s+n;return new oimo_common_Mat3(_*this.e00+r*this.e10+e*this.e20,_*this.e01+r*this.e11+e*this.e21,_*this.e02+r*this.e12+e*this.e22,x*this.e00+l*this.e10+c*this.e20,x*this.e01+l*this.e11+c*this.e21,x*this.e02+l*this.e12+c*this.e22,m*this.e00+p*this.e10+d*this.e20,m*this.e01+p*this.e11+d*this.e21,m*this.e02+p*this.e12+d*this.e22)},appendRotation:function(b,t,i,o){var a=Math.sin(b),n=Math.cos(b),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,x=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,d=o*o*s+n;return new oimo_common_Mat3(this.e00*_+this.e01*x+this.e02*m,this.e00*r+this.e01*l+this.e02*p,this.e00*e+this.e01*c+this.e02*d,this.e10*_+this.e11*x+this.e12*m,this.e10*r+this.e11*l+this.e12*p,this.e10*e+this.e11*c+this.e12*d,this.e20*_+this.e21*x+this.e22*m,this.e20*r+this.e21*l+this.e22*p,this.e20*e+this.e21*c+this.e22*d)},prependScaleEq:function(p,t,i){var o=this.e00*p,a=this.e01*p,n=this.e02*p,s=this.e10*t,_=this.e11*t,r=this.e12*t,e=this.e20*i,m=this.e21*i,l=this.e22*i;return this.e00=o,this.e01=a,this.e02=n,this.e10=s,this.e11=_,this.e12=r,this.e20=e,this.e21=m,this.e22=l,this},appendScaleEq:function(p,t,i){var o=this.e00*p,a=this.e01*t,n=this.e02*i,s=this.e10*p,_=this.e11*t,r=this.e12*i,e=this.e20*p,m=this.e21*t,l=this.e22*i;return this.e00=o,this.e01=a,this.e02=n,this.e10=s,this.e11=_,this.e12=r,this.e20=e,this.e21=m,this.e22=l,this},prependRotationEq:function(Y,t,i,o){var a=Math.sin(Y),n=Math.cos(Y),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,Z=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,v=o*o*s+n,y=_*this.e00+r*this.e10+e*this.e20,b=_*this.e01+r*this.e11+e*this.e21,f=_*this.e02+r*this.e12+e*this.e22,d=Z*this.e00+l*this.e10+c*this.e20,x=Z*this.e01+l*this.e11+c*this.e21,u=Z*this.e02+l*this.e12+c*this.e22,g=m*this.e00+p*this.e10+v*this.e20,I=m*this.e01+p*this.e11+v*this.e21,X=m*this.e02+p*this.e12+v*this.e22;return this.e00=y,this.e01=b,this.e02=f,this.e10=d,this.e11=x,this.e12=u,this.e20=g,this.e21=I,this.e22=X,this},appendRotationEq:function(Y,t,i,o){var a=Math.sin(Y),n=Math.cos(Y),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,Z=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,v=o*o*s+n,y=this.e00*_+this.e01*Z+this.e02*m,b=this.e00*r+this.e01*l+this.e02*p,f=this.e00*e+this.e01*c+this.e02*v,d=this.e10*_+this.e11*Z+this.e12*m,x=this.e10*r+this.e11*l+this.e12*p,u=this.e10*e+this.e11*c+this.e12*v,g=this.e20*_+this.e21*Z+this.e22*m,I=this.e20*r+this.e21*l+this.e22*p,X=this.e20*e+this.e21*c+this.e22*v;return this.e00=y,this.e01=b,this.e02=f,this.e10=d,this.e11=x,this.e12=u,this.e20=g,this.e21=I,this.e22=X,this},transpose:function(){return new oimo_common_Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)},transposeEq:function(){var l=this.e00,t=this.e10,i=this.e20,o=this.e01,a=this.e11,n=this.e21,s=this.e02,_=this.e12,r=this.e22;return this.e00=l,this.e01=t,this.e02=i,this.e10=o,this.e11=a,this.e12=n,this.e20=s,this.e21=_,this.e22=r,this},determinant:function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)},trace:function(){return this.e00+this.e11+this.e22},inverse:function(){var l=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,o=this.e01*this.e22-this.e02*this.e21,a=this.e00*this.e22-this.e02*this.e20,n=this.e00*this.e21-this.e01*this.e20,s=this.e01*this.e12-this.e02*this.e11,_=this.e00*this.e12-this.e02*this.e10,r=this.e00*this.e11-this.e01*this.e10,e=this.e00*l-this.e01*t+this.e02*i;return 0!=e&&(e=1/e),new oimo_common_Mat3(l*e,-o*e,s*e,-t*e,a*e,-_*e,i*e,-n*e,r*e)},inverseEq:function(){var x=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,o=this.e01*this.e22-this.e02*this.e21,a=this.e00*this.e22-this.e02*this.e20,n=this.e00*this.e21-this.e01*this.e20,s=this.e01*this.e12-this.e02*this.e11,_=this.e00*this.e12-this.e02*this.e10,r=this.e00*this.e11-this.e01*this.e10,e=this.e00*x-this.e01*t+this.e02*i;0!=e&&(e=1/e);var g=x*e,l=-o*e,c=s*e,m=-t*e,p=a*e,v=-_*e,y=i*e,b=-n*e,f=r*e;return this.e00=g,this.e01=l,this.e02=c,this.e10=m,this.e11=p,this.e12=v,this.e20=y,this.e21=b,this.e22=f,this},toArray:function(o){return null==o&&(o=!1),o?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]},copyFrom:function(o){return this.e00=o.e00,this.e01=o.e01,this.e02=o.e02,this.e10=o.e10,this.e11=o.e11,this.e12=o.e12,this.e20=o.e20,this.e21=o.e21,this.e22=o.e22,this},clone:function(){return new oimo_common_Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)},fromQuat:function(x){var t=x.x,i=x.y,o=x.z,a=x.w,n=2*t,s=2*i,_=2*o,r=t*n,e=i*s,d=o*_,l=t*s,c=i*_,m=t*_,p=a*n,f=a*s,y=a*_;return this.e00=1-e-d,this.e01=l-y,this.e02=m+f,this.e10=l+y,this.e11=1-r-d,this.e12=c-p,this.e20=m-f,this.e21=c+p,this.e22=1-r-e,this},toQuat:function(){var _=new oimo_common_Quat,i=this.e00,o=this.e11,a=this.e22,n=i+o+a,e;return 0<n?(e=Math.sqrt(n+1),_.w=.5*e,e=.5/e,_.x=(this.e21-this.e12)*e,_.y=(this.e02-this.e20)*e,_.z=(this.e10-this.e01)*e):i>o?i>a?(e=Math.sqrt(i-o-a+1),_.x=.5*e,e=.5/e,_.y=(this.e01+this.e10)*e,_.z=(this.e02+this.e20)*e,_.w=(this.e21-this.e12)*e):(e=Math.sqrt(a-i-o+1),_.z=.5*e,e=.5/e,_.x=(this.e02+this.e20)*e,_.y=(this.e12+this.e21)*e,_.w=(this.e10-this.e01)*e):o>a?(e=Math.sqrt(o-a-i+1),_.y=.5*e,e=.5/e,_.x=(this.e01+this.e10)*e,_.z=(this.e12+this.e21)*e,_.w=(this.e02-this.e20)*e):(e=Math.sqrt(a-i-o+1),_.z=.5*e,e=.5/e,_.x=(this.e02+this.e20)*e,_.y=(this.e12+this.e21)*e,_.w=(this.e10-this.e01)*e),_},fromEulerXyz:function(e){var t=Math.sin(e.x),i=Math.sin(e.y),o=Math.sin(e.z),a=Math.cos(e.x),n=Math.cos(e.y),r=Math.cos(e.z);return this.e00=n*r,this.e01=-n*o,this.e02=i,this.e10=a*o+r*t*i,this.e11=a*r-t*i*o,this.e12=-n*t,this.e20=t*o-a*r*i,this.e21=r*t+a*i*o,this.e22=a*n,this},toEulerXyz:function(){var _=this.e02;if(-1>=_){var t=Math.atan2(this.e21,this.e11);return new oimo_common_Vec3(.5*t,-1.570796326794895,.5*-t)}if(1<=_){var i=Math.atan2(this.e21,this.e11);return new oimo_common_Vec3(.5*i,1.570796326794895,.5*i)}var o=Math.asin(_),a=Math.atan2(-this.e12,this.e22),n=Math.atan2(-this.e01,this.e00);return new oimo_common_Vec3(a,o,n)},getRow:function(o){return 0==o?new oimo_common_Vec3(this.e00,this.e01,this.e02):1==o?new oimo_common_Vec3(this.e10,this.e11,this.e12):2==o?new oimo_common_Vec3(this.e20,this.e21,this.e22):null},getCol:function(o){return 0==o?new oimo_common_Vec3(this.e00,this.e10,this.e20):1==o?new oimo_common_Vec3(this.e01,this.e11,this.e21):2==o?new oimo_common_Vec3(this.e02,this.e12,this.e22):null},getRowTo:function(o,t){0==o?t.init(this.e00,this.e01,this.e02):1==o?t.init(this.e10,this.e11,this.e12):2==o?t.init(this.e20,this.e21,this.e22):t.zero()},getColTo:function(o,t){0==o?t.init(this.e00,this.e10,this.e20):1==o?t.init(this.e01,this.e11,this.e21):2==o?t.init(this.e02,this.e12,this.e22):t.zero()},fromRows:function(p,t,i){var o=p.x,a=p.y,n=p.z,s=t.x,_=t.y,r=t.z,e=i.x,m=i.y,l=i.z;return this.e00=o,this.e01=a,this.e02=n,this.e10=s,this.e11=_,this.e12=r,this.e20=e,this.e21=m,this.e22=l,this},fromCols:function(p,t,i){var o=p.x,a=t.x,n=i.x,s=p.y,_=t.y,r=i.y,e=p.z,m=t.z,l=i.z;return this.e00=o,this.e01=a,this.e02=n,this.e10=s,this.e11=_,this.e12=r,this.e20=e,this.e21=m,this.e22=l,this},toString:function(){return"Mat3["+(0<this.e00?(0|1e7*this.e00+.5)/1e7:(0|1e7*this.e00-.5)/1e7)+", "+(0<this.e01?(0|1e7*this.e01+.5)/1e7:(0|1e7*this.e01-.5)/1e7)+", "+(0<this.e02?(0|1e7*this.e02+.5)/1e7:(0|1e7*this.e02-.5)/1e7)+",\n     "+(0<this.e10?(0|1e7*this.e10+.5)/1e7:(0|1e7*this.e10-.5)/1e7)+", "+(0<this.e11?(0|1e7*this.e11+.5)/1e7:(0|1e7*this.e11-.5)/1e7)+", "+(0<this.e12?(0|1e7*this.e12+.5)/1e7:(0|1e7*this.e12-.5)/1e7)+",\n     "+(0<this.e20?(0|1e7*this.e20+.5)/1e7:(0|1e7*this.e20-.5)/1e7)+", "+(0<this.e21?(0|1e7*this.e21+.5)/1e7:(0|1e7*this.e21-.5)/1e7)+", "+(0<this.e22?(0|1e7*this.e22+.5)/1e7:(0|1e7*this.e22-.5)/1e7)+"]"}};var oimo_common_Mat4=function(b,x,d,f,g,X,u,z,Y,Z,I,M,V,L,B,k){null==k&&(k=1),null==B&&(B=0),null==L&&(L=0),null==V&&(V=0),null==M&&(M=0),null==I&&(I=1),null==Z&&(Z=0),null==Y&&(Y=0),null==z&&(z=0),null==u&&(u=0),null==X&&(X=1),null==g&&(g=0),null==f&&(f=0),null==d&&(d=0),null==x&&(x=0),null==b&&(b=1),this.e00=b,this.e01=x,this.e02=d,this.e03=f,this.e10=g,this.e11=X,this.e12=u,this.e13=z,this.e20=Y,this.e21=Z,this.e22=I,this.e23=M,this.e30=V,this.e31=L,this.e32=B,this.e33=k,oimo_common_Mat4.numCreations++};oimo_common_Mat4.prototype={init:function(b,t,i,o,a,n,s,_,r,e,x,l,c,m,p,d){return this.e00=b,this.e01=t,this.e02=i,this.e03=o,this.e10=a,this.e11=n,this.e12=s,this.e13=_,this.e20=r,this.e21=e,this.e22=x,this.e23=l,this.e30=c,this.e31=m,this.e32=p,this.e33=d,this},identity:function(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},add:function(o){return new oimo_common_Mat4(this.e00+o.e00,this.e01+o.e01,this.e02+o.e02,this.e03+o.e03,this.e10+o.e10,this.e11+o.e11,this.e12+o.e12,this.e13+o.e13,this.e20+o.e20,this.e21+o.e21,this.e22+o.e22,this.e23+o.e23,this.e30+o.e30,this.e31+o.e31,this.e32+o.e32,this.e33+o.e33)},sub:function(o){return new oimo_common_Mat4(this.e00-o.e00,this.e01-o.e01,this.e02-o.e02,this.e03-o.e03,this.e10-o.e10,this.e11-o.e11,this.e12-o.e12,this.e13-o.e13,this.e20-o.e20,this.e21-o.e21,this.e22-o.e22,this.e23-o.e23,this.e30-o.e30,this.e31-o.e31,this.e32-o.e32,this.e33-o.e33)},scale:function(o){return new oimo_common_Mat4(this.e00*o,this.e01*o,this.e02*o,this.e03*o,this.e10*o,this.e11*o,this.e12*o,this.e13*o,this.e20*o,this.e21*o,this.e22*o,this.e23*o,this.e30*o,this.e31*o,this.e32*o,this.e33*o)},mul:function(o){return new oimo_common_Mat4(this.e00*o.e00+this.e01*o.e10+this.e02*o.e20+this.e03*o.e30,this.e00*o.e01+this.e01*o.e11+this.e02*o.e21+this.e03*o.e31,this.e00*o.e02+this.e01*o.e12+this.e02*o.e22+this.e03*o.e32,this.e00*o.e03+this.e01*o.e13+this.e02*o.e23+this.e03*o.e33,this.e10*o.e00+this.e11*o.e10+this.e12*o.e20+this.e13*o.e30,this.e10*o.e01+this.e11*o.e11+this.e12*o.e21+this.e13*o.e31,this.e10*o.e02+this.e11*o.e12+this.e12*o.e22+this.e13*o.e32,this.e10*o.e03+this.e11*o.e13+this.e12*o.e23+this.e13*o.e33,this.e20*o.e00+this.e21*o.e10+this.e22*o.e20+this.e23*o.e30,this.e20*o.e01+this.e21*o.e11+this.e22*o.e21+this.e23*o.e31,this.e20*o.e02+this.e21*o.e12+this.e22*o.e22+this.e23*o.e32,this.e20*o.e03+this.e21*o.e13+this.e22*o.e23+this.e23*o.e33,this.e30*o.e00+this.e31*o.e10+this.e32*o.e20+this.e33*o.e30,this.e30*o.e01+this.e31*o.e11+this.e32*o.e21+this.e33*o.e31,this.e30*o.e02+this.e31*o.e12+this.e32*o.e22+this.e33*o.e32,this.e30*o.e03+this.e31*o.e13+this.e32*o.e23+this.e33*o.e33)},addEq:function(x){var t=this.e00+x.e00,i=this.e01+x.e01,o=this.e02+x.e02,a=this.e03+x.e03,n=this.e10+x.e10,s=this.e11+x.e11,_=this.e12+x.e12,r=this.e13+x.e13,e=this.e20+x.e20,d=this.e21+x.e21,l=this.e22+x.e22,c=this.e23+x.e23,m=this.e30+x.e30,p=this.e31+x.e31,f=this.e32+x.e32,y=this.e33+x.e33;return this.e00=t,this.e01=i,this.e02=o,this.e03=a,this.e10=n,this.e11=s,this.e12=_,this.e13=r,this.e20=e,this.e21=d,this.e22=l,this.e23=c,this.e30=m,this.e31=p,this.e32=f,this.e33=y,this},subEq:function(x){var t=this.e00-x.e00,i=this.e01-x.e01,o=this.e02-x.e02,a=this.e03-x.e03,n=this.e10-x.e10,s=this.e11-x.e11,_=this.e12-x.e12,r=this.e13-x.e13,e=this.e20-x.e20,d=this.e21-x.e21,l=this.e22-x.e22,c=this.e23-x.e23,m=this.e30-x.e30,p=this.e31-x.e31,f=this.e32-x.e32,y=this.e33-x.e33;return this.e00=t,this.e01=i,this.e02=o,this.e03=a,this.e10=n,this.e11=s,this.e12=_,this.e13=r,this.e20=e,this.e21=d,this.e22=l,this.e23=c,this.e30=m,this.e31=p,this.e32=f,this.e33=y,this},scaleEq:function(x){var t=this.e00*x,i=this.e01*x,o=this.e02*x,a=this.e03*x,n=this.e10*x,s=this.e11*x,_=this.e12*x,r=this.e13*x,e=this.e20*x,d=this.e21*x,l=this.e22*x,c=this.e23*x,m=this.e30*x,p=this.e31*x,f=this.e32*x,y=this.e33*x;return this.e00=t,this.e01=i,this.e02=o,this.e03=a,this.e10=n,this.e11=s,this.e12=_,this.e13=r,this.e20=e,this.e21=d,this.e22=l,this.e23=c,this.e30=m,this.e31=p,this.e32=f,this.e33=y,this},mulEq:function(x){var t=this.e00*x.e00+this.e01*x.e10+this.e02*x.e20+this.e03*x.e30,i=this.e00*x.e01+this.e01*x.e11+this.e02*x.e21+this.e03*x.e31,o=this.e00*x.e02+this.e01*x.e12+this.e02*x.e22+this.e03*x.e32,a=this.e00*x.e03+this.e01*x.e13+this.e02*x.e23+this.e03*x.e33,n=this.e10*x.e00+this.e11*x.e10+this.e12*x.e20+this.e13*x.e30,s=this.e10*x.e01+this.e11*x.e11+this.e12*x.e21+this.e13*x.e31,_=this.e10*x.e02+this.e11*x.e12+this.e12*x.e22+this.e13*x.e32,r=this.e10*x.e03+this.e11*x.e13+this.e12*x.e23+this.e13*x.e33,e=this.e20*x.e00+this.e21*x.e10+this.e22*x.e20+this.e23*x.e30,d=this.e20*x.e01+this.e21*x.e11+this.e22*x.e21+this.e23*x.e31,l=this.e20*x.e02+this.e21*x.e12+this.e22*x.e22+this.e23*x.e32,c=this.e20*x.e03+this.e21*x.e13+this.e22*x.e23+this.e23*x.e33,m=this.e30*x.e00+this.e31*x.e10+this.e32*x.e20+this.e33*x.e30,p=this.e30*x.e01+this.e31*x.e11+this.e32*x.e21+this.e33*x.e31,f=this.e30*x.e02+this.e31*x.e12+this.e32*x.e22+this.e33*x.e32,y=this.e30*x.e03+this.e31*x.e13+this.e32*x.e23+this.e33*x.e33;return this.e00=t,this.e01=i,this.e02=o,this.e03=a,this.e10=n,this.e11=s,this.e12=_,this.e13=r,this.e20=e,this.e21=d,this.e22=l,this.e23=c,this.e30=m,this.e31=p,this.e32=f,this.e33=y,this},prependScale:function(a,t,i){return new oimo_common_Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30,this.e31,this.e32,this.e33)},appendScale:function(a,t,i){return new oimo_common_Mat4(this.e00*a,this.e01*t,this.e02*i,this.e03,this.e10*a,this.e11*t,this.e12*i,this.e13,this.e20*a,this.e21*t,this.e22*i,this.e23,this.e30*a,this.e31*t,this.e32*i,this.e33)},prependRotation:function(b,t,i,o){var a=Math.sin(b),n=Math.cos(b),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,x=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,d=o*o*s+n;return new oimo_common_Mat4(_*this.e00+r*this.e10+e*this.e20,_*this.e01+r*this.e11+e*this.e21,_*this.e02+r*this.e12+e*this.e22,_*this.e03+r*this.e13+e*this.e23,x*this.e00+l*this.e10+c*this.e20,x*this.e01+l*this.e11+c*this.e21,x*this.e02+l*this.e12+c*this.e22,x*this.e03+l*this.e13+c*this.e23,m*this.e00+p*this.e10+d*this.e20,m*this.e01+p*this.e11+d*this.e21,m*this.e02+p*this.e12+d*this.e22,m*this.e03+p*this.e13+d*this.e23,this.e30,this.e31,this.e32,this.e33)},appendRotation:function(b,t,i,o){var a=Math.sin(b),n=Math.cos(b),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,x=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,d=o*o*s+n;return new oimo_common_Mat4(this.e00*_+this.e01*x+this.e02*m,this.e00*r+this.e01*l+this.e02*p,this.e00*e+this.e01*c+this.e02*d,this.e03,this.e10*_+this.e11*x+this.e12*m,this.e10*r+this.e11*l+this.e12*p,this.e10*e+this.e11*c+this.e12*d,this.e13,this.e20*_+this.e21*x+this.e22*m,this.e20*r+this.e21*l+this.e22*p,this.e20*e+this.e21*c+this.e22*d,this.e23,this.e30*_+this.e31*x+this.e32*m,this.e30*r+this.e31*l+this.e32*p,this.e30*e+this.e31*c+this.e32*d,this.e33)},prependTranslation:function(a,t,i){return new oimo_common_Mat4(this.e00+a*this.e30,this.e01+a*this.e31,this.e02+a*this.e32,this.e03+a*this.e33,this.e10+t*this.e30,this.e11+t*this.e31,this.e12+t*this.e32,this.e13+t*this.e33,this.e20+i*this.e30,this.e21+i*this.e31,this.e22+i*this.e32,this.e23+i*this.e33,this.e30,this.e31,this.e32,this.e33)},appendTranslation:function(a,t,i){return new oimo_common_Mat4(this.e00,this.e01,this.e02,this.e00*a+this.e01*t+this.e02*i+this.e03,this.e10,this.e11,this.e12,this.e10*a+this.e11*t+this.e12*i+this.e13,this.e20,this.e21,this.e22,this.e20*a+this.e21*t+this.e22*i+this.e23,this.e30,this.e31,this.e32,this.e30*a+this.e31*t+this.e32*i+this.e33)},prependScaleEq:function(x,t,i){var o=this.e00*x,a=this.e01*x,n=this.e02*x,s=this.e03*x,_=this.e10*t,r=this.e11*t,e=this.e12*t,g=this.e13*t,l=this.e20*i,c=this.e21*i,m=this.e22*i,p=this.e23*i,v=this.e30,y=this.e31,b=this.e32,f=this.e33;return this.e00=o,this.e01=a,this.e02=n,this.e03=s,this.e10=_,this.e11=r,this.e12=e,this.e13=g,this.e20=l,this.e21=c,this.e22=m,this.e23=p,this.e30=v,this.e31=y,this.e32=b,this.e33=f,this},appendScaleEq:function(x,t,i){var o=this.e00*x,a=this.e01*t,n=this.e02*i,s=this.e03,_=this.e10*x,r=this.e11*t,e=this.e12*i,g=this.e13,l=this.e20*x,c=this.e21*t,m=this.e22*i,p=this.e23,v=this.e30*x,y=this.e31*t,b=this.e32*i,f=this.e33;return this.e00=o,this.e01=a,this.e02=n,this.e03=s,this.e10=_,this.e11=r,this.e12=e,this.e13=g,this.e20=l,this.e21=c,this.e22=m,this.e23=p,this.e30=v,this.e31=y,this.e32=b,this.e33=f,this},prependRotationEq:function(k,t,i,o){var a=Math.sin(k),n=Math.cos(k),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,h=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,v=o*o*s+n,y=_*this.e00+r*this.e10+e*this.e20,b=_*this.e01+r*this.e11+e*this.e21,f=_*this.e02+r*this.e12+e*this.e22,d=_*this.e03+r*this.e13+e*this.e23,x=h*this.e00+l*this.e10+c*this.e20,u=h*this.e01+l*this.e11+c*this.e21,g=h*this.e02+l*this.e12+c*this.e22,M=h*this.e03+l*this.e13+c*this.e23,X=m*this.e00+p*this.e10+v*this.e20,z=m*this.e01+p*this.e11+v*this.e21,Y=m*this.e02+p*this.e12+v*this.e22,Z=m*this.e03+p*this.e13+v*this.e23,I=this.e30,V=this.e31,L=this.e32,A=this.e33;return this.e00=y,this.e01=b,this.e02=f,this.e03=d,this.e10=x,this.e11=u,this.e12=g,this.e13=M,this.e20=X,this.e21=z,this.e22=Y,this.e23=Z,this.e30=I,this.e31=V,this.e32=L,this.e33=A,this},appendRotationEq:function(k,t,i,o){var a=Math.sin(k),n=Math.cos(k),s=1-n,_=t*t*s+n,r=t*i*s-o*a,e=t*o*s+i*a,h=i*t*s+o*a,l=i*i*s+n,c=i*o*s-t*a,m=o*t*s-i*a,p=o*i*s+t*a,v=o*o*s+n,y=this.e00*_+this.e01*h+this.e02*m,b=this.e00*r+this.e01*l+this.e02*p,f=this.e00*e+this.e01*c+this.e02*v,d=this.e03,x=this.e10*_+this.e11*h+this.e12*m,u=this.e10*r+this.e11*l+this.e12*p,g=this.e10*e+this.e11*c+this.e12*v,M=this.e13,X=this.e20*_+this.e21*h+this.e22*m,z=this.e20*r+this.e21*l+this.e22*p,Y=this.e20*e+this.e21*c+this.e22*v,Z=this.e23,I=this.e30*_+this.e31*h+this.e32*m,V=this.e30*r+this.e31*l+this.e32*p,L=this.e30*e+this.e31*c+this.e32*v,A=this.e33;return this.e00=y,this.e01=b,this.e02=f,this.e03=d,this.e10=x,this.e11=u,this.e12=g,this.e13=M,this.e20=X,this.e21=z,this.e22=Y,this.e23=Z,this.e30=I,this.e31=V,this.e32=L,this.e33=A,this},prependTranslationEq:function(x,t,i){var o=this.e00+x*this.e30,a=this.e01+x*this.e31,n=this.e02+x*this.e32,s=this.e03+x*this.e33,_=this.e10+t*this.e30,r=this.e11+t*this.e31,e=this.e12+t*this.e32,g=this.e13+t*this.e33,l=this.e20+i*this.e30,c=this.e21+i*this.e31,m=this.e22+i*this.e32,p=this.e23+i*this.e33,v=this.e30,y=this.e31,b=this.e32,f=this.e33;return this.e00=o,this.e01=a,this.e02=n,this.e03=s,this.e10=_,this.e11=r,this.e12=e,this.e13=g,this.e20=l,this.e21=c,this.e22=m,this.e23=p,this.e30=v,this.e31=y,this.e32=b,this.e33=f,this},appendTranslationEq:function(x,t,i){var o=this.e00,a=this.e01,n=this.e02,s=this.e00*x+this.e01*t+this.e02*i+this.e03,_=this.e10,r=this.e11,e=this.e12,g=this.e10*x+this.e11*t+this.e12*i+this.e13,l=this.e20,c=this.e21,m=this.e22,p=this.e20*x+this.e21*t+this.e22*i+this.e23,v=this.e30,y=this.e31,b=this.e32,f=this.e30*x+this.e31*t+this.e32*i+this.e33;return this.e00=o,this.e01=a,this.e02=n,this.e03=s,this.e10=_,this.e11=r,this.e12=e,this.e13=g,this.e20=l,this.e21=c,this.e22=m,this.e23=p,this.e30=v,this.e31=y,this.e32=b,this.e33=f,this},transpose:function(){return new oimo_common_Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)},transposeEq:function(){var b=this.e00,t=this.e10,i=this.e20,o=this.e30,a=this.e01,n=this.e11,s=this.e21,_=this.e31,r=this.e02,e=this.e12,x=this.e22,l=this.e32,c=this.e03,m=this.e13,p=this.e23,d=this.e33;return this.e00=b,this.e01=t,this.e02=i,this.e03=o,this.e10=a,this.e11=n,this.e12=s,this.e13=_,this.e20=r,this.e21=e,this.e22=x,this.e23=l,this.e30=c,this.e31=m,this.e32=p,this.e33=d,this},determinant:function(){var _=this.e20*this.e31-this.e21*this.e30,t=this.e20*this.e32-this.e22*this.e30,i=this.e20*this.e33-this.e23*this.e30,o=this.e21*this.e32-this.e22*this.e31,a=this.e21*this.e33-this.e23*this.e31,n=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*n-this.e12*a+this.e13*o)-this.e01*(this.e10*n-this.e12*i+this.e13*t)+this.e02*(this.e10*a-this.e11*i+this.e13*_)-this.e03*(this.e10*o-this.e11*t+this.e12*_)},trace:function(){return this.e00+this.e11+this.e22+this.e33},inverse:function(){var L=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,a=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,s=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,r=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,l=this.e22*this.e33-this.e23*this.e32,c=this.e11*l-this.e12*h+this.e13*e,m=this.e10*l-this.e12*r+this.e13*_,p=this.e10*h-this.e11*r+this.e13*s,v=this.e10*e-this.e11*_+this.e12*s,y=this.e01*l-this.e02*h+this.e03*e,b=this.e00*l-this.e02*r+this.e03*_,f=this.e00*h-this.e01*r+this.e03*s,d=this.e00*e-this.e01*_+this.e02*s,x=this.e31*n-this.e32*a+this.e33*o,u=this.e30*n-this.e32*i+this.e33*t,g=this.e30*a-this.e31*i+this.e33*L,M=this.e30*o-this.e31*t+this.e32*L,X=this.e21*n-this.e22*a+this.e23*o,z=this.e20*n-this.e22*i+this.e23*t,Y=this.e20*a-this.e21*i+this.e23*L,Z=this.e20*o-this.e21*t+this.e22*L,I=this.e00*c-this.e01*m+this.e02*p-this.e03*v;return 0!=I&&(I=1/I),new oimo_common_Mat4(c*I,-y*I,x*I,-X*I,-m*I,b*I,-u*I,z*I,p*I,-f*I,g*I,-Y*I,-v*I,d*I,-M*I,Z*I)},inverseEq:function(){var N=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,a=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,s=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,r=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,l=this.e22*this.e33-this.e23*this.e32,c=this.e11*l-this.e12*h+this.e13*e,m=this.e10*l-this.e12*r+this.e13*_,p=this.e10*h-this.e11*r+this.e13*s,v=this.e10*e-this.e11*_+this.e12*s,y=this.e01*l-this.e02*h+this.e03*e,b=this.e00*l-this.e02*r+this.e03*_,f=this.e00*h-this.e01*r+this.e03*s,d=this.e00*e-this.e01*_+this.e02*s,x=this.e31*n-this.e32*a+this.e33*o,u=this.e30*n-this.e32*i+this.e33*t,g=this.e30*a-this.e31*i+this.e33*N,M=this.e30*o-this.e31*t+this.e32*N,X=this.e21*n-this.e22*a+this.e23*o,z=this.e20*n-this.e22*i+this.e23*t,Y=this.e20*a-this.e21*i+this.e23*N,Z=this.e20*o-this.e21*t+this.e22*N,I=this.e00*c-this.e01*m+this.e02*p-this.e03*v;0!=I&&(I=1/I);var W=c*I,L=-y*I,w=x*I,B=-X*I,k=-m*I,A=b*I,P=-u*I,S=z*I,C=p*I,T=-f*I,j=g*I,R=-Y*I,q=-v*I,E=d*I,D=-M*I,G=Z*I;return this.e00=W,this.e01=L,this.e02=w,this.e03=B,this.e10=k,this.e11=A,this.e12=P,this.e13=S,this.e20=C,this.e21=T,this.e22=j,this.e23=R,this.e30=q,this.e31=E,this.e32=D,this.e33=G,this},lookAt:function(x,t,i,o,a,n,s,_,r){var e=x-o,g=t-a,X=i-n,u=1/Math.sqrt(e*e+g*g+X*X),z=_*(X*=u)-r*(g*=u),Y=r*(e*=u)-s*X,Z=s*g-_*e,I=g*(Z*=u=1/Math.sqrt(z*z+Y*Y+Z*Z))-X*(Y*=u),b=X*(z*=u)-e*Z,f=e*Y-g*z;return this.e00=z,this.e01=Y,this.e02=Z,this.e03=-(z*x+Y*t+Z*i),this.e10=I,this.e11=b,this.e12=f,this.e13=-(I*x+b*t+f*i),this.e20=e,this.e21=g,this.e22=X,this.e23=-(e*x+g*t+X*i),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},perspective:function(_,t,i,o){var a=1/Math.tan(.5*_),n=o/(i-o);return this.e00=a/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=a,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=i*n,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this},ortho:function(_,t,i,o){var a=1/(i-o);return this.e00=2/_,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/t,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=a,this.e23=i*a,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},toArray:function(o){return null==o&&(o=!1),o?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]},copyFrom:function(o){return this.e00=o.e00,this.e01=o.e01,this.e02=o.e02,this.e03=o.e03,this.e10=o.e10,this.e11=o.e11,this.e12=o.e12,this.e13=o.e13,this.e20=o.e20,this.e21=o.e21,this.e22=o.e22,this.e23=o.e23,this.e30=o.e30,this.e31=o.e31,this.e32=o.e32,this.e33=o.e33,this},fromMat3:function(l){var t=l.e00,i=l.e01,o=l.e02,a=l.e10,n=l.e11,s=l.e12,_=l.e20,r=l.e21,e=l.e22;return this.e00=t,this.e01=i,this.e02=o,this.e03=0,this.e10=a,this.e11=n,this.e12=s,this.e13=0,this.e20=_,this.e21=r,this.e22=e,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},fromTransform:function(o){var t=this;return t.e00=o._rotation00,t.e01=o._rotation01,t.e02=o._rotation02,t.e10=o._rotation10,t.e11=o._rotation11,t.e12=o._rotation12,t.e20=o._rotation20,t.e21=o._rotation21,t.e22=o._rotation22,t.e03=o._positionX,t.e13=o._positionY,t.e23=o._positionZ,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this},clone:function(){return new oimo_common_Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)},toString:function(){return"Mat4["+(0<this.e00?(0|1e7*this.e00+.5)/1e7:(0|1e7*this.e00-.5)/1e7)+", "+(0<this.e01?(0|1e7*this.e01+.5)/1e7:(0|1e7*this.e01-.5)/1e7)+", "+(0<this.e02?(0|1e7*this.e02+.5)/1e7:(0|1e7*this.e02-.5)/1e7)+", "+(0<this.e03?(0|1e7*this.e03+.5)/1e7:(0|1e7*this.e03-.5)/1e7)+",\n    "+(0<this.e10?(0|1e7*this.e10+.5)/1e7:(0|1e7*this.e10-.5)/1e7)+", "+(0<this.e11?(0|1e7*this.e11+.5)/1e7:(0|1e7*this.e11-.5)/1e7)+", "+(0<this.e12?(0|1e7*this.e12+.5)/1e7:(0|1e7*this.e12-.5)/1e7)+", "+(0<this.e13?(0|1e7*this.e13+.5)/1e7:(0|1e7*this.e13-.5)/1e7)+",\n    "+(0<this.e20?(0|1e7*this.e20+.5)/1e7:(0|1e7*this.e20-.5)/1e7)+", "+(0<this.e21?(0|1e7*this.e21+.5)/1e7:(0|1e7*this.e21-.5)/1e7)+", "+(0<this.e22?(0|1e7*this.e22+.5)/1e7:(0|1e7*this.e22-.5)/1e7)+", "+(0<this.e23?(0|1e7*this.e23+.5)/1e7:(0|1e7*this.e23-.5)/1e7)+",\n    "+(0<this.e30?(0|1e7*this.e30+.5)/1e7:(0|1e7*this.e30-.5)/1e7)+", "+(0<this.e31?(0|1e7*this.e31+.5)/1e7:(0|1e7*this.e31-.5)/1e7)+", "+(0<this.e32?(0|1e7*this.e32+.5)/1e7:(0|1e7*this.e32-.5)/1e7)+", "+(0<this.e33?(0|1e7*this.e33+.5)/1e7:(0|1e7*this.e33-.5)/1e7)+"]"}};var oimo_common_MathUtil=function(){};oimo_common_MathUtil.abs=function(o){return 0<o?o:-o},oimo_common_MathUtil.sin=function(o){return Math.sin(o)},oimo_common_MathUtil.cos=function(o){return Math.cos(o)},oimo_common_MathUtil.tan=function(o){return Math.tan(o)},oimo_common_MathUtil.asin=function(o){return Math.asin(o)},oimo_common_MathUtil.acos=function(o){return Math.acos(o)},oimo_common_MathUtil.atan=function(o){return Math.atan(o)},oimo_common_MathUtil.safeAsin=function(o){return-1>=o?-1.570796326794895:1<=o?1.570796326794895:Math.asin(o)},oimo_common_MathUtil.safeAcos=function(o){return-1>=o?3.14159265358979:1<=o?0:Math.acos(o)},oimo_common_MathUtil.atan2=function(o,t){return Math.atan2(o,t)},oimo_common_MathUtil.sqrt=function(o){return Math.sqrt(o)},oimo_common_MathUtil.clamp=function(a,t,i){return a<t?t:a>i?i:a},oimo_common_MathUtil.rand=function(){return Math.random()},oimo_common_MathUtil.randIn=function(o,t){return o+Math.random()*(t-o)},oimo_common_MathUtil.randVec3In=function(o,t){return new oimo_common_Vec3(o+Math.random()*(t-o),o+Math.random()*(t-o),o+Math.random()*(t-o))},oimo_common_MathUtil.randVec3=function(){return new oimo_common_Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)};var oimo_common_Pool=function(){var n=Array(256);this.stackVec3=n,this.sizeVec3=0;var t=Array(256);this.stackMat3=t,this.sizeMat3=0;var i=Array(256);this.stackMat4=i,this.sizeMat4=0;var o=Array(256);this.stackQuat=o,this.sizeQuat=0};oimo_common_Pool.prototype={vec3:function(){return 0==this.sizeVec3?new oimo_common_Vec3:this.stackVec3[--this.sizeVec3]},mat3:function(){return 0==this.sizeMat3?new oimo_common_Mat3:this.stackMat3[--this.sizeMat3]},mat4:function(){return 0==this.sizeMat4?new oimo_common_Mat4:this.stackMat4[--this.sizeMat4]},quat:function(){return 0==this.sizeQuat?new oimo_common_Quat:this.stackQuat[--this.sizeQuat]},dispose:function(z,t,i,o){if(null!=z){if(z.zero(),this.sizeVec3==this.stackVec3.length){for(var a=this.sizeVec3<<1,n=Array(a),s=0,Y=this.sizeVec3,r;s<Y;)r=s++,n[r]=this.stackVec3[r],this.stackVec3[r]=null;this.stackVec3=n}this.stackVec3[this.sizeVec3++]=z}if(null!=t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){for(var Z=this.sizeMat3<<1,I=Array(Z),l=0,h=this.sizeMat3,m;l<h;)m=l++,I[m]=this.stackMat3[m],this.stackMat3[m]=null;this.stackMat3=I}this.stackMat3[this.sizeMat3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e03=0,i.e10=0,i.e11=1,i.e12=0,i.e13=0,i.e20=0,i.e21=0,i.e22=1,i.e23=0,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this.sizeMat4==this.stackMat4.length){for(var V=this.sizeMat4<<1,v=Array(V),y=0,L=this.sizeMat4,f;y<L;)f=y++,v[f]=this.stackMat4[f],this.stackMat4[f]=null;this.stackMat4=v}this.stackMat4[this.sizeMat4++]=i}if(null!=o){if(o.x=0,o.y=0,o.z=0,o.w=1,this.sizeQuat==this.stackQuat.length){for(var B=this.sizeQuat<<1,x=Array(B),u=0,k=this.sizeQuat,M;u<k;)M=u++,x[M]=this.stackQuat[M],this.stackQuat[M]=null;this.stackQuat=x}this.stackQuat[this.sizeQuat++]=o}},disposeVec3:function(_){if(_.zero(),this.sizeVec3==this.stackVec3.length){for(var t=this.sizeVec3<<1,i=Array(t),o=0,e=this.sizeVec3,n;o<e;)n=o++,i[n]=this.stackVec3[n],this.stackVec3[n]=null;this.stackVec3=i}this.stackVec3[this.sizeVec3++]=_},disposeMat3:function(_){if(_.e00=1,_.e01=0,_.e02=0,_.e10=0,_.e11=1,_.e12=0,_.e20=0,_.e21=0,_.e22=1,this.sizeMat3==this.stackMat3.length){for(var t=this.sizeMat3<<1,i=Array(t),o=0,e=this.sizeMat3,n;o<e;)n=o++,i[n]=this.stackMat3[n],this.stackMat3[n]=null;this.stackMat3=i}this.stackMat3[this.sizeMat3++]=_},disposeMat4:function(_){if(_.e00=1,_.e01=0,_.e02=0,_.e03=0,_.e10=0,_.e11=1,_.e12=0,_.e13=0,_.e20=0,_.e21=0,_.e22=1,_.e23=0,_.e30=0,_.e31=0,_.e32=0,_.e33=1,this.sizeMat4==this.stackMat4.length){for(var t=this.sizeMat4<<1,i=Array(t),o=0,e=this.sizeMat4,n;o<e;)n=o++,i[n]=this.stackMat4[n],this.stackMat4[n]=null;this.stackMat4=i}this.stackMat4[this.sizeMat4++]=_},disposeQuat:function(_){if(_.x=0,_.y=0,_.z=0,_.w=1,this.sizeQuat==this.stackQuat.length){for(var t=this.sizeQuat<<1,i=Array(t),o=0,e=this.sizeQuat,n;o<e;)n=o++,i[n]=this.stackQuat[n],this.stackQuat[n]=null;this.stackQuat=i}this.stackQuat[this.sizeQuat++]=_}};var oimo_common_Quat=function(n,_,e,r){null==r&&(r=1),null==e&&(e=0),null==_&&(_=0),null==n&&(n=0),this.x=n,this.y=_,this.z=e,this.w=r,oimo_common_Quat.numCreations++};oimo_common_Quat.prototype={identity:function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},init:function(n,t,i,o){return this.x=n,this.y=t,this.z=i,this.w=o,this},add:function(o){return new oimo_common_Quat(this.x+o.x,this.y+o.y,this.z+o.z,this.w+o.w)},sub:function(o){return new oimo_common_Quat(this.x-o.x,this.y-o.y,this.z-o.z,this.w-o.w)},scale:function(o){return new oimo_common_Quat(this.x*o,this.y*o,this.z*o,this.w*o)},addEq:function(_){var t=this.x+_.x,i=this.y+_.y,o=this.z+_.z,a=this.w+_.w;return this.x=t,this.y=i,this.z=o,this.w=a,this},subEq:function(_){var t=this.x-_.x,i=this.y-_.y,o=this.z-_.z,a=this.w-_.w;return this.x=t,this.y=i,this.z=o,this.w=a,this},scaleEq:function(_){var t=this.x*_,i=this.y*_,o=this.z*_,a=this.w*_;return this.x=t,this.y=i,this.z=o,this.w=a,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},dot:function(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w},normalized:function(){var o=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0<o&&(o=1/o),new oimo_common_Quat(this.x*o,this.y*o,this.z*o,this.w*o)},normalize:function(){var _=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0<_&&(_=1/_);var e=this.x*_,i=this.y*_,o=this.z*_,a=this.w*_;return this.x=e,this.y=i,this.z=o,this.w=a,this},setArc:function(p,t){var i=p.x,o=p.y,a=p.z,n=t.x,m=t.y,b=t.z,x=i*n+o*m+a*b;if(this.w=Math.sqrt(.5*(1+x)),0==this.w)return b=a*a,(n=i*i)<(m=o*o)?n<b?(x=1/Math.sqrt(m+b),this.x=0,this.y=a*x,this.z=-o*x):(x=1/Math.sqrt(n+m),this.z=0,this.x=o*x,this.y=-i*x):m<b?(x=1/Math.sqrt(b+n),this.y=0,this.z=i*x,this.x=-a*x):(x=1/Math.sqrt(n+m),this.z=0,this.x=o*x,this.y=-i*x),this;x=.5/this.w;var d=o*b-a*m,y=a*n-i*b,l=i*m-o*n;return this.x=d*x,this.y=y*x,this.z=l*x,this},slerp:function(x,t){var i=this.x*x.x+this.y*x.y+this.z*x.z+this.w*x.w,d,f,g,X;if(0>i?(i=-i,d=-x.x,f=-x.y,g=-x.z,X=-x.w):(d=x.x,f=x.y,g=x.z,X=x.w),.999999<i){var u=new oimo_common_Quat(this.x+(d-this.x)*t,this.y+(f-this.y)*t,this.z+(g-this.z)*t,this.w+(X-this.w)*t),r=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z+u.w*u.w);0<r&&(r=1/r);var z=u.x*r,Y=u.y*r,l=u.z*r,c=u.w*r;return u.x=z,u.y=Y,u.z=l,u.w=c,u}var m=t*Math.acos(i);d-=this.x*i,f-=this.y*i,g-=this.z*i,X-=this.w*i;var p=1/Math.sqrt(d*d+f*f+g*g+X*X);d*=p,f*=p,g*=p,X*=p;var v=Math.sin(m),y=Math.cos(m);return new oimo_common_Quat(this.x*y+d*v,this.y*y+f*v,this.z*y+g*v,this.w*y+X*v)},copyFrom:function(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w,this},clone:function(){return new oimo_common_Quat(this.x,this.y,this.z,this.w)},fromMat3:function(_){var t=_.e00,o=_.e11,a=_.e22,n=t+o+a,e;return 0<n?(e=Math.sqrt(n+1),this.w=.5*e,e=.5/e,this.x=(_.e21-_.e12)*e,this.y=(_.e02-_.e20)*e,this.z=(_.e10-_.e01)*e):t>o?t>a?(e=Math.sqrt(t-o-a+1),this.x=.5*e,e=.5/e,this.y=(_.e01+_.e10)*e,this.z=(_.e02+_.e20)*e,this.w=(_.e21-_.e12)*e):(e=Math.sqrt(a-t-o+1),this.z=.5*e,e=.5/e,this.x=(_.e02+_.e20)*e,this.y=(_.e12+_.e21)*e,this.w=(_.e10-_.e01)*e):o>a?(e=Math.sqrt(o-a-t+1),this.y=.5*e,e=.5/e,this.x=(_.e01+_.e10)*e,this.z=(_.e12+_.e21)*e,this.w=(_.e02-_.e20)*e):(e=Math.sqrt(a-t-o+1),this.z=.5*e,e=.5/e,this.x=(_.e02+_.e20)*e,this.y=(_.e12+_.e21)*e,this.w=(_.e10-_.e01)*e),this},toMat3:function(){var x=new oimo_common_Mat3,t=this.x,i=this.y,o=this.z,a=this.w,n=2*t,s=2*i,_=2*o,r=t*n,e=i*s,d=o*_,l=t*s,c=i*_,m=t*_,p=a*n,f=a*s,y=a*_;return x.e00=1-e-d,x.e01=l-y,x.e02=m+f,x.e10=l+y,x.e11=1-r-d,x.e12=c-p,x.e20=m-f,x.e21=c+p,x.e22=1-r-e,x},toString:function(){return"Quat["+(0<this.x?(0|1e7*this.x+.5)/1e7:(0|1e7*this.x-.5)/1e7)+" i,\n    "+(0<this.y?(0|1e7*this.y+.5)/1e7:(0|1e7*this.y-.5)/1e7)+" j,\n    "+(0<this.z?(0|1e7*this.z+.5)/1e7:(0|1e7*this.z-.5)/1e7)+" k,\n    "+(0<this.w?(0|1e7*this.w+.5)/1e7:(0|1e7*this.w-.5)/1e7)+"]"}};var oimo_dynamics_Contact=function(){this._next=null,this._prev=null,this._link1=new oimo_dynamics_ContactLink,this._link2=new oimo_dynamics_ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new oimo_collision_narrowphase_detector_CachedDetectorData,this._detectorResult=new oimo_collision_narrowphase_DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new oimo_dynamics_constraint_contact_Manifold,this._updater=new oimo_dynamics_constraint_contact_ManifoldUpdater(this._manifold),this._contactConstraint=new oimo_dynamics_constraint_contact_ContactConstraint(this._manifold),this._touching=!1};oimo_dynamics_Contact.prototype={_updateManifold:function(){if(null!=this._detector){var l=this._touching,t=this._detectorResult;this._detector.detect(t,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var i=t.numPoints;if(this._touching=0<i,this._touching?(this._manifold._buildBasis(t.normal),this._contactConstraint._positionCorrectionAlgorithm=t.getMaxDepth()>oimo_common_Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?oimo_common_Setting.alternativeContactPositionCorrectionAlgorithm:oimo_common_Setting.defaultContactPositionCorrectionAlgorithm,t.incremental?this._updater.incrementalUpdate(t,this._b1._transform,this._b2._transform):this._updater.totalUpdate(t,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!l){var o=this._s1._contactCallback,a=this._s2._contactCallback;o==a&&(a=null),null!=o&&o.beginContact(this),null!=a&&a.beginContact(this)}if(!this._touching&&l){var c=this._s1._contactCallback,s=this._s2._contactCallback;c==s&&(s=null),null!=c&&c.endContact(this),null!=s&&s.endContact(this)}if(this._touching){var p=this._s1._contactCallback,r=this._s2._contactCallback;p==r&&(r=null),null!=p&&p.preSolve(this),null!=r&&r.preSolve(this)}}},_postSolve:function(){var o=this._s1._contactCallback,t=this._s2._contactCallback;o==t&&(t=null),null!=o&&o.postSolve(this),null!=t&&t.postSolve(this)},getShape1:function(){return this._s1},getShape2:function(){return this._s2},isTouching:function(){return this._touching},getManifold:function(){return this._manifold},getContactConstraint:function(){return this._contactConstraint},getPrev:function(){return this._prev},getNext:function(){return this._next}};var oimo_dynamics_ContactLink=function(){this._prev=null,this._next=null,this._contact=null,this._other=null};oimo_dynamics_ContactLink.prototype={getContact:function(){return this._contact},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var oimo_dynamics_ContactManager=function(o){this._broadPhase=o,this._collisionMatrix=new oimo_collision_narrowphase_CollisionMatrix,this._numContacts=0};oimo_dynamics_ContactManager.prototype={createContacts:function(){for(var b=this._broadPhase._proxyPairList;null!=b;){for(var x=b._next;;){var i,d;if(b._p1._id<b._p2._id?(i=b._p1.userData,d=b._p2.userData):(i=b._p2.userData,d=b._p1.userData),!this.shouldCollide(i,d))break;var f=i._rigidBody,s=d._rigidBody,_;_=f._numContactLinks<s._numContactLinks?f._contactLinkList:s._contactLinkList;for(var g=i._id,r=d._id,e=!1;null!=_;){var X=_._next,l=_._contact;if(l._s1._id==g&&l._s2._id==r){l._latest=!0,e=!0;break}_=X}if(!e){var c=this._contactPool;null==c?c=new oimo_dynamics_Contact:(this._contactPool=c._next,c._next=null);var u=c;null==this._contactList?(this._contactList=u,this._contactListLast=u):(this._contactListLast._next=u,u._prev=this._contactListLast,this._contactListLast=u),u._latest=!0;var p=this._collisionMatrix.detectors[i._geom._type][d._geom._type];u._s1=i,u._s2=d,u._b1=i._rigidBody,u._b2=d._rigidBody,u._touching=!1,null==u._b1._contactLinkList?(u._b1._contactLinkList=u._link1,u._b1._contactLinkListLast=u._link1):(u._b1._contactLinkListLast._next=u._link1,u._link1._prev=u._b1._contactLinkListLast,u._b1._contactLinkListLast=u._link1),null==u._b2._contactLinkList?(u._b2._contactLinkList=u._link2,u._b2._contactLinkListLast=u._link2):(u._b2._contactLinkListLast._next=u._link2,u._link2._prev=u._b2._contactLinkListLast,u._b2._contactLinkListLast=u._link2),u._b1._numContactLinks++,u._b2._numContactLinks++,u._link1._other=u._b2,u._link2._other=u._b1,u._link1._contact=u,u._link2._contact=u,u._detector=p;var v=u._contactConstraint;v._s1=i,v._s2=d,v._b1=v._s1._rigidBody,v._b2=v._s2._rigidBody,v._tf1=v._b1._transform,v._tf2=v._b2._transform,this._numContacts++}break}b=x}},destroyOutdatedContacts:function(){for(var k=this._broadPhase._incremental,t=this._contactList;null!=t;){for(var A=t._next;;){if(t._latest){t._latest=!1,t._shouldBeSkipped=!1;break}if(!k){var o=t._prev,a=t._next;if(null!=o&&(o._next=a),null!=a&&(a._prev=o),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var n=t._s1._contactCallback,s=t._s2._contactCallback;n==s&&(s=null),null!=n&&n.endContact(t),null!=s&&s.endContact(t)}var P=t._link1._prev,r=t._link1._next;null!=P&&(P._next=r),null!=r&&(r._prev=P),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var e=t._link2._prev,h=t._link2._next;null!=e&&(e._next=h),null!=h&&(h._prev=e),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var l=t._contactConstraint;l._s1=null,l._s2=null,l._b1=null,l._b2=null,l._tf1=null,l._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var c=t._s1,m=t._s2,p=c._rigidBody,v=m._rigidBody,y=!p._sleeping&&1!=p._type,b=!v._sleeping&&1!=v._type;if(!y&&!b){t._shouldBeSkipped=!0;break}var f=c._aabb,d=m._aabb,x=c._proxy,u=m._proxy;if(!(x._aabbMinX<u._aabbMaxX&&x._aabbMaxX>u._aabbMinX&&x._aabbMinY<u._aabbMaxY&&x._aabbMaxY>u._aabbMinY&&x._aabbMinZ<u._aabbMaxZ&&x._aabbMaxZ>u._aabbMinZ&&this.shouldCollide(c,m))){var g=t._prev,M=t._next;if(null!=g&&(g._next=M),null!=M&&(M._prev=g),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var X=t._s1._contactCallback,z=t._s2._contactCallback;X==z&&(z=null),null!=X&&X.endContact(t),null!=z&&z.endContact(t)}var T=t._link1._prev,Z=t._link1._next;null!=T&&(T._next=Z),null!=Z&&(Z._prev=T),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var I=t._link2._prev,V=t._link2._next;null!=I&&(I._next=V),null!=V&&(V._prev=I),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var L=t._contactConstraint;L._s1=null,L._s2=null,L._b1=null,L._b2=null,L._tf1=null,L._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var w=f._minX<d._maxX&&f._maxX>d._minX&&f._minY<d._maxY&&f._maxY>d._minY&&f._minZ<d._maxZ&&f._maxZ>d._minZ;t._shouldBeSkipped=!w;break}t=A}},shouldCollide:function(e,t){var i=e._rigidBody,n=t._rigidBody,r,s;if(i==n)return!1;if(0!=i._type&&0!=n._type)return!1;if(0==(e._collisionGroup&t._collisionMask)||0==(t._collisionGroup&e._collisionMask))return!1;for(i._numJointLinks<n._numJointLinks?(r=i._jointLinkList,s=n):(r=n._jointLinkList,s=i);null!=r;){var l=r._next;if(r._other==s&&!r._joint._allowCollision)return!1;r=l}return!0},_updateContacts:function(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()},_postSolve:function(){for(var o=this._contactList,a;null!=o;)a=o._next,o._touching&&o._postSolve(),o=a},getNumContacts:function(){return this._numContacts},getContactList:function(){return this._contactList}};var oimo_dynamics_Island=function(){var e=oimo_common_Setting.islandInitialRigidBodyArraySize,t=Array(e);this.rigidBodies=t;var i=oimo_common_Setting.islandInitialConstraintArraySize,o=Array(i);this.solvers=o;var a=oimo_common_Setting.islandInitialConstraintArraySize,n=Array(a);this.solversSi=n;var s=oimo_common_Setting.islandInitialConstraintArraySize,_=Array(s);this.solversNgs=_,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0};oimo_dynamics_Island.prototype={_clear:function(){for(;0<this.numRigidBodies;)this.rigidBodies[--this.numRigidBodies]=null;for(;0<this.numSolvers;)this.solvers[--this.numSolvers]=null;for(;0<this.numSolversSi;)this.solversSi[--this.numSolversSi]=null;for(;0<this.numSolversNgs;)this.solversNgs[--this.numSolversNgs]=null},_addRigidBody:function(_){if(this.numRigidBodies==this.rigidBodies.length){for(var t=this.numRigidBodies<<1,i=Array(t),o=0,e=this.numRigidBodies,n;o<e;)n=o++,i[n]=this.rigidBodies[n],this.rigidBodies[n]=null;this.rigidBodies=i}_._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=_},_addConstraintSolver:function(x,t){if(this.numSolvers==this.solvers.length){for(var i=this.numSolvers<<1,o=Array(i),a=0,d=this.numSolvers,s;a<d;)s=a++,o[s]=this.solvers[s],this.solvers[s]=null;this.solvers=o}if(x._addedToIsland=!0,this.solvers[this.numSolvers++]=x,t==oimo_dynamics_constraint_PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var f=this.numSolversSi<<1,r=Array(f),e=0,g=this.numSolversSi,l;e<g;)l=e++,r[l]=this.solversSi[l],this.solversSi[l]=null;this.solversSi=r}this.solversSi[this.numSolversSi++]=x}if(t==oimo_dynamics_constraint_PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var X=this.numSolversNgs<<1,m=Array(X),p=0,u=this.numSolversNgs,y;p<u;)y=p++,m[y]=this.solversNgs[y],this.solversNgs[y]=null;this.solversNgs=m}this.solversNgs[this.numSolversNgs++]=x}},_stepSingleRigidBody:function(_t,t){var i=_t.dt,o=t._ptransform,a=t._transform;if(o._positionX=a._positionX,o._positionY=a._positionY,o._positionZ=a._positionZ,o._rotation00=a._rotation00,o._rotation01=a._rotation01,o._rotation02=a._rotation02,o._rotation10=a._rotation10,o._rotation11=a._rotation11,o._rotation12=a._rotation12,o._rotation20=a._rotation20,o._rotation21=a._rotation21,o._rotation22=a._rotation22,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<oimo_common_Setting.sleepingVelocityThreshold*oimo_common_Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<oimo_common_Setting.sleepingAngularVelocityThreshold*oimo_common_Setting.sleepingAngularVelocityThreshold?(t._sleepTime+=i,t._sleepTime>oimo_common_Setting.sleepingTimeThreshold&&(t._sleeping=!0,t._sleepTime=0)):t._sleepTime=0,!t._sleeping){if(0==t._type){var n=i*t._linearDamping,c=n*n,m=1/(1+n+c*(.5+.16666666666666666*n+.041666666666666664*c)),p=i*t._angularDamping,v=p*p,y=1/(1+p+v*(.5+.16666666666666666*p+.041666666666666664*v)),b,et,rt,st,lt,ct;b=this.gravityX*t._gravityScale,et=this.gravityY*t._gravityScale,rt=this.gravityZ*t._gravityScale,b+=t._forceX*t._invMass,et+=t._forceY*t._invMass,rt+=t._forceZ*t._invMass,st=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,lt=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,ct=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,t._velX+=b*i,t._velY+=et*i,t._velZ+=rt*i,t._velX*=m,t._velY*=m,t._velZ*=m,t._angVelX+=st*i,t._angVelY+=lt*i,t._angVelZ+=ct*i,t._angVelX*=y,t._angVelY*=y,t._angVelZ*=y}t._integrate(i);for(var pt=t._shapeList;null!=pt;){var mt=pt._next,w=pt._ptransform,B=pt._localTransform,k=t._ptransform,A,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt,Yt;A=k._rotation00*B._rotation00+k._rotation01*B._rotation10+k._rotation02*B._rotation20,bt=k._rotation00*B._rotation01+k._rotation01*B._rotation11+k._rotation02*B._rotation21,xt=k._rotation00*B._rotation02+k._rotation01*B._rotation12+k._rotation02*B._rotation22,dt=k._rotation10*B._rotation00+k._rotation11*B._rotation10+k._rotation12*B._rotation20,yt=k._rotation10*B._rotation01+k._rotation11*B._rotation11+k._rotation12*B._rotation21,ft=k._rotation10*B._rotation02+k._rotation11*B._rotation12+k._rotation12*B._rotation22,gt=k._rotation20*B._rotation00+k._rotation21*B._rotation10+k._rotation22*B._rotation20,vt=k._rotation20*B._rotation01+k._rotation21*B._rotation11+k._rotation22*B._rotation21,Xt=k._rotation20*B._rotation02+k._rotation21*B._rotation12+k._rotation22*B._rotation22,w._rotation00=A,w._rotation01=bt,w._rotation02=xt,w._rotation10=dt,w._rotation11=yt,w._rotation12=ft,w._rotation20=gt,w._rotation21=vt,w._rotation22=Xt,ut=k._rotation00*B._positionX+k._rotation01*B._positionY+k._rotation02*B._positionZ,zt=k._rotation10*B._positionX+k._rotation11*B._positionY+k._rotation12*B._positionZ,Yt=k._rotation20*B._positionX+k._rotation21*B._positionY+k._rotation22*B._positionZ,w._positionX=ut,w._positionY=zt,w._positionZ=Yt,w._positionX+=k._positionX,w._positionY+=k._positionY,w._positionZ+=k._positionZ;var Zt=pt._transform,$=pt._localTransform,K=t._transform,tt,It,Mt,ht,Vt,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et,jt;if(tt=K._rotation00*$._rotation00+K._rotation01*$._rotation10+K._rotation02*$._rotation20,It=K._rotation00*$._rotation01+K._rotation01*$._rotation11+K._rotation02*$._rotation21,Mt=K._rotation00*$._rotation02+K._rotation01*$._rotation12+K._rotation02*$._rotation22,ht=K._rotation10*$._rotation00+K._rotation11*$._rotation10+K._rotation12*$._rotation20,Vt=K._rotation10*$._rotation01+K._rotation11*$._rotation11+K._rotation12*$._rotation21,Lt=K._rotation10*$._rotation02+K._rotation11*$._rotation12+K._rotation12*$._rotation22,Bt=K._rotation20*$._rotation00+K._rotation21*$._rotation10+K._rotation22*$._rotation20,kt=K._rotation20*$._rotation01+K._rotation21*$._rotation11+K._rotation22*$._rotation21,At=K._rotation20*$._rotation02+K._rotation21*$._rotation12+K._rotation22*$._rotation22,Zt._rotation00=tt,Zt._rotation01=It,Zt._rotation02=Mt,Zt._rotation10=ht,Zt._rotation11=Vt,Zt._rotation12=Lt,Zt._rotation20=Bt,Zt._rotation21=kt,Zt._rotation22=At,Pt=K._rotation00*$._positionX+K._rotation01*$._positionY+K._rotation02*$._positionZ,Tt=K._rotation10*$._positionX+K._rotation11*$._positionY+K._rotation12*$._positionZ,wt=K._rotation20*$._positionX+K._rotation21*$._positionY+K._rotation22*$._positionZ,Zt._positionX=Pt,Zt._positionY=Tt,Zt._positionZ=wt,Zt._positionX+=K._positionX,Zt._positionY+=K._positionY,Zt._positionZ+=K._positionZ,pt._geom._computeAabb(pt._aabb,pt._ptransform),St=pt._aabb._minX,Ct=pt._aabb._minY,qt=pt._aabb._minZ,Rt=pt._aabb._maxX,Et=pt._aabb._maxY,jt=pt._aabb._maxZ,pt._geom._computeAabb(pt._aabb,pt._transform),pt._aabb._minX=St<pt._aabb._minX?St:pt._aabb._minX,pt._aabb._minY=Ct<pt._aabb._minY?Ct:pt._aabb._minY,pt._aabb._minZ=qt<pt._aabb._minZ?qt:pt._aabb._minZ,pt._aabb._maxX=Rt>pt._aabb._maxX?Rt:pt._aabb._maxX,pt._aabb._maxY=Et>pt._aabb._maxY?Et:pt._aabb._maxY,pt._aabb._maxZ=jt>pt._aabb._maxZ?jt:pt._aabb._maxZ,null!=pt._proxy){var Nt,Ft,Dt;Nt=pt._transform._positionX-pt._ptransform._positionX,Ft=pt._transform._positionY-pt._ptransform._positionY,Dt=pt._transform._positionZ-pt._ptransform._positionZ;var Wt=pt.displacement;Wt.x=Nt,Wt.y=Ft,Wt.z=Dt,pt._rigidBody._world._broadPhase.moveProxy(pt._proxy,pt._aabb,pt.displacement)}pt=mt}}},_step:function(P,t,i){for(var o=P.dt,a=!0,W=0,st=this.numRigidBodies;W<st;){var _=W++,r=this.rigidBodies[_],e=r._ptransform,h=r._transform;if(e._positionX=h._positionX,e._positionY=h._positionY,e._positionZ=h._positionZ,e._rotation00=h._rotation00,e._rotation01=h._rotation01,e._rotation02=h._rotation02,e._rotation10=h._rotation10,e._rotation11=h._rotation11,e._rotation12=h._rotation12,e._rotation20=h._rotation20,e._rotation21=h._rotation21,e._rotation22=h._rotation22,r._sleeping=!1,r._autoSleep&&r._velX*r._velX+r._velY*r._velY+r._velZ*r._velZ<oimo_common_Setting.sleepingVelocityThreshold*oimo_common_Setting.sleepingVelocityThreshold&&r._angVelX*r._angVelX+r._angVelY*r._angVelY+r._angVelZ*r._angVelZ<oimo_common_Setting.sleepingAngularVelocityThreshold*oimo_common_Setting.sleepingAngularVelocityThreshold?r._sleepTime+=o:r._sleepTime=0,r._sleepTime<oimo_common_Setting.sleepingTimeThreshold&&(a=!1),0==r._type){var l=o*r._linearDamping,f=l*l,d=1/(1+l+f*(.5+.16666666666666666*l+.041666666666666664*f)),x=o*r._angularDamping,u=x*x,g=1/(1+x+u*(.5+.16666666666666666*x+.041666666666666664*u)),M,to,oo,ao,io,no;M=this.gravityX*r._gravityScale,to=this.gravityY*r._gravityScale,oo=this.gravityZ*r._gravityScale,M+=r._forceX*r._invMass,to+=r._forceY*r._invMass,oo+=r._forceZ*r._invMass,ao=r._invInertia00*r._torqueX+r._invInertia01*r._torqueY+r._invInertia02*r._torqueZ,io=r._invInertia10*r._torqueX+r._invInertia11*r._torqueY+r._invInertia12*r._torqueZ,no=r._invInertia20*r._torqueX+r._invInertia21*r._torqueY+r._invInertia22*r._torqueZ,r._velX+=M*o,r._velY+=to*o,r._velZ+=oo*o,r._velX*=d,r._velY*=d,r._velZ*=d,r._angVelX+=ao*o,r._angVelY+=io*o,r._angVelZ+=no*o,r._angVelX*=g,r._angVelY*=g,r._angVelZ*=g}}if(a)for(var _o=0,eo=this.numRigidBodies;_o<eo;){var z=_o++,Y=this.rigidBodies[z];Y._sleeping=!0,Y._sleepTime=0}else{for(var Z=0,ro=this.numSolvers,V;Z<ro;)V=Z++,this.solvers[V].preSolveVelocity(P);for(var so=0,lo=this.numSolvers,B;so<lo;)B=so++,this.solvers[B].warmStart(P);for(var co=0;co<t;){co++;for(var po=0,mo=this.numSolvers,C;po<mo;)C=po++,this.solvers[C].solveVelocity()}for(var bo=0,xo=this.numSolvers,R;bo<xo;)R=bo++,this.solvers[R].postSolveVelocity(P);for(var yo=0,fo=this.numRigidBodies,D;yo<fo;)D=yo++,this.rigidBodies[D]._integrate(o);for(var go=0,vo=this.numSolversSi,N;go<vo;)N=go++,this.solversSi[N].preSolvePosition(P);for(var Xo=0;Xo<i;){Xo++;for(var uo=0,zo=this.numSolversSi,H;uo<zo;)H=uo++,this.solversSi[H].solvePositionSplitImpulse()}for(var Yo=0,Zo=this.numRigidBodies,K;Yo<Zo;)K=Yo++,this.rigidBodies[K]._integratePseudoVelocity();for(var Io=0,Mo=this.numSolversNgs,ot;Io<Mo;)ot=Io++,this.solversNgs[ot].preSolvePosition(P);for(var ho=0;ho<i;){ho++;for(var Vo=0,Lo=this.numSolversNgs,rt;Vo<Lo;)rt=Vo++,this.solversNgs[rt].solvePositionNgs(P)}for(var Bo=0,ko=this.numSolvers,lt;Bo<ko;)lt=Bo++,this.solvers[lt].postSolve();for(var Ao=0,Po=this.numRigidBodies;Ao<Po;)for(var pt=Ao++,vt=this.rigidBodies[pt],yt=vt._shapeList;null!=yt;){var To=yt._next,Lt=yt._ptransform,wt=yt._localTransform,Bt=vt._ptransform,kt,wo,So,Co,qo,Ro,Eo,jo,No,Fo,Do,Wo;kt=Bt._rotation00*wt._rotation00+Bt._rotation01*wt._rotation10+Bt._rotation02*wt._rotation20,wo=Bt._rotation00*wt._rotation01+Bt._rotation01*wt._rotation11+Bt._rotation02*wt._rotation21,So=Bt._rotation00*wt._rotation02+Bt._rotation01*wt._rotation12+Bt._rotation02*wt._rotation22,Co=Bt._rotation10*wt._rotation00+Bt._rotation11*wt._rotation10+Bt._rotation12*wt._rotation20,qo=Bt._rotation10*wt._rotation01+Bt._rotation11*wt._rotation11+Bt._rotation12*wt._rotation21,Ro=Bt._rotation10*wt._rotation02+Bt._rotation11*wt._rotation12+Bt._rotation12*wt._rotation22,Eo=Bt._rotation20*wt._rotation00+Bt._rotation21*wt._rotation10+Bt._rotation22*wt._rotation20,jo=Bt._rotation20*wt._rotation01+Bt._rotation21*wt._rotation11+Bt._rotation22*wt._rotation21,No=Bt._rotation20*wt._rotation02+Bt._rotation21*wt._rotation12+Bt._rotation22*wt._rotation22,Lt._rotation00=kt,Lt._rotation01=wo,Lt._rotation02=So,Lt._rotation10=Co,Lt._rotation11=qo,Lt._rotation12=Ro,Lt._rotation20=Eo,Lt._rotation21=jo,Lt._rotation22=No,Fo=Bt._rotation00*wt._positionX+Bt._rotation01*wt._positionY+Bt._rotation02*wt._positionZ,Do=Bt._rotation10*wt._positionX+Bt._rotation11*wt._positionY+Bt._rotation12*wt._positionZ,Wo=Bt._rotation20*wt._positionX+Bt._rotation21*wt._positionY+Bt._rotation22*wt._positionZ,Lt._positionX=Fo,Lt._positionY=Do,Lt._positionZ=Wo,Lt._positionX+=Bt._positionX,Lt._positionY+=Bt._positionY,Lt._positionZ+=Bt._positionZ;var Go=yt._transform,Qt=yt._localTransform,$t=vt._transform,Kt,Oo,Ho,Jo,Uo,Qo,Ko,$o,ta,oa,aa,ia,na,_a,ea,ra,sa,la;if(Kt=$t._rotation00*Qt._rotation00+$t._rotation01*Qt._rotation10+$t._rotation02*Qt._rotation20,Oo=$t._rotation00*Qt._rotation01+$t._rotation01*Qt._rotation11+$t._rotation02*Qt._rotation21,Ho=$t._rotation00*Qt._rotation02+$t._rotation01*Qt._rotation12+$t._rotation02*Qt._rotation22,Jo=$t._rotation10*Qt._rotation00+$t._rotation11*Qt._rotation10+$t._rotation12*Qt._rotation20,Uo=$t._rotation10*Qt._rotation01+$t._rotation11*Qt._rotation11+$t._rotation12*Qt._rotation21,Qo=$t._rotation10*Qt._rotation02+$t._rotation11*Qt._rotation12+$t._rotation12*Qt._rotation22,Ko=$t._rotation20*Qt._rotation00+$t._rotation21*Qt._rotation10+$t._rotation22*Qt._rotation20,$o=$t._rotation20*Qt._rotation01+$t._rotation21*Qt._rotation11+$t._rotation22*Qt._rotation21,ta=$t._rotation20*Qt._rotation02+$t._rotation21*Qt._rotation12+$t._rotation22*Qt._rotation22,Go._rotation00=Kt,Go._rotation01=Oo,Go._rotation02=Ho,Go._rotation10=Jo,Go._rotation11=Uo,Go._rotation12=Qo,Go._rotation20=Ko,Go._rotation21=$o,Go._rotation22=ta,oa=$t._rotation00*Qt._positionX+$t._rotation01*Qt._positionY+$t._rotation02*Qt._positionZ,aa=$t._rotation10*Qt._positionX+$t._rotation11*Qt._positionY+$t._rotation12*Qt._positionZ,ia=$t._rotation20*Qt._positionX+$t._rotation21*Qt._positionY+$t._rotation22*Qt._positionZ,Go._positionX=oa,Go._positionY=aa,Go._positionZ=ia,Go._positionX+=$t._positionX,Go._positionY+=$t._positionY,Go._positionZ+=$t._positionZ,yt._geom._computeAabb(yt._aabb,yt._ptransform),na=yt._aabb._minX,_a=yt._aabb._minY,ea=yt._aabb._minZ,ra=yt._aabb._maxX,sa=yt._aabb._maxY,la=yt._aabb._maxZ,yt._geom._computeAabb(yt._aabb,yt._transform),yt._aabb._minX=na<yt._aabb._minX?na:yt._aabb._minX,yt._aabb._minY=_a<yt._aabb._minY?_a:yt._aabb._minY,yt._aabb._minZ=ea<yt._aabb._minZ?ea:yt._aabb._minZ,yt._aabb._maxX=ra>yt._aabb._maxX?ra:yt._aabb._maxX,yt._aabb._maxY=sa>yt._aabb._maxY?sa:yt._aabb._maxY,yt._aabb._maxZ=la>yt._aabb._maxZ?la:yt._aabb._maxZ,null!=yt._proxy){var ca,pa,ma;ca=yt._transform._positionX-yt._ptransform._positionX,pa=yt._transform._positionY-yt._ptransform._positionY,ma=yt._transform._positionZ-yt._ptransform._positionZ;var ba=yt.displacement;ba.x=ca,ba.y=pa,ba.z=ma,yt._rigidBody._world._broadPhase.moveProxy(yt._proxy,yt._aabb,yt.displacement)}yt=To}}}};var oimo_dynamics_TimeStep=function(){this.dt=0,this.invDt=0,this.dtRatio=1},oimo_dynamics_World=function(_,e){switch(null==_&&(_=2),_){case 1:this._broadPhase=new oimo_collision_broadphase_bruteforce_BruteForceBroadPhase;break;case 2:this._broadPhase=new oimo_collision_broadphase_bvh_BvhBroadPhase;}this._contactManager=new oimo_dynamics_ContactManager(this._broadPhase),null==e&&(e=new oimo_common_Vec3(0,-9.80665,0)),this._gravity=new oimo_common_Vec3(e.x,e.y,e.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new oimo_dynamics__$World_RayCastWrapper,this._convexCastWrapper=new oimo_dynamics__$World_ConvexCastWrapper,this._aabbTestWrapper=new oimo_dynamics__$World_AabbTestWrapper,this._island=new oimo_dynamics_Island;var r=oimo_common_Setting.islandInitialConstraintArraySize,o=Array(r);this._solversInIslands=o;var a=oimo_common_Setting.islandInitialRigidBodyArraySize,n=Array(a);this._rigidBodyStack=n,this._timeStep=new oimo_dynamics_TimeStep,this._pool=new oimo_common_Pool,this._shapeIdCount=0};oimo_dynamics_World.prototype={_updateContacts:function(){var _=new Date().getTime()/1e3;this._contactManager._updateContacts();var t=new Date().getTime()/1e3;oimo_dynamics_common_Performance.broadPhaseCollisionTime=1e3*(t-_);for(var i=new Date().getTime()/1e3,o=this._contactManager._contactList,e;null!=o;)e=o._next,o._shouldBeSkipped||o._updateManifold(),o=e;var r=new Date().getTime()/1e3;oimo_dynamics_common_Performance.narrowPhaseCollisionTime=1e3*(r-i)},_solveIslands:function(){var p=new Date().getTime()/1e3;if(oimo_common_Setting.disableSleeping)for(var t=this._rigidBodyList,m;null!=t;)m=t._next,t._sleeping=!1,t._sleepTime=0,t=m;if(this._rigidBodyStack.length<this._numRigidBodies){for(var b=this._rigidBodyStack.length<<1;b<this._numRigidBodies;)b<<=1;var x=Array(b);this._rigidBodyStack=x}this._numIslands=0;var n=this._island,s=this._gravity;n.gravityX=s.x,n.gravityY=s.y,n.gravityZ=s.z;var _=this._rigidBodyList;for(this._numSolversInIslands=0;null!=_;){for(var d=_._next;!_._addedToIsland&&!_._sleeping&&1!=_._type;){if(0==_._numContactLinks&&0==_._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,_),this._numIslands++;break}this.buildIsland(_),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}_=d}for(this._contactManager._postSolve(),_=this._rigidBodyList;null!=_;){var e=_._next;_._addedToIsland=!1,_=e}for(_=this._rigidBodyList;null!=_;){var y=_._next;_._forceX=0,_._forceY=0,_._forceZ=0,_._torqueX=0,_._torqueY=0,_._torqueZ=0,_=y}for(;0<this._numSolversInIslands;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var l=new Date().getTime()/1e3;oimo_dynamics_common_Performance.dynamicsTime=1e3*(l-p)},buildIsland:function(X){var t=1;for(this._island._addRigidBody(X),this._rigidBodyStack[0]=X;0<t;){var z=this._rigidBodyStack[--t];if(this._rigidBodyStack[t]=null,1!=z._type){for(var o=z._contactLinkList;null!=o;){var Y=o._next,n=o._contact._contactConstraint,s=o._contact._contactConstraint._solver;if(n.isTouching()&&!s._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var _=this._numSolversInIslands<<1,r=Array(_),e=0,Z=this._numSolversInIslands,l;e<Z;)l=e++,r[l]=this._solversInIslands[l],this._solversInIslands[l]=null;this._solversInIslands=r}this._solversInIslands[this._numSolversInIslands++]=s,this._island._addConstraintSolver(s,n._positionCorrectionAlgorithm);var I=o._other;I._addedToIsland||(this._island._addRigidBody(I),this._rigidBodyStack[t++]=I)}o=Y}for(var m=z._jointLinkList;null!=m;){var V=m._next,v=m._joint,y=v._solver;if(!y._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var b=this._numSolversInIslands<<1,f=Array(b),d=0,L=this._numSolversInIslands,u;d<L;)u=d++,f[u]=this._solversInIslands[u],this._solversInIslands[u]=null;this._solversInIslands=f}this._solversInIslands[this._numSolversInIslands++]=y,this._island._addConstraintSolver(y,v._positionCorrectionAlgorithm);var B=m._other;B._addedToIsland||(this._island._addRigidBody(B),this._rigidBodyStack[t++]=B)}m=V}}}},_drawBvh:function(o,t){o.drawBvh&&this._drawBvhNode(o,t._root,0,o.style.bvhNodeColor)},_drawBvhNode:function(X,t,i,o){if(null!=t){if(i>=X.drawBvhMinLevel&&i<=X.drawBvhMaxLevel){var a=this._pool,n=0==a.sizeVec3?new oimo_common_Vec3:a.stackVec3[--a.sizeVec3],s=this._pool,_=0==s.sizeVec3?new oimo_common_Vec3:s.stackVec3[--s.sizeVec3],r=n;r.x=t._aabbMinX,r.y=t._aabbMinY,r.z=t._aabbMinZ;var e=_;e.x=t._aabbMaxX,e.y=t._aabbMaxY,e.z=t._aabbMaxZ,X.aabb(n,_,o);var z=this._pool;if(null!=n){if(n.zero(),z.sizeVec3==z.stackVec3.length){for(var l=z.sizeVec3<<1,c=Array(l),m=0,Y=z.sizeVec3,v;m<Y;)v=m++,c[v]=z.stackVec3[v],z.stackVec3[v]=null;z.stackVec3=c}z.stackVec3[z.sizeVec3++]=n}var Z=this._pool;if(null!=_){if(_.zero(),Z.sizeVec3==Z.stackVec3.length){for(var b=Z.sizeVec3<<1,f=Array(b),d=0,I=Z.sizeVec3,u;d<I;)u=d++,f[u]=Z.stackVec3[u],Z.stackVec3[u]=null;Z.stackVec3=f}Z.stackVec3[Z.sizeVec3++]=_}}this._drawBvhNode(X,t._children[0],i+1,o),this._drawBvhNode(X,t._children[1],i+1,o)}},_drawRigidBodies:function(N){for(var t=N.style,i=this._rigidBodyList,nt;null!=i;){if(nt=i._next,N.drawBases){var pt=N.style;N.basis(i._transform,pt.basisLength,pt.basisColorX,pt.basisColorY,pt.basisColorZ)}var n=null,ft=0==i._type;ft||(n=2==i._type?t.kinematicShapeColor:t.staticShapeColor);for(var _=i._shapeList,gt;null!=_;){if(gt=_._next,ft&&(n=0==(1&_._id)?i._sleeping?t.sleepingShapeColor1:i._sleepTime>oimo_common_Setting.sleepingTimeThreshold?t.sleepyShapeColor1:t.shapeColor1:i._sleeping?t.sleepingShapeColor2:i._sleepTime>oimo_common_Setting.sleepingTimeThreshold?t.sleepyShapeColor2:t.shapeColor2),N.drawShapes){var Yt=_._geom,h=_._transform;switch(Yt._type){case 0:N.sphere(h,Yt._radius,n);break;case 1:var l=Yt,c=this._pool,m=0==c.sizeVec3?new oimo_common_Vec3:c.stackVec3[--c.sizeVec3],p=m;p.x=l._halfExtentsX,p.y=l._halfExtentsY,p.z=l._halfExtentsZ,N.box(h,m,n);var v=this._pool;if(null!=m){if(m.zero(),v.sizeVec3==v.stackVec3.length){for(var y=v.sizeVec3<<1,b=Array(y),f=0,ht=v.sizeVec3,x;f<ht;)x=f++,b[x]=v.stackVec3[x],v.stackVec3[x]=null;v.stackVec3=b}v.stackVec3[v.sizeVec3++]=m}break;case 2:var eo=Yt;N.cylinder(h,eo._radius,eo._halfHeight,n);break;case 3:var g=Yt;N.cone(h,g._radius,g._halfHeight,n);break;case 4:var M=Yt;N.capsule(h,M._radius,M._halfHeight,n);break;case 5:var X=Yt,z=X._numVertices,Y=this._pool,Z=0==Y.sizeVec3?new oimo_common_Vec3:Y.stackVec3[--Y.sizeVec3],I=this._pool,V=0==I.sizeVec3?new oimo_common_Vec3:I.stackVec3[--I.sizeVec3],L=this._pool,w=0==L.sizeVec3?new oimo_common_Vec3:L.stackVec3[--L.sizeVec3],B=this._pool,k=0==B.sizeVec3?new oimo_common_Vec3:B.stackVec3[--B.sizeVec3],A=this._pool,P=0==A.sizeVec3?new oimo_common_Vec3:A.stackVec3[--A.sizeVec3],S=this._pool,C=0==S.sizeVec3?new oimo_common_Vec3:S.stackVec3[--S.sizeVec3],T=this._pool,j=0==T.sizeMat3?new oimo_common_Mat3:T.stackMat3[--T.sizeMat3],R=this._pool,q=0==R.sizeVec3?new oimo_common_Vec3:R.stackVec3[--R.sizeVec3],E=j;E.e00=h._rotation00,E.e01=h._rotation01,E.e02=h._rotation02,E.e10=h._rotation10,E.e11=h._rotation11,E.e12=h._rotation12,E.e20=h._rotation20,E.e21=h._rotation21,E.e22=h._rotation22;var D=q;D.x=h._positionX,D.y=h._positionY,D.z=h._positionZ;for(var J=0;J<z;){var lo=J++,G=X._tmpVertices[lo],O=X._vertices[lo];G.x=O.x,G.y=O.y,G.z=O.z;var W=G,U=W.x*j.e00+W.y*j.e01+W.z*j.e02,H=W.x*j.e10+W.y*j.e11+W.z*j.e12,Q=W.x*j.e20+W.y*j.e21+W.z*j.e22;W.x=U,W.y=H,W.z=Q;var $=W,K=$.x+q.x,tt=$.y+q.y,it=$.z+q.z;$.x=K,$.y=tt,$.z=it}if(30<z)for(var ot=0;ot<z;){var co=ot++,st=X._tmpVertices[co];Z.x=st.x,Z.y=st.y,Z.z=st.z;var _t=X._tmpVertices[(co+1)%z];V.x=_t.x,V.y=_t.y,V.z=_t.z,N.line(Z,V,n)}else if(this._debugDraw.wireframe||10<z)for(var rt=0;rt<z;){var po=rt++,lt=X._tmpVertices[po];Z.x=lt.x,Z.y=lt.y,Z.z=lt.z;for(var ct=0;ct<po;){var mo=ct++,vt=X._tmpVertices[mo];V.x=vt.x,V.y=vt.y,V.z=vt.z,N.line(Z,V,n)}}else for(var yt=0;yt<z;){var bo=yt++,dt=X._tmpVertices[bo];Z.x=dt.x,Z.y=dt.y,Z.z=dt.z;for(var xt=0;xt<bo;){var xo=xt++,Mt=X._tmpVertices[xo];V.x=Mt.x,V.y=Mt.y,V.z=Mt.z;for(var Xt=0;Xt<xo;){var yo=Xt++,Zt=X._tmpVertices[yo];w.x=Zt.x,w.y=Zt.y,w.z=Zt.z,k.x=V.x,k.y=V.y,k.z=V.z;var It=k,Vt=It.x-Z.x,Lt=It.y-Z.y,wt=It.z-Z.z;It.x=Vt,It.y=Lt,It.z=wt,P.x=w.x,P.y=w.y,P.z=w.z;var Bt=P,kt=Bt.x-Z.x,At=Bt.y-Z.y,Pt=Bt.z-Z.z;Bt.x=kt,Bt.y=At,Bt.z=Pt,C.x=k.x,C.y=k.y,C.z=k.z;var St=C,Ct=St.y*P.z-St.z*P.y,Tt=St.z*P.x-St.x*P.z,jt=St.x*P.y-St.y*P.x;St.x=Ct,St.y=Tt,St.z=jt;var Rt=St,qt=Math.sqrt(Rt.x*Rt.x+Rt.y*Rt.y+Rt.z*Rt.z);0<qt&&(qt=1/qt);var fo=Rt.x*qt,Dt=Rt.y*qt,Jt=Rt.z*qt;Rt.x=fo,Rt.y=Dt,Rt.z=Jt,N.triangle(Z,V,w,C,C,C,n);var Ft=-C.x,Nt=-C.y,Gt=-C.z;C.x=Ft,C.y=Nt,C.z=Gt,N.triangle(Z,w,V,C,C,C,n)}}}var Ot=this._pool;if(null!=Z){if(Z.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var Wt=Ot.sizeVec3<<1,Ut=Array(Wt),Ht=0,go=Ot.sizeVec3,$t;Ht<go;)$t=Ht++,Ut[$t]=Ot.stackVec3[$t],Ot.stackVec3[$t]=null;Ot.stackVec3=Ut}Ot.stackVec3[Ot.sizeVec3++]=Z}var vo=this._pool;if(null!=V){if(V.zero(),vo.sizeVec3==vo.stackVec3.length){for(var Xo=vo.sizeVec3<<1,uo=Array(Xo),zo=0,Yo=vo.sizeVec3,Zo;zo<Yo;)Zo=zo++,uo[Zo]=vo.stackVec3[Zo],vo.stackVec3[Zo]=null;vo.stackVec3=uo}vo.stackVec3[vo.sizeVec3++]=V}var Io=this._pool;if(null!=w){if(w.zero(),Io.sizeVec3==Io.stackVec3.length){for(var Mo=Io.sizeVec3<<1,ho=Array(Mo),Vo=0,Lo=Io.sizeVec3,Bo;Vo<Lo;)Bo=Vo++,ho[Bo]=Io.stackVec3[Bo],Io.stackVec3[Bo]=null;Io.stackVec3=ho}Io.stackVec3[Io.sizeVec3++]=w}var ko=this._pool;if(null!=k){if(k.zero(),ko.sizeVec3==ko.stackVec3.length){for(var Ao=ko.sizeVec3<<1,Po=Array(Ao),To=0,wo=ko.sizeVec3,So;To<wo;)So=To++,Po[So]=ko.stackVec3[So],ko.stackVec3[So]=null;ko.stackVec3=Po}ko.stackVec3[ko.sizeVec3++]=k}var Co=this._pool;if(null!=P){if(P.zero(),Co.sizeVec3==Co.stackVec3.length){for(var qo=Co.sizeVec3<<1,Ro=Array(qo),Eo=0,jo=Co.sizeVec3,No;Eo<jo;)No=Eo++,Ro[No]=Co.stackVec3[No],Co.stackVec3[No]=null;Co.stackVec3=Ro}Co.stackVec3[Co.sizeVec3++]=P}var Fo=this._pool;if(null!=C){if(C.zero(),Fo.sizeVec3==Fo.stackVec3.length){for(var Do=Fo.sizeVec3<<1,Wo=Array(Do),Go=0,Oo=Fo.sizeVec3,Ho;Go<Oo;)Ho=Go++,Wo[Ho]=Fo.stackVec3[Ho],Fo.stackVec3[Ho]=null;Fo.stackVec3=Wo}Fo.stackVec3[Fo.sizeVec3++]=C}var Jo=this._pool;if(null!=j){if(j.e00=1,j.e01=0,j.e02=0,j.e10=0,j.e11=1,j.e12=0,j.e20=0,j.e21=0,j.e22=1,Jo.sizeMat3==Jo.stackMat3.length){for(var Uo=Jo.sizeMat3<<1,Qo=Array(Uo),Ko=0,$o=Jo.sizeMat3,ta;Ko<$o;)ta=Ko++,Qo[ta]=Jo.stackMat3[ta],Jo.stackMat3[ta]=null;Jo.stackMat3=Qo}Jo.stackMat3[Jo.sizeMat3++]=j}var oa=this._pool;if(null!=q){if(q.zero(),oa.sizeVec3==oa.stackVec3.length){for(var aa=oa.sizeVec3<<1,ia=Array(aa),na=0,_a=oa.sizeVec3,ea;na<_a;)ea=na++,ia[ea]=oa.stackVec3[ea],oa.stackVec3[ea]=null;oa.stackVec3=ia}oa.stackVec3[oa.sizeVec3++]=q}}}if(N.drawAabbs){var ra=_._aabb,sa=t.aabbColor,la=this._pool,ca=0==la.sizeVec3?new oimo_common_Vec3:la.stackVec3[--la.sizeVec3],pa=this._pool,ma=0==pa.sizeVec3?new oimo_common_Vec3:pa.stackVec3[--pa.sizeVec3],ba=ca;ba.x=ra._minX,ba.y=ra._minY,ba.z=ra._minZ;var xa=ma;xa.x=ra._maxX,xa.y=ra._maxY,xa.z=ra._maxZ,N.aabb(ca,ma,sa);var da=this._pool;if(null!=ca){if(ca.zero(),da.sizeVec3==da.stackVec3.length){for(var ya=da.sizeVec3<<1,fa=Array(ya),ga=0,va=da.sizeVec3,to;ga<va;)to=ga++,fa[to]=da.stackVec3[to],da.stackVec3[to]=null;da.stackVec3=fa}da.stackVec3[da.sizeVec3++]=ca}var Xa=this._pool;if(null!=ma){if(ma.zero(),Xa.sizeVec3==Xa.stackVec3.length){for(var oo=Xa.sizeVec3<<1,ao=Array(oo),no=0,ua=Xa.sizeVec3,_o;no<ua;)_o=no++,ao[_o]=Xa.stackVec3[_o],Xa.stackVec3[_o]=null;Xa.stackVec3=ao}Xa.stackVec3[Xa.sizeVec3++]=ma}}_=gt}i=nt}},_drawConstraints:function(Ko){var t=Ko.style;if(Ko.drawPairs||Ko.drawContacts)for(var i=this._contactManager._contactList,ta;null!=i;){if(ta=i._next,Ko.drawPairs){var oa=t.pairColor,n=this._pool,s=0==n.sizeVec3?new oimo_common_Vec3:n.stackVec3[--n.sizeVec3],_=this._pool,r=0==_.sizeVec3?new oimo_common_Vec3:_.stackVec3[--_.sizeVec3],e=s;e.x=i._s1._transform._positionX,e.y=i._s1._transform._positionY,e.z=i._s1._transform._positionZ;var h=r;h.x=i._s2._transform._positionX,h.y=i._s2._transform._positionY,h.z=i._s2._transform._positionZ,Ko.line(s,r,oa);var l=this._pool;if(null!=s){if(s.zero(),l.sizeVec3==l.stackVec3.length){for(var c=l.sizeVec3<<1,m=Array(c),p=0,aa=l.sizeVec3,y;p<aa;)y=p++,m[y]=l.stackVec3[y],l.stackVec3[y]=null;l.stackVec3=m}l.stackVec3[l.sizeVec3++]=s}var ia=this._pool;if(null!=r){if(r.zero(),ia.sizeVec3==ia.stackVec3.length){for(var f=ia.sizeVec3<<1,d=Array(f),x=0,na=ia.sizeVec3,g;x<na;)g=x++,d[g]=ia.stackVec3[g],ia.stackVec3[g]=null;ia.stackVec3=d}ia.stackVec3[ia.sizeVec3++]=r}}if(Ko.drawContacts)for(var _a=i._contactConstraint,X=i._contactConstraint._manifold._points,z=0,ea=i._contactConstraint._manifold._numPoints;z<ea;){var Z=X[z++],I=Ko.style,V=(_a._s1._transform,_a._s2._transform,this._pool),L=0==V.sizeVec3?new oimo_common_Vec3:V.stackVec3[--V.sizeVec3],w=this._pool,B=0==w.sizeVec3?new oimo_common_Vec3:w.stackVec3[--w.sizeVec3],k=this._pool,A=0==k.sizeVec3?new oimo_common_Vec3:k.stackVec3[--k.sizeVec3],P=this._pool,S=0==P.sizeVec3?new oimo_common_Vec3:P.stackVec3[--P.sizeVec3],C=this._pool,T=0==C.sizeVec3?new oimo_common_Vec3:C.stackVec3[--C.sizeVec3],j=L;j.x=Z._pos1X,j.y=Z._pos1Y,j.z=Z._pos1Z;var R=B;R.x=Z._pos2X,R.y=Z._pos2Y,R.z=Z._pos2Z;var q=A;q.x=_a._manifold._normalX,q.y=_a._manifold._normalY,q.z=_a._manifold._normalZ;var E=S;E.x=_a._manifold._tangentX,E.y=_a._manifold._tangentY,E.z=_a._manifold._tangentZ;var D=T;if(D.x=_a._manifold._binormalX,D.y=_a._manifold._binormalY,D.z=_a._manifold._binormalZ,Z._disabled)Ko.point(L,I.disabledContactColor),Ko.point(B,I.disabledContactColor),Ko.line(L,B,I.disabledContactColor);else if(Z._warmStarted){var J;switch(3&Z._id){case 0:J=I.contactColor;break;case 1:J=I.contactColor2;break;case 2:J=I.contactColor3;break;default:J=I.contactColor4;}Ko.point(L,J),Ko.point(B,J),Ko.line(L,B,I.contactColor)}else Ko.point(L,I.newContactColor),Ko.point(B,I.newContactColor),Ko.line(L,B,I.newContactColor);B.x=L.x,B.y=L.y,B.z=L.z;var ra=B,N=I.contactNormalLength,G=ra.x+A.x*N,O=ra.y+A.y*N,W=ra.z+A.z*N;if(ra.x=G,ra.y=O,ra.z=W,Ko.line(L,B,I.contactNormalColor),Ko.drawContactBases){B.x=L.x,B.y=L.y,B.z=L.z;var U=B,H=I.contactTangentLength,Q=U.x+S.x*H,$=U.y+S.y*H,K=U.z+S.z*H;U.x=Q,U.y=$,U.z=K,Ko.line(L,B,I.contactTangentColor),B.x=L.x,B.y=L.y,B.z=L.z;var tt=B,it=I.contactBinormalLength,ot=tt.x+T.x*it,at=tt.y+T.y*it,nt=tt.z+T.z*it;tt.x=ot,tt.y=at,tt.z=nt,Ko.line(L,B,I.contactBinormalColor)}var st=this._pool;if(null!=L){if(L.zero(),st.sizeVec3==st.stackVec3.length){for(var _t=st.sizeVec3<<1,rt=Array(_t),et=0,sa=st.sizeVec3,lt;et<sa;)lt=et++,rt[lt]=st.stackVec3[lt],st.stackVec3[lt]=null;st.stackVec3=rt}st.stackVec3[st.sizeVec3++]=L}var la=this._pool;if(null!=B){if(B.zero(),la.sizeVec3==la.stackVec3.length){for(var mt=la.sizeVec3<<1,pt=Array(mt),vt=0,ca=la.sizeVec3,bt;vt<ca;)bt=vt++,pt[bt]=la.stackVec3[bt],la.stackVec3[bt]=null;la.stackVec3=pt}la.stackVec3[la.sizeVec3++]=B}var pa=this._pool;if(null!=A){if(A.zero(),pa.sizeVec3==pa.stackVec3.length){for(var dt=pa.sizeVec3<<1,xt=Array(dt),ut=0,ma=pa.sizeVec3,Mt;ut<ma;)Mt=ut++,xt[Mt]=pa.stackVec3[Mt],pa.stackVec3[Mt]=null;pa.stackVec3=xt}pa.stackVec3[pa.sizeVec3++]=A}var ba=this._pool;if(null!=S){if(S.zero(),ba.sizeVec3==ba.stackVec3.length){for(var zt=ba.sizeVec3<<1,Yt=Array(zt),Zt=0,xa=ba.sizeVec3,Vt;Zt<xa;)Vt=Zt++,Yt[Vt]=ba.stackVec3[Vt],ba.stackVec3[Vt]=null;ba.stackVec3=Yt}ba.stackVec3[ba.sizeVec3++]=S}var da=this._pool;if(null!=T){if(T.zero(),da.sizeVec3==da.stackVec3.length){for(var wt=da.sizeVec3<<1,Bt=Array(wt),kt=0,ya=da.sizeVec3,Pt;kt<ya;)Pt=kt++,Bt[Pt]=da.stackVec3[Pt],da.stackVec3[Pt]=null;da.stackVec3=Bt}da.stackVec3[da.sizeVec3++]=T}}i=ta}if(Ko.drawJoints)for(var fa=this._jointList;null!=fa;){var ga=fa._next,Tt=this._pool,jt=0==Tt.sizeVec3?new oimo_common_Vec3:Tt.stackVec3[--Tt.sizeVec3],Rt=this._pool,qt=0==Rt.sizeVec3?new oimo_common_Vec3:Rt.stackVec3[--Rt.sizeVec3],Et=jt;Et.x=fa._b1._transform._positionX,Et.y=fa._b1._transform._positionY,Et.z=fa._b1._transform._positionZ;var Dt=qt;Dt.x=fa._b2._transform._positionX,Dt.y=fa._b2._transform._positionY,Dt.z=fa._b2._transform._positionZ;var Jt=this._pool,Ft=0==Jt.sizeVec3?new oimo_common_Vec3:Jt.stackVec3[--Jt.sizeVec3],Nt=this._pool,Gt=0==Nt.sizeVec3?new oimo_common_Vec3:Nt.stackVec3[--Nt.sizeVec3],Ot=this._pool,Wt=0==Ot.sizeVec3?new oimo_common_Vec3:Ot.stackVec3[--Ot.sizeVec3],Ut=this._pool,Ht=0==Ut.sizeVec3?new oimo_common_Vec3:Ut.stackVec3[--Ut.sizeVec3],Qt=this._pool,$t=0==Qt.sizeVec3?new oimo_common_Vec3:Qt.stackVec3[--Qt.sizeVec3],Kt=this._pool,va=0==Kt.sizeVec3?new oimo_common_Vec3:Kt.stackVec3[--Kt.sizeVec3],Xa=this._pool,ua=0==Xa.sizeVec3?new oimo_common_Vec3:Xa.stackVec3[--Xa.sizeVec3],za=this._pool,Ya=0==za.sizeVec3?new oimo_common_Vec3:za.stackVec3[--za.sizeVec3],Za=Ft;Za.x=fa._anchor1X,Za.y=fa._anchor1Y,Za.z=fa._anchor1Z;var Ia=Gt;Ia.x=fa._anchor2X,Ia.y=fa._anchor2Y,Ia.z=fa._anchor2Z;var Ma=Wt;Ma.x=fa._basisX1X,Ma.y=fa._basisX1Y,Ma.z=fa._basisX1Z;var ha=Ht;ha.x=fa._basisY1X,ha.y=fa._basisY1Y,ha.z=fa._basisY1Z;var Va=$t;Va.x=fa._basisZ1X,Va.y=fa._basisZ1Y,Va.z=fa._basisZ1Z;var La=va;La.x=fa._basisX2X,La.y=fa._basisX2Y,La.z=fa._basisX2Z;var Ba=ua;Ba.x=fa._basisY2X,Ba.y=fa._basisY2Y,Ba.z=fa._basisY2Z;var ka=Ya;if(ka.x=fa._basisZ2X,ka.y=fa._basisZ2Y,ka.z=fa._basisZ2Z,Ko.line(jt,Ft,Ko.style.jointLineColor),Ko.line(qt,Gt,Ko.style.jointLineColor),Ko.drawJointLimits)switch(fa._type){case 0:break;case 1:var Aa=Ko.style.jointRotationalConstraintRadius,Pa=Ko.style.jointLineColor,Ta=fa._lm;this._drawRotationalLimit(Ko,Ft,Ht,$t,ua,Aa,Ta.lowerLimit,Ta.upperLimit,Pa);break;case 2:var wa=fa,Sa=Ko.style.jointRotationalConstraintRadius,Ca=Ko.style.jointLineColor,qa=wa._rotLm,Ra=wa._translLm;this._drawRotationalLimit(Ko,Gt,Ht,$t,ua,Sa,qa.lowerLimit,qa.upperLimit,Ca),this._drawTranslationalLimit(Ko,Ft,Wt,Ra.lowerLimit,Ra.upperLimit,Ca);break;case 3:Ko.style.jointRotationalConstraintRadius;var Ea=Ko.style.jointLineColor,ja=fa._lm;this._drawTranslationalLimit(Ko,Ft,Wt,ja.lowerLimit,ja.upperLimit,Ea);break;case 4:var Na=fa,Fa=Ko.style.jointRotationalConstraintRadius,Da=Ko.style.jointLineColor,Wa=Na._lm1,Ga=Na._lm2;this._drawRotationalLimit(Ko,Ft,Ht,$t,Ht,Fa,Na._angleX-Wa.upperLimit,Na._angleX-Wa.lowerLimit,Da),this._drawRotationalLimit(Ko,Gt,va,ua,va,Fa,Ga.lowerLimit-Na._angleZ,Ga.upperLimit-Na._angleZ,Da);break;case 5:var Oa=fa,Ha=Ko.style.jointRotationalConstraintRadius,Ja=Ko.style.jointLineColor,Ua=Oa._twistLm;this._drawRotationalLimit(Ko,Gt,ua,Ya,ua,Ha,Ua.lowerLimit-Oa._twistAngle,Ua.upperLimit-Oa._twistAngle,Ja),this._drawEllipseOnSphere(Ko,Ft,Wt,Ht,$t,Oa._maxSwingAngle1,Oa._maxSwingAngle2,Ha,Ja);var Qa=this._pool,Ka=0==Qa.sizeVec3?new oimo_common_Vec3:Qa.stackVec3[--Qa.sizeVec3];Ka.x=Gt.x,Ka.y=Gt.y,Ka.z=Gt.z;var $a=Ka,ti=$a.x+va.x*Ha,oi=$a.y+va.y*Ha,ai=$a.z+va.z*Ha;$a.x=ti,$a.y=oi,$a.z=ai;var ii=$a;Ko.line(Gt,ii,Ja);var ni=this._pool;if(null!=ii){if(ii.zero(),ni.sizeVec3==ni.stackVec3.length){for(var _i=ni.sizeVec3<<1,ei=Array(_i),ri=0,si=ni.sizeVec3,li;ri<si;)li=ri++,ei[li]=ni.stackVec3[li],ni.stackVec3[li]=null;ni.stackVec3=ei}ni.stackVec3[ni.sizeVec3++]=ii}}Ko.line(Ft,Gt,Ko.style.jointErrorColor);var ci=this._pool;if(null!=jt){if(jt.zero(),ci.sizeVec3==ci.stackVec3.length){for(var pi=ci.sizeVec3<<1,mi=Array(pi),bi=0,xi=ci.sizeVec3,di;bi<xi;)di=bi++,mi[di]=ci.stackVec3[di],ci.stackVec3[di]=null;ci.stackVec3=mi}ci.stackVec3[ci.sizeVec3++]=jt}var yi=this._pool;if(null!=qt){if(qt.zero(),yi.sizeVec3==yi.stackVec3.length){for(var fi=yi.sizeVec3<<1,gi=Array(fi),to=0,vi=yi.sizeVec3,oo;to<vi;)oo=to++,gi[oo]=yi.stackVec3[oo],yi.stackVec3[oo]=null;yi.stackVec3=gi}yi.stackVec3[yi.sizeVec3++]=qt}var Xi=this._pool;if(null!=Ft){if(Ft.zero(),Xi.sizeVec3==Xi.stackVec3.length){for(var no=Xi.sizeVec3<<1,so=Array(no),_o=0,ui=Xi.sizeVec3,eo;_o<ui;)eo=_o++,so[eo]=Xi.stackVec3[eo],Xi.stackVec3[eo]=null;Xi.stackVec3=so}Xi.stackVec3[Xi.sizeVec3++]=Ft}var zi=this._pool;if(null!=Gt){if(Gt.zero(),zi.sizeVec3==zi.stackVec3.length){for(var lo=zi.sizeVec3<<1,co=Array(lo),mo=0,Yi=zi.sizeVec3,vo;mo<Yi;)vo=mo++,co[vo]=zi.stackVec3[vo],zi.stackVec3[vo]=null;zi.stackVec3=co}zi.stackVec3[zi.sizeVec3++]=Gt}var Zi=this._pool;if(null!=Wt){if(Wt.zero(),Zi.sizeVec3==Zi.stackVec3.length){for(var bo=Zi.sizeVec3<<1,fo=Array(bo),xo=0,Ii=Zi.sizeVec3,go;xo<Ii;)go=xo++,fo[go]=Zi.stackVec3[go],Zi.stackVec3[go]=null;Zi.stackVec3=fo}Zi.stackVec3[Zi.sizeVec3++]=Wt}var Mi=this._pool;if(null!=Ht){if(Ht.zero(),Mi.sizeVec3==Mi.stackVec3.length){for(var Xo=Mi.sizeVec3<<1,zo=Array(Xo),Yo=0,hi=Mi.sizeVec3,Io;Yo<hi;)Io=Yo++,zo[Io]=Mi.stackVec3[Io],Mi.stackVec3[Io]=null;Mi.stackVec3=zo}Mi.stackVec3[Mi.sizeVec3++]=Ht}var Vi=this._pool;if(null!=$t){if($t.zero(),Vi.sizeVec3==Vi.stackVec3.length){for(var Lo=Vi.sizeVec3<<1,wo=Array(Lo),Bo=0,Li=Vi.sizeVec3,Ao;Bo<Li;)Ao=Bo++,wo[Ao]=Vi.stackVec3[Ao],Vi.stackVec3[Ao]=null;Vi.stackVec3=wo}Vi.stackVec3[Vi.sizeVec3++]=$t}var Bi=this._pool;if(null!=va){if(va.zero(),Bi.sizeVec3==Bi.stackVec3.length){for(var So=Bi.sizeVec3<<1,Co=Array(So),To=0,ki=Bi.sizeVec3,Ro;To<ki;)Ro=To++,Co[Ro]=Bi.stackVec3[Ro],Bi.stackVec3[Ro]=null;Bi.stackVec3=Co}Bi.stackVec3[Bi.sizeVec3++]=va}var Ai=this._pool;if(null!=ua){if(ua.zero(),Ai.sizeVec3==Ai.stackVec3.length){for(var Eo=Ai.sizeVec3<<1,Do=Array(Eo),Jo=0,Pi=Ai.sizeVec3,No;Jo<Pi;)No=Jo++,Do[No]=Ai.stackVec3[No],Ai.stackVec3[No]=null;Ai.stackVec3=Do}Ai.stackVec3[Ai.sizeVec3++]=ua}var Ti=this._pool;if(null!=Ya){if(Ya.zero(),Ti.sizeVec3==Ti.stackVec3.length){for(var Oo=Ti.sizeVec3<<1,Wo=Array(Oo),Uo=0,wi=Ti.sizeVec3,Qo;Uo<wi;)Qo=Uo++,Wo[Qo]=Ti.stackVec3[Qo],Ti.stackVec3[Qo]=null;Ti.stackVec3=Wo}Ti.stackVec3[Ti.sizeVec3++]=Ya}fa=ga}},_drawRotationalLimit:function(X,t,i,o,a,n,s,_,r){if(s!=_){var e=this._pool,z=0==e.sizeVec3?new oimo_common_Vec3:e.stackVec3[--e.sizeVec3];z.x=t.x,z.y=t.y,z.z=t.z;var l=z,c=l.x+a.x*n,m=l.y+a.y*n,p=l.z+a.z*n;l.x=c,l.y=m,l.z=p;var v=l;X.line(t,v,r);var y=this._pool;if(null!=v){if(v.zero(),y.sizeVec3==y.stackVec3.length){for(var b=y.sizeVec3<<1,f=Array(b),d=0,Y=y.sizeVec3,u;d<Y;)u=d++,f[u]=y.stackVec3[u],y.stackVec3[u]=null;y.stackVec3=f}y.stackVec3[y.sizeVec3++]=v}}s>_?X.ellipse(t,i,o,n,n,r):X.arc(t,i,o,n,n,s,_,!0,r)},_drawTranslationalLimit:function(k,t,i,o,a,n){if(o<a){var s=this._pool,_=0==s.sizeVec3?new oimo_common_Vec3:s.stackVec3[--s.sizeVec3];_.x=t.x,_.y=t.y,_.z=t.z;var r=_,e=r.x+i.x*o,h=r.y+i.y*o,l=r.z+i.z*o;r.x=e,r.y=h,r.z=l;var c=r,m=this._pool,p=0==m.sizeVec3?new oimo_common_Vec3:m.stackVec3[--m.sizeVec3];p.x=t.x,p.y=t.y,p.z=t.z;var v=p,y=v.x+i.x*a,b=v.y+i.y*a,f=v.z+i.z*a;v.x=y,v.y=b,v.z=f;var d=v;k.line(c,d,n);var x=this._pool;if(null!=c){if(c.zero(),x.sizeVec3==x.stackVec3.length){for(var u=x.sizeVec3<<1,g=Array(u),M=0,A=x.sizeVec3,z;M<A;)z=M++,g[z]=x.stackVec3[z],x.stackVec3[z]=null;x.stackVec3=g}x.stackVec3[x.sizeVec3++]=c}var P=this._pool;if(null!=d){if(d.zero(),P.sizeVec3==P.stackVec3.length){for(var Z=P.sizeVec3<<1,I=Array(Z),V=0,T=P.sizeVec3,w;V<T;)w=V++,I[w]=P.stackVec3[w],P.stackVec3[w]=null;P.stackVec3=I}P.stackVec3[P.sizeVec3++]=d}}},_drawEllipseOnSphere:function(Nt,t,i,o,a,n,s,_,r){for(var e=0,Ft=this._pool,l=0==Ft.sizeVec3?new oimo_common_Vec3:Ft.stackVec3[--Ft.sizeVec3],c=this._pool,m=0==c.sizeQuat?new oimo_common_Quat:c.stackQuat[--c.sizeQuat],p=this._pool,v=0==p.sizeMat3?new oimo_common_Mat3:p.stackMat3[--p.sizeMat3],y=this._pool,b=0==y.sizeVec3?new oimo_common_Vec3:y.stackVec3[--y.sizeVec3],Dt=0;17>Dt;){var Wt=Dt++,x=Math.cos(e)*n,u=Math.sin(e)*s,g=Math.sqrt(x*x+u*u),M=Math.sin(.5*g),X=Math.cos(.5*g),z=l.zero(),Y=z.x+o.x*x,Z=z.y+o.y*x,I=z.z+o.z*x;z.x=Y,z.y=Z,z.z=I;var V=z,L=V.x+a.x*u,w=V.y+a.y*u,B=V.z+a.z*u;V.x=L,V.y=w,V.z=B;var k=1/g*M,A=l.x*k,P=l.y*k,S=l.z*k;l.x=A,l.y=P,l.z=S,m.x=l.x,m.y=l.y,m.z=l.z,m.w=X;var C=m.x,T=m.y,j=m.z,R=m.w,q=2*C,E=2*T,D=2*j,J=C*q,F=T*E,N=j*D,G=C*E,O=T*D,W=C*D,U=R*q,H=R*E,Q=R*D;v.e00=1-F-N,v.e01=G-Q,v.e02=W+H,v.e10=G+Q,v.e11=1-J-N,v.e12=O-U,v.e20=W-H,v.e21=O+U,v.e22=1-J-F;var $=this._pool,K=0==$.sizeVec3?new oimo_common_Vec3:$.stackVec3[--$.sizeVec3],tt=K.x+i.x*_,it=K.y+i.y*_,ot=K.z+i.z*_;K.x=tt,K.y=it,K.z=ot;var at=K,nt=at.x*v.e00+at.y*v.e01+at.z*v.e02,st=at.x*v.e10+at.y*v.e11+at.z*v.e12,_t=at.x*v.e20+at.y*v.e21+at.z*v.e22;at.x=nt,at.y=st,at.z=_t;var rt=at,et=rt.x+t.x,ht=rt.y+t.y,lt=rt.z+t.z;rt.x=et,rt.y=ht,rt.z=lt,1<=Wt&&Nt.line(b,at,r);var ct=this._pool;if(null!=b){if(b.zero(),ct.sizeVec3==ct.stackVec3.length){for(var mt=ct.sizeVec3<<1,pt=Array(mt),vt=0,Gt=ct.sizeVec3,bt;vt<Gt;)bt=vt++,pt[bt]=ct.stackVec3[bt],ct.stackVec3[bt]=null;ct.stackVec3=pt}ct.stackVec3[ct.sizeVec3++]=b}b=at,e+=.39269908169872375}var Ot=this._pool;if(null!=l){if(l.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var dt=Ot.sizeVec3<<1,xt=Array(dt),ut=0,Ht=Ot.sizeVec3,Mt;ut<Ht;)Mt=ut++,xt[Mt]=Ot.stackVec3[Mt],Ot.stackVec3[Mt]=null;Ot.stackVec3=xt}Ot.stackVec3[Ot.sizeVec3++]=l}var Jt=this._pool;if(null!=m){if(m.x=0,m.y=0,m.z=0,m.w=1,Jt.sizeQuat==Jt.stackQuat.length){for(var zt=Jt.sizeQuat<<1,Yt=Array(zt),Zt=0,Ut=Jt.sizeQuat,Vt;Zt<Ut;)Vt=Zt++,Yt[Vt]=Jt.stackQuat[Vt],Jt.stackQuat[Vt]=null;Jt.stackQuat=Yt}Jt.stackQuat[Jt.sizeQuat++]=m}var Qt=this._pool;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,Qt.sizeMat3==Qt.stackMat3.length){for(var wt=Qt.sizeMat3<<1,Bt=Array(wt),kt=0,Kt=Qt.sizeMat3,Pt;kt<Kt;)Pt=kt++,Bt[Pt]=Qt.stackMat3[Pt],Qt.stackMat3[Pt]=null;Qt.stackMat3=Bt}Qt.stackMat3[Qt.sizeMat3++]=v}var $t=this._pool;if(null!=b){if(b.zero(),$t.sizeVec3==$t.stackVec3.length){for(var Ct=$t.sizeVec3<<1,Tt=Array(Ct),jt=0,to=$t.sizeVec3,qt;jt<to;)qt=jt++,Tt[qt]=$t.stackVec3[qt],$t.stackVec3[qt]=null;$t.stackVec3=Tt}$t.stackVec3[$t.sizeVec3++]=b}},step:function(a){0<this._timeStep.dt&&(this._timeStep.dtRatio=a/this._timeStep.dt),this._timeStep.dt=a,this._timeStep.invDt=1/a;var t=new Date().getTime()/1e3;this._updateContacts(),this._solveIslands();var i=new Date().getTime()/1e3;oimo_dynamics_common_Performance.totalTime=1e3*(i-t)},addRigidBody:function(a){if(null!=a._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=a,this._rigidBodyListLast=a):(this._rigidBodyListLast._next=a,a._prev=this._rigidBodyListLast,this._rigidBodyListLast=a),a._world=this;for(var t=a._shapeList,n;null!=t;)n=t._next,t._proxy=this._broadPhase.createProxy(t,t._aabb),t._id=this._shapeIdCount++,this._numShapes++,t=n;this._numRigidBodies++},removeRigidBody:function(x){if(x._world!=this)throw new Error("The rigid body doesn't belong to the world.");var t=x._prev,i=x._next;null!=t&&(t._next=i),null!=i&&(i._prev=t),x==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),x==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),x._next=null,x._prev=null,x._world=null;for(var o=x._shapeList,g;null!=o;){g=o._next,this._broadPhase.destroyProxy(o._proxy),o._proxy=null,o._id=-1;for(var X=o._rigidBody._contactLinkList;null!=X;){var u=X._next,_=X._contact;if(_._s1==o||_._s2==o){var r=X._other;r._sleeping=!1,r._sleepTime=0;var e=this._contactManager,z=_._prev,l=_._next;if(null!=z&&(z._next=l),null!=l&&(l._prev=z),_==e._contactList&&(e._contactList=e._contactList._next),_==e._contactListLast&&(e._contactListLast=e._contactListLast._prev),_._next=null,_._prev=null,_._touching){var c=_._s1._contactCallback,m=_._s2._contactCallback;c==m&&(m=null),null!=c&&c.endContact(_),null!=m&&m.endContact(_)}var Y=_._link1._prev,v=_._link1._next;null!=Y&&(Y._next=v),null!=v&&(v._prev=Y),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;var y=_._link2._prev,b=_._link2._next;null!=y&&(y._next=b),null!=b&&(b._prev=y),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;var f=_._contactConstraint;f._s1=null,f._s2=null,f._b1=null,f._b2=null,f._tf1=null,f._tf2=null,_._next=e._contactPool,e._contactPool=_,e._numContacts--}X=u}this._numShapes--,o=g}this._numRigidBodies--},addJoint:function(a){if(null!=a._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=a,this._jointListLast=a):(this._jointListLast._next=a,a._prev=this._jointListLast,this._jointListLast=a),a._world=this,a._link1._other=a._b2,a._link2._other=a._b1,null==a._b1._jointLinkList?(a._b1._jointLinkList=a._link1,a._b1._jointLinkListLast=a._link1):(a._b1._jointLinkListLast._next=a._link1,a._link1._prev=a._b1._jointLinkListLast,a._b1._jointLinkListLast=a._link1),null==a._b2._jointLinkList?(a._b2._jointLinkList=a._link2,a._b2._jointLinkListLast=a._link2):(a._b2._jointLinkListLast._next=a._link2,a._link2._prev=a._b2._jointLinkListLast,a._b2._jointLinkListLast=a._link2),a._b1._numJointLinks++,a._b2._numJointLinks++;var t=a._b1;t._sleeping=!1,t._sleepTime=0;var i=a._b2;i._sleeping=!1,i._sleepTime=0,a._syncAnchors(),this._numJoints++},removeJoint:function(l){if(l._world!=this)throw new Error("The joint doesn't belong to the world.");var t=l._prev,i=l._next;null!=t&&(t._next=i),null!=i&&(i._prev=t),l==this._jointList&&(this._jointList=this._jointList._next),l==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),l._next=null,l._prev=null,l._world=null;var o=l._link1._prev,a=l._link1._next;null!=o&&(o._next=a),null!=a&&(a._prev=o),l._link1==l._b1._jointLinkList&&(l._b1._jointLinkList=l._b1._jointLinkList._next),l._link1==l._b1._jointLinkListLast&&(l._b1._jointLinkListLast=l._b1._jointLinkListLast._prev),l._link1._next=null,l._link1._prev=null;var n=l._link2._prev,s=l._link2._next;null!=n&&(n._next=s),null!=s&&(s._prev=n),l._link2==l._b2._jointLinkList&&(l._b2._jointLinkList=l._b2._jointLinkList._next),l._link2==l._b2._jointLinkListLast&&(l._b2._jointLinkListLast=l._b2._jointLinkListLast._prev),l._link2._next=null,l._link2._prev=null,l._link1._other=null,l._link2._other=null,l._b1._numJointLinks--,l._b2._numJointLinks--;var _=l._b1;_._sleeping=!1,_._sleepTime=0;var r=l._b2;r._sleeping=!1,r._sleepTime=0,this._numJoints--},setDebugDraw:function(o){this._debugDraw=o},getDebugDraw:function(){return this._debugDraw},debugDraw:function(){if(null!=this._debugDraw){if(2==this._broadPhase._type){var o=this._broadPhase;this._drawBvh(this._debugDraw,o._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}},rayCast:function(_,t,i){var o=this._rayCastWrapper.begin;o.x=_.x,o.y=_.y,o.z=_.z;var a=this._rayCastWrapper.end;a.x=t.x,a.y=t.y,a.z=t.z,this._rayCastWrapper.callback=i,this._broadPhase.rayCast(_,t,this._rayCastWrapper)},convexCast:function(_,t,i,o){this._convexCastWrapper.convex=_;var a=this._convexCastWrapper.begin;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22;var n=this._convexCastWrapper.translation;n.x=i.x,n.y=i.y,n.z=i.z,this._convexCastWrapper.callback=o,this._broadPhase.convexCast(_,t,i,this._convexCastWrapper)},aabbTest:function(o,t){this._aabbTestWrapper._aabb.copyFrom(o),this._aabbTestWrapper._callback=t,this._broadPhase.aabbTest(o,this._aabbTestWrapper)},getRigidBodyList:function(){return this._rigidBodyList},getJointList:function(){return this._jointList},getBroadPhase:function(){return this._broadPhase},getContactManager:function(){return this._contactManager},getNumRigidBodies:function(){return this._numRigidBodies},getNumJoints:function(){return this._numJoints},getNumShapes:function(){return this._numShapes},getNumIslands:function(){return this._numIslands},getNumVelocityIterations:function(){return this._numVelocityIterations},setNumVelocityIterations:function(o){this._numVelocityIterations=o},getNumPositionIterations:function(){return this._numPositionIterations},setNumPositionIterations:function(o){this._numPositionIterations=o},getGravity:function(){return this._gravity},setGravity:function(o){var t=this._gravity;t.x=o.x,t.y=o.y,t.z=o.z}};var oimo_dynamics__$World_RayCastWrapper=function(){oimo_collision_broadphase_BroadPhaseProxyCallback.call(this),this.rayCastHit=new oimo_collision_geometry_RayCastHit,this.begin=new oimo_common_Vec3,this.end=new oimo_common_Vec3,this.callback=null};oimo_dynamics__$World_RayCastWrapper.__super__=oimo_collision_broadphase_BroadPhaseProxyCallback,oimo_dynamics__$World_RayCastWrapper.prototype=$extend(oimo_collision_broadphase_BroadPhaseProxyCallback.prototype,{process:function(o){var t=o.userData;t._geom.rayCast(this.begin,this.end,t._transform,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}});var oimo_dynamics__$World_ConvexCastWrapper=function(){oimo_collision_broadphase_BroadPhaseProxyCallback.call(this),this.rayCastHit=new oimo_collision_geometry_RayCastHit,this.begin=new oimo_common_Transform,this.translation=new oimo_common_Vec3,this.zero=new oimo_common_Vec3,this.callback=null,this.convex=null};oimo_dynamics__$World_ConvexCastWrapper.__super__=oimo_collision_broadphase_BroadPhaseProxyCallback,oimo_dynamics__$World_ConvexCastWrapper.prototype=$extend(oimo_collision_broadphase_BroadPhaseProxyCallback.prototype,{process:function(n){var t=n.userData,i=t._geom._type;if(!(0>i||5<i)){var o=t._geom;oimo_collision_narrowphase_detector_gjkepa_GjkEpa.instance.convexCast(this.convex,o,this.begin,t._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}}});var oimo_dynamics__$World_AabbTestWrapper=function(){oimo_collision_broadphase_BroadPhaseProxyCallback.call(this),this._aabb=new oimo_collision_geometry_Aabb,this._callback=null};oimo_dynamics__$World_AabbTestWrapper.__super__=oimo_collision_broadphase_BroadPhaseProxyCallback,oimo_dynamics__$World_AabbTestWrapper.prototype=$extend(oimo_collision_broadphase_BroadPhaseProxyCallback.prototype,{process:function(a){var t=a.userData,i=t._aabb;i._minX<this._aabb._maxX&&i._maxX>this._aabb._minX&&i._minY<this._aabb._maxY&&i._maxY>this._aabb._minY&&i._minZ<this._aabb._maxZ&&i._maxZ>this._aabb._minZ&&this._callback.process(t)}});var oimo_dynamics_callback_AabbTestCallback=function(){};oimo_dynamics_callback_AabbTestCallback.prototype={process:function(){}};var oimo_dynamics_callback_ContactCallback=function(){};oimo_dynamics_callback_ContactCallback.prototype={beginContact:function(){},preSolve:function(){},postSolve:function(){},endContact:function(){}};var oimo_dynamics_callback_RayCastCallback=function(){};oimo_dynamics_callback_RayCastCallback.prototype={process:function(){}};var oimo_dynamics_callback_RayCastClosest=function(){oimo_dynamics_callback_RayCastCallback.call(this),this.position=new oimo_common_Vec3,this.normal=new oimo_common_Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1};oimo_dynamics_callback_RayCastClosest.__super__=oimo_dynamics_callback_RayCastCallback,oimo_dynamics_callback_RayCastClosest.prototype=$extend(oimo_dynamics_callback_RayCastCallback.prototype,{clear:function(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1},process:function(_,t){if(t.fraction<this.fraction){this.shape=_,this.hit=!0,this.fraction=t.fraction;var i=this.position,o=t.position;i.x=o.x,i.y=o.y,i.z=o.z;var a=this.normal,n=t.normal;a.x=n.x,a.y=n.y,a.z=n.z}}});var oimo_dynamics_common_DebugDraw=function(){this.p=new oimo_common_Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var z=[,,,,,];this.sphereCoords=z;var t=[,,,,,];this.tmpSphereVerts=t;var i=[,,,,,];this.tmpSphereNorms=i;for(var o=0;5>o;){var Y=o++,n=0==Y||4==Y?1:8,s=this.sphereCoords,_=Array(n);s[Y]=_;var r=this.tmpSphereVerts,e=Array(n);r[Y]=e;var Z=this.tmpSphereNorms,l=Array(n);Z[Y]=l;for(var c=0;8>c;){var I=c++,p=.7853981633974475*Y,v=.7853981633974475*I;this.sphereCoords[Y][I]=new oimo_common_Vec3(Math.sin(p)*Math.cos(v),Math.cos(p),-Math.sin(p)*Math.sin(v)),this.tmpSphereVerts[Y][I]=new oimo_common_Vec3,this.tmpSphereNorms[Y][I]=new oimo_common_Vec3}}var y=Array(8);this.circleCoords=y;var b=Array(8);this.circleCoordsShift=b;var f=Array(8);this.tmpCircleVerts1=f;var d=Array(8);this.tmpCircleVerts2=d;var x=Array(8);this.tmpCircleNorms=x;for(var u=.7853981633974475,g=0,h;8>g;)h=g++,this.circleCoords[h]=new oimo_common_Vec3(Math.cos(h*u),0,-Math.sin(h*u)),this.circleCoordsShift[h]=new oimo_common_Vec3(Math.cos((h+.5)*u),0,-Math.sin((h+.5)*u)),this.tmpCircleVerts1[h]=new oimo_common_Vec3,this.tmpCircleVerts2[h]=new oimo_common_Vec3,this.tmpCircleNorms[h]=new oimo_common_Vec3;this.style=new oimo_dynamics_common_DebugDrawStyle};oimo_dynamics_common_DebugDraw.prototype={aabb:function(pt,t,i){var o=this.p,a=(0==o.sizeVec3?new oimo_common_Vec3:o.stackVec3[--o.sizeVec3]).init(pt.x,pt.y,pt.z),n=this.p,s=(0==n.sizeVec3?new oimo_common_Vec3:n.stackVec3[--n.sizeVec3]).init(pt.x,pt.y,t.z),_=this.p,r=(0==_.sizeVec3?new oimo_common_Vec3:_.stackVec3[--_.sizeVec3]).init(pt.x,t.y,pt.z),e=this.p,h=(0==e.sizeVec3?new oimo_common_Vec3:e.stackVec3[--e.sizeVec3]).init(pt.x,t.y,t.z),l=this.p,c=(0==l.sizeVec3?new oimo_common_Vec3:l.stackVec3[--l.sizeVec3]).init(t.x,pt.y,pt.z),m=this.p,p=(0==m.sizeVec3?new oimo_common_Vec3:m.stackVec3[--m.sizeVec3]).init(t.x,pt.y,t.z),v=this.p,y=(0==v.sizeVec3?new oimo_common_Vec3:v.stackVec3[--v.sizeVec3]).init(t.x,t.y,pt.z),b=this.p,f=(0==b.sizeVec3?new oimo_common_Vec3:b.stackVec3[--b.sizeVec3]).init(t.x,t.y,t.z);this.line(a,s,i),this.line(r,h,i),this.line(c,p,i),this.line(y,f,i),this.line(a,r,i),this.line(s,h,i),this.line(c,y,i),this.line(p,f,i),this.line(a,c,i),this.line(s,p,i),this.line(r,y,i),this.line(h,f,i);var d=this.p;if(null!=a){if(a.zero(),d.sizeVec3==d.stackVec3.length){for(var x=d.sizeVec3<<1,u=Array(x),g=0,bt=d.sizeVec3,X;g<bt;)X=g++,u[X]=d.stackVec3[X],d.stackVec3[X]=null;d.stackVec3=u}d.stackVec3[d.sizeVec3++]=a}var xt=this.p;if(null!=s){if(s.zero(),xt.sizeVec3==xt.stackVec3.length){for(var Y=xt.sizeVec3<<1,Z=Array(Y),I=0,dt=xt.sizeVec3,L;I<dt;)L=I++,Z[L]=xt.stackVec3[L],xt.stackVec3[L]=null;xt.stackVec3=Z}xt.stackVec3[xt.sizeVec3++]=s}var yt=this.p;if(null!=r){if(r.zero(),yt.sizeVec3==yt.stackVec3.length){for(var B=yt.sizeVec3<<1,k=Array(B),A=0,ft=yt.sizeVec3,S;A<ft;)S=A++,k[S]=yt.stackVec3[S],yt.stackVec3[S]=null;yt.stackVec3=k}yt.stackVec3[yt.sizeVec3++]=r}var gt=this.p;if(null!=h){if(h.zero(),gt.sizeVec3==gt.stackVec3.length){for(var T=gt.sizeVec3<<1,j=Array(T),R=0,vt=gt.sizeVec3,E;R<vt;)E=R++,j[E]=gt.stackVec3[E],gt.stackVec3[E]=null;gt.stackVec3=j}gt.stackVec3[gt.sizeVec3++]=h}var Xt=this.p;if(null!=c){if(c.zero(),Xt.sizeVec3==Xt.stackVec3.length){for(var J=Xt.sizeVec3<<1,F=Array(J),N=0,ut=Xt.sizeVec3,O;N<ut;)O=N++,F[O]=Xt.stackVec3[O],Xt.stackVec3[O]=null;Xt.stackVec3=F}Xt.stackVec3[Xt.sizeVec3++]=c}var zt=this.p;if(null!=p){if(p.zero(),zt.sizeVec3==zt.stackVec3.length){for(var U=zt.sizeVec3<<1,H=Array(U),Q=0,Yt=zt.sizeVec3,K;Q<Yt;)K=Q++,H[K]=zt.stackVec3[K],zt.stackVec3[K]=null;zt.stackVec3=H}zt.stackVec3[zt.sizeVec3++]=p}var Zt=this.p;if(null!=y){if(y.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var it=Zt.sizeVec3<<1,ot=Array(it),at=0,It=Zt.sizeVec3,st;at<It;)st=at++,ot[st]=Zt.stackVec3[st],Zt.stackVec3[st]=null;Zt.stackVec3=ot}Zt.stackVec3[Zt.sizeVec3++]=y}var Mt=this.p;if(null!=f){if(f.zero(),Mt.sizeVec3==Mt.stackVec3.length){for(var rt=Mt.sizeVec3<<1,et=Array(rt),ht=0,Vt=Mt.sizeVec3,ct;ht<Vt;)ct=ht++,et[ct]=Mt.stackVec3[ct],Mt.stackVec3[ct]=null;Mt.stackVec3=et}Mt.stackVec3[Mt.sizeVec3++]=f}},basis:function(bt,t,i,o,a){var n=this.p,s=0==n.sizeVec3?new oimo_common_Vec3:n.stackVec3[--n.sizeVec3],_=this.p,r=0==_.sizeMat3?new oimo_common_Mat3:_.stackMat3[--_.sizeMat3],e=this.p,h=0==e.sizeVec3?new oimo_common_Vec3:e.stackVec3[--e.sizeVec3],l=this.p,c=0==l.sizeVec3?new oimo_common_Vec3:l.stackVec3[--l.sizeVec3],m=this.p,p=0==m.sizeVec3?new oimo_common_Vec3:m.stackVec3[--m.sizeVec3],v=s;v.x=bt._positionX,v.y=bt._positionY,v.z=bt._positionZ;var y=r;y.e00=bt._rotation00,y.e01=bt._rotation01,y.e02=bt._rotation02,y.e10=bt._rotation10,y.e11=bt._rotation11,y.e12=bt._rotation12,y.e20=bt._rotation20,y.e21=bt._rotation21,y.e22=bt._rotation22,h.init(r.e00,r.e10,r.e20),c.init(r.e01,r.e11,r.e21),p.init(r.e02,r.e12,r.e22);var b=h.x*t,f=h.y*t,d=h.z*t;h.x=b,h.y=f,h.z=d;var x=h,u=x.x+s.x,g=x.y+s.y,M=x.z+s.z;x.x=u,x.y=g,x.z=M;var X=c.x*t,z=c.y*t,Y=c.z*t;c.x=X,c.y=z,c.z=Y;var Z=c,I=Z.x+s.x,V=Z.y+s.y,L=Z.z+s.z;Z.x=I,Z.y=V,Z.z=L;var w=p.x*t,B=p.y*t,k=p.z*t;p.x=w,p.y=B,p.z=k;var A=p,P=A.x+s.x,S=A.y+s.y,C=A.z+s.z;A.x=P,A.y=S,A.z=C,this.line(s,h,i),this.line(s,c,o),this.line(s,p,a);var T=this.p;if(null!=s){if(s.zero(),T.sizeVec3==T.stackVec3.length){for(var j=T.sizeVec3<<1,R=Array(j),q=0,xt=T.sizeVec3,D;q<xt;)D=q++,R[D]=T.stackVec3[D],T.stackVec3[D]=null;T.stackVec3=R}T.stackVec3[T.sizeVec3++]=s}var dt=this.p;if(null!=r){if(r.e00=1,r.e01=0,r.e02=0,r.e10=0,r.e11=1,r.e12=0,r.e20=0,r.e21=0,r.e22=1,dt.sizeMat3==dt.stackMat3.length){for(var F=dt.sizeMat3<<1,N=Array(F),G=0,yt=dt.sizeMat3,W;G<yt;)W=G++,N[W]=dt.stackMat3[W],dt.stackMat3[W]=null;dt.stackMat3=N}dt.stackMat3[dt.sizeMat3++]=r}var ft=this.p;if(null!=h){if(h.zero(),ft.sizeVec3==ft.stackVec3.length){for(var H=ft.sizeVec3<<1,Q=Array(H),$=0,gt=ft.sizeVec3,tt;$<gt;)tt=$++,Q[tt]=ft.stackVec3[tt],ft.stackVec3[tt]=null;ft.stackVec3=Q}ft.stackVec3[ft.sizeVec3++]=h}var vt=this.p;if(null!=c){if(c.zero(),vt.sizeVec3==vt.stackVec3.length){for(var ot=vt.sizeVec3<<1,at=Array(ot),nt=0,Xt=vt.sizeVec3,_t;nt<Xt;)_t=nt++,at[_t]=vt.stackVec3[_t],vt.stackVec3[_t]=null;vt.stackVec3=at}vt.stackVec3[vt.sizeVec3++]=c}var ut=this.p;if(null!=p){if(p.zero(),ut.sizeVec3==ut.stackVec3.length){for(var et=ut.sizeVec3<<1,zt=Array(et),lt=0,Yt=ut.sizeVec3,mt;lt<Yt;)mt=lt++,zt[mt]=ut.stackVec3[mt],ut.stackVec3[mt]=null;ut.stackVec3=zt}ut.stackVec3[ut.sizeVec3++]=p}},ellipse:function(_,t,i,o,a,n){this.arc(_,t,i,o,a,0,6.28318530717958,!1,n)},arc:function(Xt,t,zt,Yt,a,n,s,_,r){var e=this.p,h=0==e.sizeVec3?new oimo_common_Vec3:e.stackVec3[--e.sizeVec3];h.x=t.x,h.y=t.y,h.z=t.z;var l=h,c=l.x*Yt,m=l.y*Yt,p=l.z*Yt;l.x=c,l.y=m,l.z=p,t=l;var v=this.p,y=0==v.sizeVec3?new oimo_common_Vec3:v.stackVec3[--v.sizeVec3];y.x=zt.x,y.y=zt.y,y.z=zt.z;var b=y,f=b.x*a,d=b.y*a,x=b.z*a;b.x=f,b.y=d,b.z=x,zt=b;var u=s-n;0>u&&(u=-u);var Zt=0|u/.5235987755982984+.5;0==Zt&&(Zt=1);var It=n,Vt=(s-n)/Zt,z=this.p,Y=0==z.sizeVec3?new oimo_common_Vec3:z.stackVec3[--z.sizeVec3];Y.x=Xt.x,Y.y=Xt.y,Y.z=Xt.z;var Z=Y,I=Math.cos(It),V=Z.x+t.x*I,L=Z.y+t.y*I,w=Z.z+t.z*I;Z.x=V,Z.y=L,Z.z=w;var B=Z,k=Math.sin(It),A=B.x+zt.x*k,P=B.y+zt.y*k,S=B.z+zt.z*k;B.x=A,B.y=P,B.z=S;var C=B;_&&this.line(Xt,C,r);for(var Lt=0,Bt=Zt;Lt<Bt;){Lt++,It+=Vt;var R=this.p,q=0==R.sizeVec3?new oimo_common_Vec3:R.stackVec3[--R.sizeVec3];q.x=Xt.x,q.y=Xt.y,q.z=Xt.z;var E=q,D=Math.cos(It),J=E.x+t.x*D,F=E.y+t.y*D,N=E.z+t.z*D;E.x=J,E.y=F,E.z=N;var G=E,O=Math.sin(It),W=G.x+zt.x*O,U=G.y+zt.y*O,H=G.z+zt.z*O;G.x=W,G.y=U,G.z=H;var Q=G;this.line(C,Q,r);var $=this.p;if(null!=C){if(C.zero(),$.sizeVec3==$.stackVec3.length){for(var K=$.sizeVec3<<1,tt=Array(K),it=0,kt=$.sizeVec3,at;it<kt;)at=it++,tt[at]=$.stackVec3[at],$.stackVec3[at]=null;$.stackVec3=tt}$.stackVec3[$.sizeVec3++]=C}C=Q}_&&this.line(Xt,C,r);var At=this.p;if(null!=C){if(C.zero(),At.sizeVec3==At.stackVec3.length){for(var st=At.sizeVec3<<1,_t=Array(st),rt=0,Pt=At.sizeVec3,ht;rt<Pt;)ht=rt++,_t[ht]=At.stackVec3[ht],At.stackVec3[ht]=null;At.stackVec3=_t}At.stackVec3[At.sizeVec3++]=C}var Tt=this.p;if(null!=t){if(t.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var ct=Tt.sizeVec3<<1,mt=Array(ct),pt=0,wt=Tt.sizeVec3,yt;pt<wt;)yt=pt++,mt[yt]=Tt.stackVec3[yt],Tt.stackVec3[yt]=null;Tt.stackVec3=mt}Tt.stackVec3[Tt.sizeVec3++]=t}var St=this.p;if(null!=zt){if(zt.zero(),St.sizeVec3==St.stackVec3.length){for(var ft=St.sizeVec3<<1,dt=Array(ft),xt=0,Ct=St.sizeVec3,gt;xt<Ct;)gt=xt++,dt[gt]=St.stackVec3[gt],St.stackVec3[gt]=null;St.stackVec3=dt}St.stackVec3[St.sizeVec3++]=zt}},cone:function(Wo,t,i,o){var a=this.p,n=0==a.sizeVec3?new oimo_common_Vec3:a.stackVec3[--a.sizeVec3],s=this.p,_=0==s.sizeVec3?new oimo_common_Vec3:s.stackVec3[--s.sizeVec3],r=this.p,e=0==r.sizeVec3?new oimo_common_Vec3:r.stackVec3[--r.sizeVec3],h=this.p,l=0==h.sizeVec3?new oimo_common_Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeMat3?new oimo_common_Mat3:c.stackMat3[--c.sizeMat3],p=l;p.x=Wo._positionX,p.y=Wo._positionY,p.z=Wo._positionZ;var v=m;v.e00=Wo._rotation00,v.e01=Wo._rotation01,v.e02=Wo._rotation02,v.e10=Wo._rotation10,v.e11=Wo._rotation11,v.e12=Wo._rotation12,v.e20=Wo._rotation20,v.e21=Wo._rotation21,v.e22=Wo._rotation22,n.init(m.e00,m.e10,m.e20),_.init(m.e01,m.e11,m.e21),e.init(m.e02,m.e12,m.e22);var y=this.p,b=0==y.sizeVec3?new oimo_common_Vec3:y.stackVec3[--y.sizeVec3];b.x=l.x,b.y=l.y,b.z=l.z;var f=b,d=f.x+_.x*i,x=f.y+_.y*i,u=f.z+_.z*i;f.x=d,f.y=x,f.z=u;var g=f,M=this.p,X=0==M.sizeVec3?new oimo_common_Vec3:M.stackVec3[--M.sizeVec3];X.x=l.x,X.y=l.y,X.z=l.z;var z=X,Y=-i,Z=z.x+_.x*Y,I=z.y+_.y*Y,V=z.z+_.z*Y;z.x=Z,z.y=I,z.z=V;var L=z;if(this.wireframe){var w=this.p,B=0==w.sizeVec3?new oimo_common_Vec3:w.stackVec3[--w.sizeVec3];B.x=L.x,B.y=L.y,B.z=L.z;var k=B,A=-t,P=k.x+n.x*A,S=k.y+n.y*A,C=k.z+n.z*A;k.x=P,k.y=S,k.z=C;var T=k,j=T.x+0*e.x,R=T.y+0*e.y,q=T.z+0*e.z;T.x=j,T.y=R,T.z=q;var E=T,D=this.p,J=0==D.sizeVec3?new oimo_common_Vec3:D.stackVec3[--D.sizeVec3];J.x=L.x,J.y=L.y,J.z=L.z;var F=J,N=F.x+n.x*t,G=F.y+n.y*t,O=F.z+n.z*t;F.x=N,F.y=G,F.z=O;var W=F,U=W.x+0*e.x,H=W.y+0*e.y,Q=W.z+0*e.z;W.x=U,W.y=H,W.z=Q;var $=W,K=this.p,tt=0==K.sizeVec3?new oimo_common_Vec3:K.stackVec3[--K.sizeVec3];tt.x=L.x,tt.y=L.y,tt.z=L.z;var it=tt,ot=it.x+0*n.x,at=it.y+0*n.y,nt=it.z+0*n.z;it.x=ot,it.y=at,it.z=nt;var st=it,_t=-t,rt=st.x+e.x*_t,et=st.y+e.y*_t,ht=st.z+e.z*_t;st.x=rt,st.y=et,st.z=ht;var lt=st,ct=this.p,mt=0==ct.sizeVec3?new oimo_common_Vec3:ct.stackVec3[--ct.sizeVec3];mt.x=L.x,mt.y=L.y,mt.z=L.z;var pt=mt,vt=pt.x+0*n.x,yt=pt.y+0*n.y,bt=pt.z+0*n.z;pt.x=vt,pt.y=yt,pt.z=bt;var ft=pt,dt=ft.x+e.x*t,xt=ft.y+e.y*t,ut=ft.z+e.z*t;ft.x=dt,ft.y=xt,ft.z=ut;var gt=ft;this.ellipse(L,n,e,t,t,o),this.line(g,E,o),this.line(g,$,o),this.line(g,lt,o),this.line(g,gt,o);var Mt=this.p;if(null!=E){if(E.zero(),Mt.sizeVec3==Mt.stackVec3.length){for(var Xt=Mt.sizeVec3<<1,zt=Array(Xt),Yt=0,Go=Mt.sizeVec3,It;Yt<Go;)It=Yt++,zt[It]=Mt.stackVec3[It],Mt.stackVec3[It]=null;Mt.stackVec3=zt}Mt.stackVec3[Mt.sizeVec3++]=E}var Oo=this.p;if(null!=$){if($.zero(),Oo.sizeVec3==Oo.stackVec3.length){for(var Lt=Oo.sizeVec3<<1,wt=Array(Lt),Bt=0,Ho=Oo.sizeVec3,At;Bt<Ho;)At=Bt++,wt[At]=Oo.stackVec3[At],Oo.stackVec3[At]=null;Oo.stackVec3=wt}Oo.stackVec3[Oo.sizeVec3++]=$}var Uo=this.p;if(null!=lt){if(lt.zero(),Uo.sizeVec3==Uo.stackVec3.length){for(var St=Uo.sizeVec3<<1,Ct=Array(St),Tt=0,Qo=Uo.sizeVec3,Rt;Tt<Qo;)Rt=Tt++,Ct[Rt]=Uo.stackVec3[Rt],Uo.stackVec3[Rt]=null;Uo.stackVec3=Ct}Uo.stackVec3[Uo.sizeVec3++]=lt}var Ko=this.p;if(null!=gt){if(gt.zero(),Ko.sizeVec3==Ko.stackVec3.length){for(var Et=Ko.sizeVec3<<1,Dt=Array(Et),Jt=0,$o=Ko.sizeVec3,Nt;Jt<$o;)Nt=Jt++,Dt[Nt]=Ko.stackVec3[Nt],Ko.stackVec3[Nt]=null;Ko.stackVec3=Dt}Ko.stackVec3[Ko.sizeVec3++]=gt}}else{for(var ta=1/Math.sqrt(t*t+4*i*i),Ot=2*i*ta,Wt=t*ta,Ut=(Math.sqrt(2*(1+Ot)),0);8>Ut;){var oa=Ut++,Qt=this.tmpCircleNorms[oa],$t=this.circleCoords[oa];Qt.x=$t.x,Qt.y=$t.y,Qt.z=$t.z;var Kt=Qt,aa=Kt.x*Ot,ia=Kt.y*Ot,na=Kt.z*Ot;Kt.x=aa,Kt.y=ia,Kt.z=na,Kt.y+=Wt;var _a=this.tmpCircleNorms[oa],ea=_a.x*m.e00+_a.y*m.e01+_a.z*m.e02,ra=_a.x*m.e10+_a.y*m.e11+_a.z*m.e12,sa=_a.x*m.e20+_a.y*m.e21+_a.z*m.e22;_a.x=ea,_a.y=ra,_a.z=sa;var la=this.tmpCircleVerts1[oa],ca=this.circleCoordsShift[oa];la.x=ca.x,la.y=ca.y,la.z=ca.z;var pa=la,ma=pa.x*Ot,ba=pa.y*Ot,xa=pa.z*Ot;pa.x=ma,pa.y=ba,pa.z=xa,pa.y+=Wt;var da=this.tmpCircleVerts1[oa],ya=da.x*m.e00+da.y*m.e01+da.z*m.e02,fa=da.x*m.e10+da.y*m.e11+da.z*m.e12,ga=da.x*m.e20+da.y*m.e21+da.z*m.e22;da.x=ya,da.y=fa,da.z=ga;var va=this.tmpCircleVerts2[oa],Xa=this.circleCoords[oa];va.x=Xa.x,va.y=Xa.y,va.z=Xa.z;var ua=va,za=ua.x*m.e00+ua.y*m.e01+ua.z*m.e02,Ya=ua.x*m.e10+ua.y*m.e11+ua.z*m.e12,Za=ua.x*m.e20+ua.y*m.e21+ua.z*m.e22;ua.x=za,ua.y=Ya,ua.z=Za;var Ia=ua,Ma=Ia.x*t,ha=Ia.y*t,Va=Ia.z*t;Ia.x=Ma,Ia.y=ha,Ia.z=Va;var La=Ia,Ba=La.x+l.x,ka=La.y+l.y,Aa=La.z+l.z;La.x=Ba,La.y=ka,La.z=Aa;var Pa=this.tmpCircleVerts2[oa],Ta=-i,wa=Pa.x+_.x*Ta,Sa=Pa.y+_.y*Ta,Ca=Pa.z+_.z*Ta;Pa.x=wa,Pa.y=Sa,Pa.z=Ca}for(var qa=0;8>qa;){var Ra=qa++,Ea=g,ja=this.tmpCircleVerts2[Ra],Na=this.tmpCircleVerts2[(Ra+1)%8],Fa=this.tmpCircleVerts1[Ra],Da=this.tmpCircleNorms[Ra],Wa=this.tmpCircleNorms[(Ra+1)%8];this.triangle(Ea,ja,Na,Fa,Da,Wa,o),Ea=L,ja=this.tmpCircleVerts2[(Ra+1)%8],Na=this.tmpCircleVerts2[Ra];var Ga=this.p,Oa=0==Ga.sizeVec3?new oimo_common_Vec3:Ga.stackVec3[--Ga.sizeVec3];Oa.x=_.x,Oa.y=_.y,Oa.z=_.z;var Ha=Oa,Ja=-Ha.x,Ua=-Ha.y,Qa=-Ha.z;Ha.x=Ja,Ha.y=Ua,Ha.z=Qa,Fa=Ha,this.triangle(Ea,ja,Na,Fa,Fa,Fa,o);var Ka=this.p;if(null!=Fa){if(Fa.zero(),Ka.sizeVec3==Ka.stackVec3.length){for(var $a=Ka.sizeVec3<<1,ti=Array($a),oi=0,ai=Ka.sizeVec3,io;oi<ai;)io=oi++,ti[io]=Ka.stackVec3[io],Ka.stackVec3[io]=null;Ka.stackVec3=ti}Ka.stackVec3[Ka.sizeVec3++]=Fa}}}var ii=this.p;if(null!=g){if(g.zero(),ii.sizeVec3==ii.stackVec3.length){for(var ao=ii.sizeVec3<<1,no=Array(ao),so=0,ni=ii.sizeVec3,ro;so<ni;)ro=so++,no[ro]=ii.stackVec3[ro],ii.stackVec3[ro]=null;ii.stackVec3=no}ii.stackVec3[ii.sizeVec3++]=g}var _i=this.p;if(null!=L){if(L.zero(),_i.sizeVec3==_i.stackVec3.length){for(var ho=_i.sizeVec3<<1,lo=Array(ho),co=0,ei=_i.sizeVec3,po;co<ei;)po=co++,lo[po]=_i.stackVec3[po],_i.stackVec3[po]=null;_i.stackVec3=lo}_i.stackVec3[_i.sizeVec3++]=L}var ri=this.p;if(null!=l){if(l.zero(),ri.sizeVec3==ri.stackVec3.length){for(var yo=ri.sizeVec3<<1,bo=Array(yo),fo=0,si=ri.sizeVec3,uo;fo<si;)uo=fo++,bo[uo]=ri.stackVec3[uo],ri.stackVec3[uo]=null;ri.stackVec3=bo}ri.stackVec3[ri.sizeVec3++]=l}var li=this.p;if(null!=m){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,li.sizeMat3==li.stackMat3.length){for(var Mo=li.sizeMat3<<1,Xo=Array(Mo),zo=0,ci=li.sizeMat3,Zo;zo<ci;)Zo=zo++,Xo[Zo]=li.stackMat3[Zo],li.stackMat3[Zo]=null;li.stackMat3=Xo}li.stackMat3[li.sizeMat3++]=m}var pi=this.p;if(null!=n){if(n.zero(),pi.sizeVec3==pi.stackVec3.length){for(var Vo=pi.sizeVec3<<1,Lo=Array(Vo),wo=0,mi=pi.sizeVec3,ko;wo<mi;)ko=wo++,Lo[ko]=pi.stackVec3[ko],pi.stackVec3[ko]=null;pi.stackVec3=Lo}pi.stackVec3[pi.sizeVec3++]=n}var bi=this.p;if(null!=_){if(_.zero(),bi.sizeVec3==bi.stackVec3.length){for(var Po=bi.sizeVec3<<1,So=Array(Po),Co=0,xi=bi.sizeVec3,jo;Co<xi;)jo=Co++,So[jo]=bi.stackVec3[jo],bi.stackVec3[jo]=null;bi.stackVec3=So}bi.stackVec3[bi.sizeVec3++]=_}var di=this.p;if(null!=e){if(e.zero(),di.sizeVec3==di.stackVec3.length){for(var qo=di.sizeVec3<<1,Eo=Array(qo),Do=0,yi=di.sizeVec3,Fo;Do<yi;)Fo=Do++,Eo[Fo]=di.stackVec3[Fo],di.stackVec3[Fo]=null;di.stackVec3=Eo}di.stackVec3[di.sizeVec3++]=e}},cylinder:function(Wa,t,i,o){var a=this.p,n=0==a.sizeVec3?new oimo_common_Vec3:a.stackVec3[--a.sizeVec3],s=this.p,_=0==s.sizeVec3?new oimo_common_Vec3:s.stackVec3[--s.sizeVec3],r=this.p,e=0==r.sizeVec3?new oimo_common_Vec3:r.stackVec3[--r.sizeVec3],h=this.p,l=0==h.sizeVec3?new oimo_common_Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeMat3?new oimo_common_Mat3:c.stackMat3[--c.sizeMat3],p=l;p.x=Wa._positionX,p.y=Wa._positionY,p.z=Wa._positionZ;var v=m;v.e00=Wa._rotation00,v.e01=Wa._rotation01,v.e02=Wa._rotation02,v.e10=Wa._rotation10,v.e11=Wa._rotation11,v.e12=Wa._rotation12,v.e20=Wa._rotation20,v.e21=Wa._rotation21,v.e22=Wa._rotation22,n.init(m.e00,m.e10,m.e20),_.init(m.e01,m.e11,m.e21),e.init(m.e02,m.e12,m.e22);var y=this.p,b=0==y.sizeVec3?new oimo_common_Vec3:y.stackVec3[--y.sizeVec3];b.x=l.x,b.y=l.y,b.z=l.z;var f=b,d=f.x+_.x*i,x=f.y+_.y*i,u=f.z+_.z*i;f.x=d,f.y=x,f.z=u;var g=f,M=this.p,X=0==M.sizeVec3?new oimo_common_Vec3:M.stackVec3[--M.sizeVec3];X.x=l.x,X.y=l.y,X.z=l.z;var z=X,Y=-i,Z=z.x+_.x*Y,I=z.y+_.y*Y,V=z.z+_.z*Y;z.x=Z,z.y=I,z.z=V;var L=z;if(this.wireframe){var w=this.p,B=0==w.sizeVec3?new oimo_common_Vec3:w.stackVec3[--w.sizeVec3];B.x=g.x,B.y=g.y,B.z=g.z;var k=B,A=-t,P=k.x+n.x*A,S=k.y+n.y*A,C=k.z+n.z*A;k.x=P,k.y=S,k.z=C;var T=k,j=T.x+0*e.x,R=T.y+0*e.y,q=T.z+0*e.z;T.x=j,T.y=R,T.z=q;var E=T,D=this.p,J=0==D.sizeVec3?new oimo_common_Vec3:D.stackVec3[--D.sizeVec3];J.x=g.x,J.y=g.y,J.z=g.z;var F=J,N=F.x+n.x*t,G=F.y+n.y*t,O=F.z+n.z*t;F.x=N,F.y=G,F.z=O;var W=F,U=W.x+0*e.x,H=W.y+0*e.y,Q=W.z+0*e.z;W.x=U,W.y=H,W.z=Q;var $=W,K=this.p,tt=0==K.sizeVec3?new oimo_common_Vec3:K.stackVec3[--K.sizeVec3];tt.x=g.x,tt.y=g.y,tt.z=g.z;var it=tt,ot=it.x+0*n.x,at=it.y+0*n.y,nt=it.z+0*n.z;it.x=ot,it.y=at,it.z=nt;var st=it,_t=-t,rt=st.x+e.x*_t,et=st.y+e.y*_t,ht=st.z+e.z*_t;st.x=rt,st.y=et,st.z=ht;var lt=st,ct=this.p,mt=0==ct.sizeVec3?new oimo_common_Vec3:ct.stackVec3[--ct.sizeVec3];mt.x=g.x,mt.y=g.y,mt.z=g.z;var pt=mt,vt=pt.x+0*n.x,yt=pt.y+0*n.y,bt=pt.z+0*n.z;pt.x=vt,pt.y=yt,pt.z=bt;var ft=pt,dt=ft.x+e.x*t,xt=ft.y+e.y*t,ut=ft.z+e.z*t;ft.x=dt,ft.y=xt,ft.z=ut;var gt=ft,Mt=this.p,Xt=0==Mt.sizeVec3?new oimo_common_Vec3:Mt.stackVec3[--Mt.sizeVec3];Xt.x=L.x,Xt.y=L.y,Xt.z=L.z;var zt=Xt,Yt=-t,Zt=zt.x+n.x*Yt,It=zt.y+n.y*Yt,Vt=zt.z+n.z*Yt;zt.x=Zt,zt.y=It,zt.z=Vt;var Lt=zt,wt=Lt.x+0*e.x,Bt=Lt.y+0*e.y,kt=Lt.z+0*e.z;Lt.x=wt,Lt.y=Bt,Lt.z=kt;var At=Lt,Pt=this.p,St=0==Pt.sizeVec3?new oimo_common_Vec3:Pt.stackVec3[--Pt.sizeVec3];St.x=L.x,St.y=L.y,St.z=L.z;var Ct=St,Tt=Ct.x+n.x*t,jt=Ct.y+n.y*t,Rt=Ct.z+n.z*t;Ct.x=Tt,Ct.y=jt,Ct.z=Rt;var qt=Ct,Et=qt.x+0*e.x,Dt=qt.y+0*e.y,Jt=qt.z+0*e.z;qt.x=Et,qt.y=Dt,qt.z=Jt;var Ft=qt,Nt=this.p,Gt=0==Nt.sizeVec3?new oimo_common_Vec3:Nt.stackVec3[--Nt.sizeVec3];Gt.x=L.x,Gt.y=L.y,Gt.z=L.z;var Ot=Gt,Wt=Ot.x+0*n.x,Ut=Ot.y+0*n.y,Ht=Ot.z+0*n.z;Ot.x=Wt,Ot.y=Ut,Ot.z=Ht;var Qt=Ot,$t=-t,Kt=Qt.x+e.x*$t,Oa=Qt.y+e.y*$t,Ha=Qt.z+e.z*$t;Qt.x=Kt,Qt.y=Oa,Qt.z=Ha;var Ua=Qt,Qa=this.p,Ka=0==Qa.sizeVec3?new oimo_common_Vec3:Qa.stackVec3[--Qa.sizeVec3];Ka.x=L.x,Ka.y=L.y,Ka.z=L.z;var $a=Ka,ti=$a.x+0*n.x,oi=$a.y+0*n.y,ai=$a.z+0*n.z;$a.x=ti,$a.y=oi,$a.z=ai;var ii=$a,ni=ii.x+e.x*t,_i=ii.y+e.y*t,ei=ii.z+e.z*t;ii.x=ni,ii.y=_i,ii.z=ei;var ri=ii;this.ellipse(g,n,e,t,t,o),this.ellipse(L,n,e,t,t,o),this.line(E,At,o),this.line($,Ft,o),this.line(lt,Ua,o),this.line(gt,ri,o);var si=this.p;if(null!=E){if(E.zero(),si.sizeVec3==si.stackVec3.length){for(var li=si.sizeVec3<<1,ci=Array(li),pi=0,mi=si.sizeVec3,bi;pi<mi;)bi=pi++,ci[bi]=si.stackVec3[bi],si.stackVec3[bi]=null;si.stackVec3=ci}si.stackVec3[si.sizeVec3++]=E}var xi=this.p;if(null!=$){if($.zero(),xi.sizeVec3==xi.stackVec3.length){for(var yi=xi.sizeVec3<<1,fi=Array(yi),gi=0,vi=xi.sizeVec3,Xi;gi<vi;)Xi=gi++,fi[Xi]=xi.stackVec3[Xi],xi.stackVec3[Xi]=null;xi.stackVec3=fi}xi.stackVec3[xi.sizeVec3++]=$}var Yi=this.p;if(null!=lt){if(lt.zero(),Yi.sizeVec3==Yi.stackVec3.length){for(var Ii=Yi.sizeVec3<<1,Mi=Array(Ii),hi=0,Vi=Yi.sizeVec3,Li;hi<Vi;)Li=hi++,Mi[Li]=Yi.stackVec3[Li],Yi.stackVec3[Li]=null;Yi.stackVec3=Mi}Yi.stackVec3[Yi.sizeVec3++]=lt}var Bi=this.p;if(null!=gt){if(gt.zero(),Bi.sizeVec3==Bi.stackVec3.length){for(var Ai=Bi.sizeVec3<<1,Pi=Array(Ai),Si=0,tn=Bi.sizeVec3,Ti;Si<tn;)Ti=Si++,Pi[Ti]=Bi.stackVec3[Ti],Bi.stackVec3[Ti]=null;Bi.stackVec3=Pi}Bi.stackVec3[Bi.sizeVec3++]=gt}var on=this.p;if(null!=At){if(At.zero(),on.sizeVec3==on.stackVec3.length){for(var Ri=on.sizeVec3<<1,qi=Array(Ri),Ei=0,an=on.sizeVec3,Ji;Ei<an;)Ji=Ei++,qi[Ji]=on.stackVec3[Ji],on.stackVec3[Ji]=null;on.stackVec3=qi}on.stackVec3[on.sizeVec3++]=At}var nn=this.p;if(null!=Ft){if(Ft.zero(),nn.sizeVec3==nn.stackVec3.length){for(var Ni=nn.sizeVec3<<1,Gi=Array(Ni),Oi=0,_n=nn.sizeVec3,Ui;Oi<_n;)Ui=Oi++,Gi[Ui]=nn.stackVec3[Ui],nn.stackVec3[Ui]=null;nn.stackVec3=Gi}nn.stackVec3[nn.sizeVec3++]=Ft}var en=this.p;if(null!=Ua){if(Ua.zero(),en.sizeVec3==en.stackVec3.length){for(var Qi=en.sizeVec3<<1,$i=Array(Qi),Ki=0,rn=en.sizeVec3,io;Ki<rn;)io=Ki++,$i[io]=en.stackVec3[io],en.stackVec3[io]=null;en.stackVec3=$i}en.stackVec3[en.sizeVec3++]=Ua}var sn=this.p;if(null!=ri){if(ri.zero(),sn.sizeVec3==sn.stackVec3.length){for(var ao=sn.sizeVec3<<1,no=Array(ao),so=0,ln=sn.sizeVec3,ro;so<ln;)ro=so++,no[ro]=sn.stackVec3[ro],sn.stackVec3[ro]=null;sn.stackVec3=no}sn.stackVec3[sn.sizeVec3++]=ri}}else{for(var cn=0;8>cn;){var pn=cn++,lo=this.tmpCircleNorms[pn],co=this.circleCoords[pn];lo.x=co.x,lo.y=co.y,lo.z=co.z;var mo=lo,po=mo.x*m.e00+mo.y*m.e01+mo.z*m.e02,vo=mo.x*m.e10+mo.y*m.e11+mo.z*m.e12,yo=mo.x*m.e20+mo.y*m.e21+mo.z*m.e22;mo.x=po,mo.y=vo,mo.z=yo;var bo=this.tmpCircleVerts1[pn],fo=this.tmpCircleNorms[pn];bo.x=fo.x,bo.y=fo.y,bo.z=fo.z;var xo=bo,uo=xo.x*t,go=xo.y*t,Mo=xo.z*t;xo.x=uo,xo.y=go,xo.z=Mo;var Xo=xo,zo=Xo.x+l.x,Yo=Xo.y+l.y,Zo=Xo.z+l.z;Xo.x=zo,Xo.y=Yo,Xo.z=Zo;var Io=this.tmpCircleVerts2[pn],Vo=this.tmpCircleVerts1[pn];Io.x=Vo.x,Io.y=Vo.y,Io.z=Vo.z;var Lo=this.tmpCircleVerts1[pn],wo=Lo.x+_.x*i,Bo=Lo.y+_.y*i,ko=Lo.z+_.z*i;Lo.x=wo,Lo.y=Bo,Lo.z=ko;var Ao=this.tmpCircleVerts2[pn],Po=-i,So=Ao.x+_.x*Po,Co=Ao.y+_.y*Po,To=Ao.z+_.z*Po;Ao.x=So,Ao.y=Co,Ao.z=To}for(var jo=0;8>jo;){var mn=jo++,qo=g,bn=this.tmpCircleVerts1[mn],xn=this.tmpCircleVerts1[(mn+1)%8],dn=_;this.triangle(qo,bn,xn,dn,dn,dn,o),qo=L,bn=this.tmpCircleVerts2[(mn+1)%8],xn=this.tmpCircleVerts2[mn];var yn=this.p,No=0==yn.sizeVec3?new oimo_common_Vec3:yn.stackVec3[--yn.sizeVec3];No.x=_.x,No.y=_.y,No.z=_.z;var Go=No,Oo=-Go.x,Wo=-Go.y,Uo=-Go.z;Go.x=Oo,Go.y=Wo,Go.z=Uo,dn=Go,this.triangle(qo,bn,xn,dn,dn,dn,o);var Ho=this.p;if(null!=dn){if(dn.zero(),Ho.sizeVec3==Ho.stackVec3.length){for(var Qo=Ho.sizeVec3<<1,$o=Array(Qo),Ko=0,fn=Ho.sizeVec3,ia;Ko<fn;)ia=Ko++,$o[ia]=Ho.stackVec3[ia],Ho.stackVec3[ia]=null;Ho.stackVec3=$o}Ho.stackVec3[Ho.sizeVec3++]=dn}qo=this.tmpCircleVerts1[mn],bn=this.tmpCircleVerts2[mn],xn=this.tmpCircleVerts2[(mn+1)%8];var gn=this.tmpCircleVerts1[(mn+1)%8];dn=this.tmpCircleNorms[mn];var aa=this.tmpCircleNorms[(mn+1)%8];this.rect(qo,bn,xn,gn,dn,dn,aa,aa,o)}}var na=this.p;if(null!=g){if(g.zero(),na.sizeVec3==na.stackVec3.length){for(var sa=na.sizeVec3<<1,_a=Array(sa),ra=0,vn=na.sizeVec3,ha;ra<vn;)ha=ra++,_a[ha]=na.stackVec3[ha],na.stackVec3[ha]=null;na.stackVec3=_a}na.stackVec3[na.sizeVec3++]=g}var Xn=this.p;if(null!=L){if(L.zero(),Xn.sizeVec3==Xn.stackVec3.length){for(var ca=Xn.sizeVec3<<1,ma=Array(ca),pa=0,un=Xn.sizeVec3,ya;pa<un;)ya=pa++,ma[ya]=Xn.stackVec3[ya],Xn.stackVec3[ya]=null;Xn.stackVec3=ma}Xn.stackVec3[Xn.sizeVec3++]=L}var zn=this.p;if(null!=l){if(l.zero(),zn.sizeVec3==zn.stackVec3.length){for(var fa=zn.sizeVec3<<1,da=Array(fa),xa=0,Yn=zn.sizeVec3,ga;xa<Yn;)ga=xa++,da[ga]=zn.stackVec3[ga],zn.stackVec3[ga]=null;zn.stackVec3=da}zn.stackVec3[zn.sizeVec3++]=l}var Zn=this.p;if(null!=m){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,Zn.sizeMat3==Zn.stackMat3.length){for(var Xa=Zn.sizeMat3<<1,za=Array(Xa),Ya=0,In=Zn.sizeMat3,Ia;Ya<In;)Ia=Ya++,za[Ia]=Zn.stackMat3[Ia],Zn.stackMat3[Ia]=null;Zn.stackMat3=za}Zn.stackMat3[Zn.sizeMat3++]=m}var Mn=this.p;if(null!=n){if(n.zero(),Mn.sizeVec3==Mn.stackVec3.length){for(var La=Mn.sizeVec3<<1,wa=Array(La),Ba=0,hn=Mn.sizeVec3,Aa;Ba<hn;)Aa=Ba++,wa[Aa]=Mn.stackVec3[Aa],Mn.stackVec3[Aa]=null;Mn.stackVec3=wa}Mn.stackVec3[Mn.sizeVec3++]=n}var Vn=this.p;if(null!=_){if(_.zero(),Vn.sizeVec3==Vn.stackVec3.length){for(var Sa=Vn.sizeVec3<<1,Ca=Array(Sa),Ta=0,Ln=Vn.sizeVec3,Ra;Ta<Ln;)Ra=Ta++,Ca[Ra]=Vn.stackVec3[Ra],Vn.stackVec3[Ra]=null;Vn.stackVec3=Ca}Vn.stackVec3[Vn.sizeVec3++]=_}var Bn=this.p;if(null!=e){if(e.zero(),Bn.sizeVec3==Bn.stackVec3.length){for(var Ea=Bn.sizeVec3<<1,Da=Array(Ea),Ja=0,kn=Bn.sizeVec3,Na;Ja<kn;)Na=Ja++,Da[Na]=Bn.stackVec3[Na],Bn.stackVec3[Na]=null;Bn.stackVec3=Da}Bn.stackVec3[Bn.sizeVec3++]=e}},capsule:function(Wn,t,i,o){var a=this.p,n=0==a.sizeVec3?new oimo_common_Vec3:a.stackVec3[--a.sizeVec3],s=this.p,_=0==s.sizeVec3?new oimo_common_Vec3:s.stackVec3[--s.sizeVec3],r=this.p,e=0==r.sizeVec3?new oimo_common_Vec3:r.stackVec3[--r.sizeVec3],h=this.p,l=0==h.sizeVec3?new oimo_common_Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeMat3?new oimo_common_Mat3:c.stackMat3[--c.sizeMat3],p=l;p.x=Wn._positionX,p.y=Wn._positionY,p.z=Wn._positionZ;var v=m;v.e00=Wn._rotation00,v.e01=Wn._rotation01,v.e02=Wn._rotation02,v.e10=Wn._rotation10,v.e11=Wn._rotation11,v.e12=Wn._rotation12,v.e20=Wn._rotation20,v.e21=Wn._rotation21,v.e22=Wn._rotation22,n.init(m.e00,m.e10,m.e20),_.init(m.e01,m.e11,m.e21),e.init(m.e02,m.e12,m.e22);for(var y=this.tmpSphereVerts,b=this.tmpSphereNorms,f=0;5>f;)for(var Gn=f++,x=0,On=this.tmpSphereVerts[Gn].length;x<On;){var g=x++,M=b[Gn][g],X=this.sphereCoords[Gn][g];M.x=X.x,M.y=X.y,M.z=X.z;var z=M,Y=z.x*m.e00+z.y*m.e01+z.z*m.e02,Z=z.x*m.e10+z.y*m.e11+z.z*m.e12,I=z.x*m.e20+z.y*m.e21+z.z*m.e22;z.x=Y,z.y=Z,z.z=I}for(var V=0,Hn;4>V;){if(Hn=V++,0==Hn)for(var Un=0;3>Un;)for(var Qn=Un++,k=0,Kn=this.tmpSphereVerts[Qn].length;k<Kn;){var P=k++,S=y[Qn][P],C=b[Qn][P];S.x=C.x,S.y=C.y,S.z=C.z;var T=S,j=T.x*t,R=T.y*t,q=T.z*t;T.x=j,T.y=R,T.z=q;var E=T,D=E.x+l.x,J=E.y+l.y,F=E.z+l.z;E.x=D,E.y=J,E.z=F;var N=E,G=N.x+_.x*i,O=N.y+_.y*i,W=N.z+_.z*i;N.x=G,N.y=O,N.z=W}if(2==Hn)for(var U=2;5>U;)for(var $n=U++,Q=0,t_=this.tmpSphereVerts[$n].length;Q<t_;){var K=Q++,tt=y[$n][K],it=b[$n][K];tt.x=it.x,tt.y=it.y,tt.z=it.z;var ot=tt,at=ot.x*t,nt=ot.y*t,st=ot.z*t;ot.x=at,ot.y=nt,ot.z=st;var _t=ot,rt=_t.x+l.x,et=_t.y+l.y,ht=_t.z+l.z;_t.x=rt,_t.y=et,_t.z=ht;var lt=_t,ct=-i,mt=lt.x+_.x*ct,pt=lt.y+_.y*ct,vt=lt.z+_.z*ct;lt.x=mt,lt.y=pt,lt.z=vt}for(var yt=0;8>yt;){var o_=yt++,Yt,a_,i_,n_,__,e_,r_,s_;0==Hn?this.wireframe?(Yt=y[0][0],a_=y[1][o_],this.line(Yt,a_,o)):(Yt=y[0][0],a_=y[1][o_],i_=y[1][(o_+1)%8],__=b[0][0],e_=b[1][o_],r_=b[1][(o_+1)%8],this.triangle(Yt,a_,i_,__,e_,r_,o)):3==Hn?this.wireframe?(Yt=y[4][0],a_=y[Hn][(o_+1)%8],i_=y[Hn][o_],this.line(Yt,a_,o),this.line(a_,i_,o)):(Yt=y[4][0],a_=y[Hn][(o_+1)%8],i_=y[Hn][o_],__=b[4][0],e_=b[Hn][(o_+1)%8],r_=b[Hn][o_],this.triangle(Yt,a_,i_,__,e_,r_,o)):this.wireframe?(Yt=y[Hn][o_],a_=y[Hn][(o_+1)%8],i_=y[Hn+1][o_],this.line(Yt,a_,o),this.line(Yt,i_,o)):(Yt=y[Hn][o_],a_=y[Hn][(o_+1)%8],i_=y[Hn+1][o_],n_=y[Hn+1][(o_+1)%8],__=b[Hn][o_],e_=b[Hn][(o_+1)%8],r_=b[Hn+1][o_],s_=b[Hn+1][(o_+1)%8],this.rect(Yt,i_,n_,a_,__,r_,s_,e_,o))}}var l_=this.p,Zt=0==l_.sizeVec3?new oimo_common_Vec3:l_.stackVec3[--l_.sizeVec3];Zt.x=l.x,Zt.y=l.y,Zt.z=l.z;var It=Zt,Vt=It.x+_.x*i,Lt=It.y+_.y*i,wt=It.z+_.z*i;It.x=Vt,It.y=Lt,It.z=wt;var Bt=It,kt=this.p,At=0==kt.sizeVec3?new oimo_common_Vec3:kt.stackVec3[--kt.sizeVec3];At.x=l.x,At.y=l.y,At.z=l.z;var Pt=At,St=-i,Ct=Pt.x+_.x*St,Tt=Pt.y+_.y*St,jt=Pt.z+_.z*St;Pt.x=Ct,Pt.y=Tt,Pt.z=jt;var Rt=Pt;if(this.wireframe){var qt=this.p,Et=0==qt.sizeVec3?new oimo_common_Vec3:qt.stackVec3[--qt.sizeVec3];Et.x=Bt.x,Et.y=Bt.y,Et.z=Bt.z;var Dt=Et,Jt=-t,Ft=Dt.x+n.x*Jt,Nt=Dt.y+n.y*Jt,Gt=Dt.z+n.z*Jt;Dt.x=Ft,Dt.y=Nt,Dt.z=Gt;var Ot=Dt,Wt=Ot.x+0*e.x,Ut=Ot.y+0*e.y,Ht=Ot.z+0*e.z;Ot.x=Wt,Ot.y=Ut,Ot.z=Ht;var Qt=Ot,$t=this.p,Kt=0==$t.sizeVec3?new oimo_common_Vec3:$t.stackVec3[--$t.sizeVec3];Kt.x=Bt.x,Kt.y=Bt.y,Kt.z=Bt.z;var ti=Kt,ii=ti.x+n.x*t,oi=ti.y+n.y*t,ai=ti.z+n.z*t;ti.x=ii,ti.y=oi,ti.z=ai;var ni=ti,si=ni.x+0*e.x,_i=ni.y+0*e.y,ri=ni.z+0*e.z;ni.x=si,ni.y=_i,ni.z=ri;var ei=ni,hi=this.p,li=0==hi.sizeVec3?new oimo_common_Vec3:hi.stackVec3[--hi.sizeVec3];li.x=Bt.x,li.y=Bt.y,li.z=Bt.z;var ci=li,mi=ci.x+0*n.x,pi=ci.y+0*n.y,vi=ci.z+0*n.z;ci.x=mi,ci.y=pi,ci.z=vi;var yi=ci,bi=-t,fi=yi.x+e.x*bi,di=yi.y+e.y*bi,xi=yi.z+e.z*bi;yi.x=fi,yi.y=di,yi.z=xi;var ui=yi,gi=this.p,Mi=0==gi.sizeVec3?new oimo_common_Vec3:gi.stackVec3[--gi.sizeVec3];Mi.x=Bt.x,Mi.y=Bt.y,Mi.z=Bt.z;var Xi=Mi,zi=Xi.x+0*n.x,Yi=Xi.y+0*n.y,Zi=Xi.z+0*n.z;Xi.x=zi,Xi.y=Yi,Xi.z=Zi;var Ii=Xi,Vi=Ii.x+e.x*t,Li=Ii.y+e.y*t,wi=Ii.z+e.z*t;Ii.x=Vi,Ii.y=Li,Ii.z=wi;var Bi=Ii,ki=this.p,Ai=0==ki.sizeVec3?new oimo_common_Vec3:ki.stackVec3[--ki.sizeVec3];Ai.x=Rt.x,Ai.y=Rt.y,Ai.z=Rt.z;var Pi=Ai,Si=-t,Ci=Pi.x+n.x*Si,Ti=Pi.y+n.y*Si,ji=Pi.z+n.z*Si;Pi.x=Ci,Pi.y=Ti,Pi.z=ji;var Ri=Pi,qi=Ri.x+0*e.x,Ei=Ri.y+0*e.y,Di=Ri.z+0*e.z;Ri.x=qi,Ri.y=Ei,Ri.z=Di;var Ji=Ri,Fi=this.p,Ni=0==Fi.sizeVec3?new oimo_common_Vec3:Fi.stackVec3[--Fi.sizeVec3];Ni.x=Rt.x,Ni.y=Rt.y,Ni.z=Rt.z;var Gi=Ni,Oi=Gi.x+n.x*t,Wi=Gi.y+n.y*t,Ui=Gi.z+n.z*t;Gi.x=Oi,Gi.y=Wi,Gi.z=Ui;var Hi=Gi,Qi=Hi.x+0*e.x,$i=Hi.y+0*e.y,Ki=Hi.z+0*e.z;Hi.x=Qi,Hi.y=$i,Hi.z=Ki;var to=Hi,io=this.p,oo=0==io.sizeVec3?new oimo_common_Vec3:io.stackVec3[--io.sizeVec3];oo.x=Rt.x,oo.y=Rt.y,oo.z=Rt.z;var ao=oo,no=ao.x+0*n.x,so=ao.y+0*n.y,_o=ao.z+0*n.z;ao.x=no,ao.y=so,ao.z=_o;var ro=ao,eo=-t,ho=ro.x+e.x*eo,lo=ro.y+e.y*eo,co=ro.z+e.z*eo;ro.x=ho,ro.y=lo,ro.z=co;var mo=ro,po=this.p,vo=0==po.sizeVec3?new oimo_common_Vec3:po.stackVec3[--po.sizeVec3];vo.x=Rt.x,vo.y=Rt.y,vo.z=Rt.z;var yo=vo,bo=yo.x+0*n.x,fo=yo.y+0*n.y,xo=yo.z+0*n.z;yo.x=bo,yo.y=fo,yo.z=xo;var uo=yo,go=uo.x+e.x*t,Mo=uo.y+e.y*t,Xo=uo.z+e.z*t;uo.x=go,uo.y=Mo,uo.z=Xo;var zo=uo;this.ellipse(Bt,n,e,t,t,o),this.ellipse(Rt,n,e,t,t,o),this.line(Qt,Ji,o),this.line(ei,to,o),this.line(ui,mo,o),this.line(Bi,zo,o);var Yo=this.p;if(null!=Qt){if(Qt.zero(),Yo.sizeVec3==Yo.stackVec3.length){for(var Zo=Yo.sizeVec3<<1,Io=Array(Zo),Vo=0,c_=Yo.sizeVec3,wo;Vo<c_;)wo=Vo++,Io[wo]=Yo.stackVec3[wo],Yo.stackVec3[wo]=null;Yo.stackVec3=Io}Yo.stackVec3[Yo.sizeVec3++]=Qt}var p_=this.p;if(null!=ei){if(ei.zero(),p_.sizeVec3==p_.stackVec3.length){for(var ko=p_.sizeVec3<<1,Ao=Array(ko),Po=0,m_=p_.sizeVec3,Co;Po<m_;)Co=Po++,Ao[Co]=p_.stackVec3[Co],p_.stackVec3[Co]=null;p_.stackVec3=Ao}p_.stackVec3[p_.sizeVec3++]=ei}var b_=this.p;if(null!=ui){if(ui.zero(),b_.sizeVec3==b_.stackVec3.length){for(var jo=b_.sizeVec3<<1,Ro=Array(jo),qo=0,x_=b_.sizeVec3,Do;qo<x_;)Do=qo++,Ro[Do]=b_.stackVec3[Do],b_.stackVec3[Do]=null;b_.stackVec3=Ro}b_.stackVec3[b_.sizeVec3++]=ui}var d_=this.p;if(null!=Bi){if(Bi.zero(),d_.sizeVec3==d_.stackVec3.length){for(var Fo=d_.sizeVec3<<1,No=Array(Fo),Go=0,y_=d_.sizeVec3,Wo;Go<y_;)Wo=Go++,No[Wo]=d_.stackVec3[Wo],d_.stackVec3[Wo]=null;d_.stackVec3=No}d_.stackVec3[d_.sizeVec3++]=Bi}var f_=this.p;if(null!=Ji){if(Ji.zero(),f_.sizeVec3==f_.stackVec3.length){for(var Ho=f_.sizeVec3<<1,Qo=Array(Ho),$o=0,g_=f_.sizeVec3,ta;$o<g_;)ta=$o++,Qo[ta]=f_.stackVec3[ta],f_.stackVec3[ta]=null;f_.stackVec3=Qo}f_.stackVec3[f_.sizeVec3++]=Ji}var v_=this.p;if(null!=to){if(to.zero(),v_.sizeVec3==v_.stackVec3.length){for(var oa=v_.sizeVec3<<1,aa=Array(oa),na=0,X_=v_.sizeVec3,_a;na<X_;)_a=na++,aa[_a]=v_.stackVec3[_a],v_.stackVec3[_a]=null;v_.stackVec3=aa}v_.stackVec3[v_.sizeVec3++]=to}var u_=this.p;if(null!=mo){if(mo.zero(),u_.sizeVec3==u_.stackVec3.length){for(var ea=u_.sizeVec3<<1,ha=Array(ea),la=0,z_=u_.sizeVec3,ma;la<z_;)ma=la++,ha[ma]=u_.stackVec3[ma],u_.stackVec3[ma]=null;u_.stackVec3=ha}u_.stackVec3[u_.sizeVec3++]=mo}var Y_=this.p;if(null!=zo){if(zo.zero(),Y_.sizeVec3==Y_.stackVec3.length){for(var va=Y_.sizeVec3<<1,ya=Array(va),ba=0,Z_=Y_.sizeVec3,da;ba<Z_;)da=ba++,ya[da]=Y_.stackVec3[da],Y_.stackVec3[da]=null;Y_.stackVec3=ya}Y_.stackVec3[Y_.sizeVec3++]=zo}}else{for(var I_=0;8>I_;){var M_=I_++,ga=this.tmpCircleNorms[M_],Ma=this.circleCoords[M_];ga.x=Ma.x,ga.y=Ma.y,ga.z=Ma.z;var Xa=ga,za=Xa.x*m.e00+Xa.y*m.e01+Xa.z*m.e02,Ya=Xa.x*m.e10+Xa.y*m.e11+Xa.z*m.e12,Za=Xa.x*m.e20+Xa.y*m.e21+Xa.z*m.e22;Xa.x=za,Xa.y=Ya,Xa.z=Za;var Ia=this.tmpCircleVerts1[M_],Va=this.tmpCircleNorms[M_];Ia.x=Va.x,Ia.y=Va.y,Ia.z=Va.z;var La=Ia,wa=La.x*t,Ba=La.y*t,ka=La.z*t;La.x=wa,La.y=Ba,La.z=ka;var Aa=La,Pa=Aa.x+l.x,Sa=Aa.y+l.y,Ca=Aa.z+l.z;Aa.x=Pa,Aa.y=Sa,Aa.z=Ca;var Ta=this.tmpCircleVerts2[M_],ja=this.tmpCircleVerts1[M_];Ta.x=ja.x,Ta.y=ja.y,Ta.z=ja.z;var Ra=this.tmpCircleVerts1[M_],qa=Ra.x+_.x*i,Ea=Ra.y+_.y*i,Da=Ra.z+_.z*i;Ra.x=qa,Ra.y=Ea,Ra.z=Da;var Ja=this.tmpCircleVerts2[M_],Fa=-i,Na=Ja.x+_.x*Fa,Ga=Ja.y+_.y*Fa,Oa=Ja.z+_.z*Fa;Ja.x=Na,Ja.y=Ga,Ja.z=Oa}for(var Wa=0;8>Wa;){var h_=Wa++,Ha=this.tmpCircleVerts1[h_],Qa=this.tmpCircleVerts2[h_],$a=this.tmpCircleVerts2[(h_+1)%8],Ka=this.tmpCircleVerts1[(h_+1)%8],tn=this.tmpCircleNorms[h_],on=this.tmpCircleNorms[(h_+1)%8];this.rect(Ha,Qa,$a,Ka,tn,tn,on,on,o)}}var an=this.p;if(null!=Bt){if(Bt.zero(),an.sizeVec3==an.stackVec3.length){for(var nn=an.sizeVec3<<1,sn=Array(nn),_n=0,V_=an.sizeVec3,en;_n<V_;)en=_n++,sn[en]=an.stackVec3[en],an.stackVec3[en]=null;an.stackVec3=sn}an.stackVec3[an.sizeVec3++]=Bt}var L_=this.p;if(null!=Rt){if(Rt.zero(),L_.sizeVec3==L_.stackVec3.length){for(var ln=L_.sizeVec3<<1,cn=Array(ln),mn=0,B_=L_.sizeVec3,vn;mn<B_;)vn=mn++,cn[vn]=L_.stackVec3[vn],L_.stackVec3[vn]=null;L_.stackVec3=cn}L_.stackVec3[L_.sizeVec3++]=Rt}var k_=this.p;if(null!=l){if(l.zero(),k_.sizeVec3==k_.stackVec3.length){for(var bn=k_.sizeVec3<<1,fn=Array(bn),dn=0,A_=k_.sizeVec3,un;dn<A_;)un=dn++,fn[un]=k_.stackVec3[un],k_.stackVec3[un]=null;k_.stackVec3=fn}k_.stackVec3[k_.sizeVec3++]=l}var P_=this.p;if(null!=m){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,P_.sizeMat3==P_.stackMat3.length){for(var Mn=P_.sizeMat3<<1,Xn=Array(Mn),zn=0,T_=P_.sizeMat3,Zn;zn<T_;)Zn=zn++,Xn[Zn]=P_.stackMat3[Zn],P_.stackMat3[Zn]=null;P_.stackMat3=Xn}P_.stackMat3[P_.sizeMat3++]=m}var w_=this.p;if(null!=n){if(n.zero(),w_.sizeVec3==w_.stackVec3.length){for(var Vn=w_.sizeVec3<<1,Ln=Array(Vn),wn=0,S_=w_.sizeVec3,kn;wn<S_;)kn=wn++,Ln[kn]=w_.stackVec3[kn],w_.stackVec3[kn]=null;w_.stackVec3=Ln}w_.stackVec3[w_.sizeVec3++]=n}var C_=this.p;if(null!=_){if(_.zero(),C_.sizeVec3==C_.stackVec3.length){for(var Pn=C_.sizeVec3<<1,Sn=Array(Pn),Cn=0,q_=C_.sizeVec3,jn;Cn<q_;)jn=Cn++,Sn[jn]=C_.stackVec3[jn],C_.stackVec3[jn]=null;C_.stackVec3=Sn}C_.stackVec3[C_.sizeVec3++]=_}var R_=this.p;if(null!=e){if(e.zero(),R_.sizeVec3==R_.stackVec3.length){for(var qn=R_.sizeVec3<<1,En=Array(qn),Dn=0,E_=R_.sizeVec3,Fn;Dn<E_;)Fn=Dn++,En[Fn]=R_.stackVec3[Fn],R_.stackVec3[Fn]=null;R_.stackVec3=En}R_.stackVec3[R_.sizeVec3++]=e}},sphere:function(ot,t,i){var o=this.p,a=0==o.sizeVec3?new oimo_common_Vec3:o.stackVec3[--o.sizeVec3],n=this.p,s=0==n.sizeMat3?new oimo_common_Mat3:n.stackMat3[--n.sizeMat3],_=a;_.x=ot._positionX,_.y=ot._positionY,_.z=ot._positionZ;var r=s;r.e00=ot._rotation00,r.e01=ot._rotation01,r.e02=ot._rotation02,r.e10=ot._rotation10,r.e11=ot._rotation11,r.e12=ot._rotation12,r.e20=ot._rotation20,r.e21=ot._rotation21,r.e22=ot._rotation22;for(var e=this.tmpSphereVerts,h=this.tmpSphereNorms,l=0;5>l;)for(var at=l++,m=0,nt=this.tmpSphereVerts[at].length;m<nt;){var v=m++,y=h[at][v],b=this.sphereCoords[at][v];y.x=b.x,y.y=b.y,y.z=b.z;var f=y,d=f.x*s.e00+f.y*s.e01+f.z*s.e02,x=f.x*s.e10+f.y*s.e11+f.z*s.e12,u=f.x*s.e20+f.y*s.e21+f.z*s.e22;f.x=d,f.y=x,f.z=u;var g=e[at][v],M=h[at][v];g.x=M.x,g.y=M.y,g.z=M.z;var X=g,z=X.x*t,Y=X.y*t,Z=X.z*t;X.x=z,X.y=Y,X.z=Z;var I=X,V=I.x+a.x,L=I.y+a.y,w=I.z+a.z;I.x=V,I.y=L,I.z=w}for(var B=0;4>B;)for(var _t=B++,A=0;8>A;){var et=A++,J,rt,st,lt,ct,pt,mt,bt;0==_t?this.wireframe?(J=e[0][0],rt=e[1][et],this.line(J,rt,i)):(J=e[0][0],rt=e[1][et],st=e[1][(et+1)%8],ct=h[0][0],pt=h[1][et],mt=h[1][(et+1)%8],this.triangle(J,rt,st,ct,pt,mt,i)):3==_t?this.wireframe?(J=e[4][0],rt=e[_t][(et+1)%8],st=e[_t][et],this.line(J,rt,i),this.line(rt,st,i)):(J=e[4][0],rt=e[_t][(et+1)%8],st=e[_t][et],ct=h[4][0],pt=h[_t][(et+1)%8],mt=h[_t][et],this.triangle(J,rt,st,ct,pt,mt,i)):this.wireframe?(J=e[_t][et],rt=e[_t][(et+1)%8],st=e[_t+1][et],this.line(J,rt,i),this.line(J,st,i)):(J=e[_t][et],rt=e[_t][(et+1)%8],st=e[_t+1][et],lt=e[_t+1][(et+1)%8],ct=h[_t][et],pt=h[_t][(et+1)%8],mt=h[_t+1][et],bt=h[_t+1][(et+1)%8],this.rect(J,st,lt,rt,ct,mt,bt,pt,i))}var xt=this.p;if(null!=a){if(a.zero(),xt.sizeVec3==xt.stackVec3.length){for(var F=xt.sizeVec3<<1,N=Array(F),G=0,dt=xt.sizeVec3,W;G<dt;)W=G++,N[W]=xt.stackVec3[W],xt.stackVec3[W]=null;xt.stackVec3=N}xt.stackVec3[xt.sizeVec3++]=a}var yt=this.p;if(null!=s){if(s.e00=1,s.e01=0,s.e02=0,s.e10=0,s.e11=1,s.e12=0,s.e20=0,s.e21=0,s.e22=1,yt.sizeMat3==yt.stackMat3.length){for(var H=yt.sizeMat3<<1,Q=Array(H),$=0,ft=yt.sizeMat3,tt;$<ft;)tt=$++,Q[tt]=yt.stackMat3[tt],yt.stackMat3[tt]=null;yt.stackMat3=Q}yt.stackMat3[yt.sizeMat3++]=s}},box:function(Ka,t,i){var o=this.p,a=0==o.sizeVec3?new oimo_common_Vec3:o.stackVec3[--o.sizeVec3],n=this.p,s=0==n.sizeVec3?new oimo_common_Vec3:n.stackVec3[--n.sizeVec3],_=this.p,r=0==_.sizeVec3?new oimo_common_Vec3:_.stackVec3[--_.sizeVec3],e=this.p,h=0==e.sizeVec3?new oimo_common_Vec3:e.stackVec3[--e.sizeVec3],l=this.p,c=0==l.sizeMat3?new oimo_common_Mat3:l.stackMat3[--l.sizeMat3],m=h;m.x=Ka._positionX,m.y=Ka._positionY,m.z=Ka._positionZ;var p=c;p.e00=Ka._rotation00,p.e01=Ka._rotation01,p.e02=Ka._rotation02,p.e10=Ka._rotation10,p.e11=Ka._rotation11,p.e12=Ka._rotation12,p.e20=Ka._rotation20,p.e21=Ka._rotation21,p.e22=Ka._rotation22,a.init(c.e00,c.e10,c.e20),s.init(c.e01,c.e11,c.e21),r.init(c.e02,c.e12,c.e22);var v=t.x,y=t.y,b=t.z,f=this.p,d=0==f.sizeVec3?new oimo_common_Vec3:f.stackVec3[--f.sizeVec3];d.x=h.x,d.y=h.y,d.z=h.z;var x=d,u=-v,g=x.x+a.x*u,M=x.y+a.y*u,X=x.z+a.z*u;x.x=g,x.y=M,x.z=X;var z=x,Y=-y,Z=z.x+s.x*Y,I=z.y+s.y*Y,V=z.z+s.z*Y;z.x=Z,z.y=I,z.z=V;var L=z,w=-b,B=L.x+r.x*w,k=L.y+r.y*w,A=L.z+r.z*w;L.x=B,L.y=k,L.z=A;var P=L,S=this.p,C=0==S.sizeVec3?new oimo_common_Vec3:S.stackVec3[--S.sizeVec3];C.x=h.x,C.y=h.y,C.z=h.z;var T=C,j=-v,R=T.x+a.x*j,q=T.y+a.y*j,E=T.z+a.z*j;T.x=R,T.y=q,T.z=E;var D=T,J=-y,F=D.x+s.x*J,N=D.y+s.y*J,G=D.z+s.z*J;D.x=F,D.y=N,D.z=G;var O=D,W=O.x+r.x*b,U=O.y+r.y*b,H=O.z+r.z*b;O.x=W,O.y=U,O.z=H;var Q=O,$=this.p,K=0==$.sizeVec3?new oimo_common_Vec3:$.stackVec3[--$.sizeVec3];K.x=h.x,K.y=h.y,K.z=h.z;var tt=K,it=-v,ot=tt.x+a.x*it,at=tt.y+a.y*it,nt=tt.z+a.z*it;tt.x=ot,tt.y=at,tt.z=nt;var st=tt,_t=st.x+s.x*y,rt=st.y+s.y*y,et=st.z+s.z*y;st.x=_t,st.y=rt,st.z=et;var ht=st,lt=-b,ct=ht.x+r.x*lt,mt=ht.y+r.y*lt,pt=ht.z+r.z*lt;ht.x=ct,ht.y=mt,ht.z=pt;var vt=ht,yt=this.p,bt=0==yt.sizeVec3?new oimo_common_Vec3:yt.stackVec3[--yt.sizeVec3];bt.x=h.x,bt.y=h.y,bt.z=h.z;var ft=bt,dt=-v,xt=ft.x+a.x*dt,ut=ft.y+a.y*dt,gt=ft.z+a.z*dt;ft.x=xt,ft.y=ut,ft.z=gt;var Mt=ft,Xt=Mt.x+s.x*y,zt=Mt.y+s.y*y,Yt=Mt.z+s.z*y;Mt.x=Xt,Mt.y=zt,Mt.z=Yt;var Zt=Mt,It=Zt.x+r.x*b,Vt=Zt.y+r.y*b,Lt=Zt.z+r.z*b;Zt.x=It,Zt.y=Vt,Zt.z=Lt;var wt=Zt,Bt=this.p,kt=0==Bt.sizeVec3?new oimo_common_Vec3:Bt.stackVec3[--Bt.sizeVec3];kt.x=h.x,kt.y=h.y,kt.z=h.z;var At=kt,Pt=At.x+a.x*v,St=At.y+a.y*v,Ct=At.z+a.z*v;At.x=Pt,At.y=St,At.z=Ct;var Tt=At,jt=-y,Rt=Tt.x+s.x*jt,qt=Tt.y+s.y*jt,Et=Tt.z+s.z*jt;Tt.x=Rt,Tt.y=qt,Tt.z=Et;var Dt=Tt,Jt=-b,Ft=Dt.x+r.x*Jt,Nt=Dt.y+r.y*Jt,Gt=Dt.z+r.z*Jt;Dt.x=Ft,Dt.y=Nt,Dt.z=Gt;var Ot=Dt,Wt=this.p,Ut=0==Wt.sizeVec3?new oimo_common_Vec3:Wt.stackVec3[--Wt.sizeVec3];Ut.x=h.x,Ut.y=h.y,Ut.z=h.z;var Ht=Ut,Qt=Ht.x+a.x*v,$t=Ht.y+a.y*v,Kt=Ht.z+a.z*v;Ht.x=Qt,Ht.y=$t,Ht.z=Kt;var $a=Ht,ti=-y,oi=$a.x+s.x*ti,ai=$a.y+s.y*ti,ii=$a.z+s.z*ti;$a.x=oi,$a.y=ai,$a.z=ii;var ni=$a,_i=ni.x+r.x*b,ri=ni.y+r.y*b,ei=ni.z+r.z*b;ni.x=_i,ni.y=ri,ni.z=ei;var si=ni,li=this.p,ci=0==li.sizeVec3?new oimo_common_Vec3:li.stackVec3[--li.sizeVec3];ci.x=h.x,ci.y=h.y,ci.z=h.z;var mi=ci,pi=mi.x+a.x*v,vi=mi.y+a.y*v,yi=mi.z+a.z*v;mi.x=pi,mi.y=vi,mi.z=yi;var bi=mi,fi=bi.x+s.x*y,di=bi.y+s.y*y,xi=bi.z+s.z*y;bi.x=fi,bi.y=di,bi.z=xi;var ui=bi,gi=-b,Mi=ui.x+r.x*gi,Xi=ui.y+r.y*gi,zi=ui.z+r.z*gi;ui.x=Mi,ui.y=Xi,ui.z=zi;var Yi=ui,Zi=this.p,Ii=0==Zi.sizeVec3?new oimo_common_Vec3:Zi.stackVec3[--Zi.sizeVec3];Ii.x=h.x,Ii.y=h.y,Ii.z=h.z;var hi=Ii,Vi=hi.x+a.x*v,Li=hi.y+a.y*v,Bi=hi.z+a.z*v;hi.x=Vi,hi.y=Li,hi.z=Bi;var ki=hi,Ai=ki.x+s.x*y,Pi=ki.y+s.y*y,wi=ki.z+s.z*y;ki.x=Ai,ki.y=Pi,ki.z=wi;var Si=ki,Ti=Si.x+r.x*b,Ci=Si.y+r.y*b,Ri=Si.z+r.z*b;Si.x=Ti,Si.y=Ci,Si.z=Ri;var qi=Si;if(this.wireframe)this.line(P,Q,i),this.line(vt,wt,i),this.line(Ot,si,i),this.line(Yi,qi,i),this.line(P,vt,i),this.line(Q,wt,i),this.line(Ot,Yi,i),this.line(si,qi,i),this.line(P,Ot,i),this.line(Q,si,i),this.line(vt,Yi,i),this.line(wt,qi,i);else{var Ei=this.p,ji=0==Ei.sizeVec3?new oimo_common_Vec3:Ei.stackVec3[--Ei.sizeVec3];ji.x=a.x,ji.y=a.y,ji.z=a.z;var Di=ji,Fi=-Di.x,Ni=-Di.y,Gi=-Di.z;Di.x=Fi,Di.y=Ni,Di.z=Gi;var Oi=Di,Wi=this.p,Ji=0==Wi.sizeVec3?new oimo_common_Vec3:Wi.stackVec3[--Wi.sizeVec3];Ji.x=s.x,Ji.y=s.y,Ji.z=s.z;var Hi=Ji,Ui=-Hi.x,Qi=-Hi.y,Ki=-Hi.z;Hi.x=Ui,Hi.y=Qi,Hi.z=Ki;var to=Hi,io=this.p,oo=0==io.sizeVec3?new oimo_common_Vec3:io.stackVec3[--io.sizeVec3];oo.x=r.x,oo.y=r.y,oo.z=r.z;var ao=oo,no=-ao.x,so=-ao.y,_o=-ao.z;ao.x=no,ao.y=so,ao.z=_o;var ro=ao;this.rect(P,Q,wt,vt,Oi,Oi,Oi,Oi,i),this.rect(Ot,Yi,qi,si,a,a,a,a,i),this.rect(P,Ot,si,Q,to,to,to,to,i),this.rect(vt,wt,qi,Yi,s,s,s,s,i),this.rect(P,vt,Yi,Ot,ro,ro,ro,ro,i),this.rect(Q,si,qi,wt,r,r,r,r,i);var eo=this.p;if(null!=Oi){if(Oi.zero(),eo.sizeVec3==eo.stackVec3.length){for(var ho=eo.sizeVec3<<1,lo=Array(ho),co=0,$i=eo.sizeVec3,po;co<$i;)po=co++,lo[po]=eo.stackVec3[po],eo.stackVec3[po]=null;eo.stackVec3=lo}eo.stackVec3[eo.sizeVec3++]=Oi}var tn=this.p;if(null!=to){if(to.zero(),tn.sizeVec3==tn.stackVec3.length){for(var yo=tn.sizeVec3<<1,bo=Array(yo),fo=0,on=tn.sizeVec3,uo;fo<on;)uo=fo++,bo[uo]=tn.stackVec3[uo],tn.stackVec3[uo]=null;tn.stackVec3=bo}tn.stackVec3[tn.sizeVec3++]=to}var an=this.p;if(null!=ro){if(ro.zero(),an.sizeVec3==an.stackVec3.length){for(var Mo=an.sizeVec3<<1,Xo=Array(Mo),zo=0,nn=an.sizeVec3,Zo;zo<nn;)Zo=zo++,Xo[Zo]=an.stackVec3[Zo],an.stackVec3[Zo]=null;an.stackVec3=Xo}an.stackVec3[an.sizeVec3++]=ro}}var _n=this.p;if(null!=P){if(P.zero(),_n.sizeVec3==_n.stackVec3.length){for(var Vo=_n.sizeVec3<<1,Lo=Array(Vo),wo=0,en=_n.sizeVec3,ko;wo<en;)ko=wo++,Lo[ko]=_n.stackVec3[ko],_n.stackVec3[ko]=null;_n.stackVec3=Lo}_n.stackVec3[_n.sizeVec3++]=P}var rn=this.p;if(null!=Q){if(Q.zero(),rn.sizeVec3==rn.stackVec3.length){for(var Po=rn.sizeVec3<<1,So=Array(Po),Co=0,sn=rn.sizeVec3,jo;Co<sn;)jo=Co++,So[jo]=rn.stackVec3[jo],rn.stackVec3[jo]=null;rn.stackVec3=So}rn.stackVec3[rn.sizeVec3++]=Q}var ln=this.p;if(null!=vt){if(vt.zero(),ln.sizeVec3==ln.stackVec3.length){for(var qo=ln.sizeVec3<<1,Eo=Array(qo),Do=0,cn=ln.sizeVec3,Fo;Do<cn;)Fo=Do++,Eo[Fo]=ln.stackVec3[Fo],ln.stackVec3[Fo]=null;ln.stackVec3=Eo}ln.stackVec3[ln.sizeVec3++]=vt}var pn=this.p;if(null!=wt){if(wt.zero(),pn.sizeVec3==pn.stackVec3.length){for(var Go=pn.sizeVec3<<1,Oo=Array(Go),Wo=0,mn=pn.sizeVec3,Ho;Wo<mn;)Ho=Wo++,Oo[Ho]=pn.stackVec3[Ho],pn.stackVec3[Ho]=null;pn.stackVec3=Oo}pn.stackVec3[pn.sizeVec3++]=wt}var bn=this.p;if(null!=Ot){if(Ot.zero(),bn.sizeVec3==bn.stackVec3.length){for(var $o=bn.sizeVec3<<1,Ko=Array($o),ta=0,xn=bn.sizeVec3,oa;ta<xn;)oa=ta++,Ko[oa]=bn.stackVec3[oa],bn.stackVec3[oa]=null;bn.stackVec3=Ko}bn.stackVec3[bn.sizeVec3++]=Ot}var dn=this.p;if(null!=si){if(si.zero(),dn.sizeVec3==dn.stackVec3.length){for(var na=dn.sizeVec3<<1,sa=Array(na),_a=0,yn=dn.sizeVec3,ea;_a<yn;)ea=_a++,sa[ea]=dn.stackVec3[ea],dn.stackVec3[ea]=null;dn.stackVec3=sa}dn.stackVec3[dn.sizeVec3++]=si}var fn=this.p;if(null!=Yi){if(Yi.zero(),fn.sizeVec3==fn.stackVec3.length){for(var la=fn.sizeVec3<<1,ca=Array(la),ma=0,gn=fn.sizeVec3,va;ma<gn;)va=ma++,ca[va]=fn.stackVec3[va],fn.stackVec3[va]=null;fn.stackVec3=ca}fn.stackVec3[fn.sizeVec3++]=Yi}var vn=this.p;if(null!=qi){if(qi.zero(),vn.sizeVec3==vn.stackVec3.length){for(var ba=vn.sizeVec3<<1,fa=Array(ba),da=0,Xn=vn.sizeVec3,ua;da<Xn;)ua=da++,fa[ua]=vn.stackVec3[ua],vn.stackVec3[ua]=null;vn.stackVec3=fa}vn.stackVec3[vn.sizeVec3++]=qi}var un=this.p;if(null!=h){if(h.zero(),un.sizeVec3==un.stackVec3.length){for(var Ma=un.sizeVec3<<1,Xa=Array(Ma),za=0,zn=un.sizeVec3,Za;za<zn;)Za=za++,Xa[Za]=un.stackVec3[Za],un.stackVec3[Za]=null;un.stackVec3=Xa}un.stackVec3[un.sizeVec3++]=h}var Yn=this.p;if(null!=c){if(c.e00=1,c.e01=0,c.e02=0,c.e10=0,c.e11=1,c.e12=0,c.e20=0,c.e21=0,c.e22=1,Yn.sizeMat3==Yn.stackMat3.length){for(var Va=Yn.sizeMat3<<1,La=Array(Va),wa=0,Zn=Yn.sizeMat3,ka;wa<Zn;)ka=wa++,La[ka]=Yn.stackMat3[ka],Yn.stackMat3[ka]=null;Yn.stackMat3=La}Yn.stackMat3[Yn.sizeMat3++]=c}var In=this.p;if(null!=a){if(a.zero(),In.sizeVec3==In.stackVec3.length){for(var Pa=In.sizeVec3<<1,Sa=Array(Pa),Ca=0,Mn=In.sizeVec3,ja;Ca<Mn;)ja=Ca++,Sa[ja]=In.stackVec3[ja],In.stackVec3[ja]=null;In.stackVec3=Sa}In.stackVec3[In.sizeVec3++]=a}var hn=this.p;if(null!=s){if(s.zero(),hn.sizeVec3==hn.stackVec3.length){for(var qa=hn.sizeVec3<<1,Ea=Array(qa),Da=0,Vn=hn.sizeVec3,Fa;Da<Vn;)Fa=Da++,Ea[Fa]=hn.stackVec3[Fa],hn.stackVec3[Fa]=null;hn.stackVec3=Ea}hn.stackVec3[hn.sizeVec3++]=s}var Ln=this.p;if(null!=r){if(r.zero(),Ln.sizeVec3==Ln.stackVec3.length){for(var Ga=Ln.sizeVec3<<1,Oa=Array(Ga),Wa=0,Bn=Ln.sizeVec3,Ha;Wa<Bn;)Ha=Wa++,Oa[Ha]=Ln.stackVec3[Ha],Ln.stackVec3[Ha]=null;Ln.stackVec3=Oa}Ln.stackVec3[Ln.sizeVec3++]=r}},rect:function(l,t,i,o,a,n,s,_,r){this.triangle(l,t,i,a,n,s,r),this.triangle(l,i,o,a,s,_,r)},point:function(){},triangle:function(){},line:function(){}};var oimo_dynamics_common_DebugDrawStyle=function(){this.basisColorZ=new oimo_common_Vec3(0,0,1),this.basisColorY=new oimo_common_Vec3(0,1,0),this.basisColorX=new oimo_common_Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new oimo_common_Vec3(1,.1,.1),this.jointLineColor=new oimo_common_Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new oimo_common_Vec3(.2,.2,1),this.contactTangentColor=new oimo_common_Vec3(.1,.8,.1),this.contactNormalColor=new oimo_common_Vec3(1,.1,.1),this.disabledContactColor=new oimo_common_Vec3(.5,.1,.1),this.newContactColor=new oimo_common_Vec3(1,1,.1),this.contactColor4=new oimo_common_Vec3(.8,.1,1),this.contactColor3=new oimo_common_Vec3(.1,.8,.6),this.contactColor2=new oimo_common_Vec3(1,.6,.1),this.contactColor=new oimo_common_Vec3(1,.1,.1),this.pairColor=new oimo_common_Vec3(1,1,.1),this.bvhNodeColor=new oimo_common_Vec3(.4,.4,.4),this.aabbColor=new oimo_common_Vec3(1,.1,.1),this.kinematicShapeColor=new oimo_common_Vec3(1,.5,.1),this.staticShapeColor=new oimo_common_Vec3(.7,.7,.7),this.sleepingShapeColor2=new oimo_common_Vec3(.2,.8,.5),this.sleepingShapeColor1=new oimo_common_Vec3(.3,.3,.8),this.sleepyShapeColor2=new oimo_common_Vec3(.6,.8,.3),this.sleepyShapeColor1=new oimo_common_Vec3(.5,.25,.6),this.shapeColor2=new oimo_common_Vec3(1,.8,.1),this.shapeColor1=new oimo_common_Vec3(.7,.2,.4)},oimo_dynamics_common_Performance=function(){},oimo_dynamics_constraint_ConstraintSolver=function(){this._b1=null,this._b2=null,this._addedToIsland=!1};oimo_dynamics_constraint_ConstraintSolver.prototype={preSolveVelocity:function(){},warmStart:function(){},solveVelocity:function(){},postSolveVelocity:function(){},preSolvePosition:function(){},solvePositionSplitImpulse:function(){},solvePositionNgs:function(){},postSolve:function(){}};var oimo_dynamics_constraint_PositionCorrectionAlgorithm=function(){},oimo_dynamics_constraint_contact_ContactConstraint=function(o){this._solver=new oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver(this),this._manifold=o};oimo_dynamics_constraint_contact_ContactConstraint.prototype={_getVelocitySolverInfo:function(y,t){var i,z,Y,Z,I,V,L,B,k;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,z=this._manifold._normalY,Y=this._manifold._normalZ,Z=this._manifold._tangentX,I=this._manifold._tangentY,V=this._manifold._tangentZ,L=this._manifold._binormalX,B=this._manifold._binormalY,k=this._manifold._binormalZ;var A=Math.sqrt(this._s1._friction*this._s2._friction),c=Math.sqrt(this._s1._restitution*this._s2._restitution),m=this._manifold._numPoints;t.numRows=0,this._tf1._positionX,this._tf2._positionX,this._tf1._positionY,this._tf2._positionY,this._tf1._positionZ,this._tf2._positionZ;for(var p=0;p<m;){var P=p++,b=this._manifold._points[P];if(0>b._depth){b._disabled=!0;var f=b._impulse;f.impulseN=0,f.impulseT=0,f.impulseB=0,f.impulseP=0,f.impulseLX=0,f.impulseLY=0,f.impulseLZ=0}else{b._disabled=!1;var d=t.rows[t.numRows++];d.friction=A,d.cfm=0;var x=d.jacobianN;x.lin1X=i,x.lin1Y=z,x.lin1Z=Y,x.lin2X=i,x.lin2Y=z,x.lin2Z=Y,x.ang1X=b._relPos1Y*Y-b._relPos1Z*z,x.ang1Y=b._relPos1Z*i-b._relPos1X*Y,x.ang1Z=b._relPos1X*z-b._relPos1Y*i,x.ang2X=b._relPos2Y*Y-b._relPos2Z*z,x.ang2Y=b._relPos2Z*i-b._relPos2X*Y,x.ang2Z=b._relPos2X*z-b._relPos2Y*i,(x=d.jacobianT).lin1X=Z,x.lin1Y=I,x.lin1Z=V,x.lin2X=Z,x.lin2Y=I,x.lin2Z=V,x.ang1X=b._relPos1Y*V-b._relPos1Z*I,x.ang1Y=b._relPos1Z*Z-b._relPos1X*V,x.ang1Z=b._relPos1X*I-b._relPos1Y*Z,x.ang2X=b._relPos2Y*V-b._relPos2Z*I,x.ang2Y=b._relPos2Z*Z-b._relPos2X*V,x.ang2Z=b._relPos2X*I-b._relPos2Y*Z,(x=d.jacobianB).lin1X=L,x.lin1Y=B,x.lin1Z=k,x.lin2X=L,x.lin2Y=B,x.lin2Z=k,x.ang1X=b._relPos1Y*k-b._relPos1Z*B,x.ang1Y=b._relPos1Z*L-b._relPos1X*k,x.ang1Z=b._relPos1X*B-b._relPos1Y*L,x.ang2X=b._relPos2Y*k-b._relPos2Z*B,x.ang2Y=b._relPos2Z*L-b._relPos2X*k,x.ang2Z=b._relPos2X*B-b._relPos2Y*L;var T=(x=d.jacobianN).lin1X*this._b1._velX+x.lin1Y*this._b1._velY+x.lin1Z*this._b1._velZ+(x.ang1X*this._b1._angVelX+x.ang1Y*this._b1._angVelY+x.ang1Z*this._b1._angVelZ)-(x.lin2X*this._b2._velX+x.lin2Y*this._b2._velY+x.lin2Z*this._b2._velZ+(x.ang2X*this._b2._angVelX+x.ang2Y*this._b2._angVelY+x.ang2Z*this._b2._angVelZ));if(d.rhs=T<-oimo_common_Setting.contactEnableBounceThreshold&&!b._warmStarted?-T*c:0,this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE&&b._depth>oimo_common_Setting.linearSlop){var g=(b._depth-oimo_common_Setting.linearSlop)*oimo_common_Setting.velocityBaumgarte*y.invDt;d.rhs<g&&(d.rhs=g)}if(!b._warmStarted){var M=b._impulse;M.impulseN=0,M.impulseT=0,M.impulseB=0,M.impulseP=0,M.impulseLX=0,M.impulseLY=0,M.impulseLZ=0}d.impulse=b._impulse}}},_getPositionSolverInfo:function(_){var t,c,p;_.b1=this._b1,_.b2=this._b2,t=this._manifold._normalX,c=this._manifold._normalY,p=this._manifold._normalZ;var m=this._manifold._numPoints;_.numRows=0;for(var n=0;n<m;){var b=n++,r=this._manifold._points[b];if(!r._disabled){var e=_.rows[_.numRows++],x=e.jacobianN;x.lin1X=t,x.lin1Y=c,x.lin1Z=p,x.lin2X=t,x.lin2Y=c,x.lin2Z=p,x.ang1X=r._relPos1Y*p-r._relPos1Z*c,x.ang1Y=r._relPos1Z*t-r._relPos1X*p,x.ang1Z=r._relPos1X*c-r._relPos1Y*t,x.ang2X=r._relPos2Y*p-r._relPos2Z*c,x.ang2Y=r._relPos2Z*t-r._relPos2X*p,x.ang2Z=r._relPos2X*c-r._relPos2Y*t,e.rhs=r._depth-oimo_common_Setting.linearSlop,0>e.rhs&&(e.rhs=0),e.impulse=r._impulse}}},_syncManifold:function(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)},getShape1:function(){return this._s1},getShape2:function(){return this._s2},getManifold:function(){return this._manifold},isTouching:function(){for(var a=0,n=this._manifold._numPoints,i;a<n;)if(i=a++,0<=this._manifold._points[i]._depth)return!0;return!1}};var oimo_dynamics_constraint_contact_ContactImpulse=function(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0};oimo_dynamics_constraint_contact_ContactImpulse.prototype={copyFrom:function(o){this.impulseN=o.impulseN,this.impulseT=o.impulseT,this.impulseB=o.impulseB,this.impulseLX=o.impulseLX,this.impulseLY=o.impulseLY,this.impulseLZ=o.impulseLZ}};var oimo_dynamics_constraint_contact_Manifold=function(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var _=oimo_common_Setting.maxManifoldPoints,t=Array(_);this._points=t;for(var i=0,e=oimo_common_Setting.maxManifoldPoints,a;i<e;)a=i++,this._points[a]=new oimo_dynamics_constraint_contact_ManifoldPoint};oimo_dynamics_constraint_contact_Manifold.prototype={_clear:function(){for(var _=0,e=this._numPoints;_<e;){var i=_++,o=this._points[i];o._localPos1X=0,o._localPos1Y=0,o._localPos1Z=0,o._localPos2X=0,o._localPos2Y=0,o._localPos2Z=0,o._relPos1X=0,o._relPos1Y=0,o._relPos1Z=0,o._relPos2X=0,o._relPos2Y=0,o._relPos2Z=0,o._pos1X=0,o._pos1Y=0,o._pos1Z=0,o._pos2X=0,o._pos2Y=0,o._pos2Z=0,o._depth=0;var a=o._impulse;a.impulseN=0,a.impulseT=0,a.impulseB=0,a.impulseP=0,a.impulseLX=0,a.impulseLY=0,a.impulseLZ=0,o._warmStarted=!1,o._disabled=!1,o._id=-1}this._numPoints=0},_buildBasis:function(x){var t=x;this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;var i=x.x,e=x.y,d=x.z,l=i*i,c=e*e,m=d*d,p,g,X,u,z,Y;if(l<c){if(l<m){var Z=1/Math.sqrt(c+m);p=0,u=e*(X=e*Z)-d*(g=-d*Z),z=-i*X,Y=i*g}else{var v=1/Math.sqrt(l+c);X=0,u=-d*(g=i*v),z=d*(p=-e*v),Y=i*g-e*p}}else if(c<m){var y=1/Math.sqrt(l+m);g=0,u=e*(X=-i*y),z=d*(p=d*y)-i*X,Y=-e*p}else{var b=1/Math.sqrt(l+c);X=0,u=-d*(g=i*b),z=d*(p=-e*b),Y=i*g-e*p}this._tangentX=p,this._tangentY=g,this._tangentZ=X,this._binormalX=u,this._binormalY=z,this._binormalZ=Y},_updateDepthsAndPositions:function(b,t){for(var i=0,x=this._numPoints;i<x;){var a=i++,p=this._points[a],d,f,g,v,X,u,z,Y,Z;d=b._rotation00*p._localPos1X+b._rotation01*p._localPos1Y+b._rotation02*p._localPos1Z,f=b._rotation10*p._localPos1X+b._rotation11*p._localPos1Y+b._rotation12*p._localPos1Z,g=b._rotation20*p._localPos1X+b._rotation21*p._localPos1Y+b._rotation22*p._localPos1Z,p._relPos1X=d,p._relPos1Y=f,p._relPos1Z=g,v=t._rotation00*p._localPos2X+t._rotation01*p._localPos2Y+t._rotation02*p._localPos2Z,X=t._rotation10*p._localPos2X+t._rotation11*p._localPos2Y+t._rotation12*p._localPos2Z,u=t._rotation20*p._localPos2X+t._rotation21*p._localPos2Y+t._rotation22*p._localPos2Z,p._relPos2X=v,p._relPos2Y=X,p._relPos2Z=u,p._pos1X=p._relPos1X+b._positionX,p._pos1Y=p._relPos1Y+b._positionY,p._pos1Z=p._relPos1Z+b._positionZ,p._pos2X=p._relPos2X+t._positionX,p._pos2Y=p._relPos2Y+t._positionY,p._pos2Z=p._relPos2Z+t._positionZ,z=p._pos1X-p._pos2X,Y=p._pos1Y-p._pos2Y,Z=p._pos1Z-p._pos2Z;var I=z*this._normalX+Y*this._normalY+Z*this._normalZ;p._depth=-I}},getNormal:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,o},getNormalTo:function(o){var t=o;t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ},getTangent:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,o},getTangentTo:function(o){var t=o;t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ},getBinormal:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,o},getBinormalTo:function(o){var t=o;t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ},getPoints:function(){return this._points},getNumPoints:function(){return this._numPoints}};var oimo_dynamics_constraint_contact_ManifoldPoint=function(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new oimo_dynamics_constraint_contact_ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1};oimo_dynamics_constraint_contact_ManifoldPoint.prototype={getPosition1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,o},getPosition1To:function(o){var t=o;t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z},getPosition2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,o},getPosition2To:function(o){var t=o;t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z},getDepth:function(){return this._depth},isWarmStarted:function(){return this._warmStarted},getNormalImpulse:function(){return this._impulse.impulseN},getTangentImpulse:function(){return this._impulse.impulseT},getBinormalImpulse:function(){return this._impulse.impulseB},isEnabled:function(){return!this._disabled}};var oimo_dynamics_constraint_contact_ManifoldUpdater=function(_){this._manifold=_,this.numOldPoints=0;var t=oimo_common_Setting.maxManifoldPoints,i=Array(t);this.oldPoints=i;for(var o=0,e=oimo_common_Setting.maxManifoldPoints,n;o<e;)n=o++,this.oldPoints[n]=new oimo_dynamics_constraint_contact_ManifoldPoint};oimo_dynamics_constraint_contact_ManifoldUpdater.prototype={removeOutdatedPoints:function(){for(var _=this._manifold._numPoints;0<=--_;){var e=this._manifold._points[_],n,r,l;n=e._pos1X-e._pos2X,r=e._pos1Y-e._pos2Y,l=e._pos1Z-e._pos2Z;var c=this._manifold._normalX*n+this._manifold._normalY*r+this._manifold._normalZ*l;c>oimo_common_Setting.contactPersistenceThreshold?this.removeManifoldPoint(_):(n+=this._manifold._normalX*-c)*n+(r+=this._manifold._normalY*-c)*r+(l+=this._manifold._normalZ*-c)*l>oimo_common_Setting.contactPersistenceThreshold*oimo_common_Setting.contactPersistenceThreshold&&this.removeManifoldPoint(_)}},removeManifoldPoint:function(_){var t=--this._manifold._numPoints;if(_!=t){var i=this._manifold._points[_];this._manifold._points[_]=this._manifold._points[t],this._manifold._points[t]=i}var o=this._manifold._points[t];o._localPos1X=0,o._localPos1Y=0,o._localPos1Z=0,o._localPos2X=0,o._localPos2Y=0,o._localPos2Z=0,o._relPos1X=0,o._relPos1Y=0,o._relPos1Z=0,o._relPos2X=0,o._relPos2Y=0,o._relPos2Z=0,o._pos1X=0,o._pos1Y=0,o._pos1Z=0,o._pos2X=0,o._pos2Y=0,o._pos2Z=0,o._depth=0;var a=o._impulse;a.impulseN=0,a.impulseT=0,a.impulseB=0,a.impulseP=0,a.impulseLX=0,a.impulseLY=0,a.impulseLZ=0,o._warmStarted=!1,o._disabled=!1,o._id=-1},addManifoldPoint:function(Y,t,i){var o=this._manifold._numPoints;if(o==oimo_common_Setting.maxManifoldPoints){var a=this.computeTargetIndex(Y,t,i),n=this._manifold._points[a],s=Y.position1;n._pos1X=s.x,n._pos1Y=s.y,n._pos1Z=s.z;var _=Y.position2,p,Z,I,V,L,B;n._pos2X=_.x,n._pos2Y=_.y,n._pos2Z=_.z,n._relPos1X=n._pos1X-t._positionX,n._relPos1Y=n._pos1Y-t._positionY,n._relPos1Z=n._pos1Z-t._positionZ,n._relPos2X=n._pos2X-i._positionX,n._relPos2Y=n._pos2Y-i._positionY,n._relPos2Z=n._pos2Z-i._positionZ,p=t._rotation00*n._relPos1X+t._rotation10*n._relPos1Y+t._rotation20*n._relPos1Z,Z=t._rotation01*n._relPos1X+t._rotation11*n._relPos1Y+t._rotation21*n._relPos1Z,I=t._rotation02*n._relPos1X+t._rotation12*n._relPos1Y+t._rotation22*n._relPos1Z,n._localPos1X=p,n._localPos1Y=Z,n._localPos1Z=I,V=i._rotation00*n._relPos2X+i._rotation10*n._relPos2Y+i._rotation20*n._relPos2Z,L=i._rotation01*n._relPos2X+i._rotation11*n._relPos2Y+i._rotation21*n._relPos2Z,B=i._rotation02*n._relPos2X+i._rotation12*n._relPos2Y+i._rotation22*n._relPos2Z,n._localPos2X=V,n._localPos2Y=L,n._localPos2Z=B,n._depth=Y.depth;var k=n._impulse;return k.impulseN=0,k.impulseT=0,k.impulseB=0,k.impulseP=0,k.impulseLX=0,k.impulseLY=0,k.impulseLZ=0,n._id=Y.id,n._warmStarted=!1,void(n._disabled=!1)}var v=this._manifold._points[o],y=Y.position1;v._pos1X=y.x,v._pos1Y=y.y,v._pos1Z=y.z;var b=Y.position2,X,A,P,T,w,S;v._pos2X=b.x,v._pos2Y=b.y,v._pos2Z=b.z,v._relPos1X=v._pos1X-t._positionX,v._relPos1Y=v._pos1Y-t._positionY,v._relPos1Z=v._pos1Z-t._positionZ,v._relPos2X=v._pos2X-i._positionX,v._relPos2Y=v._pos2Y-i._positionY,v._relPos2Z=v._pos2Z-i._positionZ,X=t._rotation00*v._relPos1X+t._rotation10*v._relPos1Y+t._rotation20*v._relPos1Z,A=t._rotation01*v._relPos1X+t._rotation11*v._relPos1Y+t._rotation21*v._relPos1Z,P=t._rotation02*v._relPos1X+t._rotation12*v._relPos1Y+t._rotation22*v._relPos1Z,v._localPos1X=X,v._localPos1Y=A,v._localPos1Z=P,T=i._rotation00*v._relPos2X+i._rotation10*v._relPos2Y+i._rotation20*v._relPos2Z,w=i._rotation01*v._relPos2X+i._rotation11*v._relPos2Y+i._rotation21*v._relPos2Z,S=i._rotation02*v._relPos2X+i._rotation12*v._relPos2Y+i._rotation22*v._relPos2Z,v._localPos2X=T,v._localPos2Y=w,v._localPos2Z=S,v._depth=Y.depth;var C=v._impulse;C.impulseN=0,C.impulseT=0,C.impulseB=0,C.impulseP=0,C.impulseLX=0,C.impulseLY=0,C.impulseLZ=0,v._id=Y.id,v._warmStarted=!1,v._disabled=!1,this._manifold._numPoints++},computeTargetIndex:function(o,t){var i=this._manifold._points[0],_=this._manifold._points[1],r=this._manifold._points[2],e=this._manifold._points[3],h=i._depth,po=0,bo,xo,yo;_._depth>h&&(h=_._depth,po=1),r._depth>h&&(h=r._depth,po=2),e._depth>h&&(h=e._depth,po=3);var fo=o.position1;bo=fo.x,xo=fo.y,yo=fo.z,bo-=t._positionX,xo-=t._positionY,yo-=t._positionZ;var m=_._relPos1X,go=_._relPos1Y,vo=_._relPos1Z,Xo=r._relPos1X,uo=r._relPos1Y,zo=r._relPos1Z,Yo=e._relPos1X,Zo=e._relPos1Y,Io=e._relPos1Z,Mo=(Ia=(sa=uo-go)*(ma=yo-Io)-(la=zo-vo)*(pa=xo-Zo))*Ia+(Ma=la*(ca=bo-Yo)-(ra=Xo-m)*ma)*Ma+(ha=ra*pa-sa*ca)*ha,Vo=(Va=(xa=Zo-go)*(ga=yo-zo)-(da=Io-vo)*(fa=xo-uo))*Va+(La=da*(ya=bo-Xo)-(ba=Yo-m)*ga)*La+(Ba=ba*fa-xa*ya)*Ba,Lo=(ka=(Xa=xo-go)*(Za=Io-zo)-(ua=yo-vo)*(Ya=Zo-uo))*ka+(Aa=ua*(za=Yo-Xo)-(va=bo-m)*Za)*Aa+(Pa=va*Ya-Xa*za)*Pa,Bo=Mo>Vo?Mo>Lo?Mo:Lo:Vo>Lo?Vo:Lo,ko=i._relPos1X,Ao=i._relPos1Y,Po=i._relPos1Z,To=r._relPos1X,wo=r._relPos1Y,So=r._relPos1Z,Co=e._relPos1X,qo=e._relPos1Y,Ro=e._relPos1Z,Eo=(Ka=(wa=wo-Ao)*(Ra=yo-Ro)-(Sa=So-Po)*(qa=xo-qo))*Ka+($a=Sa*(Ca=bo-Co)-(Ta=To-ko)*Ra)*$a+(pi=Ta*qa-wa*Ca)*pi,jo=(bi=(ja=qo-Ao)*(Wa=yo-So)-(Na=Ro-Po)*(Da=xo-wo))*bi+(xi=Na*(Fa=bo-To)-(Ea=Co-ko)*Wa)*xi+(di=Ea*Da-ja*Fa)*di,No=(yi=(Oa=xo-Ao)*(Qa=Ro-So)-(Ha=yo-Po)*(Ua=qo-wo))*yi+(fi=Ha*(Ja=Co-To)-(Ga=bo-ko)*Qa)*fi+(gi=Ga*Ua-Oa*Ja)*gi,Fo=Eo>jo?Eo>No?Eo:No:jo>No?jo:No,Do=i._relPos1X,Wo=i._relPos1Y,Go=i._relPos1Z,Oo=_._relPos1X,Ho=_._relPos1Y,Jo=_._relPos1Z,Uo=e._relPos1X,Qo=e._relPos1Y,Ko=e._relPos1Z,$o=(qi=(Xi=Ho-Wo)*(Zi=yo-Ko)-(ui=Jo-Go)*(Yi=xo-Qo))*qi+(Ri=ui*(zi=bo-Uo)-(vi=Oo-Do)*Zi)*Ri+(Ei=vi*Yi-Xi*zi)*Ei,ta=(ji=(Mi=Qo-Wo)*(ki=yo-Jo)-(Vi=Ko-Go)*(Bi=xo-Ho))*ji+(Ni=Vi*(Li=bo-Oo)-(Ii=Uo-Do)*ki)*Ni+(Fi=Ii*Bi-Mi*Li)*Fi,oa=(Di=(Pi=xo-Wo)*(Ci=Ko-Jo)-(Ti=yo-Go)*(Si=Qo-Ho))*Di+(Wi=Ti*(wi=Uo-Oo)-(Ai=bo-Do)*Ci)*Wi+(Gi=Ai*Si-Pi*wi)*Gi,aa=$o>ta?$o>oa?$o:oa:ta>oa?ta:oa,ia=i._relPos1X,na=i._relPos1Y,_a=i._relPos1Z,to=_._relPos1X,io=_._relPos1Y,oo=_._relPos1Z,ao=r._relPos1X,no=r._relPos1Y,so=r._relPos1Z,_o=(mn=(Hi=io-na)*(Ki=yo-so)-(Ji=oo-_a)*(Qi=xo-no))*mn+(bn=Ji*(Ui=bo-ao)-(Oi=to-ia)*Ki)*bn+(xn=Oi*Qi-Hi*Ui)*xn,ro=(dn=(tn=no-na)*(_n=yo-oo)-(on=so-_a)*(nn=xo-io))*dn+(yn=on*(an=bo-to)-($i=ao-ia)*_n)*yn+(fn=$i*nn-tn*an)*fn,eo=(gn=(rn=xo-na)*(pn=so-oo)-(sn=yo-_a)*(cn=no-io))*gn+(vn=sn*(ln=ao-to)-(en=bo-ia)*pn)*vn+(Xn=en*cn-rn*ln)*Xn,ho=_o>ro?_o>eo?_o:eo:ro>eo?ro:eo,lo=Bo,ea=0,ra,sa,la,ca,pa,ma,ba,xa,da,ya,fa,ga,va,Xa,ua,za,Ya,Za,Ia,Ma,ha,Va,La,Ba,ka,Aa,Pa,Ta,wa,Sa,Ca,qa,Ra,Ea,ja,Na,Fa,Da,Wa,Ga,Oa,Ha,Ja,Ua,Qa,Ka,$a,pi,bi,xi,di,yi,fi,gi,vi,Xi,ui,zi,Yi,Zi,Ii,Mi,Vi,Li,Bi,ki,Ai,Pi,Ti,wi,Si,Ci,qi,Ri,Ei,ji,Ni,Fi,Di,Wi,Gi,Oi,Hi,Ji,Ui,Qi,Ki,$i,tn,on,an,nn,_n,en,rn,sn,ln,cn,pn,mn,bn,xn,dn,yn,fn,gn,vn,Xn;return(Fo>lo&&1!=po||0==po)&&(lo=Fo,ea=1),aa>lo&&2!=po&&(lo=aa,ea=2),ho>lo&&3!=po&&(lo=ho,ea=3),ea},computeRelativePositions:function(p,t){for(var i=0,m=this._manifold._numPoints;i<m;){var a=i++,l=this._manifold._points[a],c,b,x,d,y,f;c=p._rotation00*l._localPos1X+p._rotation01*l._localPos1Y+p._rotation02*l._localPos1Z,b=p._rotation10*l._localPos1X+p._rotation11*l._localPos1Y+p._rotation12*l._localPos1Z,x=p._rotation20*l._localPos1X+p._rotation21*l._localPos1Y+p._rotation22*l._localPos1Z,l._relPos1X=c,l._relPos1Y=b,l._relPos1Z=x,d=t._rotation00*l._localPos2X+t._rotation01*l._localPos2Y+t._rotation02*l._localPos2Z,y=t._rotation10*l._localPos2X+t._rotation11*l._localPos2Y+t._rotation12*l._localPos2Z,f=t._rotation20*l._localPos2X+t._rotation21*l._localPos2Y+t._rotation22*l._localPos2Z,l._relPos2X=d,l._relPos2Y=y,l._relPos2Z=f,l._warmStarted=!0}},findNearestContactPointIndex:function(Z,t,i){for(var o=oimo_common_Setting.contactPersistenceThreshold*oimo_common_Setting.contactPersistenceThreshold,I=-1,V=0,L=this._manifold._numPoints;V<L;){var _=V++,p=this._manifold._points[_],v=Z.position1,y,B,k,A,P,T;y=v.x,B=v.y,k=v.z;var w=Z.position2,M,S,C,q,R,E;A=w.x,P=w.y,T=w.z,y-=t._positionX,B-=t._positionY,k-=t._positionZ,A-=i._positionX,P-=i._positionY,T-=i._positionZ;var j=(M=p._relPos1X-y)*M+(S=p._relPos1Y-B)*S+(C=p._relPos1Z-k)*C,X=(q=p._relPos2X-A)*q+(R=p._relPos2Y-P)*R+(E=p._relPos2Z-T)*E,z=j<X?j:X;z<o&&(o=z,I=_)}return I},totalUpdate:function(l,t,i){this.numOldPoints=this._manifold._numPoints;for(var o=0,I=this.numOldPoints;o<I;){var n=o++,s=this.oldPoints[n],_=this._manifold._points[n];s._localPos1X=_._localPos1X,s._localPos1Y=_._localPos1Y,s._localPos1Z=_._localPos1Z,s._localPos2X=_._localPos2X,s._localPos2Y=_._localPos2Y,s._localPos2Z=_._localPos2Z,s._relPos1X=_._relPos1X,s._relPos1Y=_._relPos1Y,s._relPos1Z=_._relPos1Z,s._relPos2X=_._relPos2X,s._relPos2Y=_._relPos2Y,s._relPos2Z=_._relPos2Z,s._pos1X=_._pos1X,s._pos1Y=_._pos1Y,s._pos1Z=_._pos1Z,s._pos2X=_._pos2X,s._pos2Y=_._pos2Y,s._pos2Z=_._pos2Z,s._depth=_._depth,s._impulse.copyFrom(_._impulse),s._id=_._id,s._warmStarted=_._warmStarted,s._disabled=!1}var r=l.numPoints;this._manifold._numPoints=r;for(var e=0;e<r;){var V=e++,c=this._manifold._points[V],m=l.points[V],p=m.position1;c._pos1X=p.x,c._pos1Y=p.y,c._pos1Z=p.z;var v=m.position2,g,L,B,k,A,P;c._pos2X=v.x,c._pos2Y=v.y,c._pos2Z=v.z,c._relPos1X=c._pos1X-t._positionX,c._relPos1Y=c._pos1Y-t._positionY,c._relPos1Z=c._pos1Z-t._positionZ,c._relPos2X=c._pos2X-i._positionX,c._relPos2Y=c._pos2Y-i._positionY,c._relPos2Z=c._pos2Z-i._positionZ,g=t._rotation00*c._relPos1X+t._rotation10*c._relPos1Y+t._rotation20*c._relPos1Z,L=t._rotation01*c._relPos1X+t._rotation11*c._relPos1Y+t._rotation21*c._relPos1Z,B=t._rotation02*c._relPos1X+t._rotation12*c._relPos1Y+t._rotation22*c._relPos1Z,c._localPos1X=g,c._localPos1Y=L,c._localPos1Z=B,k=i._rotation00*c._relPos2X+i._rotation10*c._relPos2Y+i._rotation20*c._relPos2Z,A=i._rotation01*c._relPos2X+i._rotation11*c._relPos2Y+i._rotation21*c._relPos2Z,P=i._rotation02*c._relPos2X+i._rotation12*c._relPos2Y+i._rotation22*c._relPos2Z,c._localPos2X=k,c._localPos2Y=A,c._localPos2Z=P,c._depth=m.depth;var T=c._impulse;T.impulseN=0,T.impulseT=0,T.impulseB=0,T.impulseP=0,T.impulseLX=0,T.impulseLY=0,T.impulseLZ=0,c._id=m.id,c._warmStarted=!1,c._disabled=!1;for(var M=0,w=this.numOldPoints;M<w;){var z=M++,Y=this.oldPoints[z];if(c._id==Y._id){c._impulse.copyFrom(Y._impulse),c._warmStarted=!0;break}}}},incrementalUpdate:function(x,t,i){this._manifold._updateDepthsAndPositions(t,i);for(var o=0,d=this._manifold._numPoints,n;o<d;)n=o++,this._manifold._points[n]._warmStarted=!0;var f=x.points[0],_=this.findNearestContactPointIndex(f,t,i);if(-1==_)this.addManifoldPoint(f,t,i);else{var r=this._manifold._points[_],e=f.position1;r._pos1X=e.x,r._pos1Y=e.y,r._pos1Z=e.z;var g=f.position2,b,X,u,z,Y,Z;r._pos2X=g.x,r._pos2Y=g.y,r._pos2Z=g.z,r._relPos1X=r._pos1X-t._positionX,r._relPos1Y=r._pos1Y-t._positionY,r._relPos1Z=r._pos1Z-t._positionZ,r._relPos2X=r._pos2X-i._positionX,r._relPos2Y=r._pos2Y-i._positionY,r._relPos2Z=r._pos2Z-i._positionZ,b=t._rotation00*r._relPos1X+t._rotation10*r._relPos1Y+t._rotation20*r._relPos1Z,X=t._rotation01*r._relPos1X+t._rotation11*r._relPos1Y+t._rotation21*r._relPos1Z,u=t._rotation02*r._relPos1X+t._rotation12*r._relPos1Y+t._rotation22*r._relPos1Z,r._localPos1X=b,r._localPos1Y=X,r._localPos1Z=u,z=i._rotation00*r._relPos2X+i._rotation10*r._relPos2Y+i._rotation20*r._relPos2Z,Y=i._rotation01*r._relPos2X+i._rotation11*r._relPos2Y+i._rotation21*r._relPos2Z,Z=i._rotation02*r._relPos2X+i._rotation12*r._relPos2Y+i._rotation22*r._relPos2Z,r._localPos2X=z,r._localPos2Y=Y,r._localPos2Z=Z,r._depth=f.depth}this.removeOutdatedPoints()}};var oimo_dynamics_constraint_info_JacobianRow=function(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0};oimo_dynamics_constraint_info_JacobianRow.prototype={updateSparsity:function(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}};var oimo_dynamics_constraint_info_contact_ContactSolverInfo=function(){this.b1=null,this.b2=null,this.numRows=0;var _=oimo_common_Setting.maxManifoldPoints,t=Array(_);this.rows=t;for(var i=0,e=this.rows.length,a;i<e;)a=i++,this.rows[a]=new oimo_dynamics_constraint_info_contact_ContactSolverInfoRow},oimo_dynamics_constraint_info_contact_ContactSolverInfoRow=function(){this.jacobianN=new oimo_dynamics_constraint_info_JacobianRow,this.jacobianT=new oimo_dynamics_constraint_info_JacobianRow,this.jacobianB=new oimo_dynamics_constraint_info_JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null},oimo_dynamics_constraint_info_joint_JointSolverInfo=function(){this.b1=null,this.b2=null,this.numRows=0;var _=oimo_common_Setting.maxJacobianRows,t=Array(_);this.rows=t;for(var i=0,e=this.rows.length,a;i<e;)a=i++,this.rows[a]=new oimo_dynamics_constraint_info_joint_JointSolverInfoRow},oimo_dynamics_constraint_info_joint_JointSolverInfoRow=function(){this.jacobian=new oimo_dynamics_constraint_info_JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null},oimo_dynamics_constraint_joint_Joint=function(l,t){switch(this._link1=new oimo_dynamics_constraint_joint_JointLink(this),this._link2=new oimo_dynamics_constraint_joint_JointLink(this),this._positionCorrectionAlgorithm=oimo_common_Setting.defaultJointPositionCorrectionAlgorithm,this._type=t,this._world=null,this._b1=l.rigidBody1,this._b2=l.rigidBody2,this._allowCollision=l.allowCollision,this._breakForce=l.breakForce,this._breakTorque=l.breakTorque,l.solverType){case 0:this._solver=new oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver(this);break;case 1:this._solver=new oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver(this);}var i=l.localAnchor1;this._localAnchor1X=i.x,this._localAnchor1Y=i.y,this._localAnchor1Z=i.z;var o=l.localAnchor2;this._localAnchor2X=o.x,this._localAnchor2Y=o.y,this._localAnchor2Z=o.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var a=oimo_common_Setting.maxJacobianRows,n=Array(a);this._impulses=n;for(var s=0,c=oimo_common_Setting.maxJacobianRows,r;s<c;)r=s++,this._impulses[r]=new oimo_dynamics_constraint_joint_JointImpulse};oimo_dynamics_constraint_joint_Joint.prototype={_syncAnchors:function(){var Z=this._b1._transform,z=this._b2._transform,Y,I,V,L,B,k,A,P,T,w,S,C,q,R,E,j,N,F,D,W,G,O,H,J;Y=Z._rotation00*this._localAnchor1X+Z._rotation01*this._localAnchor1Y+Z._rotation02*this._localAnchor1Z,I=Z._rotation10*this._localAnchor1X+Z._rotation11*this._localAnchor1Y+Z._rotation12*this._localAnchor1Z,V=Z._rotation20*this._localAnchor1X+Z._rotation21*this._localAnchor1Y+Z._rotation22*this._localAnchor1Z,this._relativeAnchor1X=Y,this._relativeAnchor1Y=I,this._relativeAnchor1Z=V,L=z._rotation00*this._localAnchor2X+z._rotation01*this._localAnchor2Y+z._rotation02*this._localAnchor2Z,B=z._rotation10*this._localAnchor2X+z._rotation11*this._localAnchor2Y+z._rotation12*this._localAnchor2Z,k=z._rotation20*this._localAnchor2X+z._rotation21*this._localAnchor2Y+z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=L,this._relativeAnchor2Y=B,this._relativeAnchor2Z=k,this._anchor1X=this._relativeAnchor1X+Z._positionX,this._anchor1Y=this._relativeAnchor1Y+Z._positionY,this._anchor1Z=this._relativeAnchor1Z+Z._positionZ,this._anchor2X=this._relativeAnchor2X+z._positionX,this._anchor2Y=this._relativeAnchor2Y+z._positionY,this._anchor2Z=this._relativeAnchor2Z+z._positionZ,A=Z._rotation00*this._localBasisX1X+Z._rotation01*this._localBasisX1Y+Z._rotation02*this._localBasisX1Z,P=Z._rotation10*this._localBasisX1X+Z._rotation11*this._localBasisX1Y+Z._rotation12*this._localBasisX1Z,T=Z._rotation20*this._localBasisX1X+Z._rotation21*this._localBasisX1Y+Z._rotation22*this._localBasisX1Z,this._basisX1X=A,this._basisX1Y=P,this._basisX1Z=T,w=Z._rotation00*this._localBasisY1X+Z._rotation01*this._localBasisY1Y+Z._rotation02*this._localBasisY1Z,S=Z._rotation10*this._localBasisY1X+Z._rotation11*this._localBasisY1Y+Z._rotation12*this._localBasisY1Z,C=Z._rotation20*this._localBasisY1X+Z._rotation21*this._localBasisY1Y+Z._rotation22*this._localBasisY1Z,this._basisY1X=w,this._basisY1Y=S,this._basisY1Z=C,q=Z._rotation00*this._localBasisZ1X+Z._rotation01*this._localBasisZ1Y+Z._rotation02*this._localBasisZ1Z,R=Z._rotation10*this._localBasisZ1X+Z._rotation11*this._localBasisZ1Y+Z._rotation12*this._localBasisZ1Z,E=Z._rotation20*this._localBasisZ1X+Z._rotation21*this._localBasisZ1Y+Z._rotation22*this._localBasisZ1Z,this._basisZ1X=q,this._basisZ1Y=R,this._basisZ1Z=E,j=z._rotation00*this._localBasisX2X+z._rotation01*this._localBasisX2Y+z._rotation02*this._localBasisX2Z,N=z._rotation10*this._localBasisX2X+z._rotation11*this._localBasisX2Y+z._rotation12*this._localBasisX2Z,F=z._rotation20*this._localBasisX2X+z._rotation21*this._localBasisX2Y+z._rotation22*this._localBasisX2Z,this._basisX2X=j,this._basisX2Y=N,this._basisX2Z=F,D=z._rotation00*this._localBasisY2X+z._rotation01*this._localBasisY2Y+z._rotation02*this._localBasisY2Z,W=z._rotation10*this._localBasisY2X+z._rotation11*this._localBasisY2Y+z._rotation12*this._localBasisY2Z,G=z._rotation20*this._localBasisY2X+z._rotation21*this._localBasisY2Y+z._rotation22*this._localBasisY2Z,this._basisY2X=D,this._basisY2Y=W,this._basisY2Z=G,O=z._rotation00*this._localBasisZ2X+z._rotation01*this._localBasisZ2Y+z._rotation02*this._localBasisZ2Z,H=z._rotation10*this._localBasisZ2X+z._rotation11*this._localBasisZ2Y+z._rotation12*this._localBasisZ2Z,J=z._rotation20*this._localBasisZ2X+z._rotation21*this._localBasisZ2Y+z._rotation22*this._localBasisZ2Z,this._basisZ2X=O,this._basisZ2Y=H,this._basisZ2Z=J},_getVelocitySolverInfo:function(o,t){t.b1=this._b1,t.b2=this._b2,t.numRows=0},_getPositionSolverInfo:function(o){o.b1=this._b1,o.b2=this._b2,o.numRows=0},_checkDestruction:function(){var o=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;0<this._breakForce&&o>this._breakForce*this._breakForce?this._world.removeJoint(this):0<this._breakTorque&&t>this._breakTorque*this._breakTorque&&this._world.removeJoint(this)},getRigidBody1:function(){return this._b1},getRigidBody2:function(){return this._b2},getType:function(){return this._type},getAnchor1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,o},getAnchor2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,o},getAnchor1To:function(o){var t=o;t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z},getAnchor2To:function(o){var t=o;t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z},getLocalAnchor1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,o},getLocalAnchor2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,o},getLocalAnchor1To:function(o){var t=o;t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z},getLocalAnchor2To:function(o){var t=o;t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z},getBasis1:function(){var c=new oimo_common_Mat3,p,m,b,x,d,y,f,g,v;p=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,x=this._basisX1Y,d=this._basisY1Y,y=this._basisZ1Y,f=this._basisX1Z,g=this._basisY1Z,v=this._basisZ1Z;var X=c;return X.e00=p,X.e01=m,X.e02=b,X.e10=x,X.e11=d,X.e12=y,X.e20=f,X.e21=g,X.e22=v,c},getBasis2:function(){var c=new oimo_common_Mat3,p,m,b,x,d,y,f,g,v;p=this._basisX2X,m=this._basisY2X,b=this._basisZ2X,x=this._basisX2Y,d=this._basisY2Y,y=this._basisZ2Y,f=this._basisX2Z,g=this._basisY2Z,v=this._basisZ2Z;var X=c;return X.e00=p,X.e01=m,X.e02=b,X.e10=x,X.e11=d,X.e12=y,X.e20=f,X.e21=g,X.e22=v,c},getBasis1To:function(c){var t,p,m,b,x,d,y,f,g;t=this._basisX1X,p=this._basisY1X,m=this._basisZ1X,b=this._basisX1Y,x=this._basisY1Y,d=this._basisZ1Y,y=this._basisX1Z,f=this._basisY1Z,g=this._basisZ1Z;var v=c;v.e00=t,v.e01=p,v.e02=m,v.e10=b,v.e11=x,v.e12=d,v.e20=y,v.e21=f,v.e22=g},getBasis2To:function(c){var t,p,m,b,x,d,y,f,g;t=this._basisX2X,p=this._basisY2X,m=this._basisZ2X,b=this._basisX2Y,x=this._basisY2Y,d=this._basisZ2Y,y=this._basisX2Z,f=this._basisY2Z,g=this._basisZ2Z;var v=c;v.e00=t,v.e01=p,v.e02=m,v.e10=b,v.e11=x,v.e12=d,v.e20=y,v.e21=f,v.e22=g},getAllowCollision:function(){return this._allowCollision},setAllowCollision:function(o){this._allowCollision=o},getBreakForce:function(){return this._breakForce},setBreakForce:function(o){this._breakForce=o},getBreakTorque:function(){return this._breakTorque},setBreakTorque:function(o){this._breakTorque=o},getPositionCorrectionAlgorithm:function(){return this._positionCorrectionAlgorithm},setPositionCorrectionAlgorithm:function(o){switch(o){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+o);}this._positionCorrectionAlgorithm=o},getAppliedForce:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,o},getAppliedForceTo:function(o){var t=o;t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ},getAppliedTorque:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,o},getAppliedTorqueTo:function(o){var t=o;t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ},getPrev:function(){return this._prev},getNext:function(){return this._next}};var oimo_dynamics_constraint_joint_CylindricalJoint=function(et){oimo_dynamics_constraint_joint_Joint.call(this,et,2);var t=et.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=et.localAxis2,y,rt,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt;if(this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,0==this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var Xt=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;0<Xt&&(Xt=1/Math.sqrt(Xt)),this._localBasisX1X*=Xt,this._localBasisX1Y*=Xt,this._localBasisX1Z*=Xt}if(0==this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var ut=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;0<ut&&(ut=1/Math.sqrt(ut)),this._localBasisX2X*=ut,this._localBasisX2Y*=ut,this._localBasisX2Z*=ut}var zt=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(-.999999999>zt){var Yt=this._localBasisX1X,X=this._localBasisX1Y,z=this._localBasisX1Z,Y=Yt*Yt,Z=X*X,I=z*z,V,Zt,It,Mt;Y<Z?Y<I?(V=0,Zt=z*(Mt=1/Math.sqrt(Z+I)),It=-X*Mt):(V=X*(Mt=1/Math.sqrt(Y+Z)),Zt=-Yt*Mt,It=0):Z<I?(V=-z*(Mt=1/Math.sqrt(I+Y)),Zt=0,It=Yt*Mt):(V=X*(Mt=1/Math.sqrt(Y+Z)),Zt=-Yt*Mt,It=0),y=V,rt=Zt,lt=It,ct=0}else{var ht,Vt,Lt;ht=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,Vt=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,Lt=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var Bt=Math.sqrt(.5*(1+zt));y=ht*=zt=.5/Bt,rt=Vt*=zt,lt=Lt*=zt,ct=Bt}var k=2*y,A=2*rt,P=2*lt,S=y*k,C=rt*A,T=lt*P,j=y*A,R=rt*P,q=y*P,E=ct*k,D=ct*A,J=ct*P;pt=1-C-T,mt=j-J,bt=q+D,xt=j+J,dt=1-S-T,yt=R-E,ft=q-D,gt=R+E,vt=1-S-C;var F=this._localBasisX1X,it=this._localBasisX1Y,ot=this._localBasisX1Z,at=F*F,nt=it*it,st=ot*ot,_t,kt,At,Pt,Tt,wt,St,Ct,qt,Rt;at<nt?at<st?(_t=1/Math.sqrt(nt+st),this._localBasisY1X=0,this._localBasisY1Y=ot*_t,this._localBasisY1Z=-it*_t):(_t=1/Math.sqrt(at+nt),this._localBasisY1X=it*_t,this._localBasisY1Y=-F*_t,this._localBasisY1Z=0):nt<st?(_t=1/Math.sqrt(st+at),this._localBasisY1X=-ot*_t,this._localBasisY1Y=0,this._localBasisY1Z=F*_t):(_t=1/Math.sqrt(at+nt),this._localBasisY1X=it*_t,this._localBasisY1Y=-F*_t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,kt=pt*this._localBasisX1X+mt*this._localBasisX1Y+bt*this._localBasisX1Z,At=xt*this._localBasisX1X+dt*this._localBasisX1Y+yt*this._localBasisX1Z,Pt=ft*this._localBasisX1X+gt*this._localBasisX1Y+vt*this._localBasisX1Z,this._localBasisX2X=kt,this._localBasisX2Y=At,this._localBasisX2Z=Pt,Tt=pt*this._localBasisY1X+mt*this._localBasisY1Y+bt*this._localBasisY1Z,wt=xt*this._localBasisY1X+dt*this._localBasisY1Y+yt*this._localBasisY1Z,St=ft*this._localBasisY1X+gt*this._localBasisY1Y+vt*this._localBasisY1Z,this._localBasisY2X=Tt,this._localBasisY2Y=wt,this._localBasisY2Z=St,Ct=pt*this._localBasisZ1X+mt*this._localBasisZ1Y+bt*this._localBasisZ1Z,qt=xt*this._localBasisZ1X+dt*this._localBasisZ1Y+yt*this._localBasisZ1Z,Rt=ft*this._localBasisZ1X+gt*this._localBasisZ1Y+vt*this._localBasisZ1Z,this._localBasisZ2X=Ct,this._localBasisZ2Y=qt,this._localBasisZ2Z=Rt,this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new oimo_dynamics_constraint_joint_JointBasis(this),this._translSd=et.translationalSpringDamper.clone(),this._translLm=et.translationalLimitMotor.clone(),this._rotSd=et.rotationalSpringDamper.clone(),this._rotLm=et.rotationalLimitMotor.clone()};oimo_dynamics_constraint_joint_CylindricalJoint.__super__=oimo_dynamics_constraint_joint_Joint,oimo_dynamics_constraint_joint_CylindricalJoint.prototype=$extend(oimo_dynamics_constraint_joint_Joint.prototype,{getInfo:function(qt,t,i){var o=i?1:this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0,X=this.linearErrorY*o,z=this.linearErrorZ*o,Y=this.angularErrorY*o,Z=this.angularErrorZ*o,I,Et,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o;I=-(I=0),Et=-(Et=-this._relativeAnchor1Z),Nt=-(Nt=this._relativeAnchor1Y),Ft=-(Ft=this._relativeAnchor1Z),Dt=-(Dt=0),Wt=-(Wt=-this._relativeAnchor1X),Gt=-(Gt=-this._relativeAnchor1Y),Ot=-(Ot=this._relativeAnchor1X),Ht=-(Ht=0),Jt=-(Jt=0),Ut=-(Ut=-this._relativeAnchor2Z),Qt=-(Qt=this._relativeAnchor2Y),Kt=-(Kt=this._relativeAnchor2Z),$t=-($t=0),to=-(to=-this._relativeAnchor2X),oo=-(oo=-this._relativeAnchor2Y),ao=-(ao=this._relativeAnchor2X),io=-(io=0);var eo=1/(this._b1._invMass+this._b2._invMass),V=this._basis.xX,L=this._basis.xY,w=this._basis.xZ,B=(this._b1._invInertia00*V+this._b1._invInertia01*L+this._b1._invInertia02*w)*V+(this._b1._invInertia10*V+this._b1._invInertia11*L+this._b1._invInertia12*w)*L+(this._b1._invInertia20*V+this._b1._invInertia21*L+this._b1._invInertia22*w)*w,ro=(this._b2._invInertia00*V+this._b2._invInertia01*L+this._b2._invInertia02*w)*V+(this._b2._invInertia10*V+this._b2._invInertia11*L+this._b2._invInertia12*w)*L+(this._b2._invInertia20*V+this._b2._invInertia21*L+this._b2._invInertia22*w)*w;if(0<B){var so=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,P=V*this._relativeAnchor1X+L*this._relativeAnchor1Y+w*this._relativeAnchor1Z,S=so-P*P;0<S&&(B=0<this._b1._invMass?1/(1/B+this._b1._mass*S):0)}if(0<ro){var C=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,T=V*this._relativeAnchor2X+L*this._relativeAnchor2Y+w*this._relativeAnchor2Z,j=C-T*T;0<j&&(ro=0<this._b2._invMass?1/(1/ro+this._b2._mass*j):0)}var R=0==B+ro?0:1/(B+ro);if(0>=this._translSd.frequency||!i){var q=this._impulses[0],E=qt.rows[qt.numRows++],D=E.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=q,no=E;var J=this.translation,G=this._translLm,O=this._translSd,W=oimo_common_Setting.linearSlop,lo,co;if(i)lo=0,co=1;else{if(0<O.frequency){W=0;var po=6.28318530717958*O.frequency,H=O.dampingRatio;H<oimo_common_Setting.minSpringDamperDampingRatio&&(H=oimo_common_Setting.minSpringDamperDampingRatio);var mo=t.dt,$=2*H*po,K=po*po;O.useSymplecticEuler?(lo=1/(mo*$),co=K/$):(lo=1/(mo*(mo*K+$)),co=K/(mo*K+$))}else lo=0,co=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<G.motorForce?(no.motorSpeed=G.motorSpeed,no.motorMaxImpulse=G.motorForce*t.dt):(no.motorSpeed=0,no.motorMaxImpulse=0)}var tt=G.lowerLimit,nt=G.upperLimit,st,bo,xo;tt>nt?(st=0,bo=0,xo=0):tt==nt?(st=-1/0,bo=1/0,xo=J-tt):J<tt?(st=-1/0,bo=0,0<(xo=J-tt+W)&&(xo=0)):J>nt?(st=0,bo=1/0,0>(xo=J-nt-W)&&(xo=0)):(st=0,bo=0,xo=0);var yo=0==eo?0:1/eo;no.minImpulse=st,no.maxImpulse=bo,no.cfm=lo*yo,no.rhs=xo*co,(_o=no.jacobian).lin1X=this._basis.xX,_o.lin1Y=this._basis.xY,_o.lin1Z=this._basis.xZ,_o.lin2X=this._basis.xX,_o.lin2Y=this._basis.xY,_o.lin2Z=this._basis.xZ,_o.ang1X=I,_o.ang1Y=Et,_o.ang1Z=Nt,_o.ang2X=Jt,_o.ang2Y=Ut,_o.ang2Z=Qt}var _t=this._impulses[1],rt=qt.rows[qt.numRows++],et=rt.jacobian;et.lin1X=0,et.lin1Y=0,et.lin1Z=0,et.lin2X=0,et.lin2Y=0,et.lin2Z=0,et.ang1X=0,et.ang1Y=0,et.ang1Z=0,et.ang2X=0,et.ang2Y=0,et.ang2Z=0,rt.rhs=0,rt.cfm=0,rt.minImpulse=0,rt.maxImpulse=0,rt.motorSpeed=0,rt.motorMaxImpulse=0,rt.impulse=null,rt.impulse=_t,(no=rt).rhs=X,no.cfm=0,no.minImpulse=-1/0,no.maxImpulse=1/0,(_o=no.jacobian).lin1X=this._basis.yX,_o.lin1Y=this._basis.yY,_o.lin1Z=this._basis.yZ,_o.lin2X=this._basis.yX,_o.lin2Y=this._basis.yY,_o.lin2Z=this._basis.yZ,_o.ang1X=Ft,_o.ang1Y=Dt,_o.ang1Z=Wt,_o.ang2X=Kt,_o.ang2Y=$t,_o.ang2Z=to;var ht=this._impulses[2],lt=qt.rows[qt.numRows++],ct=lt.jacobian;if(ct.lin1X=0,ct.lin1Y=0,ct.lin1Z=0,ct.lin2X=0,ct.lin2Y=0,ct.lin2Z=0,ct.ang1X=0,ct.ang1Y=0,ct.ang1Z=0,ct.ang2X=0,ct.ang2Y=0,ct.ang2Z=0,lt.rhs=0,lt.cfm=0,lt.minImpulse=0,lt.maxImpulse=0,lt.motorSpeed=0,lt.motorMaxImpulse=0,lt.impulse=null,lt.impulse=ht,(no=lt).rhs=z,no.cfm=0,no.minImpulse=-1/0,no.maxImpulse=1/0,(_o=no.jacobian).lin1X=this._basis.zX,_o.lin1Y=this._basis.zY,_o.lin1Z=this._basis.zZ,_o.lin2X=this._basis.zX,_o.lin2Y=this._basis.zY,_o.lin2Z=this._basis.zZ,_o.ang1X=Gt,_o.ang1Y=Ot,_o.ang1Z=Ht,_o.ang2X=oo,_o.ang2Y=ao,_o.ang2Z=io,0>=this._rotSd.frequency||!i){var mt=this._impulses[3],pt=qt.rows[qt.numRows++],vt=pt.jacobian;vt.lin1X=0,vt.lin1Y=0,vt.lin1Z=0,vt.lin2X=0,vt.lin2Y=0,vt.lin2Z=0,vt.ang1X=0,vt.ang1Y=0,vt.ang1Z=0,vt.ang2X=0,vt.ang2Y=0,vt.ang2Z=0,pt.rhs=0,pt.cfm=0,pt.minImpulse=0,pt.maxImpulse=0,pt.motorSpeed=0,pt.motorMaxImpulse=0,pt.impulse=null,pt.impulse=mt,no=pt;var yt=this.angle,fo=this._rotLm,xt=this._rotSd,ut=oimo_common_Setting.angularSlop,go,vo;if(i)go=0,vo=1;else{if(0<xt.frequency){ut=0;var Xo=6.28318530717958*xt.frequency,Mt=xt.dampingRatio;Mt<oimo_common_Setting.minSpringDamperDampingRatio&&(Mt=oimo_common_Setting.minSpringDamperDampingRatio);var uo=t.dt,zt=2*Mt*Xo,Yt=Xo*Xo;xt.useSymplecticEuler?(go=1/(uo*zt),vo=Yt/zt):(go=1/(uo*(uo*Yt+zt)),vo=Yt/(uo*Yt+zt))}else go=0,vo=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<fo.motorTorque?(no.motorSpeed=fo.motorSpeed,no.motorMaxImpulse=fo.motorTorque*t.dt):(no.motorSpeed=0,no.motorMaxImpulse=0)}var Zt=fo.lowerLimit,wt=fo.upperLimit,Bt=.5*(Zt+wt),kt,zo,Yo;yt=(((yt-=Bt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,yt+=Bt,Zt>wt?(kt=0,zo=0,Yo=0):Zt==wt?(kt=-1/0,zo=1/0,Yo=yt-Zt):yt<Zt?(kt=-1/0,zo=0,0<(Yo=yt-Zt+ut)&&(Yo=0)):yt>wt?(kt=0,zo=1/0,0>(Yo=yt-wt-ut)&&(Yo=0)):(kt=0,zo=0,Yo=0);var Zo=0==R?0:1/R;no.minImpulse=kt,no.maxImpulse=zo,no.cfm=go*Zo,no.rhs=Yo*vo,(_o=no.jacobian).ang1X=this._basis.xX,_o.ang1Y=this._basis.xY,_o.ang1Z=this._basis.xZ,_o.ang2X=this._basis.xX,_o.ang2Y=this._basis.xY,_o.ang2Z=this._basis.xZ}var At=this._impulses[4],Pt=qt.rows[qt.numRows++],St=Pt.jacobian;St.lin1X=0,St.lin1Y=0,St.lin1Z=0,St.lin2X=0,St.lin2Y=0,St.lin2Z=0,St.ang1X=0,St.ang1Y=0,St.ang1Z=0,St.ang2X=0,St.ang2Y=0,St.ang2Z=0,Pt.rhs=0,Pt.cfm=0,Pt.minImpulse=0,Pt.maxImpulse=0,Pt.motorSpeed=0,Pt.motorMaxImpulse=0,Pt.impulse=null,Pt.impulse=At,(no=Pt).rhs=Y,no.cfm=0,no.minImpulse=-1/0,no.maxImpulse=1/0,(_o=no.jacobian).ang1X=this._basis.yX,_o.ang1Y=this._basis.yY,_o.ang1Z=this._basis.yZ,_o.ang2X=this._basis.yX,_o.ang2Y=this._basis.yY,_o.ang2Z=this._basis.yZ;var Ct=this._impulses[5],Tt=qt.rows[qt.numRows++],jt=Tt.jacobian;jt.lin1X=0,jt.lin1Y=0,jt.lin1Z=0,jt.lin2X=0,jt.lin2Y=0,jt.lin2Z=0,jt.ang1X=0,jt.ang1Y=0,jt.ang1Z=0,jt.ang2X=0,jt.ang2Y=0,jt.ang2Z=0,Tt.rhs=0,Tt.cfm=0,Tt.minImpulse=0,Tt.maxImpulse=0,Tt.motorSpeed=0,Tt.motorMaxImpulse=0,Tt.impulse=null,Tt.impulse=Ct,(no=Tt).rhs=Z,no.cfm=0,no.minImpulse=-1/0,no.maxImpulse=1/0,(_o=no.jacobian).ang1X=this._basis.zX,_o.ang1Y=this._basis.zY,_o.ang1Z=this._basis.zZ,_o.ang2X=this._basis.zX,_o.ang2Y=this._basis.zY,_o.ang2Z=this._basis.zZ},_syncAnchors:function(){oimo_dynamics_constraint_joint_Joint.prototype._syncAnchors.call(this);var to=this._basis,R=to.joint._b1._invMass,q=to.joint._b2._invMass,E=to.joint._basisX1X*to.joint._basisX2X+to.joint._basisX1Y*to.joint._basisX2Y+to.joint._basisX1Z*to.joint._basisX2Z,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo,go,vo,Xo,uo,zo,Yo,Zo,Io,Mo,ho,Vo,Lo,Bo,ko,Ao,Po,To,wo,So,Co,qo,Ro,Eo;if(-.999999999>E){var jo=to.joint._basisX1X,O=to.joint._basisX1Y,W=to.joint._basisX1Z,U=jo*jo,H=O*O,Q=W*W,$,No,Fo,Do;U<H?U<Q?($=0,No=W*(Do=1/Math.sqrt(H+Q)),Fo=-O*Do):($=O*(Do=1/Math.sqrt(U+H)),No=-jo*Do,Fo=0):H<Q?($=-W*(Do=1/Math.sqrt(Q+U)),No=0,Fo=jo*Do):($=O*(Do=1/Math.sqrt(U+H)),No=-jo*Do,Fo=0),oo=$,ao=No,io=Fo,no=0}else{var Wo,Go,Oo;Wo=to.joint._basisX1Y*to.joint._basisX2Z-to.joint._basisX1Z*to.joint._basisX2Y,Go=to.joint._basisX1Z*to.joint._basisX2X-to.joint._basisX1X*to.joint._basisX2Z,Oo=to.joint._basisX1X*to.joint._basisX2Y-to.joint._basisX1Y*to.joint._basisX2X;var Ho=Math.sqrt(.5*(1+E));oo=Wo*=E=.5/Ho,ao=Go*=E,io=Oo*=E,no=Ho}var ot=(Po=0)*(Co=oo)+(To=0)*(qo=ao)+(wo=0)*(Ro=io)+(So=1)*(Eo=no);if(0>ot&&(ot=-ot,Co=-Co,qo=-qo,Ro=-Ro,Eo=-Eo),.999999<ot){var Jo=(Co=Po+(Co-Po)*(R/(R+q)))*Co+(qo=To+(qo-To)*(R/(R+q)))*qo+(Ro=wo+(Ro-wo)*(R/(R+q)))*Ro+(Eo=So+(Eo-So)*(R/(R+q)))*Eo;1e-32<Jo&&(Jo=1/Math.sqrt(Jo)),_o=Co*Jo,eo=qo*Jo,ro=Ro*Jo,so=Eo*Jo}else{var Uo=R/(R+q)*Math.acos(ot),st=(Co+=Po*-ot)*Co+(qo+=To*-ot)*qo+(Ro+=wo*-ot)*Ro+(Eo+=So*-ot)*Eo;1e-32<st&&(st=1/Math.sqrt(st)),Co*=st,qo*=st,Ro*=st,Eo*=st;var Qo=Math.sin(Uo),rt=Math.cos(Uo);_o=(Po*=rt)+Co*Qo,eo=(To*=rt)+qo*Qo,ro=(wo*=rt)+Ro*Qo,so=(So*=rt)+Eo*Qo}var et=2*_o,ht=2*eo,lt=2*ro,ct=_o*et,mt=eo*ht,pt=ro*lt,vt=_o*ht,yt=eo*lt,bt=_o*lt,ft=so*et,dt=so*ht,xt=so*lt;lo=vt-xt,co=bt+dt,po=vt+xt,mo=1-ct-pt,bo=yt-ft,xo=bt-dt,yo=yt+ft,fo=1-ct-mt,go=(1-mt-pt)*to.joint._basisX1X+lo*to.joint._basisX1Y+co*to.joint._basisX1Z,vo=po*to.joint._basisX1X+mo*to.joint._basisX1Y+bo*to.joint._basisX1Z,Xo=xo*to.joint._basisX1X+yo*to.joint._basisX1Y+fo*to.joint._basisX1Z,ho=to.xX,Vo=to.xY,Lo=to.xZ,Bo=to.yX,ko=to.yY,Ao=to.yZ;var ut=ho*go+Vo*vo+Lo*Xo;if(-.999999999>ut){var Ko=ho,Zt=Vo,It=Lo,Vt=Ko*Ko,Lt=Zt*Zt,wt=It*It,Bt,$o,ta,oa;Vt<Lt?Vt<wt?(Bt=0,$o=It*(oa=1/Math.sqrt(Lt+wt)),ta=-Zt*oa):(Bt=Zt*(oa=1/Math.sqrt(Vt+Lt)),$o=-Ko*oa,ta=0):Lt<wt?(Bt=-It*(oa=1/Math.sqrt(wt+Vt)),$o=0,ta=Ko*oa):(Bt=Zt*(oa=1/Math.sqrt(Vt+Lt)),$o=-Ko*oa,ta=0),_o=Bt,eo=$o,ro=ta,so=0}else{var aa,ia,na;aa=Vo*Xo-Lo*vo,ia=Lo*go-ho*Xo,na=ho*vo-Vo*go;var _a=Math.sqrt(.5*(1+ut));_o=aa*=ut=.5/_a,eo=ia*=ut,ro=na*=ut,so=_a}var St=2*_o,Rt=2*eo,qt=2*ro,Et=_o*St,Dt=eo*Rt,Jt=ro*qt,Ft=_o*Rt,Nt=eo*qt,Gt=_o*qt,Ot=so*St,Wt=so*Rt,Ut=so*qt,Ht,ea,ra;if(1e-6<(Zo=vo*(Yo=(xo=Gt-Wt)*Bo+(yo=Nt+Ot)*ko+(fo=1-Et-Dt)*Ao)-Xo*(zo=(po=Ft+Ut)*Bo+(mo=1-Et-Jt)*ko+(bo=Nt-Ot)*Ao))*Zo+(Io=Xo*(uo=(1-Dt-Jt)*Bo+(lo=Ft-Ut)*ko+(co=Gt+Wt)*Ao)-go*Yo)*Io+(Mo=go*zo-vo*uo)*Mo){var sa=Zo*Zo+Io*Io+Mo*Mo;0<sa&&(sa=1/Math.sqrt(sa)),Zo*=sa,Io*=sa,Mo*=sa}else{var la=go,Kt=vo,ca=Xo,pa=la*la,ma=Kt*Kt,ba=ca*ca,xa;pa<ma?pa<ba?(Zo=0,Io=ca*(xa=1/Math.sqrt(ma+ba)),Mo=-Kt*xa):(Zo=Kt*(xa=1/Math.sqrt(pa+ma)),Io=-la*xa,Mo=0):ma<ba?(Zo=-ca*(xa=1/Math.sqrt(ba+pa)),Io=0,Mo=la*xa):(Zo=Kt*(xa=1/Math.sqrt(pa+ma)),Io=-la*xa,Mo=0)}uo=Io*Xo-Mo*vo,zo=Mo*go-Zo*Xo,Yo=Zo*vo-Io*go,to.xX=go,to.xY=vo,to.xZ=Xo,to.yX=uo,to.yY=zo,to.yZ=Yo,to.zX=Zo,to.zY=Io,to.zZ=Mo,Ht=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,ea=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ra=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var da=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,ya=-1>=da?3.14159265358979:1<=da?0:Math.acos(da),fa=Ht*Ht+ea*ea+ra*ra,ga,va,Xa,ua,za,Ya;0<fa&&(fa=1/Math.sqrt(fa)),Ht*=fa,ea*=fa,ra*=fa,Ht*=ya,ea*=ya,ra*=ya,this.angularErrorY=Ht*this._basis.yX+ea*this._basis.yY+ra*this._basis.yZ,this.angularErrorZ=Ht*this._basis.zX+ea*this._basis.zY+ra*this._basis.zZ,ga=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,va=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Xa=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,da=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=-1>=da?3.14159265358979:1<=da?0:Math.acos(da),0>ga*this._basis.xX+va*this._basis.xY+Xa*this._basis.xZ&&(this.angle=-this.angle),ua=this._anchor2X-this._anchor1X,za=this._anchor2Y-this._anchor1Y,Ya=this._anchor2Z-this._anchor1Z,this.translation=ua*this._basis.xX+za*this._basis.xY+Ya*this._basis.xZ,this.linearErrorY=ua*this._basis.yX+za*this._basis.yY+Ya*this._basis.yZ,this.linearErrorZ=ua*this._basis.zX+za*this._basis.zY+Ya*this._basis.zZ},_getVelocitySolverInfo:function(o,t){oimo_dynamics_constraint_joint_Joint.prototype._getVelocitySolverInfo.call(this,o,t),this.getInfo(t,o,!1)},_getPositionSolverInfo:function(o){oimo_dynamics_constraint_joint_Joint.prototype._getPositionSolverInfo.call(this,o),this.getInfo(o,null,!0)},getAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,o},getAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,o},getAxis1To:function(o){var t=o;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},getAxis2To:function(o){var t=o;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},getLocalAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,o},getLocalAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,o},getLocalAxis1To:function(o){var t=o;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},getLocalAxis2To:function(o){var t=o;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},getTranslationalSpringDamper:function(){return this._translSd},getRotationalSpringDamper:function(){return this._rotSd},getTranslationalLimitMotor:function(){return this._translLm},getRotationalLimitMotor:function(){return this._rotLm},getAngle:function(){return this.angle},getTranslation:function(){return this.translation}});var oimo_dynamics_constraint_joint_JointConfig=function(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new oimo_common_Vec3,this.localAnchor2=new oimo_common_Vec3,this.allowCollision=!1,this.solverType=oimo_common_Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=oimo_common_Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0};oimo_dynamics_constraint_joint_JointConfig.prototype={_init:function(g,t,i){this.rigidBody1=g,this.rigidBody2=t;var o=this.rigidBody1,X=i,l,z,Y,Z,I,M;l=X.x,z=X.y,Y=X.z,l-=o._transform._positionX,z-=o._transform._positionY,Y-=o._transform._positionZ,Z=o._transform._rotation00*l+o._transform._rotation10*z+o._transform._rotation20*Y,I=o._transform._rotation01*l+o._transform._rotation11*z+o._transform._rotation21*Y,M=o._transform._rotation02*l+o._transform._rotation12*z+o._transform._rotation22*Y,l=Z,z=I,Y=M;var h=this.localAnchor1;h.x=l,h.y=z,h.z=Y;var c=this.rigidBody2,d=i,x,V,L,B,k,A;x=d.x,V=d.y,L=d.z,x-=c._transform._positionX,V-=c._transform._positionY,L-=c._transform._positionZ,B=c._transform._rotation00*x+c._transform._rotation10*V+c._transform._rotation20*L,k=c._transform._rotation01*x+c._transform._rotation11*V+c._transform._rotation21*L,A=c._transform._rotation02*x+c._transform._rotation12*V+c._transform._rotation22*L,x=B,V=k,L=A;var P=this.localAnchor2;P.x=x,P.y=V,P.z=L}};var oimo_dynamics_constraint_joint_CylindricalJointConfig=function(){oimo_dynamics_constraint_joint_JointConfig.call(this),this.localAxis1=new oimo_common_Vec3(1,0,0),this.localAxis2=new oimo_common_Vec3(1,0,0),this.translationalLimitMotor=new oimo_dynamics_constraint_joint_TranslationalLimitMotor,this.translationalSpringDamper=new oimo_dynamics_constraint_joint_SpringDamper,this.rotationalLimitMotor=new oimo_dynamics_constraint_joint_RotationalLimitMotor,this.rotationalSpringDamper=new oimo_dynamics_constraint_joint_SpringDamper};oimo_dynamics_constraint_joint_CylindricalJointConfig.__super__=oimo_dynamics_constraint_joint_JointConfig,oimo_dynamics_constraint_joint_CylindricalJointConfig.prototype=$extend(oimo_dynamics_constraint_joint_JointConfig.prototype,{init:function(g,t,i,o){var a,X,u;this._init(g,t,i);var z=o,l,Y,Z;a=z.x,X=z.y,u=z.z,l=g._transform._rotation00*a+g._transform._rotation10*X+g._transform._rotation20*u,Y=g._transform._rotation01*a+g._transform._rotation11*X+g._transform._rotation21*u,Z=g._transform._rotation02*a+g._transform._rotation12*X+g._transform._rotation22*u,a=l,X=Y,u=Z;var I=this.localAxis1,v,M,V;I.x=a,I.y=X,I.z=u;var L=o,d,B,k;v=L.x,M=L.y,V=L.z,d=t._transform._rotation00*v+t._transform._rotation10*M+t._transform._rotation20*V,B=t._transform._rotation01*v+t._transform._rotation11*M+t._transform._rotation21*V,k=t._transform._rotation02*v+t._transform._rotation12*M+t._transform._rotation22*V,v=d,M=B,V=k;var A=this.localAxis2;return A.x=v,A.y=M,A.z=V,this}});var oimo_dynamics_constraint_joint_JointBasis=function(o){this.joint=o,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0},oimo_dynamics_constraint_joint_JointImpulse=function(){this.impulse=0,this.impulseM=0,this.impulseP=0},oimo_dynamics_constraint_joint_JointLink=function(o){this._joint=o};oimo_dynamics_constraint_joint_JointLink.prototype={getContact:function(){return this._joint},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var oimo_dynamics_constraint_joint_JointMacro=function(){},oimo_dynamics_constraint_joint_JointType=function(){},oimo_dynamics_constraint_joint_PrismaticJoint=function(et){oimo_dynamics_constraint_joint_Joint.call(this,et,oimo_dynamics_constraint_joint_JointType.PRISMATIC);var t=et.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=et.localAxis2,y,rt,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt;if(this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,0==this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var Xt=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;0<Xt&&(Xt=1/Math.sqrt(Xt)),this._localBasisX1X*=Xt,this._localBasisX1Y*=Xt,this._localBasisX1Z*=Xt}if(0==this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var ut=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;0<ut&&(ut=1/Math.sqrt(ut)),this._localBasisX2X*=ut,this._localBasisX2Y*=ut,this._localBasisX2Z*=ut}var zt=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(-.999999999>zt){var Yt=this._localBasisX1X,X=this._localBasisX1Y,z=this._localBasisX1Z,Y=Yt*Yt,Z=X*X,I=z*z,V,Zt,It,Mt;Y<Z?Y<I?(V=0,Zt=z*(Mt=1/Math.sqrt(Z+I)),It=-X*Mt):(V=X*(Mt=1/Math.sqrt(Y+Z)),Zt=-Yt*Mt,It=0):Z<I?(V=-z*(Mt=1/Math.sqrt(I+Y)),Zt=0,It=Yt*Mt):(V=X*(Mt=1/Math.sqrt(Y+Z)),Zt=-Yt*Mt,It=0),y=V,rt=Zt,lt=It,ct=0}else{var ht,Vt,Lt;ht=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,Vt=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,Lt=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var Bt=Math.sqrt(.5*(1+zt));y=ht*=zt=.5/Bt,rt=Vt*=zt,lt=Lt*=zt,ct=Bt}var k=2*y,A=2*rt,P=2*lt,S=y*k,C=rt*A,T=lt*P,j=y*A,R=rt*P,q=y*P,E=ct*k,D=ct*A,J=ct*P;pt=1-C-T,mt=j-J,bt=q+D,xt=j+J,dt=1-S-T,yt=R-E,ft=q-D,gt=R+E,vt=1-S-C;var F=this._localBasisX1X,it=this._localBasisX1Y,ot=this._localBasisX1Z,at=F*F,nt=it*it,st=ot*ot,_t,kt,At,Pt,Tt,wt,St,Ct,qt,Rt;at<nt?at<st?(_t=1/Math.sqrt(nt+st),this._localBasisY1X=0,this._localBasisY1Y=ot*_t,this._localBasisY1Z=-it*_t):(_t=1/Math.sqrt(at+nt),this._localBasisY1X=it*_t,this._localBasisY1Y=-F*_t,this._localBasisY1Z=0):nt<st?(_t=1/Math.sqrt(st+at),this._localBasisY1X=-ot*_t,this._localBasisY1Y=0,this._localBasisY1Z=F*_t):(_t=1/Math.sqrt(at+nt),this._localBasisY1X=it*_t,this._localBasisY1Y=-F*_t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,kt=pt*this._localBasisX1X+mt*this._localBasisX1Y+bt*this._localBasisX1Z,At=xt*this._localBasisX1X+dt*this._localBasisX1Y+yt*this._localBasisX1Z,Pt=ft*this._localBasisX1X+gt*this._localBasisX1Y+vt*this._localBasisX1Z,this._localBasisX2X=kt,this._localBasisX2Y=At,this._localBasisX2Z=Pt,Tt=pt*this._localBasisY1X+mt*this._localBasisY1Y+bt*this._localBasisY1Z,wt=xt*this._localBasisY1X+dt*this._localBasisY1Y+yt*this._localBasisY1Z,St=ft*this._localBasisY1X+gt*this._localBasisY1Y+vt*this._localBasisY1Z,this._localBasisY2X=Tt,this._localBasisY2Y=wt,this._localBasisY2Z=St,Ct=pt*this._localBasisZ1X+mt*this._localBasisZ1Y+bt*this._localBasisZ1Z,qt=xt*this._localBasisZ1X+dt*this._localBasisZ1Y+yt*this._localBasisZ1Z,Rt=ft*this._localBasisZ1X+gt*this._localBasisZ1Y+vt*this._localBasisZ1Z,this._localBasisZ2X=Ct,this._localBasisZ2Y=qt,this._localBasisZ2Z=Rt,this._basis=new oimo_dynamics_constraint_joint_JointBasis(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=et.springDamper.clone(),this._lm=et.limitMotor.clone()};oimo_dynamics_constraint_joint_PrismaticJoint.__super__=oimo_dynamics_constraint_joint_Joint,oimo_dynamics_constraint_joint_PrismaticJoint.prototype=$extend(oimo_dynamics_constraint_joint_Joint.prototype,{getInfo:function(ct,t,i){var o=i?1:this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0,X=this.linearErrorY*o,z=this.linearErrorZ*o,Y=this.angularErrorX*o,Z=this.angularErrorY*o,I=this.angularErrorZ*o,V,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt,Vt,Lt,Bt;V=-(V=0),pt=-(pt=-this._relativeAnchor1Z),mt=-(mt=this._relativeAnchor1Y),bt=-(bt=this._relativeAnchor1Z),xt=-(xt=0),dt=-(dt=-this._relativeAnchor1X),yt=-(yt=-this._relativeAnchor1Y),ft=-(ft=this._relativeAnchor1X),gt=-(gt=0),vt=-(vt=0),Xt=-(Xt=-this._relativeAnchor2Z),ut=-(ut=this._relativeAnchor2Y),zt=-(zt=this._relativeAnchor2Z),Yt=-(Yt=0),Zt=-(Zt=-this._relativeAnchor2X),It=-(It=-this._relativeAnchor2Y),Mt=-(Mt=this._relativeAnchor2X),Vt=-(Vt=0);var kt=1/(this._b1._invMass+this._b2._invMass);if(0>=this._sd.frequency||!i){var L=this._impulses[0],w=ct.rows[ct.numRows++],B=w.jacobian;B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=L,Lt=w;var k=this.translation,S=this._lm,C=this._sd,T=oimo_common_Setting.linearSlop,At,Pt;if(i)At=0,Pt=1;else{if(0<C.frequency){T=0;var Tt=6.28318530717958*C.frequency,R=C.dampingRatio;R<oimo_common_Setting.minSpringDamperDampingRatio&&(R=oimo_common_Setting.minSpringDamperDampingRatio);var wt=t.dt,E=2*R*Tt,D=Tt*Tt;C.useSymplecticEuler?(At=1/(wt*E),Pt=D/E):(At=1/(wt*(wt*D+E)),Pt=D/(wt*D+E))}else At=0,Pt=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<S.motorForce?(Lt.motorSpeed=S.motorSpeed,Lt.motorMaxImpulse=S.motorForce*t.dt):(Lt.motorSpeed=0,Lt.motorMaxImpulse=0)}var J=S.lowerLimit,O=S.upperLimit,W,St,Ct;J>O?(W=0,St=0,Ct=0):J==O?(W=-1/0,St=1/0,Ct=k-J):k<J?(W=-1/0,St=0,0<(Ct=k-J+T)&&(Ct=0)):k>O?(W=0,St=1/0,0>(Ct=k-O-T)&&(Ct=0)):(W=0,St=0,Ct=0);var qt=0==kt?0:1/kt;Lt.minImpulse=W,Lt.maxImpulse=St,Lt.cfm=At*qt,Lt.rhs=Ct*Pt,(Bt=Lt.jacobian).lin1X=this._basis.xX,Bt.lin1Y=this._basis.xY,Bt.lin1Z=this._basis.xZ,Bt.lin2X=this._basis.xX,Bt.lin2Y=this._basis.xY,Bt.lin2Z=this._basis.xZ,Bt.ang1X=V,Bt.ang1Y=pt,Bt.ang1Z=mt,Bt.ang2X=vt,Bt.ang2Y=Xt,Bt.ang2Z=ut}var U=this._impulses[1],H=ct.rows[ct.numRows++],Q=H.jacobian;Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=U,(Lt=H).rhs=X,Lt.cfm=0,Lt.minImpulse=-1/0,Lt.maxImpulse=1/0,(Bt=Lt.jacobian).lin1X=this._basis.yX,Bt.lin1Y=this._basis.yY,Bt.lin1Z=this._basis.yZ,Bt.lin2X=this._basis.yX,Bt.lin2Y=this._basis.yY,Bt.lin2Z=this._basis.yZ,Bt.ang1X=bt,Bt.ang1Y=xt,Bt.ang1Z=dt,Bt.ang2X=zt,Bt.ang2Y=Yt,Bt.ang2Z=Zt;var $=this._impulses[2],K=ct.rows[ct.numRows++],tt=K.jacobian;tt.lin1X=0,tt.lin1Y=0,tt.lin1Z=0,tt.lin2X=0,tt.lin2Y=0,tt.lin2Z=0,tt.ang1X=0,tt.ang1Y=0,tt.ang1Z=0,tt.ang2X=0,tt.ang2Y=0,tt.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=$,(Lt=K).rhs=z,Lt.cfm=0,Lt.minImpulse=-1/0,Lt.maxImpulse=1/0,(Bt=Lt.jacobian).lin1X=this._basis.zX,Bt.lin1Y=this._basis.zY,Bt.lin1Z=this._basis.zZ,Bt.lin2X=this._basis.zX,Bt.lin2Y=this._basis.zY,Bt.lin2Z=this._basis.zZ,Bt.ang1X=yt,Bt.ang1Y=ft,Bt.ang1Z=gt,Bt.ang2X=It,Bt.ang2Y=Mt,Bt.ang2Z=Vt;var it=this._impulses[3],ot=ct.rows[ct.numRows++],at=ot.jacobian;at.lin1X=0,at.lin1Y=0,at.lin1Z=0,at.lin2X=0,at.lin2Y=0,at.lin2Z=0,at.ang1X=0,at.ang1Y=0,at.ang1Z=0,at.ang2X=0,at.ang2Y=0,at.ang2Z=0,ot.rhs=0,ot.cfm=0,ot.minImpulse=0,ot.maxImpulse=0,ot.motorSpeed=0,ot.motorMaxImpulse=0,ot.impulse=null,ot.impulse=it,(Lt=ot).rhs=Y,Lt.cfm=0,Lt.minImpulse=-1/0,Lt.maxImpulse=1/0,(Bt=Lt.jacobian).ang1X=1,Bt.ang1Y=0,Bt.ang1Z=0,Bt.ang2X=1,Bt.ang2Y=0,Bt.ang2Z=0;var nt=this._impulses[4],st=ct.rows[ct.numRows++],_t=st.jacobian;_t.lin1X=0,_t.lin1Y=0,_t.lin1Z=0,_t.lin2X=0,_t.lin2Y=0,_t.lin2Z=0,_t.ang1X=0,_t.ang1Y=0,_t.ang1Z=0,_t.ang2X=0,_t.ang2Y=0,_t.ang2Z=0,st.rhs=0,st.cfm=0,st.minImpulse=0,st.maxImpulse=0,st.motorSpeed=0,st.motorMaxImpulse=0,st.impulse=null,st.impulse=nt,(Lt=st).rhs=Z,Lt.cfm=0,Lt.minImpulse=-1/0,Lt.maxImpulse=1/0,(Bt=Lt.jacobian).ang1X=0,Bt.ang1Y=1,Bt.ang1Z=0,Bt.ang2X=0,Bt.ang2Y=1,Bt.ang2Z=0;var rt=this._impulses[5],et=ct.rows[ct.numRows++],ht=et.jacobian;ht.lin1X=0,ht.lin1Y=0,ht.lin1Z=0,ht.lin2X=0,ht.lin2Y=0,ht.lin2Z=0,ht.ang1X=0,ht.ang1Y=0,ht.ang1Z=0,ht.ang2X=0,ht.ang2Y=0,ht.ang2Z=0,et.rhs=0,et.cfm=0,et.minImpulse=0,et.maxImpulse=0,et.motorSpeed=0,et.motorMaxImpulse=0,et.impulse=null,et.impulse=rt,(Lt=et).rhs=I,Lt.cfm=0,Lt.minImpulse=-1/0,Lt.maxImpulse=1/0,(Bt=Lt.jacobian).ang1X=0,Bt.ang1Y=0,Bt.ang1Z=1,Bt.ang2X=0,Bt.ang2Y=0,Bt.ang2Z=1},_syncAnchors:function(){oimo_dynamics_constraint_joint_Joint.prototype._syncAnchors.call(this);var to=this._basis,R=to.joint._b1._invMass,q=to.joint._b2._invMass,E=to.joint._basisX1X*to.joint._basisX2X+to.joint._basisX1Y*to.joint._basisX2Y+to.joint._basisX1Z*to.joint._basisX2Z,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo,go,vo,Xo,uo,zo,Yo,Zo,Io,Mo,ho,Vo,Lo,Bo,ko,Ao,Po,To,wo,So,Co,qo,Ro,Eo;if(-.999999999>E){var jo=to.joint._basisX1X,O=to.joint._basisX1Y,W=to.joint._basisX1Z,U=jo*jo,H=O*O,Q=W*W,$,No,Fo,Do;U<H?U<Q?($=0,No=W*(Do=1/Math.sqrt(H+Q)),Fo=-O*Do):($=O*(Do=1/Math.sqrt(U+H)),No=-jo*Do,Fo=0):H<Q?($=-W*(Do=1/Math.sqrt(Q+U)),No=0,Fo=jo*Do):($=O*(Do=1/Math.sqrt(U+H)),No=-jo*Do,Fo=0),oo=$,ao=No,io=Fo,no=0}else{var Wo,Go,Oo;Wo=to.joint._basisX1Y*to.joint._basisX2Z-to.joint._basisX1Z*to.joint._basisX2Y,Go=to.joint._basisX1Z*to.joint._basisX2X-to.joint._basisX1X*to.joint._basisX2Z,Oo=to.joint._basisX1X*to.joint._basisX2Y-to.joint._basisX1Y*to.joint._basisX2X;var Ho=Math.sqrt(.5*(1+E));oo=Wo*=E=.5/Ho,ao=Go*=E,io=Oo*=E,no=Ho}var ot=(Po=0)*(Co=oo)+(To=0)*(qo=ao)+(wo=0)*(Ro=io)+(So=1)*(Eo=no);if(0>ot&&(ot=-ot,Co=-Co,qo=-qo,Ro=-Ro,Eo=-Eo),.999999<ot){var Jo=(Co=Po+(Co-Po)*(R/(R+q)))*Co+(qo=To+(qo-To)*(R/(R+q)))*qo+(Ro=wo+(Ro-wo)*(R/(R+q)))*Ro+(Eo=So+(Eo-So)*(R/(R+q)))*Eo;1e-32<Jo&&(Jo=1/Math.sqrt(Jo)),_o=Co*Jo,eo=qo*Jo,ro=Ro*Jo,so=Eo*Jo}else{var Uo=R/(R+q)*Math.acos(ot),st=(Co+=Po*-ot)*Co+(qo+=To*-ot)*qo+(Ro+=wo*-ot)*Ro+(Eo+=So*-ot)*Eo;1e-32<st&&(st=1/Math.sqrt(st)),Co*=st,qo*=st,Ro*=st,Eo*=st;var Qo=Math.sin(Uo),rt=Math.cos(Uo);_o=(Po*=rt)+Co*Qo,eo=(To*=rt)+qo*Qo,ro=(wo*=rt)+Ro*Qo,so=(So*=rt)+Eo*Qo}var et=2*_o,ht=2*eo,lt=2*ro,ct=_o*et,mt=eo*ht,pt=ro*lt,vt=_o*ht,yt=eo*lt,bt=_o*lt,ft=so*et,dt=so*ht,xt=so*lt;lo=vt-xt,co=bt+dt,po=vt+xt,mo=1-ct-pt,bo=yt-ft,xo=bt-dt,yo=yt+ft,fo=1-ct-mt,go=(1-mt-pt)*to.joint._basisX1X+lo*to.joint._basisX1Y+co*to.joint._basisX1Z,vo=po*to.joint._basisX1X+mo*to.joint._basisX1Y+bo*to.joint._basisX1Z,Xo=xo*to.joint._basisX1X+yo*to.joint._basisX1Y+fo*to.joint._basisX1Z,ho=to.xX,Vo=to.xY,Lo=to.xZ,Bo=to.yX,ko=to.yY,Ao=to.yZ;var ut=ho*go+Vo*vo+Lo*Xo;if(-.999999999>ut){var Ko=ho,Zt=Vo,It=Lo,Vt=Ko*Ko,Lt=Zt*Zt,wt=It*It,Bt,$o,ta,oa;Vt<Lt?Vt<wt?(Bt=0,$o=It*(oa=1/Math.sqrt(Lt+wt)),ta=-Zt*oa):(Bt=Zt*(oa=1/Math.sqrt(Vt+Lt)),$o=-Ko*oa,ta=0):Lt<wt?(Bt=-It*(oa=1/Math.sqrt(wt+Vt)),$o=0,ta=Ko*oa):(Bt=Zt*(oa=1/Math.sqrt(Vt+Lt)),$o=-Ko*oa,ta=0),_o=Bt,eo=$o,ro=ta,so=0}else{var aa,ia,na;aa=Vo*Xo-Lo*vo,ia=Lo*go-ho*Xo,na=ho*vo-Vo*go;var _a=Math.sqrt(.5*(1+ut));_o=aa*=ut=.5/_a,eo=ia*=ut,ro=na*=ut,so=_a}var St=2*_o,ea=2*eo,ra=2*ro,sa=_o*St,la=eo*ea,ca=ro*ra,pa=_o*ea,ma=eo*ra,ba=_o*ra,xa=so*St,da=so*ea,ya=so*ra,fa,ga,va,Xa,ua,za,Ya,Za,Ia,Ma,ha,Va,La,Ba,ka,Aa,Pa,Ta,wa,Sa,Ca,qa,Ra,Ea,ja,Na,Fa,Da;if(1e-6<(Zo=vo*(Yo=(xo=ba-da)*Bo+(yo=ma+xa)*ko+(fo=1-sa-la)*Ao)-Xo*(zo=(po=pa+ya)*Bo+(mo=1-sa-ca)*ko+(bo=ma-xa)*Ao))*Zo+(Io=Xo*(uo=(1-la-ca)*Bo+(lo=pa-ya)*ko+(co=ba+da)*Ao)-go*Yo)*Io+(Mo=go*zo-vo*uo)*Mo){var Wa=Zo*Zo+Io*Io+Mo*Mo;0<Wa&&(Wa=1/Math.sqrt(Wa)),Zo*=Wa,Io*=Wa,Mo*=Wa}else{var Ga=go,Oa=vo,Ha=Xo,Ja=Ga*Ga,Ua=Oa*Oa,Qa=Ha*Ha,Ka;Ja<Ua?Ja<Qa?(Zo=0,Io=Ha*(Ka=1/Math.sqrt(Ua+Qa)),Mo=-Oa*Ka):(Zo=Oa*(Ka=1/Math.sqrt(Ja+Ua)),Io=-Ga*Ka,Mo=0):Ua<Qa?(Zo=-Ha*(Ka=1/Math.sqrt(Qa+Ja)),Io=0,Mo=Ga*Ka):(Zo=Oa*(Ka=1/Math.sqrt(Ja+Ua)),Io=-Ga*Ka,Mo=0)}uo=Io*Xo-Mo*vo,zo=Mo*go-Zo*Xo,Yo=Zo*vo-Io*go,to.xX=go,to.xY=vo,to.xZ=Xo,to.yX=uo,to.yY=zo,to.yZ=Yo,to.zX=Zo,to.zY=Io,to.zZ=Mo,fa=this._basisX1X,ga=this._basisY1X,va=this._basisZ1X,Xa=this._basisX1Y,ua=this._basisY1Y,za=this._basisZ1Y,Ya=this._basisX1Z,Za=this._basisY1Z,Ia=this._basisZ1Z,wa=(Ma=this._basisX2X)*Xa+(ha=this._basisY2X)*ua+(Va=this._basisZ2X)*za,Sa=Ma*Ya+ha*Za+Va*Ia,Ca=(La=this._basisX2Y)*fa+(Ba=this._basisY2Y)*ga+(ka=this._basisZ2Y)*va,qa=La*Ya+Ba*Za+ka*Ia,Ra=(Aa=this._basisX2Z)*fa+(Pa=this._basisY2Z)*ga+(Ta=this._basisZ2Z)*va,Ea=Aa*Xa+Pa*ua+Ta*za;var $a=Ma*fa+ha*ga+Va*va,li=La*Xa+Ba*ua+ka*za,ci=Aa*Ya+Pa*Za+Ta*Ia,pi=$a+li+ci,mi;0<pi?(Da=.5*(mi=Math.sqrt(pi+1)),ja=(Ea-qa)*(mi=.5/mi),Na=(Sa-Ra)*mi,Fa=(Ca-wa)*mi):$a>li?$a>ci?(ja=.5*(mi=Math.sqrt($a-li-ci+1)),Na=(wa+Ca)*(mi=.5/mi),Fa=(Sa+Ra)*mi,Da=(Ea-qa)*mi):(Fa=.5*(mi=Math.sqrt(ci-$a-li+1)),ja=(Sa+Ra)*(mi=.5/mi),Na=(qa+Ea)*mi,Da=(Ca-wa)*mi):li>ci?(Na=.5*(mi=Math.sqrt(li-ci-$a+1)),ja=(wa+Ca)*(mi=.5/mi),Fa=(qa+Ea)*mi,Da=(Sa-Ra)*mi):(Fa=.5*(mi=Math.sqrt(ci-$a-li+1)),ja=(Sa+Ra)*(mi=.5/mi),Na=(qa+Ea)*mi,Da=(Ca-wa)*mi);var bi=Da,xi=2*(-1>=bi?3.14159265358979:1<=bi?0:Math.acos(bi));this.angularErrorX=ja,this.angularErrorY=Na,this.angularErrorZ=Fa;var di=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ,yi,fi,gi;0<di&&(di=1/Math.sqrt(di)),this.angularErrorX*=di,this.angularErrorY*=di,this.angularErrorZ*=di,this.angularErrorX*=xi,this.angularErrorY*=xi,this.angularErrorZ*=xi,yi=this._anchor2X-this._anchor1X,fi=this._anchor2Y-this._anchor1Y,gi=this._anchor2Z-this._anchor1Z,this.translation=yi*this._basis.xX+fi*this._basis.xY+gi*this._basis.xZ,this.linearErrorY=yi*this._basis.yX+fi*this._basis.yY+gi*this._basis.yZ,this.linearErrorZ=yi*this._basis.zX+fi*this._basis.zY+gi*this._basis.zZ},_getVelocitySolverInfo:function(o,t){oimo_dynamics_constraint_joint_Joint.prototype._getVelocitySolverInfo.call(this,o,t),this.getInfo(t,o,!1)},_getPositionSolverInfo:function(o){oimo_dynamics_constraint_joint_Joint.prototype._getPositionSolverInfo.call(this,o),this.getInfo(o,null,!0)},getAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,o},getAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,o},getAxis1To:function(o){var t=o;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},getAxis2To:function(o){var t=o;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},getLocalAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,o},getLocalAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,o},getLocalAxis1To:function(o){var t=o;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},getLocalAxis2To:function(o){var t=o;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getTranslation:function(){return this.translation}});var oimo_dynamics_constraint_joint_PrismaticJointConfig=function(){oimo_dynamics_constraint_joint_JointConfig.call(this),this.localAxis1=new oimo_common_Vec3(1,0,0),this.localAxis2=new oimo_common_Vec3(1,0,0),this.limitMotor=new oimo_dynamics_constraint_joint_TranslationalLimitMotor,this.springDamper=new oimo_dynamics_constraint_joint_SpringDamper};oimo_dynamics_constraint_joint_PrismaticJointConfig.__super__=oimo_dynamics_constraint_joint_JointConfig,oimo_dynamics_constraint_joint_PrismaticJointConfig.prototype=$extend(oimo_dynamics_constraint_joint_JointConfig.prototype,{init:function(g,t,i,o){var a,X,u;this._init(g,t,i);var z=o,l,Y,Z;a=z.x,X=z.y,u=z.z,l=g._transform._rotation00*a+g._transform._rotation10*X+g._transform._rotation20*u,Y=g._transform._rotation01*a+g._transform._rotation11*X+g._transform._rotation21*u,Z=g._transform._rotation02*a+g._transform._rotation12*X+g._transform._rotation22*u,a=l,X=Y,u=Z;var I=this.localAxis1,v,M,V;I.x=a,I.y=X,I.z=u;var L=o,d,B,k;v=L.x,M=L.y,V=L.z,d=t._transform._rotation00*v+t._transform._rotation10*M+t._transform._rotation20*V,B=t._transform._rotation01*v+t._transform._rotation11*M+t._transform._rotation21*V,k=t._transform._rotation02*v+t._transform._rotation12*M+t._transform._rotation22*V,v=d,M=B,V=k;var A=this.localAxis2;return A.x=v,A.y=M,A.z=V,this}});var oimo_dynamics_constraint_joint_RagdollJoint=function(et){oimo_dynamics_constraint_joint_Joint.call(this,et,oimo_dynamics_constraint_joint_JointType.RAGDOLL);var t=et.localTwistAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=et.localSwingAxis1;this._localBasisY1X=i.x,this._localBasisY1Y=i.y,this._localBasisY1Z=i.z;var o=et.localTwistAxis2,b,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt;if(this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,0==this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var ut=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;0<ut&&(ut=1/Math.sqrt(ut)),this._localBasisX1X*=ut,this._localBasisX1Y*=ut,this._localBasisX1Z*=ut}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,0==this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z){var zt=this._localBasisX1X,x=this._localBasisX1Y,u=this._localBasisX1Z,g=zt*zt,M=x*x,X=u*u,z;g<M?g<X?(z=1/Math.sqrt(M+X),this._localBasisY1X=0,this._localBasisY1Y=u*z,this._localBasisY1Z=-x*z):(z=1/Math.sqrt(g+M),this._localBasisY1X=x*z,this._localBasisY1Y=-zt*z,this._localBasisY1Z=0):M<X?(z=1/Math.sqrt(X+g),this._localBasisY1X=-u*z,this._localBasisY1Y=0,this._localBasisY1Z=zt*z):(z=1/Math.sqrt(g+M),this._localBasisY1X=x*z,this._localBasisY1Y=-zt*z,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var Yt=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;0<Yt&&(Yt=1/Math.sqrt(Yt)),this._localBasisZ1X*=Yt,this._localBasisZ1Y*=Yt,this._localBasisZ1Z*=Yt,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var Zt=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(-.999999999>Zt){var It=this._localBasisX1X,B=this._localBasisX1Y,k=this._localBasisX1Z,A=It*It,P=B*B,S=k*k,C,Mt,ht,Vt;A<P?A<S?(C=0,Mt=k*(Vt=1/Math.sqrt(P+S)),ht=-B*Vt):(C=B*(Vt=1/Math.sqrt(A+P)),Mt=-It*Vt,ht=0):P<S?(C=-k*(Vt=1/Math.sqrt(S+A)),Mt=0,ht=It*Vt):(C=B*(Vt=1/Math.sqrt(A+P)),Mt=-It*Vt,ht=0),b=C,lt=Mt,ct=ht,pt=0}else{var Lt,Bt,kt;Lt=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,Bt=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,kt=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var At=Math.sqrt(.5*(1+Zt));b=Lt*=Zt=.5/At,lt=Bt*=Zt,ct=kt*=Zt,pt=At}var q=2*b,H=2*lt,Q=2*ct,$=b*q,K=lt*H,tt=ct*Q,it=b*H,ot=lt*Q,at=b*Q,nt=pt*q,st=pt*H,_t=pt*Q,rt,Pt,Tt,wt,St,Ct,qt,Rt,Et;bt=it-_t,xt=at+st,dt=it+_t,yt=1-$-tt,ft=ot-nt,gt=at-st,vt=ot+nt,Xt=1-$-K,rt=(mt=1-K-tt)*this._localBasisX1X+bt*this._localBasisX1Y+xt*this._localBasisX1Z,Pt=dt*this._localBasisX1X+yt*this._localBasisX1Y+ft*this._localBasisX1Z,Tt=gt*this._localBasisX1X+vt*this._localBasisX1Y+Xt*this._localBasisX1Z,this._localBasisX2X=rt,this._localBasisX2Y=Pt,this._localBasisX2Z=Tt,wt=mt*this._localBasisY1X+bt*this._localBasisY1Y+xt*this._localBasisY1Z,St=dt*this._localBasisY1X+yt*this._localBasisY1Y+ft*this._localBasisY1Z,Ct=gt*this._localBasisY1X+vt*this._localBasisY1Y+Xt*this._localBasisY1Z,this._localBasisY2X=wt,this._localBasisY2Y=St,this._localBasisY2Z=Ct,qt=mt*this._localBasisZ1X+bt*this._localBasisZ1Y+xt*this._localBasisZ1Z,Rt=dt*this._localBasisZ1X+yt*this._localBasisZ1Y+ft*this._localBasisZ1Z,Et=gt*this._localBasisZ1X+vt*this._localBasisZ1Y+Xt*this._localBasisZ1Z,this._localBasisZ2X=qt,this._localBasisZ2Y=Rt,this._localBasisZ2Z=Et,this._twistSd=et.twistSpringDamper.clone(),this._twistLm=et.twistLimitMotor.clone(),this._swingSd=et.swingSpringDamper.clone(),this._maxSwingAngle1=et.maxSwingAngle1,this._maxSwingAngle2=et.maxSwingAngle2,this._maxSwingAngle1<oimo_common_Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=oimo_common_Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<oimo_common_Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=oimo_common_Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new oimo_dynamics_constraint_joint_RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0};oimo_dynamics_constraint_joint_RagdollJoint.__super__=oimo_dynamics_constraint_joint_Joint,oimo_dynamics_constraint_joint_RagdollJoint.prototype=$extend(oimo_dynamics_constraint_joint_Joint.prototype,{getInfo:function(Wt,t,i){var o=i?1:this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0,g=this.linearErrorX*o,M=this.linearErrorY*o,X=this.linearErrorZ*o,z,Ht,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo,ro,so,lo,co,po;z=-(z=0),Ht=-(Ht=-this._relativeAnchor1Z),Ut=-(Ut=this._relativeAnchor1Y),Qt=-(Qt=this._relativeAnchor1Z),Kt=-(Kt=0),$t=-($t=-this._relativeAnchor1X),to=-(to=-this._relativeAnchor1Y),oo=-(oo=this._relativeAnchor1X),ao=-(ao=0),io=-(io=0),no=-(no=-this._relativeAnchor2Z),_o=-(_o=this._relativeAnchor2Y),eo=-(eo=this._relativeAnchor2Z),ro=-(ro=0),so=-(so=-this._relativeAnchor2X),lo=-(lo=-this._relativeAnchor2Y),co=-(co=this._relativeAnchor2X),po=-(po=0);var mo=this.swingAxisX,Y=this.swingAxisY,Z=this.swingAxisZ,I=(this._b1._invInertia00*mo+this._b1._invInertia01*Y+this._b1._invInertia02*Z)*mo+(this._b1._invInertia10*mo+this._b1._invInertia11*Y+this._b1._invInertia12*Z)*Y+(this._b1._invInertia20*mo+this._b1._invInertia21*Y+this._b1._invInertia22*Z)*Z,bo=(this._b2._invInertia00*mo+this._b2._invInertia01*Y+this._b2._invInertia02*Z)*mo+(this._b2._invInertia10*mo+this._b2._invInertia11*Y+this._b2._invInertia12*Z)*Y+(this._b2._invInertia20*mo+this._b2._invInertia21*Y+this._b2._invInertia22*Z)*Z;if(0<I){var xo=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,w=mo*this._relativeAnchor1X+Y*this._relativeAnchor1Y+Z*this._relativeAnchor1Z,B=xo-w*w;0<B&&(I=0<this._b1._invMass?1/(1/I+this._b1._mass*B):0)}if(0<bo){var k=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,A=mo*this._relativeAnchor2X+Y*this._relativeAnchor2Y+Z*this._relativeAnchor2Z,P=k-A*A;0<P&&(bo=0<this._b2._invMass?1/(1/bo+this._b2._mass*P):0)}var S=0==I+bo?0:1/(I+bo),C=this._basisX2X,T=this._basisX2Y,j=this._basisX2Z,R=(this._b1._invInertia00*C+this._b1._invInertia01*T+this._b1._invInertia02*j)*C+(this._b1._invInertia10*C+this._b1._invInertia11*T+this._b1._invInertia12*j)*T+(this._b1._invInertia20*C+this._b1._invInertia21*T+this._b1._invInertia22*j)*j,yo=(this._b2._invInertia00*C+this._b2._invInertia01*T+this._b2._invInertia02*j)*C+(this._b2._invInertia10*C+this._b2._invInertia11*T+this._b2._invInertia12*j)*T+(this._b2._invInertia20*C+this._b2._invInertia21*T+this._b2._invInertia22*j)*j;if(0<R){var fo=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,D=C*this._relativeAnchor1X+T*this._relativeAnchor1Y+j*this._relativeAnchor1Z,J=fo-D*D;0<J&&(R=0<this._b1._invMass?1/(1/R+this._b1._mass*J):0)}if(0<yo){var F=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,N=C*this._relativeAnchor2X+T*this._relativeAnchor2Y+j*this._relativeAnchor2Z,G=F-N*N;0<G&&(yo=0<this._b2._invMass?1/(1/yo+this._b2._mass*G):0)}var O=0==R+yo?0:1/(R+yo),W=this._impulses[0],U=Wt.rows[Wt.numRows++],H=U.jacobian;H.lin1X=0,H.lin1Y=0,H.lin1Z=0,H.lin2X=0,H.lin2Y=0,H.lin2Z=0,H.ang1X=0,H.ang1Y=0,H.ang1Z=0,H.ang2X=0,H.ang2Y=0,H.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=W;var Q=U;Q.rhs=g,Q.cfm=0,Q.minImpulse=-1/0,Q.maxImpulse=1/0;var go=Q.jacobian;go.lin1X=1,go.lin1Y=0,go.lin1Z=0,go.lin2X=1,go.lin2Y=0,go.lin2Z=0,go.ang1X=z,go.ang1Y=Ht,go.ang1Z=Ut,go.ang2X=io,go.ang2Y=no,go.ang2Z=_o;var vo=this._impulses[1],tt=Wt.rows[Wt.numRows++],it=tt.jacobian;it.lin1X=0,it.lin1Y=0,it.lin1Z=0,it.lin2X=0,it.lin2Y=0,it.lin2Z=0,it.ang1X=0,it.ang1Y=0,it.ang1Z=0,it.ang2X=0,it.ang2Y=0,it.ang2Z=0,tt.rhs=0,tt.cfm=0,tt.minImpulse=0,tt.maxImpulse=0,tt.motorSpeed=0,tt.motorMaxImpulse=0,tt.impulse=null,tt.impulse=vo,(Q=tt).rhs=M,Q.cfm=0,Q.minImpulse=-1/0,Q.maxImpulse=1/0,(go=Q.jacobian).lin1X=0,go.lin1Y=1,go.lin1Z=0,go.lin2X=0,go.lin2Y=1,go.lin2Z=0,go.ang1X=Qt,go.ang1Y=Kt,go.ang1Z=$t,go.ang2X=eo,go.ang2Y=ro,go.ang2Z=so;var ot=this._impulses[2],at=Wt.rows[Wt.numRows++],nt=at.jacobian;if(nt.lin1X=0,nt.lin1Y=0,nt.lin1Z=0,nt.lin2X=0,nt.lin2Y=0,nt.lin2Z=0,nt.ang1X=0,nt.ang1Y=0,nt.ang1Z=0,nt.ang2X=0,nt.ang2Y=0,nt.ang2Z=0,at.rhs=0,at.cfm=0,at.minImpulse=0,at.maxImpulse=0,at.motorSpeed=0,at.motorMaxImpulse=0,at.impulse=null,at.impulse=ot,(Q=at).rhs=X,Q.cfm=0,Q.minImpulse=-1/0,Q.maxImpulse=1/0,(go=Q.jacobian).lin1X=0,go.lin1Y=0,go.lin1Z=1,go.lin2X=0,go.lin2Y=0,go.lin2Z=1,go.ang1X=to,go.ang1Y=oo,go.ang1Z=ao,go.ang2X=lo,go.ang2Y=co,go.ang2Z=po,0<this.swingError&&(0>=this._swingSd.frequency||!i)){var st=this._impulses[3],_t=Wt.rows[Wt.numRows++],rt=_t.jacobian;rt.lin1X=0,rt.lin1Y=0,rt.lin1Z=0,rt.lin2X=0,rt.lin2Y=0,rt.lin2Z=0,rt.ang1X=0,rt.ang1Y=0,rt.ang1Z=0,rt.ang2X=0,rt.ang2Y=0,rt.ang2Z=0,_t.rhs=0,_t.cfm=0,_t.minImpulse=0,_t.maxImpulse=0,_t.motorSpeed=0,_t.motorMaxImpulse=0,_t.impulse=null,_t.impulse=st,Q=_t;var et=this.swingError,Xo=this.dummySwingLm,mt=this._swingSd,pt=oimo_common_Setting.angularSlop,uo,zo;if(i)uo=0,zo=1;else{if(0<mt.frequency){pt=0;var Yo=6.28318530717958*mt.frequency,yt=mt.dampingRatio;yt<oimo_common_Setting.minSpringDamperDampingRatio&&(yt=oimo_common_Setting.minSpringDamperDampingRatio);var Zo=t.dt,ft=2*yt*Yo,dt=Yo*Yo;mt.useSymplecticEuler?(uo=1/(Zo*ft),zo=dt/ft):(uo=1/(Zo*(Zo*dt+ft)),zo=dt/(Zo*dt+ft))}else uo=0,zo=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<Xo.motorTorque?(Q.motorSpeed=Xo.motorSpeed,Q.motorMaxImpulse=Xo.motorTorque*t.dt):(Q.motorSpeed=0,Q.motorMaxImpulse=0)}var xt=Xo.lowerLimit,Xt=Xo.upperLimit,zt=.5*(xt+Xt),Yt,Io,Mo;et=(((et-=zt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,et+=zt,xt>Xt?(Yt=0,Io=0,Mo=0):xt==Xt?(Yt=-1/0,Io=1/0,Mo=et-xt):et<xt?(Yt=-1/0,Io=0,0<(Mo=et-xt+pt)&&(Mo=0)):et>Xt?(Yt=0,Io=1/0,0>(Mo=et-Xt-pt)&&(Mo=0)):(Yt=0,Io=0,Mo=0);var ho=0==S?0:1/S;Q.minImpulse=Yt,Q.maxImpulse=Io,Q.cfm=uo*ho,Q.rhs=Mo*zo,(go=Q.jacobian).ang1X=this.swingAxisX,go.ang1Y=this.swingAxisY,go.ang1Z=this.swingAxisZ,go.ang2X=this.swingAxisX,go.ang2Y=this.swingAxisY,go.ang2Z=this.swingAxisZ}if(0>=this._twistSd.frequency||!i){var Zt=this._impulses[4],It=Wt.rows[Wt.numRows++],Vt=It.jacobian;Vt.lin1X=0,Vt.lin1Y=0,Vt.lin1Z=0,Vt.lin2X=0,Vt.lin2Y=0,Vt.lin2Z=0,Vt.ang1X=0,Vt.ang1Y=0,Vt.ang1Z=0,Vt.ang2X=0,Vt.ang2Y=0,Vt.ang2Z=0,It.rhs=0,It.cfm=0,It.minImpulse=0,It.maxImpulse=0,It.motorSpeed=0,It.motorMaxImpulse=0,It.impulse=null,It.impulse=Zt,Q=It;var Lt=this._twistAngle,Vo=this._twistLm,At=this._twistSd,Pt=oimo_common_Setting.angularSlop,Lo,Bo;if(i)Lo=0,Bo=1;else{if(0<At.frequency){Pt=0;var ko=6.28318530717958*At.frequency,Ct=At.dampingRatio;Ct<oimo_common_Setting.minSpringDamperDampingRatio&&(Ct=oimo_common_Setting.minSpringDamperDampingRatio);var Ao=t.dt,jt=2*Ct*ko,Rt=ko*ko;At.useSymplecticEuler?(Lo=1/(Ao*jt),Bo=Rt/jt):(Lo=1/(Ao*(Ao*Rt+jt)),Bo=Rt/(Ao*Rt+jt))}else Lo=0,Bo=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<Vo.motorTorque?(Q.motorSpeed=Vo.motorSpeed,Q.motorMaxImpulse=Vo.motorTorque*t.dt):(Q.motorSpeed=0,Q.motorMaxImpulse=0)}var qt=Vo.lowerLimit,Ft=Vo.upperLimit,Nt=.5*(qt+Ft),Gt,Po,To;Lt=(((Lt-=Nt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,Lt+=Nt,qt>Ft?(Gt=0,Po=0,To=0):qt==Ft?(Gt=-1/0,Po=1/0,To=Lt-qt):Lt<qt?(Gt=-1/0,Po=0,0<(To=Lt-qt+Pt)&&(To=0)):Lt>Ft?(Gt=0,Po=1/0,0>(To=Lt-Ft-Pt)&&(To=0)):(Gt=0,Po=0,To=0);var wo=0==O?0:1/O;Q.minImpulse=Gt,Q.maxImpulse=Po,Q.cfm=Lo*wo,Q.rhs=To*Bo,(go=Q.jacobian).ang1X=this.twistAxisX,go.ang1Y=this.twistAxisY,go.ang1Z=this.twistAxisZ,go.ang2X=this.twistAxisX,go.ang2Y=this.twistAxisY,go.ang2Z=this.twistAxisZ}},_syncAnchors:function(){oimo_dynamics_constraint_joint_Joint.prototype._syncAnchors.call(this);var kt,At,Pt,Tt,St,Ct,qt,Rt,Et,jt,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo,ro,so;this._b1._transform,this._b2._transform,kt=this._basisX1X,At=this._basisX1Y,Pt=this._basisX1Z,Tt=this._basisX2X,St=this._basisX2Y,Ct=this._basisX2Z,qt=this._basisX1X,Rt=this._basisY1X,Et=this._basisZ1X,jt=this._basisX1Y,Nt=this._basisY1Y,Ft=this._basisZ1Y,Dt=this._basisX1Z,Wt=this._basisY1Z,Gt=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var lo=kt*Tt+At*St+Pt*Ct;if(-.999999999>lo){var co=kt,C=At,T=Pt,j=co*co,R=C*C,q=T*T,E,po,mo,bo;j<R?j<q?(E=0,po=T*(bo=1/Math.sqrt(R+q)),mo=-C*bo):(E=C*(bo=1/Math.sqrt(j+R)),po=-co*bo,mo=0):R<q?(E=-T*(bo=1/Math.sqrt(q+j)),po=0,mo=co*bo):(E=C*(bo=1/Math.sqrt(j+R)),po=-co*bo,mo=0),Ot=E,Ht=po,Jt=mo,Ut=0}else{var xo,yo,fo;xo=At*Ct-Pt*St,yo=Pt*Tt-kt*Ct,fo=kt*St-At*Tt;var go=Math.sqrt(.5*(1+lo));Ot=xo*=lo=.5/go,Ht=yo*=lo,Jt=fo*=lo,Ut=go}var N=2*Ot,U=2*Ht,H=2*Jt,Q=Ot*N,$=Ht*U,K=Jt*H,tt=Ot*U,it=Ht*H,ot=Ot*H,at=Ut*N,nt=Ut*U,st=Ut*H,_t,vo,Xo;Qt=1-$-K,Kt=tt-st,$t=ot+nt,to=tt+st,oo=1-Q-K,ao=it-at,io=ot-nt,no=it+at,_o=1-Q-$,this._swingAngle=2*(-1>=Ut?3.14159265358979:1<=Ut?0:Math.acos(Ut)),eo=Ot,ro=Ht,so=Jt,_t=Qt*this._basisY2X+to*this._basisY2Y+io*this._basisY2Z,vo=Kt*this._basisY2X+oo*this._basisY2Y+no*this._basisY2Z,Xo=$t*this._basisY2X+ao*this._basisY2Y+_o*this._basisY2Z;var uo=this._basisY1X*_t+this._basisY1Y*vo+this._basisY1Z*Xo,rt=this._basisZ1X*_t+this._basisZ1Y*vo+this._basisZ1Z*Xo;this._twistAngle=Math.atan2(rt,uo),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var et=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;0<et&&(et=1/Math.sqrt(et)),this.twistAxisX*=et,this.twistAxisY*=et,this.twistAxisZ*=et;var zo=Math.sqrt(eo*eo+ro*ro+so*so),Yo,Zo;0<zo&&(zo=1/zo),Yo=Rt*(eo*=zo*this._swingAngle)+Nt*(ro*=zo*this._swingAngle)+Wt*(so*=zo*this._swingAngle),Zo=Et*eo+Ft*ro+Gt*so,eo=qt*eo+jt*ro+Dt*so;var Io=ro=Yo,pt=so=Zo,vt=this._maxSwingAngle1,yt=this._maxSwingAngle2,bt=1/(vt*vt),ft=1/(yt*yt),dt=Io*Io*bt+pt*pt*ft;if(0==dt)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var xt=Math.sqrt(1/dt),Zt=Io*xt,It=pt*xt,Vt=Zt*bt,Mo=It*ft,ho=(Io-Zt)*(Vt*=zo=1/Math.sqrt(Vt*Vt+Mo*Mo))+(pt-It)*(Mo*=zo),Bt,Vo,Lo,Bo,ko,Ao;0<ho?(this.swingError=ho,this.swingAxisX=0,this.swingAxisY=Vt,this.swingAxisZ=Mo,Bt=qt*this.swingAxisX+Rt*this.swingAxisY+Et*this.swingAxisZ,Vo=jt*this.swingAxisX+Nt*this.swingAxisY+Ft*this.swingAxisZ,Lo=Dt*this.swingAxisX+Wt*this.swingAxisY+Gt*this.swingAxisZ,this.swingAxisX=Bt,this.swingAxisY=Vo,this.swingAxisZ=Lo,Bo=Qt*this.swingAxisX+Kt*this.swingAxisY+$t*this.swingAxisZ,ko=to*this.swingAxisX+oo*this.swingAxisY+ao*this.swingAxisZ,Ao=io*this.swingAxisX+no*this.swingAxisY+_o*this.swingAxisZ,this.swingAxisX=Bo,this.swingAxisY=ko,this.swingAxisZ=Ao):this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(o,t){oimo_dynamics_constraint_joint_Joint.prototype._getVelocitySolverInfo.call(this,o,t),this.getInfo(t,o,!1)},_getPositionSolverInfo:function(o){oimo_dynamics_constraint_joint_Joint.prototype._getPositionSolverInfo.call(this,o),this.getInfo(o,null,!0)},getAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,o},getAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,o},getAxis1To:function(o){var t=o;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},getAxis2To:function(o){var t=o;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},getLocalAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,o},getLocalAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,o},getLocalAxis1To:function(o){var t=o;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},getLocalAxis2To:function(o){var t=o;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},getTwistSpringDamper:function(){return this._twistSd},getTwistLimitMotor:function(){return this._twistLm},getSwingSpringDamper:function(){return this._swingSd},getSwingAxis:function(){var o=new oimo_common_Vec3,t=o;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,o},getSwingAxisTo:function(o){var t=o;t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ},getSwingAngle:function(){return this._swingAngle},getTwistAngle:function(){return this._twistAngle}});var oimo_dynamics_constraint_joint_RagdollJointConfig=function(){oimo_dynamics_constraint_joint_JointConfig.call(this),this.localTwistAxis1=new oimo_common_Vec3(1,0,0),this.localTwistAxis2=new oimo_common_Vec3(1,0,0),this.localSwingAxis1=new oimo_common_Vec3(0,1,0),this.twistSpringDamper=new oimo_dynamics_constraint_joint_SpringDamper,this.swingSpringDamper=new oimo_dynamics_constraint_joint_SpringDamper,this.twistLimitMotor=new oimo_dynamics_constraint_joint_RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979};oimo_dynamics_constraint_joint_RagdollJointConfig.__super__=oimo_dynamics_constraint_joint_JointConfig,oimo_dynamics_constraint_joint_RagdollJointConfig.prototype=$extend(oimo_dynamics_constraint_joint_JointConfig.prototype,{init:function(L,t,i,o,a){var n,B,k;this._init(L,t,i);var A=o,c,P,T;n=A.x,B=A.y,k=A.z,c=L._transform._rotation00*n+L._transform._rotation10*B+L._transform._rotation20*k,P=L._transform._rotation01*n+L._transform._rotation11*B+L._transform._rotation21*k,T=L._transform._rotation02*n+L._transform._rotation12*B+L._transform._rotation22*k,n=c,B=P,k=T;var w=this.localTwistAxis1,y,S,C;w.x=n,w.y=B,w.z=k;var q=o,x,R,E;y=q.x,S=q.y,C=q.z,x=t._transform._rotation00*y+t._transform._rotation10*S+t._transform._rotation20*C,R=t._transform._rotation01*y+t._transform._rotation11*S+t._transform._rotation21*C,E=t._transform._rotation02*y+t._transform._rotation12*S+t._transform._rotation22*C,y=x,S=R,C=E;var j=this.localTwistAxis2,X,N,F;j.x=y,j.y=S,j.z=C;var D=a,I,W,G;X=D.x,N=D.y,F=D.z,I=L._transform._rotation00*X+L._transform._rotation10*N+L._transform._rotation20*F,W=L._transform._rotation01*X+L._transform._rotation11*N+L._transform._rotation21*F,G=L._transform._rotation02*X+L._transform._rotation12*N+L._transform._rotation22*F,X=I,N=W,F=G;var O=this.localSwingAxis1;return O.x=X,O.y=N,O.z=F,this}});var oimo_dynamics_constraint_joint_RevoluteJoint=function(et){oimo_dynamics_constraint_joint_Joint.call(this,et,1);var t=et.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=et.localAxis2,y,rt,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt;if(this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,0==this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var Xt=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;0<Xt&&(Xt=1/Math.sqrt(Xt)),this._localBasisX1X*=Xt,this._localBasisX1Y*=Xt,this._localBasisX1Z*=Xt}if(0==this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var ut=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;0<ut&&(ut=1/Math.sqrt(ut)),this._localBasisX2X*=ut,this._localBasisX2Y*=ut,this._localBasisX2Z*=ut}var zt=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(-.999999999>zt){var Yt=this._localBasisX1X,X=this._localBasisX1Y,z=this._localBasisX1Z,Y=Yt*Yt,Z=X*X,I=z*z,V,Zt,It,Mt;Y<Z?Y<I?(V=0,Zt=z*(Mt=1/Math.sqrt(Z+I)),It=-X*Mt):(V=X*(Mt=1/Math.sqrt(Y+Z)),Zt=-Yt*Mt,It=0):Z<I?(V=-z*(Mt=1/Math.sqrt(I+Y)),Zt=0,It=Yt*Mt):(V=X*(Mt=1/Math.sqrt(Y+Z)),Zt=-Yt*Mt,It=0),y=V,rt=Zt,lt=It,ct=0}else{var ht,Vt,Lt;ht=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,Vt=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,Lt=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var Bt=Math.sqrt(.5*(1+zt));y=ht*=zt=.5/Bt,rt=Vt*=zt,lt=Lt*=zt,ct=Bt}var k=2*y,A=2*rt,P=2*lt,S=y*k,C=rt*A,T=lt*P,j=y*A,R=rt*P,q=y*P,E=ct*k,D=ct*A,J=ct*P;pt=1-C-T,mt=j-J,bt=q+D,xt=j+J,dt=1-S-T,yt=R-E,ft=q-D,gt=R+E,vt=1-S-C;var F=this._localBasisX1X,it=this._localBasisX1Y,ot=this._localBasisX1Z,at=F*F,nt=it*it,st=ot*ot,_t,kt,At,Pt,Tt,wt,St,Ct,qt,Rt;at<nt?at<st?(_t=1/Math.sqrt(nt+st),this._localBasisY1X=0,this._localBasisY1Y=ot*_t,this._localBasisY1Z=-it*_t):(_t=1/Math.sqrt(at+nt),this._localBasisY1X=it*_t,this._localBasisY1Y=-F*_t,this._localBasisY1Z=0):nt<st?(_t=1/Math.sqrt(st+at),this._localBasisY1X=-ot*_t,this._localBasisY1Y=0,this._localBasisY1Z=F*_t):(_t=1/Math.sqrt(at+nt),this._localBasisY1X=it*_t,this._localBasisY1Y=-F*_t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,kt=pt*this._localBasisX1X+mt*this._localBasisX1Y+bt*this._localBasisX1Z,At=xt*this._localBasisX1X+dt*this._localBasisX1Y+yt*this._localBasisX1Z,Pt=ft*this._localBasisX1X+gt*this._localBasisX1Y+vt*this._localBasisX1Z,this._localBasisX2X=kt,this._localBasisX2Y=At,this._localBasisX2Z=Pt,Tt=pt*this._localBasisY1X+mt*this._localBasisY1Y+bt*this._localBasisY1Z,wt=xt*this._localBasisY1X+dt*this._localBasisY1Y+yt*this._localBasisY1Z,St=ft*this._localBasisY1X+gt*this._localBasisY1Y+vt*this._localBasisY1Z,this._localBasisY2X=Tt,this._localBasisY2Y=wt,this._localBasisY2Z=St,Ct=pt*this._localBasisZ1X+mt*this._localBasisZ1Y+bt*this._localBasisZ1Z,qt=xt*this._localBasisZ1X+dt*this._localBasisZ1Y+yt*this._localBasisZ1Z,Rt=ft*this._localBasisZ1X+gt*this._localBasisZ1Y+vt*this._localBasisZ1Z,this._localBasisZ2X=Ct,this._localBasisZ2Y=qt,this._localBasisZ2Z=Rt,this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new oimo_dynamics_constraint_joint_JointBasis(this),this._sd=et.springDamper.clone(),this._lm=et.limitMotor.clone()};oimo_dynamics_constraint_joint_RevoluteJoint.__super__=oimo_dynamics_constraint_joint_Joint,oimo_dynamics_constraint_joint_RevoluteJoint.prototype=$extend(oimo_dynamics_constraint_joint_Joint.prototype,{getInfo:function(Xt,t,i){var o=i?1:this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0,g=this.linearErrorX*o,M=this.linearErrorY*o,X=this.linearErrorZ*o,z=this.angularErrorY*o,Y=this.angularErrorZ*o,Z,zt,Yt,Zt,It,Vt,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et;Z=-(Z=0),zt=-(zt=-this._relativeAnchor1Z),Yt=-(Yt=this._relativeAnchor1Y),Zt=-(Zt=this._relativeAnchor1Z),It=-(It=0),Vt=-(Vt=-this._relativeAnchor1X),Lt=-(Lt=-this._relativeAnchor1Y),Bt=-(Bt=this._relativeAnchor1X),kt=-(kt=0),At=-(At=0),Pt=-(Pt=-this._relativeAnchor2Z),Tt=-(Tt=this._relativeAnchor2Y),wt=-(wt=this._relativeAnchor2Z),St=-(St=0),Ct=-(Ct=-this._relativeAnchor2X),qt=-(qt=-this._relativeAnchor2Y),Rt=-(Rt=this._relativeAnchor2X),Et=-(Et=0);var jt=this._basis.xX,I=this._basis.xY,V=this._basis.xZ,L=(this._b1._invInertia00*jt+this._b1._invInertia01*I+this._b1._invInertia02*V)*jt+(this._b1._invInertia10*jt+this._b1._invInertia11*I+this._b1._invInertia12*V)*I+(this._b1._invInertia20*jt+this._b1._invInertia21*I+this._b1._invInertia22*V)*V,Nt=(this._b2._invInertia00*jt+this._b2._invInertia01*I+this._b2._invInertia02*V)*jt+(this._b2._invInertia10*jt+this._b2._invInertia11*I+this._b2._invInertia12*V)*I+(this._b2._invInertia20*jt+this._b2._invInertia21*I+this._b2._invInertia22*V)*V;if(0<L){var Ft=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,k=jt*this._relativeAnchor1X+I*this._relativeAnchor1Y+V*this._relativeAnchor1Z,A=Ft-k*k;0<A&&(L=0<this._b1._invMass?1/(1/L+this._b1._mass*A):0)}if(0<Nt){var P=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,S=jt*this._relativeAnchor2X+I*this._relativeAnchor2Y+V*this._relativeAnchor2Z,C=P-S*S;0<C&&(Nt=0<this._b2._invMass?1/(1/Nt+this._b2._mass*C):0)}var T=0==L+Nt?0:1/(L+Nt),j=this._impulses[0],R=Xt.rows[Xt.numRows++],q=R.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j;var E=R;E.rhs=g,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0;var Dt=E.jacobian;Dt.lin1X=1,Dt.lin1Y=0,Dt.lin1Z=0,Dt.lin2X=1,Dt.lin2Y=0,Dt.lin2Z=0,Dt.ang1X=Z,Dt.ang1Y=zt,Dt.ang1Z=Yt,Dt.ang2X=At,Dt.ang2Y=Pt,Dt.ang2Z=Tt;var Wt=this._impulses[1],F=Xt.rows[Xt.numRows++],N=F.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=Wt,(E=F).rhs=M,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,(Dt=E.jacobian).lin1X=0,Dt.lin1Y=1,Dt.lin1Z=0,Dt.lin2X=0,Dt.lin2Y=1,Dt.lin2Z=0,Dt.ang1X=Zt,Dt.ang1Y=It,Dt.ang1Z=Vt,Dt.ang2X=wt,Dt.ang2Y=St,Dt.ang2Z=Ct;var G=this._impulses[2],O=Xt.rows[Xt.numRows++],W=O.jacobian;if(W.lin1X=0,W.lin1Y=0,W.lin1Z=0,W.lin2X=0,W.lin2Y=0,W.lin2Z=0,W.ang1X=0,W.ang1Y=0,W.ang1Z=0,W.ang2X=0,W.ang2Y=0,W.ang2Z=0,O.rhs=0,O.cfm=0,O.minImpulse=0,O.maxImpulse=0,O.motorSpeed=0,O.motorMaxImpulse=0,O.impulse=null,O.impulse=G,(E=O).rhs=X,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,(Dt=E.jacobian).lin1X=0,Dt.lin1Y=0,Dt.lin1Z=1,Dt.lin2X=0,Dt.lin2Y=0,Dt.lin2Z=1,Dt.ang1X=Lt,Dt.ang1Y=Bt,Dt.ang1Z=kt,Dt.ang2X=qt,Dt.ang2Y=Rt,Dt.ang2Z=Et,0>=this._sd.frequency||!i){var U=this._impulses[3],H=Xt.rows[Xt.numRows++],Q=H.jacobian;Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=U,E=H;var $=this.angle,Gt=this._lm,ot=this._sd,at=oimo_common_Setting.angularSlop,Ot,Ht;if(i)Ot=0,Ht=1;else{if(0<ot.frequency){at=0;var Jt=6.28318530717958*ot.frequency,st=ot.dampingRatio;st<oimo_common_Setting.minSpringDamperDampingRatio&&(st=oimo_common_Setting.minSpringDamperDampingRatio);var Ut=t.dt,rt=2*st*Jt,et=Jt*Jt;ot.useSymplecticEuler?(Ot=1/(Ut*rt),Ht=et/rt):(Ot=1/(Ut*(Ut*et+rt)),Ht=et/(Ut*et+rt))}else Ot=0,Ht=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<Gt.motorTorque?(E.motorSpeed=Gt.motorSpeed,E.motorMaxImpulse=Gt.motorTorque*t.dt):(E.motorSpeed=0,E.motorMaxImpulse=0)}var ht=Gt.lowerLimit,pt=Gt.upperLimit,vt=.5*(ht+pt),yt,Qt,Kt;$=((($-=vt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,$+=vt,ht>pt?(yt=0,Qt=0,Kt=0):ht==pt?(yt=-1/0,Qt=1/0,Kt=$-ht):$<ht?(yt=-1/0,Qt=0,0<(Kt=$-ht+at)&&(Kt=0)):$>pt?(yt=0,Qt=1/0,0>(Kt=$-pt-at)&&(Kt=0)):(yt=0,Qt=0,Kt=0);var $t=0==T?0:1/T;E.minImpulse=yt,E.maxImpulse=Qt,E.cfm=Ot*$t,E.rhs=Kt*Ht,(Dt=E.jacobian).ang1X=this._basis.xX,Dt.ang1Y=this._basis.xY,Dt.ang1Z=this._basis.xZ,Dt.ang2X=this._basis.xX,Dt.ang2Y=this._basis.xY,Dt.ang2Z=this._basis.xZ}var bt=this._impulses[4],ft=Xt.rows[Xt.numRows++],dt=ft.jacobian;dt.lin1X=0,dt.lin1Y=0,dt.lin1Z=0,dt.lin2X=0,dt.lin2Y=0,dt.lin2Z=0,dt.ang1X=0,dt.ang1Y=0,dt.ang1Z=0,dt.ang2X=0,dt.ang2Y=0,dt.ang2Z=0,ft.rhs=0,ft.cfm=0,ft.minImpulse=0,ft.maxImpulse=0,ft.motorSpeed=0,ft.motorMaxImpulse=0,ft.impulse=null,ft.impulse=bt,(E=ft).rhs=z,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,(Dt=E.jacobian).ang1X=this._basis.yX,Dt.ang1Y=this._basis.yY,Dt.ang1Z=this._basis.yZ,Dt.ang2X=this._basis.yX,Dt.ang2Y=this._basis.yY,Dt.ang2Z=this._basis.yZ;var xt=this._impulses[5],ut=Xt.rows[Xt.numRows++],gt=ut.jacobian;gt.lin1X=0,gt.lin1Y=0,gt.lin1Z=0,gt.lin2X=0,gt.lin2Y=0,gt.lin2Z=0,gt.ang1X=0,gt.ang1Y=0,gt.ang1Z=0,gt.ang2X=0,gt.ang2Y=0,gt.ang2Z=0,ut.rhs=0,ut.cfm=0,ut.minImpulse=0,ut.maxImpulse=0,ut.motorSpeed=0,ut.motorMaxImpulse=0,ut.impulse=null,ut.impulse=xt,(E=ut).rhs=Y,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,(Dt=E.jacobian).ang1X=this._basis.zX,Dt.ang1Y=this._basis.zY,Dt.ang1Z=this._basis.zZ,Dt.ang2X=this._basis.zX,Dt.ang2Y=this._basis.zY,Dt.ang2Z=this._basis.zZ},_syncAnchors:function(){oimo_dynamics_constraint_joint_Joint.prototype._syncAnchors.call(this);var to=this._basis,R=to.joint._b1._invMass,q=to.joint._b2._invMass,E=to.joint._basisX1X*to.joint._basisX2X+to.joint._basisX1Y*to.joint._basisX2Y+to.joint._basisX1Z*to.joint._basisX2Z,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo,go,vo,Xo,uo,zo,Yo,Zo,Io,Mo,ho,Vo,Lo,Bo,ko,Ao,Po,To,wo,So,Co,qo,Ro,Eo;if(-.999999999>E){var jo=to.joint._basisX1X,O=to.joint._basisX1Y,W=to.joint._basisX1Z,U=jo*jo,H=O*O,Q=W*W,$,No,Fo,Do;U<H?U<Q?($=0,No=W*(Do=1/Math.sqrt(H+Q)),Fo=-O*Do):($=O*(Do=1/Math.sqrt(U+H)),No=-jo*Do,Fo=0):H<Q?($=-W*(Do=1/Math.sqrt(Q+U)),No=0,Fo=jo*Do):($=O*(Do=1/Math.sqrt(U+H)),No=-jo*Do,Fo=0),oo=$,ao=No,io=Fo,no=0}else{var Wo,Go,Oo;Wo=to.joint._basisX1Y*to.joint._basisX2Z-to.joint._basisX1Z*to.joint._basisX2Y,Go=to.joint._basisX1Z*to.joint._basisX2X-to.joint._basisX1X*to.joint._basisX2Z,Oo=to.joint._basisX1X*to.joint._basisX2Y-to.joint._basisX1Y*to.joint._basisX2X;var Ho=Math.sqrt(.5*(1+E));oo=Wo*=E=.5/Ho,ao=Go*=E,io=Oo*=E,no=Ho}var ot=(Po=0)*(Co=oo)+(To=0)*(qo=ao)+(wo=0)*(Ro=io)+(So=1)*(Eo=no);if(0>ot&&(ot=-ot,Co=-Co,qo=-qo,Ro=-Ro,Eo=-Eo),.999999<ot){var Jo=(Co=Po+(Co-Po)*(R/(R+q)))*Co+(qo=To+(qo-To)*(R/(R+q)))*qo+(Ro=wo+(Ro-wo)*(R/(R+q)))*Ro+(Eo=So+(Eo-So)*(R/(R+q)))*Eo;1e-32<Jo&&(Jo=1/Math.sqrt(Jo)),_o=Co*Jo,eo=qo*Jo,ro=Ro*Jo,so=Eo*Jo}else{var Uo=R/(R+q)*Math.acos(ot),st=(Co+=Po*-ot)*Co+(qo+=To*-ot)*qo+(Ro+=wo*-ot)*Ro+(Eo+=So*-ot)*Eo;1e-32<st&&(st=1/Math.sqrt(st)),Co*=st,qo*=st,Ro*=st,Eo*=st;var Qo=Math.sin(Uo),rt=Math.cos(Uo);_o=(Po*=rt)+Co*Qo,eo=(To*=rt)+qo*Qo,ro=(wo*=rt)+Ro*Qo,so=(So*=rt)+Eo*Qo}var et=2*_o,ht=2*eo,lt=2*ro,ct=_o*et,mt=eo*ht,pt=ro*lt,vt=_o*ht,yt=eo*lt,bt=_o*lt,ft=so*et,dt=so*ht,xt=so*lt;lo=vt-xt,co=bt+dt,po=vt+xt,mo=1-ct-pt,bo=yt-ft,xo=bt-dt,yo=yt+ft,fo=1-ct-mt,go=(1-mt-pt)*to.joint._basisX1X+lo*to.joint._basisX1Y+co*to.joint._basisX1Z,vo=po*to.joint._basisX1X+mo*to.joint._basisX1Y+bo*to.joint._basisX1Z,Xo=xo*to.joint._basisX1X+yo*to.joint._basisX1Y+fo*to.joint._basisX1Z,ho=to.xX,Vo=to.xY,Lo=to.xZ,Bo=to.yX,ko=to.yY,Ao=to.yZ;var ut=ho*go+Vo*vo+Lo*Xo;if(-.999999999>ut){var Ko=ho,Zt=Vo,It=Lo,Vt=Ko*Ko,Lt=Zt*Zt,wt=It*It,Bt,$o,ta,oa;Vt<Lt?Vt<wt?(Bt=0,$o=It*(oa=1/Math.sqrt(Lt+wt)),ta=-Zt*oa):(Bt=Zt*(oa=1/Math.sqrt(Vt+Lt)),$o=-Ko*oa,ta=0):Lt<wt?(Bt=-It*(oa=1/Math.sqrt(wt+Vt)),$o=0,ta=Ko*oa):(Bt=Zt*(oa=1/Math.sqrt(Vt+Lt)),$o=-Ko*oa,ta=0),_o=Bt,eo=$o,ro=ta,so=0}else{var aa,ia,na;aa=Vo*Xo-Lo*vo,ia=Lo*go-ho*Xo,na=ho*vo-Vo*go;var _a=Math.sqrt(.5*(1+ut));_o=aa*=ut=.5/_a,eo=ia*=ut,ro=na*=ut,so=_a}var St=2*_o,Rt=2*eo,qt=2*ro,Et=_o*St,Dt=eo*Rt,Jt=ro*qt,Ft=_o*Rt,Nt=eo*qt,Gt=_o*qt,Ot=so*St,Wt=so*Rt,Ut=so*qt,Ht,ea,ra;if(1e-6<(Zo=vo*(Yo=(xo=Gt-Wt)*Bo+(yo=Nt+Ot)*ko+(fo=1-Et-Dt)*Ao)-Xo*(zo=(po=Ft+Ut)*Bo+(mo=1-Et-Jt)*ko+(bo=Nt-Ot)*Ao))*Zo+(Io=Xo*(uo=(1-Dt-Jt)*Bo+(lo=Ft-Ut)*ko+(co=Gt+Wt)*Ao)-go*Yo)*Io+(Mo=go*zo-vo*uo)*Mo){var sa=Zo*Zo+Io*Io+Mo*Mo;0<sa&&(sa=1/Math.sqrt(sa)),Zo*=sa,Io*=sa,Mo*=sa}else{var la=go,Kt=vo,ca=Xo,pa=la*la,ma=Kt*Kt,ba=ca*ca,xa;pa<ma?pa<ba?(Zo=0,Io=ca*(xa=1/Math.sqrt(ma+ba)),Mo=-Kt*xa):(Zo=Kt*(xa=1/Math.sqrt(pa+ma)),Io=-la*xa,Mo=0):ma<ba?(Zo=-ca*(xa=1/Math.sqrt(ba+pa)),Io=0,Mo=la*xa):(Zo=Kt*(xa=1/Math.sqrt(pa+ma)),Io=-la*xa,Mo=0)}uo=Io*Xo-Mo*vo,zo=Mo*go-Zo*Xo,Yo=Zo*vo-Io*go,to.xX=go,to.xY=vo,to.xZ=Xo,to.yX=uo,to.yY=zo,to.yZ=Yo,to.zX=Zo,to.zY=Io,to.zZ=Mo,Ht=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,ea=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ra=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var da=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,ya=-1>=da?3.14159265358979:1<=da?0:Math.acos(da),fa=Ht*Ht+ea*ea+ra*ra,ga,va,Xa;0<fa&&(fa=1/Math.sqrt(fa)),Ht*=fa,ea*=fa,ra*=fa,Ht*=ya,ea*=ya,ra*=ya,this.angularErrorY=Ht*this._basis.yX+ea*this._basis.yY+ra*this._basis.yZ,this.angularErrorZ=Ht*this._basis.zX+ea*this._basis.zY+ra*this._basis.zZ,ga=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,va=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Xa=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,da=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=-1>=da?3.14159265358979:1<=da?0:Math.acos(da),0>ga*this._basis.xX+va*this._basis.xY+Xa*this._basis.xZ&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(o,t){oimo_dynamics_constraint_joint_Joint.prototype._getVelocitySolverInfo.call(this,o,t),this.getInfo(t,o,!1)},_getPositionSolverInfo:function(o){oimo_dynamics_constraint_joint_Joint.prototype._getPositionSolverInfo.call(this,o),this.getInfo(o,null,!0)},getAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,o},getAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,o},getAxis1To:function(o){var t=o;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},getAxis2To:function(o){var t=o;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},getLocalAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,o},getLocalAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,o},getLocalAxis1To:function(o){var t=o;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},getLocalAxis2To:function(o){var t=o;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getAngle:function(){return this.angle}});var oimo_dynamics_constraint_joint_RevoluteJointConfig=function(){oimo_dynamics_constraint_joint_JointConfig.call(this),this.localAxis1=new oimo_common_Vec3(1,0,0),this.localAxis2=new oimo_common_Vec3(1,0,0),this.springDamper=new oimo_dynamics_constraint_joint_SpringDamper,this.limitMotor=new oimo_dynamics_constraint_joint_RotationalLimitMotor};oimo_dynamics_constraint_joint_RevoluteJointConfig.__super__=oimo_dynamics_constraint_joint_JointConfig,oimo_dynamics_constraint_joint_RevoluteJointConfig.prototype=$extend(oimo_dynamics_constraint_joint_JointConfig.prototype,{init:function(g,t,i,o){var a,X,u;this._init(g,t,i);var z=o,l,Y,Z;a=z.x,X=z.y,u=z.z,l=g._transform._rotation00*a+g._transform._rotation10*X+g._transform._rotation20*u,Y=g._transform._rotation01*a+g._transform._rotation11*X+g._transform._rotation21*u,Z=g._transform._rotation02*a+g._transform._rotation12*X+g._transform._rotation22*u,a=l,X=Y,u=Z;var I=this.localAxis1,v,M,V;I.x=a,I.y=X,I.z=u;var L=o,d,B,k;v=L.x,M=L.y,V=L.z,d=t._transform._rotation00*v+t._transform._rotation10*M+t._transform._rotation20*V,B=t._transform._rotation01*v+t._transform._rotation11*M+t._transform._rotation21*V,k=t._transform._rotation02*v+t._transform._rotation12*M+t._transform._rotation22*V,v=d,M=B,V=k;var A=this.localAxis2;return A.x=v,A.y=M,A.z=V,this}});var oimo_dynamics_constraint_joint_RotationalLimitMotor=function(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0};oimo_dynamics_constraint_joint_RotationalLimitMotor.prototype={setLimits:function(o,t){return this.lowerLimit=o,this.upperLimit=t,this},setMotor:function(o,t){return this.motorSpeed=o,this.motorTorque=t,this},clone:function(){var o=new oimo_dynamics_constraint_joint_RotationalLimitMotor;return o.lowerLimit=this.lowerLimit,o.upperLimit=this.upperLimit,o.motorSpeed=this.motorSpeed,o.motorTorque=this.motorTorque,o}};var oimo_dynamics_constraint_joint_SphericalJoint=function(o){oimo_dynamics_constraint_joint_Joint.call(this,o,0),this._sd=o.springDamper.clone()};oimo_dynamics_constraint_joint_SphericalJoint.__super__=oimo_dynamics_constraint_joint_Joint,oimo_dynamics_constraint_joint_SphericalJoint.prototype=$extend(oimo_dynamics_constraint_joint_Joint.prototype,{getInfo:function(N,t,i){if(!(0<this._sd.frequency&&i)){var o,W,G,O,H;if(o=this._anchor2X-this._anchor1X,W=this._anchor2Y-this._anchor1Y,G=this._anchor2Z-this._anchor1Z,0<this._sd.frequency){var U=6.28318530717958*this._sd.frequency,e=this._sd.dampingRatio;e<oimo_common_Setting.minSpringDamperDampingRatio&&(e=oimo_common_Setting.minSpringDamperDampingRatio);var Q=t.dt,l=2*e*U,c=U*U;this._sd.useSymplecticEuler?(O=1/(Q*l),H=c/l):(O=1/(Q*(Q*c+l)),H=c/(Q*c+l)),O*=this._b1._invMass+this._b2._invMass}else O=0,H=i?1:this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;var m=o*H,B=W*H,k=G*H,A,K,$,tt,ot,at,it,nt,_t,et,rt,st,lt,ct,pt,mt,bt,xt;A=-(A=0),K=-(K=-this._relativeAnchor1Z),$=-($=this._relativeAnchor1Y),tt=-(tt=this._relativeAnchor1Z),ot=-(ot=0),at=-(at=-this._relativeAnchor1X),it=-(it=-this._relativeAnchor1Y),nt=-(nt=this._relativeAnchor1X),_t=-(_t=0),et=-(et=0),rt=-(rt=-this._relativeAnchor2Z),st=-(st=this._relativeAnchor2Y),lt=-(lt=this._relativeAnchor2Z),ct=-(ct=0),pt=-(pt=-this._relativeAnchor2X),mt=-(mt=-this._relativeAnchor2Y),bt=-(bt=this._relativeAnchor2X),xt=-(xt=0);var dt=this._impulses[0],P=N.rows[N.numRows++],S=P.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=dt;var C=P;C.rhs=m,C.cfm=O,C.minImpulse=-1/0,C.maxImpulse=1/0;var yt=C.jacobian;yt.lin1X=1,yt.lin1Y=0,yt.lin1Z=0,yt.lin2X=1,yt.lin2Y=0,yt.lin2Z=0,yt.ang1X=A,yt.ang1Y=K,yt.ang1Z=$,yt.ang2X=et,yt.ang2Y=rt,yt.ang2Z=st;var ft=this._impulses[1],R=N.rows[N.numRows++],q=R.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=ft,(C=R).rhs=B,C.cfm=O,C.minImpulse=-1/0,C.maxImpulse=1/0,(yt=C.jacobian).lin1X=0,yt.lin1Y=1,yt.lin1Z=0,yt.lin2X=0,yt.lin2Y=1,yt.lin2Z=0,yt.ang1X=tt,yt.ang1Y=ot,yt.ang1Z=at,yt.ang2X=lt,yt.ang2Y=ct,yt.ang2Z=pt;var E=this._impulses[2],D=N.rows[N.numRows++],J=D.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,D.rhs=0,D.cfm=0,D.minImpulse=0,D.maxImpulse=0,D.motorSpeed=0,D.motorMaxImpulse=0,D.impulse=null,D.impulse=E,(C=D).rhs=k,C.cfm=O,C.minImpulse=-1/0,C.maxImpulse=1/0,(yt=C.jacobian).lin1X=0,yt.lin1Y=0,yt.lin1Z=1,yt.lin2X=0,yt.lin2Y=0,yt.lin2Z=1,yt.ang1X=it,yt.ang1Y=nt,yt.ang1Z=_t,yt.ang2X=mt,yt.ang2Y=bt,yt.ang2Z=xt}},_getVelocitySolverInfo:function(o,t){oimo_dynamics_constraint_joint_Joint.prototype._getVelocitySolverInfo.call(this,o,t),this.getInfo(t,o,!1)},_getPositionSolverInfo:function(o){oimo_dynamics_constraint_joint_Joint.prototype._getPositionSolverInfo.call(this,o),this.getInfo(o,null,!0)},getSpringDamper:function(){return this._sd}});var oimo_dynamics_constraint_joint_SphericalJointConfig=function(){oimo_dynamics_constraint_joint_JointConfig.call(this),this.springDamper=new oimo_dynamics_constraint_joint_SpringDamper};oimo_dynamics_constraint_joint_SphericalJointConfig.__super__=oimo_dynamics_constraint_joint_JointConfig,oimo_dynamics_constraint_joint_SphericalJointConfig.prototype=$extend(oimo_dynamics_constraint_joint_JointConfig.prototype,{init:function(a,t,i){return this._init(a,t,i),this}});var oimo_dynamics_constraint_joint_SpringDamper=function(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1};oimo_dynamics_constraint_joint_SpringDamper.prototype={setSpring:function(o,t){return this.frequency=o,this.dampingRatio=t,this},setSymplecticEuler:function(o){return this.useSymplecticEuler=o,this},clone:function(){var o=new oimo_dynamics_constraint_joint_SpringDamper;return o.frequency=this.frequency,o.dampingRatio=this.dampingRatio,o.useSymplecticEuler=this.useSymplecticEuler,o}};var oimo_dynamics_constraint_joint_TranslationalLimitMotor=function(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0};oimo_dynamics_constraint_joint_TranslationalLimitMotor.prototype={setLimits:function(o,t){return this.lowerLimit=o,this.upperLimit=t,this},setMotor:function(o,t){return this.motorSpeed=o,this.motorForce=t,this},clone:function(){var o=new oimo_dynamics_constraint_joint_TranslationalLimitMotor;return o.lowerLimit=this.lowerLimit,o.upperLimit=this.upperLimit,o.motorSpeed=this.motorSpeed,o.motorForce=this.motorForce,o}};var oimo_dynamics_constraint_joint_UniversalJoint=function(W){oimo_dynamics_constraint_joint_Joint.call(this,W,oimo_dynamics_constraint_joint_JointType.UNIVERSAL);var t=W.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=W.localAxis2;if(this._localBasisZ2X=i.x,this._localBasisZ2Y=i.y,this._localBasisZ2Z=i.z,0==this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var o=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;0<o&&(o=1/Math.sqrt(o)),this._localBasisX1X*=o,this._localBasisX1Y*=o,this._localBasisX1Z*=o}if(0==this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var H=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;0<H&&(H=1/Math.sqrt(H)),this._localBasisZ2X*=H,this._localBasisZ2Y*=H,this._localBasisZ2Z*=H}var U=this._b1._transform,R=this._b2._transform,q,Q,K,$,tt,ot,at,it,nt,_t,et,rt,st,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt,ht,Vt,Lt;if(q=U._rotation00*this._localBasisX1X+U._rotation01*this._localBasisX1Y+U._rotation02*this._localBasisX1Z,Q=U._rotation10*this._localBasisX1X+U._rotation11*this._localBasisX1Y+U._rotation12*this._localBasisX1Z,K=U._rotation20*this._localBasisX1X+U._rotation21*this._localBasisX1Y+U._rotation22*this._localBasisX1Z,pt=R._rotation00*this._localBasisZ2X+R._rotation01*this._localBasisZ2Y+R._rotation02*this._localBasisZ2Z,0==(at=(lt=R._rotation10*this._localBasisZ2X+R._rotation11*this._localBasisZ2Y+R._rotation12*this._localBasisZ2Z)*K-(ct=R._rotation20*this._localBasisZ2X+R._rotation21*this._localBasisZ2Y+R._rotation22*this._localBasisZ2Z)*Q)*at+(it=ct*q-(st=pt)*K)*it+(nt=st*Q-lt*q)*nt){var Bt=q,D=Q,J=K,F=Bt*Bt,N=D*D,G=J*J,O;F<N?F<G?(at=0,it=J*(O=1/Math.sqrt(N+G)),nt=-D*O):(at=D*(O=1/Math.sqrt(F+N)),it=-Bt*O,nt=0):N<G?(at=-J*(O=1/Math.sqrt(G+F)),it=0,nt=Bt*O):(at=D*(O=1/Math.sqrt(F+N)),it=-Bt*O,nt=0)}$=Q*nt-K*it,tt=K*at-q*nt,ot=q*it-Q*at,_t=it*ct-nt*lt,et=nt*st-at*ct,rt=at*lt-it*st,mt=U._rotation00*q+U._rotation10*Q+U._rotation20*K,bt=U._rotation01*q+U._rotation11*Q+U._rotation21*K,xt=U._rotation02*q+U._rotation12*Q+U._rotation22*K,this._localBasisX1X=mt,this._localBasisX1Y=bt,this._localBasisX1Z=xt,dt=U._rotation00*at+U._rotation10*it+U._rotation20*nt,yt=U._rotation01*at+U._rotation11*it+U._rotation21*nt,ft=U._rotation02*at+U._rotation12*it+U._rotation22*nt,this._localBasisY1X=dt,this._localBasisY1Y=yt,this._localBasisY1Z=ft,gt=U._rotation00*$+U._rotation10*tt+U._rotation20*ot,vt=U._rotation01*$+U._rotation11*tt+U._rotation21*ot,Xt=U._rotation02*$+U._rotation12*tt+U._rotation22*ot,this._localBasisZ1X=gt,this._localBasisZ1Y=vt,this._localBasisZ1Z=Xt,ut=R._rotation00*_t+R._rotation10*et+R._rotation20*rt,zt=R._rotation01*_t+R._rotation11*et+R._rotation21*rt,Yt=R._rotation02*_t+R._rotation12*et+R._rotation22*rt,this._localBasisX2X=ut,this._localBasisX2Y=zt,this._localBasisX2Z=Yt,Zt=R._rotation00*at+R._rotation10*it+R._rotation20*nt,It=R._rotation01*at+R._rotation11*it+R._rotation21*nt,Mt=R._rotation02*at+R._rotation12*it+R._rotation22*nt,this._localBasisY2X=Zt,this._localBasisY2Y=It,this._localBasisY2Z=Mt,ht=R._rotation00*st+R._rotation10*lt+R._rotation20*ct,Vt=R._rotation01*st+R._rotation11*lt+R._rotation21*ct,Lt=R._rotation02*st+R._rotation12*lt+R._rotation22*ct,this._localBasisZ2X=ht,this._localBasisZ2Y=Vt,this._localBasisZ2Z=Lt,this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=W.springDamper1.clone(),this._sd2=W.springDamper2.clone(),this._lm1=W.limitMotor1.clone(),this._lm2=W.limitMotor2.clone()};oimo_dynamics_constraint_joint_UniversalJoint.__super__=oimo_dynamics_constraint_joint_Joint,oimo_dynamics_constraint_joint_UniversalJoint.prototype=$extend(oimo_dynamics_constraint_joint_Joint.prototype,{getInfo:function(Kt,t,i){var o=i?1:this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0,g=this.linearErrorX*o,M=this.linearErrorY*o,X=this.linearErrorZ*o,z=this._angleY*o,Y,$t,to,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo;Y=-(Y=0),$t=-($t=-this._relativeAnchor1Z),to=-(to=this._relativeAnchor1Y),oo=-(oo=this._relativeAnchor1Z),ao=-(ao=0),io=-(io=-this._relativeAnchor1X),no=-(no=-this._relativeAnchor1Y),_o=-(_o=this._relativeAnchor1X),eo=-(eo=0),ro=-(ro=0),so=-(so=-this._relativeAnchor2Z),lo=-(lo=this._relativeAnchor2Y),co=-(co=this._relativeAnchor2Z),po=-(po=0),mo=-(mo=-this._relativeAnchor2X),bo=-(bo=-this._relativeAnchor2Y),xo=-(xo=this._relativeAnchor2X),yo=-(yo=0);var fo=this._axisXX,Z=this._axisXY,I=this._axisXZ,V=(this._b1._invInertia00*fo+this._b1._invInertia01*Z+this._b1._invInertia02*I)*fo+(this._b1._invInertia10*fo+this._b1._invInertia11*Z+this._b1._invInertia12*I)*Z+(this._b1._invInertia20*fo+this._b1._invInertia21*Z+this._b1._invInertia22*I)*I,go=(this._b2._invInertia00*fo+this._b2._invInertia01*Z+this._b2._invInertia02*I)*fo+(this._b2._invInertia10*fo+this._b2._invInertia11*Z+this._b2._invInertia12*I)*Z+(this._b2._invInertia20*fo+this._b2._invInertia21*Z+this._b2._invInertia22*I)*I;if(0<V){var vo=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,B=fo*this._relativeAnchor1X+Z*this._relativeAnchor1Y+I*this._relativeAnchor1Z,k=vo-B*B;0<k&&(V=0<this._b1._invMass?1/(1/V+this._b1._mass*k):0)}if(0<go){var A=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,P=fo*this._relativeAnchor2X+Z*this._relativeAnchor2Y+I*this._relativeAnchor2Z,S=A-P*P;0<S&&(go=0<this._b2._invMass?1/(1/go+this._b2._mass*S):0)}var C=0==V+go?0:1/(V+go),T=this._axisZX,j=this._axisZY,R=this._axisZZ,q=(this._b1._invInertia00*T+this._b1._invInertia01*j+this._b1._invInertia02*R)*T+(this._b1._invInertia10*T+this._b1._invInertia11*j+this._b1._invInertia12*R)*j+(this._b1._invInertia20*T+this._b1._invInertia21*j+this._b1._invInertia22*R)*R,Xo=(this._b2._invInertia00*T+this._b2._invInertia01*j+this._b2._invInertia02*R)*T+(this._b2._invInertia10*T+this._b2._invInertia11*j+this._b2._invInertia12*R)*j+(this._b2._invInertia20*T+this._b2._invInertia21*j+this._b2._invInertia22*R)*R;if(0<q){var uo=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,J=T*this._relativeAnchor1X+j*this._relativeAnchor1Y+R*this._relativeAnchor1Z,F=uo-J*J;0<F&&(q=0<this._b1._invMass?1/(1/q+this._b1._mass*F):0)}if(0<Xo){var N=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,G=T*this._relativeAnchor2X+j*this._relativeAnchor2Y+R*this._relativeAnchor2Z,O=N-G*G;0<O&&(Xo=0<this._b2._invMass?1/(1/Xo+this._b2._mass*O):0)}var W=0==q+Xo?0:1/(q+Xo),U=this._impulses[0],H=Kt.rows[Kt.numRows++],Q=H.jacobian;Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=U;var $=H;$.rhs=g,$.cfm=0,$.minImpulse=-1/0,$.maxImpulse=1/0;var zo=$.jacobian;zo.lin1X=1,zo.lin1Y=0,zo.lin1Z=0,zo.lin2X=1,zo.lin2Y=0,zo.lin2Z=0,zo.ang1X=Y,zo.ang1Y=$t,zo.ang1Z=to,zo.ang2X=ro,zo.ang2Y=so,zo.ang2Z=lo;var Yo=this._impulses[1],it=Kt.rows[Kt.numRows++],ot=it.jacobian;ot.lin1X=0,ot.lin1Y=0,ot.lin1Z=0,ot.lin2X=0,ot.lin2Y=0,ot.lin2Z=0,ot.ang1X=0,ot.ang1Y=0,ot.ang1Z=0,ot.ang2X=0,ot.ang2Y=0,ot.ang2Z=0,it.rhs=0,it.cfm=0,it.minImpulse=0,it.maxImpulse=0,it.motorSpeed=0,it.motorMaxImpulse=0,it.impulse=null,it.impulse=Yo,($=it).rhs=M,$.cfm=0,$.minImpulse=-1/0,$.maxImpulse=1/0,(zo=$.jacobian).lin1X=0,zo.lin1Y=1,zo.lin1Z=0,zo.lin2X=0,zo.lin2Y=1,zo.lin2Z=0,zo.ang1X=oo,zo.ang1Y=ao,zo.ang1Z=io,zo.ang2X=co,zo.ang2Y=po,zo.ang2Z=mo;var at=this._impulses[2],nt=Kt.rows[Kt.numRows++],st=nt.jacobian;if(st.lin1X=0,st.lin1Y=0,st.lin1Z=0,st.lin2X=0,st.lin2Y=0,st.lin2Z=0,st.ang1X=0,st.ang1Y=0,st.ang1Z=0,st.ang2X=0,st.ang2Y=0,st.ang2Z=0,nt.rhs=0,nt.cfm=0,nt.minImpulse=0,nt.maxImpulse=0,nt.motorSpeed=0,nt.motorMaxImpulse=0,nt.impulse=null,nt.impulse=at,($=nt).rhs=X,$.cfm=0,$.minImpulse=-1/0,$.maxImpulse=1/0,(zo=$.jacobian).lin1X=0,zo.lin1Y=0,zo.lin1Z=1,zo.lin2X=0,zo.lin2Y=0,zo.lin2Z=1,zo.ang1X=no,zo.ang1Y=_o,zo.ang1Z=eo,zo.ang2X=bo,zo.ang2Y=xo,zo.ang2Z=yo,!this.xSingular&&(0>=this._sd1.frequency||!i)){var _t=this._impulses[3],rt=Kt.rows[Kt.numRows++],et=rt.jacobian;et.lin1X=0,et.lin1Y=0,et.lin1Z=0,et.lin2X=0,et.lin2Y=0,et.lin2Z=0,et.ang1X=0,et.ang1Y=0,et.ang1Z=0,et.ang2X=0,et.ang2Y=0,et.ang2Z=0,rt.rhs=0,rt.cfm=0,rt.minImpulse=0,rt.maxImpulse=0,rt.motorSpeed=0,rt.motorMaxImpulse=0,rt.impulse=null,rt.impulse=_t,$=rt;var ht=this._angleX,Zo=this._lm1,pt=this._sd1,vt=oimo_common_Setting.angularSlop,Io,Mo;if(i)Io=0,Mo=1;else{if(0<pt.frequency){vt=0;var ho=6.28318530717958*pt.frequency,bt=pt.dampingRatio;bt<oimo_common_Setting.minSpringDamperDampingRatio&&(bt=oimo_common_Setting.minSpringDamperDampingRatio);var Vo=t.dt,dt=2*bt*ho,xt=ho*ho;pt.useSymplecticEuler?(Io=1/(Vo*dt),Mo=xt/dt):(Io=1/(Vo*(Vo*xt+dt)),Mo=xt/(Vo*xt+dt))}else Io=0,Mo=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<Zo.motorTorque?($.motorSpeed=Zo.motorSpeed,$.motorMaxImpulse=Zo.motorTorque*t.dt):($.motorSpeed=0,$.motorMaxImpulse=0)}var ut=Zo.lowerLimit,zt=Zo.upperLimit,Yt=.5*(ut+zt),Zt,Lo,Bo;ht=(((ht-=Yt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,ht+=Yt,ut>zt?(Zt=0,Lo=0,Bo=0):ut==zt?(Zt=-1/0,Lo=1/0,Bo=ht-ut):ht<ut?(Zt=-1/0,Lo=0,0<(Bo=ht-ut+vt)&&(Bo=0)):ht>zt?(Zt=0,Lo=1/0,0>(Bo=ht-zt-vt)&&(Bo=0)):(Zt=0,Lo=0,Bo=0);var ko=0==C?0:1/C;$.minImpulse=Zt,$.maxImpulse=Lo,$.cfm=Io*ko,$.rhs=Bo*Mo,(zo=$.jacobian).ang1X=this._axisXX,zo.ang1Y=this._axisXY,zo.ang1Z=this._axisXZ,zo.ang2X=this._axisXX,zo.ang2Y=this._axisXY,zo.ang2Z=this._axisXZ}if(!this.ySingular){var It=this._impulses[4],Vt=Kt.rows[Kt.numRows++],Lt=Vt.jacobian;Lt.lin1X=0,Lt.lin1Y=0,Lt.lin1Z=0,Lt.lin2X=0,Lt.lin2Y=0,Lt.lin2Z=0,Lt.ang1X=0,Lt.ang1Y=0,Lt.ang1Z=0,Lt.ang2X=0,Lt.ang2Y=0,Lt.ang2Z=0,Vt.rhs=0,Vt.cfm=0,Vt.minImpulse=0,Vt.maxImpulse=0,Vt.motorSpeed=0,Vt.motorMaxImpulse=0,Vt.impulse=null,Vt.impulse=It,($=Vt).rhs=z,$.cfm=0,$.minImpulse=-1/0,$.maxImpulse=1/0,(zo=$.jacobian).ang1X=this._axisYX,zo.ang1Y=this._axisYY,zo.ang1Z=this._axisYZ,zo.ang2X=this._axisYX,zo.ang2Y=this._axisYY,zo.ang2Z=this._axisYZ}if(!this.zSingular&&(0>=this._sd2.frequency||!i)){var wt=this._impulses[5],Bt=Kt.rows[Kt.numRows++],kt=Bt.jacobian;kt.lin1X=0,kt.lin1Y=0,kt.lin1Z=0,kt.lin2X=0,kt.lin2Y=0,kt.lin2Z=0,kt.ang1X=0,kt.ang1Y=0,kt.ang1Z=0,kt.ang2X=0,kt.ang2Y=0,kt.ang2Z=0,Bt.rhs=0,Bt.cfm=0,Bt.minImpulse=0,Bt.maxImpulse=0,Bt.motorSpeed=0,Bt.motorMaxImpulse=0,Bt.impulse=null,Bt.impulse=wt,$=Bt;var At=this._angleZ,Ao=this._lm2,Tt=this._sd2,jt=oimo_common_Setting.angularSlop,Po,To;if(i)Po=0,To=1;else{if(0<Tt.frequency){jt=0;var wo=6.28318530717958*Tt.frequency,qt=Tt.dampingRatio;qt<oimo_common_Setting.minSpringDamperDampingRatio&&(qt=oimo_common_Setting.minSpringDamperDampingRatio);var So=t.dt,Dt=2*qt*wo,Jt=wo*wo;Tt.useSymplecticEuler?(Po=1/(So*Dt),To=Jt/Dt):(Po=1/(So*(So*Jt+Dt)),To=Jt/(So*Jt+Dt))}else Po=0,To=this._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo_common_Setting.velocityBaumgarte:0;0<Ao.motorTorque?($.motorSpeed=Ao.motorSpeed,$.motorMaxImpulse=Ao.motorTorque*t.dt):($.motorSpeed=0,$.motorMaxImpulse=0)}var Ft=Ao.lowerLimit,Wt=Ao.upperLimit,Ut=.5*(Ft+Wt),Ht,Co,qo;At=(((At-=Ut)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,At+=Ut,Ft>Wt?(Ht=0,Co=0,qo=0):Ft==Wt?(Ht=-1/0,Co=1/0,qo=At-Ft):At<Ft?(Ht=-1/0,Co=0,0<(qo=At-Ft+jt)&&(qo=0)):At>Wt?(Ht=0,Co=1/0,0>(qo=At-Wt-jt)&&(qo=0)):(Ht=0,Co=0,qo=0);var Ro=0==W?0:1/W;$.minImpulse=Ht,$.maxImpulse=Co,$.cfm=Po*Ro,$.rhs=qo*To,(zo=$.jacobian).ang1X=this._axisZX,zo.ang1Y=this._axisZY,zo.ang1Z=this._axisZZ,zo.ang2X=this._axisZX,zo.ang2Y=this._axisZY,zo.ang2Z=this._axisZZ}},_syncAnchors:function(){var et,rt,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt,ht,Vt,Lt,Bt,kt,At,Pt;oimo_dynamics_constraint_joint_Joint.prototype._syncAnchors.call(this),et=this._basisX1X,rt=this._basisY1X,lt=this._basisZ1X,ct=this._basisX1Y,pt=this._basisY1Y,mt=this._basisZ1Y,bt=this._basisX1Z,xt=this._basisY1Z,dt=this._basisZ1Z,yt=this._basisX2X,ft=this._basisY2X,gt=this._basisZ2X,vt=this._basisX2Y,Xt=this._basisY2Y,ut=this._basisZ2Y,zt=this._basisX2Z,Yt=this._basisY2Z,Zt=this._basisZ2Z,It=this._basisX1X,Mt=this._basisX1Y,ht=this._basisX1Z,kt=this._basisZ2X,Vt=(At=this._basisZ2Y)*ht-(Pt=this._basisZ2Z)*Mt,Lt=Pt*It-kt*ht,Bt=kt*Mt-At*It,this._axisXX=Lt*Pt-Bt*At,this._axisXY=Bt*kt-Vt*Pt,this._axisXZ=Vt*At-Lt*kt,this._axisYX=Vt,this._axisYY=Lt,this._axisYZ=Bt,this._axisZX=Mt*Bt-ht*Lt,this._axisZY=ht*Vt-It*Bt,this._axisZZ=It*Lt-Mt*Vt;var Tt=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;0<Tt&&(Tt=1/Math.sqrt(Tt)),this._axisXX*=Tt,this._axisXY*=Tt,this._axisXZ*=Tt;var wt=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;0<wt&&(wt=1/Math.sqrt(wt)),this._axisYX*=wt,this._axisYY*=wt,this._axisYZ*=wt;var St=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ,Ct,qt,Rt,Et,jt,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo,ro,so,lo;0<St&&(St=1/Math.sqrt(St)),this._axisZX*=St,this._axisZY*=St,this._axisZZ*=St,this.xSingular=0==this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ,this.ySingular=0==this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ,this.zSingular=0==this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ,Ct=this._basisX1X,qt=this._basisY1X,Rt=this._basisZ1X,Et=this._basisX1Y,jt=this._basisY1Y,Nt=this._basisZ1Y,Ft=this._basisX1Z,Dt=this._basisY1Z,Wt=this._basisZ1Z,Gt=this._basisX2X,Ot=this._basisY2X,Ht=this._basisZ2X,Jt=this._basisX2Y,Ut=this._basisY2Y,Qt=this._basisZ2Y,oo=Ct*Gt+Et*Jt+Ft*(Kt=this._basisX2Z),ao=Ct*Ot+Et*Ut+Ft*($t=this._basisY2Z),io=qt*Ot+jt*Ut+Dt*$t,no=qt*Ht+jt*Qt+Dt*(to=this._basisZ2Z),_o=Rt*Ot+Nt*Ut+Wt*$t,eo=Rt*Ht+Nt*Qt+Wt*to;var co=Ct*Ht+Et*Qt+Ft*to;if(-1>=co){var at=Math.atan2(_o,io);ro=.5*at,so=-1.570796326794895,lo=.5*-at}else if(1<=co){var nt=Math.atan2(_o,io);ro=.5*nt,so=1.570796326794895,lo=.5*nt}else{var st=Math.asin(co);ro=Math.atan2(-no,eo),so=st,lo=Math.atan2(-ao,oo)}this._angleX=ro,this._angleY=so,this._angleZ=lo,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(o,t){oimo_dynamics_constraint_joint_Joint.prototype._getVelocitySolverInfo.call(this,o,t),this.getInfo(t,o,!1)},_getPositionSolverInfo:function(o){oimo_dynamics_constraint_joint_Joint.prototype._getPositionSolverInfo.call(this,o),this.getInfo(o,null,!0)},getAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,o},getAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,o},getAxis1To:function(o){var t=o;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},getAxis2To:function(o){var t=o;t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z},getLocalAxis1:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,o},getLocalAxis2:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,o},getLocalAxis1To:function(o){var t=o;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},getLocalAxis2To:function(o){var t=o;t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z},getSpringDamper1:function(){return this._sd1},getSpringDamper2:function(){return this._sd2},getLimitMotor1:function(){return this._lm1},getLimitMotor2:function(){return this._lm2},getAngle1:function(){return this._angleX},getAngle2:function(){return this._angleZ}});var oimo_dynamics_constraint_joint_UniversalJointConfig=function(){oimo_dynamics_constraint_joint_JointConfig.call(this),this.localAxis1=new oimo_common_Vec3(1,0,0),this.localAxis2=new oimo_common_Vec3(1,0,0),this.springDamper1=new oimo_dynamics_constraint_joint_SpringDamper,this.springDamper2=new oimo_dynamics_constraint_joint_SpringDamper,this.limitMotor1=new oimo_dynamics_constraint_joint_RotationalLimitMotor,this.limitMotor2=new oimo_dynamics_constraint_joint_RotationalLimitMotor};oimo_dynamics_constraint_joint_UniversalJointConfig.__super__=oimo_dynamics_constraint_joint_JointConfig,oimo_dynamics_constraint_joint_UniversalJointConfig.prototype=$extend(oimo_dynamics_constraint_joint_JointConfig.prototype,{init:function(g,t,i,o,a){var n,X,z;this._init(g,t,i);var Y=o,c,Z,I;n=Y.x,X=Y.y,z=Y.z,c=g._transform._rotation00*n+g._transform._rotation10*X+g._transform._rotation20*z,Z=g._transform._rotation01*n+g._transform._rotation11*X+g._transform._rotation21*z,I=g._transform._rotation02*n+g._transform._rotation12*X+g._transform._rotation22*z,n=c,X=Z,z=I;var M=this.localAxis1,y,V,L;M.x=n,M.y=X,M.z=z;var B=a,x,k,A;y=B.x,V=B.y,L=B.z,x=t._transform._rotation00*y+t._transform._rotation10*V+t._transform._rotation20*L,k=t._transform._rotation01*y+t._transform._rotation11*V+t._transform._rotation21*L,A=t._transform._rotation02*y+t._transform._rotation12*V+t._transform._rotation22*L,y=x,V=k,L=A;var P=this.localAxis2;return P.x=y,P.y=V,P.z=L,this}});var oimo_dynamics_constraint_solver_ConstraintSolverType=function(){},oimo_dynamics_constraint_solver_common_ContactSolverMassDataRow=function(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0},oimo_dynamics_constraint_solver_common_JointSolverMassDataRow=function(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0},oimo_dynamics_constraint_solver_direct_Boundary=function(_){var t=Array(_);this.iBounded=t;var i=Array(_);this.iUnbounded=i;var o=Array(_);this.signs=o;var a=Array(_);this.b=a,this.numBounded=0,this.numUnbounded=0,this.matrixId=0};oimo_dynamics_constraint_solver_direct_Boundary.prototype={init:function(e){this.numBounded=e.numBounded;for(var t=0,l=this.numBounded,o;t<l;)o=t++,this.iBounded[o]=e.iBounded[o],this.signs[o]=e.signs[o];this.numUnbounded=e.numUnbounded,this.matrixId=0;for(var c=0,p=this.numUnbounded;c<p;){var s=c++,_=e.iUnbounded[s];this.iUnbounded[s]=_,this.matrixId|=1<<_}},computeImpulses:function(I,t,i,o,a,n,s){for(var _=0,P=this.numUnbounded;_<P;){var e=_++,h=this.iUnbounded[e],l=I.rows[h],c=i[h];this.b[h]=l.rhs*n-c-l.cfm*o[h]}for(var m=t._invMassWithoutCfm,p=0,_t=this.numBounded;p<_t;){var y=p++,b=this.iBounded[y],f=this.signs[y],d=I.rows[b],x=o[b],u=(0>f?d.minImpulse:0<f?d.maxImpulse:0)-x;if(a[b]=u,0!=u)for(var g=0,et=this.numUnbounded;g<et;){var X=g++,z=this.iUnbounded[X],Y=m[b][z]*u,Z=this.b;Z[z]-=Y}}for(var V=this.iUnbounded,w=this.numUnbounded,B=0,rt=0,st;rt<w;)B|=1<<V[rt++];t._cacheComputed[B]?st=t._cachedSubmatrices[B]:(t.computeSubmatrix(B,V,w),t._cacheComputed[B]=!0,st=t._cachedSubmatrices[B]);for(var lt=!0,ct=0,pt=this.numUnbounded;ct<pt;){for(var T=ct++,j=this.iUnbounded[T],R=I.rows[j],q=o[j],E=q,mt=0,bt=this.numUnbounded;mt<bt;){var F=mt++,N=this.iUnbounded[F];E+=this.b[N]*st[T][F]}if(E<R.minImpulse-oimo_common_Setting.directMlcpSolverEps||E>R.maxImpulse+oimo_common_Setting.directMlcpSolverEps){lt=!1;break}a[j]=E-q}if(s)return!0;if(!lt)return!1;for(var G=0,xt=this.numBounded;G<xt;){for(var W=G++,H=this.iBounded[W],Q=I.rows[H],$=this.signs[W],K=o[H]+a[H],tt=i[H],dt=0,yt=I.numRows,at,ft;dt<yt;)ft=dt++,tt+=m[H][ft]*a[ft];if(at=Q.rhs*n-tt-Q.cfm*K,0>$&&at>oimo_common_Setting.directMlcpSolverEps||0<$&&at<-oimo_common_Setting.directMlcpSolverEps){lt=!1;break}}return lt}};var oimo_dynamics_constraint_solver_direct_BoundaryBuildInfo=function(n){this.size=n,this.numBounded=0;var t=Array(n);this.iBounded=t;var i=Array(n);this.signs=i,this.numUnbounded=0;var o=Array(n);this.iUnbounded=o},oimo_dynamics_constraint_solver_direct_BoundaryBuilder=function(o){this.maxRows=o,this.numBoundaries=0;var t=Array(1<<o);this.boundaries=t,this.bbInfo=new oimo_dynamics_constraint_solver_direct_BoundaryBuildInfo(o)};oimo_dynamics_constraint_solver_direct_BoundaryBuilder.prototype={buildBoundariesRecursive:function(l,t){if(t==l.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new oimo_dynamics_constraint_solver_direct_Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);var i=l.rows[t],o=i.minImpulse>-1/0,a=i.maxImpulse<1/0;if(0==i.minImpulse&&0==i.maxImpulse){var n=this.bbInfo;return n.iBounded[n.numBounded]=t,n.signs[n.numBounded]=0,n.numBounded++,this.buildBoundariesRecursive(l,t+1),void this.bbInfo.numBounded--}var s=this.bbInfo;if(s.iUnbounded[s.numUnbounded]=t,s.numUnbounded++,this.buildBoundariesRecursive(l,t+1),this.bbInfo.numUnbounded--,o){var _=this.bbInfo;_.iBounded[_.numBounded]=t,_.signs[_.numBounded]=-1,_.numBounded++,this.buildBoundariesRecursive(l,t+1),this.bbInfo.numBounded--}if(a){var r=this.bbInfo;r.iBounded[r.numBounded]=t,r.signs[r.numBounded]=1,r.numBounded++,this.buildBoundariesRecursive(l,t+1),this.bbInfo.numBounded--}},buildBoundaries:function(o){this.numBoundaries=0;var t=this.bbInfo;t.numBounded=0,t.numUnbounded=0,this.buildBoundariesRecursive(o,0)}};var oimo_dynamics_constraint_solver_direct_BoundarySelector=function(n){this.n=n;var t=Array(n);this.indices=t;var i=Array(n);this.tmpIndices=i;for(var o=0,_;o<n;)_=o++,this.indices[_]=_};oimo_dynamics_constraint_solver_direct_BoundarySelector.prototype={getIndex:function(o){return this.indices[o]},select:function(a){for(var t=0;this.indices[t]!=a;)++t;for(;0<t;){var n=this.indices[t];this.indices[t]=this.indices[t-1],this.indices[t-1]=n,--t}},setSize:function(e){for(var t=0,l=0,c=0,p=this.n;c<p;){var n=c++,s=this.indices[n];s<e?(this.tmpIndices[t]=s,++t):(this.tmpIndices[e+l]=s,++l)}var _=this.indices;this.indices=this.tmpIndices,this.tmpIndices=_}};var oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver=function(m){oimo_dynamics_constraint_ConstraintSolver.call(this),this.joint=m,this.info=new oimo_dynamics_constraint_info_joint_JointSolverInfo;var t=oimo_common_Setting.maxJacobianRows;this.massMatrix=new oimo_dynamics_constraint_solver_direct_MassMatrix(t),this.boundaryBuilder=new oimo_dynamics_constraint_solver_direct_BoundaryBuilder(t);var i=Array(t);this.massData=i;for(var o=0,b=this.massData.length,n;o<b;)n=o++,this.massData[n]=new oimo_dynamics_constraint_solver_common_JointSolverMassDataRow;var x=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new oimo_dynamics_constraint_solver_direct_BoundarySelector(x),this.posBoundarySelector=new oimo_dynamics_constraint_solver_direct_BoundarySelector(x);var _=Array(t);this.relVels=_;var r=Array(t);this.impulses=r;var e=Array(t);this.dImpulses=e;var d=Array(t);this.dTotalImpulses=d;for(var l=0,y;l<t;)y=l++,this.relVels[y]=0,this.impulses[y]=0,this.dImpulses[y]=0,this.dTotalImpulses[y]=0};oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.__super__=oimo_dynamics_constraint_ConstraintSolver,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype=$extend(oimo_dynamics_constraint_ConstraintSolver.prototype,{preSolveVelocity:function(p){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(p,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var o=this.velBoundarySelector,a=this.boundaryBuilder.numBoundaries,n=0,m=0,b=0,x=o.n;b<x;){var e=b++,d=o.indices[e];d<a?(o.tmpIndices[n]=d,++n):(o.tmpIndices[a+m]=d,++m)}var l=o.indices;o.indices=o.tmpIndices,o.tmpIndices=l},warmStart:function(T){var t=this.joint._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?oimo_common_Setting.jointWarmStartingFactorForBaungarte:oimo_common_Setting.jointWarmStartingFactor;if(0>=(t*=T.dtRatio))for(var S=0,C=this.info.numRows;S<C;){var a=S++,n=this.info.rows[a].impulse;n.impulse=0,n.impulseM=0,n.impulseP=0}else{for(var s=0,q=this.info.numRows;s<q;){var r=s++,e=this.info.rows[r],h=e.impulse,l=h.impulse*t;if(l<e.minImpulse?l=e.minImpulse:l>e.maxImpulse&&(l=e.maxImpulse),h.impulse=l,0<e.motorMaxImpulse){var R=h.impulseM*t,E=e.motorMaxImpulse;R<-E?R=-E:R>E&&(R=E),h.impulseM=R}else h.impulseM=0;this.dImpulses[r]=h.impulse+h.impulseM}var p=this.dImpulses,Z=!1,j=!1,N,F,D,W,G,O,H,J,U,Q,K,$;N=this._b1._velX,F=this._b1._velY,D=this._b1._velZ,W=this._b2._velX,G=this._b2._velY,O=this._b2._velZ,H=this._b1._angVelX,J=this._b1._angVelY,U=this._b1._angVelZ,Q=this._b2._angVelX,K=this._b2._angVelY,$=this._b2._angVelZ;for(var tt=0,ot=this.info.numRows;tt<ot;){var w=tt++,B=this.info.rows[w].jacobian,k=this.massData[w],A=p[w];0!=(1&B.flag)&&(N+=k.invMLin1X*A,F+=k.invMLin1Y*A,D+=k.invMLin1Z*A,W+=k.invMLin2X*-A,G+=k.invMLin2Y*-A,O+=k.invMLin2Z*-A,Z=!0),0!=(2&B.flag)&&(H+=k.invMAng1X*A,J+=k.invMAng1Y*A,U+=k.invMAng1Z*A,Q+=k.invMAng2X*-A,K+=k.invMAng2Y*-A,$+=k.invMAng2Z*-A,j=!0)}Z&&(this._b1._velX=N,this._b1._velY=F,this._b1._velZ=D,this._b2._velX=W,this._b2._velY=G,this._b2._velZ=O),j&&(this._b1._angVelX=H,this._b1._angVelY=J,this._b1._angVelZ=U,this._b2._angVelX=Q,this._b2._angVelY=K,this._b2._angVelZ=$)}},solveVelocity:function(){var v=this.info.numRows,m,M,k,P,D,G,xt,dt,gt,Xt,ut,zt;m=this._b1._velX,M=this._b1._velY,k=this._b1._velZ,P=this._b2._velX,D=this._b2._velY,G=this._b2._velZ,xt=this._b1._angVelX,dt=this._b1._angVelY,gt=this._b1._angVelZ,Xt=this._b2._angVelX,ut=this._b2._angVelY,zt=this._b2._angVelZ;for(var Yt=0;Yt<v;){var Zt=Yt++,y=this.info.rows[Zt],b=y.impulse,f=y.jacobian,d=0;d+=m*f.lin1X+M*f.lin1Y+k*f.lin1Z,d-=P*f.lin2X+D*f.lin2Y+G*f.lin2Z,d+=xt*f.ang1X+dt*f.ang1Y+gt*f.ang1Z,d-=Xt*f.ang2X+ut*f.ang2Y+zt*f.ang2Z,this.relVels[Zt]=d,this.impulses[Zt]=b.impulse,this.dTotalImpulses[Zt]=0}for(var It=this.massMatrix._invMassWithoutCfm,u=0;u<v;){var Mt=u++,X=this.info.rows[Mt],z=X.impulse,Y=this.massData[Mt];if(0<X.motorMaxImpulse){var Z=z.impulseM,I=Z+Y.massWithoutCfm*(-X.motorSpeed-this.relVels[Mt]),Vt=z.impulseM;I<-Vt?I=-Vt:I>Vt&&(I=Vt),z.impulseM=I;var L=I-Z;this.dTotalImpulses[Mt]=L;for(var w=0;w<v;){var Lt=w++,A=this.relVels;A[Lt]+=L*It[Mt][Lt]}}}for(var S=!1,Bt=0,kt=this.boundaryBuilder.numBoundaries;Bt<kt;){var j=Bt++,R=this.velBoundarySelector.indices[j];if(this.boundaryBuilder.boundaries[R].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var q=0;q<v;){var At=q++,J=this.info.rows[At].impulse,F=this.dImpulses[At];J.impulse+=F;var N=this.dTotalImpulses;N[At]+=F}var O=this.dTotalImpulses,_t=!1,Pt=!1,Tt,wt,St,Ct,qt,Rt,Et,jt,Nt,Ft,Dt,Wt;Tt=this._b1._velX,wt=this._b1._velY,St=this._b1._velZ,Ct=this._b2._velX,qt=this._b2._velY,Rt=this._b2._velZ,Et=this._b1._angVelX,jt=this._b1._angVelY,Nt=this._b1._angVelZ,Ft=this._b2._angVelX,Dt=this._b2._angVelY,Wt=this._b2._angVelZ;for(var Gt=0,Ot=this.info.numRows;Gt<Ot;){var lt=Gt++,ct=this.info.rows[lt].jacobian,mt=this.massData[lt],pt=O[lt];0!=(1&ct.flag)&&(Tt+=mt.invMLin1X*pt,wt+=mt.invMLin1Y*pt,St+=mt.invMLin1Z*pt,Ct+=mt.invMLin2X*-pt,qt+=mt.invMLin2Y*-pt,Rt+=mt.invMLin2Z*-pt,_t=!0),0!=(2&ct.flag)&&(Et+=mt.invMAng1X*pt,jt+=mt.invMAng1Y*pt,Nt+=mt.invMAng1Z*pt,Ft+=mt.invMAng2X*-pt,Dt+=mt.invMAng2Y*-pt,Wt+=mt.invMAng2Z*-pt,Pt=!0)}_t&&(this._b1._velX=Tt,this._b1._velY=wt,this._b1._velZ=St,this._b2._velX=Ct,this._b2._velY=qt,this._b2._velZ=Rt),Pt&&(this._b1._angVelX=Et,this._b1._angVelY=jt,this._b1._angVelZ=Nt,this._b2._angVelX=Ft,this._b2._angVelY=Dt,this._b2._angVelZ=Wt);for(var vt=this.velBoundarySelector,yt=0;vt.indices[yt]!=R;)++yt;for(;0<yt;){var Ht=vt.indices[yt];vt.indices[yt]=vt.indices[yt-1],vt.indices[yt-1]=Ht,--yt}S=!0;break}}S||console.log("DirectJointConstraintSolver.hx:338:","could not find solution. (velocity)")},postSolveVelocity:function(p){var t,b,x,d,y,f;t=0,b=0,x=0,d=0,y=0,f=0;for(var g=0,v=this.info.numRows;g<v;){var e=g++,X=this.info.rows[e],l=X.impulse,c=X.jacobian;0==(1&c.flag)?0!=(2&c.flag)&&(d+=c.ang1X*l.impulse,y+=c.ang1Y*l.impulse,f+=c.ang1Z*l.impulse):(t+=c.lin1X*l.impulse,b+=c.lin1Y*l.impulse,x+=c.lin1Z*l.impulse)}this.joint._appliedForceX=t*p.invDt,this.joint._appliedForceY=b*p.invDt,this.joint._appliedForceZ=x*p.invDt,this.joint._appliedTorqueX=d*p.invDt,this.joint._appliedTorqueY=y*p.invDt,this.joint._appliedTorqueZ=f*p.invDt},preSolvePosition:function(){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var o=this.posBoundarySelector,a=this.boundaryBuilder.numBoundaries,n=0,b=0,x=0,d=o.n;x<d;){var e=x++,y=o.indices[e];y<a?(o.tmpIndices[n]=y,++n):(o.tmpIndices[a+b]=y,++b)}var l=o.indices;o.indices=o.tmpIndices,o.tmpIndices=l;for(var c=0,f=this.info.numRows,p;c<f;)p=c++,this.info.rows[p].impulse.impulseP=0},solvePositionSplitImpulse:function(){var v=this.info.numRows,m,Z,tt,ot,at,it,nt,_t,et,rt,st,lt;m=this._b1._pseudoVelX,Z=this._b1._pseudoVelY,tt=this._b1._pseudoVelZ,ot=this._b2._pseudoVelX,at=this._b2._pseudoVelY,it=this._b2._pseudoVelZ,nt=this._b1._angPseudoVelX,_t=this._b1._angPseudoVelY,et=this._b1._angPseudoVelZ,rt=this._b2._angPseudoVelX,st=this._b2._angPseudoVelY,lt=this._b2._angPseudoVelZ;for(var ct=0;ct<v;){var pt=ct++,y=this.info.rows[pt],b=y.impulse,f=y.jacobian,d=0;d+=m*f.lin1X+Z*f.lin1Y+tt*f.lin1Z,d-=ot*f.lin2X+at*f.lin2Y+it*f.lin2Z,d+=nt*f.ang1X+_t*f.ang1Y+et*f.ang1Z,d-=rt*f.ang2X+st*f.ang2Y+lt*f.ang2Z,this.relVels[pt]=d,this.impulses[pt]=b.impulseP}for(var mt=!1,bt=0,xt=this.boundaryBuilder.numBoundaries;bt<xt;){var M=bt++,X=this.posBoundarySelector.indices[M];if(this.boundaryBuilder.boundaries[X].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,oimo_common_Setting.positionSplitImpulseBaumgarte,!1)){for(var z=0;z<v;){var dt=z++,I=this.info.rows[dt].impulse,V=this.dImpulses[dt];I.impulseP+=V}var L=this.dImpulses,D=!1,yt=!1,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt,ht,Vt;ft=this._b1._pseudoVelX,gt=this._b1._pseudoVelY,vt=this._b1._pseudoVelZ,Xt=this._b2._pseudoVelX,ut=this._b2._pseudoVelY,zt=this._b2._pseudoVelZ,Yt=this._b1._angPseudoVelX,Zt=this._b1._angPseudoVelY,It=this._b1._angPseudoVelZ,Mt=this._b2._angPseudoVelX,ht=this._b2._angPseudoVelY,Vt=this._b2._angPseudoVelZ;for(var Lt=0,Bt=this.info.numRows;Lt<Bt;){var G=Lt++,O=this.info.rows[G].jacobian,W=this.massData[G],U=L[G];0!=(1&O.flag)&&(ft+=W.invMLin1X*U,gt+=W.invMLin1Y*U,vt+=W.invMLin1Z*U,Xt+=W.invMLin2X*-U,ut+=W.invMLin2Y*-U,zt+=W.invMLin2Z*-U,D=!0),0!=(2&O.flag)&&(Yt+=W.invMAng1X*U,Zt+=W.invMAng1Y*U,It+=W.invMAng1Z*U,Mt+=W.invMAng2X*-U,ht+=W.invMAng2Y*-U,Vt+=W.invMAng2Z*-U,yt=!0)}D&&(this._b1._pseudoVelX=ft,this._b1._pseudoVelY=gt,this._b1._pseudoVelZ=vt,this._b2._pseudoVelX=Xt,this._b2._pseudoVelY=ut,this._b2._pseudoVelZ=zt),yt&&(this._b1._angPseudoVelX=Yt,this._b1._angPseudoVelY=Zt,this._b1._angPseudoVelZ=It,this._b2._angPseudoVelX=Mt,this._b2._angPseudoVelY=ht,this._b2._angPseudoVelZ=Vt);for(var H=this.posBoundarySelector,Q=0;H.indices[Q]!=X;)++Q;for(;0<Q;){var kt=H.indices[Q];H.indices[Q]=H.indices[Q-1],H.indices[Q-1]=kt,--Q}mt=!0;break}}mt||console.log("DirectJointConstraintSolver.hx:454:","could not find solution. (split impulse)")},solvePositionNgs:function(){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var o=this.posBoundarySelector,a=this.boundaryBuilder.numBoundaries,n=0,v=0,z=0,to=o.n;z<to;){var e=z++,h=o.indices[e];h<a?(o.tmpIndices[n]=h,++n):(o.tmpIndices[a+v]=h,++v)}var l=o.indices;o.indices=o.tmpIndices,o.tmpIndices=l;for(var c=this.info.numRows,m=0;m<c;){var oo=m++,y=this.info.rows[oo],b=y.impulse;y.jacobian,this.relVels[oo]=0,this.impulses[oo]=b.impulseP}for(var f=!1,ao=0,io=this.boundaryBuilder.numBoundaries;ao<io;){var u=ao++,g=this.posBoundarySelector.indices[u];if(this.boundaryBuilder.boundaries[g].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,oimo_common_Setting.positionNgsBaumgarte,!1)){for(var M=0;M<c;){var no=M++,Y=this.info.rows[no].impulse,Z=this.dImpulses[no];Y.impulseP+=Z}var I=this.dImpulses,q=!1,_o=!1,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo,go;eo=0,ro=0,so=0,lo=0,co=0,po=0,mo=0,bo=0,xo=0,yo=0,fo=0,go=0;for(var vo=0,Xo=this.info.numRows;vo<Xo;){var F=vo++,N=this.info.rows[F].jacobian,G=this.massData[F],O=I[F];0!=(1&N.flag)&&(eo+=G.invMLin1X*O,ro+=G.invMLin1Y*O,so+=G.invMLin1Z*O,lo+=G.invMLin2X*-O,co+=G.invMLin2Y*-O,po+=G.invMLin2Z*-O,q=!0),0!=(2&N.flag)&&(mo+=G.invMAng1X*O,bo+=G.invMAng1Y*O,xo+=G.invMAng1Z*O,yo+=G.invMAng2X*-O,fo+=G.invMAng2Y*-O,go+=G.invMAng2Z*-O,_o=!0)}if(q){var W=this._b1;W._transform._positionX+=eo,W._transform._positionY+=ro,W._transform._positionZ+=so;var U=this._b2;U._transform._positionX+=lo,U._transform._positionY+=co,U._transform._positionZ+=po}if(_o){var H=this._b1,rt=Math.sqrt(mo*mo+bo*bo+xo*xo),et=.5*rt,ht,uo,zo,Yo,Zo,Io,Mo,ho,Vo,Lo;if(.5>et){var Bo=et*et;ht=.5*(1-.16666666666666666*Bo+.008333333333333333*(Bo*Bo)),uo=1-.5*Bo+.041666666666666664*(Bo*Bo)}else ht=Math.sin(et)/rt,uo=Math.cos(et);zo=mo*ht,Yo=bo*ht,Zo=xo*ht,Io=uo;var lt=H._transform._rotation00,mt=H._transform._rotation11,pt=H._transform._rotation22,vt=lt+mt+pt,yt;0<vt?(Lo=.5*(yt=Math.sqrt(vt+1)),yt=.5/yt,Mo=(H._transform._rotation21-H._transform._rotation12)*yt,ho=(H._transform._rotation02-H._transform._rotation20)*yt,Vo=(H._transform._rotation10-H._transform._rotation01)*yt):lt>mt?lt>pt?(Mo=.5*(yt=Math.sqrt(lt-mt-pt+1)),yt=.5/yt,ho=(H._transform._rotation01+H._transform._rotation10)*yt,Vo=(H._transform._rotation02+H._transform._rotation20)*yt,Lo=(H._transform._rotation21-H._transform._rotation12)*yt):(Vo=.5*(yt=Math.sqrt(pt-lt-mt+1)),yt=.5/yt,Mo=(H._transform._rotation02+H._transform._rotation20)*yt,ho=(H._transform._rotation12+H._transform._rotation21)*yt,Lo=(H._transform._rotation10-H._transform._rotation01)*yt):mt>pt?(ho=.5*(yt=Math.sqrt(mt-pt-lt+1)),yt=.5/yt,Mo=(H._transform._rotation01+H._transform._rotation10)*yt,Vo=(H._transform._rotation12+H._transform._rotation21)*yt,Lo=(H._transform._rotation02-H._transform._rotation20)*yt):(Vo=.5*(yt=Math.sqrt(pt-lt-mt+1)),yt=.5/yt,Mo=(H._transform._rotation02+H._transform._rotation20)*yt,ho=(H._transform._rotation12+H._transform._rotation21)*yt,Lo=(H._transform._rotation10-H._transform._rotation01)*yt);var ko=(Mo=Io*Mo+zo*Lo+Yo*Vo-Zo*ho)*Mo+(ho=Io*ho-zo*Vo+Yo*Lo+Zo*Mo)*ho+(Vo=Io*Vo+zo*ho-Yo*Mo+Zo*Lo)*Vo+(Lo=Io*Lo-zo*Mo-Yo*ho-Zo*Vo)*Lo;1e-32<ko&&(ko=1/Math.sqrt(ko)),Mo*=ko,ho*=ko,Vo*=ko,Lo*=ko;var Ao=2*Mo,St=2*ho,Ct=2*Vo,Tt=Mo*Ao,jt=ho*St,Rt=Vo*Ct,qt=Mo*St,Et=ho*Ct,Dt=Mo*Ct,Jt=Lo*Ao,Ft=Lo*St,Nt=Lo*Ct,Gt,Po,To,wo,So,Co,qo,Ro,Eo,jo,No,Fo,Do,Wo,Go,Oo,Ho,Jo;H._transform._rotation00=1-jt-Rt,H._transform._rotation01=qt-Nt,H._transform._rotation02=Dt+Ft,H._transform._rotation10=qt+Nt,H._transform._rotation11=1-Tt-Rt,H._transform._rotation12=Et-Jt,H._transform._rotation20=Dt-Ft,H._transform._rotation21=Et+Jt,H._transform._rotation22=1-Tt-jt,Gt=H._transform._rotation00*H._invLocalInertia00+H._transform._rotation01*H._invLocalInertia10+H._transform._rotation02*H._invLocalInertia20,Po=H._transform._rotation00*H._invLocalInertia01+H._transform._rotation01*H._invLocalInertia11+H._transform._rotation02*H._invLocalInertia21,To=H._transform._rotation00*H._invLocalInertia02+H._transform._rotation01*H._invLocalInertia12+H._transform._rotation02*H._invLocalInertia22,wo=H._transform._rotation10*H._invLocalInertia00+H._transform._rotation11*H._invLocalInertia10+H._transform._rotation12*H._invLocalInertia20,So=H._transform._rotation10*H._invLocalInertia01+H._transform._rotation11*H._invLocalInertia11+H._transform._rotation12*H._invLocalInertia21,Co=H._transform._rotation10*H._invLocalInertia02+H._transform._rotation11*H._invLocalInertia12+H._transform._rotation12*H._invLocalInertia22,qo=H._transform._rotation20*H._invLocalInertia00+H._transform._rotation21*H._invLocalInertia10+H._transform._rotation22*H._invLocalInertia20,Ro=H._transform._rotation20*H._invLocalInertia01+H._transform._rotation21*H._invLocalInertia11+H._transform._rotation22*H._invLocalInertia21,Eo=H._transform._rotation20*H._invLocalInertia02+H._transform._rotation21*H._invLocalInertia12+H._transform._rotation22*H._invLocalInertia22,H._invInertia00=Gt,H._invInertia01=Po,H._invInertia02=To,H._invInertia10=wo,H._invInertia11=So,H._invInertia12=Co,H._invInertia20=qo,H._invInertia21=Ro,H._invInertia22=Eo,jo=H._invInertia00*H._transform._rotation00+H._invInertia01*H._transform._rotation01+H._invInertia02*H._transform._rotation02,No=H._invInertia00*H._transform._rotation10+H._invInertia01*H._transform._rotation11+H._invInertia02*H._transform._rotation12,Fo=H._invInertia00*H._transform._rotation20+H._invInertia01*H._transform._rotation21+H._invInertia02*H._transform._rotation22,Do=H._invInertia10*H._transform._rotation00+H._invInertia11*H._transform._rotation01+H._invInertia12*H._transform._rotation02,Wo=H._invInertia10*H._transform._rotation10+H._invInertia11*H._transform._rotation11+H._invInertia12*H._transform._rotation12,Go=H._invInertia10*H._transform._rotation20+H._invInertia11*H._transform._rotation21+H._invInertia12*H._transform._rotation22,Oo=H._invInertia20*H._transform._rotation00+H._invInertia21*H._transform._rotation01+H._invInertia22*H._transform._rotation02,Ho=H._invInertia20*H._transform._rotation10+H._invInertia21*H._transform._rotation11+H._invInertia22*H._transform._rotation12,Jo=H._invInertia20*H._transform._rotation20+H._invInertia21*H._transform._rotation21+H._invInertia22*H._transform._rotation22,H._invInertia00=jo,H._invInertia01=No,H._invInertia02=Fo,H._invInertia10=Do,H._invInertia11=Wo,H._invInertia12=Go,H._invInertia20=Oo,H._invInertia21=Ho,H._invInertia22=Jo,H._invInertia00*=H._rotFactor.x,H._invInertia01*=H._rotFactor.x,H._invInertia02*=H._rotFactor.x,H._invInertia10*=H._rotFactor.y,H._invInertia11*=H._rotFactor.y,H._invInertia12*=H._rotFactor.y,H._invInertia20*=H._rotFactor.z,H._invInertia21*=H._rotFactor.z,H._invInertia22*=H._rotFactor.z;var Uo=this._b2,Qo=Math.sqrt(yo*yo+fo*fo+go*go),Ko=.5*Qo,$o,ta,oa,aa,ia,na,_a,ea,ra,sa;if(.5>Ko){var la=Ko*Ko;$o=.5*(1-.16666666666666666*la+.008333333333333333*(la*la)),ta=1-.5*la+.041666666666666664*(la*la)}else $o=Math.sin(Ko)/Qo,ta=Math.cos(Ko);oa=yo*$o,aa=fo*$o,ia=go*$o,na=ta;var ca=Uo._transform._rotation00,pa=Uo._transform._rotation11,ma=Uo._transform._rotation22,ba=ca+pa+ma,xa;0<ba?(sa=.5*(xa=Math.sqrt(ba+1)),xa=.5/xa,_a=(Uo._transform._rotation21-Uo._transform._rotation12)*xa,ea=(Uo._transform._rotation02-Uo._transform._rotation20)*xa,ra=(Uo._transform._rotation10-Uo._transform._rotation01)*xa):ca>pa?ca>ma?(_a=.5*(xa=Math.sqrt(ca-pa-ma+1)),xa=.5/xa,ea=(Uo._transform._rotation01+Uo._transform._rotation10)*xa,ra=(Uo._transform._rotation02+Uo._transform._rotation20)*xa,sa=(Uo._transform._rotation21-Uo._transform._rotation12)*xa):(ra=.5*(xa=Math.sqrt(ma-ca-pa+1)),xa=.5/xa,_a=(Uo._transform._rotation02+Uo._transform._rotation20)*xa,ea=(Uo._transform._rotation12+Uo._transform._rotation21)*xa,sa=(Uo._transform._rotation10-Uo._transform._rotation01)*xa):pa>ma?(ea=.5*(xa=Math.sqrt(pa-ma-ca+1)),xa=.5/xa,_a=(Uo._transform._rotation01+Uo._transform._rotation10)*xa,ra=(Uo._transform._rotation12+Uo._transform._rotation21)*xa,sa=(Uo._transform._rotation02-Uo._transform._rotation20)*xa):(ra=.5*(xa=Math.sqrt(ma-ca-pa+1)),xa=.5/xa,_a=(Uo._transform._rotation02+Uo._transform._rotation20)*xa,ea=(Uo._transform._rotation12+Uo._transform._rotation21)*xa,sa=(Uo._transform._rotation10-Uo._transform._rotation01)*xa);var da=(_a=na*_a+oa*sa+aa*ra-ia*ea)*_a+(ea=na*ea-oa*ra+aa*sa+ia*_a)*ea+(ra=na*ra+oa*ea-aa*_a+ia*sa)*ra+(sa=na*sa-oa*_a-aa*ea-ia*ra)*sa;1e-32<da&&(da=1/Math.sqrt(da)),_a*=da,ea*=da,ra*=da,sa*=da;var ya=2*_a,fa=2*ea,ga=2*ra,va=_a*ya,Xa=ea*fa,ua=ra*ga,za=_a*fa,Ya=ea*ga,Za=_a*ga,Ia=sa*ya,Ma=sa*fa,ha=sa*ga,Va,La,Ba,ka,Aa,Pa,Ta,wa,Sa,Ca,qa,Ra,Ea,ja,Na,Fa,Da,Wa;Uo._transform._rotation00=1-Xa-ua,Uo._transform._rotation01=za-ha,Uo._transform._rotation02=Za+Ma,Uo._transform._rotation10=za+ha,Uo._transform._rotation11=1-va-ua,Uo._transform._rotation12=Ya-Ia,Uo._transform._rotation20=Za-Ma,Uo._transform._rotation21=Ya+Ia,Uo._transform._rotation22=1-va-Xa,Va=Uo._transform._rotation00*Uo._invLocalInertia00+Uo._transform._rotation01*Uo._invLocalInertia10+Uo._transform._rotation02*Uo._invLocalInertia20,La=Uo._transform._rotation00*Uo._invLocalInertia01+Uo._transform._rotation01*Uo._invLocalInertia11+Uo._transform._rotation02*Uo._invLocalInertia21,Ba=Uo._transform._rotation00*Uo._invLocalInertia02+Uo._transform._rotation01*Uo._invLocalInertia12+Uo._transform._rotation02*Uo._invLocalInertia22,ka=Uo._transform._rotation10*Uo._invLocalInertia00+Uo._transform._rotation11*Uo._invLocalInertia10+Uo._transform._rotation12*Uo._invLocalInertia20,Aa=Uo._transform._rotation10*Uo._invLocalInertia01+Uo._transform._rotation11*Uo._invLocalInertia11+Uo._transform._rotation12*Uo._invLocalInertia21,Pa=Uo._transform._rotation10*Uo._invLocalInertia02+Uo._transform._rotation11*Uo._invLocalInertia12+Uo._transform._rotation12*Uo._invLocalInertia22,Ta=Uo._transform._rotation20*Uo._invLocalInertia00+Uo._transform._rotation21*Uo._invLocalInertia10+Uo._transform._rotation22*Uo._invLocalInertia20,wa=Uo._transform._rotation20*Uo._invLocalInertia01+Uo._transform._rotation21*Uo._invLocalInertia11+Uo._transform._rotation22*Uo._invLocalInertia21,Sa=Uo._transform._rotation20*Uo._invLocalInertia02+Uo._transform._rotation21*Uo._invLocalInertia12+Uo._transform._rotation22*Uo._invLocalInertia22,Uo._invInertia00=Va,Uo._invInertia01=La,Uo._invInertia02=Ba,Uo._invInertia10=ka,Uo._invInertia11=Aa,Uo._invInertia12=Pa,Uo._invInertia20=Ta,Uo._invInertia21=wa,Uo._invInertia22=Sa,Ca=Uo._invInertia00*Uo._transform._rotation00+Uo._invInertia01*Uo._transform._rotation01+Uo._invInertia02*Uo._transform._rotation02,qa=Uo._invInertia00*Uo._transform._rotation10+Uo._invInertia01*Uo._transform._rotation11+Uo._invInertia02*Uo._transform._rotation12,Ra=Uo._invInertia00*Uo._transform._rotation20+Uo._invInertia01*Uo._transform._rotation21+Uo._invInertia02*Uo._transform._rotation22,Ea=Uo._invInertia10*Uo._transform._rotation00+Uo._invInertia11*Uo._transform._rotation01+Uo._invInertia12*Uo._transform._rotation02,ja=Uo._invInertia10*Uo._transform._rotation10+Uo._invInertia11*Uo._transform._rotation11+Uo._invInertia12*Uo._transform._rotation12,Na=Uo._invInertia10*Uo._transform._rotation20+Uo._invInertia11*Uo._transform._rotation21+Uo._invInertia12*Uo._transform._rotation22,Fa=Uo._invInertia20*Uo._transform._rotation00+Uo._invInertia21*Uo._transform._rotation01+Uo._invInertia22*Uo._transform._rotation02,Da=Uo._invInertia20*Uo._transform._rotation10+Uo._invInertia21*Uo._transform._rotation11+Uo._invInertia22*Uo._transform._rotation12,Wa=Uo._invInertia20*Uo._transform._rotation20+Uo._invInertia21*Uo._transform._rotation21+Uo._invInertia22*Uo._transform._rotation22,Uo._invInertia00=Ca,Uo._invInertia01=qa,Uo._invInertia02=Ra,Uo._invInertia10=Ea,Uo._invInertia11=ja,Uo._invInertia12=Na,Uo._invInertia20=Fa,Uo._invInertia21=Da,Uo._invInertia22=Wa,Uo._invInertia00*=Uo._rotFactor.x,Uo._invInertia01*=Uo._rotFactor.x,Uo._invInertia02*=Uo._rotFactor.x,Uo._invInertia10*=Uo._rotFactor.y,Uo._invInertia11*=Uo._rotFactor.y,Uo._invInertia12*=Uo._rotFactor.y,Uo._invInertia20*=Uo._rotFactor.z,Uo._invInertia21*=Uo._rotFactor.z,Uo._invInertia22*=Uo._rotFactor.z}for(var Ga=this.posBoundarySelector,Oa=0;Ga.indices[Oa]!=g;)++Oa;for(;0<Oa;){var Ha=Ga.indices[Oa];Ga.indices[Oa]=Ga.indices[Oa-1],Ga.indices[Oa-1]=Ha,--Oa}f=!0;break}}f||console.log("DirectJointConstraintSolver.hx:506:","could not find solution. (NGS)")},postSolve:function(){this.joint._syncAnchors(),this.joint._checkDestruction()}});var oimo_dynamics_constraint_solver_direct_MassMatrix=function(A){this._size=A;var t=this._size,i=Array(t);this.tmpMatrix=i;var o=this._size,a=Array(o);this._invMass=a;var n=this._size,s=Array(n);this._invMassWithoutCfm=s;for(var _=0,T=this._size;_<T;){var e=_++,h=this.tmpMatrix,l=this._size,c=Array(l);h[e]=c;var m=this._invMass,p=this._size,v=Array(p);m[e]=v;var y=this._invMassWithoutCfm,b=this._size,f=Array(b);y[e]=f;for(var d=0,q=this._size,u;d<q;)u=d++,this.tmpMatrix[e][u]=0,this._invMass[e][u]=0,this._invMassWithoutCfm[e][u]=0}this._maxSubmatrixId=1<<this._size;var R=this._maxSubmatrixId,M=Array(R);this._cacheComputed=M;var X=this._maxSubmatrixId,z=Array(X);this._cachedSubmatrices=z;for(var Y=0,E=this._maxSubmatrixId;Y<E;){for(var I=Y++,V=I,N=V=(15&(V=(51&(V=(85&V)+(85&V>>1)))+(51&V>>2)))+(15&V>>4),w=Array(N),B=0;B<N;){var F=B++,P=Array(N);w[F]=P;for(var S=0,D;S<N;)D=S++,w[F][D]=0}this._cacheComputed[I]=!1,this._cachedSubmatrices[I]=w}};oimo_dynamics_constraint_solver_direct_MassMatrix.prototype={computeSubmatrix:function(n,t,i){for(var o=0;o<i;)for(var e=o++,s=t[e],_=0,d;_<i;)d=_++,this.tmpMatrix[e][d]=this._invMass[s][t[d]];var Y=this.tmpMatrix,y=this._cachedSubmatrices[n],b,P,T,G,J;switch(i){case 4:b=Y[0],P=y[0],J=1/b[0],P[0]=J,b[1]*=J,b[2]*=J,b[3]*=J,T=Y[1],(G=y[1])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T=Y[2],(G=y[2])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T=Y[3],(G=y[3])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],b=Y[1],P=y[1],J=1/b[1],P[1]=J,P[0]*=J,b[2]*=J,b[3]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],b=Y[2],P=y[2],J=1/b[2],P[2]=J,P[0]*=J,P[1]*=J,b[3]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[2],T[3]-=b[3]*T[2],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],T[3]-=b[3]*T[2],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],G[2]=-J*T[2],T[3]-=b[3]*T[2],b=Y[3],P=y[3],J=1/b[3],P[3]=J,P[0]*=J,P[1]*=J,P[2]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[3],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],G[2]-=P[2]*T[3],P=y[1],y[0][1]=P[0],P=y[2],y[0][2]=P[0],y[1][2]=P[1],P=y[3],y[0][3]=P[0],y[1][3]=P[1],y[2][3]=P[2];break;case 5:b=Y[0],P=y[0],J=1/b[0],P[0]=J,b[1]*=J,b[2]*=J,b[3]*=J,b[4]*=J,T=Y[1],(G=y[1])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T=Y[2],(G=y[2])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T=Y[3],(G=y[3])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T=Y[4],(G=y[4])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],b=Y[1],P=y[1],J=1/b[1],P[1]=J,P[0]*=J,b[2]*=J,b[3]*=J,b[4]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T=Y[4],(G=y[4])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],b=Y[2],P=y[2],J=1/b[2],P[2]=J,P[0]*=J,P[1]*=J,b[3]*=J,b[4]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],G[2]=-J*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T=Y[4],(G=y[4])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],G[2]=-J*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],b=Y[3],P=y[3],J=1/b[3],P[3]=J,P[0]*=J,P[1]*=J,P[2]*=J,b[4]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[3],T[4]-=b[4]*T[3],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],T[4]-=b[4]*T[3],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],G[2]-=P[2]*T[3],T[4]-=b[4]*T[3],T=Y[4],(G=y[4])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],G[2]-=P[2]*T[3],G[3]=-J*T[3],T[4]-=b[4]*T[3],b=Y[4],P=y[4],J=1/b[4],P[4]=J,P[0]*=J,P[1]*=J,P[2]*=J,P[3]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[4],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[4],G[1]-=P[1]*T[4],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[4],G[1]-=P[1]*T[4],G[2]-=P[2]*T[4],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[4],G[1]-=P[1]*T[4],G[2]-=P[2]*T[4],G[3]-=P[3]*T[4],P=y[1],y[0][1]=P[0],P=y[2],y[0][2]=P[0],y[1][2]=P[1],P=y[3],y[0][3]=P[0],y[1][3]=P[1],y[2][3]=P[2],P=y[4],y[0][4]=P[0],y[1][4]=P[1],y[2][4]=P[2],y[3][4]=P[3];break;case 6:b=Y[0],P=y[0],J=1/b[0],P[0]=J,b[1]*=J,b[2]*=J,b[3]*=J,b[4]*=J,b[5]*=J,T=Y[1],(G=y[1])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T[5]-=b[5]*T[0],T=Y[2],(G=y[2])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T[5]-=b[5]*T[0],T=Y[3],(G=y[3])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T[5]-=b[5]*T[0],T=Y[4],(G=y[4])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T[5]-=b[5]*T[0],T=Y[5],(G=y[5])[0]=-J*T[0],T[1]-=b[1]*T[0],T[2]-=b[2]*T[0],T[3]-=b[3]*T[0],T[4]-=b[4]*T[0],T[5]-=b[5]*T[0],b=Y[1],P=y[1],J=1/b[1],P[1]=J,P[0]*=J,b[2]*=J,b[3]*=J,b[4]*=J,b[5]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T[5]-=b[5]*T[1],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T[5]-=b[5]*T[1],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T[5]-=b[5]*T[1],T=Y[4],(G=y[4])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T[5]-=b[5]*T[1],T=Y[5],(G=y[5])[0]=G[0]-P[0]*T[1],G[1]=-J*T[1],T[2]-=b[2]*T[1],T[3]-=b[3]*T[1],T[4]-=b[4]*T[1],T[5]-=b[5]*T[1],b=Y[2],P=y[2],J=1/b[2],P[2]=J,P[0]*=J,P[1]*=J,b[3]*=J,b[4]*=J,b[5]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T[5]-=b[5]*T[2],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T[5]-=b[5]*T[2],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],G[2]=-J*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T[5]-=b[5]*T[2],T=Y[4],(G=y[4])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],G[2]=-J*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T[5]-=b[5]*T[2],T=Y[5],(G=y[5])[0]=G[0]-P[0]*T[2],G[1]-=P[1]*T[2],G[2]=-J*T[2],T[3]-=b[3]*T[2],T[4]-=b[4]*T[2],T[5]-=b[5]*T[2],b=Y[3],P=y[3],J=1/b[3],P[3]=J,P[0]*=J,P[1]*=J,P[2]*=J,b[4]*=J,b[5]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[3],T[4]-=b[4]*T[3],T[5]-=b[5]*T[3],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],T[4]-=b[4]*T[3],T[5]-=b[5]*T[3],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],G[2]-=P[2]*T[3],T[4]-=b[4]*T[3],T[5]-=b[5]*T[3],T=Y[4],(G=y[4])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],G[2]-=P[2]*T[3],G[3]=-J*T[3],T[4]-=b[4]*T[3],T[5]-=b[5]*T[3],T=Y[5],(G=y[5])[0]=G[0]-P[0]*T[3],G[1]-=P[1]*T[3],G[2]-=P[2]*T[3],G[3]=-J*T[3],T[4]-=b[4]*T[3],T[5]-=b[5]*T[3],b=Y[4],P=y[4],J=1/b[4],P[4]=J,P[0]*=J,P[1]*=J,P[2]*=J,P[3]*=J,b[5]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[4],T[5]-=b[5]*T[4],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[4],G[1]-=P[1]*T[4],T[5]-=b[5]*T[4],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[4],G[1]-=P[1]*T[4],G[2]-=P[2]*T[4],T[5]-=b[5]*T[4],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[4],G[1]-=P[1]*T[4],G[2]-=P[2]*T[4],G[3]-=P[3]*T[4],T[5]-=b[5]*T[4],T=Y[5],(G=y[5])[0]=G[0]-P[0]*T[4],G[1]-=P[1]*T[4],G[2]-=P[2]*T[4],G[3]-=P[3]*T[4],G[4]=-J*T[4],T[5]-=b[5]*T[4],b=Y[5],P=y[5],J=1/b[5],P[5]=J,P[0]*=J,P[1]*=J,P[2]*=J,P[3]*=J,P[4]*=J,T=Y[0],(G=y[0])[0]=G[0]-P[0]*T[5],T=Y[1],(G=y[1])[0]=G[0]-P[0]*T[5],G[1]-=P[1]*T[5],T=Y[2],(G=y[2])[0]=G[0]-P[0]*T[5],G[1]-=P[1]*T[5],G[2]-=P[2]*T[5],T=Y[3],(G=y[3])[0]=G[0]-P[0]*T[5],G[1]-=P[1]*T[5],G[2]-=P[2]*T[5],G[3]-=P[3]*T[5],T=Y[4],(G=y[4])[0]=G[0]-P[0]*T[5],G[1]-=P[1]*T[5],G[2]-=P[2]*T[5],G[3]-=P[3]*T[5],G[4]-=P[4]*T[5],P=y[1],y[0][1]=P[0],P=y[2],y[0][2]=P[0],y[1][2]=P[1],P=y[3],y[0][3]=P[0],y[1][3]=P[1],y[2][3]=P[2],P=y[4],y[0][4]=P[0],y[1][4]=P[1],y[2][4]=P[2],y[3][4]=P[3],P=y[5],y[0][5]=P[0],y[1][5]=P[1],y[2][5]=P[2],y[3][5]=P[3],y[4][5]=P[4];break;default:for(var Q=0,K;Q<i;){K=Q++,b=Y[K],P=y[K];var $=1/b[K];P[K]=$;for(var u=0,tt=K,M;u<tt;)M=u++,P[M]*=$;for(var ot=K+1,at;ot<i;)at=ot++,b[at]*=$;for(var it=0,nt=K,V;it<nt;){V=it++,T=Y[V],G=y[V];for(var _t=0,et=V+1,B;_t<et;)B=_t++,G[B]-=P[B]*T[K];for(var rt=K+1,st;rt<i;)st=rt++,T[st]-=b[st]*T[K]}for(var lt=K+1,ct;lt<i;){ct=lt++,T=Y[ct],G=y[ct];for(var pt=0,mt=K,q;pt<mt;)q=pt++,G[q]-=P[q]*T[K];G[K]=-$*T[K];for(var bt=K+1,xt;bt<i;)xt=bt++,T[xt]-=b[xt]*T[K]}}for(var dt=1,yt;dt<i;){yt=dt++,P=y[yt];for(var ft=0,gt=yt,U;ft<gt;)U=ft++,y[U][yt]=P[U]}}},computeInvMass:function(V,t){var i=this._invMass,u=this._invMassWithoutCfm,g=V.numRows,M=V.b1,X=V.b2,z=M._invMass,Y=X._invMass,Z,R,H,J,Q,K,$,tt,ot,at,it,nt,_t,et,rt,st,lt,ct;Z=M._invInertia00,R=M._invInertia01,H=M._invInertia02,J=M._invInertia10,Q=M._invInertia11,K=M._invInertia12,$=M._invInertia20,tt=M._invInertia21,ot=M._invInertia22,at=X._invInertia00,it=X._invInertia01,nt=X._invInertia02,_t=X._invInertia10,et=X._invInertia11,rt=X._invInertia12,st=X._invInertia20,lt=X._invInertia21,ct=X._invInertia22;for(var pt=0;pt<g;){var mt=pt++,S=V.rows[mt].jacobian,C=t[mt],T,bt,xt,dt,yt,ft;(S.updateSparsity(),0==(1&S.flag)?(C.invMLin1X=0,C.invMLin1Y=0,C.invMLin1Z=0,C.invMLin2X=0,C.invMLin2Y=0,C.invMLin2Z=0):(C.invMLin1X=S.lin1X*z,C.invMLin1Y=S.lin1Y*z,C.invMLin1Z=S.lin1Z*z,C.invMLin2X=S.lin2X*Y,C.invMLin2Y=S.lin2Y*Y,C.invMLin2Z=S.lin2Z*Y),0!=(2&S.flag))?(T=Z*S.ang1X+R*S.ang1Y+H*S.ang1Z,bt=J*S.ang1X+Q*S.ang1Y+K*S.ang1Z,xt=$*S.ang1X+tt*S.ang1Y+ot*S.ang1Z,C.invMAng1X=T,C.invMAng1Y=bt,C.invMAng1Z=xt,dt=at*S.ang2X+it*S.ang2Y+nt*S.ang2Z,yt=_t*S.ang2X+et*S.ang2Y+rt*S.ang2Z,ft=st*S.ang2X+lt*S.ang2Y+ct*S.ang2Z,C.invMAng2X=dt,C.invMAng2Y=yt,C.invMAng2Z=ft):(C.invMAng1X=0,C.invMAng1Y=0,C.invMAng1Z=0,C.invMAng2X=0,C.invMAng2Y=0,C.invMAng2Z=0)}for(var gt=0;gt<g;)for(var vt=gt++,q=V.rows[vt].jacobian,E=vt;E<g;){var Xt=E++,F=(V.rows[Xt].jacobian,t[Xt]),N=q.lin1X*F.invMLin1X+q.lin1Y*F.invMLin1Y+q.lin1Z*F.invMLin1Z+(q.ang1X*F.invMAng1X+q.ang1Y*F.invMAng1Y+q.ang1Z*F.invMAng1Z)+(q.lin2X*F.invMLin2X+q.lin2Y*F.invMLin2Y+q.lin2Z*F.invMLin2Z)+(q.ang2X*F.invMAng2X+q.ang2Y*F.invMAng2Y+q.ang2Z*F.invMAng2Z);vt==Xt?(i[vt][Xt]=N+V.rows[vt].cfm,u[vt][Xt]=N,F.mass=N+V.rows[vt].cfm,F.massWithoutCfm=N,0!=F.mass&&(F.mass=1/F.mass),0!=F.massWithoutCfm&&(F.massWithoutCfm=1/F.massWithoutCfm)):(i[vt][Xt]=N,i[Xt][vt]=N,u[vt][Xt]=N,u[Xt][vt]=N)}for(var G=0,ut=this._maxSubmatrixId,W;G<ut;)W=G++,this._cacheComputed[W]=!1}};var oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver=function(_){oimo_dynamics_constraint_ConstraintSolver.call(this),this.constraint=_,this.info=new oimo_dynamics_constraint_info_contact_ContactSolverInfo;var t=oimo_common_Setting.maxManifoldPoints,i=Array(t);this.massData=i;for(var o=0,e=this.massData.length,n;o<e;)n=o++,this.massData[n]=new oimo_dynamics_constraint_solver_common_ContactSolverMassDataRow};oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.__super__=oimo_dynamics_constraint_ConstraintSolver,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype=$extend(oimo_dynamics_constraint_ConstraintSolver.prototype,{preSolveVelocity:function(K){this.constraint._getVelocitySolverInfo(K,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,x=this._b2._invMass,u,$,tt,ot,at,it,nt,_t,et,rt,st,lt,ct,pt,mt,bt,xt,dt;u=this._b1._invInertia00,$=this._b1._invInertia01,tt=this._b1._invInertia02,ot=this._b1._invInertia10,at=this._b1._invInertia11,it=this._b1._invInertia12,nt=this._b1._invInertia20,_t=this._b1._invInertia21,et=this._b1._invInertia22,rt=this._b2._invInertia00,st=this._b2._invInertia01,lt=this._b2._invInertia02,ct=this._b2._invInertia10,pt=this._b2._invInertia11,mt=this._b2._invInertia12,bt=this._b2._invInertia20,xt=this._b2._invInertia21,dt=this._b2._invInertia22;for(var yt=0,ft=this.info.numRows;yt<ft;){var M=yt++,L=this.info.rows[M],w=this.massData[M],B=L.jacobianN,k,gt,vt,Xt,ut,zt;w.invMLinN1X=B.lin1X*t,w.invMLinN1Y=B.lin1Y*t,w.invMLinN1Z=B.lin1Z*t,w.invMLinN2X=B.lin2X*x,w.invMLinN2Y=B.lin2Y*x,w.invMLinN2Z=B.lin2Z*x,k=u*B.ang1X+$*B.ang1Y+tt*B.ang1Z,gt=ot*B.ang1X+at*B.ang1Y+it*B.ang1Z,vt=nt*B.ang1X+_t*B.ang1Y+et*B.ang1Z,w.invMAngN1X=k,w.invMAngN1Y=gt,w.invMAngN1Z=vt,Xt=rt*B.ang2X+st*B.ang2Y+lt*B.ang2Z,ut=ct*B.ang2X+pt*B.ang2Y+mt*B.ang2Z,zt=bt*B.ang2X+xt*B.ang2Y+dt*B.ang2Z,w.invMAngN2X=Xt,w.invMAngN2Y=ut,w.invMAngN2Z=zt,w.massN=t+x+(w.invMAngN1X*B.ang1X+w.invMAngN1Y*B.ang1Y+w.invMAngN1Z*B.ang1Z)+(w.invMAngN2X*B.ang2X+w.invMAngN2Y*B.ang2Y+w.invMAngN2Z*B.ang2Z),0!=w.massN&&(w.massN=1/w.massN);var Yt=L.jacobianT,N=L.jacobianB,G,Zt,It,Mt,ht,Vt,Lt,Bt,kt,At,Pt,Tt;w.invMLinT1X=Yt.lin1X*t,w.invMLinT1Y=Yt.lin1Y*t,w.invMLinT1Z=Yt.lin1Z*t,w.invMLinT2X=Yt.lin2X*x,w.invMLinT2Y=Yt.lin2Y*x,w.invMLinT2Z=Yt.lin2Z*x,w.invMLinB1X=N.lin1X*t,w.invMLinB1Y=N.lin1Y*t,w.invMLinB1Z=N.lin1Z*t,w.invMLinB2X=N.lin2X*x,w.invMLinB2Y=N.lin2Y*x,w.invMLinB2Z=N.lin2Z*x,G=u*Yt.ang1X+$*Yt.ang1Y+tt*Yt.ang1Z,Zt=ot*Yt.ang1X+at*Yt.ang1Y+it*Yt.ang1Z,It=nt*Yt.ang1X+_t*Yt.ang1Y+et*Yt.ang1Z,w.invMAngT1X=G,w.invMAngT1Y=Zt,w.invMAngT1Z=It,Mt=rt*Yt.ang2X+st*Yt.ang2Y+lt*Yt.ang2Z,ht=ct*Yt.ang2X+pt*Yt.ang2Y+mt*Yt.ang2Z,Vt=bt*Yt.ang2X+xt*Yt.ang2Y+dt*Yt.ang2Z,w.invMAngT2X=Mt,w.invMAngT2Y=ht,w.invMAngT2Z=Vt,Lt=u*N.ang1X+$*N.ang1Y+tt*N.ang1Z,Bt=ot*N.ang1X+at*N.ang1Y+it*N.ang1Z,kt=nt*N.ang1X+_t*N.ang1Y+et*N.ang1Z,w.invMAngB1X=Lt,w.invMAngB1Y=Bt,w.invMAngB1Z=kt,At=rt*N.ang2X+st*N.ang2Y+lt*N.ang2Z,Pt=ct*N.ang2X+pt*N.ang2Y+mt*N.ang2Z,Tt=bt*N.ang2X+xt*N.ang2Y+dt*N.ang2Z,w.invMAngB2X=At,w.invMAngB2Y=Pt,w.invMAngB2Z=Tt;var wt=t+x+(w.invMAngT1X*Yt.ang1X+w.invMAngT1Y*Yt.ang1Y+w.invMAngT1Z*Yt.ang1Z)+(w.invMAngT2X*Yt.ang2X+w.invMAngT2Y*Yt.ang2Y+w.invMAngT2Z*Yt.ang2Z),O=w.invMAngT1X*N.ang1X+w.invMAngT1Y*N.ang1Y+w.invMAngT1Z*N.ang1Z+(w.invMAngT2X*N.ang2X+w.invMAngT2Y*N.ang2Y+w.invMAngT2Z*N.ang2Z),W=O,U=t+x+(w.invMAngB1X*N.ang1X+w.invMAngB1Y*N.ang1Y+w.invMAngB1Z*N.ang1Z)+(w.invMAngB2X*N.ang2X+w.invMAngB2Y*N.ang2Y+w.invMAngB2Z*N.ang2Z),H=wt*U-O*W;0!=H&&(H=1/H),w.massTB00=U*H,w.massTB01=-O*H,w.massTB10=-W*H,w.massTB11=wt*H}},warmStart:function(z){var t,Y,Z,I,V,L,B,k,A,P,T,w;t=this._b1._velX,Y=this._b1._velY,Z=this._b1._velZ,I=this._b2._velX,V=this._b2._velY,L=this._b2._velZ,B=this._b1._angVelX,k=this._b1._angVelY,A=this._b1._angVelZ,P=this._b2._angVelX,T=this._b2._angVelY,w=this._b2._angVelZ;for(var S=0,C=this.info.numRows;S<C;){var v=S++,y=this.info.rows[v],b=y.impulse,f=this.massData[v],d=y.jacobianT,x=y.jacobianB,u=b.impulseN,g=b.impulseLX*d.lin1X+b.impulseLY*d.lin1Y+b.impulseLZ*d.lin1Z,M=b.impulseLX*x.lin1X+b.impulseLY*x.lin1Y+b.impulseLZ*x.lin1Z;b.impulseT=g,b.impulseB=M,b.impulseN*=z.dtRatio,b.impulseT*=z.dtRatio,b.impulseB*=z.dtRatio,t+=f.invMLinN1X*u,Y+=f.invMLinN1Y*u,Z+=f.invMLinN1Z*u,t+=f.invMLinT1X*g,Y+=f.invMLinT1Y*g,Z+=f.invMLinT1Z*g,t+=f.invMLinB1X*M,Y+=f.invMLinB1Y*M,Z+=f.invMLinB1Z*M,I+=f.invMLinN2X*-u,V+=f.invMLinN2Y*-u,L+=f.invMLinN2Z*-u,I+=f.invMLinT2X*-g,V+=f.invMLinT2Y*-g,L+=f.invMLinT2Z*-g,I+=f.invMLinB2X*-M,V+=f.invMLinB2Y*-M,L+=f.invMLinB2Z*-M,B+=f.invMAngN1X*u,k+=f.invMAngN1Y*u,A+=f.invMAngN1Z*u,B+=f.invMAngT1X*g,k+=f.invMAngT1Y*g,A+=f.invMAngT1Z*g,B+=f.invMAngB1X*M,k+=f.invMAngB1Y*M,A+=f.invMAngB1Z*M,P+=f.invMAngN2X*-u,T+=f.invMAngN2Y*-u,w+=f.invMAngN2Z*-u,P+=f.invMAngT2X*-g,T+=f.invMAngT2Y*-g,w+=f.invMAngT2Z*-g,P+=f.invMAngB2X*-M,T+=f.invMAngB2Y*-M,w+=f.invMAngB2Z*-M}this._b1._velX=t,this._b1._velY=Y,this._b1._velZ=Z,this._b2._velX=I,this._b2._velY=V,this._b2._velZ=L,this._b1._angVelX=B,this._b1._angVelY=k,this._b1._angVelZ=A,this._b2._angVelX=P,this._b2._angVelY=T,this._b2._angVelZ=w},solveVelocity:function(){var q,R,E,j,N,F,D,W,G,O,H,J;q=this._b1._velX,R=this._b1._velY,E=this._b1._velZ,j=this._b2._velX,N=this._b2._velY,F=this._b2._velZ,D=this._b1._angVelX,W=this._b1._angVelY,G=this._b1._angVelZ,O=this._b2._angVelX,H=this._b2._angVelY,J=this._b2._angVelZ;for(var U=0,Q=this.info.numRows;U<Q;){var p=U++,v=this.info.rows[p],y=this.massData[p],b=v.impulse,f=0,K=v.jacobianT;f+=q*K.lin1X+R*K.lin1Y+E*K.lin1Z,f-=j*K.lin2X+N*K.lin2Y+F*K.lin2Z,f+=D*K.ang1X+W*K.ang1Y+G*K.ang1Z,f-=O*K.ang2X+H*K.ang2Y+J*K.ang2Z;var $=0;$+=q*(K=v.jacobianB).lin1X+R*K.lin1Y+E*K.lin1Z,$-=j*K.lin2X+N*K.lin2Y+F*K.lin2Z,$+=D*K.ang1X+W*K.ang1Y+G*K.ang1Z,$-=O*K.ang2X+H*K.ang2Y+J*K.ang2Z;var tt=-(f*y.massTB00+$*y.massTB01),ot=-(f*y.massTB10+$*y.massTB11),at=b.impulseT,X=b.impulseB;b.impulseT+=tt,b.impulseB+=ot;var z=v.friction*b.impulseN;if(0==z)b.impulseT=0,b.impulseB=0;else{var Y=b.impulseT*b.impulseT+b.impulseB*b.impulseB;if(Y>z*z){var Z=z/Math.sqrt(Y);b.impulseT*=Z,b.impulseB*=Z}}tt=b.impulseT-at,ot=b.impulseB-X,q+=y.invMLinT1X*tt,R+=y.invMLinT1Y*tt,E+=y.invMLinT1Z*tt,q+=y.invMLinB1X*ot,R+=y.invMLinB1Y*ot,E+=y.invMLinB1Z*ot,j+=y.invMLinT2X*-tt,N+=y.invMLinT2Y*-tt,F+=y.invMLinT2Z*-tt,j+=y.invMLinB2X*-ot,N+=y.invMLinB2Y*-ot,F+=y.invMLinB2Z*-ot,D+=y.invMAngT1X*tt,W+=y.invMAngT1Y*tt,G+=y.invMAngT1Z*tt,D+=y.invMAngB1X*ot,W+=y.invMAngB1Y*ot,G+=y.invMAngB1Z*ot,O+=y.invMAngT2X*-tt,H+=y.invMAngT2Y*-tt,J+=y.invMAngT2Z*-tt,O+=y.invMAngB2X*-ot,H+=y.invMAngB2Y*-ot,J+=y.invMAngB2Z*-ot}for(var I=0,it=this.info.numRows;I<it;){var L=I++,w=this.info.rows[L],B=this.massData[L],k=w.impulse,A=0,nt=w.jacobianN;A+=q*nt.lin1X+R*nt.lin1Y+E*nt.lin1Z,A-=j*nt.lin2X+N*nt.lin2Y+F*nt.lin2Z,A+=D*nt.ang1X+W*nt.ang1Y+G*nt.ang1Z,A-=O*nt.ang2X+H*nt.ang2Y+J*nt.ang2Z;var S=(w.rhs-A)*B.massN,_t=k.impulseN;k.impulseN+=S,0>k.impulseN&&(k.impulseN=0),S=k.impulseN-_t,q+=B.invMLinN1X*S,R+=B.invMLinN1Y*S,E+=B.invMLinN1Z*S,j+=B.invMLinN2X*-S,N+=B.invMLinN2Y*-S,F+=B.invMLinN2Z*-S,D+=B.invMAngN1X*S,W+=B.invMAngN1Y*S,G+=B.invMAngN1Z*S,O+=B.invMAngN2X*-S,H+=B.invMAngN2Y*-S,J+=B.invMAngN2Z*-S}this._b1._velX=q,this._b1._velY=R,this._b1._velZ=E,this._b2._velX=j,this._b2._velY=N,this._b2._velZ=F,this._b1._angVelX=D,this._b1._angVelY=W,this._b1._angVelZ=G,this._b2._angVelX=O,this._b2._angVelY=H,this._b2._angVelZ=J},preSolvePosition:function(){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,x=this._b2._invMass,u,T,C,q,R,E,j,N,F,D,W,G,O,H,J,U,Q,K;u=this._b1._invInertia00,T=this._b1._invInertia01,C=this._b1._invInertia02,q=this._b1._invInertia10,R=this._b1._invInertia11,E=this._b1._invInertia12,j=this._b1._invInertia20,N=this._b1._invInertia21,F=this._b1._invInertia22,D=this._b2._invInertia00,W=this._b2._invInertia01,G=this._b2._invInertia02,O=this._b2._invInertia10,H=this._b2._invInertia11,J=this._b2._invInertia12,U=this._b2._invInertia20,Q=this._b2._invInertia21,K=this._b2._invInertia22;for(var $=0,tt=this.info.numRows;$<tt;){var M=$++,L=this.info.rows[M],w=this.massData[M],B=L.jacobianN,k,ot,at,it,nt,_t;w.invMLinN1X=B.lin1X*t,w.invMLinN1Y=B.lin1Y*t,w.invMLinN1Z=B.lin1Z*t,w.invMLinN2X=B.lin2X*x,w.invMLinN2Y=B.lin2Y*x,w.invMLinN2Z=B.lin2Z*x,k=u*B.ang1X+T*B.ang1Y+C*B.ang1Z,ot=q*B.ang1X+R*B.ang1Y+E*B.ang1Z,at=j*B.ang1X+N*B.ang1Y+F*B.ang1Z,w.invMAngN1X=k,w.invMAngN1Y=ot,w.invMAngN1Z=at,it=D*B.ang2X+W*B.ang2Y+G*B.ang2Z,nt=O*B.ang2X+H*B.ang2Y+J*B.ang2Z,_t=U*B.ang2X+Q*B.ang2Y+K*B.ang2Z,w.invMAngN2X=it,w.invMAngN2Y=nt,w.invMAngN2Z=_t,w.massN=t+x+(w.invMAngN1X*B.ang1X+w.invMAngN1Y*B.ang1Y+w.invMAngN1Z*B.ang1Z)+(w.invMAngN2X*B.ang2X+w.invMAngN2Y*B.ang2Y+w.invMAngN2Z*B.ang2Z),0!=w.massN&&(w.massN=1/w.massN)}for(var et=0,rt=this.info.numRows,P;et<rt;)P=et++,this.info.rows[P].impulse.impulseP=0},solvePositionSplitImpulse:function(){var X,z,Y,Z,I,M,V,L,B,k,A,P;X=this._b1._pseudoVelX,z=this._b1._pseudoVelY,Y=this._b1._pseudoVelZ,Z=this._b2._pseudoVelX,I=this._b2._pseudoVelY,M=this._b2._pseudoVelZ,V=this._b1._angPseudoVelX,L=this._b1._angPseudoVelY,B=this._b1._angPseudoVelZ,k=this._b2._angPseudoVelX,A=this._b2._angPseudoVelY,P=this._b2._angPseudoVelZ;for(var T=0,w=this.info.numRows;T<w;){var p=T++,v=this.info.rows[p],y=this.massData[p],b=v.impulse,f=v.jacobianN,d=0;d+=X*f.lin1X+z*f.lin1Y+Y*f.lin1Z,d-=Z*f.lin2X+I*f.lin2Y+M*f.lin2Z,d+=V*f.ang1X+L*f.ang1Y+B*f.ang1Z,d-=k*f.ang2X+A*f.ang2Y+P*f.ang2Z;var S=(v.rhs-d)*y.massN*oimo_common_Setting.positionSplitImpulseBaumgarte,C=b.impulseP;b.impulseP+=S,0>b.impulseP&&(b.impulseP=0),S=b.impulseP-C,X+=y.invMLinN1X*S,z+=y.invMLinN1Y*S,Y+=y.invMLinN1Z*S,Z+=y.invMLinN2X*-S,I+=y.invMLinN2Y*-S,M+=y.invMLinN2Z*-S,V+=y.invMAngN1X*S,L+=y.invMAngN1Y*S,B+=y.invMAngN1Z*S,k+=y.invMAngN2X*-S,A+=y.invMAngN2Y*-S,P+=y.invMAngN2Z*-S}this._b1._pseudoVelX=X,this._b1._pseudoVelY=z,this._b1._pseudoVelZ=Y,this._b2._pseudoVelX=Z,this._b2._pseudoVelY=I,this._b2._pseudoVelZ=M,this._b1._angPseudoVelX=V,this._b1._angPseudoVelY=L,this._b1._angPseudoVelZ=B,this._b2._angPseudoVelX=k,this._b2._angPseudoVelY=A,this._b2._angPseudoVelZ=P},solvePositionNgs:function(){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,x=this._b2._invMass,u,to,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo;u=this._b1._invInertia00,to=this._b1._invInertia01,oo=this._b1._invInertia02,ao=this._b1._invInertia10,io=this._b1._invInertia11,no=this._b1._invInertia12,_o=this._b1._invInertia20,eo=this._b1._invInertia21,ro=this._b1._invInertia22,so=this._b2._invInertia00,lo=this._b2._invInertia01,co=this._b2._invInertia02,po=this._b2._invInertia10,mo=this._b2._invInertia11,bo=this._b2._invInertia12,xo=this._b2._invInertia20,yo=this._b2._invInertia21,fo=this._b2._invInertia22;for(var go=0,vo=this.info.numRows,P,Xo,uo,zo,Yo,Zo,Io,Mo,ho,Vo,Lo,Bo;go<vo;){var ko=go++,E=this.info.rows[ko],D=this.massData[ko],J=E.jacobianN,F,Ao,Po,To,wo,So;D.invMLinN1X=J.lin1X*t,D.invMLinN1Y=J.lin1Y*t,D.invMLinN1Z=J.lin1Z*t,D.invMLinN2X=J.lin2X*x,D.invMLinN2Y=J.lin2Y*x,D.invMLinN2Z=J.lin2Z*x,F=u*J.ang1X+to*J.ang1Y+oo*J.ang1Z,Ao=ao*J.ang1X+io*J.ang1Y+no*J.ang1Z,Po=_o*J.ang1X+eo*J.ang1Y+ro*J.ang1Z,D.invMAngN1X=F,D.invMAngN1Y=Ao,D.invMAngN1Z=Po,To=so*J.ang2X+lo*J.ang2Y+co*J.ang2Z,wo=po*J.ang2X+mo*J.ang2Y+bo*J.ang2Z,So=xo*J.ang2X+yo*J.ang2Y+fo*J.ang2Z,D.invMAngN2X=To,D.invMAngN2Y=wo,D.invMAngN2Z=So,D.massN=t+x+(D.invMAngN1X*J.ang1X+D.invMAngN1Y*J.ang1Y+D.invMAngN1Z*J.ang1Z)+(D.invMAngN2X*J.ang2X+D.invMAngN2Y*J.ang2Y+D.invMAngN2Z*J.ang2Z),0!=D.massN&&(D.massN=1/D.massN)}P=0,Xo=0,uo=0,zo=0,Yo=0,Zo=0,Io=0,Mo=0,ho=0,Vo=0,Lo=0,Bo=0;for(var Co=0,qo=this.info.numRows;Co<qo;){var G=Co++,O=this.info.rows[G],W=this.massData[G],U=O.impulse,H=O.jacobianN,Q=0;Q+=P*H.lin1X+Xo*H.lin1Y+uo*H.lin1Z,Q-=zo*H.lin2X+Yo*H.lin2Y+Zo*H.lin2Z,Q+=Io*H.ang1X+Mo*H.ang1Y+ho*H.ang1Z,Q-=Vo*H.ang2X+Lo*H.ang2Y+Bo*H.ang2Z;var Ro=(O.rhs-Q)*W.massN*oimo_common_Setting.positionNgsBaumgarte,Eo=U.impulseP;U.impulseP+=Ro,0>U.impulseP&&(U.impulseP=0),Ro=U.impulseP-Eo,P+=W.invMLinN1X*Ro,Xo+=W.invMLinN1Y*Ro,uo+=W.invMLinN1Z*Ro,zo+=W.invMLinN2X*-Ro,Yo+=W.invMLinN2Y*-Ro,Zo+=W.invMLinN2Z*-Ro,Io+=W.invMAngN1X*Ro,Mo+=W.invMAngN1Y*Ro,ho+=W.invMAngN1Z*Ro,Vo+=W.invMAngN2X*-Ro,Lo+=W.invMAngN2Y*-Ro,Bo+=W.invMAngN2Z*-Ro}var tt=this._b1;tt._transform._positionX+=P,tt._transform._positionY+=Xo,tt._transform._positionZ+=uo;var it=this._b2;it._transform._positionX+=zo,it._transform._positionY+=Yo,it._transform._positionZ+=Zo;var ot=this._b1,pt=Math.sqrt(Io*Io+Mo*Mo+ho*ho),vt=.5*pt,yt,jo,No,Fo,Do,Wo,Go,Oo,Ho,Jo;if(.5>vt){var Uo=vt*vt;yt=.5*(1-.16666666666666666*Uo+.008333333333333333*(Uo*Uo)),jo=1-.5*Uo+.041666666666666664*(Uo*Uo)}else yt=Math.sin(vt)/pt,jo=Math.cos(vt);No=Io*yt,Fo=Mo*yt,Do=ho*yt,Wo=jo;var bt=ot._transform._rotation00,dt=ot._transform._rotation11,xt=ot._transform._rotation22,ut=bt+dt+xt,gt;0<ut?(Jo=.5*(gt=Math.sqrt(ut+1)),gt=.5/gt,Go=(ot._transform._rotation21-ot._transform._rotation12)*gt,Oo=(ot._transform._rotation02-ot._transform._rotation20)*gt,Ho=(ot._transform._rotation10-ot._transform._rotation01)*gt):bt>dt?bt>xt?(Go=.5*(gt=Math.sqrt(bt-dt-xt+1)),gt=.5/gt,Oo=(ot._transform._rotation01+ot._transform._rotation10)*gt,Ho=(ot._transform._rotation02+ot._transform._rotation20)*gt,Jo=(ot._transform._rotation21-ot._transform._rotation12)*gt):(Ho=.5*(gt=Math.sqrt(xt-bt-dt+1)),gt=.5/gt,Go=(ot._transform._rotation02+ot._transform._rotation20)*gt,Oo=(ot._transform._rotation12+ot._transform._rotation21)*gt,Jo=(ot._transform._rotation10-ot._transform._rotation01)*gt):dt>xt?(Oo=.5*(gt=Math.sqrt(dt-xt-bt+1)),gt=.5/gt,Go=(ot._transform._rotation01+ot._transform._rotation10)*gt,Ho=(ot._transform._rotation12+ot._transform._rotation21)*gt,Jo=(ot._transform._rotation02-ot._transform._rotation20)*gt):(Ho=.5*(gt=Math.sqrt(xt-bt-dt+1)),gt=.5/gt,Go=(ot._transform._rotation02+ot._transform._rotation20)*gt,Oo=(ot._transform._rotation12+ot._transform._rotation21)*gt,Jo=(ot._transform._rotation10-ot._transform._rotation01)*gt);var Qo=(Go=Wo*Go+No*Jo+Fo*Ho-Do*Oo)*Go+(Oo=Wo*Oo-No*Ho+Fo*Jo+Do*Go)*Oo+(Ho=Wo*Ho+No*Oo-Fo*Go+Do*Jo)*Ho+(Jo=Wo*Jo-No*Go-Fo*Oo-Do*Ho)*Jo;1e-32<Qo&&(Qo=1/Math.sqrt(Qo)),Go*=Qo,Oo*=Qo,Ho*=Qo,Jo*=Qo;var Ko=2*Go,Et=2*Oo,Dt=2*Ho,Jt=Go*Ko,Ft=Oo*Et,Nt=Ho*Dt,Gt=Go*Et,Ot=Oo*Dt,Wt=Go*Dt,Ut=Jo*Ko,Ht=Jo*Et,Qt=Jo*Dt,$t,$o,ta,oa,aa,ia,na,_a,ea,ra,sa,la,ca,pa,ma,ba,xa,da;ot._transform._rotation00=1-Ft-Nt,ot._transform._rotation01=Gt-Qt,ot._transform._rotation02=Wt+Ht,ot._transform._rotation10=Gt+Qt,ot._transform._rotation11=1-Jt-Nt,ot._transform._rotation12=Ot-Ut,ot._transform._rotation20=Wt-Ht,ot._transform._rotation21=Ot+Ut,ot._transform._rotation22=1-Jt-Ft,$t=ot._transform._rotation00*ot._invLocalInertia00+ot._transform._rotation01*ot._invLocalInertia10+ot._transform._rotation02*ot._invLocalInertia20,$o=ot._transform._rotation00*ot._invLocalInertia01+ot._transform._rotation01*ot._invLocalInertia11+ot._transform._rotation02*ot._invLocalInertia21,ta=ot._transform._rotation00*ot._invLocalInertia02+ot._transform._rotation01*ot._invLocalInertia12+ot._transform._rotation02*ot._invLocalInertia22,oa=ot._transform._rotation10*ot._invLocalInertia00+ot._transform._rotation11*ot._invLocalInertia10+ot._transform._rotation12*ot._invLocalInertia20,aa=ot._transform._rotation10*ot._invLocalInertia01+ot._transform._rotation11*ot._invLocalInertia11+ot._transform._rotation12*ot._invLocalInertia21,ia=ot._transform._rotation10*ot._invLocalInertia02+ot._transform._rotation11*ot._invLocalInertia12+ot._transform._rotation12*ot._invLocalInertia22,na=ot._transform._rotation20*ot._invLocalInertia00+ot._transform._rotation21*ot._invLocalInertia10+ot._transform._rotation22*ot._invLocalInertia20,_a=ot._transform._rotation20*ot._invLocalInertia01+ot._transform._rotation21*ot._invLocalInertia11+ot._transform._rotation22*ot._invLocalInertia21,ea=ot._transform._rotation20*ot._invLocalInertia02+ot._transform._rotation21*ot._invLocalInertia12+ot._transform._rotation22*ot._invLocalInertia22,ot._invInertia00=$t,ot._invInertia01=$o,ot._invInertia02=ta,ot._invInertia10=oa,ot._invInertia11=aa,ot._invInertia12=ia,ot._invInertia20=na,ot._invInertia21=_a,ot._invInertia22=ea,ra=ot._invInertia00*ot._transform._rotation00+ot._invInertia01*ot._transform._rotation01+ot._invInertia02*ot._transform._rotation02,sa=ot._invInertia00*ot._transform._rotation10+ot._invInertia01*ot._transform._rotation11+ot._invInertia02*ot._transform._rotation12,la=ot._invInertia00*ot._transform._rotation20+ot._invInertia01*ot._transform._rotation21+ot._invInertia02*ot._transform._rotation22,ca=ot._invInertia10*ot._transform._rotation00+ot._invInertia11*ot._transform._rotation01+ot._invInertia12*ot._transform._rotation02,pa=ot._invInertia10*ot._transform._rotation10+ot._invInertia11*ot._transform._rotation11+ot._invInertia12*ot._transform._rotation12,ma=ot._invInertia10*ot._transform._rotation20+ot._invInertia11*ot._transform._rotation21+ot._invInertia12*ot._transform._rotation22,ba=ot._invInertia20*ot._transform._rotation00+ot._invInertia21*ot._transform._rotation01+ot._invInertia22*ot._transform._rotation02,xa=ot._invInertia20*ot._transform._rotation10+ot._invInertia21*ot._transform._rotation11+ot._invInertia22*ot._transform._rotation12,da=ot._invInertia20*ot._transform._rotation20+ot._invInertia21*ot._transform._rotation21+ot._invInertia22*ot._transform._rotation22,ot._invInertia00=ra,ot._invInertia01=sa,ot._invInertia02=la,ot._invInertia10=ca,ot._invInertia11=pa,ot._invInertia12=ma,ot._invInertia20=ba,ot._invInertia21=xa,ot._invInertia22=da,ot._invInertia00*=ot._rotFactor.x,ot._invInertia01*=ot._rotFactor.x,ot._invInertia02*=ot._rotFactor.x,ot._invInertia10*=ot._rotFactor.y,ot._invInertia11*=ot._rotFactor.y,ot._invInertia12*=ot._rotFactor.y,ot._invInertia20*=ot._rotFactor.z,ot._invInertia21*=ot._rotFactor.z,ot._invInertia22*=ot._rotFactor.z;var ya=this._b2,fa=Math.sqrt(Vo*Vo+Lo*Lo+Bo*Bo),ga=.5*fa,va,Xa,ua,za,Ya,Za,Ia,Ma,ha,Va;if(.5>ga){var La=ga*ga;va=.5*(1-.16666666666666666*La+.008333333333333333*(La*La)),Xa=1-.5*La+.041666666666666664*(La*La)}else va=Math.sin(ga)/fa,Xa=Math.cos(ga);ua=Vo*va,za=Lo*va,Ya=Bo*va,Za=Xa;var Ba=ya._transform._rotation00,ka=ya._transform._rotation11,Aa=ya._transform._rotation22,Pa=Ba+ka+Aa,Ta;0<Pa?(Va=.5*(Ta=Math.sqrt(Pa+1)),Ta=.5/Ta,Ia=(ya._transform._rotation21-ya._transform._rotation12)*Ta,Ma=(ya._transform._rotation02-ya._transform._rotation20)*Ta,ha=(ya._transform._rotation10-ya._transform._rotation01)*Ta):Ba>ka?Ba>Aa?(Ia=.5*(Ta=Math.sqrt(Ba-ka-Aa+1)),Ta=.5/Ta,Ma=(ya._transform._rotation01+ya._transform._rotation10)*Ta,ha=(ya._transform._rotation02+ya._transform._rotation20)*Ta,Va=(ya._transform._rotation21-ya._transform._rotation12)*Ta):(ha=.5*(Ta=Math.sqrt(Aa-Ba-ka+1)),Ta=.5/Ta,Ia=(ya._transform._rotation02+ya._transform._rotation20)*Ta,Ma=(ya._transform._rotation12+ya._transform._rotation21)*Ta,Va=(ya._transform._rotation10-ya._transform._rotation01)*Ta):ka>Aa?(Ma=.5*(Ta=Math.sqrt(ka-Aa-Ba+1)),Ta=.5/Ta,Ia=(ya._transform._rotation01+ya._transform._rotation10)*Ta,ha=(ya._transform._rotation12+ya._transform._rotation21)*Ta,Va=(ya._transform._rotation02-ya._transform._rotation20)*Ta):(ha=.5*(Ta=Math.sqrt(Aa-Ba-ka+1)),Ta=.5/Ta,Ia=(ya._transform._rotation02+ya._transform._rotation20)*Ta,Ma=(ya._transform._rotation12+ya._transform._rotation21)*Ta,Va=(ya._transform._rotation10-ya._transform._rotation01)*Ta);var wa=(Ia=Za*Ia+ua*Va+za*ha-Ya*Ma)*Ia+(Ma=Za*Ma-ua*ha+za*Va+Ya*Ia)*Ma+(ha=Za*ha+ua*Ma-za*Ia+Ya*Va)*ha+(Va=Za*Va-ua*Ia-za*Ma-Ya*ha)*Va;1e-32<wa&&(wa=1/Math.sqrt(wa)),Ia*=wa,Ma*=wa,ha*=wa,Va*=wa;var Sa=2*Ia,Ca=2*Ma,qa=2*ha,Ra=Ia*Sa,Ea=Ma*Ca,ja=ha*qa,Na=Ia*Ca,Fa=Ma*qa,Da=Ia*qa,Wa=Va*Sa,Ga=Va*Ca,Oa=Va*qa,Ha,Ja,Ua,Qa,Ka,$a,li,ci,mi,bi,yi,fi,vi,hi,Ti,qi,Ri,Ei;ya._transform._rotation00=1-Ea-ja,ya._transform._rotation01=Na-Oa,ya._transform._rotation02=Da+Ga,ya._transform._rotation10=Na+Oa,ya._transform._rotation11=1-Ra-ja,ya._transform._rotation12=Fa-Wa,ya._transform._rotation20=Da-Ga,ya._transform._rotation21=Fa+Wa,ya._transform._rotation22=1-Ra-Ea,Ha=ya._transform._rotation00*ya._invLocalInertia00+ya._transform._rotation01*ya._invLocalInertia10+ya._transform._rotation02*ya._invLocalInertia20,Ja=ya._transform._rotation00*ya._invLocalInertia01+ya._transform._rotation01*ya._invLocalInertia11+ya._transform._rotation02*ya._invLocalInertia21,Ua=ya._transform._rotation00*ya._invLocalInertia02+ya._transform._rotation01*ya._invLocalInertia12+ya._transform._rotation02*ya._invLocalInertia22,Qa=ya._transform._rotation10*ya._invLocalInertia00+ya._transform._rotation11*ya._invLocalInertia10+ya._transform._rotation12*ya._invLocalInertia20,Ka=ya._transform._rotation10*ya._invLocalInertia01+ya._transform._rotation11*ya._invLocalInertia11+ya._transform._rotation12*ya._invLocalInertia21,$a=ya._transform._rotation10*ya._invLocalInertia02+ya._transform._rotation11*ya._invLocalInertia12+ya._transform._rotation12*ya._invLocalInertia22,li=ya._transform._rotation20*ya._invLocalInertia00+ya._transform._rotation21*ya._invLocalInertia10+ya._transform._rotation22*ya._invLocalInertia20,ci=ya._transform._rotation20*ya._invLocalInertia01+ya._transform._rotation21*ya._invLocalInertia11+ya._transform._rotation22*ya._invLocalInertia21,mi=ya._transform._rotation20*ya._invLocalInertia02+ya._transform._rotation21*ya._invLocalInertia12+ya._transform._rotation22*ya._invLocalInertia22,ya._invInertia00=Ha,ya._invInertia01=Ja,ya._invInertia02=Ua,ya._invInertia10=Qa,ya._invInertia11=Ka,ya._invInertia12=$a,ya._invInertia20=li,ya._invInertia21=ci,ya._invInertia22=mi,bi=ya._invInertia00*ya._transform._rotation00+ya._invInertia01*ya._transform._rotation01+ya._invInertia02*ya._transform._rotation02,yi=ya._invInertia00*ya._transform._rotation10+ya._invInertia01*ya._transform._rotation11+ya._invInertia02*ya._transform._rotation12,fi=ya._invInertia00*ya._transform._rotation20+ya._invInertia01*ya._transform._rotation21+ya._invInertia02*ya._transform._rotation22,vi=ya._invInertia10*ya._transform._rotation00+ya._invInertia11*ya._transform._rotation01+ya._invInertia12*ya._transform._rotation02,hi=ya._invInertia10*ya._transform._rotation10+ya._invInertia11*ya._transform._rotation11+ya._invInertia12*ya._transform._rotation12,Ti=ya._invInertia10*ya._transform._rotation20+ya._invInertia11*ya._transform._rotation21+ya._invInertia12*ya._transform._rotation22,qi=ya._invInertia20*ya._transform._rotation00+ya._invInertia21*ya._transform._rotation01+ya._invInertia22*ya._transform._rotation02,Ri=ya._invInertia20*ya._transform._rotation10+ya._invInertia21*ya._transform._rotation11+ya._invInertia22*ya._transform._rotation12,Ei=ya._invInertia20*ya._transform._rotation20+ya._invInertia21*ya._transform._rotation21+ya._invInertia22*ya._transform._rotation22,ya._invInertia00=bi,ya._invInertia01=yi,ya._invInertia02=fi,ya._invInertia10=vi,ya._invInertia11=hi,ya._invInertia12=Ti,ya._invInertia20=qi,ya._invInertia21=Ri,ya._invInertia22=Ei,ya._invInertia00*=ya._rotFactor.x,ya._invInertia01*=ya._rotFactor.x,ya._invInertia02*=ya._rotFactor.x,ya._invInertia10*=ya._rotFactor.y,ya._invInertia11*=ya._rotFactor.y,ya._invInertia12*=ya._rotFactor.y,ya._invInertia20*=ya._rotFactor.z,ya._invInertia21*=ya._rotFactor.z,ya._invInertia22*=ya._rotFactor.z},postSolve:function(){for(var l=0,c=this.info.numRows;l<c;){var i=l++,s=this.info.rows[i],_=s.impulse,r=s.jacobianT,e=s.jacobianB,p,m,b;p=0,m=0,b=0,p+=r.lin1X*_.impulseT,m+=r.lin1Y*_.impulseT,b+=r.lin1Z*_.impulseT,p+=e.lin1X*_.impulseB,m+=e.lin1Y*_.impulseB,b+=e.lin1Z*_.impulseB,_.impulseLX=p,_.impulseLY=m,_.impulseLZ=b}this.constraint._syncManifold()}});var oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver=function(_){oimo_dynamics_constraint_ConstraintSolver.call(this),this.joint=_,this.info=new oimo_dynamics_constraint_info_joint_JointSolverInfo;var t=oimo_common_Setting.maxJacobianRows,i=Array(t);this.massData=i;for(var o=0,e=this.massData.length,n;o<e;)n=o++,this.massData[n]=new oimo_dynamics_constraint_solver_common_JointSolverMassDataRow};oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.__super__=oimo_dynamics_constraint_ConstraintSolver,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype=$extend(oimo_dynamics_constraint_ConstraintSolver.prototype,{preSolveVelocity:function(A){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(A,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,x=this._b2._invMass,u,P,T,S,C,q,R,E,j,N,F,D,W,G,O,H,J,U;u=this._b1._invInertia00,P=this._b1._invInertia01,T=this._b1._invInertia02,S=this._b1._invInertia10,C=this._b1._invInertia11,q=this._b1._invInertia12,R=this._b1._invInertia20,E=this._b1._invInertia21,j=this._b1._invInertia22,N=this._b2._invInertia00,F=this._b2._invInertia01,D=this._b2._invInertia02,W=this._b2._invInertia10,G=this._b2._invInertia11,O=this._b2._invInertia12,H=this._b2._invInertia20,J=this._b2._invInertia21,U=this._b2._invInertia22;for(var Q=0,K=this.info.numRows;Q<K;){var M=Q++,L=this.info.rows[M],w=this.massData[M],B=L.jacobian,k,$,tt,ot,at,it;(B.updateSparsity(),0==(1&B.flag)?(w.invMLin1X=0,w.invMLin1Y=0,w.invMLin1Z=0,w.invMLin2X=0,w.invMLin2Y=0,w.invMLin2Z=0):(w.invMLin1X=B.lin1X*t,w.invMLin1Y=B.lin1Y*t,w.invMLin1Z=B.lin1Z*t,w.invMLin2X=B.lin2X*x,w.invMLin2Y=B.lin2Y*x,w.invMLin2Z=B.lin2Z*x),0!=(2&B.flag))?(k=u*B.ang1X+P*B.ang1Y+T*B.ang1Z,$=S*B.ang1X+C*B.ang1Y+q*B.ang1Z,tt=R*B.ang1X+E*B.ang1Y+j*B.ang1Z,w.invMAng1X=k,w.invMAng1Y=$,w.invMAng1Z=tt,ot=N*B.ang2X+F*B.ang2Y+D*B.ang2Z,at=W*B.ang2X+G*B.ang2Y+O*B.ang2Z,it=H*B.ang2X+J*B.ang2Y+U*B.ang2Z,w.invMAng2X=ot,w.invMAng2Y=at,w.invMAng2Z=it):(w.invMAng1X=0,w.invMAng1Y=0,w.invMAng1Z=0,w.invMAng2X=0,w.invMAng2Y=0,w.invMAng2Z=0),w.massWithoutCfm=w.invMLin1X*B.lin1X+w.invMLin1Y*B.lin1Y+w.invMLin1Z*B.lin1Z+(w.invMLin2X*B.lin2X+w.invMLin2Y*B.lin2Y+w.invMLin2Z*B.lin2Z)+(w.invMAng1X*B.ang1X+w.invMAng1Y*B.ang1Y+w.invMAng1Z*B.ang1Z)+(w.invMAng2X*B.ang2X+w.invMAng2Y*B.ang2Y+w.invMAng2Z*B.ang2Z),w.mass=w.massWithoutCfm+L.cfm,0!=w.massWithoutCfm&&(w.massWithoutCfm=1/w.massWithoutCfm),0!=w.mass&&(w.mass=1/w.mass)}},warmStart:function(Y){var t=this.joint._positionCorrectionAlgorithm==oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE?oimo_common_Setting.jointWarmStartingFactorForBaungarte:oimo_common_Setting.jointWarmStartingFactor;if(0>=(t*=Y.dtRatio))for(var Z=0,I=this.info.numRows;Z<I;){var a=Z++,n=this.info.rows[a].impulse;n.impulse=0,n.impulseM=0,n.impulseP=0}else{var s,V,L,B,k,A,P,T,w,S,C,q;s=this._b1._velX,V=this._b1._velY,L=this._b1._velZ,B=this._b2._velX,k=this._b2._velY,A=this._b2._velZ,P=this._b1._angVelX,T=this._b1._angVelY,w=this._b1._angVelZ,S=this._b2._angVelX,C=this._b2._angVelY,q=this._b2._angVelZ;for(var R=0,E=this.info.numRows;R<E;){var x=R++,u=this.info.rows[x],g=this.massData[x],M=u.impulse;u.jacobian,M.impulse*=t,M.impulseM*=t;var X=M.impulse+M.impulseM;s+=g.invMLin1X*X,V+=g.invMLin1Y*X,L+=g.invMLin1Z*X,B+=g.invMLin2X*-X,k+=g.invMLin2Y*-X,A+=g.invMLin2Z*-X,P+=g.invMAng1X*X,T+=g.invMAng1Y*X,w+=g.invMAng1Z*X,S+=g.invMAng2X*-X,C+=g.invMAng2Y*-X,q+=g.invMAng2Z*-X}this._b1._velX=s,this._b1._velY=V,this._b1._velZ=L,this._b2._velX=B,this._b2._velY=k,this._b2._velZ=A,this._b1._angVelX=P,this._b1._angVelY=T,this._b1._angVelZ=w,this._b2._angVelX=S,this._b2._angVelY=C,this._b2._angVelZ=q}},solveVelocity:function(){var k,A,P,T,S,C,q,R,E,j,N,F;k=this._b1._velX,A=this._b1._velY,P=this._b1._velZ,T=this._b2._velX,S=this._b2._velY,C=this._b2._velZ,q=this._b1._angVelX,R=this._b1._angVelY,E=this._b1._angVelZ,j=this._b2._angVelX,N=this._b2._angVelY,F=this._b2._angVelZ;for(var D=0,W=this.info.numRows;D<W;){var p=D++,v=this.info.rows[p],y=this.massData[p],b=v.impulse,f=v.jacobian;if(0!=v.motorMaxImpulse){var d=0;d+=k*f.lin1X+A*f.lin1Y+P*f.lin1Z,d-=T*f.lin2X+S*f.lin2Y+C*f.lin2Z,d+=q*f.ang1X+R*f.ang1Y+E*f.ang1Z,d-=j*f.ang2X+N*f.ang2Y+F*f.ang2Z;var G=(-v.motorSpeed-d)*y.massWithoutCfm,O=b.impulseM;b.impulseM+=G,b.impulseM<-v.motorMaxImpulse?b.impulseM=-v.motorMaxImpulse:b.impulseM>v.motorMaxImpulse&&(b.impulseM=v.motorMaxImpulse),G=b.impulseM-O,0!=(1&f.flag)&&(k+=y.invMLin1X*G,A+=y.invMLin1Y*G,P+=y.invMLin1Z*G,T+=y.invMLin2X*-G,S+=y.invMLin2Y*-G,C+=y.invMLin2Z*-G),0!=(2&f.flag)&&(q+=y.invMAng1X*G,R+=y.invMAng1Y*G,E+=y.invMAng1Z*G,j+=y.invMAng2X*-G,N+=y.invMAng2Y*-G,F+=y.invMAng2Z*-G)}}for(var g=0,H=this.info.numRows;g<H;){var X=g++,z=this.info.rows[X],Y=this.massData[X],Z=z.impulse,I=z.jacobian,V=0;V+=k*I.lin1X+A*I.lin1Y+P*I.lin1Z,V-=T*I.lin2X+S*I.lin2Y+C*I.lin2Z,V+=q*I.ang1X+R*I.ang1Y+E*I.ang1Z,V-=j*I.ang2X+N*I.ang2Y+F*I.ang2Z;var J=(z.rhs-V-Z.impulse*z.cfm)*Y.mass,U=Z.impulse;Z.impulse+=J,Z.impulse<z.minImpulse?Z.impulse=z.minImpulse:Z.impulse>z.maxImpulse&&(Z.impulse=z.maxImpulse),J=Z.impulse-U,0!=(1&I.flag)&&(k+=Y.invMLin1X*J,A+=Y.invMLin1Y*J,P+=Y.invMLin1Z*J,T+=Y.invMLin2X*-J,S+=Y.invMLin2Y*-J,C+=Y.invMLin2Z*-J),0!=(2&I.flag)&&(q+=Y.invMAng1X*J,R+=Y.invMAng1Y*J,E+=Y.invMAng1Z*J,j+=Y.invMAng2X*-J,N+=Y.invMAng2Y*-J,F+=Y.invMAng2Z*-J)}this._b1._velX=k,this._b1._velY=A,this._b1._velZ=P,this._b2._velX=T,this._b2._velY=S,this._b2._velZ=C,this._b1._angVelX=q,this._b1._angVelY=R,this._b1._angVelZ=E,this._b2._angVelX=j,this._b2._angVelY=N,this._b2._angVelZ=F},postSolveVelocity:function(p){var t,b,x,d,y,f;t=0,b=0,x=0,d=0,y=0,f=0;for(var g=0,v=this.info.numRows;g<v;){var e=g++,X=this.info.rows[e],l=X.impulse,c=X.jacobian;0==(1&c.flag)?0!=(2&c.flag)&&(d+=c.ang1X*l.impulse,y+=c.ang1Y*l.impulse,f+=c.ang1Z*l.impulse):(t+=c.lin1X*l.impulse,b+=c.lin1Y*l.impulse,x+=c.lin1Z*l.impulse)}this.joint._appliedForceX=t*p.invDt,this.joint._appliedForceY=b*p.invDt,this.joint._appliedForceZ=x*p.invDt,this.joint._appliedTorqueX=d*p.invDt,this.joint._appliedTorqueY=y*p.invDt,this.joint._appliedTorqueZ=f*p.invDt},preSolvePosition:function(){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,x=this._b2._invMass,u,T,C,q,R,E,j,N,F,D,W,G,O,H,J,U,Q,K;u=this._b1._invInertia00,T=this._b1._invInertia01,C=this._b1._invInertia02,q=this._b1._invInertia10,R=this._b1._invInertia11,E=this._b1._invInertia12,j=this._b1._invInertia20,N=this._b1._invInertia21,F=this._b1._invInertia22,D=this._b2._invInertia00,W=this._b2._invInertia01,G=this._b2._invInertia02,O=this._b2._invInertia10,H=this._b2._invInertia11,J=this._b2._invInertia12,U=this._b2._invInertia20,Q=this._b2._invInertia21,K=this._b2._invInertia22;for(var $=0,tt=this.info.numRows;$<tt;){var M=$++,L=this.info.rows[M],w=this.massData[M],B=(L.impulse,L.jacobian),k,ot,at,it,nt,_t;w.invMLin1X=B.lin1X*t,w.invMLin1Y=B.lin1Y*t,w.invMLin1Z=B.lin1Z*t,w.invMLin2X=B.lin2X*x,w.invMLin2Y=B.lin2Y*x,w.invMLin2Z=B.lin2Z*x,k=u*B.ang1X+T*B.ang1Y+C*B.ang1Z,ot=q*B.ang1X+R*B.ang1Y+E*B.ang1Z,at=j*B.ang1X+N*B.ang1Y+F*B.ang1Z,w.invMAng1X=k,w.invMAng1Y=ot,w.invMAng1Z=at,it=D*B.ang2X+W*B.ang2Y+G*B.ang2Z,nt=O*B.ang2X+H*B.ang2Y+J*B.ang2Z,_t=U*B.ang2X+Q*B.ang2Y+K*B.ang2Z,w.invMAng2X=it,w.invMAng2Y=nt,w.invMAng2Z=_t,w.mass=w.invMLin1X*B.lin1X+w.invMLin1Y*B.lin1Y+w.invMLin1Z*B.lin1Z+(w.invMLin2X*B.lin2X+w.invMLin2Y*B.lin2Y+w.invMLin2Z*B.lin2Z)+(w.invMAng1X*B.ang1X+w.invMAng1Y*B.ang1Y+w.invMAng1Z*B.ang1Z)+(w.invMAng2X*B.ang2X+w.invMAng2Y*B.ang2Y+w.invMAng2Z*B.ang2Z),0!=w.mass&&(w.mass=1/w.mass)}for(var et=0,rt=this.info.numRows,P;et<rt;)P=et++,this.info.rows[P].impulse.impulseP=0},solvePositionSplitImpulse:function(){var X,z,Y,Z,I,M,V,L,B,k,A,P;X=this._b1._pseudoVelX,z=this._b1._pseudoVelY,Y=this._b1._pseudoVelZ,Z=this._b2._pseudoVelX,I=this._b2._pseudoVelY,M=this._b2._pseudoVelZ,V=this._b1._angPseudoVelX,L=this._b1._angPseudoVelY,B=this._b1._angPseudoVelZ,k=this._b2._angPseudoVelX,A=this._b2._angPseudoVelY,P=this._b2._angPseudoVelZ;for(var T=0,w=this.info.numRows;T<w;){var p=T++,v=this.info.rows[p],y=this.massData[p],b=v.impulse,f=v.jacobian,d=0;d+=X*f.lin1X+z*f.lin1Y+Y*f.lin1Z,d-=Z*f.lin2X+I*f.lin2Y+M*f.lin2Z,d+=V*f.ang1X+L*f.ang1Y+B*f.ang1Z,d-=k*f.ang2X+A*f.ang2Y+P*f.ang2Z;var S=(v.rhs*oimo_common_Setting.positionSplitImpulseBaumgarte-d)*y.mass,C=b.impulseP;b.impulseP+=S,b.impulseP<v.minImpulse?b.impulseP=v.minImpulse:b.impulseP>v.maxImpulse&&(b.impulseP=v.maxImpulse),S=b.impulseP-C,X+=y.invMLin1X*S,z+=y.invMLin1Y*S,Y+=y.invMLin1Z*S,Z+=y.invMLin2X*-S,I+=y.invMLin2Y*-S,M+=y.invMLin2Z*-S,V+=y.invMAng1X*S,L+=y.invMAng1Y*S,B+=y.invMAng1Z*S,k+=y.invMAng2X*-S,A+=y.invMAng2Y*-S,P+=y.invMAng2Z*-S}this._b1._pseudoVelX=X,this._b1._pseudoVelY=z,this._b1._pseudoVelZ=Y,this._b2._pseudoVelX=Z,this._b2._pseudoVelY=I,this._b2._pseudoVelZ=M,this._b1._angPseudoVelX=V,this._b1._angPseudoVelY=L,this._b1._angPseudoVelZ=B,this._b2._angPseudoVelX=k,this._b2._angPseudoVelY=A,this._b2._angPseudoVelZ=P},solvePositionNgs:function(){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,x=this._b2._invMass,u,to,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo;u=this._b1._invInertia00,to=this._b1._invInertia01,oo=this._b1._invInertia02,ao=this._b1._invInertia10,io=this._b1._invInertia11,no=this._b1._invInertia12,_o=this._b1._invInertia20,eo=this._b1._invInertia21,ro=this._b1._invInertia22,so=this._b2._invInertia00,lo=this._b2._invInertia01,co=this._b2._invInertia02,po=this._b2._invInertia10,mo=this._b2._invInertia11,bo=this._b2._invInertia12,xo=this._b2._invInertia20,yo=this._b2._invInertia21,fo=this._b2._invInertia22;for(var go=0,vo=this.info.numRows,P,Xo,uo,zo,Yo,Zo,Io,Mo,ho,Vo,Lo,Bo;go<vo;){var ko=go++,E=this.info.rows[ko],D=this.massData[ko],J=(E.impulse,E.jacobian),F,Ao,Po,To,wo,So;D.invMLin1X=J.lin1X*t,D.invMLin1Y=J.lin1Y*t,D.invMLin1Z=J.lin1Z*t,D.invMLin2X=J.lin2X*x,D.invMLin2Y=J.lin2Y*x,D.invMLin2Z=J.lin2Z*x,F=u*J.ang1X+to*J.ang1Y+oo*J.ang1Z,Ao=ao*J.ang1X+io*J.ang1Y+no*J.ang1Z,Po=_o*J.ang1X+eo*J.ang1Y+ro*J.ang1Z,D.invMAng1X=F,D.invMAng1Y=Ao,D.invMAng1Z=Po,To=so*J.ang2X+lo*J.ang2Y+co*J.ang2Z,wo=po*J.ang2X+mo*J.ang2Y+bo*J.ang2Z,So=xo*J.ang2X+yo*J.ang2Y+fo*J.ang2Z,D.invMAng2X=To,D.invMAng2Y=wo,D.invMAng2Z=So,D.mass=D.invMLin1X*J.lin1X+D.invMLin1Y*J.lin1Y+D.invMLin1Z*J.lin1Z+(D.invMLin2X*J.lin2X+D.invMLin2Y*J.lin2Y+D.invMLin2Z*J.lin2Z)+(D.invMAng1X*J.ang1X+D.invMAng1Y*J.ang1Y+D.invMAng1Z*J.ang1Z)+(D.invMAng2X*J.ang2X+D.invMAng2Y*J.ang2Y+D.invMAng2Z*J.ang2Z),0!=D.mass&&(D.mass=1/D.mass)}P=0,Xo=0,uo=0,zo=0,Yo=0,Zo=0,Io=0,Mo=0,ho=0,Vo=0,Lo=0,Bo=0;for(var Co=0,qo=this.info.numRows;Co<qo;){var G=Co++,O=this.info.rows[G],W=this.massData[G],U=O.impulse,H=O.jacobian,Q=0;Q+=P*H.lin1X+Xo*H.lin1Y+uo*H.lin1Z,Q-=zo*H.lin2X+Yo*H.lin2Y+Zo*H.lin2Z,Q+=Io*H.ang1X+Mo*H.ang1Y+ho*H.ang1Z,Q-=Vo*H.ang2X+Lo*H.ang2Y+Bo*H.ang2Z;var Ro=(O.rhs*oimo_common_Setting.positionNgsBaumgarte-Q)*W.mass,Eo=U.impulseP;U.impulseP+=Ro,U.impulseP<O.minImpulse?U.impulseP=O.minImpulse:U.impulseP>O.maxImpulse&&(U.impulseP=O.maxImpulse),Ro=U.impulseP-Eo,P+=W.invMLin1X*Ro,Xo+=W.invMLin1Y*Ro,uo+=W.invMLin1Z*Ro,zo+=W.invMLin2X*-Ro,Yo+=W.invMLin2Y*-Ro,Zo+=W.invMLin2Z*-Ro,Io+=W.invMAng1X*Ro,Mo+=W.invMAng1Y*Ro,ho+=W.invMAng1Z*Ro,Vo+=W.invMAng2X*-Ro,Lo+=W.invMAng2Y*-Ro,Bo+=W.invMAng2Z*-Ro}var tt=this._b1;tt._transform._positionX+=P,tt._transform._positionY+=Xo,tt._transform._positionZ+=uo;var it=this._b2;it._transform._positionX+=zo,it._transform._positionY+=Yo,it._transform._positionZ+=Zo;var ot=this._b1,pt=Math.sqrt(Io*Io+Mo*Mo+ho*ho),vt=.5*pt,yt,jo,No,Fo,Do,Wo,Go,Oo,Ho,Jo;if(.5>vt){var Uo=vt*vt;yt=.5*(1-.16666666666666666*Uo+.008333333333333333*(Uo*Uo)),jo=1-.5*Uo+.041666666666666664*(Uo*Uo)}else yt=Math.sin(vt)/pt,jo=Math.cos(vt);No=Io*yt,Fo=Mo*yt,Do=ho*yt,Wo=jo;var bt=ot._transform._rotation00,dt=ot._transform._rotation11,xt=ot._transform._rotation22,ut=bt+dt+xt,gt;0<ut?(Jo=.5*(gt=Math.sqrt(ut+1)),gt=.5/gt,Go=(ot._transform._rotation21-ot._transform._rotation12)*gt,Oo=(ot._transform._rotation02-ot._transform._rotation20)*gt,Ho=(ot._transform._rotation10-ot._transform._rotation01)*gt):bt>dt?bt>xt?(Go=.5*(gt=Math.sqrt(bt-dt-xt+1)),gt=.5/gt,Oo=(ot._transform._rotation01+ot._transform._rotation10)*gt,Ho=(ot._transform._rotation02+ot._transform._rotation20)*gt,Jo=(ot._transform._rotation21-ot._transform._rotation12)*gt):(Ho=.5*(gt=Math.sqrt(xt-bt-dt+1)),gt=.5/gt,Go=(ot._transform._rotation02+ot._transform._rotation20)*gt,Oo=(ot._transform._rotation12+ot._transform._rotation21)*gt,Jo=(ot._transform._rotation10-ot._transform._rotation01)*gt):dt>xt?(Oo=.5*(gt=Math.sqrt(dt-xt-bt+1)),gt=.5/gt,Go=(ot._transform._rotation01+ot._transform._rotation10)*gt,Ho=(ot._transform._rotation12+ot._transform._rotation21)*gt,Jo=(ot._transform._rotation02-ot._transform._rotation20)*gt):(Ho=.5*(gt=Math.sqrt(xt-bt-dt+1)),gt=.5/gt,Go=(ot._transform._rotation02+ot._transform._rotation20)*gt,Oo=(ot._transform._rotation12+ot._transform._rotation21)*gt,Jo=(ot._transform._rotation10-ot._transform._rotation01)*gt);var Qo=(Go=Wo*Go+No*Jo+Fo*Ho-Do*Oo)*Go+(Oo=Wo*Oo-No*Ho+Fo*Jo+Do*Go)*Oo+(Ho=Wo*Ho+No*Oo-Fo*Go+Do*Jo)*Ho+(Jo=Wo*Jo-No*Go-Fo*Oo-Do*Ho)*Jo;1e-32<Qo&&(Qo=1/Math.sqrt(Qo)),Go*=Qo,Oo*=Qo,Ho*=Qo,Jo*=Qo;var Ko=2*Go,Et=2*Oo,Dt=2*Ho,Jt=Go*Ko,Ft=Oo*Et,Nt=Ho*Dt,Gt=Go*Et,Ot=Oo*Dt,Wt=Go*Dt,Ut=Jo*Ko,Ht=Jo*Et,Qt=Jo*Dt,$t,$o,ta,oa,aa,ia,na,_a,ea,ra,sa,la,ca,pa,ma,ba,xa,da;ot._transform._rotation00=1-Ft-Nt,ot._transform._rotation01=Gt-Qt,ot._transform._rotation02=Wt+Ht,ot._transform._rotation10=Gt+Qt,ot._transform._rotation11=1-Jt-Nt,ot._transform._rotation12=Ot-Ut,ot._transform._rotation20=Wt-Ht,ot._transform._rotation21=Ot+Ut,ot._transform._rotation22=1-Jt-Ft,$t=ot._transform._rotation00*ot._invLocalInertia00+ot._transform._rotation01*ot._invLocalInertia10+ot._transform._rotation02*ot._invLocalInertia20,$o=ot._transform._rotation00*ot._invLocalInertia01+ot._transform._rotation01*ot._invLocalInertia11+ot._transform._rotation02*ot._invLocalInertia21,ta=ot._transform._rotation00*ot._invLocalInertia02+ot._transform._rotation01*ot._invLocalInertia12+ot._transform._rotation02*ot._invLocalInertia22,oa=ot._transform._rotation10*ot._invLocalInertia00+ot._transform._rotation11*ot._invLocalInertia10+ot._transform._rotation12*ot._invLocalInertia20,aa=ot._transform._rotation10*ot._invLocalInertia01+ot._transform._rotation11*ot._invLocalInertia11+ot._transform._rotation12*ot._invLocalInertia21,ia=ot._transform._rotation10*ot._invLocalInertia02+ot._transform._rotation11*ot._invLocalInertia12+ot._transform._rotation12*ot._invLocalInertia22,na=ot._transform._rotation20*ot._invLocalInertia00+ot._transform._rotation21*ot._invLocalInertia10+ot._transform._rotation22*ot._invLocalInertia20,_a=ot._transform._rotation20*ot._invLocalInertia01+ot._transform._rotation21*ot._invLocalInertia11+ot._transform._rotation22*ot._invLocalInertia21,ea=ot._transform._rotation20*ot._invLocalInertia02+ot._transform._rotation21*ot._invLocalInertia12+ot._transform._rotation22*ot._invLocalInertia22,ot._invInertia00=$t,ot._invInertia01=$o,ot._invInertia02=ta,ot._invInertia10=oa,ot._invInertia11=aa,ot._invInertia12=ia,ot._invInertia20=na,ot._invInertia21=_a,ot._invInertia22=ea,ra=ot._invInertia00*ot._transform._rotation00+ot._invInertia01*ot._transform._rotation01+ot._invInertia02*ot._transform._rotation02,sa=ot._invInertia00*ot._transform._rotation10+ot._invInertia01*ot._transform._rotation11+ot._invInertia02*ot._transform._rotation12,la=ot._invInertia00*ot._transform._rotation20+ot._invInertia01*ot._transform._rotation21+ot._invInertia02*ot._transform._rotation22,ca=ot._invInertia10*ot._transform._rotation00+ot._invInertia11*ot._transform._rotation01+ot._invInertia12*ot._transform._rotation02,pa=ot._invInertia10*ot._transform._rotation10+ot._invInertia11*ot._transform._rotation11+ot._invInertia12*ot._transform._rotation12,ma=ot._invInertia10*ot._transform._rotation20+ot._invInertia11*ot._transform._rotation21+ot._invInertia12*ot._transform._rotation22,ba=ot._invInertia20*ot._transform._rotation00+ot._invInertia21*ot._transform._rotation01+ot._invInertia22*ot._transform._rotation02,xa=ot._invInertia20*ot._transform._rotation10+ot._invInertia21*ot._transform._rotation11+ot._invInertia22*ot._transform._rotation12,da=ot._invInertia20*ot._transform._rotation20+ot._invInertia21*ot._transform._rotation21+ot._invInertia22*ot._transform._rotation22,ot._invInertia00=ra,ot._invInertia01=sa,ot._invInertia02=la,ot._invInertia10=ca,ot._invInertia11=pa,ot._invInertia12=ma,ot._invInertia20=ba,ot._invInertia21=xa,ot._invInertia22=da,ot._invInertia00*=ot._rotFactor.x,ot._invInertia01*=ot._rotFactor.x,ot._invInertia02*=ot._rotFactor.x,ot._invInertia10*=ot._rotFactor.y,ot._invInertia11*=ot._rotFactor.y,ot._invInertia12*=ot._rotFactor.y,ot._invInertia20*=ot._rotFactor.z,ot._invInertia21*=ot._rotFactor.z,ot._invInertia22*=ot._rotFactor.z;var ya=this._b2,fa=Math.sqrt(Vo*Vo+Lo*Lo+Bo*Bo),ga=.5*fa,va,Xa,ua,za,Ya,Za,Ia,Ma,ha,Va;if(.5>ga){var La=ga*ga;va=.5*(1-.16666666666666666*La+.008333333333333333*(La*La)),Xa=1-.5*La+.041666666666666664*(La*La)}else va=Math.sin(ga)/fa,Xa=Math.cos(ga);ua=Vo*va,za=Lo*va,Ya=Bo*va,Za=Xa;var Ba=ya._transform._rotation00,ka=ya._transform._rotation11,Aa=ya._transform._rotation22,Pa=Ba+ka+Aa,Ta;0<Pa?(Va=.5*(Ta=Math.sqrt(Pa+1)),Ta=.5/Ta,Ia=(ya._transform._rotation21-ya._transform._rotation12)*Ta,Ma=(ya._transform._rotation02-ya._transform._rotation20)*Ta,ha=(ya._transform._rotation10-ya._transform._rotation01)*Ta):Ba>ka?Ba>Aa?(Ia=.5*(Ta=Math.sqrt(Ba-ka-Aa+1)),Ta=.5/Ta,Ma=(ya._transform._rotation01+ya._transform._rotation10)*Ta,ha=(ya._transform._rotation02+ya._transform._rotation20)*Ta,Va=(ya._transform._rotation21-ya._transform._rotation12)*Ta):(ha=.5*(Ta=Math.sqrt(Aa-Ba-ka+1)),Ta=.5/Ta,Ia=(ya._transform._rotation02+ya._transform._rotation20)*Ta,Ma=(ya._transform._rotation12+ya._transform._rotation21)*Ta,Va=(ya._transform._rotation10-ya._transform._rotation01)*Ta):ka>Aa?(Ma=.5*(Ta=Math.sqrt(ka-Aa-Ba+1)),Ta=.5/Ta,Ia=(ya._transform._rotation01+ya._transform._rotation10)*Ta,ha=(ya._transform._rotation12+ya._transform._rotation21)*Ta,Va=(ya._transform._rotation02-ya._transform._rotation20)*Ta):(ha=.5*(Ta=Math.sqrt(Aa-Ba-ka+1)),Ta=.5/Ta,Ia=(ya._transform._rotation02+ya._transform._rotation20)*Ta,Ma=(ya._transform._rotation12+ya._transform._rotation21)*Ta,Va=(ya._transform._rotation10-ya._transform._rotation01)*Ta);var wa=(Ia=Za*Ia+ua*Va+za*ha-Ya*Ma)*Ia+(Ma=Za*Ma-ua*ha+za*Va+Ya*Ia)*Ma+(ha=Za*ha+ua*Ma-za*Ia+Ya*Va)*ha+(Va=Za*Va-ua*Ia-za*Ma-Ya*ha)*Va;1e-32<wa&&(wa=1/Math.sqrt(wa)),Ia*=wa,Ma*=wa,ha*=wa,Va*=wa;var Sa=2*Ia,Ca=2*Ma,qa=2*ha,Ra=Ia*Sa,Ea=Ma*Ca,ja=ha*qa,Na=Ia*Ca,Fa=Ma*qa,Da=Ia*qa,Wa=Va*Sa,Ga=Va*Ca,Oa=Va*qa,Ha,Ja,Ua,Qa,Ka,$a,li,ci,mi,bi,yi,fi,vi,hi,Ti,qi,Ri,Ei;ya._transform._rotation00=1-Ea-ja,ya._transform._rotation01=Na-Oa,ya._transform._rotation02=Da+Ga,ya._transform._rotation10=Na+Oa,ya._transform._rotation11=1-Ra-ja,ya._transform._rotation12=Fa-Wa,ya._transform._rotation20=Da-Ga,ya._transform._rotation21=Fa+Wa,ya._transform._rotation22=1-Ra-Ea,Ha=ya._transform._rotation00*ya._invLocalInertia00+ya._transform._rotation01*ya._invLocalInertia10+ya._transform._rotation02*ya._invLocalInertia20,Ja=ya._transform._rotation00*ya._invLocalInertia01+ya._transform._rotation01*ya._invLocalInertia11+ya._transform._rotation02*ya._invLocalInertia21,Ua=ya._transform._rotation00*ya._invLocalInertia02+ya._transform._rotation01*ya._invLocalInertia12+ya._transform._rotation02*ya._invLocalInertia22,Qa=ya._transform._rotation10*ya._invLocalInertia00+ya._transform._rotation11*ya._invLocalInertia10+ya._transform._rotation12*ya._invLocalInertia20,Ka=ya._transform._rotation10*ya._invLocalInertia01+ya._transform._rotation11*ya._invLocalInertia11+ya._transform._rotation12*ya._invLocalInertia21,$a=ya._transform._rotation10*ya._invLocalInertia02+ya._transform._rotation11*ya._invLocalInertia12+ya._transform._rotation12*ya._invLocalInertia22,li=ya._transform._rotation20*ya._invLocalInertia00+ya._transform._rotation21*ya._invLocalInertia10+ya._transform._rotation22*ya._invLocalInertia20,ci=ya._transform._rotation20*ya._invLocalInertia01+ya._transform._rotation21*ya._invLocalInertia11+ya._transform._rotation22*ya._invLocalInertia21,mi=ya._transform._rotation20*ya._invLocalInertia02+ya._transform._rotation21*ya._invLocalInertia12+ya._transform._rotation22*ya._invLocalInertia22,ya._invInertia00=Ha,ya._invInertia01=Ja,ya._invInertia02=Ua,ya._invInertia10=Qa,ya._invInertia11=Ka,ya._invInertia12=$a,ya._invInertia20=li,ya._invInertia21=ci,ya._invInertia22=mi,bi=ya._invInertia00*ya._transform._rotation00+ya._invInertia01*ya._transform._rotation01+ya._invInertia02*ya._transform._rotation02,yi=ya._invInertia00*ya._transform._rotation10+ya._invInertia01*ya._transform._rotation11+ya._invInertia02*ya._transform._rotation12,fi=ya._invInertia00*ya._transform._rotation20+ya._invInertia01*ya._transform._rotation21+ya._invInertia02*ya._transform._rotation22,vi=ya._invInertia10*ya._transform._rotation00+ya._invInertia11*ya._transform._rotation01+ya._invInertia12*ya._transform._rotation02,hi=ya._invInertia10*ya._transform._rotation10+ya._invInertia11*ya._transform._rotation11+ya._invInertia12*ya._transform._rotation12,Ti=ya._invInertia10*ya._transform._rotation20+ya._invInertia11*ya._transform._rotation21+ya._invInertia12*ya._transform._rotation22,qi=ya._invInertia20*ya._transform._rotation00+ya._invInertia21*ya._transform._rotation01+ya._invInertia22*ya._transform._rotation02,Ri=ya._invInertia20*ya._transform._rotation10+ya._invInertia21*ya._transform._rotation11+ya._invInertia22*ya._transform._rotation12,Ei=ya._invInertia20*ya._transform._rotation20+ya._invInertia21*ya._transform._rotation21+ya._invInertia22*ya._transform._rotation22,ya._invInertia00=bi,ya._invInertia01=yi,ya._invInertia02=fi,ya._invInertia10=vi,ya._invInertia11=hi,ya._invInertia12=Ti,ya._invInertia20=qi,ya._invInertia21=Ri,ya._invInertia22=Ei,ya._invInertia00*=ya._rotFactor.x,ya._invInertia01*=ya._rotFactor.x,ya._invInertia02*=ya._rotFactor.x,ya._invInertia10*=ya._rotFactor.y,ya._invInertia11*=ya._rotFactor.y,ya._invInertia12*=ya._rotFactor.y,ya._invInertia20*=ya._rotFactor.z,ya._invInertia21*=ya._rotFactor.z,ya._invInertia22*=ya._rotFactor.z},postSolve:function(){this.joint._syncAnchors(),this.joint._checkDestruction()}});var oimo_dynamics_rigidbody_MassData=function(){this.mass=0,this.localInertia=new oimo_common_Mat3},oimo_dynamics_rigidbody_RigidBody=function(e){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var t=e.linearVelocity;this._velX=t.x,this._velY=t.y,this._velZ=t.z;var i=e.angularVelocity;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new oimo_common_Transform,this._transform=new oimo_common_Transform;var o=e.position;this._ptransform._positionX=o.x,this._ptransform._positionY=o.y,this._ptransform._positionZ=o.z;var a=e.rotation;this._ptransform._rotation00=a.e00,this._ptransform._rotation01=a.e01,this._ptransform._rotation02=a.e02,this._ptransform._rotation10=a.e10,this._ptransform._rotation11=a.e11,this._ptransform._rotation12=a.e12,this._ptransform._rotation20=a.e20,this._ptransform._rotation21=a.e21,this._ptransform._rotation22=a.e22;var n=this._transform,r=this._ptransform;n._positionX=r._positionX,n._positionY=r._positionY,n._positionZ=r._positionZ,n._rotation00=r._rotation00,n._rotation01=r._rotation01,n._rotation02=r._rotation02,n._rotation10=r._rotation10,n._rotation11=r._rotation11,n._rotation12=r._rotation12,n._rotation20=r._rotation20,n._rotation21=r._rotation21,n._rotation22=r._rotation22,this._type=e.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=e.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=e.linearDamping,this._angularDamping=e.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._rotFactor=new oimo_common_Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null};oimo_dynamics_rigidbody_RigidBody.prototype={_integrate:function(_t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var t=(e=this._velX*_t)*e+(et=this._velY*_t)*et+(rt=this._velZ*_t)*rt,r=(lt=this._angVelX*_t)*lt+(ct=this._angVelY*_t)*ct+(pt=this._angVelZ*_t)*pt,e,et,rt,lt,ct,pt;if(0==t&&0==r)return;if(t>oimo_common_Setting.maxTranslationPerStep*oimo_common_Setting.maxTranslationPerStep){var mt=oimo_common_Setting.maxTranslationPerStep/Math.sqrt(t);this._velX*=mt,this._velY*=mt,this._velZ*=mt,e*=mt,et*=mt,rt*=mt}if(r>oimo_common_Setting.maxRotationPerStep*oimo_common_Setting.maxRotationPerStep){var h=oimo_common_Setting.maxRotationPerStep/Math.sqrt(r);this._angVelX*=h,this._angVelY*=h,this._angVelZ*=h,lt*=h,ct*=h,pt*=h}this._transform._positionX+=e,this._transform._positionY+=et,this._transform._positionZ+=rt;var l=Math.sqrt(lt*lt+ct*ct+pt*pt),g=.5*l,M,bt,xt,dt,yt,ft,gt,vt,Xt,ut;if(.5>g){var zt=g*g;M=.5*(1-.16666666666666666*zt+.008333333333333333*(zt*zt)),bt=1-.5*zt+.041666666666666664*(zt*zt)}else M=Math.sin(g)/l,bt=Math.cos(g);xt=lt*M,dt=ct*M,yt=pt*M,ft=bt;var X=this._transform._rotation00,Y=this._transform._rotation11,Z=this._transform._rotation22,I=X+Y+Z,V;0<I?(ut=.5*(V=Math.sqrt(I+1)),V=.5/V,gt=(this._transform._rotation21-this._transform._rotation12)*V,vt=(this._transform._rotation02-this._transform._rotation20)*V,Xt=(this._transform._rotation10-this._transform._rotation01)*V):X>Y?X>Z?(gt=.5*(V=Math.sqrt(X-Y-Z+1)),V=.5/V,vt=(this._transform._rotation01+this._transform._rotation10)*V,Xt=(this._transform._rotation02+this._transform._rotation20)*V,ut=(this._transform._rotation21-this._transform._rotation12)*V):(Xt=.5*(V=Math.sqrt(Z-X-Y+1)),V=.5/V,gt=(this._transform._rotation02+this._transform._rotation20)*V,vt=(this._transform._rotation12+this._transform._rotation21)*V,ut=(this._transform._rotation10-this._transform._rotation01)*V):Y>Z?(vt=.5*(V=Math.sqrt(Y-Z-X+1)),V=.5/V,gt=(this._transform._rotation01+this._transform._rotation10)*V,Xt=(this._transform._rotation12+this._transform._rotation21)*V,ut=(this._transform._rotation02-this._transform._rotation20)*V):(Xt=.5*(V=Math.sqrt(Z-X-Y+1)),V=.5/V,gt=(this._transform._rotation02+this._transform._rotation20)*V,vt=(this._transform._rotation12+this._transform._rotation21)*V,ut=(this._transform._rotation10-this._transform._rotation01)*V);var Yt=(gt=ft*gt+xt*ut+dt*Xt-yt*vt)*gt+(vt=ft*vt-xt*Xt+dt*ut+yt*gt)*vt+(Xt=ft*Xt+xt*vt-dt*gt+yt*ut)*Xt+(ut=ft*ut-xt*gt-dt*vt-yt*Xt)*ut;1e-32<Yt&&(Yt=1/Math.sqrt(Yt)),gt*=Yt,vt*=Yt,Xt*=Yt,ut*=Yt;var Zt=2*gt,W=2*vt,U=2*Xt,H=gt*Zt,Q=vt*W,$=Xt*U,K=gt*W,tt=vt*U,it=gt*U,ot=ut*Zt,at=ut*W,nt=ut*U,st,It,Mt,ht,Vt,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et,jt;this._transform._rotation00=1-Q-$,this._transform._rotation01=K-nt,this._transform._rotation02=it+at,this._transform._rotation10=K+nt,this._transform._rotation11=1-H-$,this._transform._rotation12=tt-ot,this._transform._rotation20=it-at,this._transform._rotation21=tt+ot,this._transform._rotation22=1-H-Q,st=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,It=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Mt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,ht=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Vt=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Lt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Bt=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,kt=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,At=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=st,this._invInertia01=It,this._invInertia02=Mt,this._invInertia10=ht,this._invInertia11=Vt,this._invInertia12=Lt,this._invInertia20=Bt,this._invInertia21=kt,this._invInertia22=At,Pt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,Tt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,wt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,St=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Ct=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,qt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Rt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Et=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,jt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Pt,this._invInertia01=Tt,this._invInertia02=wt,this._invInertia10=St,this._invInertia11=Ct,this._invInertia12=qt,this._invInertia20=Rt,this._invInertia21=Et,this._invInertia22=jt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;}},_integratePseudoVelocity:function(){var at=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,t=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(0!=at||0!=t)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var i,nt,_t,et,rt,st;i=this._pseudoVelX,nt=this._pseudoVelY,_t=this._pseudoVelZ,et=this._angPseudoVelX,rt=this._angPseudoVelY,st=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=i,this._transform._positionY+=nt,this._transform._positionZ+=_t;var lt=Math.sqrt(et*et+rt*rt+st*st),d=.5*lt,x,ct,pt,mt,bt,xt,dt,yt,ft,gt;if(.5>d){var vt=d*d;x=.5*(1-.16666666666666666*vt+.008333333333333333*(vt*vt)),ct=1-.5*vt+.041666666666666664*(vt*vt)}else x=Math.sin(d)/lt,ct=Math.cos(d);pt=et*x,mt=rt*x,bt=st*x,xt=ct;var u=this._transform._rotation00,M=this._transform._rotation11,X=this._transform._rotation22,z=u+M+X,Y;0<z?(gt=.5*(Y=Math.sqrt(z+1)),Y=.5/Y,dt=(this._transform._rotation21-this._transform._rotation12)*Y,yt=(this._transform._rotation02-this._transform._rotation20)*Y,ft=(this._transform._rotation10-this._transform._rotation01)*Y):u>M?u>X?(dt=.5*(Y=Math.sqrt(u-M-X+1)),Y=.5/Y,yt=(this._transform._rotation01+this._transform._rotation10)*Y,ft=(this._transform._rotation02+this._transform._rotation20)*Y,gt=(this._transform._rotation21-this._transform._rotation12)*Y):(ft=.5*(Y=Math.sqrt(X-u-M+1)),Y=.5/Y,dt=(this._transform._rotation02+this._transform._rotation20)*Y,yt=(this._transform._rotation12+this._transform._rotation21)*Y,gt=(this._transform._rotation10-this._transform._rotation01)*Y):M>X?(yt=.5*(Y=Math.sqrt(M-X-u+1)),Y=.5/Y,dt=(this._transform._rotation01+this._transform._rotation10)*Y,ft=(this._transform._rotation12+this._transform._rotation21)*Y,gt=(this._transform._rotation02-this._transform._rotation20)*Y):(ft=.5*(Y=Math.sqrt(X-u-M+1)),Y=.5/Y,dt=(this._transform._rotation02+this._transform._rotation20)*Y,yt=(this._transform._rotation12+this._transform._rotation21)*Y,gt=(this._transform._rotation10-this._transform._rotation01)*Y);var Xt=(dt=xt*dt+pt*gt+mt*ft-bt*yt)*dt+(yt=xt*yt-pt*ft+mt*gt+bt*dt)*yt+(ft=xt*ft+pt*yt-mt*dt+bt*gt)*ft+(gt=xt*gt-pt*dt-mt*yt-bt*ft)*gt;1e-32<Xt&&(Xt=1/Math.sqrt(Xt)),dt*=Xt,yt*=Xt,ft*=Xt,gt*=Xt;var ut=2*dt,N=2*yt,G=2*ft,O=dt*ut,W=yt*N,U=ft*G,H=dt*N,Q=yt*G,$=dt*G,K=gt*ut,tt=gt*N,it=gt*G,ot,zt,Yt,Zt,It,Mt,ht,Vt,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt;this._transform._rotation00=1-W-U,this._transform._rotation01=H-it,this._transform._rotation02=$+tt,this._transform._rotation10=H+it,this._transform._rotation11=1-O-U,this._transform._rotation12=Q-K,this._transform._rotation20=$-tt,this._transform._rotation21=Q+K,this._transform._rotation22=1-O-W,ot=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,zt=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Yt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Zt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,It=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Mt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,ht=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,Vt=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,Lt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=ot,this._invInertia01=zt,this._invInertia02=Yt,this._invInertia10=Zt,this._invInertia11=It,this._invInertia12=Mt,this._invInertia20=ht,this._invInertia21=Vt,this._invInertia22=Lt,Bt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,kt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,At=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Pt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Tt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,wt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,St=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Ct=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,qt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Bt,this._invInertia01=kt,this._invInertia02=At,this._invInertia10=Pt,this._invInertia11=Tt,this._invInertia12=wt,this._invInertia20=St,this._invInertia21=Ct,this._invInertia22=qt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;}},updateMass:function(){var xt,dt,ft,gt,Xt,ut,zt,Yt,Zt;xt=0,dt=0,ft=0,gt=0,Xt=0,ut=0,zt=0,Yt=0,Zt=0;for(var It=0,Mt=this._shapeList;null!=Mt;){var Vt=Mt._next,c=Mt._geom;c._updateMass();var m=Mt._density*c._volume,k,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et,jt,Nt,Ft,Dt,Wt,Gt;Ct=Mt._localTransform._rotation00*c._inertiaCoeff00+Mt._localTransform._rotation01*c._inertiaCoeff10+Mt._localTransform._rotation02*c._inertiaCoeff20,Lt=Mt._localTransform._rotation00*c._inertiaCoeff01+Mt._localTransform._rotation01*c._inertiaCoeff11+Mt._localTransform._rotation02*c._inertiaCoeff21,Bt=Mt._localTransform._rotation00*c._inertiaCoeff02+Mt._localTransform._rotation01*c._inertiaCoeff12+Mt._localTransform._rotation02*c._inertiaCoeff22,kt=Mt._localTransform._rotation10*c._inertiaCoeff00+Mt._localTransform._rotation11*c._inertiaCoeff10+Mt._localTransform._rotation12*c._inertiaCoeff20,At=Mt._localTransform._rotation10*c._inertiaCoeff01+Mt._localTransform._rotation11*c._inertiaCoeff11+Mt._localTransform._rotation12*c._inertiaCoeff21,Pt=Mt._localTransform._rotation10*c._inertiaCoeff02+Mt._localTransform._rotation11*c._inertiaCoeff12+Mt._localTransform._rotation12*c._inertiaCoeff22,Tt=Mt._localTransform._rotation20*c._inertiaCoeff00+Mt._localTransform._rotation21*c._inertiaCoeff10+Mt._localTransform._rotation22*c._inertiaCoeff20,wt=Mt._localTransform._rotation20*c._inertiaCoeff01+Mt._localTransform._rotation21*c._inertiaCoeff11+Mt._localTransform._rotation22*c._inertiaCoeff21,St=Mt._localTransform._rotation20*c._inertiaCoeff02+Mt._localTransform._rotation21*c._inertiaCoeff12+Mt._localTransform._rotation22*c._inertiaCoeff22,qt=(k=Ct)*Mt._localTransform._rotation00+Lt*Mt._localTransform._rotation01+Bt*Mt._localTransform._rotation02,Rt=k*Mt._localTransform._rotation10+Lt*Mt._localTransform._rotation11+Bt*Mt._localTransform._rotation12,Et=k*Mt._localTransform._rotation20+Lt*Mt._localTransform._rotation21+Bt*Mt._localTransform._rotation22,jt=kt*Mt._localTransform._rotation00+At*Mt._localTransform._rotation01+Pt*Mt._localTransform._rotation02,Nt=kt*Mt._localTransform._rotation10+At*Mt._localTransform._rotation11+Pt*Mt._localTransform._rotation12,Ft=kt*Mt._localTransform._rotation20+At*Mt._localTransform._rotation21+Pt*Mt._localTransform._rotation22,Dt=Tt*Mt._localTransform._rotation00+wt*Mt._localTransform._rotation01+St*Mt._localTransform._rotation02,Wt=Tt*Mt._localTransform._rotation10+wt*Mt._localTransform._rotation11+St*Mt._localTransform._rotation12,Gt=Tt*Mt._localTransform._rotation20+wt*Mt._localTransform._rotation21+St*Mt._localTransform._rotation22,k=qt,Lt=Rt,Bt=Et,kt=jt,At=Nt,Pt=Ft,Tt=Dt,wt=Wt,St=Gt,k*=m,Lt*=m,Bt*=m,kt*=m,At*=m,Pt*=m,Tt*=m,wt*=m,St*=m;var Ot=Mt._localTransform._positionX*Mt._localTransform._positionX,A=Mt._localTransform._positionY*Mt._localTransform._positionY,P=Mt._localTransform._positionZ*Mt._localTransform._positionZ,S=-Mt._localTransform._positionX*Mt._localTransform._positionY,C=-Mt._localTransform._positionY*Mt._localTransform._positionZ,T=-Mt._localTransform._positionZ*Mt._localTransform._positionX;It+=m,xt+=k+=(A+P)*m,dt+=Lt+=S*m,ft+=Bt+=T*m,gt+=kt+=S*m,Xt+=At+=(Ot+P)*m,ut+=Pt+=C*m,zt+=Tt+=T*m,Yt+=wt+=C*m,Zt+=St+=(Ot+A)*m,Mt=Vt}this._mass=It,this._localInertia00=xt,this._localInertia01=dt,this._localInertia02=ft,this._localInertia10=gt,this._localInertia11=Xt,this._localInertia12=ut,this._localInertia20=zt,this._localInertia21=Yt,this._localInertia22=Zt;var j=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,at=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,nt=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,st=this._localInertia00*j-this._localInertia01*at+this._localInertia02*nt,_t,Ht,Jt,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo,ro,so,lo,co;if(0<this._mass&&0<st&&0==this._type){this._invMass=1/this._mass;var po=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,rt=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,et=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,ht=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,lt=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,ct=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,mt=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,pt=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,vt=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,yt=this._localInertia00*po-this._localInertia01*rt+this._localInertia02*et;(-1e-32>yt||1e-32<yt)&&(yt=1/yt),this._invLocalInertia00=po*yt,this._invLocalInertia01=-ht*yt,this._invLocalInertia02=mt*yt,this._invLocalInertia10=-rt*yt,this._invLocalInertia11=lt*yt,this._invLocalInertia12=-pt*yt,this._invLocalInertia20=et*yt,this._invLocalInertia21=-ct*yt,this._invLocalInertia22=vt*yt,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);_t=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Ht=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Jt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Ut=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Qt=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Kt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,$t=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,to=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,oo=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=_t,this._invInertia01=Ht,this._invInertia02=Jt,this._invInertia10=Ut,this._invInertia11=Qt,this._invInertia12=Kt,this._invInertia20=$t,this._invInertia21=to,this._invInertia22=oo,ao=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,io=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,no=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,_o=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,eo=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,ro=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,so=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,lo=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,co=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ao,this._invInertia01=io,this._invInertia02=no,this._invInertia10=_o,this._invInertia11=eo,this._invInertia12=ro,this._invInertia20=so,this._invInertia21=lo,this._invInertia22=co,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getPosition:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,o},getPositionTo:function(o){var t=o;t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ},setPosition:function(W){var t=W;this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;var i=this._ptransform,o=this._transform;i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22;for(var a=this._shapeList;null!=a;){var G=a._next,f=a._ptransform,d=a._localTransform,x=this._ptransform,u,O,H,U,Q,K,$,tt,ot,at,it,nt;u=x._rotation00*d._rotation00+x._rotation01*d._rotation10+x._rotation02*d._rotation20,O=x._rotation00*d._rotation01+x._rotation01*d._rotation11+x._rotation02*d._rotation21,H=x._rotation00*d._rotation02+x._rotation01*d._rotation12+x._rotation02*d._rotation22,U=x._rotation10*d._rotation00+x._rotation11*d._rotation10+x._rotation12*d._rotation20,Q=x._rotation10*d._rotation01+x._rotation11*d._rotation11+x._rotation12*d._rotation21,K=x._rotation10*d._rotation02+x._rotation11*d._rotation12+x._rotation12*d._rotation22,$=x._rotation20*d._rotation00+x._rotation21*d._rotation10+x._rotation22*d._rotation20,tt=x._rotation20*d._rotation01+x._rotation21*d._rotation11+x._rotation22*d._rotation21,ot=x._rotation20*d._rotation02+x._rotation21*d._rotation12+x._rotation22*d._rotation22,f._rotation00=u,f._rotation01=O,f._rotation02=H,f._rotation10=U,f._rotation11=Q,f._rotation12=K,f._rotation20=$,f._rotation21=tt,f._rotation22=ot,at=x._rotation00*d._positionX+x._rotation01*d._positionY+x._rotation02*d._positionZ,it=x._rotation10*d._positionX+x._rotation11*d._positionY+x._rotation12*d._positionZ,nt=x._rotation20*d._positionX+x._rotation21*d._positionY+x._rotation22*d._positionZ,f._positionX=at,f._positionY=it,f._positionZ=nt,f._positionX+=x._positionX,f._positionY+=x._positionY,f._positionZ+=x._positionZ;var _t=a._transform,R=a._localTransform,q=this._transform,E,et,rt,st,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt;if(E=q._rotation00*R._rotation00+q._rotation01*R._rotation10+q._rotation02*R._rotation20,et=q._rotation00*R._rotation01+q._rotation01*R._rotation11+q._rotation02*R._rotation21,rt=q._rotation00*R._rotation02+q._rotation01*R._rotation12+q._rotation02*R._rotation22,st=q._rotation10*R._rotation00+q._rotation11*R._rotation10+q._rotation12*R._rotation20,lt=q._rotation10*R._rotation01+q._rotation11*R._rotation11+q._rotation12*R._rotation21,ct=q._rotation10*R._rotation02+q._rotation11*R._rotation12+q._rotation12*R._rotation22,pt=q._rotation20*R._rotation00+q._rotation21*R._rotation10+q._rotation22*R._rotation20,mt=q._rotation20*R._rotation01+q._rotation21*R._rotation11+q._rotation22*R._rotation21,bt=q._rotation20*R._rotation02+q._rotation21*R._rotation12+q._rotation22*R._rotation22,_t._rotation00=E,_t._rotation01=et,_t._rotation02=rt,_t._rotation10=st,_t._rotation11=lt,_t._rotation12=ct,_t._rotation20=pt,_t._rotation21=mt,_t._rotation22=bt,xt=q._rotation00*R._positionX+q._rotation01*R._positionY+q._rotation02*R._positionZ,dt=q._rotation10*R._positionX+q._rotation11*R._positionY+q._rotation12*R._positionZ,yt=q._rotation20*R._positionX+q._rotation21*R._positionY+q._rotation22*R._positionZ,_t._positionX=xt,_t._positionY=dt,_t._positionZ=yt,_t._positionX+=q._positionX,_t._positionY+=q._positionY,_t._positionZ+=q._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),ft=a._aabb._minX,gt=a._aabb._minY,vt=a._aabb._minZ,Xt=a._aabb._maxX,ut=a._aabb._maxY,zt=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=ft<a._aabb._minX?ft:a._aabb._minX,a._aabb._minY=gt<a._aabb._minY?gt:a._aabb._minY,a._aabb._minZ=vt<a._aabb._minZ?vt:a._aabb._minZ,a._aabb._maxX=Xt>a._aabb._maxX?Xt:a._aabb._maxX,a._aabb._maxY=ut>a._aabb._maxY?ut:a._aabb._maxY,a._aabb._maxZ=zt>a._aabb._maxZ?zt:a._aabb._maxZ,null!=a._proxy){var Yt,Zt,It;Yt=a._transform._positionX-a._ptransform._positionX,Zt=a._transform._positionY-a._ptransform._positionY,It=a._transform._positionZ-a._ptransform._positionZ;var Mt=a.displacement;Mt.x=Yt,Mt.y=Zt,Mt.z=It,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=G}this._sleeping=!1,this._sleepTime=0},translate:function(H){var t=H,n,U,Q;n=t.x,U=t.y,Q=t.z,this._transform._positionX+=n,this._transform._positionY+=U,this._transform._positionZ+=Q;var K=this._ptransform,s=this._transform;K._positionX=s._positionX,K._positionY=s._positionY,K._positionZ=s._positionZ,K._rotation00=s._rotation00,K._rotation01=s._rotation01,K._rotation02=s._rotation02,K._rotation10=s._rotation10,K._rotation11=s._rotation11,K._rotation12=s._rotation12,K._rotation20=s._rotation20,K._rotation21=s._rotation21,K._rotation22=s._rotation22;for(var _=this._shapeList;null!=_;){var $=_._next,u=_._ptransform,g=_._localTransform,M=this._ptransform,X,tt,ot,at,it,nt,_t,et,rt,st,lt,ct;X=M._rotation00*g._rotation00+M._rotation01*g._rotation10+M._rotation02*g._rotation20,tt=M._rotation00*g._rotation01+M._rotation01*g._rotation11+M._rotation02*g._rotation21,ot=M._rotation00*g._rotation02+M._rotation01*g._rotation12+M._rotation02*g._rotation22,at=M._rotation10*g._rotation00+M._rotation11*g._rotation10+M._rotation12*g._rotation20,it=M._rotation10*g._rotation01+M._rotation11*g._rotation11+M._rotation12*g._rotation21,nt=M._rotation10*g._rotation02+M._rotation11*g._rotation12+M._rotation12*g._rotation22,_t=M._rotation20*g._rotation00+M._rotation21*g._rotation10+M._rotation22*g._rotation20,et=M._rotation20*g._rotation01+M._rotation21*g._rotation11+M._rotation22*g._rotation21,rt=M._rotation20*g._rotation02+M._rotation21*g._rotation12+M._rotation22*g._rotation22,u._rotation00=X,u._rotation01=tt,u._rotation02=ot,u._rotation10=at,u._rotation11=it,u._rotation12=nt,u._rotation20=_t,u._rotation21=et,u._rotation22=rt,st=M._rotation00*g._positionX+M._rotation01*g._positionY+M._rotation02*g._positionZ,lt=M._rotation10*g._positionX+M._rotation11*g._positionY+M._rotation12*g._positionZ,ct=M._rotation20*g._positionX+M._rotation21*g._positionY+M._rotation22*g._positionZ,u._positionX=st,u._positionY=lt,u._positionZ=ct,u._positionX+=M._positionX,u._positionY+=M._positionY,u._positionZ+=M._positionZ;var pt=_._transform,D=_._localTransform,J=this._transform,F,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt,ht,Vt;if(F=J._rotation00*D._rotation00+J._rotation01*D._rotation10+J._rotation02*D._rotation20,mt=J._rotation00*D._rotation01+J._rotation01*D._rotation11+J._rotation02*D._rotation21,bt=J._rotation00*D._rotation02+J._rotation01*D._rotation12+J._rotation02*D._rotation22,xt=J._rotation10*D._rotation00+J._rotation11*D._rotation10+J._rotation12*D._rotation20,dt=J._rotation10*D._rotation01+J._rotation11*D._rotation11+J._rotation12*D._rotation21,yt=J._rotation10*D._rotation02+J._rotation11*D._rotation12+J._rotation12*D._rotation22,ft=J._rotation20*D._rotation00+J._rotation21*D._rotation10+J._rotation22*D._rotation20,gt=J._rotation20*D._rotation01+J._rotation21*D._rotation11+J._rotation22*D._rotation21,vt=J._rotation20*D._rotation02+J._rotation21*D._rotation12+J._rotation22*D._rotation22,pt._rotation00=F,pt._rotation01=mt,pt._rotation02=bt,pt._rotation10=xt,pt._rotation11=dt,pt._rotation12=yt,pt._rotation20=ft,pt._rotation21=gt,pt._rotation22=vt,Xt=J._rotation00*D._positionX+J._rotation01*D._positionY+J._rotation02*D._positionZ,ut=J._rotation10*D._positionX+J._rotation11*D._positionY+J._rotation12*D._positionZ,zt=J._rotation20*D._positionX+J._rotation21*D._positionY+J._rotation22*D._positionZ,pt._positionX=Xt,pt._positionY=ut,pt._positionZ=zt,pt._positionX+=J._positionX,pt._positionY+=J._positionY,pt._positionZ+=J._positionZ,_._geom._computeAabb(_._aabb,_._ptransform),Yt=_._aabb._minX,Zt=_._aabb._minY,It=_._aabb._minZ,Mt=_._aabb._maxX,ht=_._aabb._maxY,Vt=_._aabb._maxZ,_._geom._computeAabb(_._aabb,_._transform),_._aabb._minX=Yt<_._aabb._minX?Yt:_._aabb._minX,_._aabb._minY=Zt<_._aabb._minY?Zt:_._aabb._minY,_._aabb._minZ=It<_._aabb._minZ?It:_._aabb._minZ,_._aabb._maxX=Mt>_._aabb._maxX?Mt:_._aabb._maxX,_._aabb._maxY=ht>_._aabb._maxY?ht:_._aabb._maxY,_._aabb._maxZ=Vt>_._aabb._maxZ?Vt:_._aabb._maxZ,null!=_._proxy){var Lt,Bt,kt;Lt=_._transform._positionX-_._ptransform._positionX,Bt=_._transform._positionY-_._ptransform._positionY,kt=_._transform._positionZ-_._ptransform._positionZ;var At=_.displacement;At.x=Lt,At.y=Bt,At.z=kt,_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=$}this._sleeping=!1,this._sleepTime=0},getRotation:function(){var o=new oimo_common_Mat3,t=o;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,o},getRotationTo:function(o){var t=o;t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22},setRotation:function(lt){var t=lt,x,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22,x=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ct=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,pt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,mt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,bt=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,xt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,dt=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,yt=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,ft=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=x,this._invInertia01=ct,this._invInertia02=pt,this._invInertia10=mt,this._invInertia11=bt,this._invInertia12=xt,this._invInertia20=dt,this._invInertia21=yt,this._invInertia22=ft,gt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,vt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Xt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ut=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,zt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Yt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Zt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,It=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Mt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=gt,this._invInertia01=vt,this._invInertia02=Xt,this._invInertia10=ut,this._invInertia11=zt,this._invInertia12=Yt,this._invInertia20=Zt,this._invInertia21=It,this._invInertia22=Mt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var Vt=this._ptransform,u=this._transform;Vt._positionX=u._positionX,Vt._positionY=u._positionY,Vt._positionZ=u._positionZ,Vt._rotation00=u._rotation00,Vt._rotation01=u._rotation01,Vt._rotation02=u._rotation02,Vt._rotation10=u._rotation10,Vt._rotation11=u._rotation11,Vt._rotation12=u._rotation12,Vt._rotation20=u._rotation20,Vt._rotation21=u._rotation21,Vt._rotation22=u._rotation22;for(var g=this._shapeList;null!=g;){var Lt=g._next,S=g._ptransform,C=g._localTransform,T=this._ptransform,j,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et;j=T._rotation00*C._rotation00+T._rotation01*C._rotation10+T._rotation02*C._rotation20,Bt=T._rotation00*C._rotation01+T._rotation01*C._rotation11+T._rotation02*C._rotation21,kt=T._rotation00*C._rotation02+T._rotation01*C._rotation12+T._rotation02*C._rotation22,At=T._rotation10*C._rotation00+T._rotation11*C._rotation10+T._rotation12*C._rotation20,Pt=T._rotation10*C._rotation01+T._rotation11*C._rotation11+T._rotation12*C._rotation21,Tt=T._rotation10*C._rotation02+T._rotation11*C._rotation12+T._rotation12*C._rotation22,wt=T._rotation20*C._rotation00+T._rotation21*C._rotation10+T._rotation22*C._rotation20,St=T._rotation20*C._rotation01+T._rotation21*C._rotation11+T._rotation22*C._rotation21,Ct=T._rotation20*C._rotation02+T._rotation21*C._rotation12+T._rotation22*C._rotation22,S._rotation00=j,S._rotation01=Bt,S._rotation02=kt,S._rotation10=At,S._rotation11=Pt,S._rotation12=Tt,S._rotation20=wt,S._rotation21=St,S._rotation22=Ct,qt=T._rotation00*C._positionX+T._rotation01*C._positionY+T._rotation02*C._positionZ,Rt=T._rotation10*C._positionX+T._rotation11*C._positionY+T._rotation12*C._positionZ,Et=T._rotation20*C._positionX+T._rotation21*C._positionY+T._rotation22*C._positionZ,S._positionX=qt,S._positionY=Rt,S._positionZ=Et,S._positionX+=T._positionX,S._positionY+=T._positionY,S._positionZ+=T._positionZ;var jt=g._transform,at=g._localTransform,nt=this._transform,st,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt,$t,to,oo,ao,io,no;if(st=nt._rotation00*at._rotation00+nt._rotation01*at._rotation10+nt._rotation02*at._rotation20,Nt=nt._rotation00*at._rotation01+nt._rotation01*at._rotation11+nt._rotation02*at._rotation21,Ft=nt._rotation00*at._rotation02+nt._rotation01*at._rotation12+nt._rotation02*at._rotation22,Dt=nt._rotation10*at._rotation00+nt._rotation11*at._rotation10+nt._rotation12*at._rotation20,Wt=nt._rotation10*at._rotation01+nt._rotation11*at._rotation11+nt._rotation12*at._rotation21,Gt=nt._rotation10*at._rotation02+nt._rotation11*at._rotation12+nt._rotation12*at._rotation22,Ot=nt._rotation20*at._rotation00+nt._rotation21*at._rotation10+nt._rotation22*at._rotation20,Ht=nt._rotation20*at._rotation01+nt._rotation21*at._rotation11+nt._rotation22*at._rotation21,Jt=nt._rotation20*at._rotation02+nt._rotation21*at._rotation12+nt._rotation22*at._rotation22,jt._rotation00=st,jt._rotation01=Nt,jt._rotation02=Ft,jt._rotation10=Dt,jt._rotation11=Wt,jt._rotation12=Gt,jt._rotation20=Ot,jt._rotation21=Ht,jt._rotation22=Jt,Ut=nt._rotation00*at._positionX+nt._rotation01*at._positionY+nt._rotation02*at._positionZ,Qt=nt._rotation10*at._positionX+nt._rotation11*at._positionY+nt._rotation12*at._positionZ,Kt=nt._rotation20*at._positionX+nt._rotation21*at._positionY+nt._rotation22*at._positionZ,jt._positionX=Ut,jt._positionY=Qt,jt._positionZ=Kt,jt._positionX+=nt._positionX,jt._positionY+=nt._positionY,jt._positionZ+=nt._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),$t=g._aabb._minX,to=g._aabb._minY,oo=g._aabb._minZ,ao=g._aabb._maxX,io=g._aabb._maxY,no=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=$t<g._aabb._minX?$t:g._aabb._minX,g._aabb._minY=to<g._aabb._minY?to:g._aabb._minY,g._aabb._minZ=oo<g._aabb._minZ?oo:g._aabb._minZ,g._aabb._maxX=ao>g._aabb._maxX?ao:g._aabb._maxX,g._aabb._maxY=io>g._aabb._maxY?io:g._aabb._maxY,g._aabb._maxZ=no>g._aabb._maxZ?no:g._aabb._maxZ,null!=g._proxy){var _o,eo,ro;_o=g._transform._positionX-g._ptransform._positionX,eo=g._transform._positionY-g._ptransform._positionY,ro=g._transform._positionZ-g._ptransform._positionZ;var so=g.displacement;so.x=_o,so.y=eo,so.z=ro,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=Lt}this._sleeping=!1,this._sleepTime=0},setRotationXyz:function(xt){var t=xt,n,gt,Xt;n=t.x,gt=t.y,Xt=t.z;var ut=Math.sin(n),X=Math.sin(gt),z=Math.sin(Xt),Y=Math.cos(n),Z=Math.cos(gt),I=Math.cos(Xt),V,zt,Yt,Zt,It,Mt,Vt,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt;this._transform._rotation00=Z*I,this._transform._rotation01=-Z*z,this._transform._rotation02=X,this._transform._rotation10=Y*z+I*ut*X,this._transform._rotation11=Y*I-ut*X*z,this._transform._rotation12=-Z*ut,this._transform._rotation20=ut*z-Y*I*X,this._transform._rotation21=I*ut+Y*X*z,this._transform._rotation22=Y*Z,V=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,zt=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Yt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Zt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,It=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Mt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Vt=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,Lt=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,Bt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=V,this._invInertia01=zt,this._invInertia02=Yt,this._invInertia10=Zt,this._invInertia11=It,this._invInertia12=Mt,this._invInertia20=Vt,this._invInertia21=Lt,this._invInertia22=Bt,kt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,At=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Pt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Tt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,wt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,St=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Ct=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,qt=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Rt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=kt,this._invInertia01=At,this._invInertia02=Pt,this._invInertia10=Tt,this._invInertia11=wt,this._invInertia12=St,this._invInertia20=Ct,this._invInertia21=qt,this._invInertia22=Rt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var Et=this._ptransform,L=this._transform;Et._positionX=L._positionX,Et._positionY=L._positionY,Et._positionZ=L._positionZ,Et._rotation00=L._rotation00,Et._rotation01=L._rotation01,Et._rotation02=L._rotation02,Et._rotation10=L._rotation10,Et._rotation11=L._rotation11,Et._rotation12=L._rotation12,Et._rotation20=L._rotation20,Et._rotation21=L._rotation21,Et._rotation22=L._rotation22;for(var w=this._shapeList;null!=w;){var jt=w._next,F=w._ptransform,N=w._localTransform,G=this._ptransform,O,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt;O=G._rotation00*N._rotation00+G._rotation01*N._rotation10+G._rotation02*N._rotation20,Nt=G._rotation00*N._rotation01+G._rotation01*N._rotation11+G._rotation02*N._rotation21,Ft=G._rotation00*N._rotation02+G._rotation01*N._rotation12+G._rotation02*N._rotation22,Dt=G._rotation10*N._rotation00+G._rotation11*N._rotation10+G._rotation12*N._rotation20,Wt=G._rotation10*N._rotation01+G._rotation11*N._rotation11+G._rotation12*N._rotation21,Gt=G._rotation10*N._rotation02+G._rotation11*N._rotation12+G._rotation12*N._rotation22,Ot=G._rotation20*N._rotation00+G._rotation21*N._rotation10+G._rotation22*N._rotation20,Ht=G._rotation20*N._rotation01+G._rotation21*N._rotation11+G._rotation22*N._rotation21,Jt=G._rotation20*N._rotation02+G._rotation21*N._rotation12+G._rotation22*N._rotation22,F._rotation00=O,F._rotation01=Nt,F._rotation02=Ft,F._rotation10=Dt,F._rotation11=Wt,F._rotation12=Gt,F._rotation20=Ot,F._rotation21=Ht,F._rotation22=Jt,Ut=G._rotation00*N._positionX+G._rotation01*N._positionY+G._rotation02*N._positionZ,Qt=G._rotation10*N._positionX+G._rotation11*N._positionY+G._rotation12*N._positionZ,Kt=G._rotation20*N._positionX+G._rotation21*N._positionY+G._rotation22*N._positionZ,F._positionX=Ut,F._positionY=Qt,F._positionZ=Kt,F._positionX+=G._positionX,F._positionY+=G._positionY,F._positionZ+=G._positionZ;var $t=w._transform,mt=w._localTransform,pt=this._transform,vt,to,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo;if(vt=pt._rotation00*mt._rotation00+pt._rotation01*mt._rotation10+pt._rotation02*mt._rotation20,to=pt._rotation00*mt._rotation01+pt._rotation01*mt._rotation11+pt._rotation02*mt._rotation21,oo=pt._rotation00*mt._rotation02+pt._rotation01*mt._rotation12+pt._rotation02*mt._rotation22,ao=pt._rotation10*mt._rotation00+pt._rotation11*mt._rotation10+pt._rotation12*mt._rotation20,io=pt._rotation10*mt._rotation01+pt._rotation11*mt._rotation11+pt._rotation12*mt._rotation21,no=pt._rotation10*mt._rotation02+pt._rotation11*mt._rotation12+pt._rotation12*mt._rotation22,_o=pt._rotation20*mt._rotation00+pt._rotation21*mt._rotation10+pt._rotation22*mt._rotation20,eo=pt._rotation20*mt._rotation01+pt._rotation21*mt._rotation11+pt._rotation22*mt._rotation21,ro=pt._rotation20*mt._rotation02+pt._rotation21*mt._rotation12+pt._rotation22*mt._rotation22,$t._rotation00=vt,$t._rotation01=to,$t._rotation02=oo,$t._rotation10=ao,$t._rotation11=io,$t._rotation12=no,$t._rotation20=_o,$t._rotation21=eo,$t._rotation22=ro,so=pt._rotation00*mt._positionX+pt._rotation01*mt._positionY+pt._rotation02*mt._positionZ,lo=pt._rotation10*mt._positionX+pt._rotation11*mt._positionY+pt._rotation12*mt._positionZ,co=pt._rotation20*mt._positionX+pt._rotation21*mt._positionY+pt._rotation22*mt._positionZ,$t._positionX=so,$t._positionY=lo,$t._positionZ=co,$t._positionX+=pt._positionX,$t._positionY+=pt._positionY,$t._positionZ+=pt._positionZ,w._geom._computeAabb(w._aabb,w._ptransform),po=w._aabb._minX,mo=w._aabb._minY,bo=w._aabb._minZ,xo=w._aabb._maxX,yo=w._aabb._maxY,fo=w._aabb._maxZ,w._geom._computeAabb(w._aabb,w._transform),w._aabb._minX=po<w._aabb._minX?po:w._aabb._minX,w._aabb._minY=mo<w._aabb._minY?mo:w._aabb._minY,w._aabb._minZ=bo<w._aabb._minZ?bo:w._aabb._minZ,w._aabb._maxX=xo>w._aabb._maxX?xo:w._aabb._maxX,w._aabb._maxY=yo>w._aabb._maxY?yo:w._aabb._maxY,w._aabb._maxZ=fo>w._aabb._maxZ?fo:w._aabb._maxZ,null!=w._proxy){var go,vo,Xo;go=w._transform._positionX-w._ptransform._positionX,vo=w._transform._positionY-w._ptransform._positionY,Xo=w._transform._positionZ-w._ptransform._positionZ;var uo=w.displacement;uo.x=go,uo.y=vo,uo.z=Xo,w._rigidBody._world._broadPhase.moveProxy(w._proxy,w._aabb,w.displacement)}w=jt}this._sleeping=!1,this._sleepTime=0},rotate:function(Vt){var t=Vt,T,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et,jt,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo,ro,so,lo;T=t.e00,Lt=t.e01,Bt=t.e02,kt=t.e10,At=t.e11,Pt=t.e12,Tt=t.e20,wt=t.e21,St=t.e22,Ct=T*this._transform._rotation00+Lt*this._transform._rotation10+Bt*this._transform._rotation20,qt=T*this._transform._rotation01+Lt*this._transform._rotation11+Bt*this._transform._rotation21,Rt=T*this._transform._rotation02+Lt*this._transform._rotation12+Bt*this._transform._rotation22,Et=kt*this._transform._rotation00+At*this._transform._rotation10+Pt*this._transform._rotation20,jt=kt*this._transform._rotation01+At*this._transform._rotation11+Pt*this._transform._rotation21,Nt=kt*this._transform._rotation02+At*this._transform._rotation12+Pt*this._transform._rotation22,Ft=Tt*this._transform._rotation00+wt*this._transform._rotation10+St*this._transform._rotation20,Dt=Tt*this._transform._rotation01+wt*this._transform._rotation11+St*this._transform._rotation21,Wt=Tt*this._transform._rotation02+wt*this._transform._rotation12+St*this._transform._rotation22,this._transform._rotation00=Ct,this._transform._rotation01=qt,this._transform._rotation02=Rt,this._transform._rotation10=Et,this._transform._rotation11=jt,this._transform._rotation12=Nt,this._transform._rotation20=Ft,this._transform._rotation21=Dt,this._transform._rotation22=Wt,Gt=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Ot=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Ht=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Jt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Ut=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Qt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Kt=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,$t=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,to=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=Gt,this._invInertia01=Ot,this._invInertia02=Ht,this._invInertia10=Jt,this._invInertia11=Ut,this._invInertia12=Qt,this._invInertia20=Kt,this._invInertia21=$t,this._invInertia22=to,oo=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ao=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,io=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,no=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,_o=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,eo=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,ro=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,so=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,lo=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=oo,this._invInertia01=ao,this._invInertia02=io,this._invInertia10=no,this._invInertia11=_o,this._invInertia12=eo,this._invInertia20=ro,this._invInertia21=so,this._invInertia22=lo,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var co=this._ptransform,j=this._transform;co._positionX=j._positionX,co._positionY=j._positionY,co._positionZ=j._positionZ,co._rotation00=j._rotation00,co._rotation01=j._rotation01,co._rotation02=j._rotation02,co._rotation10=j._rotation10,co._rotation11=j._rotation11,co._rotation12=j._rotation12,co._rotation20=j._rotation20,co._rotation21=j._rotation21,co._rotation22=j._rotation22;for(var R=this._shapeList;null!=R;){var po=R._next,K=R._ptransform,tt=R._localTransform,it=this._ptransform,ot,mo,bo,xo,yo,fo,go,vo,Xo,uo,zo,Yo;ot=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,mo=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,bo=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,xo=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,yo=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,fo=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,go=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,vo=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,Xo=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,K._rotation00=ot,K._rotation01=mo,K._rotation02=bo,K._rotation10=xo,K._rotation11=yo,K._rotation12=fo,K._rotation20=go,K._rotation21=vo,K._rotation22=Xo,uo=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,zo=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,Yo=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,K._positionX=uo,K._positionY=zo,K._positionZ=Yo,K._positionX+=it._positionX,K._positionY+=it._positionY,K._positionZ+=it._positionZ;var Zo=R._transform,gt=R._localTransform,Mt=this._transform,Xt,Io,Mo,ho,Vo,Lo,Bo,ko,Ao,Po,To,wo,So,Co,qo,Ro,Eo,jo;if(Xt=Mt._rotation00*gt._rotation00+Mt._rotation01*gt._rotation10+Mt._rotation02*gt._rotation20,Io=Mt._rotation00*gt._rotation01+Mt._rotation01*gt._rotation11+Mt._rotation02*gt._rotation21,Mo=Mt._rotation00*gt._rotation02+Mt._rotation01*gt._rotation12+Mt._rotation02*gt._rotation22,ho=Mt._rotation10*gt._rotation00+Mt._rotation11*gt._rotation10+Mt._rotation12*gt._rotation20,Vo=Mt._rotation10*gt._rotation01+Mt._rotation11*gt._rotation11+Mt._rotation12*gt._rotation21,Lo=Mt._rotation10*gt._rotation02+Mt._rotation11*gt._rotation12+Mt._rotation12*gt._rotation22,Bo=Mt._rotation20*gt._rotation00+Mt._rotation21*gt._rotation10+Mt._rotation22*gt._rotation20,ko=Mt._rotation20*gt._rotation01+Mt._rotation21*gt._rotation11+Mt._rotation22*gt._rotation21,Ao=Mt._rotation20*gt._rotation02+Mt._rotation21*gt._rotation12+Mt._rotation22*gt._rotation22,Zo._rotation00=Xt,Zo._rotation01=Io,Zo._rotation02=Mo,Zo._rotation10=ho,Zo._rotation11=Vo,Zo._rotation12=Lo,Zo._rotation20=Bo,Zo._rotation21=ko,Zo._rotation22=Ao,Po=Mt._rotation00*gt._positionX+Mt._rotation01*gt._positionY+Mt._rotation02*gt._positionZ,To=Mt._rotation10*gt._positionX+Mt._rotation11*gt._positionY+Mt._rotation12*gt._positionZ,wo=Mt._rotation20*gt._positionX+Mt._rotation21*gt._positionY+Mt._rotation22*gt._positionZ,Zo._positionX=Po,Zo._positionY=To,Zo._positionZ=wo,Zo._positionX+=Mt._positionX,Zo._positionY+=Mt._positionY,Zo._positionZ+=Mt._positionZ,R._geom._computeAabb(R._aabb,R._ptransform),So=R._aabb._minX,Co=R._aabb._minY,qo=R._aabb._minZ,Ro=R._aabb._maxX,Eo=R._aabb._maxY,jo=R._aabb._maxZ,R._geom._computeAabb(R._aabb,R._transform),R._aabb._minX=So<R._aabb._minX?So:R._aabb._minX,R._aabb._minY=Co<R._aabb._minY?Co:R._aabb._minY,R._aabb._minZ=qo<R._aabb._minZ?qo:R._aabb._minZ,R._aabb._maxX=Ro>R._aabb._maxX?Ro:R._aabb._maxX,R._aabb._maxY=Eo>R._aabb._maxY?Eo:R._aabb._maxY,R._aabb._maxZ=jo>R._aabb._maxZ?jo:R._aabb._maxZ,null!=R._proxy){var No,Fo,Do;No=R._transform._positionX-R._ptransform._positionX,Fo=R._transform._positionY-R._ptransform._positionY,Do=R._transform._positionZ-R._ptransform._positionZ;var Wo=R.displacement;Wo.x=No,Wo.y=Fo,Wo.z=Do,R._rigidBody._world._broadPhase.moveProxy(R._proxy,R._aabb,R.displacement)}R=po}this._sleeping=!1,this._sleepTime=0},rotateXyz:function(Tt){var t=Tt,p,qt,Rt,Et,jt,Nt,Ft,Dt,Wt,Gt,Ot,Ht;p=t.x,qt=t.y,Rt=t.z;var Jt=Math.sin(p),E=Math.sin(qt),D=Math.sin(Rt),J=Math.cos(p),F=Math.cos(qt),N=Math.cos(Rt),G,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo,ro,so,lo,co,po,mo,bo,xo,yo,fo,go,vo,Xo,uo,zo;jt=-F*D,Nt=E,Ft=J*D+N*Jt*E,Dt=J*N-Jt*E*D,Wt=-F*Jt,Gt=Jt*D-J*N*E,Ot=N*Jt+J*E*D,Ht=J*F,G=(Et=F*N)*this._transform._rotation00+jt*this._transform._rotation10+Nt*this._transform._rotation20,Ut=Et*this._transform._rotation01+jt*this._transform._rotation11+Nt*this._transform._rotation21,Qt=Et*this._transform._rotation02+jt*this._transform._rotation12+Nt*this._transform._rotation22,Kt=Ft*this._transform._rotation00+Dt*this._transform._rotation10+Wt*this._transform._rotation20,$t=Ft*this._transform._rotation01+Dt*this._transform._rotation11+Wt*this._transform._rotation21,to=Ft*this._transform._rotation02+Dt*this._transform._rotation12+Wt*this._transform._rotation22,oo=Gt*this._transform._rotation00+Ot*this._transform._rotation10+Ht*this._transform._rotation20,ao=Gt*this._transform._rotation01+Ot*this._transform._rotation11+Ht*this._transform._rotation21,io=Gt*this._transform._rotation02+Ot*this._transform._rotation12+Ht*this._transform._rotation22,this._transform._rotation00=G,this._transform._rotation01=Ut,this._transform._rotation02=Qt,this._transform._rotation10=Kt,this._transform._rotation11=$t,this._transform._rotation12=to,this._transform._rotation20=oo,this._transform._rotation21=ao,this._transform._rotation22=io,no=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,_o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,eo=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,ro=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,so=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,lo=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,co=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,po=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,mo=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=no,this._invInertia01=_o,this._invInertia02=eo,this._invInertia10=ro,this._invInertia11=so,this._invInertia12=lo,this._invInertia20=co,this._invInertia21=po,this._invInertia22=mo,bo=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,xo=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,yo=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,fo=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,go=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,vo=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Xo=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,uo=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,zo=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=bo,this._invInertia01=xo,this._invInertia02=yo,this._invInertia10=fo,this._invInertia11=go,this._invInertia12=vo,this._invInertia20=Xo,this._invInertia21=uo,this._invInertia22=zo,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var Yo=this._ptransform,O=this._transform;Yo._positionX=O._positionX,Yo._positionY=O._positionY,Yo._positionZ=O._positionZ,Yo._rotation00=O._rotation00,Yo._rotation01=O._rotation01,Yo._rotation02=O._rotation02,Yo._rotation10=O._rotation10,Yo._rotation11=O._rotation11,Yo._rotation12=O._rotation12,Yo._rotation20=O._rotation20,Yo._rotation21=O._rotation21,Yo._rotation22=O._rotation22;for(var W=this._shapeList;null!=W;){var Zo=W._next,et=W._ptransform,ht=W._localTransform,lt=this._ptransform,ct,Io,Mo,ho,Vo,Lo,Bo,ko,Ao,Po,To,wo;ct=lt._rotation00*ht._rotation00+lt._rotation01*ht._rotation10+lt._rotation02*ht._rotation20,Io=lt._rotation00*ht._rotation01+lt._rotation01*ht._rotation11+lt._rotation02*ht._rotation21,Mo=lt._rotation00*ht._rotation02+lt._rotation01*ht._rotation12+lt._rotation02*ht._rotation22,ho=lt._rotation10*ht._rotation00+lt._rotation11*ht._rotation10+lt._rotation12*ht._rotation20,Vo=lt._rotation10*ht._rotation01+lt._rotation11*ht._rotation11+lt._rotation12*ht._rotation21,Lo=lt._rotation10*ht._rotation02+lt._rotation11*ht._rotation12+lt._rotation12*ht._rotation22,Bo=lt._rotation20*ht._rotation00+lt._rotation21*ht._rotation10+lt._rotation22*ht._rotation20,ko=lt._rotation20*ht._rotation01+lt._rotation21*ht._rotation11+lt._rotation22*ht._rotation21,Ao=lt._rotation20*ht._rotation02+lt._rotation21*ht._rotation12+lt._rotation22*ht._rotation22,et._rotation00=ct,et._rotation01=Io,et._rotation02=Mo,et._rotation10=ho,et._rotation11=Vo,et._rotation12=Lo,et._rotation20=Bo,et._rotation21=ko,et._rotation22=Ao,Po=lt._rotation00*ht._positionX+lt._rotation01*ht._positionY+lt._rotation02*ht._positionZ,To=lt._rotation10*ht._positionX+lt._rotation11*ht._positionY+lt._rotation12*ht._positionZ,wo=lt._rotation20*ht._positionX+lt._rotation21*ht._positionY+lt._rotation22*ht._positionZ,et._positionX=Po,et._positionY=To,et._positionZ=wo,et._positionX+=lt._positionX,et._positionY+=lt._positionY,et._positionZ+=lt._positionZ;var So=W._transform,wt=W._localTransform,Bt=this._transform,kt,Co,qo,Ro,Eo,jo,No,Fo,Do,Wo,Go,Oo,Ho,Jo,Uo,Qo,Ko,$o;if(kt=Bt._rotation00*wt._rotation00+Bt._rotation01*wt._rotation10+Bt._rotation02*wt._rotation20,Co=Bt._rotation00*wt._rotation01+Bt._rotation01*wt._rotation11+Bt._rotation02*wt._rotation21,qo=Bt._rotation00*wt._rotation02+Bt._rotation01*wt._rotation12+Bt._rotation02*wt._rotation22,Ro=Bt._rotation10*wt._rotation00+Bt._rotation11*wt._rotation10+Bt._rotation12*wt._rotation20,Eo=Bt._rotation10*wt._rotation01+Bt._rotation11*wt._rotation11+Bt._rotation12*wt._rotation21,jo=Bt._rotation10*wt._rotation02+Bt._rotation11*wt._rotation12+Bt._rotation12*wt._rotation22,No=Bt._rotation20*wt._rotation00+Bt._rotation21*wt._rotation10+Bt._rotation22*wt._rotation20,Fo=Bt._rotation20*wt._rotation01+Bt._rotation21*wt._rotation11+Bt._rotation22*wt._rotation21,Do=Bt._rotation20*wt._rotation02+Bt._rotation21*wt._rotation12+Bt._rotation22*wt._rotation22,So._rotation00=kt,So._rotation01=Co,So._rotation02=qo,So._rotation10=Ro,So._rotation11=Eo,So._rotation12=jo,So._rotation20=No,So._rotation21=Fo,So._rotation22=Do,Wo=Bt._rotation00*wt._positionX+Bt._rotation01*wt._positionY+Bt._rotation02*wt._positionZ,Go=Bt._rotation10*wt._positionX+Bt._rotation11*wt._positionY+Bt._rotation12*wt._positionZ,Oo=Bt._rotation20*wt._positionX+Bt._rotation21*wt._positionY+Bt._rotation22*wt._positionZ,So._positionX=Wo,So._positionY=Go,So._positionZ=Oo,So._positionX+=Bt._positionX,So._positionY+=Bt._positionY,So._positionZ+=Bt._positionZ,W._geom._computeAabb(W._aabb,W._ptransform),Ho=W._aabb._minX,Jo=W._aabb._minY,Uo=W._aabb._minZ,Qo=W._aabb._maxX,Ko=W._aabb._maxY,$o=W._aabb._maxZ,W._geom._computeAabb(W._aabb,W._transform),W._aabb._minX=Ho<W._aabb._minX?Ho:W._aabb._minX,W._aabb._minY=Jo<W._aabb._minY?Jo:W._aabb._minY,W._aabb._minZ=Uo<W._aabb._minZ?Uo:W._aabb._minZ,W._aabb._maxX=Qo>W._aabb._maxX?Qo:W._aabb._maxX,W._aabb._maxY=Ko>W._aabb._maxY?Ko:W._aabb._maxY,W._aabb._maxZ=$o>W._aabb._maxZ?$o:W._aabb._maxZ,null!=W._proxy){var ta,oa,aa;ta=W._transform._positionX-W._ptransform._positionX,oa=W._transform._positionY-W._ptransform._positionY,aa=W._transform._positionZ-W._ptransform._positionZ;var ia=W.displacement;ia.x=ta,ia.y=oa,ia.z=aa,W._rigidBody._world._broadPhase.moveProxy(W._proxy,W._aabb,W.displacement)}W=Zo}this._sleeping=!1,this._sleepTime=0},getOrientation:function(){var c=new oimo_common_Quat,s=this._transform._rotation00,_=this._transform._rotation11,r=this._transform._rotation22,e=s+_+r,p,m,b,x,d;0<e?(x=.5*(d=Math.sqrt(e+1)),d=.5/d,p=(this._transform._rotation21-this._transform._rotation12)*d,m=(this._transform._rotation02-this._transform._rotation20)*d,b=(this._transform._rotation10-this._transform._rotation01)*d):s>_?s>r?(p=.5*(d=Math.sqrt(s-_-r+1)),d=.5/d,m=(this._transform._rotation01+this._transform._rotation10)*d,b=(this._transform._rotation02+this._transform._rotation20)*d,x=(this._transform._rotation21-this._transform._rotation12)*d):(b=.5*(d=Math.sqrt(r-s-_+1)),d=.5/d,p=(this._transform._rotation02+this._transform._rotation20)*d,m=(this._transform._rotation12+this._transform._rotation21)*d,x=(this._transform._rotation10-this._transform._rotation01)*d):_>r?(m=.5*(d=Math.sqrt(_-r-s+1)),d=.5/d,p=(this._transform._rotation01+this._transform._rotation10)*d,b=(this._transform._rotation12+this._transform._rotation21)*d,x=(this._transform._rotation02-this._transform._rotation20)*d):(b=.5*(d=Math.sqrt(r-s-_+1)),d=.5/d,p=(this._transform._rotation02+this._transform._rotation20)*d,m=(this._transform._rotation12+this._transform._rotation21)*d,x=(this._transform._rotation10-this._transform._rotation01)*d);var y=c;return y.x=p,y.y=m,y.z=b,y.w=x,c},getOrientationTo:function(c){var t=this._transform._rotation00,_=this._transform._rotation11,r=this._transform._rotation22,e=t+_+r,p,m,b,x,d;0<e?(x=.5*(d=Math.sqrt(e+1)),d=.5/d,p=(this._transform._rotation21-this._transform._rotation12)*d,m=(this._transform._rotation02-this._transform._rotation20)*d,b=(this._transform._rotation10-this._transform._rotation01)*d):t>_?t>r?(p=.5*(d=Math.sqrt(t-_-r+1)),d=.5/d,m=(this._transform._rotation01+this._transform._rotation10)*d,b=(this._transform._rotation02+this._transform._rotation20)*d,x=(this._transform._rotation21-this._transform._rotation12)*d):(b=.5*(d=Math.sqrt(r-t-_+1)),d=.5/d,p=(this._transform._rotation02+this._transform._rotation20)*d,m=(this._transform._rotation12+this._transform._rotation21)*d,x=(this._transform._rotation10-this._transform._rotation01)*d):_>r?(m=.5*(d=Math.sqrt(_-r-t+1)),d=.5/d,p=(this._transform._rotation01+this._transform._rotation10)*d,b=(this._transform._rotation12+this._transform._rotation21)*d,x=(this._transform._rotation02-this._transform._rotation20)*d):(b=.5*(d=Math.sqrt(r-t-_+1)),d=.5/d,p=(this._transform._rotation02+this._transform._rotation20)*d,m=(this._transform._rotation12+this._transform._rotation21)*d,x=(this._transform._rotation10-this._transform._rotation01)*d);var y=c;y.x=p,y.y=m,y.z=b,y.w=x},setOrientation:function(Zt){var t=Zt,X=(S=t.x,It=t.y,Vt=t.z,Lt=t.w,2*S),z=2*It,Y=2*Vt,Z=S*X,I=It*z,V=Vt*Y,L=S*z,w=It*Y,B=S*Y,k=Lt*X,A=Lt*z,P=Lt*Y,S,It,Vt,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt,Et,jt,Nt,Ft,Dt,Wt,Gt,Ot;this._transform._rotation00=1-I-V,this._transform._rotation01=L-P,this._transform._rotation02=B+A,this._transform._rotation10=L+P,this._transform._rotation11=1-Z-V,this._transform._rotation12=w-k,this._transform._rotation20=B-A,this._transform._rotation21=w+k,this._transform._rotation22=1-Z-I,Bt=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,kt=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,At=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Pt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Tt=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,wt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,St=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,Ct=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,qt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=Bt,this._invInertia01=kt,this._invInertia02=At,this._invInertia10=Pt,this._invInertia11=Tt,this._invInertia12=wt,this._invInertia20=St,this._invInertia21=Ct,this._invInertia22=qt,Rt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,Et=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,jt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Nt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Ft=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Dt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Wt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Gt=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Ot=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Rt,this._invInertia01=Et,this._invInertia02=jt,this._invInertia10=Nt,this._invInertia11=Ft,this._invInertia12=Dt,this._invInertia20=Wt,this._invInertia21=Gt,this._invInertia22=Ot,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var Ht=this._ptransform,C=this._transform;Ht._positionX=C._positionX,Ht._positionY=C._positionY,Ht._positionZ=C._positionZ,Ht._rotation00=C._rotation00,Ht._rotation01=C._rotation01,Ht._rotation02=C._rotation02,Ht._rotation10=C._rotation10,Ht._rotation11=C._rotation11,Ht._rotation12=C._rotation12,Ht._rotation20=C._rotation20,Ht._rotation21=C._rotation21,Ht._rotation22=C._rotation22;for(var T=this._shapeList;null!=T;){var Jt=T._next,Q=T._ptransform,$=T._localTransform,K=this._ptransform,tt,Ut,Qt,Kt,$t,to,oo,ao,io,no,_o,eo;tt=K._rotation00*$._rotation00+K._rotation01*$._rotation10+K._rotation02*$._rotation20,Ut=K._rotation00*$._rotation01+K._rotation01*$._rotation11+K._rotation02*$._rotation21,Qt=K._rotation00*$._rotation02+K._rotation01*$._rotation12+K._rotation02*$._rotation22,Kt=K._rotation10*$._rotation00+K._rotation11*$._rotation10+K._rotation12*$._rotation20,$t=K._rotation10*$._rotation01+K._rotation11*$._rotation11+K._rotation12*$._rotation21,to=K._rotation10*$._rotation02+K._rotation11*$._rotation12+K._rotation12*$._rotation22,oo=K._rotation20*$._rotation00+K._rotation21*$._rotation10+K._rotation22*$._rotation20,ao=K._rotation20*$._rotation01+K._rotation21*$._rotation11+K._rotation22*$._rotation21,io=K._rotation20*$._rotation02+K._rotation21*$._rotation12+K._rotation22*$._rotation22,Q._rotation00=tt,Q._rotation01=Ut,Q._rotation02=Qt,Q._rotation10=Kt,Q._rotation11=$t,Q._rotation12=to,Q._rotation20=oo,Q._rotation21=ao,Q._rotation22=io,no=K._rotation00*$._positionX+K._rotation01*$._positionY+K._rotation02*$._positionZ,_o=K._rotation10*$._positionX+K._rotation11*$._positionY+K._rotation12*$._positionZ,eo=K._rotation20*$._positionX+K._rotation21*$._positionY+K._rotation22*$._positionZ,Q._positionX=no,Q._positionY=_o,Q._positionZ=eo,Q._positionX+=K._positionX,Q._positionY+=K._positionY,Q._positionZ+=K._positionZ;var ro=T._transform,xt=T._localTransform,ut=this._transform,gt,so,lo,co,po,mo,bo,xo,yo,fo,go,vo,Xo,uo,zo,Yo,Zo,Io;if(gt=ut._rotation00*xt._rotation00+ut._rotation01*xt._rotation10+ut._rotation02*xt._rotation20,so=ut._rotation00*xt._rotation01+ut._rotation01*xt._rotation11+ut._rotation02*xt._rotation21,lo=ut._rotation00*xt._rotation02+ut._rotation01*xt._rotation12+ut._rotation02*xt._rotation22,co=ut._rotation10*xt._rotation00+ut._rotation11*xt._rotation10+ut._rotation12*xt._rotation20,po=ut._rotation10*xt._rotation01+ut._rotation11*xt._rotation11+ut._rotation12*xt._rotation21,mo=ut._rotation10*xt._rotation02+ut._rotation11*xt._rotation12+ut._rotation12*xt._rotation22,bo=ut._rotation20*xt._rotation00+ut._rotation21*xt._rotation10+ut._rotation22*xt._rotation20,xo=ut._rotation20*xt._rotation01+ut._rotation21*xt._rotation11+ut._rotation22*xt._rotation21,yo=ut._rotation20*xt._rotation02+ut._rotation21*xt._rotation12+ut._rotation22*xt._rotation22,ro._rotation00=gt,ro._rotation01=so,ro._rotation02=lo,ro._rotation10=co,ro._rotation11=po,ro._rotation12=mo,ro._rotation20=bo,ro._rotation21=xo,ro._rotation22=yo,fo=ut._rotation00*xt._positionX+ut._rotation01*xt._positionY+ut._rotation02*xt._positionZ,go=ut._rotation10*xt._positionX+ut._rotation11*xt._positionY+ut._rotation12*xt._positionZ,vo=ut._rotation20*xt._positionX+ut._rotation21*xt._positionY+ut._rotation22*xt._positionZ,ro._positionX=fo,ro._positionY=go,ro._positionZ=vo,ro._positionX+=ut._positionX,ro._positionY+=ut._positionY,ro._positionZ+=ut._positionZ,T._geom._computeAabb(T._aabb,T._ptransform),Xo=T._aabb._minX,uo=T._aabb._minY,zo=T._aabb._minZ,Yo=T._aabb._maxX,Zo=T._aabb._maxY,Io=T._aabb._maxZ,T._geom._computeAabb(T._aabb,T._transform),T._aabb._minX=Xo<T._aabb._minX?Xo:T._aabb._minX,T._aabb._minY=uo<T._aabb._minY?uo:T._aabb._minY,T._aabb._minZ=zo<T._aabb._minZ?zo:T._aabb._minZ,T._aabb._maxX=Yo>T._aabb._maxX?Yo:T._aabb._maxX,T._aabb._maxY=Zo>T._aabb._maxY?Zo:T._aabb._maxY,T._aabb._maxZ=Io>T._aabb._maxZ?Io:T._aabb._maxZ,null!=T._proxy){var Mo,ho,Vo;Mo=T._transform._positionX-T._ptransform._positionX,ho=T._transform._positionY-T._ptransform._positionY,Vo=T._transform._positionZ-T._ptransform._positionZ;var Lo=T.displacement;Lo.x=Mo,Lo.y=ho,Lo.z=Vo,T._rigidBody._world._broadPhase.moveProxy(T._proxy,T._aabb,T.displacement)}T=Jt}this._sleeping=!1,this._sleepTime=0},getTransform:function(){var o=this._transform,t=new oimo_common_Transform;return t._positionX=o._positionX,t._positionY=o._positionY,t._positionZ=o._positionZ,t._rotation00=o._rotation00,t._rotation01=o._rotation01,t._rotation02=o._rotation02,t._rotation10=o._rotation10,t._rotation11=o._rotation11,t._rotation12=o._rotation12,t._rotation20=o._rotation20,t._rotation21=o._rotation21,t._rotation22=o._rotation22,t},getTransformTo:function(o){var t=this._transform;o._positionX=t._positionX,o._positionY=t._positionY,o._positionZ=t._positionZ,o._rotation00=t._rotation00,o._rotation01=t._rotation01,o._rotation02=t._rotation02,o._rotation10=t._rotation10,o._rotation11=t._rotation11,o._rotation12=t._rotation12,o._rotation20=t._rotation20,o._rotation21=t._rotation21,o._rotation22=t._rotation22},setTransform:function(lt){var t,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut,zt,Yt,Zt,It,Mt;this._transform._positionX=lt._positionX,this._transform._positionY=lt._positionY,this._transform._positionZ=lt._positionZ,this._transform._rotation00=lt._rotation00,this._transform._rotation01=lt._rotation01,this._transform._rotation02=lt._rotation02,this._transform._rotation10=lt._rotation10,this._transform._rotation11=lt._rotation11,this._transform._rotation12=lt._rotation12,this._transform._rotation20=lt._rotation20,this._transform._rotation21=lt._rotation21,this._transform._rotation22=lt._rotation22,t=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ct=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,pt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,mt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,bt=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,xt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,dt=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,yt=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,ft=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=t,this._invInertia01=ct,this._invInertia02=pt,this._invInertia10=mt,this._invInertia11=bt,this._invInertia12=xt,this._invInertia20=dt,this._invInertia21=yt,this._invInertia22=ft,gt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,vt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Xt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ut=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,zt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Yt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Zt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,It=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Mt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=gt,this._invInertia01=vt,this._invInertia02=Xt,this._invInertia10=ut,this._invInertia11=zt,this._invInertia12=Yt,this._invInertia20=Zt,this._invInertia21=It,this._invInertia22=Mt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var ht=this._ptransform,x=this._transform;ht._positionX=x._positionX,ht._positionY=x._positionY,ht._positionZ=x._positionZ,ht._rotation00=x._rotation00,ht._rotation01=x._rotation01,ht._rotation02=x._rotation02,ht._rotation10=x._rotation10,ht._rotation11=x._rotation11,ht._rotation12=x._rotation12,ht._rotation20=x._rotation20,ht._rotation21=x._rotation21,ht._rotation22=x._rotation22;for(var u=this._shapeList;null!=u;){var Vt=u._next,P=u._ptransform,S=u._localTransform,C=this._ptransform,T,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt,Rt;T=C._rotation00*S._rotation00+C._rotation01*S._rotation10+C._rotation02*S._rotation20,Lt=C._rotation00*S._rotation01+C._rotation01*S._rotation11+C._rotation02*S._rotation21,Bt=C._rotation00*S._rotation02+C._rotation01*S._rotation12+C._rotation02*S._rotation22,kt=C._rotation10*S._rotation00+C._rotation11*S._rotation10+C._rotation12*S._rotation20,At=C._rotation10*S._rotation01+C._rotation11*S._rotation11+C._rotation12*S._rotation21,Pt=C._rotation10*S._rotation02+C._rotation11*S._rotation12+C._rotation12*S._rotation22,Tt=C._rotation20*S._rotation00+C._rotation21*S._rotation10+C._rotation22*S._rotation20,wt=C._rotation20*S._rotation01+C._rotation21*S._rotation11+C._rotation22*S._rotation21,St=C._rotation20*S._rotation02+C._rotation21*S._rotation12+C._rotation22*S._rotation22,P._rotation00=T,P._rotation01=Lt,P._rotation02=Bt,P._rotation10=kt,P._rotation11=At,P._rotation12=Pt,P._rotation20=Tt,P._rotation21=wt,P._rotation22=St,Ct=C._rotation00*S._positionX+C._rotation01*S._positionY+C._rotation02*S._positionZ,qt=C._rotation10*S._positionX+C._rotation11*S._positionY+C._rotation12*S._positionZ,Rt=C._rotation20*S._positionX+C._rotation21*S._positionY+C._rotation22*S._positionZ,P._positionX=Ct,P._positionY=qt,P._positionZ=Rt,P._positionX+=C._positionX,P._positionY+=C._positionY,P._positionZ+=C._positionZ;var Et=u._transform,ot=u._localTransform,at=this._transform,nt,jt,Nt,Ft,Dt,Wt,Gt,Ot,Ht,Jt,Ut,Qt,Kt,$t,to,oo,ao,io;if(nt=at._rotation00*ot._rotation00+at._rotation01*ot._rotation10+at._rotation02*ot._rotation20,jt=at._rotation00*ot._rotation01+at._rotation01*ot._rotation11+at._rotation02*ot._rotation21,Nt=at._rotation00*ot._rotation02+at._rotation01*ot._rotation12+at._rotation02*ot._rotation22,Ft=at._rotation10*ot._rotation00+at._rotation11*ot._rotation10+at._rotation12*ot._rotation20,Dt=at._rotation10*ot._rotation01+at._rotation11*ot._rotation11+at._rotation12*ot._rotation21,Wt=at._rotation10*ot._rotation02+at._rotation11*ot._rotation12+at._rotation12*ot._rotation22,Gt=at._rotation20*ot._rotation00+at._rotation21*ot._rotation10+at._rotation22*ot._rotation20,Ot=at._rotation20*ot._rotation01+at._rotation21*ot._rotation11+at._rotation22*ot._rotation21,Ht=at._rotation20*ot._rotation02+at._rotation21*ot._rotation12+at._rotation22*ot._rotation22,Et._rotation00=nt,Et._rotation01=jt,Et._rotation02=Nt,Et._rotation10=Ft,Et._rotation11=Dt,Et._rotation12=Wt,Et._rotation20=Gt,Et._rotation21=Ot,Et._rotation22=Ht,Jt=at._rotation00*ot._positionX+at._rotation01*ot._positionY+at._rotation02*ot._positionZ,Ut=at._rotation10*ot._positionX+at._rotation11*ot._positionY+at._rotation12*ot._positionZ,Qt=at._rotation20*ot._positionX+at._rotation21*ot._positionY+at._rotation22*ot._positionZ,Et._positionX=Jt,Et._positionY=Ut,Et._positionZ=Qt,Et._positionX+=at._positionX,Et._positionY+=at._positionY,Et._positionZ+=at._positionZ,u._geom._computeAabb(u._aabb,u._ptransform),Kt=u._aabb._minX,$t=u._aabb._minY,to=u._aabb._minZ,oo=u._aabb._maxX,ao=u._aabb._maxY,io=u._aabb._maxZ,u._geom._computeAabb(u._aabb,u._transform),u._aabb._minX=Kt<u._aabb._minX?Kt:u._aabb._minX,u._aabb._minY=$t<u._aabb._minY?$t:u._aabb._minY,u._aabb._minZ=to<u._aabb._minZ?to:u._aabb._minZ,u._aabb._maxX=oo>u._aabb._maxX?oo:u._aabb._maxX,u._aabb._maxY=ao>u._aabb._maxY?ao:u._aabb._maxY,u._aabb._maxZ=io>u._aabb._maxZ?io:u._aabb._maxZ,null!=u._proxy){var no,_o,eo;no=u._transform._positionX-u._ptransform._positionX,_o=u._transform._positionY-u._ptransform._positionY,eo=u._transform._positionZ-u._ptransform._positionZ;var ro=u.displacement;ro.x=no,ro.y=_o,ro.z=eo,u._rigidBody._world._broadPhase.moveProxy(u._proxy,u._aabb,u.displacement)}u=Vt}this._sleeping=!1,this._sleepTime=0},getMass:function(){return this._mass},getLocalInertia:function(){var o=new oimo_common_Mat3,t=o;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,o},getLocalInertiaTo:function(o){var t=o;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22},getMassData:function(){var o=new oimo_dynamics_rigidbody_MassData;o.mass=this._mass;var t=o.localInertia;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,o},getMassDataTo:function(o){o.mass=this._mass;var t=o.localInertia;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22},setMassData:function(P){this._mass=P.mass;var t=P.localInertia;this._localInertia00=t.e00,this._localInertia01=t.e01,this._localInertia02=t.e02,this._localInertia10=t.e10,this._localInertia11=t.e11,this._localInertia12=t.e12,this._localInertia20=t.e20,this._localInertia21=t.e21,this._localInertia22=t.e22;var i=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,u=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,g=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,M=this._localInertia00*i-this._localInertia01*u+this._localInertia02*g,X,T,S,C,q,R,E,j,N,F,D,W,G,O,H,J,U,Q;if(0<this._mass&&0<M&&0==this._type){this._invMass=1/this._mass;var K=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,z=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,Y=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,Z=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,I=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,V=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,L=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,w=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,B=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,k=this._localInertia00*K-this._localInertia01*z+this._localInertia02*Y;(-1e-32>k||1e-32<k)&&(k=1/k),this._invLocalInertia00=K*k,this._invLocalInertia01=-Z*k,this._invLocalInertia02=L*k,this._invLocalInertia10=-z*k,this._invLocalInertia11=I*k,this._invLocalInertia12=-w*k,this._invLocalInertia20=Y*k,this._invLocalInertia21=-V*k,this._invLocalInertia22=B*k,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,T=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,S=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,C=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,q=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,R=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,E=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,j=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,N=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=X,this._invInertia01=T,this._invInertia02=S,this._invInertia10=C,this._invInertia11=q,this._invInertia12=R,this._invInertia20=E,this._invInertia21=j,this._invInertia22=N,F=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,D=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,W=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,G=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,O=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,H=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,J=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,U=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Q=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=F,this._invInertia01=D,this._invInertia02=W,this._invInertia10=G,this._invInertia11=O,this._invInertia12=H,this._invInertia20=J,this._invInertia21=U,this._invInertia22=Q,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getRotationFactor:function(){var o=this._rotFactor;return new oimo_common_Vec3(o.x,o.y,o.z)},setRotationFactor:function(g){var t=this._rotFactor,x,X,u,z,Y,Z,I,M,V,L,B,k,A,P,T,w,S,C;t.x=g.x,t.y=g.y,t.z=g.z,x=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,u=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Y=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Z=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,I=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=x,this._invInertia01=X,this._invInertia02=u,this._invInertia10=z,this._invInertia11=Y,this._invInertia12=Z,this._invInertia20=I,this._invInertia21=M,this._invInertia22=V,L=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,B=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,k=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,A=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,P=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,w=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,C=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=L,this._invInertia01=B,this._invInertia02=k,this._invInertia10=A,this._invInertia11=P,this._invInertia12=T,this._invInertia20=w,this._invInertia21=S,this._invInertia22=C,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getLinearVelocity:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,o},getLinearVelocityTo:function(o){var t=o;t.x=this._velX,t.y=this._velY,t.z=this._velZ},setLinearVelocity:function(o){if(1==this._type)this._velX=0,this._velY=0,this._velZ=0;else{var t=o;this._velX=t.x,this._velY=t.y,this._velZ=t.z}this._sleeping=!1,this._sleepTime=0},getAngularVelocity:function(){var o=new oimo_common_Vec3,t=o;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,o},getAngularVelocityTo:function(o){var t=o;t.x=this._velX,t.y=this._velY,t.z=this._velZ},setAngularVelocity:function(o){if(1==this._type)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var t=o;this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z}this._sleeping=!1,this._sleepTime=0},addLinearVelocity:function(_){if(1!=this._type){var t=_,n,e,r;n=t.x,e=t.y,r=t.z,this._velX+=n,this._velY+=e,this._velZ+=r}this._sleeping=!1,this._sleepTime=0},addAngularVelocity:function(_){if(1!=this._type){var t=_,n,e,r;n=t.x,e=t.y,r=t.z,this._angVelX+=n,this._angVelY+=e,this._angVelZ+=r}this._sleeping=!1,this._sleepTime=0},applyImpulse:function(b,t){var i=b,c,x,d,f,g,X,u,z,Y;c=i.x,x=i.y,d=i.z,this._velX+=c*this._invMass,this._velY+=x*this._invMass,this._velZ+=d*this._invMass;var Z=t,y,I,M;u=Z.x,z=Z.y,Y=Z.z,u-=this._transform._positionX,f=(z-=this._transform._positionY)*d-(Y-=this._transform._positionZ)*x,g=Y*c-u*d,X=u*x-z*c,y=this._invInertia00*f+this._invInertia01*g+this._invInertia02*X,I=this._invInertia10*f+this._invInertia11*g+this._invInertia12*X,M=this._invInertia20*f+this._invInertia21*g+this._invInertia22*X,f=y,g=I,X=M,this._angVelX+=f,this._angVelY+=g,this._angVelZ+=X,this._sleeping=!1,this._sleepTime=0},applyLinearImpulse:function(_){var t=_,n,e,r;n=t.x,e=t.y,r=t.z,this._velX+=n*this._invMass,this._velY+=e*this._invMass,this._velZ+=r*this._invMass,this._sleeping=!1,this._sleepTime=0},applyAngularImpulse:function(e){var t=e,r,l,c,p,m,b;r=t.x,l=t.y,c=t.z,p=this._invInertia00*r+this._invInertia01*l+this._invInertia02*c,m=this._invInertia10*r+this._invInertia11*l+this._invInertia12*c,b=this._invInertia20*r+this._invInertia21*l+this._invInertia22*c,r=p,l=m,c=b,this._angVelX+=r,this._angVelY+=l,this._angVelZ+=c,this._sleeping=!1,this._sleepTime=0},applyForce:function(p,t){var i=p,c,b,x,d,y,f,g,v,X;c=i.x,b=i.y,x=i.z,this._forceX+=c,this._forceY+=b,this._forceZ+=x;var u=t;g=u.x,v=u.y,X=u.z,g-=this._transform._positionX,d=(v-=this._transform._positionY)*x-(X-=this._transform._positionZ)*b,y=X*c-g*x,f=g*b-v*c,this._torqueX+=d,this._torqueY+=y,this._torqueZ+=f,this._sleeping=!1,this._sleepTime=0},applyForceToCenter:function(_){var t=_,n,e,r;n=t.x,e=t.y,r=t.z,this._forceX+=n,this._forceY+=e,this._forceZ+=r,this._sleeping=!1,this._sleepTime=0},applyTorque:function(_){var t=_,n,e,r;n=t.x,e=t.y,r=t.z,this._torqueX+=n,this._torqueY+=e,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0},getGravityScale:function(){return this._gravityScale},setGravityScale:function(o){this._gravityScale=o,this._sleeping=!1,this._sleepTime=0},getLocalPoint:function(l){var t=l,r,c,p,m,b,x;r=t.x,c=t.y,p=t.z,r-=this._transform._positionX,c-=this._transform._positionY,p-=this._transform._positionZ,m=this._transform._rotation00*r+this._transform._rotation10*c+this._transform._rotation20*p,b=this._transform._rotation01*r+this._transform._rotation11*c+this._transform._rotation21*p,x=this._transform._rotation02*r+this._transform._rotation12*c+this._transform._rotation22*p,r=m,c=b,p=x;var d=new oimo_common_Vec3,e=d;return e.x=r,e.y=c,e.z=p,d},getLocalPointTo:function(l,t){var i=l,e,c,p,m,b,x;e=i.x,c=i.y,p=i.z,e-=this._transform._positionX,c-=this._transform._positionY,p-=this._transform._positionZ,m=this._transform._rotation00*e+this._transform._rotation10*c+this._transform._rotation20*p,b=this._transform._rotation01*e+this._transform._rotation11*c+this._transform._rotation21*p,x=this._transform._rotation02*e+this._transform._rotation12*c+this._transform._rotation22*p,e=m,c=b,p=x;var d=t;d.x=e,d.y=c,d.z=p},getLocalVector:function(l){var t=l,r,c,p,m,b,x;r=t.x,c=t.y,p=t.z,m=this._transform._rotation00*r+this._transform._rotation10*c+this._transform._rotation20*p,b=this._transform._rotation01*r+this._transform._rotation11*c+this._transform._rotation21*p,x=this._transform._rotation02*r+this._transform._rotation12*c+this._transform._rotation22*p,r=m,c=b,p=x;var d=new oimo_common_Vec3,e=d;return e.x=r,e.y=c,e.z=p,d},getLocalVectorTo:function(l,t){var i=l,e,c,p,m,b,x;e=i.x,c=i.y,p=i.z,m=this._transform._rotation00*e+this._transform._rotation10*c+this._transform._rotation20*p,b=this._transform._rotation01*e+this._transform._rotation11*c+this._transform._rotation21*p,x=this._transform._rotation02*e+this._transform._rotation12*c+this._transform._rotation22*p,e=m,c=b,p=x;var d=t;d.x=e,d.y=c,d.z=p},getWorldPoint:function(l){var t=l,r,c,p,m,b,x;r=t.x,c=t.y,p=t.z,m=this._transform._rotation00*r+this._transform._rotation01*c+this._transform._rotation02*p,b=this._transform._rotation10*r+this._transform._rotation11*c+this._transform._rotation12*p,x=this._transform._rotation20*r+this._transform._rotation21*c+this._transform._rotation22*p,r=m,c=b,p=x,r+=this._transform._positionX,c+=this._transform._positionY,p+=this._transform._positionZ;var d=new oimo_common_Vec3,e=d;return e.x=r,e.y=c,e.z=p,d},getWorldPointTo:function(l,t){var i=l,e,c,p,m,b,x;e=i.x,c=i.y,p=i.z,m=this._transform._rotation00*e+this._transform._rotation01*c+this._transform._rotation02*p,b=this._transform._rotation10*e+this._transform._rotation11*c+this._transform._rotation12*p,x=this._transform._rotation20*e+this._transform._rotation21*c+this._transform._rotation22*p,e=m,c=b,p=x,e+=this._transform._positionX,c+=this._transform._positionY,p+=this._transform._positionZ;var d=t;d.x=e,d.y=c,d.z=p},getWorldVector:function(l){var t=l,r,c,p,m,b,x;r=t.x,c=t.y,p=t.z,m=this._transform._rotation00*r+this._transform._rotation01*c+this._transform._rotation02*p,b=this._transform._rotation10*r+this._transform._rotation11*c+this._transform._rotation12*p,x=this._transform._rotation20*r+this._transform._rotation21*c+this._transform._rotation22*p,r=m,c=b,p=x;var d=new oimo_common_Vec3,e=d;return e.x=r,e.y=c,e.z=p,d},getWorldVectorTo:function(l,t){var i=l,e,c,p,m,b,x;e=i.x,c=i.y,p=i.z,m=this._transform._rotation00*e+this._transform._rotation01*c+this._transform._rotation02*p,b=this._transform._rotation10*e+this._transform._rotation11*c+this._transform._rotation12*p,x=this._transform._rotation20*e+this._transform._rotation21*c+this._transform._rotation22*p,e=m,c=b,p=x;var d=t;d.x=e,d.y=c,d.z=p},getNumShapes:function(){return this._numShapes},getShapeList:function(){return this._shapeList},getNumContactLinks:function(){return this._numContactLinks},getContactLinkList:function(){return this._contactLinkList},getNumJointLinks:function(){return this._numJointLinks},getJointLinkList:function(){return this._jointLinkList},addShape:function(N){if(null==this._shapeList?(this._shapeList=N,this._shapeListLast=N):(this._shapeListLast._next=N,N._prev=this._shapeListLast,this._shapeListLast=N),this._numShapes++,N._rigidBody=this,null!=this._world){var t=this._world;N._proxy=t._broadPhase.createProxy(N,N._aabb),N._id=t._shapeIdCount++,t._numShapes++}this.updateMass();for(var i=this._shapeList;null!=i;){var F=i._next,y=i._ptransform,b=i._localTransform,f=this._ptransform,d,W,G,O,H,U,Q,K,$,tt,ot,at;d=f._rotation00*b._rotation00+f._rotation01*b._rotation10+f._rotation02*b._rotation20,W=f._rotation00*b._rotation01+f._rotation01*b._rotation11+f._rotation02*b._rotation21,G=f._rotation00*b._rotation02+f._rotation01*b._rotation12+f._rotation02*b._rotation22,O=f._rotation10*b._rotation00+f._rotation11*b._rotation10+f._rotation12*b._rotation20,H=f._rotation10*b._rotation01+f._rotation11*b._rotation11+f._rotation12*b._rotation21,U=f._rotation10*b._rotation02+f._rotation11*b._rotation12+f._rotation12*b._rotation22,Q=f._rotation20*b._rotation00+f._rotation21*b._rotation10+f._rotation22*b._rotation20,K=f._rotation20*b._rotation01+f._rotation21*b._rotation11+f._rotation22*b._rotation21,$=f._rotation20*b._rotation02+f._rotation21*b._rotation12+f._rotation22*b._rotation22,y._rotation00=d,y._rotation01=W,y._rotation02=G,y._rotation10=O,y._rotation11=H,y._rotation12=U,y._rotation20=Q,y._rotation21=K,y._rotation22=$,tt=f._rotation00*b._positionX+f._rotation01*b._positionY+f._rotation02*b._positionZ,ot=f._rotation10*b._positionX+f._rotation11*b._positionY+f._rotation12*b._positionZ,at=f._rotation20*b._positionX+f._rotation21*b._positionY+f._rotation22*b._positionZ,y._positionX=tt,y._positionY=ot,y._positionZ=at,y._positionX+=f._positionX,y._positionY+=f._positionY,y._positionZ+=f._positionZ;var it=i._transform,T=i._localTransform,j=this._transform,R,nt,_t,et,rt,st,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt;if(R=j._rotation00*T._rotation00+j._rotation01*T._rotation10+j._rotation02*T._rotation20,nt=j._rotation00*T._rotation01+j._rotation01*T._rotation11+j._rotation02*T._rotation21,_t=j._rotation00*T._rotation02+j._rotation01*T._rotation12+j._rotation02*T._rotation22,et=j._rotation10*T._rotation00+j._rotation11*T._rotation10+j._rotation12*T._rotation20,rt=j._rotation10*T._rotation01+j._rotation11*T._rotation11+j._rotation12*T._rotation21,st=j._rotation10*T._rotation02+j._rotation11*T._rotation12+j._rotation12*T._rotation22,lt=j._rotation20*T._rotation00+j._rotation21*T._rotation10+j._rotation22*T._rotation20,ct=j._rotation20*T._rotation01+j._rotation21*T._rotation11+j._rotation22*T._rotation21,pt=j._rotation20*T._rotation02+j._rotation21*T._rotation12+j._rotation22*T._rotation22,it._rotation00=R,it._rotation01=nt,it._rotation02=_t,it._rotation10=et,it._rotation11=rt,it._rotation12=st,it._rotation20=lt,it._rotation21=ct,it._rotation22=pt,mt=j._rotation00*T._positionX+j._rotation01*T._positionY+j._rotation02*T._positionZ,bt=j._rotation10*T._positionX+j._rotation11*T._positionY+j._rotation12*T._positionZ,xt=j._rotation20*T._positionX+j._rotation21*T._positionY+j._rotation22*T._positionZ,it._positionX=mt,it._positionY=bt,it._positionZ=xt,it._positionX+=j._positionX,it._positionY+=j._positionY,it._positionZ+=j._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),dt=i._aabb._minX,yt=i._aabb._minY,ft=i._aabb._minZ,gt=i._aabb._maxX,vt=i._aabb._maxY,Xt=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=dt<i._aabb._minX?dt:i._aabb._minX,i._aabb._minY=yt<i._aabb._minY?yt:i._aabb._minY,i._aabb._minZ=ft<i._aabb._minZ?ft:i._aabb._minZ,i._aabb._maxX=gt>i._aabb._maxX?gt:i._aabb._maxX,i._aabb._maxY=vt>i._aabb._maxY?vt:i._aabb._maxY,i._aabb._maxZ=Xt>i._aabb._maxZ?Xt:i._aabb._maxZ,null!=i._proxy){var ut,zt,Yt;ut=i._transform._positionX-i._ptransform._positionX,zt=i._transform._positionY-i._ptransform._positionY,Yt=i._transform._positionZ-i._ptransform._positionZ;var Zt=i.displacement;Zt.x=ut,Zt.y=zt,Zt.z=Yt,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=F}},removeShape:function(_t){var t=_t._prev,i=_t._next;if(null!=t&&(t._next=i),null!=i&&(i._prev=t),_t==this._shapeList&&(this._shapeList=this._shapeList._next),_t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),_t._next=null,_t._prev=null,this._numShapes--,_t._rigidBody=null,null!=this._world){var o=this._world;o._broadPhase.destroyProxy(_t._proxy),_t._proxy=null,_t._id=-1;for(var a=_t._rigidBody._contactLinkList;null!=a;){var et=a._next,s=a._contact;if(s._s1==_t||s._s2==_t){var _=a._other;_._sleeping=!1,_._sleepTime=0;var r=o._contactManager,e=s._prev,h=s._next;if(null!=e&&(e._next=h),null!=h&&(h._prev=e),s==r._contactList&&(r._contactList=r._contactList._next),s==r._contactListLast&&(r._contactListLast=r._contactListLast._prev),s._next=null,s._prev=null,s._touching){var l=s._s1._contactCallback,c=s._s2._contactCallback;l==c&&(c=null),null!=l&&l.endContact(s),null!=c&&c.endContact(s)}var rt=s._link1._prev,p=s._link1._next;null!=rt&&(rt._next=p),null!=p&&(p._prev=rt),s._link1==s._b1._contactLinkList&&(s._b1._contactLinkList=s._b1._contactLinkList._next),s._link1==s._b1._contactLinkListLast&&(s._b1._contactLinkListLast=s._b1._contactLinkListLast._prev),s._link1._next=null,s._link1._prev=null;var v=s._link2._prev,y=s._link2._next;null!=v&&(v._next=y),null!=y&&(y._prev=v),s._link2==s._b2._contactLinkList&&(s._b2._contactLinkList=s._b2._contactLinkList._next),s._link2==s._b2._contactLinkListLast&&(s._b2._contactLinkListLast=s._b2._contactLinkListLast._prev),s._link2._next=null,s._link2._prev=null,s._b1._numContactLinks--,s._b2._numContactLinks--,s._link1._other=null,s._link2._other=null,s._link1._contact=null,s._link2._contact=null,s._s1=null,s._s2=null,s._b1=null,s._b2=null,s._touching=!1,s._cachedDetectorData._clear(),s._manifold._clear(),s._detector=null;var b=s._contactConstraint;b._s1=null,b._s2=null,b._b1=null,b._b2=null,b._tf1=null,b._tf2=null,s._next=r._contactPool,r._contactPool=s,r._numContacts--}a=et}o._numShapes--}this.updateMass();for(var f=this._shapeList;null!=f;){var lt=f._next,B=f._ptransform,k=f._localTransform,A=this._ptransform,P,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt;P=A._rotation00*k._rotation00+A._rotation01*k._rotation10+A._rotation02*k._rotation20,ct=A._rotation00*k._rotation01+A._rotation01*k._rotation11+A._rotation02*k._rotation21,pt=A._rotation00*k._rotation02+A._rotation01*k._rotation12+A._rotation02*k._rotation22,mt=A._rotation10*k._rotation00+A._rotation11*k._rotation10+A._rotation12*k._rotation20,bt=A._rotation10*k._rotation01+A._rotation11*k._rotation11+A._rotation12*k._rotation21,xt=A._rotation10*k._rotation02+A._rotation11*k._rotation12+A._rotation12*k._rotation22,dt=A._rotation20*k._rotation00+A._rotation21*k._rotation10+A._rotation22*k._rotation20,yt=A._rotation20*k._rotation01+A._rotation21*k._rotation11+A._rotation22*k._rotation21,ft=A._rotation20*k._rotation02+A._rotation21*k._rotation12+A._rotation22*k._rotation22,B._rotation00=P,B._rotation01=ct,B._rotation02=pt,B._rotation10=mt,B._rotation11=bt,B._rotation12=xt,B._rotation20=dt,B._rotation21=yt,B._rotation22=ft,gt=A._rotation00*k._positionX+A._rotation01*k._positionY+A._rotation02*k._positionZ,vt=A._rotation10*k._positionX+A._rotation11*k._positionY+A._rotation12*k._positionZ,Xt=A._rotation20*k._positionX+A._rotation21*k._positionY+A._rotation22*k._positionZ,B._positionX=gt,B._positionY=vt,B._positionZ=Xt,B._positionX+=A._positionX,B._positionY+=A._positionY,B._positionZ+=A._positionZ;var ut=f._transform,K=f._localTransform,tt=this._transform,it,zt,Yt,Zt,It,Mt,ht,Vt,Lt,Bt,kt,At,Pt,Tt,wt,St,Ct,qt;if(it=tt._rotation00*K._rotation00+tt._rotation01*K._rotation10+tt._rotation02*K._rotation20,zt=tt._rotation00*K._rotation01+tt._rotation01*K._rotation11+tt._rotation02*K._rotation21,Yt=tt._rotation00*K._rotation02+tt._rotation01*K._rotation12+tt._rotation02*K._rotation22,Zt=tt._rotation10*K._rotation00+tt._rotation11*K._rotation10+tt._rotation12*K._rotation20,It=tt._rotation10*K._rotation01+tt._rotation11*K._rotation11+tt._rotation12*K._rotation21,Mt=tt._rotation10*K._rotation02+tt._rotation11*K._rotation12+tt._rotation12*K._rotation22,ht=tt._rotation20*K._rotation00+tt._rotation21*K._rotation10+tt._rotation22*K._rotation20,Vt=tt._rotation20*K._rotation01+tt._rotation21*K._rotation11+tt._rotation22*K._rotation21,Lt=tt._rotation20*K._rotation02+tt._rotation21*K._rotation12+tt._rotation22*K._rotation22,ut._rotation00=it,ut._rotation01=zt,ut._rotation02=Yt,ut._rotation10=Zt,ut._rotation11=It,ut._rotation12=Mt,ut._rotation20=ht,ut._rotation21=Vt,ut._rotation22=Lt,Bt=tt._rotation00*K._positionX+tt._rotation01*K._positionY+tt._rotation02*K._positionZ,kt=tt._rotation10*K._positionX+tt._rotation11*K._positionY+tt._rotation12*K._positionZ,At=tt._rotation20*K._positionX+tt._rotation21*K._positionY+tt._rotation22*K._positionZ,ut._positionX=Bt,ut._positionY=kt,ut._positionZ=At,ut._positionX+=tt._positionX,ut._positionY+=tt._positionY,ut._positionZ+=tt._positionZ,f._geom._computeAabb(f._aabb,f._ptransform),Pt=f._aabb._minX,Tt=f._aabb._minY,wt=f._aabb._minZ,St=f._aabb._maxX,Ct=f._aabb._maxY,qt=f._aabb._maxZ,f._geom._computeAabb(f._aabb,f._transform),f._aabb._minX=Pt<f._aabb._minX?Pt:f._aabb._minX,f._aabb._minY=Tt<f._aabb._minY?Tt:f._aabb._minY,f._aabb._minZ=wt<f._aabb._minZ?wt:f._aabb._minZ,f._aabb._maxX=St>f._aabb._maxX?St:f._aabb._maxX,f._aabb._maxY=Ct>f._aabb._maxY?Ct:f._aabb._maxY,f._aabb._maxZ=qt>f._aabb._maxZ?qt:f._aabb._maxZ,null!=f._proxy){var Rt,Et,jt;Rt=f._transform._positionX-f._ptransform._positionX,Et=f._transform._positionY-f._ptransform._positionY,jt=f._transform._positionZ-f._ptransform._positionZ;var Nt=f.displacement;Nt.x=Rt,Nt.y=Et,Nt.z=jt,f._rigidBody._world._broadPhase.moveProxy(f._proxy,f._aabb,f.displacement)}f=lt}},getType:function(){return this._type},setType:function(o){this._type=o,this.updateMass()},wakeUp:function(){this._sleeping=!1,this._sleepTime=0},sleep:function(){this._sleeping=!0,this._sleepTime=0},isSleeping:function(){return this._sleeping},getSleepTime:function(){return this._sleepTime},setAutoSleep:function(o){this._autoSleep=o,this._sleeping=!1,this._sleepTime=0},getLinearDamping:function(){return this._linearDamping},setLinearDamping:function(o){this._linearDamping=o},getAngularDamping:function(){return this._angularDamping},setAngularDamping:function(o){this._angularDamping=o},getPrev:function(){return this._prev},getNext:function(){return this._next}};var oimo_dynamics_rigidbody_RigidBodyConfig=function(){this.position=new oimo_common_Vec3,this.rotation=new oimo_common_Mat3,this.linearVelocity=new oimo_common_Vec3,this.angularVelocity=new oimo_common_Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0},oimo_dynamics_rigidbody_RigidBodyType=function(){},oimo_dynamics_rigidbody_Shape=function(e){this._id=-1,this._localTransform=new oimo_common_Transform,this._ptransform=new oimo_common_Transform,this._transform=new oimo_common_Transform;var t=e.position;this._localTransform._positionX=t.x,this._localTransform._positionY=t.y,this._localTransform._positionZ=t.z;var i=e.rotation;this._localTransform._rotation00=i.e00,this._localTransform._rotation01=i.e01,this._localTransform._rotation02=i.e02,this._localTransform._rotation10=i.e10,this._localTransform._rotation11=i.e11,this._localTransform._rotation12=i.e12,this._localTransform._rotation20=i.e20,this._localTransform._rotation21=i.e21,this._localTransform._rotation22=i.e22;var o=this._ptransform,a=this._localTransform;o._positionX=a._positionX,o._positionY=a._positionY,o._positionZ=a._positionZ,o._rotation00=a._rotation00,o._rotation01=a._rotation01,o._rotation02=a._rotation02,o._rotation10=a._rotation10,o._rotation11=a._rotation11,o._rotation12=a._rotation12,o._rotation20=a._rotation20,o._rotation21=a._rotation21,o._rotation22=a._rotation22;var n=this._transform,r=this._localTransform;n._positionX=r._positionX,n._positionY=r._positionY,n._positionZ=r._positionZ,n._rotation00=r._rotation00,n._rotation01=r._rotation01,n._rotation02=r._rotation02,n._rotation10=r._rotation10,n._rotation11=r._rotation11,n._rotation12=r._rotation12,n._rotation20=r._rotation20,n._rotation21=r._rotation21,n._rotation22=r._rotation22,this._restitution=e.restitution,this._friction=e.friction,this._density=e.density,this._geom=e.geometry,this._collisionGroup=e.collisionGroup,this._collisionMask=e.collisionMask,this._contactCallback=e.contactCallback,this._aabb=new oimo_collision_geometry_Aabb,this._proxy=null,this.displacement=new oimo_common_Vec3};oimo_dynamics_rigidbody_Shape.prototype={getFriction:function(){return this._friction},setFriction:function(o){this._friction=o},getRestitution:function(){return this._restitution},setRestitution:function(o){this._restitution=o},getLocalTransform:function(){var o=this._localTransform,t=new oimo_common_Transform;return t._positionX=o._positionX,t._positionY=o._positionY,t._positionZ=o._positionZ,t._rotation00=o._rotation00,t._rotation01=o._rotation01,t._rotation02=o._rotation02,t._rotation10=o._rotation10,t._rotation11=o._rotation11,t._rotation12=o._rotation12,t._rotation20=o._rotation20,t._rotation21=o._rotation21,t._rotation22=o._rotation22,t},getLocalTransformTo:function(o){var t=this._localTransform;o._positionX=t._positionX,o._positionY=t._positionY,o._positionZ=t._positionZ,o._rotation00=t._rotation00,o._rotation01=t._rotation01,o._rotation02=t._rotation02,o._rotation10=t._rotation10,o._rotation11=t._rotation11,o._rotation12=t._rotation12,o._rotation20=t._rotation20,o._rotation21=t._rotation21,o._rotation22=t._rotation22},getTransform:function(){var o=this._transform,t=new oimo_common_Transform;return t._positionX=o._positionX,t._positionY=o._positionY,t._positionZ=o._positionZ,t._rotation00=o._rotation00,t._rotation01=o._rotation01,t._rotation02=o._rotation02,t._rotation10=o._rotation10,t._rotation11=o._rotation11,t._rotation12=o._rotation12,t._rotation20=o._rotation20,t._rotation21=o._rotation21,t._rotation22=o._rotation22,t},getTransformTo:function(o){var t=this._transform;o._positionX=t._positionX,o._positionY=t._positionY,o._positionZ=t._positionZ,o._rotation00=t._rotation00,o._rotation01=t._rotation01,o._rotation02=t._rotation02,o._rotation10=t._rotation10,o._rotation11=t._rotation11,o._rotation12=t._rotation12,o._rotation20=t._rotation20,o._rotation21=t._rotation21,o._rotation22=t._rotation22},setLocalTransform:function(N){var t=this._localTransform;if(t._positionX=N._positionX,t._positionY=N._positionY,t._positionZ=N._positionZ,t._rotation00=N._rotation00,t._rotation01=N._rotation01,t._rotation02=N._rotation02,t._rotation10=N._rotation10,t._rotation11=N._rotation11,t._rotation12=N._rotation12,t._rotation20=N._rotation20,t._rotation21=N._rotation21,t._rotation22=N._rotation22,null!=this._rigidBody){var i=this._rigidBody;i.updateMass();for(var o=i._shapeList;null!=o;){var W=o._next,b=o._ptransform,f=o._localTransform,d=i._ptransform,x,G,O,H,U,Q,K,$,tt,ot,at,it;x=d._rotation00*f._rotation00+d._rotation01*f._rotation10+d._rotation02*f._rotation20,G=d._rotation00*f._rotation01+d._rotation01*f._rotation11+d._rotation02*f._rotation21,O=d._rotation00*f._rotation02+d._rotation01*f._rotation12+d._rotation02*f._rotation22,H=d._rotation10*f._rotation00+d._rotation11*f._rotation10+d._rotation12*f._rotation20,U=d._rotation10*f._rotation01+d._rotation11*f._rotation11+d._rotation12*f._rotation21,Q=d._rotation10*f._rotation02+d._rotation11*f._rotation12+d._rotation12*f._rotation22,K=d._rotation20*f._rotation00+d._rotation21*f._rotation10+d._rotation22*f._rotation20,$=d._rotation20*f._rotation01+d._rotation21*f._rotation11+d._rotation22*f._rotation21,tt=d._rotation20*f._rotation02+d._rotation21*f._rotation12+d._rotation22*f._rotation22,b._rotation00=x,b._rotation01=G,b._rotation02=O,b._rotation10=H,b._rotation11=U,b._rotation12=Q,b._rotation20=K,b._rotation21=$,b._rotation22=tt,ot=d._rotation00*f._positionX+d._rotation01*f._positionY+d._rotation02*f._positionZ,at=d._rotation10*f._positionX+d._rotation11*f._positionY+d._rotation12*f._positionZ,it=d._rotation20*f._positionX+d._rotation21*f._positionY+d._rotation22*f._positionZ,b._positionX=ot,b._positionY=at,b._positionZ=it,b._positionX+=d._positionX,b._positionY+=d._positionY,b._positionZ+=d._positionZ;var nt=o._transform,j=o._localTransform,R=i._transform,q,_t,et,rt,st,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt,ut;if(q=R._rotation00*j._rotation00+R._rotation01*j._rotation10+R._rotation02*j._rotation20,_t=R._rotation00*j._rotation01+R._rotation01*j._rotation11+R._rotation02*j._rotation21,et=R._rotation00*j._rotation02+R._rotation01*j._rotation12+R._rotation02*j._rotation22,rt=R._rotation10*j._rotation00+R._rotation11*j._rotation10+R._rotation12*j._rotation20,st=R._rotation10*j._rotation01+R._rotation11*j._rotation11+R._rotation12*j._rotation21,lt=R._rotation10*j._rotation02+R._rotation11*j._rotation12+R._rotation12*j._rotation22,ct=R._rotation20*j._rotation00+R._rotation21*j._rotation10+R._rotation22*j._rotation20,pt=R._rotation20*j._rotation01+R._rotation21*j._rotation11+R._rotation22*j._rotation21,mt=R._rotation20*j._rotation02+R._rotation21*j._rotation12+R._rotation22*j._rotation22,nt._rotation00=q,nt._rotation01=_t,nt._rotation02=et,nt._rotation10=rt,nt._rotation11=st,nt._rotation12=lt,nt._rotation20=ct,nt._rotation21=pt,nt._rotation22=mt,bt=R._rotation00*j._positionX+R._rotation01*j._positionY+R._rotation02*j._positionZ,xt=R._rotation10*j._positionX+R._rotation11*j._positionY+R._rotation12*j._positionZ,dt=R._rotation20*j._positionX+R._rotation21*j._positionY+R._rotation22*j._positionZ,nt._positionX=bt,nt._positionY=xt,nt._positionZ=dt,nt._positionX+=R._positionX,nt._positionY+=R._positionY,nt._positionZ+=R._positionZ,o._geom._computeAabb(o._aabb,o._ptransform),yt=o._aabb._minX,ft=o._aabb._minY,gt=o._aabb._minZ,vt=o._aabb._maxX,Xt=o._aabb._maxY,ut=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=yt<o._aabb._minX?yt:o._aabb._minX,o._aabb._minY=ft<o._aabb._minY?ft:o._aabb._minY,o._aabb._minZ=gt<o._aabb._minZ?gt:o._aabb._minZ,o._aabb._maxX=vt>o._aabb._maxX?vt:o._aabb._maxX,o._aabb._maxY=Xt>o._aabb._maxY?Xt:o._aabb._maxY,o._aabb._maxZ=ut>o._aabb._maxZ?ut:o._aabb._maxZ,null!=o._proxy){var zt,Yt,Zt;zt=o._transform._positionX-o._ptransform._positionX,Yt=o._transform._positionY-o._ptransform._positionY,Zt=o._transform._positionZ-o._ptransform._positionZ;var It=o.displacement;It.x=zt,It.y=Yt,It.z=Zt,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=W}}},getDensity:function(){return this._density},setDensity:function(N){if(this._density=N,null!=this._rigidBody){var t=this._rigidBody;t.updateMass();for(var i=t._shapeList;null!=i;){var F=i._next,y=i._ptransform,b=i._localTransform,f=t._ptransform,d,W,G,O,H,U,Q,K,$,tt,ot,at;d=f._rotation00*b._rotation00+f._rotation01*b._rotation10+f._rotation02*b._rotation20,W=f._rotation00*b._rotation01+f._rotation01*b._rotation11+f._rotation02*b._rotation21,G=f._rotation00*b._rotation02+f._rotation01*b._rotation12+f._rotation02*b._rotation22,O=f._rotation10*b._rotation00+f._rotation11*b._rotation10+f._rotation12*b._rotation20,H=f._rotation10*b._rotation01+f._rotation11*b._rotation11+f._rotation12*b._rotation21,U=f._rotation10*b._rotation02+f._rotation11*b._rotation12+f._rotation12*b._rotation22,Q=f._rotation20*b._rotation00+f._rotation21*b._rotation10+f._rotation22*b._rotation20,K=f._rotation20*b._rotation01+f._rotation21*b._rotation11+f._rotation22*b._rotation21,$=f._rotation20*b._rotation02+f._rotation21*b._rotation12+f._rotation22*b._rotation22,y._rotation00=d,y._rotation01=W,y._rotation02=G,y._rotation10=O,y._rotation11=H,y._rotation12=U,y._rotation20=Q,y._rotation21=K,y._rotation22=$,tt=f._rotation00*b._positionX+f._rotation01*b._positionY+f._rotation02*b._positionZ,ot=f._rotation10*b._positionX+f._rotation11*b._positionY+f._rotation12*b._positionZ,at=f._rotation20*b._positionX+f._rotation21*b._positionY+f._rotation22*b._positionZ,y._positionX=tt,y._positionY=ot,y._positionZ=at,y._positionX+=f._positionX,y._positionY+=f._positionY,y._positionZ+=f._positionZ;var it=i._transform,T=i._localTransform,j=t._transform,R,nt,_t,et,rt,st,lt,ct,pt,mt,bt,xt,dt,yt,ft,gt,vt,Xt;if(R=j._rotation00*T._rotation00+j._rotation01*T._rotation10+j._rotation02*T._rotation20,nt=j._rotation00*T._rotation01+j._rotation01*T._rotation11+j._rotation02*T._rotation21,_t=j._rotation00*T._rotation02+j._rotation01*T._rotation12+j._rotation02*T._rotation22,et=j._rotation10*T._rotation00+j._rotation11*T._rotation10+j._rotation12*T._rotation20,rt=j._rotation10*T._rotation01+j._rotation11*T._rotation11+j._rotation12*T._rotation21,st=j._rotation10*T._rotation02+j._rotation11*T._rotation12+j._rotation12*T._rotation22,lt=j._rotation20*T._rotation00+j._rotation21*T._rotation10+j._rotation22*T._rotation20,ct=j._rotation20*T._rotation01+j._rotation21*T._rotation11+j._rotation22*T._rotation21,pt=j._rotation20*T._rotation02+j._rotation21*T._rotation12+j._rotation22*T._rotation22,it._rotation00=R,it._rotation01=nt,it._rotation02=_t,it._rotation10=et,it._rotation11=rt,it._rotation12=st,it._rotation20=lt,it._rotation21=ct,it._rotation22=pt,mt=j._rotation00*T._positionX+j._rotation01*T._positionY+j._rotation02*T._positionZ,bt=j._rotation10*T._positionX+j._rotation11*T._positionY+j._rotation12*T._positionZ,xt=j._rotation20*T._positionX+j._rotation21*T._positionY+j._rotation22*T._positionZ,it._positionX=mt,it._positionY=bt,it._positionZ=xt,it._positionX+=j._positionX,it._positionY+=j._positionY,it._positionZ+=j._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),dt=i._aabb._minX,yt=i._aabb._minY,ft=i._aabb._minZ,gt=i._aabb._maxX,vt=i._aabb._maxY,Xt=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=dt<i._aabb._minX?dt:i._aabb._minX,i._aabb._minY=yt<i._aabb._minY?yt:i._aabb._minY,i._aabb._minZ=ft<i._aabb._minZ?ft:i._aabb._minZ,i._aabb._maxX=gt>i._aabb._maxX?gt:i._aabb._maxX,i._aabb._maxY=vt>i._aabb._maxY?vt:i._aabb._maxY,i._aabb._maxZ=Xt>i._aabb._maxZ?Xt:i._aabb._maxZ,null!=i._proxy){var ut,zt,Yt;ut=i._transform._positionX-i._ptransform._positionX,zt=i._transform._positionY-i._ptransform._positionY,Yt=i._transform._positionZ-i._ptransform._positionZ;var Zt=i.displacement;Zt.x=ut,Zt.y=zt,Zt.z=Yt,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=F}}},getAabb:function(){return this._aabb.clone()},getAabbTo:function(o){o.copyFrom(this._aabb)},getGeometry:function(){return this._geom},getRigidBody:function(){return this._rigidBody},getCollisionGroup:function(){return this._collisionGroup},setCollisionGroup:function(o){this._collisionGroup=o},getCollisionMask:function(){return this._collisionMask},setCollisionMask:function(o){this._collisionMask=o},getContactCallback:function(){return this._contactCallback},setContactCallback:function(o){this._contactCallback=o},getPrev:function(){return this._prev},getNext:function(){return this._next}};var oimo_dynamics_rigidbody_ShapeConfig=function(){this.position=new oimo_common_Vec3,this.rotation=new oimo_common_Mat3,this.friction=oimo_common_Setting.defaultFriction,this.restitution=oimo_common_Setting.defaultRestitution,this.density=oimo_common_Setting.defaultDensity,this.collisionGroup=oimo_common_Setting.defaultCollisionGroup,this.collisionMask=oimo_common_Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null};oimo_collision_broadphase_BroadPhaseType._BRUTE_FORCE=1,oimo_collision_broadphase_BroadPhaseType._BVH=2,oimo_collision_broadphase_BroadPhaseType.BRUTE_FORCE=1,oimo_collision_broadphase_BroadPhaseType.BVH=2,oimo_collision_broadphase_bvh_BvhInsertionStrategy.SIMPLE=0,oimo_collision_broadphase_bvh_BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,oimo_collision_geometry_GeometryType._SPHERE=0,oimo_collision_geometry_GeometryType._BOX=1,oimo_collision_geometry_GeometryType._CYLINDER=2,oimo_collision_geometry_GeometryType._CONE=3,oimo_collision_geometry_GeometryType._CAPSULE=4,oimo_collision_geometry_GeometryType._CONVEX_HULL=5,oimo_collision_geometry_GeometryType._CONVEX_MIN=0,oimo_collision_geometry_GeometryType._CONVEX_MAX=5,oimo_collision_geometry_GeometryType.SPHERE=0,oimo_collision_geometry_GeometryType.BOX=1,oimo_collision_geometry_GeometryType.CYLINDER=2,oimo_collision_geometry_GeometryType.CONE=3,oimo_collision_geometry_GeometryType.CAPSULE=4,oimo_collision_geometry_GeometryType.CONVEX_HULL=5,oimo_collision_narrowphase_detector_BoxBoxDetector.EDGE_BIAS_MULT=1,oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState.OK=0,oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState.INVALID_TRIANGLE=1,oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState.EDGE_LOOP_BROKEN=4,oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState.NO_OUTER_TRIANGLE=5,oimo_collision_narrowphase_detector_gjkepa_EpaPolyhedronState.TRIANGLE_INVISIBLE=6,oimo_collision_narrowphase_detector_gjkepa_EpaTriangle.count=0,oimo_common_Vec3.numCreations=0,oimo_common_Setting.defaultFriction=.2,oimo_common_Setting.defaultRestitution=.2,oimo_common_Setting.defaultDensity=1,oimo_common_Setting.defaultCollisionGroup=1,oimo_common_Setting.defaultCollisionMask=1,oimo_common_Setting.maxTranslationPerStep=20,oimo_common_Setting.maxRotationPerStep=3.14159265358979,oimo_common_Setting.bvhProxyPadding=.1,oimo_common_Setting.bvhIncrementalCollisionThreshold=.45,oimo_common_Setting.defaultGJKMargin=.05,oimo_common_Setting.enableGJKCaching=!0,oimo_common_Setting.maxEPAVertices=128,oimo_common_Setting.maxEPAPolyhedronFaces=128,oimo_common_Setting.contactEnableBounceThreshold=.5,oimo_common_Setting.velocityBaumgarte=.2,oimo_common_Setting.positionSplitImpulseBaumgarte=.4,oimo_common_Setting.positionNgsBaumgarte=1,oimo_common_Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,oimo_common_Setting.defaultContactPositionCorrectionAlgorithm=0,oimo_common_Setting.alternativeContactPositionCorrectionAlgorithm=1,oimo_common_Setting.contactPersistenceThreshold=.05,oimo_common_Setting.maxManifoldPoints=4,oimo_common_Setting.defaultJointConstraintSolverType=0,oimo_common_Setting.defaultJointPositionCorrectionAlgorithm=0,oimo_common_Setting.jointWarmStartingFactorForBaungarte=.8,oimo_common_Setting.jointWarmStartingFactor=.95,oimo_common_Setting.minSpringDamperDampingRatio=1e-6,oimo_common_Setting.minRagdollMaxSwingAngle=1e-6,oimo_common_Setting.maxJacobianRows=6,oimo_common_Setting.directMlcpSolverEps=1e-9,oimo_common_Setting.islandInitialRigidBodyArraySize=128,oimo_common_Setting.islandInitialConstraintArraySize=128,oimo_common_Setting.sleepingVelocityThreshold=.2,oimo_common_Setting.sleepingAngularVelocityThreshold=.5,oimo_common_Setting.sleepingTimeThreshold=1,oimo_common_Setting.disableSleeping=!1,oimo_common_Setting.linearSlop=.005,oimo_common_Setting.angularSlop=.017453292519943278,oimo_collision_narrowphase_detector_gjkepa_GjkEpa.instance=new oimo_collision_narrowphase_detector_gjkepa_GjkEpa,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState._SUCCEEDED=0,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState._EPA_FAILED_TO_INIT=257,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.SUCCEEDED=0,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.EPA_FAILED_TO_INIT=257,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,oimo_common_Mat3.numCreations=0,oimo_common_Mat4.numCreations=0,oimo_common_MathUtil.POSITIVE_INFINITY=1/0,oimo_common_MathUtil.NEGATIVE_INFINITY=-1/0,oimo_common_MathUtil.PI=3.14159265358979,oimo_common_MathUtil.TWO_PI=6.28318530717958,oimo_common_MathUtil.HALF_PI=1.570796326794895,oimo_common_MathUtil.TO_RADIANS=.017453292519943278,oimo_common_MathUtil.TO_DEGREES=57.29577951308238,oimo_common_Quat.numCreations=0,oimo_dynamics_common_DebugDraw.SPHERE_PHI_DIVISION=8,oimo_dynamics_common_DebugDraw.SPHERE_THETA_DIVISION=4,oimo_dynamics_common_DebugDraw.CIRCLE_THETA_DIVISION=8,oimo_dynamics_common_Performance.broadPhaseCollisionTime=0,oimo_dynamics_common_Performance.narrowPhaseCollisionTime=0,oimo_dynamics_common_Performance.dynamicsTime=0,oimo_dynamics_common_Performance.totalTime=0,oimo_dynamics_constraint_PositionCorrectionAlgorithm._BAUMGARTE=0,oimo_dynamics_constraint_PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,oimo_dynamics_constraint_PositionCorrectionAlgorithm._NGS=2,oimo_dynamics_constraint_PositionCorrectionAlgorithm.BAUMGARTE=0,oimo_dynamics_constraint_PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,oimo_dynamics_constraint_PositionCorrectionAlgorithm.NGS=2,oimo_dynamics_constraint_info_JacobianRow.BIT_LINEAR_SET=1,oimo_dynamics_constraint_info_JacobianRow.BIT_ANGULAR_SET=2,oimo_dynamics_constraint_joint_JointType._SPHERICAL=0,oimo_dynamics_constraint_joint_JointType._REVOLUTE=1,oimo_dynamics_constraint_joint_JointType._CYLINDRICAL=2,oimo_dynamics_constraint_joint_JointType._PRISMATIC=3,oimo_dynamics_constraint_joint_JointType._UNIVERSAL=4,oimo_dynamics_constraint_joint_JointType._RAGDOLL=5,oimo_dynamics_constraint_joint_JointType.SPHERICAL=0,oimo_dynamics_constraint_joint_JointType.REVOLUTE=1,oimo_dynamics_constraint_joint_JointType.CYLINDRICAL=2,oimo_dynamics_constraint_joint_JointType.PRISMATIC=3,oimo_dynamics_constraint_joint_JointType.UNIVERSAL=4,oimo_dynamics_constraint_joint_JointType.RAGDOLL=5,oimo_dynamics_constraint_solver_ConstraintSolverType._ITERATIVE=0,oimo_dynamics_constraint_solver_ConstraintSolverType._DIRECT=1,oimo_dynamics_constraint_solver_ConstraintSolverType.ITERATIVE=0,oimo_dynamics_constraint_solver_ConstraintSolverType.DIRECT=1,oimo_dynamics_rigidbody_RigidBodyType._DYNAMIC=0,oimo_dynamics_rigidbody_RigidBodyType._STATIC=1,oimo_dynamics_rigidbody_RigidBodyType._KINEMATIC=2,oimo_dynamics_rigidbody_RigidBodyType.DYNAMIC=0,oimo_dynamics_rigidbody_RigidBodyType.STATIC=1,oimo_dynamics_rigidbody_RigidBodyType.KINEMATIC=2;const OIMO={};OIMO.DebugDraw=oimo_dynamics_common_DebugDraw,OIMO.BroadPhase=oimo_collision_broadphase_BroadPhase,oimo_collision_broadphase_BroadPhase.prototype.createProxy=oimo_collision_broadphase_BroadPhase.prototype.createProxy,oimo_collision_broadphase_BroadPhase.prototype.destroyProxy=oimo_collision_broadphase_BroadPhase.prototype.destroyProxy,oimo_collision_broadphase_BroadPhase.prototype.moveProxy=oimo_collision_broadphase_BroadPhase.prototype.moveProxy,oimo_collision_broadphase_BroadPhase.prototype.isOverlapping=oimo_collision_broadphase_BroadPhase.prototype.isOverlapping,oimo_collision_broadphase_BroadPhase.prototype.collectPairs=oimo_collision_broadphase_BroadPhase.prototype.collectPairs,oimo_collision_broadphase_BroadPhase.prototype.getProxyPairList=oimo_collision_broadphase_BroadPhase.prototype.getProxyPairList,oimo_collision_broadphase_BroadPhase.prototype.isIncremental=oimo_collision_broadphase_BroadPhase.prototype.isIncremental,oimo_collision_broadphase_BroadPhase.prototype.getTestCount=oimo_collision_broadphase_BroadPhase.prototype.getTestCount,oimo_collision_broadphase_BroadPhase.prototype.rayCast=oimo_collision_broadphase_BroadPhase.prototype.rayCast,oimo_collision_broadphase_BroadPhase.prototype.convexCast=oimo_collision_broadphase_BroadPhase.prototype.convexCast,oimo_collision_broadphase_BroadPhase.prototype.aabbTest=oimo_collision_broadphase_BroadPhase.prototype.aabbTest,OIMO.Geometry=oimo_collision_geometry_Geometry,oimo_collision_geometry_Geometry.prototype.getType=oimo_collision_geometry_Geometry.prototype.getType,oimo_collision_geometry_Geometry.prototype.getVolume=oimo_collision_geometry_Geometry.prototype.getVolume,oimo_collision_geometry_Geometry.prototype.rayCast=oimo_collision_geometry_Geometry.prototype.rayCast,OIMO.ConvexGeometry=oimo_collision_geometry_ConvexGeometry,oimo_collision_geometry_ConvexGeometry.prototype.getGjkMergin=oimo_collision_geometry_ConvexGeometry.prototype.getGjkMergin,oimo_collision_geometry_ConvexGeometry.prototype.setGjkMergin=oimo_collision_geometry_ConvexGeometry.prototype.setGjkMergin,oimo_collision_geometry_ConvexGeometry.prototype.computeLocalSupportingVertex=oimo_collision_geometry_ConvexGeometry.prototype.computeLocalSupportingVertex,oimo_collision_geometry_ConvexGeometry.prototype.rayCast=oimo_collision_geometry_ConvexGeometry.prototype.rayCast,OIMO.BroadPhaseProxyCallback=oimo_collision_broadphase_BroadPhaseProxyCallback,oimo_collision_broadphase_BroadPhaseProxyCallback.prototype.process=oimo_collision_broadphase_BroadPhaseProxyCallback.prototype.process,OIMO.BroadPhaseType=oimo_collision_broadphase_BroadPhaseType,OIMO.Proxy=oimo_collision_broadphase_Proxy,oimo_collision_broadphase_Proxy.prototype.getId=oimo_collision_broadphase_Proxy.prototype.getId,oimo_collision_broadphase_Proxy.prototype.getFatAabb=oimo_collision_broadphase_Proxy.prototype.getFatAabb,oimo_collision_broadphase_Proxy.prototype.getFatAabbTo=oimo_collision_broadphase_Proxy.prototype.getFatAabbTo,OIMO.ProxyPair=oimo_collision_broadphase_ProxyPair,oimo_collision_broadphase_ProxyPair.prototype.getProxy1=oimo_collision_broadphase_ProxyPair.prototype.getProxy1,oimo_collision_broadphase_ProxyPair.prototype.getProxy2=oimo_collision_broadphase_ProxyPair.prototype.getProxy2,oimo_collision_broadphase_ProxyPair.prototype.getNext=oimo_collision_broadphase_ProxyPair.prototype.getNext,OIMO.BruteForceBroadPhase=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.createProxy=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.createProxy,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.destroyProxy=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.destroyProxy,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.moveProxy=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.moveProxy,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.collectPairs=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.collectPairs,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.rayCast=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.rayCast,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.convexCast=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.convexCast,oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.aabbTest=oimo_collision_broadphase_bruteforce_BruteForceBroadPhase.prototype.aabbTest,OIMO.BvhBroadPhase=oimo_collision_broadphase_bvh_BvhBroadPhase,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.createProxy=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.createProxy,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.destroyProxy=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.destroyProxy,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.moveProxy=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.moveProxy,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.collectPairs=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.collectPairs,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.rayCast=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.rayCast,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.convexCast=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.convexCast,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.aabbTest=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.aabbTest,oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.getTreeBalance=oimo_collision_broadphase_bvh_BvhBroadPhase.prototype.getTreeBalance,OIMO.Aabb=oimo_collision_geometry_Aabb,oimo_collision_geometry_Aabb.prototype.init=oimo_collision_geometry_Aabb.prototype.init,oimo_collision_geometry_Aabb.prototype.getMin=oimo_collision_geometry_Aabb.prototype.getMin,oimo_collision_geometry_Aabb.prototype.getMinTo=oimo_collision_geometry_Aabb.prototype.getMinTo,oimo_collision_geometry_Aabb.prototype.setMin=oimo_collision_geometry_Aabb.prototype.setMin,oimo_collision_geometry_Aabb.prototype.getMax=oimo_collision_geometry_Aabb.prototype.getMax,oimo_collision_geometry_Aabb.prototype.getMaxTo=oimo_collision_geometry_Aabb.prototype.getMaxTo,oimo_collision_geometry_Aabb.prototype.setMax=oimo_collision_geometry_Aabb.prototype.setMax,oimo_collision_geometry_Aabb.prototype.getCenter=oimo_collision_geometry_Aabb.prototype.getCenter,oimo_collision_geometry_Aabb.prototype.getCenterTo=oimo_collision_geometry_Aabb.prototype.getCenterTo,oimo_collision_geometry_Aabb.prototype.getExtents=oimo_collision_geometry_Aabb.prototype.getExtents,oimo_collision_geometry_Aabb.prototype.getExtentsTo=oimo_collision_geometry_Aabb.prototype.getExtentsTo,oimo_collision_geometry_Aabb.prototype.combine=oimo_collision_geometry_Aabb.prototype.combine,oimo_collision_geometry_Aabb.prototype.combined=oimo_collision_geometry_Aabb.prototype.combined,oimo_collision_geometry_Aabb.prototype.overlap=oimo_collision_geometry_Aabb.prototype.overlap,oimo_collision_geometry_Aabb.prototype.getIntersection=oimo_collision_geometry_Aabb.prototype.getIntersection,oimo_collision_geometry_Aabb.prototype.getIntersectionTo=oimo_collision_geometry_Aabb.prototype.getIntersectionTo,oimo_collision_geometry_Aabb.prototype.copyFrom=oimo_collision_geometry_Aabb.prototype.copyFrom,oimo_collision_geometry_Aabb.prototype.clone=oimo_collision_geometry_Aabb.prototype.clone,OIMO.BoxGeometry=oimo_collision_geometry_BoxGeometry,oimo_collision_geometry_BoxGeometry.prototype.getHalfExtents=oimo_collision_geometry_BoxGeometry.prototype.getHalfExtents,oimo_collision_geometry_BoxGeometry.prototype.getHalfExtentsTo=oimo_collision_geometry_BoxGeometry.prototype.getHalfExtentsTo,oimo_collision_geometry_BoxGeometry.prototype.computeLocalSupportingVertex=oimo_collision_geometry_BoxGeometry.prototype.computeLocalSupportingVertex,OIMO.CapsuleGeometry=oimo_collision_geometry_CapsuleGeometry,oimo_collision_geometry_CapsuleGeometry.prototype.getRadius=oimo_collision_geometry_CapsuleGeometry.prototype.getRadius,oimo_collision_geometry_CapsuleGeometry.prototype.getHalfHeight=oimo_collision_geometry_CapsuleGeometry.prototype.getHalfHeight,oimo_collision_geometry_CapsuleGeometry.prototype.computeLocalSupportingVertex=oimo_collision_geometry_CapsuleGeometry.prototype.computeLocalSupportingVertex,OIMO.ConeGeometry=oimo_collision_geometry_ConeGeometry,oimo_collision_geometry_ConeGeometry.prototype.getRadius=oimo_collision_geometry_ConeGeometry.prototype.getRadius,oimo_collision_geometry_ConeGeometry.prototype.getHalfHeight=oimo_collision_geometry_ConeGeometry.prototype.getHalfHeight,oimo_collision_geometry_ConeGeometry.prototype.computeLocalSupportingVertex=oimo_collision_geometry_ConeGeometry.prototype.computeLocalSupportingVertex,OIMO.ConvexHullGeometry=oimo_collision_geometry_ConvexHullGeometry,oimo_collision_geometry_ConvexHullGeometry.prototype.getVertices=oimo_collision_geometry_ConvexHullGeometry.prototype.getVertices,oimo_collision_geometry_ConvexHullGeometry.prototype.computeLocalSupportingVertex=oimo_collision_geometry_ConvexHullGeometry.prototype.computeLocalSupportingVertex,OIMO.CylinderGeometry=oimo_collision_geometry_CylinderGeometry,oimo_collision_geometry_CylinderGeometry.prototype.getRadius=oimo_collision_geometry_CylinderGeometry.prototype.getRadius,oimo_collision_geometry_CylinderGeometry.prototype.getHalfHeight=oimo_collision_geometry_CylinderGeometry.prototype.getHalfHeight,oimo_collision_geometry_CylinderGeometry.prototype.computeLocalSupportingVertex=oimo_collision_geometry_CylinderGeometry.prototype.computeLocalSupportingVertex,OIMO.GeometryType=oimo_collision_geometry_GeometryType,OIMO.RayCastHit=oimo_collision_geometry_RayCastHit,OIMO.SphereGeometry=oimo_collision_geometry_SphereGeometry,oimo_collision_geometry_SphereGeometry.prototype.getRadius=oimo_collision_geometry_SphereGeometry.prototype.getRadius,oimo_collision_geometry_SphereGeometry.prototype.computeLocalSupportingVertex=oimo_collision_geometry_SphereGeometry.prototype.computeLocalSupportingVertex,OIMO.CollisionMatrix=oimo_collision_narrowphase_CollisionMatrix,oimo_collision_narrowphase_CollisionMatrix.prototype.getDetector=oimo_collision_narrowphase_CollisionMatrix.prototype.getDetector,OIMO.DetectorResult=oimo_collision_narrowphase_DetectorResult,oimo_collision_narrowphase_DetectorResult.prototype.getMaxDepth=oimo_collision_narrowphase_DetectorResult.prototype.getMaxDepth,oimo_collision_narrowphase_DetectorResult.prototype.clear=oimo_collision_narrowphase_DetectorResult.prototype.clear,OIMO.DetectorResultPoint=oimo_collision_narrowphase_DetectorResultPoint,OIMO.Detector=oimo_collision_narrowphase_detector_Detector,oimo_collision_narrowphase_detector_Detector.prototype.detect=oimo_collision_narrowphase_detector_Detector.prototype.detect,OIMO.BoxBoxDetector=oimo_collision_narrowphase_detector_BoxBoxDetector,OIMO.CapsuleCapsuleDetector=oimo_collision_narrowphase_detector_CapsuleCapsuleDetector,OIMO.GjkEpaDetector=oimo_collision_narrowphase_detector_GjkEpaDetector,OIMO.SphereBoxDetector=oimo_collision_narrowphase_detector_SphereBoxDetector,OIMO.SphereCapsuleDetector=oimo_collision_narrowphase_detector_SphereCapsuleDetector,OIMO.SphereSphereDetector=oimo_collision_narrowphase_detector_SphereSphereDetector,OIMO.Vec3=oimo_common_Vec3,oimo_common_Vec3.prototype.init=oimo_common_Vec3.prototype.init,oimo_common_Vec3.prototype.zero=oimo_common_Vec3.prototype.zero,oimo_common_Vec3.prototype.add=oimo_common_Vec3.prototype.add,oimo_common_Vec3.prototype.addScaled=oimo_common_Vec3.prototype.addScaled,oimo_common_Vec3.prototype.sub=oimo_common_Vec3.prototype.sub,oimo_common_Vec3.prototype.scale=oimo_common_Vec3.prototype.scale,oimo_common_Vec3.prototype.scale3=oimo_common_Vec3.prototype.scale3,oimo_common_Vec3.prototype.dot=oimo_common_Vec3.prototype.dot,oimo_common_Vec3.prototype.cross=oimo_common_Vec3.prototype.cross,oimo_common_Vec3.prototype.addEq=oimo_common_Vec3.prototype.addEq,oimo_common_Vec3.prototype.addScaledEq=oimo_common_Vec3.prototype.addScaledEq,oimo_common_Vec3.prototype.subEq=oimo_common_Vec3.prototype.subEq,oimo_common_Vec3.prototype.scaleEq=oimo_common_Vec3.prototype.scaleEq,oimo_common_Vec3.prototype.scale3Eq=oimo_common_Vec3.prototype.scale3Eq,oimo_common_Vec3.prototype.crossEq=oimo_common_Vec3.prototype.crossEq,oimo_common_Vec3.prototype.mulMat3=oimo_common_Vec3.prototype.mulMat3,oimo_common_Vec3.prototype.mulMat4=oimo_common_Vec3.prototype.mulMat4,oimo_common_Vec3.prototype.mulTransform=oimo_common_Vec3.prototype.mulTransform,oimo_common_Vec3.prototype.mulMat3Eq=oimo_common_Vec3.prototype.mulMat3Eq,oimo_common_Vec3.prototype.mulMat4Eq=oimo_common_Vec3.prototype.mulMat4Eq,oimo_common_Vec3.prototype.mulTransformEq=oimo_common_Vec3.prototype.mulTransformEq,oimo_common_Vec3.prototype.length=oimo_common_Vec3.prototype.length,oimo_common_Vec3.prototype.lengthSq=oimo_common_Vec3.prototype.lengthSq,oimo_common_Vec3.prototype.normalized=oimo_common_Vec3.prototype.normalized,oimo_common_Vec3.prototype.normalize=oimo_common_Vec3.prototype.normalize,oimo_common_Vec3.prototype.negate=oimo_common_Vec3.prototype.negate,oimo_common_Vec3.prototype.negateEq=oimo_common_Vec3.prototype.negateEq,oimo_common_Vec3.prototype.copyFrom=oimo_common_Vec3.prototype.copyFrom,oimo_common_Vec3.prototype.clone=oimo_common_Vec3.prototype.clone,oimo_common_Vec3.prototype.toString=oimo_common_Vec3.prototype.toString,OIMO.Transform=oimo_common_Transform,oimo_common_Transform.prototype.identity=oimo_common_Transform.prototype.identity,oimo_common_Transform.prototype.getPosition=oimo_common_Transform.prototype.getPosition,oimo_common_Transform.prototype.getPositionTo=oimo_common_Transform.prototype.getPositionTo,oimo_common_Transform.prototype.setPosition=oimo_common_Transform.prototype.setPosition,oimo_common_Transform.prototype.translate=oimo_common_Transform.prototype.translate,oimo_common_Transform.prototype.getRotation=oimo_common_Transform.prototype.getRotation,oimo_common_Transform.prototype.getRotationTo=oimo_common_Transform.prototype.getRotationTo,oimo_common_Transform.prototype.setRotation=oimo_common_Transform.prototype.setRotation,oimo_common_Transform.prototype.setRotationXyz=oimo_common_Transform.prototype.setRotationXyz,oimo_common_Transform.prototype.rotate=oimo_common_Transform.prototype.rotate,oimo_common_Transform.prototype.rotateXyz=oimo_common_Transform.prototype.rotateXyz,oimo_common_Transform.prototype.getOrientation=oimo_common_Transform.prototype.getOrientation,oimo_common_Transform.prototype.getOrientationTo=oimo_common_Transform.prototype.getOrientationTo,oimo_common_Transform.prototype.setOrientation=oimo_common_Transform.prototype.setOrientation,oimo_common_Transform.prototype.clone=oimo_common_Transform.prototype.clone,oimo_common_Transform.prototype.copyFrom=oimo_common_Transform.prototype.copyFrom,OIMO.Setting=oimo_common_Setting,OIMO.GjkEpa=oimo_collision_narrowphase_detector_gjkepa_GjkEpa,oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.computeClosestPoints=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.computeClosestPoints,oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.computeDistance=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.computeDistance,oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.convexCast=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.convexCast,oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.rayCast=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.prototype.rayCast,oimo_collision_narrowphase_detector_gjkepa_GjkEpa.getInstance=oimo_collision_narrowphase_detector_gjkepa_GjkEpa.getInstance,OIMO.GjkEpaResultState=oimo_collision_narrowphase_detector_gjkepa_GjkEpaResultState,OIMO.SimplexUtil=oimo_collision_narrowphase_detector_gjkepa_SimplexUtil,oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin2=oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin2,oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin3=oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin3,oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin4=oimo_collision_narrowphase_detector_gjkepa_SimplexUtil.projectOrigin4,OIMO.Mat3=oimo_common_Mat3,oimo_common_Mat3.prototype.init=oimo_common_Mat3.prototype.init,oimo_common_Mat3.prototype.identity=oimo_common_Mat3.prototype.identity,oimo_common_Mat3.prototype.add=oimo_common_Mat3.prototype.add,oimo_common_Mat3.prototype.sub=oimo_common_Mat3.prototype.sub,oimo_common_Mat3.prototype.scale=oimo_common_Mat3.prototype.scale,oimo_common_Mat3.prototype.mul=oimo_common_Mat3.prototype.mul,oimo_common_Mat3.prototype.addEq=oimo_common_Mat3.prototype.addEq,oimo_common_Mat3.prototype.subEq=oimo_common_Mat3.prototype.subEq,oimo_common_Mat3.prototype.scaleEq=oimo_common_Mat3.prototype.scaleEq,oimo_common_Mat3.prototype.mulEq=oimo_common_Mat3.prototype.mulEq,oimo_common_Mat3.prototype.prependScale=oimo_common_Mat3.prototype.prependScale,oimo_common_Mat3.prototype.appendScale=oimo_common_Mat3.prototype.appendScale,oimo_common_Mat3.prototype.prependRotation=oimo_common_Mat3.prototype.prependRotation,oimo_common_Mat3.prototype.appendRotation=oimo_common_Mat3.prototype.appendRotation,oimo_common_Mat3.prototype.prependScaleEq=oimo_common_Mat3.prototype.prependScaleEq,oimo_common_Mat3.prototype.appendScaleEq=oimo_common_Mat3.prototype.appendScaleEq,oimo_common_Mat3.prototype.prependRotationEq=oimo_common_Mat3.prototype.prependRotationEq,oimo_common_Mat3.prototype.appendRotationEq=oimo_common_Mat3.prototype.appendRotationEq,oimo_common_Mat3.prototype.transpose=oimo_common_Mat3.prototype.transpose,oimo_common_Mat3.prototype.transposeEq=oimo_common_Mat3.prototype.transposeEq,oimo_common_Mat3.prototype.determinant=oimo_common_Mat3.prototype.determinant,oimo_common_Mat3.prototype.trace=oimo_common_Mat3.prototype.trace,oimo_common_Mat3.prototype.inverse=oimo_common_Mat3.prototype.inverse,oimo_common_Mat3.prototype.inverseEq=oimo_common_Mat3.prototype.inverseEq,oimo_common_Mat3.prototype.toArray=oimo_common_Mat3.prototype.toArray,oimo_common_Mat3.prototype.copyFrom=oimo_common_Mat3.prototype.copyFrom,oimo_common_Mat3.prototype.clone=oimo_common_Mat3.prototype.clone,oimo_common_Mat3.prototype.fromQuat=oimo_common_Mat3.prototype.fromQuat,oimo_common_Mat3.prototype.toQuat=oimo_common_Mat3.prototype.toQuat,oimo_common_Mat3.prototype.fromEulerXyz=oimo_common_Mat3.prototype.fromEulerXyz,oimo_common_Mat3.prototype.toEulerXyz=oimo_common_Mat3.prototype.toEulerXyz,oimo_common_Mat3.prototype.getRow=oimo_common_Mat3.prototype.getRow,oimo_common_Mat3.prototype.getCol=oimo_common_Mat3.prototype.getCol,oimo_common_Mat3.prototype.getRowTo=oimo_common_Mat3.prototype.getRowTo,oimo_common_Mat3.prototype.getColTo=oimo_common_Mat3.prototype.getColTo,oimo_common_Mat3.prototype.fromRows=oimo_common_Mat3.prototype.fromRows,oimo_common_Mat3.prototype.fromCols=oimo_common_Mat3.prototype.fromCols,oimo_common_Mat3.prototype.toString=oimo_common_Mat3.prototype.toString,OIMO.Mat4=oimo_common_Mat4,oimo_common_Mat4.prototype.init=oimo_common_Mat4.prototype.init,oimo_common_Mat4.prototype.identity=oimo_common_Mat4.prototype.identity,oimo_common_Mat4.prototype.add=oimo_common_Mat4.prototype.add,oimo_common_Mat4.prototype.sub=oimo_common_Mat4.prototype.sub,oimo_common_Mat4.prototype.scale=oimo_common_Mat4.prototype.scale,oimo_common_Mat4.prototype.mul=oimo_common_Mat4.prototype.mul,oimo_common_Mat4.prototype.addEq=oimo_common_Mat4.prototype.addEq,oimo_common_Mat4.prototype.subEq=oimo_common_Mat4.prototype.subEq,oimo_common_Mat4.prototype.scaleEq=oimo_common_Mat4.prototype.scaleEq,oimo_common_Mat4.prototype.mulEq=oimo_common_Mat4.prototype.mulEq,oimo_common_Mat4.prototype.prependScale=oimo_common_Mat4.prototype.prependScale,oimo_common_Mat4.prototype.appendScale=oimo_common_Mat4.prototype.appendScale,oimo_common_Mat4.prototype.prependRotation=oimo_common_Mat4.prototype.prependRotation,oimo_common_Mat4.prototype.appendRotation=oimo_common_Mat4.prototype.appendRotation,oimo_common_Mat4.prototype.prependTranslation=oimo_common_Mat4.prototype.prependTranslation,oimo_common_Mat4.prototype.appendTranslation=oimo_common_Mat4.prototype.appendTranslation,oimo_common_Mat4.prototype.prependScaleEq=oimo_common_Mat4.prototype.prependScaleEq,oimo_common_Mat4.prototype.appendScaleEq=oimo_common_Mat4.prototype.appendScaleEq,oimo_common_Mat4.prototype.prependRotationEq=oimo_common_Mat4.prototype.prependRotationEq,oimo_common_Mat4.prototype.appendRotationEq=oimo_common_Mat4.prototype.appendRotationEq,oimo_common_Mat4.prototype.prependTranslationEq=oimo_common_Mat4.prototype.prependTranslationEq,oimo_common_Mat4.prototype.appendTranslationEq=oimo_common_Mat4.prototype.appendTranslationEq,oimo_common_Mat4.prototype.transpose=oimo_common_Mat4.prototype.transpose,oimo_common_Mat4.prototype.transposeEq=oimo_common_Mat4.prototype.transposeEq,oimo_common_Mat4.prototype.determinant=oimo_common_Mat4.prototype.determinant,oimo_common_Mat4.prototype.trace=oimo_common_Mat4.prototype.trace,oimo_common_Mat4.prototype.inverse=oimo_common_Mat4.prototype.inverse,oimo_common_Mat4.prototype.inverseEq=oimo_common_Mat4.prototype.inverseEq,oimo_common_Mat4.prototype.lookAt=oimo_common_Mat4.prototype.lookAt,oimo_common_Mat4.prototype.perspective=oimo_common_Mat4.prototype.perspective,oimo_common_Mat4.prototype.ortho=oimo_common_Mat4.prototype.ortho,oimo_common_Mat4.prototype.toArray=oimo_common_Mat4.prototype.toArray,oimo_common_Mat4.prototype.copyFrom=oimo_common_Mat4.prototype.copyFrom,oimo_common_Mat4.prototype.fromMat3=oimo_common_Mat4.prototype.fromMat3,oimo_common_Mat4.prototype.fromTransform=oimo_common_Mat4.prototype.fromTransform,oimo_common_Mat4.prototype.clone=oimo_common_Mat4.prototype.clone,oimo_common_Mat4.prototype.toString=oimo_common_Mat4.prototype.toString,OIMO.MathUtil=oimo_common_MathUtil,oimo_common_MathUtil.abs=oimo_common_MathUtil.abs,oimo_common_MathUtil.sin=oimo_common_MathUtil.sin,oimo_common_MathUtil.cos=oimo_common_MathUtil.cos,oimo_common_MathUtil.tan=oimo_common_MathUtil.tan,oimo_common_MathUtil.asin=oimo_common_MathUtil.asin,oimo_common_MathUtil.acos=oimo_common_MathUtil.acos,oimo_common_MathUtil.atan=oimo_common_MathUtil.atan,oimo_common_MathUtil.safeAsin=oimo_common_MathUtil.safeAsin,oimo_common_MathUtil.safeAcos=oimo_common_MathUtil.safeAcos,oimo_common_MathUtil.atan2=oimo_common_MathUtil.atan2,oimo_common_MathUtil.sqrt=oimo_common_MathUtil.sqrt,oimo_common_MathUtil.clamp=oimo_common_MathUtil.clamp,oimo_common_MathUtil.rand=oimo_common_MathUtil.rand,oimo_common_MathUtil.randIn=oimo_common_MathUtil.randIn,oimo_common_MathUtil.randVec3In=oimo_common_MathUtil.randVec3In,oimo_common_MathUtil.randVec3=oimo_common_MathUtil.randVec3,OIMO.Pool=oimo_common_Pool,oimo_common_Pool.prototype.vec3=oimo_common_Pool.prototype.vec3,oimo_common_Pool.prototype.mat3=oimo_common_Pool.prototype.mat3,oimo_common_Pool.prototype.mat4=oimo_common_Pool.prototype.mat4,oimo_common_Pool.prototype.quat=oimo_common_Pool.prototype.quat,oimo_common_Pool.prototype.dispose=oimo_common_Pool.prototype.dispose,oimo_common_Pool.prototype.disposeVec3=oimo_common_Pool.prototype.disposeVec3,oimo_common_Pool.prototype.disposeMat3=oimo_common_Pool.prototype.disposeMat3,oimo_common_Pool.prototype.disposeMat4=oimo_common_Pool.prototype.disposeMat4,oimo_common_Pool.prototype.disposeQuat=oimo_common_Pool.prototype.disposeQuat,OIMO.Quat=oimo_common_Quat,oimo_common_Quat.prototype.identity=oimo_common_Quat.prototype.identity,oimo_common_Quat.prototype.init=oimo_common_Quat.prototype.init,oimo_common_Quat.prototype.add=oimo_common_Quat.prototype.add,oimo_common_Quat.prototype.sub=oimo_common_Quat.prototype.sub,oimo_common_Quat.prototype.scale=oimo_common_Quat.prototype.scale,oimo_common_Quat.prototype.addEq=oimo_common_Quat.prototype.addEq,oimo_common_Quat.prototype.subEq=oimo_common_Quat.prototype.subEq,oimo_common_Quat.prototype.scaleEq=oimo_common_Quat.prototype.scaleEq,oimo_common_Quat.prototype.length=oimo_common_Quat.prototype.length,oimo_common_Quat.prototype.lengthSq=oimo_common_Quat.prototype.lengthSq,oimo_common_Quat.prototype.dot=oimo_common_Quat.prototype.dot,oimo_common_Quat.prototype.normalized=oimo_common_Quat.prototype.normalized,oimo_common_Quat.prototype.normalize=oimo_common_Quat.prototype.normalize,oimo_common_Quat.prototype.setArc=oimo_common_Quat.prototype.setArc,oimo_common_Quat.prototype.slerp=oimo_common_Quat.prototype.slerp,oimo_common_Quat.prototype.copyFrom=oimo_common_Quat.prototype.copyFrom,oimo_common_Quat.prototype.clone=oimo_common_Quat.prototype.clone,oimo_common_Quat.prototype.fromMat3=oimo_common_Quat.prototype.fromMat3,oimo_common_Quat.prototype.toMat3=oimo_common_Quat.prototype.toMat3,oimo_common_Quat.prototype.toString=oimo_common_Quat.prototype.toString,OIMO.Contact=oimo_dynamics_Contact,oimo_dynamics_Contact.prototype.getShape1=oimo_dynamics_Contact.prototype.getShape1,oimo_dynamics_Contact.prototype.getShape2=oimo_dynamics_Contact.prototype.getShape2,oimo_dynamics_Contact.prototype.isTouching=oimo_dynamics_Contact.prototype.isTouching,oimo_dynamics_Contact.prototype.getManifold=oimo_dynamics_Contact.prototype.getManifold,oimo_dynamics_Contact.prototype.getContactConstraint=oimo_dynamics_Contact.prototype.getContactConstraint,oimo_dynamics_Contact.prototype.getPrev=oimo_dynamics_Contact.prototype.getPrev,oimo_dynamics_Contact.prototype.getNext=oimo_dynamics_Contact.prototype.getNext,OIMO.ContactLink=oimo_dynamics_ContactLink,oimo_dynamics_ContactLink.prototype.getContact=oimo_dynamics_ContactLink.prototype.getContact,oimo_dynamics_ContactLink.prototype.getOther=oimo_dynamics_ContactLink.prototype.getOther,oimo_dynamics_ContactLink.prototype.getPrev=oimo_dynamics_ContactLink.prototype.getPrev,oimo_dynamics_ContactLink.prototype.getNext=oimo_dynamics_ContactLink.prototype.getNext,OIMO.ContactManager=oimo_dynamics_ContactManager,oimo_dynamics_ContactManager.prototype.getNumContacts=oimo_dynamics_ContactManager.prototype.getNumContacts,oimo_dynamics_ContactManager.prototype.getContactList=oimo_dynamics_ContactManager.prototype.getContactList,OIMO.TimeStep=oimo_dynamics_TimeStep,OIMO.World=oimo_dynamics_World,oimo_dynamics_World.prototype.step=oimo_dynamics_World.prototype.step,oimo_dynamics_World.prototype.addRigidBody=oimo_dynamics_World.prototype.addRigidBody,oimo_dynamics_World.prototype.removeRigidBody=oimo_dynamics_World.prototype.removeRigidBody,oimo_dynamics_World.prototype.addJoint=oimo_dynamics_World.prototype.addJoint,oimo_dynamics_World.prototype.removeJoint=oimo_dynamics_World.prototype.removeJoint,oimo_dynamics_World.prototype.setDebugDraw=oimo_dynamics_World.prototype.setDebugDraw,oimo_dynamics_World.prototype.getDebugDraw=oimo_dynamics_World.prototype.getDebugDraw,oimo_dynamics_World.prototype.debugDraw=oimo_dynamics_World.prototype.debugDraw,oimo_dynamics_World.prototype.rayCast=oimo_dynamics_World.prototype.rayCast,oimo_dynamics_World.prototype.convexCast=oimo_dynamics_World.prototype.convexCast,oimo_dynamics_World.prototype.aabbTest=oimo_dynamics_World.prototype.aabbTest,oimo_dynamics_World.prototype.getRigidBodyList=oimo_dynamics_World.prototype.getRigidBodyList,oimo_dynamics_World.prototype.getJointList=oimo_dynamics_World.prototype.getJointList,oimo_dynamics_World.prototype.getBroadPhase=oimo_dynamics_World.prototype.getBroadPhase,oimo_dynamics_World.prototype.getContactManager=oimo_dynamics_World.prototype.getContactManager,oimo_dynamics_World.prototype.getNumRigidBodies=oimo_dynamics_World.prototype.getNumRigidBodies,oimo_dynamics_World.prototype.getNumJoints=oimo_dynamics_World.prototype.getNumJoints,oimo_dynamics_World.prototype.getNumShapes=oimo_dynamics_World.prototype.getNumShapes,oimo_dynamics_World.prototype.getNumIslands=oimo_dynamics_World.prototype.getNumIslands,oimo_dynamics_World.prototype.getNumVelocityIterations=oimo_dynamics_World.prototype.getNumVelocityIterations,oimo_dynamics_World.prototype.setNumVelocityIterations=oimo_dynamics_World.prototype.setNumVelocityIterations,oimo_dynamics_World.prototype.getNumPositionIterations=oimo_dynamics_World.prototype.getNumPositionIterations,oimo_dynamics_World.prototype.setNumPositionIterations=oimo_dynamics_World.prototype.setNumPositionIterations,oimo_dynamics_World.prototype.getGravity=oimo_dynamics_World.prototype.getGravity,oimo_dynamics_World.prototype.setGravity=oimo_dynamics_World.prototype.setGravity,OIMO.AabbTestCallback=oimo_dynamics_callback_AabbTestCallback,OIMO.ContactCallback=oimo_dynamics_callback_ContactCallback,OIMO.RayCastCallback=oimo_dynamics_callback_RayCastCallback,OIMO.RayCastClosest=oimo_dynamics_callback_RayCastClosest,oimo_dynamics_callback_RayCastClosest.prototype.clear=oimo_dynamics_callback_RayCastClosest.prototype.clear,oimo_dynamics_callback_RayCastClosest.prototype.process=oimo_dynamics_callback_RayCastClosest.prototype.process,OIMO.DebugDrawStyle=oimo_dynamics_common_DebugDrawStyle,OIMO.Performance=oimo_dynamics_common_Performance,OIMO.ConstraintSolver=oimo_dynamics_constraint_ConstraintSolver,oimo_dynamics_constraint_ConstraintSolver.prototype.preSolveVelocity=oimo_dynamics_constraint_ConstraintSolver.prototype.preSolveVelocity,oimo_dynamics_constraint_ConstraintSolver.prototype.warmStart=oimo_dynamics_constraint_ConstraintSolver.prototype.warmStart,oimo_dynamics_constraint_ConstraintSolver.prototype.solveVelocity=oimo_dynamics_constraint_ConstraintSolver.prototype.solveVelocity,oimo_dynamics_constraint_ConstraintSolver.prototype.postSolveVelocity=oimo_dynamics_constraint_ConstraintSolver.prototype.postSolveVelocity,oimo_dynamics_constraint_ConstraintSolver.prototype.preSolvePosition=oimo_dynamics_constraint_ConstraintSolver.prototype.preSolvePosition,oimo_dynamics_constraint_ConstraintSolver.prototype.solvePositionSplitImpulse=oimo_dynamics_constraint_ConstraintSolver.prototype.solvePositionSplitImpulse,oimo_dynamics_constraint_ConstraintSolver.prototype.solvePositionNgs=oimo_dynamics_constraint_ConstraintSolver.prototype.solvePositionNgs,oimo_dynamics_constraint_ConstraintSolver.prototype.postSolve=oimo_dynamics_constraint_ConstraintSolver.prototype.postSolve,OIMO.PositionCorrectionAlgorithm=oimo_dynamics_constraint_PositionCorrectionAlgorithm,OIMO.ContactConstraint=oimo_dynamics_constraint_contact_ContactConstraint,oimo_dynamics_constraint_contact_ContactConstraint.prototype.getShape1=oimo_dynamics_constraint_contact_ContactConstraint.prototype.getShape1,oimo_dynamics_constraint_contact_ContactConstraint.prototype.getShape2=oimo_dynamics_constraint_contact_ContactConstraint.prototype.getShape2,oimo_dynamics_constraint_contact_ContactConstraint.prototype.getManifold=oimo_dynamics_constraint_contact_ContactConstraint.prototype.getManifold,oimo_dynamics_constraint_contact_ContactConstraint.prototype.isTouching=oimo_dynamics_constraint_contact_ContactConstraint.prototype.isTouching,OIMO.Manifold=oimo_dynamics_constraint_contact_Manifold,oimo_dynamics_constraint_contact_Manifold.prototype.getNormal=oimo_dynamics_constraint_contact_Manifold.prototype.getNormal,oimo_dynamics_constraint_contact_Manifold.prototype.getNormalTo=oimo_dynamics_constraint_contact_Manifold.prototype.getNormalTo,oimo_dynamics_constraint_contact_Manifold.prototype.getTangent=oimo_dynamics_constraint_contact_Manifold.prototype.getTangent,oimo_dynamics_constraint_contact_Manifold.prototype.getTangentTo=oimo_dynamics_constraint_contact_Manifold.prototype.getTangentTo,oimo_dynamics_constraint_contact_Manifold.prototype.getBinormal=oimo_dynamics_constraint_contact_Manifold.prototype.getBinormal,oimo_dynamics_constraint_contact_Manifold.prototype.getBinormalTo=oimo_dynamics_constraint_contact_Manifold.prototype.getBinormalTo,oimo_dynamics_constraint_contact_Manifold.prototype.getPoints=oimo_dynamics_constraint_contact_Manifold.prototype.getPoints,oimo_dynamics_constraint_contact_Manifold.prototype.getNumPoints=oimo_dynamics_constraint_contact_Manifold.prototype.getNumPoints,OIMO.ManifoldPoint=oimo_dynamics_constraint_contact_ManifoldPoint,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition1=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition1,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition1To=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition1To,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition2=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition2,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition2To=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getPosition2To,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getDepth=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getDepth,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.isWarmStarted=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.isWarmStarted,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getNormalImpulse=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getNormalImpulse,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getTangentImpulse=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getTangentImpulse,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getBinormalImpulse=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.getBinormalImpulse,oimo_dynamics_constraint_contact_ManifoldPoint.prototype.isEnabled=oimo_dynamics_constraint_contact_ManifoldPoint.prototype.isEnabled,OIMO.Joint=oimo_dynamics_constraint_joint_Joint,oimo_dynamics_constraint_joint_Joint.prototype.getRigidBody1=oimo_dynamics_constraint_joint_Joint.prototype.getRigidBody1,oimo_dynamics_constraint_joint_Joint.prototype.getRigidBody2=oimo_dynamics_constraint_joint_Joint.prototype.getRigidBody2,oimo_dynamics_constraint_joint_Joint.prototype.getType=oimo_dynamics_constraint_joint_Joint.prototype.getType,oimo_dynamics_constraint_joint_Joint.prototype.getAnchor1=oimo_dynamics_constraint_joint_Joint.prototype.getAnchor1,oimo_dynamics_constraint_joint_Joint.prototype.getAnchor2=oimo_dynamics_constraint_joint_Joint.prototype.getAnchor2,oimo_dynamics_constraint_joint_Joint.prototype.getAnchor1To=oimo_dynamics_constraint_joint_Joint.prototype.getAnchor1To,oimo_dynamics_constraint_joint_Joint.prototype.getAnchor2To=oimo_dynamics_constraint_joint_Joint.prototype.getAnchor2To,oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor1=oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor1,oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor2=oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor2,oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor1To=oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor1To,oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor2To=oimo_dynamics_constraint_joint_Joint.prototype.getLocalAnchor2To,oimo_dynamics_constraint_joint_Joint.prototype.getBasis1=oimo_dynamics_constraint_joint_Joint.prototype.getBasis1,oimo_dynamics_constraint_joint_Joint.prototype.getBasis2=oimo_dynamics_constraint_joint_Joint.prototype.getBasis2,oimo_dynamics_constraint_joint_Joint.prototype.getBasis1To=oimo_dynamics_constraint_joint_Joint.prototype.getBasis1To,oimo_dynamics_constraint_joint_Joint.prototype.getBasis2To=oimo_dynamics_constraint_joint_Joint.prototype.getBasis2To,oimo_dynamics_constraint_joint_Joint.prototype.getAllowCollision=oimo_dynamics_constraint_joint_Joint.prototype.getAllowCollision,oimo_dynamics_constraint_joint_Joint.prototype.setAllowCollision=oimo_dynamics_constraint_joint_Joint.prototype.setAllowCollision,oimo_dynamics_constraint_joint_Joint.prototype.getBreakForce=oimo_dynamics_constraint_joint_Joint.prototype.getBreakForce,oimo_dynamics_constraint_joint_Joint.prototype.setBreakForce=oimo_dynamics_constraint_joint_Joint.prototype.setBreakForce,oimo_dynamics_constraint_joint_Joint.prototype.getBreakTorque=oimo_dynamics_constraint_joint_Joint.prototype.getBreakTorque,oimo_dynamics_constraint_joint_Joint.prototype.setBreakTorque=oimo_dynamics_constraint_joint_Joint.prototype.setBreakTorque,oimo_dynamics_constraint_joint_Joint.prototype.getPositionCorrectionAlgorithm=oimo_dynamics_constraint_joint_Joint.prototype.getPositionCorrectionAlgorithm,oimo_dynamics_constraint_joint_Joint.prototype.setPositionCorrectionAlgorithm=oimo_dynamics_constraint_joint_Joint.prototype.setPositionCorrectionAlgorithm,oimo_dynamics_constraint_joint_Joint.prototype.getAppliedForce=oimo_dynamics_constraint_joint_Joint.prototype.getAppliedForce,oimo_dynamics_constraint_joint_Joint.prototype.getAppliedForceTo=oimo_dynamics_constraint_joint_Joint.prototype.getAppliedForceTo,oimo_dynamics_constraint_joint_Joint.prototype.getAppliedTorque=oimo_dynamics_constraint_joint_Joint.prototype.getAppliedTorque,oimo_dynamics_constraint_joint_Joint.prototype.getAppliedTorqueTo=oimo_dynamics_constraint_joint_Joint.prototype.getAppliedTorqueTo,oimo_dynamics_constraint_joint_Joint.prototype.getPrev=oimo_dynamics_constraint_joint_Joint.prototype.getPrev,oimo_dynamics_constraint_joint_Joint.prototype.getNext=oimo_dynamics_constraint_joint_Joint.prototype.getNext,OIMO.CylindricalJoint=oimo_dynamics_constraint_joint_CylindricalJoint,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis1=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis1,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis2=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis2,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis1To=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis1To,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis2To=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAxis2To,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis1=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis1,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis2=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis2,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis1To=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis1To,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis2To=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getLocalAxis2To,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getTranslationalSpringDamper=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getTranslationalSpringDamper,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getRotationalSpringDamper=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getRotationalSpringDamper,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getTranslationalLimitMotor=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getTranslationalLimitMotor,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getRotationalLimitMotor=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getRotationalLimitMotor,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAngle=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getAngle,oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getTranslation=oimo_dynamics_constraint_joint_CylindricalJoint.prototype.getTranslation,OIMO.JointConfig=oimo_dynamics_constraint_joint_JointConfig,OIMO.CylindricalJointConfig=oimo_dynamics_constraint_joint_CylindricalJointConfig,oimo_dynamics_constraint_joint_CylindricalJointConfig.prototype.init=oimo_dynamics_constraint_joint_CylindricalJointConfig.prototype.init,OIMO.JointLink=oimo_dynamics_constraint_joint_JointLink,oimo_dynamics_constraint_joint_JointLink.prototype.getContact=oimo_dynamics_constraint_joint_JointLink.prototype.getContact,oimo_dynamics_constraint_joint_JointLink.prototype.getOther=oimo_dynamics_constraint_joint_JointLink.prototype.getOther,oimo_dynamics_constraint_joint_JointLink.prototype.getPrev=oimo_dynamics_constraint_joint_JointLink.prototype.getPrev,oimo_dynamics_constraint_joint_JointLink.prototype.getNext=oimo_dynamics_constraint_joint_JointLink.prototype.getNext,OIMO.JointType=oimo_dynamics_constraint_joint_JointType,OIMO.PrismaticJoint=oimo_dynamics_constraint_joint_PrismaticJoint,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis1=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis1,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis2=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis2,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis1To=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis1To,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis2To=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getAxis2To,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis1=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis1,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis2=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis2,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis1To=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis1To,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis2To=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLocalAxis2To,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getSpringDamper=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getSpringDamper,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLimitMotor=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getLimitMotor,oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getTranslation=oimo_dynamics_constraint_joint_PrismaticJoint.prototype.getTranslation,OIMO.PrismaticJointConfig=oimo_dynamics_constraint_joint_PrismaticJointConfig,oimo_dynamics_constraint_joint_PrismaticJointConfig.prototype.init=oimo_dynamics_constraint_joint_PrismaticJointConfig.prototype.init,OIMO.RagdollJoint=oimo_dynamics_constraint_joint_RagdollJoint,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis1=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis1,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis2=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis2,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis1To=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis1To,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis2To=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getAxis2To,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis1=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis1,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis2=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis2,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis1To=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis1To,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis2To=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getLocalAxis2To,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getTwistSpringDamper=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getTwistSpringDamper,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getTwistLimitMotor=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getTwistLimitMotor,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingSpringDamper=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingSpringDamper,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingAxis=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingAxis,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingAxisTo=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingAxisTo,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingAngle=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getSwingAngle,oimo_dynamics_constraint_joint_RagdollJoint.prototype.getTwistAngle=oimo_dynamics_constraint_joint_RagdollJoint.prototype.getTwistAngle,OIMO.RagdollJointConfig=oimo_dynamics_constraint_joint_RagdollJointConfig,oimo_dynamics_constraint_joint_RagdollJointConfig.prototype.init=oimo_dynamics_constraint_joint_RagdollJointConfig.prototype.init,OIMO.RevoluteJoint=oimo_dynamics_constraint_joint_RevoluteJoint,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis1=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis1,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis2=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis2,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis1To=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis1To,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis2To=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAxis2To,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis1=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis1,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis2=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis2,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis1To=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis1To,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis2To=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLocalAxis2To,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getSpringDamper=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getSpringDamper,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLimitMotor=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getLimitMotor,oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAngle=oimo_dynamics_constraint_joint_RevoluteJoint.prototype.getAngle,OIMO.RevoluteJointConfig=oimo_dynamics_constraint_joint_RevoluteJointConfig,oimo_dynamics_constraint_joint_RevoluteJointConfig.prototype.init=oimo_dynamics_constraint_joint_RevoluteJointConfig.prototype.init,OIMO.RotationalLimitMotor=oimo_dynamics_constraint_joint_RotationalLimitMotor,oimo_dynamics_constraint_joint_RotationalLimitMotor.prototype.setLimits=oimo_dynamics_constraint_joint_RotationalLimitMotor.prototype.setLimits,oimo_dynamics_constraint_joint_RotationalLimitMotor.prototype.setMotor=oimo_dynamics_constraint_joint_RotationalLimitMotor.prototype.setMotor,oimo_dynamics_constraint_joint_RotationalLimitMotor.prototype.clone=oimo_dynamics_constraint_joint_RotationalLimitMotor.prototype.clone,OIMO.SphericalJoint=oimo_dynamics_constraint_joint_SphericalJoint,oimo_dynamics_constraint_joint_SphericalJoint.prototype.getSpringDamper=oimo_dynamics_constraint_joint_SphericalJoint.prototype.getSpringDamper,OIMO.SphericalJointConfig=oimo_dynamics_constraint_joint_SphericalJointConfig,oimo_dynamics_constraint_joint_SphericalJointConfig.prototype.init=oimo_dynamics_constraint_joint_SphericalJointConfig.prototype.init,OIMO.SpringDamper=oimo_dynamics_constraint_joint_SpringDamper,oimo_dynamics_constraint_joint_SpringDamper.prototype.setSpring=oimo_dynamics_constraint_joint_SpringDamper.prototype.setSpring,oimo_dynamics_constraint_joint_SpringDamper.prototype.setSymplecticEuler=oimo_dynamics_constraint_joint_SpringDamper.prototype.setSymplecticEuler,oimo_dynamics_constraint_joint_SpringDamper.prototype.clone=oimo_dynamics_constraint_joint_SpringDamper.prototype.clone,OIMO.TranslationalLimitMotor=oimo_dynamics_constraint_joint_TranslationalLimitMotor,oimo_dynamics_constraint_joint_TranslationalLimitMotor.prototype.setLimits=oimo_dynamics_constraint_joint_TranslationalLimitMotor.prototype.setLimits,oimo_dynamics_constraint_joint_TranslationalLimitMotor.prototype.setMotor=oimo_dynamics_constraint_joint_TranslationalLimitMotor.prototype.setMotor,oimo_dynamics_constraint_joint_TranslationalLimitMotor.prototype.clone=oimo_dynamics_constraint_joint_TranslationalLimitMotor.prototype.clone,OIMO.UniversalJoint=oimo_dynamics_constraint_joint_UniversalJoint,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis1=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis1,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis2=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis2,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis1To=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis1To,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis2To=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAxis2To,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis1=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis1,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis2=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis2,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis1To=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis1To,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis2To=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLocalAxis2To,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getSpringDamper1=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getSpringDamper1,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getSpringDamper2=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getSpringDamper2,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLimitMotor1=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLimitMotor1,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLimitMotor2=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getLimitMotor2,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAngle1=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAngle1,oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAngle2=oimo_dynamics_constraint_joint_UniversalJoint.prototype.getAngle2,OIMO.UniversalJointConfig=oimo_dynamics_constraint_joint_UniversalJointConfig,oimo_dynamics_constraint_joint_UniversalJointConfig.prototype.init=oimo_dynamics_constraint_joint_UniversalJointConfig.prototype.init,OIMO.ConstraintSolverType=oimo_dynamics_constraint_solver_ConstraintSolverType,OIMO.DirectJointConstraintSolver=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.preSolveVelocity=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.preSolveVelocity,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.warmStart=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.warmStart,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.solveVelocity=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.solveVelocity,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.postSolveVelocity=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.postSolveVelocity,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.preSolvePosition=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.preSolvePosition,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.solvePositionSplitImpulse=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.solvePositionSplitImpulse,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.solvePositionNgs=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.solvePositionNgs,oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.postSolve=oimo_dynamics_constraint_solver_direct_DirectJointConstraintSolver.prototype.postSolve,OIMO.PgsContactConstraintSolver=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.preSolveVelocity=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.preSolveVelocity,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.warmStart=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.warmStart,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.solveVelocity=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.solveVelocity,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.preSolvePosition=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.preSolvePosition,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.solvePositionSplitImpulse=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.solvePositionSplitImpulse,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.solvePositionNgs=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.solvePositionNgs,oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.postSolve=oimo_dynamics_constraint_solver_pgs_PgsContactConstraintSolver.prototype.postSolve,OIMO.PgsJointConstraintSolver=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.preSolveVelocity=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.preSolveVelocity,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.warmStart=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.warmStart,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.solveVelocity=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.solveVelocity,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.postSolveVelocity=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.postSolveVelocity,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.preSolvePosition=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.preSolvePosition,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.solvePositionSplitImpulse=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.solvePositionSplitImpulse,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.solvePositionNgs=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.solvePositionNgs,oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.postSolve=oimo_dynamics_constraint_solver_pgs_PgsJointConstraintSolver.prototype.postSolve,OIMO.MassData=oimo_dynamics_rigidbody_MassData,OIMO.RigidBody=oimo_dynamics_rigidbody_RigidBody,oimo_dynamics_rigidbody_RigidBody.prototype.getPosition=oimo_dynamics_rigidbody_RigidBody.prototype.getPosition,oimo_dynamics_rigidbody_RigidBody.prototype.getPositionTo=oimo_dynamics_rigidbody_RigidBody.prototype.getPositionTo,oimo_dynamics_rigidbody_RigidBody.prototype.setPosition=oimo_dynamics_rigidbody_RigidBody.prototype.setPosition,oimo_dynamics_rigidbody_RigidBody.prototype.translate=oimo_dynamics_rigidbody_RigidBody.prototype.translate,oimo_dynamics_rigidbody_RigidBody.prototype.getRotation=oimo_dynamics_rigidbody_RigidBody.prototype.getRotation,oimo_dynamics_rigidbody_RigidBody.prototype.getRotationTo=oimo_dynamics_rigidbody_RigidBody.prototype.getRotationTo,oimo_dynamics_rigidbody_RigidBody.prototype.setRotation=oimo_dynamics_rigidbody_RigidBody.prototype.setRotation,oimo_dynamics_rigidbody_RigidBody.prototype.setRotationXyz=oimo_dynamics_rigidbody_RigidBody.prototype.setRotationXyz,oimo_dynamics_rigidbody_RigidBody.prototype.rotate=oimo_dynamics_rigidbody_RigidBody.prototype.rotate,oimo_dynamics_rigidbody_RigidBody.prototype.rotateXyz=oimo_dynamics_rigidbody_RigidBody.prototype.rotateXyz,oimo_dynamics_rigidbody_RigidBody.prototype.getOrientation=oimo_dynamics_rigidbody_RigidBody.prototype.getOrientation,oimo_dynamics_rigidbody_RigidBody.prototype.getOrientationTo=oimo_dynamics_rigidbody_RigidBody.prototype.getOrientationTo,oimo_dynamics_rigidbody_RigidBody.prototype.setOrientation=oimo_dynamics_rigidbody_RigidBody.prototype.setOrientation,oimo_dynamics_rigidbody_RigidBody.prototype.getTransform=oimo_dynamics_rigidbody_RigidBody.prototype.getTransform,oimo_dynamics_rigidbody_RigidBody.prototype.getTransformTo=oimo_dynamics_rigidbody_RigidBody.prototype.getTransformTo,oimo_dynamics_rigidbody_RigidBody.prototype.setTransform=oimo_dynamics_rigidbody_RigidBody.prototype.setTransform,oimo_dynamics_rigidbody_RigidBody.prototype.getMass=oimo_dynamics_rigidbody_RigidBody.prototype.getMass,oimo_dynamics_rigidbody_RigidBody.prototype.getLocalInertia=oimo_dynamics_rigidbody_RigidBody.prototype.getLocalInertia,oimo_dynamics_rigidbody_RigidBody.prototype.getLocalInertiaTo=oimo_dynamics_rigidbody_RigidBody.prototype.getLocalInertiaTo,oimo_dynamics_rigidbody_RigidBody.prototype.getMassData=oimo_dynamics_rigidbody_RigidBody.prototype.getMassData,oimo_dynamics_rigidbody_RigidBody.prototype.getMassDataTo=oimo_dynamics_rigidbody_RigidBody.prototype.getMassDataTo,oimo_dynamics_rigidbody_RigidBody.prototype.setMassData=oimo_dynamics_rigidbody_RigidBody.prototype.setMassData,oimo_dynamics_rigidbody_RigidBody.prototype.getRotationFactor=oimo_dynamics_rigidbody_RigidBody.prototype.getRotationFactor,oimo_dynamics_rigidbody_RigidBody.prototype.setRotationFactor=oimo_dynamics_rigidbody_RigidBody.prototype.setRotationFactor,oimo_dynamics_rigidbody_RigidBody.prototype.getLinearVelocity=oimo_dynamics_rigidbody_RigidBody.prototype.getLinearVelocity,oimo_dynamics_rigidbody_RigidBody.prototype.getLinearVelocityTo=oimo_dynamics_rigidbody_RigidBody.prototype.getLinearVelocityTo,oimo_dynamics_rigidbody_RigidBody.prototype.setLinearVelocity=oimo_dynamics_rigidbody_RigidBody.prototype.setLinearVelocity,oimo_dynamics_rigidbody_RigidBody.prototype.getAngularVelocity=oimo_dynamics_rigidbody_RigidBody.prototype.getAngularVelocity,oimo_dynamics_rigidbody_RigidBody.prototype.getAngularVelocityTo=oimo_dynamics_rigidbody_RigidBody.prototype.getAngularVelocityTo,oimo_dynamics_rigidbody_RigidBody.prototype.setAngularVelocity=oimo_dynamics_rigidbody_RigidBody.prototype.setAngularVelocity,oimo_dynamics_rigidbody_RigidBody.prototype.addLinearVelocity=oimo_dynamics_rigidbody_RigidBody.prototype.addLinearVelocity,oimo_dynamics_rigidbody_RigidBody.prototype.addAngularVelocity=oimo_dynamics_rigidbody_RigidBody.prototype.addAngularVelocity,oimo_dynamics_rigidbody_RigidBody.prototype.applyImpulse=oimo_dynamics_rigidbody_RigidBody.prototype.applyImpulse,oimo_dynamics_rigidbody_RigidBody.prototype.applyLinearImpulse=oimo_dynamics_rigidbody_RigidBody.prototype.applyLinearImpulse,oimo_dynamics_rigidbody_RigidBody.prototype.applyAngularImpulse=oimo_dynamics_rigidbody_RigidBody.prototype.applyAngularImpulse,oimo_dynamics_rigidbody_RigidBody.prototype.applyForce=oimo_dynamics_rigidbody_RigidBody.prototype.applyForce,oimo_dynamics_rigidbody_RigidBody.prototype.applyForceToCenter=oimo_dynamics_rigidbody_RigidBody.prototype.applyForceToCenter,oimo_dynamics_rigidbody_RigidBody.prototype.applyTorque=oimo_dynamics_rigidbody_RigidBody.prototype.applyTorque,oimo_dynamics_rigidbody_RigidBody.prototype.getGravityScale=oimo_dynamics_rigidbody_RigidBody.prototype.getGravityScale,oimo_dynamics_rigidbody_RigidBody.prototype.setGravityScale=oimo_dynamics_rigidbody_RigidBody.prototype.setGravityScale,oimo_dynamics_rigidbody_RigidBody.prototype.getLocalPoint=oimo_dynamics_rigidbody_RigidBody.prototype.getLocalPoint,oimo_dynamics_rigidbody_RigidBody.prototype.getLocalPointTo=oimo_dynamics_rigidbody_RigidBody.prototype.getLocalPointTo,oimo_dynamics_rigidbody_RigidBody.prototype.getLocalVector=oimo_dynamics_rigidbody_RigidBody.prototype.getLocalVector,oimo_dynamics_rigidbody_RigidBody.prototype.getLocalVectorTo=oimo_dynamics_rigidbody_RigidBody.prototype.getLocalVectorTo,oimo_dynamics_rigidbody_RigidBody.prototype.getWorldPoint=oimo_dynamics_rigidbody_RigidBody.prototype.getWorldPoint,oimo_dynamics_rigidbody_RigidBody.prototype.getWorldPointTo=oimo_dynamics_rigidbody_RigidBody.prototype.getWorldPointTo,oimo_dynamics_rigidbody_RigidBody.prototype.getWorldVector=oimo_dynamics_rigidbody_RigidBody.prototype.getWorldVector,oimo_dynamics_rigidbody_RigidBody.prototype.getWorldVectorTo=oimo_dynamics_rigidbody_RigidBody.prototype.getWorldVectorTo,oimo_dynamics_rigidbody_RigidBody.prototype.getNumShapes=oimo_dynamics_rigidbody_RigidBody.prototype.getNumShapes,oimo_dynamics_rigidbody_RigidBody.prototype.getShapeList=oimo_dynamics_rigidbody_RigidBody.prototype.getShapeList,oimo_dynamics_rigidbody_RigidBody.prototype.getNumContactLinks=oimo_dynamics_rigidbody_RigidBody.prototype.getNumContactLinks,oimo_dynamics_rigidbody_RigidBody.prototype.getContactLinkList=oimo_dynamics_rigidbody_RigidBody.prototype.getContactLinkList,oimo_dynamics_rigidbody_RigidBody.prototype.getNumJointLinks=oimo_dynamics_rigidbody_RigidBody.prototype.getNumJointLinks,oimo_dynamics_rigidbody_RigidBody.prototype.getJointLinkList=oimo_dynamics_rigidbody_RigidBody.prototype.getJointLinkList,oimo_dynamics_rigidbody_RigidBody.prototype.addShape=oimo_dynamics_rigidbody_RigidBody.prototype.addShape,oimo_dynamics_rigidbody_RigidBody.prototype.removeShape=oimo_dynamics_rigidbody_RigidBody.prototype.removeShape,oimo_dynamics_rigidbody_RigidBody.prototype.getType=oimo_dynamics_rigidbody_RigidBody.prototype.getType,oimo_dynamics_rigidbody_RigidBody.prototype.setType=oimo_dynamics_rigidbody_RigidBody.prototype.setType,oimo_dynamics_rigidbody_RigidBody.prototype.wakeUp=oimo_dynamics_rigidbody_RigidBody.prototype.wakeUp,oimo_dynamics_rigidbody_RigidBody.prototype.sleep=oimo_dynamics_rigidbody_RigidBody.prototype.sleep,oimo_dynamics_rigidbody_RigidBody.prototype.isSleeping=oimo_dynamics_rigidbody_RigidBody.prototype.isSleeping,oimo_dynamics_rigidbody_RigidBody.prototype.getSleepTime=oimo_dynamics_rigidbody_RigidBody.prototype.getSleepTime,oimo_dynamics_rigidbody_RigidBody.prototype.setAutoSleep=oimo_dynamics_rigidbody_RigidBody.prototype.setAutoSleep,oimo_dynamics_rigidbody_RigidBody.prototype.getLinearDamping=oimo_dynamics_rigidbody_RigidBody.prototype.getLinearDamping,oimo_dynamics_rigidbody_RigidBody.prototype.setLinearDamping=oimo_dynamics_rigidbody_RigidBody.prototype.setLinearDamping,oimo_dynamics_rigidbody_RigidBody.prototype.getAngularDamping=oimo_dynamics_rigidbody_RigidBody.prototype.getAngularDamping,oimo_dynamics_rigidbody_RigidBody.prototype.setAngularDamping=oimo_dynamics_rigidbody_RigidBody.prototype.setAngularDamping,oimo_dynamics_rigidbody_RigidBody.prototype.getPrev=oimo_dynamics_rigidbody_RigidBody.prototype.getPrev,oimo_dynamics_rigidbody_RigidBody.prototype.getNext=oimo_dynamics_rigidbody_RigidBody.prototype.getNext,OIMO.RigidBodyConfig=oimo_dynamics_rigidbody_RigidBodyConfig,OIMO.RigidBodyType=oimo_dynamics_rigidbody_RigidBodyType,OIMO.Shape=oimo_dynamics_rigidbody_Shape,oimo_dynamics_rigidbody_Shape.prototype.getFriction=oimo_dynamics_rigidbody_Shape.prototype.getFriction,oimo_dynamics_rigidbody_Shape.prototype.setFriction=oimo_dynamics_rigidbody_Shape.prototype.setFriction,oimo_dynamics_rigidbody_Shape.prototype.getRestitution=oimo_dynamics_rigidbody_Shape.prototype.getRestitution,oimo_dynamics_rigidbody_Shape.prototype.setRestitution=oimo_dynamics_rigidbody_Shape.prototype.setRestitution,oimo_dynamics_rigidbody_Shape.prototype.getLocalTransform=oimo_dynamics_rigidbody_Shape.prototype.getLocalTransform,oimo_dynamics_rigidbody_Shape.prototype.getLocalTransformTo=oimo_dynamics_rigidbody_Shape.prototype.getLocalTransformTo,oimo_dynamics_rigidbody_Shape.prototype.getTransform=oimo_dynamics_rigidbody_Shape.prototype.getTransform,oimo_dynamics_rigidbody_Shape.prototype.getTransformTo=oimo_dynamics_rigidbody_Shape.prototype.getTransformTo,oimo_dynamics_rigidbody_Shape.prototype.setLocalTransform=oimo_dynamics_rigidbody_Shape.prototype.setLocalTransform,oimo_dynamics_rigidbody_Shape.prototype.getDensity=oimo_dynamics_rigidbody_Shape.prototype.getDensity,oimo_dynamics_rigidbody_Shape.prototype.setDensity=oimo_dynamics_rigidbody_Shape.prototype.setDensity,oimo_dynamics_rigidbody_Shape.prototype.getAabb=oimo_dynamics_rigidbody_Shape.prototype.getAabb,oimo_dynamics_rigidbody_Shape.prototype.getAabbTo=oimo_dynamics_rigidbody_Shape.prototype.getAabbTo,oimo_dynamics_rigidbody_Shape.prototype.getGeometry=oimo_dynamics_rigidbody_Shape.prototype.getGeometry,oimo_dynamics_rigidbody_Shape.prototype.getRigidBody=oimo_dynamics_rigidbody_Shape.prototype.getRigidBody,oimo_dynamics_rigidbody_Shape.prototype.getCollisionGroup=oimo_dynamics_rigidbody_Shape.prototype.getCollisionGroup,oimo_dynamics_rigidbody_Shape.prototype.setCollisionGroup=oimo_dynamics_rigidbody_Shape.prototype.setCollisionGroup,oimo_dynamics_rigidbody_Shape.prototype.getCollisionMask=oimo_dynamics_rigidbody_Shape.prototype.getCollisionMask,oimo_dynamics_rigidbody_Shape.prototype.setCollisionMask=oimo_dynamics_rigidbody_Shape.prototype.setCollisionMask,oimo_dynamics_rigidbody_Shape.prototype.getContactCallback=oimo_dynamics_rigidbody_Shape.prototype.getContactCallback,oimo_dynamics_rigidbody_Shape.prototype.setContactCallback=oimo_dynamics_rigidbody_Shape.prototype.setContactCallback,oimo_dynamics_rigidbody_Shape.prototype.getPrev=oimo_dynamics_rigidbody_Shape.prototype.getPrev,oimo_dynamics_rigidbody_Shape.prototype.getNext=oimo_dynamics_rigidbody_Shape.prototype.getNext,OIMO.ShapeConfig=oimo_dynamics_rigidbody_ShapeConfig;export default OIMO;