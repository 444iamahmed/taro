const REVISION="124",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,SmoothShading=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es";function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t)}}});const _lut=[];for(let t=0;t<256;t++)_lut[t]=(t<16?"0":"")+t.toString(16);let _seed=1234567;const MathUtils={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(_lut[255&t]+_lut[t>>8&255]+_lut[t>>16&255]+_lut[t>>24&255]+"-"+_lut[255&e]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[63&i|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[255&s]+_lut[s>>8&255]+_lut[s>>16&255]+_lut[s>>24&255]).toUpperCase()},clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,s,r){return s+(t-e)*(r-s)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(_seed=t%2147483647),((_seed=16807*_seed%2147483647)-1)/2147483646},degToRad:function(t){return t*MathUtils.DEG2RAD},radToDeg:function(t){return t*MathUtils.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,i,s,r){const n=Math.cos,a=Math.sin,o=n(i/2),h=a(i/2),c=n((e+s)/2),l=a((e+s)/2),u=n((e-s)/2),p=a((e-s)/2),d=n((s-e)/2),f=a((s-e)/2);switch(r){case"XYX":t.set(o*l,h*u,h*p,o*c);break;case"YZY":t.set(h*p,o*l,h*u,o*c);break;case"ZXZ":t.set(h*u,h*p,o*l,o*c);break;case"XZX":t.set(o*l,h*f,h*d,o*c);break;case"YXY":t.set(h*d,o*l,h*f,o*c);break;case"ZYZ":t.set(h*f,h*d,o*l,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};class Vector2{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,n=this.y-t.y;return this.x=r*i-n*s+t.x,this.y=r*s+n*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Matrix3{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,r,n,a,o,h){const c=this.elements;return c[0]=t,c[1]=s,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=i,c[7]=n,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,n=i[0],a=i[3],o=i[6],h=i[1],c=i[4],l=i[7],u=i[2],p=i[5],d=i[8],f=s[0],m=s[3],g=s[6],y=s[1],v=s[4],b=s[7],x=s[2],_=s[5],M=s[8];return r[0]=n*f+a*y+o*x,r[3]=n*m+a*v+o*_,r[6]=n*g+a*b+o*M,r[1]=h*f+c*y+l*x,r[4]=h*m+c*v+l*_,r[7]=h*g+c*b+l*M,r[2]=u*f+p*y+d*x,r[5]=u*m+p*v+d*_,r[8]=u*g+p*b+d*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],c=t[8];return e*n*c-e*a*h-i*r*c+i*a*o+s*r*h-s*n*o}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],c=t[8],l=c*n-a*h,u=a*o-c*r,p=h*r-n*o,d=e*l+i*u+s*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=l*f,t[1]=(s*h-c*i)*f,t[2]=(a*i-s*n)*f,t[3]=u*f,t[4]=(c*e-s*o)*f,t[5]=(s*r-a*e)*f,t[6]=p*f,t[7]=(i*o-h*e)*f,t[8]=(n*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,n,a){const o=Math.cos(r),h=Math.sin(r);return this.set(i*o,i*h,-i*(o*n+h*a)+n+t,-s*h,s*o,-s*(-h*n+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.elements,r=s[0],n=s[3],a=s[6],o=s[1],h=s[4],c=s[7];return s[0]=e*r+i*o,s[3]=e*n+i*h,s[6]=e*a+i*c,s[1]=-i*r+e*o,s[4]=-i*n+e*h,s[7]=-i*a+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}}let _canvas;const ImageUtils={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===_canvas&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=t.width,_canvas.height=t.height;const i=_canvas.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=_canvas}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let textureId=0;function Texture(t=Texture.DEFAULT_IMAGE,e=Texture.DEFAULT_MAPPING,i=ClampToEdgeWrapping,s=ClampToEdgeWrapping,r=LinearFilter,n=LinearMipmapLinearFilter,a=RGBAFormat,o=UnsignedByteType,h=1,c=LinearEncoding){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=n,this.anisotropy=h,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}function serializeImage(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ImageUtils.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const s=this.image;if(void 0===s.uuid&&(s.uuid=MathUtils.generateUUID()),!e&&void 0===t.images[s.uuid]){let e;if(Array.isArray(s)){e=[];for(let t=0,i=s.length;t<i;t++)s[t].isDataTexture?e.push(serializeImage(s[t].image)):e.push(serializeImage(s[t]))}else e=serializeImage(s);t.images[s.uuid]={uuid:s.uuid,url:e}}i.image=s.uuid}return e||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class Vector4{constructor(t=0,e=0,i=0,s=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=this.w,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*s+n[12]*r,this.y=n[1]*e+n[5]*i+n[9]*s+n[13]*r,this.z=n[2]*e+n[6]*i+n[10]*s+n[14]*r,this.w=n[3]*e+n[7]*i+n[11]*s+n[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,r;const n=t.elements,a=n[0],o=n[4],h=n[8],c=n[1],l=n[5],u=n[9],p=n[2],d=n[6],f=n[10];if(Math.abs(o-c)<.01&&Math.abs(h-p)<.01&&Math.abs(u-d)<.01){if(Math.abs(o+c)<.1&&Math.abs(h+p)<.1&&Math.abs(u+d)<.1&&Math.abs(a+l+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(a+1)/2,n=(l+1)/2,m=(f+1)/2,g=(o+c)/4,y=(h+p)/4,v=(u+d)/4;return t>n&&t>m?t<.01?(i=0,s=.707106781,r=.707106781):(s=g/(i=Math.sqrt(t)),r=y/i):n>m?n<.01?(i=.707106781,s=0,r=.707106781):(i=g/(s=Math.sqrt(n)),r=v/s):m<.01?(i=.707106781,s=.707106781,r=0):(i=y/(r=Math.sqrt(m)),s=v/r),this.set(i,s,r,e),this}let m=Math.sqrt((d-u)*(d-u)+(h-p)*(h-p)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(d-u)/m,this.y=(h-p)/m,this.z=(c-o)/m,this.w=Math.acos((a+l+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function WebGLRenderTarget(t,e,i){this.width=t,this.height=e,this.scissor=new Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,e),i=i||{},this.texture=new Texture(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:LinearFilter,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function WebGLMultisampleRenderTarget(t,e,i){WebGLRenderTarget.call(this,t,e,i),this.samples=4}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(t){return WebGLRenderTarget.prototype.copy.call(this,t),this.samples=t.samples,this}});class Quaternion{constructor(t=0,e=0,i=0,s=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=e,this._z=i,this._w=s}static slerp(t,e,i,s){return i.copy(t).slerp(e,s)}static slerpFlat(t,e,i,s,r,n,a){let o=i[s+0],h=i[s+1],c=i[s+2],l=i[s+3];const u=r[n+0],p=r[n+1],d=r[n+2],f=r[n+3];if(l!==f||o!==u||h!==p||c!==d){let t=1-a;const e=o*u+h*p+c*d+l*f,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),n=Math.atan2(r,e*i);t=Math.sin(t*n)/r,a=Math.sin(a*n)/r}const r=a*i;if(o=o*t+u*r,h=h*t+p*r,c=c*t+d*r,l=l*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+h*h+c*c+l*l);o*=t,h*=t,c*=t,l*=t}}t[e]=o,t[e+1]=h,t[e+2]=c,t[e+3]=l}static multiplyQuaternionsFlat(t,e,i,s,r,n){const a=i[s],o=i[s+1],h=i[s+2],c=i[s+3],l=r[n],u=r[n+1],p=r[n+2],d=r[n+3];return t[e]=a*d+c*l+o*p-h*u,t[e+1]=o*d+c*u+h*l-a*p,t[e+2]=h*d+c*p+a*u-o*l,t[e+3]=c*d-a*l-o*u-h*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,r=t._z,n=t._order,a=Math.cos,o=Math.sin,h=a(i/2),c=a(s/2),l=a(r/2),u=o(i/2),p=o(s/2),d=o(r/2);switch(n){case"XYZ":this._x=u*c*l+h*p*d,this._y=h*p*l-u*c*d,this._z=h*c*d+u*p*l,this._w=h*c*l-u*p*d;break;case"YXZ":this._x=u*c*l+h*p*d,this._y=h*p*l-u*c*d,this._z=h*c*d-u*p*l,this._w=h*c*l+u*p*d;break;case"ZXY":this._x=u*c*l-h*p*d,this._y=h*p*l+u*c*d,this._z=h*c*d+u*p*l,this._w=h*c*l-u*p*d;break;case"ZYX":this._x=u*c*l-h*p*d,this._y=h*p*l+u*c*d,this._z=h*c*d-u*p*l,this._w=h*c*l+u*p*d;break;case"YZX":this._x=u*c*l+h*p*d,this._y=h*p*l+u*c*d,this._z=h*c*d-u*p*l,this._w=h*c*l-u*p*d;break;case"XZY":this._x=u*c*l-h*p*d,this._y=h*p*l-u*c*d,this._z=h*c*d+u*p*l,this._w=h*c*l+u*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],n=e[1],a=e[5],o=e[9],h=e[2],c=e[6],l=e[10],u=i+a+l;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-o)*t,this._y=(r-h)*t,this._z=(n-s)*t}else if(i>a&&i>l){const t=2*Math.sqrt(1+i-a-l);this._w=(c-o)/t,this._x=.25*t,this._y=(s+n)/t,this._z=(r+h)/t}else if(a>l){const t=2*Math.sqrt(1+a-i-l);this._w=(r-h)/t,this._x=(s+n)/t,this._y=.25*t,this._z=(o+c)/t}else{const t=2*Math.sqrt(1+l-i-a);this._w=(n-s)/t,this._x=(r+h)/t,this._y=(o+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(MathUtils.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,n=t._w,a=e._x,o=e._y,h=e._z,c=e._w;return this._x=i*c+n*a+s*h-r*o,this._y=s*c+n*o+r*a-i*h,this._z=r*c+n*h+i*o-s*a,this._w=n*c-i*a-s*o-r*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,r=this._z,n=this._w;let a=n*t._w+i*t._x+s*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=n,this._x=i,this._y=s,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*n+e*this._w,this._x=t*i+e*this._x,this._y=t*s+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(o),c=Math.atan2(h,a),l=Math.sin((1-e)*c)/h,u=Math.sin(e*c)/h;return this._w=n*l+this._w*u,this._x=i*l+this._x*u,this._y=s*l+this._y*u,this._z=r*l+this._z*u,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Vector3$1{constructor(t=0,e=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(_quaternion.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,n=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*n,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*n,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*n,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,n=t.y,a=t.z,o=t.w,h=o*e+n*s-a*i,c=o*i+a*e-r*s,l=o*s+r*i-n*e,u=-r*e-n*i-a*s;return this.x=h*o+u*-r+c*-a-l*-n,this.y=c*o+u*-n+l*-r-h*-a,this.z=l*o+u*-a+h*-n-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,n=e.x,a=e.y,o=e.z;return this.x=s*o-r*a,this.y=r*n-i*o,this.z=i*a-s*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return _vector.copy(this).projectOnVector(t),this.sub(_vector)}reflect(t){return this.sub(_vector.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(MathUtils.clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const _vector=new Vector3$1,_quaternion=new Quaternion;class Box3{constructor(t,e){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Vector3$1(1/0,1/0,1/0),this.max=void 0!==e?e:new Vector3$1(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,s=1/0,r=-1/0,n=-1/0,a=-1/0;for(let o=0,h=t.length;o<h;o+=3){const h=t[o],c=t[o+1],l=t[o+2];h<e&&(e=h),c<i&&(i=c),l<s&&(s=l),h>r&&(r=h),c>n&&(n=c),l>a&&(a=l)}return this.min.set(e,i,s),this.max.set(r,n,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,s=1/0,r=-1/0,n=-1/0,a=-1/0;for(let o=0,h=t.count;o<h;o++){const h=t.getX(o),c=t.getY(o),l=t.getZ(o);h<e&&(e=h),c<i&&(i=c),l<s&&(s=l),h>r&&(r=h),c>n&&(n=c),l>a&&(a=l)}return this.min.set(e,i,s),this.max.set(r,n,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=_vector$1.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Vector3$1),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Vector3$1),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),_box.copy(e.boundingBox),_box.applyMatrix4(t.matrixWorld),this.union(_box));const i=t.children;for(let t=0,e=i.length;t<e;t++)this.expandByObject(i[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Vector3$1),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_vector$1),_vector$1.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0.subVectors(t.a,_center),_v1.subVectors(t.b,_center),_v2.subVectors(t.c,_center),_f0.subVectors(_v1,_v0),_f1.subVectors(_v2,_v1),_f2.subVectors(_v0,_v2);let e=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!!satForAxes(e,_v0,_v1,_v2,_extents)&&(!!satForAxes(e=[1,0,0,0,1,0,0,0,1],_v0,_v1,_v2,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),satForAxes(e=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],_v0,_v1,_v2,_extents)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Vector3$1),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return _vector$1.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(_vector$1).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function satForAxes(t,e,i,s,r){for(let n=0,a=t.length-3;n<=a;n+=3){_testAxis.fromArray(t,n);const a=r.x*Math.abs(_testAxis.x)+r.y*Math.abs(_testAxis.y)+r.z*Math.abs(_testAxis.z),o=e.dot(_testAxis),h=i.dot(_testAxis),c=s.dot(_testAxis);if(Math.max(-Math.max(o,h,c),Math.min(o,h,c))>a)return!1}return!0}const _points=[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1],_vector$1=new Vector3$1,_box=new Box3,_v0=new Vector3$1,_v1=new Vector3$1,_v2=new Vector3$1,_f0=new Vector3$1,_f1=new Vector3$1,_f2=new Vector3$1,_center=new Vector3$1,_extents=new Vector3$1,_triangleNormal=new Vector3$1,_testAxis=new Vector3$1,_box$1=new Box3;class Sphere{constructor(t,e){this.center=void 0!==t?t:new Vector3$1,this.radius=void 0!==e?e:-1}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):_box$1.setFromPoints(t).getCenter(i);let s=0;for(let e=0,r=t.length;e<r;e++)s=Math.max(s,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(s),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Vector3$1),e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Box3),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const _vector$2=new Vector3$1,_segCenter=new Vector3$1,_segDir=new Vector3$1,_diff=new Vector3$1,_edge1=new Vector3$1,_edge2=new Vector3$1,_normal=new Vector3$1;class Ray{constructor(t,e){this.origin=void 0!==t?t:new Vector3$1,this.direction=void 0!==e?e:new Vector3$1(0,0,-1)}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Vector3$1),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_vector$2)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Vector3$1),e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=_vector$2.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(_vector$2.copy(this.direction).multiplyScalar(e).add(this.origin),_vector$2.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){_segCenter.copy(t).add(e).multiplyScalar(.5),_segDir.copy(e).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);const r=.5*t.distanceTo(e),n=-this.direction.dot(_segDir),a=_diff.dot(this.direction),o=-_diff.dot(_segDir),h=_diff.lengthSq(),c=Math.abs(1-n*n);let l,u,p,d;if(c>0)if(u=n*a-o,d=r*c,(l=n*o-a)>=0)if(u>=-d)if(u<=d){const t=1/c;p=(l*=t)*(l+n*(u*=t)+2*a)+u*(n*l+u+2*o)+h}else u=r,p=-(l=Math.max(0,-(n*u+a)))*l+u*(u+2*o)+h;else u=-r,p=-(l=Math.max(0,-(n*u+a)))*l+u*(u+2*o)+h;else u<=-d?p=-(l=Math.max(0,-(-n*r+a)))*l+(u=l>0?-r:Math.min(Math.max(-r,-o),r))*(u+2*o)+h:u<=d?(l=0,p=(u=Math.min(Math.max(-r,-o),r))*(u+2*o)+h):p=-(l=Math.max(0,-(n*r+a)))*l+(u=l>0?r:Math.min(Math.max(-r,-o),r))*(u+2*o)+h;else u=n>0?-r:r,p=-(l=Math.max(0,-(n*u+a)))*l+u*(u+2*o)+h;return i&&i.copy(this.direction).multiplyScalar(l).add(this.origin),s&&s.copy(_segDir).multiplyScalar(u).add(_segCenter),p}intersectSphere(t,e){_vector$2.subVectors(t.center,this.origin);const i=_vector$2.dot(this.direction),s=_vector$2.dot(_vector$2)-i*i,r=t.radius*t.radius;if(s>r)return null;const n=Math.sqrt(r-s),a=i-n,o=i+n;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,r,n,a,o;const h=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,u=this.origin;return h>=0?(i=(t.min.x-u.x)*h,s=(t.max.x-u.x)*h):(i=(t.max.x-u.x)*h,s=(t.min.x-u.x)*h),c>=0?(r=(t.min.y-u.y)*c,n=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,n=(t.min.y-u.y)*c),i>n||r>s?null:((r>i||i!=i)&&(i=r),(n<s||s!=s)&&(s=n),l>=0?(a=(t.min.z-u.z)*l,o=(t.max.z-u.z)*l):(a=(t.max.z-u.z)*l,o=(t.min.z-u.z)*l),i>o||a>s?null:((a>i||i!=i)&&(i=a),(o<s||s!=s)&&(s=o),s<0?null:this.at(i>=0?i:s,e)))}intersectsBox(t){return null!==this.intersectBox(t,_vector$2)}intersectTriangle(t,e,i,s,r){_edge1.subVectors(e,t),_edge2.subVectors(i,t),_normal.crossVectors(_edge1,_edge2);let n,a=this.direction.dot(_normal);if(a>0){if(s)return null;n=1}else{if(!(a<0))return null;n=-1,a=-a}_diff.subVectors(this.origin,t);const o=n*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(o<0)return null;const h=n*this.direction.dot(_edge1.cross(_diff));if(h<0)return null;if(o+h>a)return null;const c=-n*_diff.dot(_normal);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Matrix4{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=s,g[1]=r,g[5]=n,g[9]=a,g[13]=o,g[2]=h,g[6]=c,g[10]=l,g[14]=u,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/_v1$1.setFromMatrixColumn(t,0).length(),r=1/_v1$1.setFromMatrixColumn(t,1).length(),n=1/_v1$1.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*n,e[9]=i[9]*n,e[10]=i[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,s=t.y,r=t.z,n=Math.cos(i),a=Math.sin(i),o=Math.cos(s),h=Math.sin(s),c=Math.cos(r),l=Math.sin(r);if("XYZ"===t.order){const t=n*c,i=n*l,s=a*c,r=a*l;e[0]=o*c,e[4]=-o*l,e[8]=h,e[1]=i+s*h,e[5]=t-r*h,e[9]=-a*o,e[2]=r-t*h,e[6]=s+i*h,e[10]=n*o}else if("YXZ"===t.order){const t=o*c,i=o*l,s=h*c,r=h*l;e[0]=t+r*a,e[4]=s*a-i,e[8]=n*h,e[1]=n*l,e[5]=n*c,e[9]=-a,e[2]=i*a-s,e[6]=r+t*a,e[10]=n*o}else if("ZXY"===t.order){const t=o*c,i=o*l,s=h*c,r=h*l;e[0]=t-r*a,e[4]=-n*l,e[8]=s+i*a,e[1]=i+s*a,e[5]=n*c,e[9]=r-t*a,e[2]=-n*h,e[6]=a,e[10]=n*o}else if("ZYX"===t.order){const t=n*c,i=n*l,s=a*c,r=a*l;e[0]=o*c,e[4]=s*h-i,e[8]=t*h+r,e[1]=o*l,e[5]=r*h+t,e[9]=i*h-s,e[2]=-h,e[6]=a*o,e[10]=n*o}else if("YZX"===t.order){const t=n*o,i=n*h,s=a*o,r=a*h;e[0]=o*c,e[4]=r-t*l,e[8]=s*l+i,e[1]=l,e[5]=n*c,e[9]=-a*c,e[2]=-h*c,e[6]=i*l+s,e[10]=t-r*l}else if("XZY"===t.order){const t=n*o,i=n*h,s=a*o,r=a*h;e[0]=o*c,e[4]=-l,e[8]=h*c,e[1]=t*l+r,e[5]=n*c,e[9]=i*l-s,e[2]=s*l-i,e[6]=a*c,e[10]=r*l+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_zero,t,_one)}lookAt(t,e,i){const s=this.elements;return _z.subVectors(t,e),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(i,_z),0===_x.lengthSq()&&(1===Math.abs(i.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(i,_z)),_x.normalize(),_y.crossVectors(_z,_x),s[0]=_x.x,s[4]=_y.x,s[8]=_z.x,s[1]=_x.y,s[5]=_y.y,s[9]=_z.y,s[2]=_x.z,s[6]=_y.z,s[10]=_z.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,n=i[0],a=i[4],o=i[8],h=i[12],c=i[1],l=i[5],u=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],y=i[3],v=i[7],b=i[11],x=i[15],_=s[0],M=s[4],w=s[8],S=s[12],A=s[1],T=s[5],C=s[9],L=s[13],E=s[2],z=s[6],R=s[10],B=s[14],P=s[3],D=s[7],I=s[11],O=s[15];return r[0]=n*_+a*A+o*E+h*P,r[4]=n*M+a*T+o*z+h*D,r[8]=n*w+a*C+o*R+h*I,r[12]=n*S+a*L+o*B+h*O,r[1]=c*_+l*A+u*E+p*P,r[5]=c*M+l*T+u*z+p*D,r[9]=c*w+l*C+u*R+p*I,r[13]=c*S+l*L+u*B+p*O,r[2]=d*_+f*A+m*E+g*P,r[6]=d*M+f*T+m*z+g*D,r[10]=d*w+f*C+m*R+g*I,r[14]=d*S+f*L+m*B+g*O,r[3]=y*_+v*A+b*E+x*P,r[7]=y*M+v*T+b*z+x*D,r[11]=y*w+v*C+b*R+x*I,r[15]=y*S+v*L+b*B+x*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],n=t[1],a=t[5],o=t[9],h=t[13],c=t[2],l=t[6],u=t[10],p=t[14];return t[3]*(+r*o*l-s*h*l-r*a*u+i*h*u+s*a*p-i*o*p)+t[7]*(+e*o*p-e*h*u+r*n*u-s*n*p+s*h*c-r*o*c)+t[11]*(+e*h*l-e*a*p-r*n*l+i*n*p+r*a*c-i*h*c)+t[15]*(-s*a*c-e*o*l+e*a*u+s*n*l-i*n*u+i*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],c=t[8],l=t[9],u=t[10],p=t[11],d=t[12],f=t[13],m=t[14],g=t[15],y=l*m*h-f*u*h+f*o*p-a*m*p-l*o*g+a*u*g,v=d*u*h-c*m*h-d*o*p+n*m*p+c*o*g-n*u*g,b=c*f*h-d*l*h+d*a*p-n*f*p-c*a*g+n*l*g,x=d*l*o-c*f*o-d*a*u+n*f*u+c*a*m-n*l*m,_=e*y+i*v+s*b+r*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/_;return t[0]=y*M,t[1]=(f*u*r-l*m*r-f*s*p+i*m*p+l*s*g-i*u*g)*M,t[2]=(a*m*r-f*o*r+f*s*h-i*m*h-a*s*g+i*o*g)*M,t[3]=(l*o*r-a*u*r-l*s*h+i*u*h+a*s*p-i*o*p)*M,t[4]=v*M,t[5]=(c*m*r-d*u*r+d*s*p-e*m*p-c*s*g+e*u*g)*M,t[6]=(d*o*r-n*m*r-d*s*h+e*m*h+n*s*g-e*o*g)*M,t[7]=(n*u*r-c*o*r+c*s*h-e*u*h-n*s*p+e*o*p)*M,t[8]=b*M,t[9]=(d*l*r-c*f*r-d*i*p+e*f*p+c*i*g-e*l*g)*M,t[10]=(n*f*r-d*a*r+d*i*h-e*f*h-n*i*g+e*a*g)*M,t[11]=(c*a*r-n*l*r-c*i*h+e*l*h+n*i*p-e*a*p)*M,t[12]=x*M,t[13]=(c*f*s-d*l*s+d*i*u-e*f*u-c*i*m+e*l*m)*M,t[14]=(d*a*s-n*f*s-d*i*o+e*f*o+n*i*m-e*a*m)*M,t[15]=(n*l*s-c*a*s+c*i*o-e*l*o-n*i*u+e*a*u)*M,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,n=t.x,a=t.y,o=t.z,h=r*n,c=r*a;return this.set(h*n+i,h*a-s*o,h*o+s*a,0,h*a+s*o,c*a+i,c*o-s*n,0,h*o-s*a,c*o+s*n,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,n=e._y,a=e._z,o=e._w,h=r+r,c=n+n,l=a+a,u=r*h,p=r*c,d=r*l,f=n*c,m=n*l,g=a*l,y=o*h,v=o*c,b=o*l,x=i.x,_=i.y,M=i.z;return s[0]=(1-(f+g))*x,s[1]=(p+b)*x,s[2]=(d-v)*x,s[3]=0,s[4]=(p-b)*_,s[5]=(1-(u+g))*_,s[6]=(m+y)*_,s[7]=0,s[8]=(d+v)*M,s[9]=(m-y)*M,s[10]=(1-(u+f))*M,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=_v1$1.set(s[0],s[1],s[2]).length();const n=_v1$1.set(s[4],s[5],s[6]).length(),a=_v1$1.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],_m1.copy(this);const o=1/r,h=1/n,c=1/a;return _m1.elements[0]*=o,_m1.elements[1]*=o,_m1.elements[2]*=o,_m1.elements[4]*=h,_m1.elements[5]*=h,_m1.elements[6]*=h,_m1.elements[8]*=c,_m1.elements[9]*=c,_m1.elements[10]*=c,e.setFromRotationMatrix(_m1),i.x=r,i.y=n,i.z=a,this}makePerspective(t,e,i,s,r,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(e-t),h=2*r/(i-s),c=(e+t)/(e-t),l=(i+s)/(i-s),u=-(n+r)/(n-r),p=-2*n*r/(n-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=h,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,s,r,n){const a=this.elements,o=1/(e-t),h=1/(i-s),c=1/(n-r),l=(e+t)*o,u=(i+s)*h,p=(n+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const _v1$1=new Vector3$1,_m1=new Matrix4,_zero=new Vector3$1(0,0,0),_one=new Vector3$1(1,1,1),_x=new Vector3$1,_y=new Vector3$1,_z=new Vector3$1;class Euler{constructor(t=0,e=0,i=0,s=Euler.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._order=s||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,i){const s=MathUtils.clamp,r=t.elements,n=r[0],a=r[4],o=r[8],h=r[1],c=r[5],l=r[9],u=r[2],p=r[6],d=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(s(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-s(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(s(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(h,n));break;case"ZYX":this._y=Math.asin(-s(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(h,n)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(s(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-s(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return _matrix.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix,e,i)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return _quaternion$1.setFromEuler(this),this.setFromQuaternion(_quaternion$1,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Vector3$1(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const _matrix=new Matrix4,_quaternion$1=new Quaternion;class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let _object3DId=0;const _v1$2=new Vector3$1,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3$1,_position=new Vector3$1,_scale=new Vector3$1,_quaternion$2=new Quaternion,_xAxis=new Vector3$1(1,0,0),_yAxis=new Vector3$1(0,1,0),_zAxis=new Vector3$1(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const t=new Vector3$1,e=new Euler,i=new Quaternion,s=new Vector3$1(1,1,1);e._onChange(function(){i.setFromEuler(e,!1)}),i._onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Object3D.DefaultUp=new Vector3$1(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.multiply(_q1),this},rotateOnWorldAxis:function(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.premultiply(_q1),this},rotateX:function(t){return this.rotateOnAxis(_xAxis,t)},rotateY:function(t){return this.rotateOnAxis(_yAxis,t)},rotateZ:function(t){return this.rotateOnAxis(_zAxis,t)},translateOnAxis:function(t,e){return _v1$2.copy(t).applyQuaternion(this.quaternion),this.position.add(_v1$2.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(_xAxis,t)},translateY:function(t){return this.translateOnAxis(_yAxis,t)},translateZ:function(t){return this.translateOnAxis(_zAxis,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())},lookAt:function(t,e,i){t.isVector3?_target.copy(t):_target.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),_position.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position,_target,this.up):_m1$1.lookAt(_target,_position,this.up),this.quaternion.setFromRotationMatrix(_m1$1),s&&(_m1$1.extractRotation(s.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(_removedEvent)),this},clear:function(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(_removedEvent)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(t.parent.matrixWorld)),t.applyMatrix4(_m1$1),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Vector3$1),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position,t,_scale),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Vector3$1),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position,_quaternion$2,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Vector3$1),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,s=i.length;e<s;e++){const s=i[e];r(t.shapes,s)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,s=this.material.length;i<s;i++)e.push(r(t.materials,this.material[i]));s.material=e}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let e=0;e<this.children.length;e++)s.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];s.animations.push(r(t.animations,i))}}if(e){const e=n(t.geometries),s=n(t.materials),r=n(t.textures),a=n(t.images),o=n(t.shapes),h=n(t.skeletons),c=n(t.animations);e.length>0&&(i.geometries=e),s.length>0&&(i.materials=s),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),h.length>0&&(i.skeletons=h),c.length>0&&(i.animations=c)}return i.object=s,i;function n(t){const e=[];for(const i in t){const s=t[i];delete s.metadata,e.push(s)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}});const _vector1=new Vector3$1,_vector2=new Vector3$1,_normalMatrix=new Matrix3;class Plane{constructor(t,e){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Vector3$1(1,0,0),this.constant=void 0!==e?e:0}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,s){return this.normal.set(t,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const s=_vector1.subVectors(i,e).cross(_vector2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Vector3$1),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Vector3$1);const i=t.delta(_vector1),s=this.normal.dot(i);if(0===s)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const r=-(t.start.dot(this.normal)+this.constant)/s;return r<0||r>1?void 0:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Vector3$1),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||_normalMatrix.getNormalMatrix(t),s=this.coplanarPoint(_vector1).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const _v0$1=new Vector3$1,_v1$3=new Vector3$1,_v2$1=new Vector3$1,_v3=new Vector3$1,_vab=new Vector3$1,_vac=new Vector3$1,_vbc=new Vector3$1,_vap=new Vector3$1,_vbp=new Vector3$1,_vcp=new Vector3$1;class Triangle{constructor(t,e,i){this.a=void 0!==t?t:new Vector3$1,this.b=void 0!==e?e:new Vector3$1,this.c=void 0!==i?i:new Vector3$1}static getNormal(t,e,i,s){void 0===s&&(console.warn("THREE.Triangle: .getNormal() target is now required"),s=new Vector3$1),s.subVectors(i,e),_v0$1.subVectors(t,e),s.cross(_v0$1);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,i,s,r){_v0$1.subVectors(s,e),_v1$3.subVectors(i,e),_v2$1.subVectors(t,e);const n=_v0$1.dot(_v0$1),a=_v0$1.dot(_v1$3),o=_v0$1.dot(_v2$1),h=_v1$3.dot(_v1$3),c=_v1$3.dot(_v2$1),l=n*h-a*a;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Vector3$1),0===l)return r.set(-2,-1,-1);const u=1/l,p=(h*o-a*c)*u,d=(n*c-a*o)*u;return r.set(1-p-d,d,p)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,_v3),_v3.x>=0&&_v3.y>=0&&_v3.x+_v3.y<=1}static getUV(t,e,i,s,r,n,a,o){return this.getBarycoord(t,e,i,s,_v3),o.set(0,0),o.addScaledVector(r,_v3.x),o.addScaledVector(n,_v3.y),o.addScaledVector(a,_v3.z),o}static isFrontFacing(t,e,i,s){return _v0$1.subVectors(i,e),_v1$3.subVectors(t,e),_v0$1.cross(_v1$3).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Vector3$1),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Plane),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Triangle.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,s,r){return Triangle.getUV(t,this.a,this.b,this.c,e,i,s,r)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Vector3$1);const i=this.a,s=this.b,r=this.c;let n,a;_vab.subVectors(s,i),_vac.subVectors(r,i),_vap.subVectors(t,i);const o=_vab.dot(_vap),h=_vac.dot(_vap);if(o<=0&&h<=0)return e.copy(i);_vbp.subVectors(t,s);const c=_vab.dot(_vbp),l=_vac.dot(_vbp);if(c>=0&&l<=c)return e.copy(s);const u=o*l-c*h;if(u<=0&&o>=0&&c<=0)return n=o/(o-c),e.copy(i).addScaledVector(_vab,n);_vcp.subVectors(t,r);const p=_vab.dot(_vcp),d=_vac.dot(_vcp);if(d>=0&&p<=d)return e.copy(r);const f=p*h-o*d;if(f<=0&&h>=0&&d<=0)return a=h/(h-d),e.copy(i).addScaledVector(_vac,a);const m=c*d-p*l;if(m<=0&&l-c>=0&&p-d>=0)return _vbc.subVectors(r,s),a=(l-c)/(l-c+(p-d)),e.copy(s).addScaledVector(_vbc,a);const g=1/(m+f+u);return n=f*g,a=u*g,e.copy(i).addScaledVector(_vab,n).addScaledVector(_vac,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Color{constructor(t,e,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=MathUtils.euclideanModulo(t,1),e=MathUtils.clamp(e,0,1),i=MathUtils.clamp(i,0,1),0===e)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,r=2*i-s;this.r=hue2rgb(r,s,t+1/3),this.g=hue2rgb(r,s,t),this.b=hue2rgb(r,s,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const s=i[1],r=i[2];switch(s){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,s=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,s,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=_colorKeywords[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,i=this.g,s=this.b,r=Math.max(e,i,s),n=Math.min(e,i,s);let a,o;const h=(n+r)/2;if(n===r)a=0,o=0;else{const t=r-n;switch(o=h<=.5?t/(r+n):t/(2-r-n),r){case e:a=(i-s)/t+(i<s?6:0);break;case i:a=(s-e)/t+2;break;case s:a=(e-i)/t+4}a/=6}return t.h=a,t.s=o,t.l=h,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(_hslA),_hslA.h+=t,_hslA.s+=e,_hslA.l+=i,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpHSL(t,e){this.getHSL(_hslA),t.getHSL(_hslB);const i=MathUtils.lerp(_hslA.h,_hslB.h,e),s=MathUtils.lerp(_hslA.s,_hslB.s,e),r=MathUtils.lerp(_hslA.l,_hslB.l,e);return this.setHSL(i,s,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=_colorKeywords,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class Face3{constructor(t,e,i,s,r,n=0){this.a=t,this.b=e,this.c=i,this.normal=s&&s.isVector3?s:new Vector3$1,this.vertexNormals=Array.isArray(s)?s:[],this.color=r&&r.isColor?r:new Color,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=n}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}let materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function MeshBasicMaterial(t){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const s=this[e];void 0!==s?s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function s(t){const e=[];for(const i in t){const s=t[i];delete s.metadata,e.push(s)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==FrontSide&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=s(t.textures),r=s(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let s=0;s!==t;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const _vector$3=new Vector3$1,_vector2$1=new Vector2;function BufferAttribute(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(t,e,i){BufferAttribute.call(this,new Int8Array(t),e,i)}function Uint8BufferAttribute(t,e,i){BufferAttribute.call(this,new Uint8Array(t),e,i)}function Uint8ClampedBufferAttribute(t,e,i){BufferAttribute.call(this,new Uint8ClampedArray(t),e,i)}function Int16BufferAttribute(t,e,i){BufferAttribute.call(this,new Int16Array(t),e,i)}function Uint16BufferAttribute(t,e,i){BufferAttribute.call(this,new Uint16Array(t),e,i)}function Int32BufferAttribute(t,e,i){BufferAttribute.call(this,new Int32Array(t),e,i)}function Uint32BufferAttribute(t,e,i){BufferAttribute.call(this,new Uint32Array(t),e,i)}function Float16BufferAttribute(t,e,i){BufferAttribute.call(this,new Uint16Array(t),e,i)}function Float32BufferAttribute(t,e,i){BufferAttribute.call(this,new Float32Array(t),e,i)}function Float64BufferAttribute(t,e,i){BufferAttribute.call(this,new Float64Array(t),e,i)}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[i+s];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let i=0;for(let s=0,r=t.length;s<r;s++){let r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),r=new Color),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this},copyVector2sArray:function(t){const e=this.array;let i=0;for(let s=0,r=t.length;s<r;s++){let r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),r=new Vector2),e[i++]=r.x,e[i++]=r.y}return this},copyVector3sArray:function(t){const e=this.array;let i=0;for(let s=0,r=t.length;s<r;s++){let r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),r=new Vector3$1),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this},copyVector4sArray:function(t){const e=this.array;let i=0;for(let s=0,r=t.length;s<r;s++){let r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),r=new Vector4),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)_vector2$1.fromBufferAttribute(this,e),_vector2$1.applyMatrix3(t),this.setXY(e,_vector2$1.x,_vector2$1.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)_vector$3.fromBufferAttribute(this,e),_vector$3.applyMatrix3(t),this.setXYZ(e,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyMatrix4:function(t){for(let e=0,i=this.count;e<i;e++)_vector$3.x=this.getX(e),_vector$3.y=this.getY(e),_vector$3.z=this.getZ(e),_vector$3.applyMatrix4(t),this.setXYZ(e,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyNormalMatrix:function(t){for(let e=0,i=this.count;e<i;e++)_vector$3.x=this.getX(e),_vector$3.y=this.getY(e),_vector$3.z=this.getZ(e),_vector$3.applyNormalMatrix(t),this.setXYZ(e,_vector$3.x,_vector$3.y,_vector$3.z);return this},transformDirection:function(t){for(let e=0,i=this.count;e<i;e++)_vector$3.x=this.getX(e),_vector$3.y=this.getY(e),_vector$3.z=this.getZ(e),_vector$3.transformDirection(t),this.setXYZ(e,_vector$3.x,_vector$3.y,_vector$3.z);return this},set:function(t,e=0){return this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this},setXYZW:function(t,e,i,s,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float16BufferAttribute.prototype.constructor=Float16BufferAttribute,Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;class DirectGeometry{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const e=[];let i,s,r=void 0;const n=t.faces;for(s=0;s<n.length;s++){const t=n[s];t.materialIndex!==r&&(r=t.materialIndex,void 0!==i&&(i.count=3*s-i.start,e.push(i)),i={start:3*s,materialIndex:r})}void 0!==i&&(i.count=3*s-i.start,e.push(i)),this.groups=e}fromGeometry(t){const e=t.faces,i=t.vertices,s=t.faceVertexUvs,r=s[0]&&s[0].length>0,n=s[1]&&s[1].length>0,a=t.morphTargets,o=a.length;let h;if(o>0){h=[];for(let t=0;t<o;t++)h[t]={name:a[t].name,data:[]};this.morphTargets.position=h}const c=t.morphNormals,l=c.length;let u;if(l>0){u=[];for(let t=0;t<l;t++)u[t]={name:c[t].name,data:[]};this.morphTargets.normal=u}const p=t.skinIndices,d=t.skinWeights,f=p.length===i.length,m=d.length===i.length;i.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<e.length;t++){const g=e[t];this.vertices.push(i[g.a],i[g.b],i[g.c]);const y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{const t=g.normal;this.normals.push(t,t,t)}const v=g.vertexColors;if(3===v.length)this.colors.push(v[0],v[1],v[2]);else{const t=g.color;this.colors.push(t,t,t)}if(!0===r){const e=s[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(!0===n){const e=s[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(let t=0;t<o;t++){const e=a[t].vertices;h[t].data.push(e[g.a],e[g.b],e[g.c])}for(let e=0;e<l;e++){const i=c[e].vertexNormals[t];u[e].data.push(i.a,i.b,i.c)}f&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),m&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}}function arrayMax(t){if(0===t.length)return-1/0;let e=t[0];for(let i=1,s=t.length;i<s;++i)t[i]>e&&(e=t[i]);return e}const TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function getTypedArray(t,e){return new TYPED_ARRAYS[t](e)}let _bufferGeometryId=1;const _m1$2=new Matrix4,_obj=new Object3D,_offset=new Vector3$1,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$4=new Vector3$1;function BufferGeometry(){Object.defineProperty(this,"id",{value:_bufferGeometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(arrayMax(t)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Matrix3).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(t),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return _m1$2.makeRotationX(t),this.applyMatrix4(_m1$2),this},rotateY:function(t){return _m1$2.makeRotationY(t),this.applyMatrix4(_m1$2),this},rotateZ:function(t){return _m1$2.makeRotationZ(t),this.applyMatrix4(_m1$2),this},translate:function(t,e,i){return _m1$2.makeTranslation(t,e,i),this.applyMatrix4(_m1$2),this},scale:function(t,e,i){return _m1$2.makeScale(t,e,i),this.applyMatrix4(_m1$2),this},lookAt:function(t){return _obj.lookAt(t),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Float32BufferAttribute(3*e.vertices.length,3),i=new Float32BufferAttribute(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Float32BufferAttribute(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Float32BufferAttribute(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new BufferAttribute(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new BufferAttribute(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new BufferAttribute(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new BufferAttribute(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new BufferAttribute(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const i=[],s=t.morphTargets[e];for(let t=0,e=s.length;t<e;t++){const e=s[t],r=new Float32BufferAttribute(3*e.data.length,3);r.name=e.name,i.push(r.copyVector3sArray(e.data))}this.morphAttributes[e]=i}if(t.skinIndices.length>0){const e=new Float32BufferAttribute(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Float32BufferAttribute(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3$1(-1/0,-1/0,-1/0),new Vector3$1(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];_box$2.setFromBufferAttribute(i),this.morphTargetsRelative?(_vector$4.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$4),_vector$4.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$4)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3$1,1/0);if(t){const i=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];_boxMorphTargets.setFromBufferAttribute(i),this.morphTargetsRelative?(_vector$4.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$4),_vector$4.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$4)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(i);let s=0;for(let e=0,r=t.count;e<r;e++)_vector$4.fromBufferAttribute(t,e),s=Math.max(s,i.distanceToSquared(_vector$4));if(e)for(let r=0,n=e.length;r<n;r++){const n=e[r],a=this.morphTargetsRelative;for(let e=0,r=n.count;e<r;e++)_vector$4.fromBufferAttribute(n,e),a&&(_offset.fromBufferAttribute(t,e),_vector$4.add(_offset)),s=Math.max(s,i.distanceToSquared(_vector$4))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const s=new Vector3$1,r=new Vector3$1,n=new Vector3$1,a=new Vector3$1,o=new Vector3$1,h=new Vector3$1,c=new Vector3$1,l=new Vector3$1;if(t)for(let u=0,p=t.count;u<p;u+=3){const p=t.getX(u+0),d=t.getX(u+1),f=t.getX(u+2);s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,d),n.fromBufferAttribute(e,f),c.subVectors(n,r),l.subVectors(s,r),c.cross(l),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,d),h.fromBufferAttribute(i,f),a.add(c),o.add(c),h.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(f,h.x,h.y,h.z)}else for(let t=0,a=e.count;t<a;t+=3)s.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),n.fromBufferAttribute(e,t+2),c.subVectors(n,r),l.subVectors(s,r),c.cross(l),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const s in i){if(void 0===t.attributes[s])continue;const r=i[s].array,n=t.attributes[s],a=n.array,o=n.itemSize*e,h=Math.min(a.length,r.length-o);for(let t=0,e=o;t<h;t++,e++)r[e]=a[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)_vector$4.fromBufferAttribute(t,e),_vector$4.normalize(),t.setXYZ(e,_vector$4.x,_vector$4.y,_vector$4.z)},toNonIndexed:function(){function t(t,e){const i=t.array,s=t.itemSize,r=t.normalized,n=new i.constructor(e.length*s);let a=0,o=0;for(let t=0,r=e.length;t<r;t++){a=e[t]*s;for(let t=0;t<s;t++)n[o++]=i[a++]}return new BufferAttribute(n,s,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new BufferGeometry,i=this.index.array,s=this.attributes;for(const r in s){const n=t(s[r],i);e.setAttribute(r,n)}const r=this.morphAttributes;for(const s in r){const n=[],a=r[s];for(let e=0,s=a.length;e<s;e++){const s=t(a[e],i);n.push(s)}e.morphAttributes[s]=n}e.morphTargetsRelative=this.morphTargetsRelative;const n=this.groups;for(let t=0,i=n.length;t<i;t++){const i=n[t];e.addGroup(i.start,i.count,i.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const s=i[e],r=s.toJSON(t.data);""!==s.name&&(r.name=s.name),t.data.attributes[e]=r}const s={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],n=[];for(let e=0,s=i.length;e<s;e++){const s=i[e],r=s.toJSON(t.data);""!==s.name&&(r.name=s.name),n.push(r)}n.length>0&&(s[e]=n,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const n=this.groups;n.length>0&&(t.data.groups=JSON.parse(JSON.stringify(n)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t},clone:function(){return(new BufferGeometry).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const s=t.attributes;for(const t in s){const i=s[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],s=r[t];for(let t=0,r=s.length;t<r;t++)i.push(s[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const n=t.groups;for(let t=0,e=n.length;t<e;t++){const e=n[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_vA=new Vector3$1,_vB=new Vector3$1,_vC=new Vector3$1,_tempA=new Vector3$1,_tempB=new Vector3$1,_tempC=new Vector3$1,_morphA=new Vector3$1,_morphB=new Vector3$1,_morphC=new Vector3$1,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2,_intersectionPoint=new Vector3$1,_intersectionPointWorld=new Vector3$1;function Mesh(t=new BufferGeometry,e=new MeshBasicMaterial){Object3D.call(this),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}function checkIntersection(t,e,i,s,r,n,a,o){let h;if(null===(h=e.side===BackSide?s.intersectTriangle(a,n,r,!0,o):s.intersectTriangle(r,n,a,e.side!==DoubleSide,o)))return null;_intersectionPointWorld.copy(o),_intersectionPointWorld.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(_intersectionPointWorld);return c<i.near||c>i.far?null:{distance:c,point:_intersectionPointWorld.clone(),object:t}}function checkBufferGeometryIntersection(t,e,i,s,r,n,a,o,h,c,l,u){_vA.fromBufferAttribute(r,c),_vB.fromBufferAttribute(r,l),_vC.fromBufferAttribute(r,u);const p=t.morphTargetInfluences;if(e.morphTargets&&n&&p){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(let t=0,e=n.length;t<e;t++){const e=p[t],i=n[t];0!==e&&(_tempA.fromBufferAttribute(i,c),_tempB.fromBufferAttribute(i,l),_tempC.fromBufferAttribute(i,u),a?(_morphA.addScaledVector(_tempA,e),_morphB.addScaledVector(_tempB,e),_morphC.addScaledVector(_tempC,e)):(_morphA.addScaledVector(_tempA.sub(_vA),e),_morphB.addScaledVector(_tempB.sub(_vB),e),_morphC.addScaledVector(_tempC.sub(_vC),e)))}_vA.add(_morphA),_vB.add(_morphB),_vC.add(_morphC)}t.isSkinnedMesh&&(t.boneTransform(c,_vA),t.boneTransform(l,_vB),t.boneTransform(u,_vC));const d=checkIntersection(t,e,i,s,_vA,_vB,_vC,_intersectionPoint);if(d){o&&(_uvA.fromBufferAttribute(o,c),_uvB.fromBufferAttribute(o,l),_uvC.fromBufferAttribute(o,u),d.uv=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),h&&(_uvA.fromBufferAttribute(h,c),_uvB.fromBufferAttribute(h,l),_uvC.fromBufferAttribute(h,u),d.uv2=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2));const t=new Face3(c,l,u);Triangle.getNormal(_vA,_vB,_vC,t.normal),d.face=t}return d}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const i=this.geometry,s=this.material,r=this.matrixWorld;if(void 0===s)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere.copy(i.boundingSphere),_sphere.applyMatrix4(r),!1===t.ray.intersectsSphere(_sphere))return;if(_inverseMatrix.copy(r).invert(),_ray.copy(t.ray).applyMatrix4(_inverseMatrix),null!==i.boundingBox&&!1===_ray.intersectsBox(i.boundingBox))return;let n;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position,o=i.morphAttributes.position,h=i.morphTargetsRelative,c=i.attributes.uv,l=i.attributes.uv2,u=i.groups,p=i.drawRange;if(null!==r)if(Array.isArray(s))for(let i=0,d=u.length;i<d;i++){const d=u[i],f=s[d.materialIndex];for(let i=Math.max(d.start,p.start),s=Math.min(d.start+d.count,p.start+p.count);i<s;i+=3){const s=r.getX(i),u=r.getX(i+1),p=r.getX(i+2);(n=checkBufferGeometryIntersection(this,f,t,_ray,a,o,h,c,l,s,u,p))&&(n.faceIndex=Math.floor(i/3),n.face.materialIndex=d.materialIndex,e.push(n))}}else{for(let i=Math.max(0,p.start),u=Math.min(r.count,p.start+p.count);i<u;i+=3){const u=r.getX(i),p=r.getX(i+1),d=r.getX(i+2);(n=checkBufferGeometryIntersection(this,s,t,_ray,a,o,h,c,l,u,p,d))&&(n.faceIndex=Math.floor(i/3),e.push(n))}}else if(void 0!==a)if(Array.isArray(s))for(let i=0,r=u.length;i<r;i++){const r=u[i],d=s[r.materialIndex];for(let i=Math.max(r.start,p.start),s=Math.min(r.start+r.count,p.start+p.count);i<s;i+=3){(n=checkBufferGeometryIntersection(this,d,t,_ray,a,o,h,c,l,i,i+1,i+2))&&(n.faceIndex=Math.floor(i/3),n.face.materialIndex=r.materialIndex,e.push(n))}}else{for(let i=Math.max(0,p.start),r=Math.min(a.count,p.start+p.count);i<r;i+=3){(n=checkBufferGeometryIntersection(this,s,t,_ray,a,o,h,c,l,i,i+1,i+2))&&(n.faceIndex=Math.floor(i/3),e.push(n))}}}else if(i.isGeometry){const r=Array.isArray(s),a=i.vertices,o=i.faces;let h;const c=i.faceVertexUvs[0];c.length>0&&(h=c);for(let i=0,c=o.length;i<c;i++){const c=o[i],l=r?s[c.materialIndex]:s;if(void 0===l)continue;const u=a[c.a],p=a[c.b],d=a[c.c];if(n=checkIntersection(this,l,t,_ray,u,p,d,_intersectionPoint)){if(h&&h[i]){const t=h[i];_uvA.copy(t[0]),_uvB.copy(t[1]),_uvC.copy(t[2]),n.uv=Triangle.getUV(_intersectionPoint,u,p,d,_uvA,_uvB,_uvC,new Vector2)}n.face=c,n.faceIndex=i,e.push(n)}}}}});class BoxBufferGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,s=1,r=1,n=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:s,heightSegments:r,depthSegments:n};const a=this;s=Math.floor(s),r=Math.floor(r),n=Math.floor(n);const o=[],h=[],c=[],l=[];let u=0,p=0;function d(t,e,i,s,r,n,d,f,m,g,y){const v=n/m,b=d/g,x=n/2,_=d/2,M=f/2,w=m+1,S=g+1;let A=0,T=0;const C=new Vector3$1;for(let n=0;n<S;n++){const a=n*b-_;for(let o=0;o<w;o++){const u=o*v-x;C[t]=u*s,C[e]=a*r,C[i]=M,h.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=f>0?1:-1,c.push(C.x,C.y,C.z),l.push(o/m),l.push(1-n/g),A+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+w*t,s=u+e+w*(t+1),r=u+(e+1)+w*(t+1),n=u+(e+1)+w*t;o.push(i,s,n),o.push(s,r,n),T+=6}a.addGroup(p,T,y),p+=T,u+=A}d("z","y","x",-1,-1,i,e,t,n,r,0),d("z","y","x",1,-1,i,e,-t,n,r,1),d("x","z","y",1,1,t,i,e,s,n,2),d("x","z","y",1,-1,t,i,-e,s,n,3),d("x","y","z",1,-1,t,e,i,s,r,4),d("x","y","z",-1,-1,t,e,-i,s,r,5),this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}}function cloneUniforms(t){const e={};for(const i in t){e[i]={};for(const s in t[i]){const r=t[i][s];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][s]=r.clone():Array.isArray(r)?e[i][s]=r.slice():e[i][s]=r}}return e}function mergeUniforms(t){const e={};for(let i=0;i<t.length;i++){const s=cloneUniforms(t[i]);for(const t in s)e[t]=s[t]}return e}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ShaderMaterial(t){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(t=50,e=1,i=.1,s=2e3){Camera.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},ShaderMaterial.prototype.toJSON=function(t){const e=Material.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?e.uniforms[i]={type:"t",value:s.toJSON(t).uuid}:s&&s.isColor?e.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[i]={type:"m4",value:s.toArray()}:e.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(t,e){return Object3D.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Vector3$1),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Object3D.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,e){Object3D.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(t,e){return Camera.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*MathUtils.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*MathUtils.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*MathUtils.RAD2DEG*Math.atan(Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,s,r,n){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const n=this.view;if(null!==this.view&&this.view.enabled){const t=n.fullWidth,a=n.fullHeight;r+=n.offsetX*s/t,e-=n.offsetY*i/a,s*=n.width/t,i*=n.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=Object3D.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const fov=90,aspect=1;function CubeCamera(t,e,i){if(Object3D.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const s=new PerspectiveCamera(fov,aspect,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Vector3$1(1,0,0)),this.add(s);const r=new PerspectiveCamera(fov,aspect,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Vector3$1(-1,0,0)),this.add(r);const n=new PerspectiveCamera(fov,aspect,t,e);n.layers=this.layers,n.up.set(0,0,1),n.lookAt(new Vector3$1(0,1,0)),this.add(n);const a=new PerspectiveCamera(fov,aspect,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Vector3$1(0,-1,0)),this.add(a);const o=new PerspectiveCamera(fov,aspect,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Vector3$1(0,0,1)),this.add(o);const h=new PerspectiveCamera(fov,aspect,t,e);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new Vector3$1(0,0,-1)),this.add(h),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const c=t.xr.enabled,l=t.getRenderTarget();t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,s),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,n),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,h),t.setRenderTarget(l),t.xr.enabled=c}}function CubeTexture(t,e,i,s,r,n,a,o,h,c){t=void 0!==t?t:[],e=void 0!==e?e:CubeReflectionMapping,a=void 0!==a?a:RGBFormat,Texture.call(this,t,e,i,s,r,n,a,o,h,c),this.flipY=!1,this._needsFlipEnvMap=!0}function WebGLCubeRenderTarget(t,e,i){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=i),WebGLRenderTarget.call(this,t,t,e),e=e||{},this.texture=new CubeTexture(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsFlipEnvMap=!1}function DataTexture(t,e,i,s,r,n,a,o,h,c,l,u){Texture.call(this,null,n,a,o,h,c,s,r,l,u),this.image={data:t||null,width:e||1,height:i||1},this.magFilter=void 0!==h?h:NearestFilter,this.minFilter=void 0!==c?c:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype),WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget,WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0,WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=RGBAFormat,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},s=new BoxBufferGeometry(5,5,5),r=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:BackSide,blending:NoBlending});r.uniforms.tEquirect.value=e;const n=new Mesh(s,r),a=e.minFilter;return e.minFilter===LinearMipmapLinearFilter&&(e.minFilter=LinearFilter),new CubeCamera(1,10,this).update(t,n),e.minFilter=a,n.geometry.dispose(),n.material.dispose(),this},WebGLCubeRenderTarget.prototype.clear=function(t,e,i,s){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,s);t.setRenderTarget(r)},DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;const _sphere$1=new Sphere,_vector$5=new Vector3$1;class Frustum{constructor(t,e,i,s,r,n){this.planes=[void 0!==t?t:new Plane,void 0!==e?e:new Plane,void 0!==i?i:new Plane,void 0!==s?s:new Plane,void 0!==r?r:new Plane,void 0!==n?n:new Plane]}set(t,e,i,s,r,n){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(n),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,s=i[0],r=i[1],n=i[2],a=i[3],o=i[4],h=i[5],c=i[6],l=i[7],u=i[8],p=i[9],d=i[10],f=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return e[0].setComponents(a-s,l-o,f-u,v-m).normalize(),e[1].setComponents(a+s,l+o,f+u,v+m).normalize(),e[2].setComponents(a+r,l+h,f+p,v+g).normalize(),e[3].setComponents(a-r,l-h,f-p,v-g).normalize(),e[4].setComponents(a-n,l-c,f-d,v-y).normalize(),e[5].setComponents(a+n,l+c,f+d,v+y).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$1.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$1)}intersectsSprite(t){return _sphere$1.center.set(0,0,0),_sphere$1.radius=.7071067811865476,_sphere$1.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$1)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<s)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(_vector$5.x=s.normal.x>0?t.max.x:t.min.x,_vector$5.y=s.normal.y>0?t.max.y:t.min.y,_vector$5.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(_vector$5)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}function WebGLAnimation(){let t=null,e=!1,i=null,s=null;function r(e,n){i(e,n),s=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(s=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function WebGLAttributes(t,e){const i=e.isWebGL2,s=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),s.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=s.get(e);i&&(t.deleteBuffer(i.buffer),s.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=s.get(e);return void((!t||t.version<e.version)&&s.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const n=s.get(e);void 0===n?s.set(e,function(e,s){const r=e.array,n=e.usage,a=t.createBuffer();t.bindBuffer(s,a),t.bufferData(s,r,n),e.onUploadCallback();let o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?i?o=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:r instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):n.version<e.version&&(function(e,s,r){const n=s.array,a=s.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,n):(i?t.bufferSubData(r,a.offset*n.BYTES_PER_ELEMENT,n,a.offset,a.count):t.bufferSubData(r,a.offset*n.BYTES_PER_ELEMENT,n.subarray(a.offset,a.offset+a.count)),a.count=-1)}(n.buffer,e,r),n.version=e.version)}}}class PlaneBufferGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,s=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:s};const r=t/2,n=e/2,a=Math.floor(i),o=Math.floor(s),h=a+1,c=o+1,l=t/a,u=e/o,p=[],d=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-n;for(let i=0;i<h;i++){const s=i*l-r;d.push(s,-e,0),f.push(0,0,1),m.push(i/a),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+h*t,s=e+h*(t+1),r=e+1+h*(t+1),n=e+1+h*t;p.push(i,s,n),p.push(s,r,n)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}}var alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex="#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment="#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment="#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert="#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}";const ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_pars_fragment:clearcoat_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,transmissionmap_fragment:transmissionmap_fragment,transmissionmap_pars_fragment:transmissionmap_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_frag:background_frag,background_vert:background_vert,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshmatcap_frag:meshmatcap_frag,meshmatcap_vert:meshmatcap_vert,meshtoon_frag:meshtoon_frag,meshtoon_vert:meshtoon_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert,sprite_frag:sprite_frag,sprite_vert:sprite_vert},UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3$1},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};function WebGLBackground(t,e,i,s,r){const n=new Color(0);let a,o,h=0,c=null,l=0,u=null;function p(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return n},setClearColor:function(t,e=1){n.set(t),p(n,h=e)},getClearAlpha:function(){return h},setClearAlpha:function(t){p(n,h=t)},render:function(i,r,d,f){let m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?p(n,h):m&&m.isColor&&(p(m,1),f=!0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===CubeUVReflectionMapping)?(void 0===o&&((o=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(o)),m.isWebGLCubeRenderTarget&&(m=m.texture),o.material.uniforms.envMap.value=m,o.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,c===m&&l===m.version&&u===t.toneMapping||(o.material.needsUpdate=!0,c=m,l=m.version,u=t.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null)):m&&m.isTexture&&(void 0===a&&((a=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),c===m&&l===m.version&&u===t.toneMapping||(a.material.needsUpdate=!0,c=m,l=m.version,u=t.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null))}}}function WebGLBindingStates(t,e,i,s){const r=t.getParameter(34921),n=s.isWebGL2?null:e.get("OES_vertex_array_object"),a=s.isWebGL2||null!==n,o={},h=p(null);let c=h;function l(e){return s.isWebGL2?t.bindVertexArray(e):n.bindVertexArrayOES(e)}function u(e){return s.isWebGL2?t.deleteVertexArray(e):n.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],s=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,s[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:s,object:t,attributes:{},index:null}}function d(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){m(t,0)}function m(i,r){const n=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(n[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r){(s.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r}}function g(){const e=c.newAttributes,i=c.enabledAttributes;for(let s=0,r=i.length;s<r;s++)i[s]!==e[s]&&(t.disableVertexAttribArray(s),i[s]=0)}function y(e,i,r,n,a,o){!0!==s.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,n,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function v(){b(),c!==h&&l((c=h).object)}function b(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:function(r,h,u,v,b){let x=!1;if(a){const e=function(e,i,r){const a=!0===r.wireframe;let h=o[e.id];void 0===h&&(h={},o[e.id]=h);let c=h[i.id];void 0===c&&(c={},h[i.id]=c);let l=c[a];return void 0===l&&(l=p(s.isWebGL2?t.createVertexArray():n.createVertexArrayOES()),c[a]=l),l}(v,u,h);c!==e&&l((c=e).object),(x=function(t,e){const i=c.attributes,s=t.attributes;let r=0;for(const t in s){const e=i[t],n=s[t];if(void 0===e)return!0;if(e.attribute!==n)return!0;if(e.data!==n.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(v,b))&&function(t,e){const i={},s=t.attributes;let r=0;for(const t in s){const e=s[t],n={};n.attribute=e,e.data&&(n.data=e.data),i[t]=n,r++}c.attributes=i,c.attributesNum=r,c.index=e}(v,b)}else{const t=!0===h.wireframe;c.geometry===v.id&&c.program===u.id&&c.wireframe===t||(c.geometry=v.id,c.program=u.id,c.wireframe=t,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==b&&i.update(b,34963),x&&(function(r,n,a,o){if(!1===s.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const h=o.attributes,c=a.getAttributes(),l=n.defaultAttributeValues;for(const e in c){const s=c[e];if(s>=0){const n=h[e];if(void 0!==n){const e=n.normalized,r=n.itemSize,a=i.get(n);if(void 0===a)continue;const h=a.buffer,c=a.type,l=a.bytesPerElement;if(n.isInterleavedBufferAttribute){const i=n.data,a=i.stride,u=n.offset;i&&i.isInstancedInterleavedBuffer?(m(s,i.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)):f(s),t.bindBuffer(34962,h),y(s,r,c,e,a*l,u*l)}else n.isInstancedBufferAttribute?(m(s,n.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)):f(s),t.bindBuffer(34962,h),y(s,r,c,e,0,0)}else if("instanceMatrix"===e){const e=i.get(r.instanceMatrix);if(void 0===e)continue;const n=e.buffer,a=e.type;m(s+0,1),m(s+1,1),m(s+2,1),m(s+3,1),t.bindBuffer(34962,n),t.vertexAttribPointer(s+0,4,a,!1,64,0),t.vertexAttribPointer(s+1,4,a,!1,64,16),t.vertexAttribPointer(s+2,4,a,!1,64,32),t.vertexAttribPointer(s+3,4,a,!1,64,48)}else if("instanceColor"===e){const e=i.get(r.instanceColor);if(void 0===e)continue;const n=e.buffer,a=e.type;m(s,1),t.bindBuffer(34962,n),t.vertexAttribPointer(s,3,a,!1,12,0)}else if(void 0!==l){const i=l[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(s,i);break;case 3:t.vertexAttrib3fv(s,i);break;case 4:t.vertexAttrib4fv(s,i);break;default:t.vertexAttrib1fv(s,i)}}}}g()}(r,h,u,v),null!==b&&t.bindBuffer(34963,i.get(b).buffer))},reset:v,resetDefaultState:b,dispose:function(){v();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const s=i[t.id];for(const t in s)u(s[t].object),delete s[t];delete i[t.id]}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:g}}function WebGLBufferRenderer(t,e,i,s){const r=s.isWebGL2;let n;this.setMode=function(t){n=t},this.render=function(e,s){t.drawArrays(n,e,s),i.update(s,n,1)},this.renderInstances=function(s,a,o){if(0===o)return;let h,c;if(r)h=t,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(h=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[c](n,s,a,o),i.update(a,n,o)}}function WebGLCapabilities(t,e,i){let s;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const n="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const h=!0===i.logarithmicDepthBuffer,c=t.getParameter(34930),l=t.getParameter(35660),u=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),y=l>0,v=n||!!e.get("OES_texture_float");return{isWebGL2:n,getMaxAnisotropy:function(){if(void 0!==s)return s;const i=e.get("EXT_texture_filter_anisotropic");return s=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:l,maxTextureSize:u,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:n?t.getParameter(36183):0}}function WebGLClipping(t){const e=this;let i=null,s=0,r=!1,n=!1;const a=new Plane,o=new Matrix3,h={value:null,needsUpdate:!1};function c(){h.value!==i&&(h.value=i,h.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0}function l(t,i,s,r){const n=null!==t?t.length:0;let c=null;if(0!==n){if(c=h.value,!0!==r||null===c){const e=s+4*n,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=s;e!==n;++e,i+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(c,i),c[i+3]=a.constant}h.value=c,h.needsUpdate=!0}return e.numPlanes=n,e.numIntersection=0,c}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,n){const a=0!==t.length||e||0!==s||r;return r=e,i=l(t,n,0),s=t.length,a},this.beginShadows=function(){n=!0,l(null)},this.endShadows=function(){n=!1,c()},this.setState=function(e,a,o){const u=e.clippingPlanes,p=e.clipIntersection,d=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||n&&!d)n?l(null):c();else{const t=n?0:s,e=4*t;let r=f.clippingState||null;h.value=r,r=l(u,a,e,o);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=t}}}function WebGLCubeMaps(t){let e=new WeakMap;function i(t,e){return e===EquirectangularReflectionMapping?t.mapping=CubeReflectionMapping:e===EquirectangularRefractionMapping&&(t.mapping=CubeRefractionMapping),t}function s(t){const i=t.target;i.removeEventListener("dispose",s);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const n=r.mapping;if(n===EquirectangularReflectionMapping||n===EquirectangularRefractionMapping){if(e.has(r))return i(e.get(r).texture,r.mapping);{const n=r.image;if(n&&n.height>0){const a=t.getRenderList(),o=t.getRenderTarget(),h=new WebGLCubeRenderTarget(n.height/2);return h.fromEquirectangularTexture(t,r),e.set(r,h),t.setRenderTarget(o),t.setRenderList(a),r.addEventListener("dispose",s),i(h.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}function WebGLExtensions(t){const e={};return{has:function(i){if(void 0!==e[i])return null!==e[i];let s;switch(i){case"WEBGL_depth_texture":s=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=t.getExtension(i)}return e[i]=s,null!==s},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e[t]}}}function WebGLGeometries(t,e,i,s){const r=new WeakMap,n=new WeakMap;function a(t){const o=t.target,h=r.get(o);null!==h.index&&e.remove(h.index);for(const t in h.attributes)e.remove(h.attributes[t]);o.removeEventListener("dispose",a),r.delete(o);const c=n.get(h);c&&(e.remove(c),n.delete(h)),s.releaseStatesOfGeometry(h),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],s=t.index,r=t.attributes.position;let a=0;if(null!==s){const t=s.array;a=s.version;for(let e=0,s=t.length;e<s;e+=3){const s=t[e+0],r=t[e+1],n=t[e+2];i.push(s,r,r,n,n,s)}}else{const t=r.array;a=r.version;for(let e=0,s=t.length/3-1;e<s;e+=3){const t=e+0,s=e+1,r=e+2;i.push(t,s,s,r,r,t)}}const o=new(arrayMax(i)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);o.version=a;const h=n.get(t);h&&e.remove(h),n.set(t,o)}return{get:function(t,e){let s=r.get(e);return s||(e.addEventListener("dispose",a),e.isBufferGeometry?s=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new BufferGeometry).setFromObject(t)),s=e._bufferGeometry),r.set(e,s),i.memory.geometries++,s)},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const s=t.morphAttributes;for(const t in s){const i=s[t];for(let t=0,s=i.length;t<s;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=n.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return n.get(t)}}}function WebGLIndexedBufferRenderer(t,e,i,s){const r=s.isWebGL2;let n,a,o;this.setMode=function(t){n=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,s){t.drawElements(n,s,a,e*o),i.update(s,n,1)},this.renderInstances=function(s,h,c){if(0===c)return;let l,u;if(r)l=t,u="drawElementsInstanced";else if(u="drawElementsInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](n,h,a,s*o,c),i.update(h,n,c)}}function WebGLInfo(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,s){switch(e.calls++,i){case 4:e.triangles+=s*(t/3);break;case 1:e.lines+=s*(t/2);break;case 3:e.lines+=s*(t-1);break;case 2:e.lines+=s*t;break;case 0:e.points+=s*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function numericalSort(t,e){return t[0]-e[0]}function absNumericalSort(t,e){return Math.abs(e[1])-Math.abs(t[1])}function WebGLMorphtargets(t){const e={},i=new Float32Array(8),s=[];for(let t=0;t<8;t++)s[t]=[t,0];return{update:function(r,n,a,o){const h=r.morphTargetInfluences,c=void 0===h?0:h.length;let l=e[n.id];if(void 0===l){l=[];for(let t=0;t<c;t++)l[t]=[t,0];e[n.id]=l}for(let t=0;t<c;t++){const e=l[t];e[0]=t,e[1]=h[t]}l.sort(absNumericalSort);for(let t=0;t<8;t++)t<c&&l[t][1]?(s[t][0]=l[t][0],s[t][1]=l[t][1]):(s[t][0]=Number.MAX_SAFE_INTEGER,s[t][1]=0);s.sort(numericalSort);const u=a.morphTargets&&n.morphAttributes.position,p=a.morphNormals&&n.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=s[t],r=e[0],a=e[1];r!==Number.MAX_SAFE_INTEGER&&a?(u&&n.getAttribute("morphTarget"+t)!==u[r]&&n.setAttribute("morphTarget"+t,u[r]),p&&n.getAttribute("morphNormal"+t)!==p[r]&&n.setAttribute("morphNormal"+t,p[r]),i[t]=a,d+=a):(u&&!0===n.hasAttribute("morphTarget"+t)&&n.deleteAttribute("morphTarget"+t),p&&!0===n.hasAttribute("morphNormal"+t)&&n.deleteAttribute("morphNormal"+t),i[t]=0)}const f=n.morphTargetsRelative?1:1-d;o.getUniforms().setValue(t,"morphTargetBaseInfluence",f),o.getUniforms().setValue(t,"morphTargetInfluences",i)}}}function WebGLObjects(t,e,i,s){let r=new WeakMap;function n(t){const e=t.target;e.removeEventListener("dispose",n),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const a=s.render.frame,o=t.geometry,h=e.get(t,o);return r.get(h)!==a&&(o.isGeometry&&h.updateFromObject(t),e.update(h),r.set(h,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",n)&&t.addEventListener("dispose",n),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),h},dispose:function(){r=new WeakMap}}}function DataTexture2DArray(t=null,e=1,i=1,s=1){Texture.call(this,null),this.image={data:t,width:e,height:i,depth:s},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function DataTexture3D(t=null,e=1,i=1,s=1){Texture.call(this,null),this.image={data:t,width:e,height:i,depth:s},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},DataTexture2DArray.prototype=Object.create(Texture.prototype),DataTexture2DArray.prototype.constructor=DataTexture2DArray,DataTexture2DArray.prototype.isDataTexture2DArray=!0,DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;const emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(t,e,i){const s=t[0];if(s<=0||s>0)return t;const r=e*i;let n=arrayCacheF32[r];if(void 0===n&&(n=new Float32Array(r),arrayCacheF32[r]=n),0!==e){s.toArray(n,0);for(let s=1,r=0;s!==e;++s)r+=i,t[s].toArray(n,r)}return n}function arraysEqual(t,e){if(t.length!==e.length)return!1;for(let i=0,s=t.length;i<s;i++)if(t[i]!==e[i])return!1;return!0}function copyArray(t,e){for(let i=0,s=e.length;i<s;i++)t[i]=e[i]}function allocTexUnits(t,e){let i=arrayCacheI32[e];void 0===i&&(i=new Int32Array(e),arrayCacheI32[e]=i);for(let s=0;s!==e;++s)i[s]=t.allocateTextureUnit();return i}function setValueV1f(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function setValueV2f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;t.uniform2fv(this.addr,e),copyArray(i,e)}}function setValueV3f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(arraysEqual(i,e))return;t.uniform3fv(this.addr,e),copyArray(i,e)}}function setValueV4f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;t.uniform4fv(this.addr,e),copyArray(i,e)}}function setValueM2(t,e){const i=this.cache,s=e.elements;if(void 0===s){if(arraysEqual(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,s))return;mat2array.set(s),t.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(i,s)}}function setValueM3(t,e){const i=this.cache,s=e.elements;if(void 0===s){if(arraysEqual(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,s))return;mat3array.set(s),t.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(i,s)}}function setValueM4(t,e){const i=this.cache,s=e.elements;if(void 0===s){if(arraysEqual(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,s))return;mat4array.set(s),t.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(i,s)}}function setValueT1(t,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(t.uniform1i(this.addr,r),s[0]=r),i.safeSetTexture2D(e||emptyTexture,r)}function setValueT2DArray1(t,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(t.uniform1i(this.addr,r),s[0]=r),i.setTexture2DArray(e||emptyTexture2dArray,r)}function setValueT3D1(t,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(t.uniform1i(this.addr,r),s[0]=r),i.setTexture3D(e||emptyTexture3d,r)}function setValueT6(t,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(t.uniform1i(this.addr,r),s[0]=r),i.safeSetTextureCube(e||emptyCubeTexture,r)}function setValueV1i(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function setValueV2i(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform2iv(this.addr,e),copyArray(i,e))}function setValueV3i(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform3iv(this.addr,e),copyArray(i,e))}function setValueV4i(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform4iv(this.addr,e),copyArray(i,e))}function setValueV1ui(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function getSingularSetter(t){switch(t){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(t,e){t.uniform1fv(this.addr,e)}function setValueV1iArray(t,e){t.uniform1iv(this.addr,e)}function setValueV2iArray(t,e){t.uniform2iv(this.addr,e)}function setValueV3iArray(t,e){t.uniform3iv(this.addr,e)}function setValueV4iArray(t,e){t.uniform4iv(this.addr,e)}function setValueV2fArray(t,e){const i=flatten(e,this.size,2);t.uniform2fv(this.addr,i)}function setValueV3fArray(t,e){const i=flatten(e,this.size,3);t.uniform3fv(this.addr,i)}function setValueV4fArray(t,e){const i=flatten(e,this.size,4);t.uniform4fv(this.addr,i)}function setValueM2Array(t,e){const i=flatten(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(t,e){const i=flatten(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(t,e){const i=flatten(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function setValueT1Array(t,e,i){const s=e.length,r=allocTexUnits(i,s);t.uniform1iv(this.addr,r);for(let t=0;t!==s;++t)i.safeSetTexture2D(e[t]||emptyTexture,r[t])}function setValueT6Array(t,e,i){const s=e.length,r=allocTexUnits(i,s);t.uniform1iv(this.addr,r);for(let t=0;t!==s;++t)i.safeSetTextureCube(e[t]||emptyCubeTexture,r[t])}function getPureArraySetter(t){switch(t){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=getSingularSetter(e.type)}function PureArrayUniform(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=getPureArraySetter(e.type)}function StructuredUniform(t){this.id=t,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),copyArray(e,t)},StructuredUniform.prototype.setValue=function(t,e,i){const s=this.seq;for(let r=0,n=s.length;r!==n;++r){const n=s[r];n.setValue(t,e[n.id],i)}};const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(t,e){t.seq.push(e),t.map[e.id]=e}function parseUniform(t,e,i){const s=t.name,r=s.length;for(RePathPart.lastIndex=0;;){const n=RePathPart.exec(s),a=RePathPart.lastIndex;let o=n[1];const h="]"===n[2],c=n[3];if(h&&(o|=0),void 0===c||"["===c&&a+2===r){addUniform(i,void 0===c?new SingleUniform(o,t,e):new PureArrayUniform(o,t,e));break}{let t=i.map[o];void 0===t&&addUniform(i,t=new StructuredUniform(o)),i=t}}}function WebGLUniforms(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let s=0;s<i;++s){const i=t.getActiveUniform(e,s);parseUniform(i,t.getUniformLocation(e,i.name),this)}}function WebGLShader(t,e,i){const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),s}WebGLUniforms.prototype.setValue=function(t,e,i,s){const r=this.map[e];void 0!==r&&r.setValue(t,i,s)},WebGLUniforms.prototype.setOptional=function(t,e,i){const s=e[i];void 0!==s&&this.setValue(t,i,s)},WebGLUniforms.upload=function(t,e,i,s){for(let r=0,n=e.length;r!==n;++r){const n=e[r],a=i[n.id];!1!==a.needsUpdate&&n.setValue(t,a.value,s)}},WebGLUniforms.seqWithValue=function(t,e){const i=[];for(let s=0,r=t.length;s!==r;++s){const r=t[s];r.id in e&&i.push(r)}return i};let programIdCount=0;function addLineNumbers(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function getEncodingComponents(t){switch(t){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function getShaderErrors(t,e,i){const s=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return s&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+addLineNumbers(t.getShaderSource(e))}function getTexelDecodingFunction(t,e){const i=getEncodingComponents(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(t,e){const i=getEncodingComponents(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(t,e){let i;switch(e){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;case CustomToneMapping:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateExtensions(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(t){const e=[];for(const i in t){const s=t[i];!1!==s&&e.push("#define "+i+" "+s)}return e.join("\n")}function fetchAttributeLocations(t,e){const i={},s=t.getProgramParameter(e,35721);for(let r=0;r<s;r++){const s=t.getActiveAttrib(e,r).name;i[s]=t.getAttribLocation(e,s)}return i}function filterEmptyLine(t){return""!==t}function replaceLightNums(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function replaceClippingPlaneNums(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d.\/]+)>/gm;function resolveIncludes(t){return t.replace(includePattern,includeReplacer)}function includeReplacer(t,e){const i=ShaderChunk[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return resolveIncludes(i)}const deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(t){return t.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(t,e,i,s){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(t,e,i,s)}function loopReplacer(t,e,i,s){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=s.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function generatePrecision(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function generateShadowMapTypeDefine(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===PCFShadowMap?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===PCFSoftShadowMap?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===VSMShadowMap&&(e="SHADOWMAP_TYPE_VSM"),e}function generateEnvMapTypeDefine(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:e="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:e="ENVMAP_TYPE_CUBE_UV"}return e}function generateEnvMapModeDefine(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case CubeRefractionMapping:case CubeUVRefractionMapping:e="ENVMAP_MODE_REFRACTION"}return e}function generateEnvMapBlendingDefine(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case MultiplyOperation:e="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:e="ENVMAP_BLENDING_MIX";break;case AddOperation:e="ENVMAP_BLENDING_ADD"}return e}function WebGLProgram(t,e,i,s){const r=t.getContext(),n=i.defines;let a=i.vertexShader,o=i.fragmentShader;const h=generateShadowMapTypeDefine(i),c=generateEnvMapTypeDefine(i),l=generateEnvMapModeDefine(i),u=generateEnvMapBlendingDefine(i),p=t.gammaFactor>0?t.gammaFactor:1,d=i.isWebGL2?"":generateExtensions(i),f=generateDefines(n),m=r.createProgram();let g,y,v=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((g=[f].filter(filterEmptyLine).join("\n")).length>0&&(g+="\n"),(y=[d,f].filter(filterEmptyLine).join("\n")).length>0&&(y+="\n")):(g=[generatePrecision(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),y=[d,generatePrecision(i),"#define SHADER_NAME "+i.shaderName,f,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+l:"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",i.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",ShaderChunk.encodings_pars_fragment,i.map?getTexelDecodingFunction("mapTexelToLinear",i.mapEncoding):"",i.matcap?getTexelDecodingFunction("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?getTexelDecodingFunction("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",i.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),a=replaceClippingPlaneNums(a=replaceLightNums(a=resolveIncludes(a),i),i),o=replaceClippingPlaneNums(o=replaceLightNums(o=resolveIncludes(o),i),i),a=unrollLoops(a),o=unrollLoops(o),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(v="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#define varying in",i.glslVersion===GLSL3?"":"out highp vec4 pc_fragColor;",i.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const b=v+y+o,x=WebGLShader(r,35633,v+g+a),_=WebGLShader(r,35632,b);if(r.attachShader(m,x),r.attachShader(m,_),void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(m).trim(),e=r.getShaderInfoLog(x).trim(),i=r.getShaderInfoLog(_).trim();let s=!0,n=!0;if(!1===r.getProgramParameter(m,35714)){s=!1;const e=getShaderErrors(r,x,"vertex"),i=getShaderErrors(r,_,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(m,35715),"gl.getProgramInfoLog",t,e,i)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==i||(n=!1);n&&(this.diagnostics={runnable:s,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:i,prefix:y}})}let M,w;return r.deleteShader(x),r.deleteShader(_),this.getUniforms=function(){return void 0===M&&(M=new WebGLUniforms(r,m)),M},this.getAttributes=function(){return void 0===w&&(w=fetchAttributeLocations(r,m)),w},this.destroy=function(){s.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=_,this}function WebGLPrograms(t,e,i,s,r,n){const a=[],o=s.isWebGL2,h=s.logarithmicDepthBuffer,c=s.floatVertexTextures,l=s.maxVertexUniforms,u=s.vertexTextures;let p=s.precision;const d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=LinearEncoding,e}return{getParameters:function(r,a,f,g,y){const v=g.fog,b=r.isMeshStandardMaterial?g.environment:null,x=e.get(r.envMap||b),_=d[r.type],M=y.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(c)return 1024;{const t=l,i=Math.floor((t-20)/4),s=Math.min(i,e.length);return s<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+s+"."),0):s}}(y):0;let w,S;if(null!==r.precision&&(p=s.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead."),_){const t=ShaderLib[_];w=t.vertexShader,S=t.fragmentShader}else w=r.vertexShader,S=r.fragmentShader;const A=t.getRenderTarget();return{isWebGL2:o,shaderID:_,shaderName:r.type,vertexShader:w,fragmentShader:S,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:u,outputEncoding:null!==A?m(A.texture):t.outputEncoding,map:!!r.map,mapEncoding:m(r.map),matcap:!!r.matcap,matcapEncoding:m(r.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(x.mapping===CubeUVReflectionMapping||x.mapping===CubeUVRefractionMapping),lightMap:!!r.lightMap,lightMapEncoding:m(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:m(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:r.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!v,useFog:r.fog,fogExp2:v&&v.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:h,skinning:r.skinning&&M>0,maxBones:M,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:n.numPlanes,numClipIntersection:n.numIntersection,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&f.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:NoToneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===DoubleSide,flipSided:r.side===BackSide,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:o||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<f.length;t++)i.push(e[f[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=d[t.type];let i;if(e){const t=ShaderLib[e];i=UniformsUtils.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let s;for(let t=0,e=a.length;t<e;t++){const e=a[t];if(e.cacheKey===i){++(s=e).usedTimes;break}}return void 0===s&&(s=new WebGLProgram(t,i,e,r),a.push(s)),s},releaseProgram:function(t){if(0==--t.usedTimes){const e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function WebGLProperties(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,s){t.get(e)[i]=s},dispose:function(){t=new WeakMap}}}function painterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function reversePainterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function WebGLRenderList(t){const e=[];let i=0;const s=[],r=[],n={id:-1};function a(s,r,a,o,h,c){let l=e[i];const u=t.get(a);return void 0===l?(l={id:s.id,object:s,geometry:r,material:a,program:u.program||n,groupOrder:o,renderOrder:s.renderOrder,z:h,group:c},e[i]=l):(l.id=s.id,l.object=s,l.geometry=r,l.material=a,l.program=u.program||n,l.groupOrder=o,l.renderOrder=s.renderOrder,l.z=h,l.group=c),i++,l}return{opaque:s,transparent:r,init:function(){i=0,s.length=0,r.length=0},push:function(t,e,i,n,o,h){const c=a(t,e,i,n,o,h);(!0===i.transparent?r:s).push(c)},unshift:function(t,e,i,n,o,h){const c=a(t,e,i,n,o,h);(!0===i.transparent?r:s).unshift(c)},finish:function(){for(let t=i,s=e.length;t<s;t++){const i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){s.length>1&&s.sort(t||painterSortStable),r.length>1&&r.sort(e||reversePainterSortStable)}}}function WebGLRenderLists(t){let e=new WeakMap;return{get:function(i,s){const r=e.get(i);let n;return void 0===r?(n=new WebGLRenderList(t),e.set(i,new WeakMap),e.get(i).set(s,n)):void 0===(n=r.get(s))&&(n=new WebGLRenderList(t),r.set(s,n)),n},dispose:function(){e=new WeakMap}}}function UniformsCache(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Vector3$1,color:new Color};break;case"SpotLight":i={position:new Vector3$1,direction:new Vector3$1,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3$1,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3$1,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3$1,halfWidth:new Vector3$1,halfHeight:new Vector3$1}}return t[e.id]=i,i}}}function ShadowUniformsCache(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}let nextVersion=0;function shadowCastingLightsFirst(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function WebGLLights(t,e){const i=new UniformsCache,s=ShadowUniformsCache(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new Vector3$1);const n=new Vector3$1,a=new Matrix4,o=new Matrix4;return{setup:function(n){let a=0,o=0,h=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,l=0,u=0,p=0,d=0,f=0,m=0,g=0;n.sort(shadowCastingLightsFirst);for(let t=0,e=n.length;t<e;t++){const e=n[t],y=e.color,v=e.intensity,b=e.distance,x=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=y.r*v,o+=y.g*v,h+=y.b*v;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,i=s.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=x,r.directionalShadowMatrix[c]=e.shadow.matrix,f++}r.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(y).multiplyScalar(v),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=s.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[u]=i,r.spotShadowMap[u]=x,r.spotShadowMatrix[u]=e.shadow.matrix,g++}r.spot[u]=t,u++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(y).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=s.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[l]=i,r.pointShadowMap[l]=x,r.pointShadowMatrix[l]=e.shadow.matrix,m++}r.point[l]=t,l++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(v),t.groundColor.copy(e.groundColor).multiplyScalar(v),r.hemi[d]=t,d++}}p>0&&(e.isWebGL2?(r.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,r.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,r.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=UniformsLib.LTC_HALF_1,r.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=h;const y=r.hash;y.directionalLength===c&&y.pointLength===l&&y.spotLength===u&&y.rectAreaLength===p&&y.hemiLength===d&&y.numDirectionalShadows===f&&y.numPointShadows===m&&y.numSpotShadows===g||(r.directional.length=c,r.spot.length=u,r.rectArea.length=p,r.point.length=l,r.hemi.length=d,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=g,y.directionalLength=c,y.pointLength=l,y.spotLength=u,y.rectAreaLength=p,y.hemiLength=d,y.numDirectionalShadows=f,y.numPointShadows=m,y.numSpotShadows=g,r.version=nextVersion++)},setupView:function(t,e){let i=0,s=0,h=0,c=0,l=0;const u=e.matrixWorldInverse;for(let e=0,p=t.length;e<p;e++){const p=t[e];if(p.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(p.matrixWorld),n.setFromMatrixPosition(p.target.matrixWorld),t.direction.sub(n),t.direction.transformDirection(u),i++}else if(p.isSpotLight){const t=r.spot[h];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(p.matrixWorld),n.setFromMatrixPosition(p.target.matrixWorld),t.direction.sub(n),t.direction.transformDirection(u),h++}else if(p.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(p.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*p.width,0,0),t.halfHeight.set(0,.5*p.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(p.isPointLight){const t=r.point[s];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(u),s++}else if(p.isHemisphereLight){const t=r.hemi[l];t.direction.setFromMatrixPosition(p.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),l++}}},state:r}}function WebGLRenderState(t,e){const i=new WebGLLights(t,e),s=[],r=[];return{init:function(){s.length=0,r.length=0},state:{lightsArray:s,shadowsArray:r,lights:i},setupLights:function(){i.setup(s)},setupLightsView:function(t){i.setupView(s,t)},pushLight:function(t){s.push(t)},pushShadow:function(t){r.push(t)}}}function WebGLRenderStates(t,e){let i=new WeakMap;return{get:function(s,r=0){let n;return!1===i.has(s)?(n=new WebGLRenderState(t,e),i.set(s,[]),i.get(s).push(n)):r>=i.get(s).length?(n=new WebGLRenderState(t,e),i.get(s).push(n)):n=i.get(s)[r],n},dispose:function(){i=new WeakMap}}}function MeshDepthMaterial(t){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function MeshDistanceMaterial(t){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3$1,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var vsm_frag="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",vsm_vert="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function WebGLShadowMap(t,e,i){let s=new Frustum;const r=new Vector2,n=new Vector2,a=new Vector4,o=[],h=[],c={},l={0:BackSide,1:FrontSide,2:DoubleSide},u=new ShaderMaterial({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),p=u.clone();p.defines.HORIZONTAL_PASS=1;const d=new BufferGeometry;d.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new Mesh(d,u),m=this;function g(i,s){const r=e.update(f);u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(s,null,r,u,f,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(s,null,r,p,f,null)}function y(t,e,i){const s=t<<0|e<<1|i<<2;let r=o[s];return void 0===r&&(r=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:t,skinning:e}),o[s]=r),r}function v(t,e,i){const s=t<<0|e<<1|i<<2;let r=h[s];return void 0===r&&(r=new MeshDistanceMaterial({morphTargets:t,skinning:e}),h[s]=r),r}function b(e,i,s,r,n,a,o){let h=null,u=y,p=e.customDepthMaterial;if(!0===r.isPointLight&&(u=v,p=e.customDistanceMaterial),void 0===p){let t=!1;!0===s.morphTargets&&(t=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let r=!1;!0===e.isSkinnedMesh&&(!0===s.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),h=u(t,r,!0===e.isInstancedMesh)}else h=p;if(t.localClippingEnabled&&!0===s.clipShadows&&0!==s.clippingPlanes.length){const t=h.uuid,e=s.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=h.clone(),i[e]=r),h=r}return h.visible=s.visible,h.wireframe=s.wireframe,h.side=o===VSMShadowMap?null!==s.shadowSide?s.shadowSide:s.side:null!==s.shadowSide?s.shadowSide:l[s.side],h.clipShadows=s.clipShadows,h.clippingPlanes=s.clippingPlanes,h.clipIntersection=s.clipIntersection,h.wireframeLinewidth=s.wireframeLinewidth,h.linewidth=s.linewidth,!0===r.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(r.matrixWorld),h.nearDistance=n,h.farDistance=a),h}function x(i,r,n,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&o===VSMShadowMap)&&(!i.frustumCulled||s.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,i.matrixWorld);const s=e.update(i),r=i.material;if(Array.isArray(r)){const e=s.groups;for(let h=0,c=e.length;h<c;h++){const c=e[h],l=r[c.materialIndex];if(l&&l.visible){const e=b(i,s,l,a,n.near,n.far,o);t.renderBufferDirect(n,null,s,e,i,c)}}}else if(r.visible){const e=b(i,s,r,a,n.near,n.far,o);t.renderBufferDirect(n,null,s,e,i,null)}}const h=i.children;for(let t=0,e=h.length;t<e;t++)x(h[t],r,n,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(e,o,h){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),l=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),p=t.state;p.setBlending(NoBlending),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let c=0,l=e.length;c<l;c++){const l=e[c],u=l.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const d=u.getFrameExtents();if(r.multiply(d),n.copy(u.mapSize),(r.x>i||r.y>i)&&(r.x>i&&(n.x=Math.floor(i/d.x),r.x=n.x*d.x,u.mapSize.x=n.x),r.y>i&&(n.y=Math.floor(i/d.y),r.y=n.y*d.y,u.mapSize.y=n.y)),null===u.map&&!u.isPointLightShadow&&this.type===VSMShadowMap){const t={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};u.map=new WebGLRenderTarget(r.x,r.y,t),u.map.texture.name=l.name+".shadowMap",u.mapPass=new WebGLRenderTarget(r.x,r.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};u.map=new WebGLRenderTarget(r.x,r.y,t),u.map.texture.name=l.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const f=u.getViewportCount();for(let t=0;t<f;t++){const e=u.getViewport(t);a.set(n.x*e.x,n.y*e.y,n.x*e.z,n.y*e.w),p.viewport(a),u.updateMatrices(l,t),s=u.getFrustum(),x(o,h,u.camera,l,this.type)}u.isPointLightShadow||this.type!==VSMShadowMap||g(u,h),u.needsUpdate=!1}m.needsUpdate=!1,t.setRenderTarget(c,l,u)}}function WebGLState(t,e,i){const s=i.isWebGL2;const r=new function(){let e=!1;const i=new Vector4;let s=null;const r=new Vector4(0,0,0,0);return{setMask:function(i){s===i||e||(t.colorMask(i,i,i,i),s=i)},setLocked:function(t){e=t},setClear:function(e,s,n,a,o){!0===o&&(e*=a,s*=a,n*=a),i.set(e,s,n,a),!1===r.equals(i)&&(t.clearColor(e,s,n,a),r.copy(i))},reset:function(){e=!1,s=null,r.set(-1,0,0,0)}}},n=new function(){let e=!1,i=null,s=null,r=null;return{setTest:function(t){t?P(2929):D(2929)},setMask:function(s){i===s||e||(t.depthMask(s),i=s)},setFunc:function(e){if(s!==e){if(e)switch(e){case NeverDepth:t.depthFunc(512);break;case AlwaysDepth:t.depthFunc(519);break;case LessDepth:t.depthFunc(513);break;case LessEqualDepth:t.depthFunc(515);break;case EqualDepth:t.depthFunc(514);break;case GreaterEqualDepth:t.depthFunc(518);break;case GreaterDepth:t.depthFunc(516);break;case NotEqualDepth:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);s=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,s=null,r=null}}},a=new function(){let e=!1,i=null,s=null,r=null,n=null,a=null,o=null,h=null,c=null;return{setTest:function(t){e||(t?P(2960):D(2960))},setMask:function(s){i===s||e||(t.stencilMask(s),i=s)},setFunc:function(e,i,a){s===e&&r===i&&n===a||(t.stencilFunc(e,i,a),s=e,r=i,n=a)},setOp:function(e,i,s){a===e&&o===i&&h===s||(t.stencilOp(e,i,s),a=e,o=i,h=s)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,s=null,r=null,n=null,a=null,o=null,h=null,c=null}}};let o={},h=null,c=null,l=null,u=null,p=null,d=null,f=null,m=null,g=null,y=!1,v=null,b=null,x=null,_=null,M=null;const w=t.getParameter(35661);let S=!1,A=0;const T=t.getParameter(7938);-1!==T.indexOf("WebGL")?(A=parseFloat(/^WebGL (\d)/.exec(T)[1]),S=A>=1):-1!==T.indexOf("OpenGL ES")&&(A=parseFloat(/^OpenGL ES (\d)/.exec(T)[1]),S=A>=2);let C=null,L={};const E=new Vector4,z=new Vector4;function R(e,i,s){const r=new Uint8Array(4),n=t.createTexture();t.bindTexture(e,n),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<s;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return n}const B={};function P(e){!0!==o[e]&&(t.enable(e),o[e]=!0)}function D(e){!1!==o[e]&&(t.disable(e),o[e]=!1)}B[3553]=R(3553,3553,1),B[34067]=R(34067,34069,6),r.setClear(0,0,0,1),n.setClear(1),a.setClear(0),P(2929),n.setFunc(LessEqualDepth),G(!1),N(CullFaceBack),P(2884),F(NoBlending);const I={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};if(s)I[MinEquation]=32775,I[MaxEquation]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(I[MinEquation]=t.MIN_EXT,I[MaxEquation]=t.MAX_EXT)}const O={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function F(e,i,s,r,n,a,o,h){if(e!==NoBlending){if(c||(P(3042),c=!0),e===CustomBlending)n=n||i,a=a||s,o=o||r,i===u&&n===f||(t.blendEquationSeparate(I[i],I[n]),u=i,f=n),s===p&&r===d&&a===m&&o===g||(t.blendFuncSeparate(O[s],O[r],O[a],O[o]),p=s,d=r,m=a,g=o),l=e,y=null;else if(e!==l||h!==y){if(u===AddEquation&&f===AddEquation||(t.blendEquation(32774),u=AddEquation,f=AddEquation),h)switch(e){case NormalBlending:t.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:t.blendFunc(1,1);break;case SubtractiveBlending:t.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case NormalBlending:t.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:t.blendFunc(770,1);break;case SubtractiveBlending:t.blendFunc(0,769);break;case MultiplyBlending:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}p=null,d=null,m=null,g=null,l=e,y=h}}else c&&(D(3042),c=!1)}function G(e){v!==e&&(e?t.frontFace(2304):t.frontFace(2305),v=e)}function N(e){e!==CullFaceNone?(P(2884),e!==b&&(e===CullFaceBack?t.cullFace(1029):e===CullFaceFront?t.cullFace(1028):t.cullFace(1032))):D(2884),b=e}function j(e,i,s){e?(P(32823),_===i&&M===s||(t.polygonOffset(i,s),_=i,M=s)):D(32823)}function V(e){void 0===e&&(e=33984+w-1),C!==e&&(t.activeTexture(e),C=e)}return{buffers:{color:r,depth:n,stencil:a},enable:P,disable:D,useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:F,setMaterial:function(t,e){t.side===DoubleSide?D(2884):P(2884);let i=t.side===BackSide;e&&(i=!i),G(i),t.blending===NormalBlending&&!1===t.transparent?F(NoBlending):F(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),n.setFunc(t.depthFunc),n.setTest(t.depthTest),n.setMask(t.depthWrite),r.setMask(t.colorWrite);const s=t.stencilWrite;a.setTest(s),s&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),j(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:G,setCullFace:N,setLineWidth:function(e){e!==x&&(S&&t.lineWidth(e),x=e)},setPolygonOffset:j,setScissorTest:function(t){t?P(3089):D(3089)},activeTexture:V,bindTexture:function(e,i){null===C&&V();let s=L[C];void 0===s&&(s={type:void 0,texture:void 0},L[C]=s),s.type===e&&s.texture===i||(t.bindTexture(e,i||B[e]),s.type=e,s.texture=i)},unbindTexture:function(){const e=L[C];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===E.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),E.copy(e))},viewport:function(e){!1===z.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),z.copy(e))},reset:function(){o={},C=null,L={},h=null,c=null,l=null,u=null,p=null,d=null,f=null,m=null,g=null,y=!1,v=null,b=null,x=null,_=null,M=null,r.reset(),n.reset(),a.reset()}}}function WebGLTextures(t,e,i,s,r,n,a){const o=r.isWebGL2,h=r.maxTextures,c=r.maxCubemapSize,l=r.maxTextureSize,u=r.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,i,s){let r=1;if((t.width>s||t.height>s)&&(r=s/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const s=e?MathUtils.floorPowerOfTwo:Math.floor,n=s(r*t.width),a=s(r*t.height);void 0===d&&(d=m(n,a));const o=i?m(n,a):d;return o.width=n,o.height=a,o.getContext("2d").drawImage(t,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+n+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return MathUtils.isPowerOfTwo(t.width)&&MathUtils.isPowerOfTwo(t.height)}function v(t,e){return t.generateMipmaps&&e&&t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter}function b(e,i,r,n){t.generateMipmap(e),s.get(i).__maxMipLevel=Math.log(Math.max(r,n))*Math.LOG2E}function x(i,s,r){if(!1===o)return s;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let n=s;return 6403===s&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r&&(n=33321)),6407===s&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r&&(n=32849)),6408===s&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r&&(n=32856)),33325!==n&&33326!==n&&34842!==n&&34836!==n||e.get("EXT_color_buffer_float"),n}function _(t){return t===NearestFilter||t===NearestMipmapNearestFilter||t===NearestMipmapLinearFilter?9728:9729}function M(e){const i=e.target;i.removeEventListener("dispose",M),function(e){const i=s.get(e);if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture),s.remove(e)}(i),i.isVideoTexture&&p.delete(i),a.memory.textures--}function w(e){const i=e.target;i.removeEventListener("dispose",w),function(e){const i=s.get(e),r=s.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);s.remove(e.texture),s.remove(e)}(i),a.memory.textures--}let S=0;function A(t,e){const r=s.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void R(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}function T(e,r){const a=s.get(e);e.version>0&&a.__version!==e.version?function(e,s,r){if(6!==s.image.length)return;z(e,s),i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,s.flipY);const a=s&&(s.isCompressedTexture||s.image[0].isCompressedTexture),h=s.image[0]&&s.image[0].isDataTexture,l=[];for(let t=0;t<6;t++)l[t]=a||h?h?s.image[t].image:s.image[t]:g(s.image[t],!1,!0,c);const u=l[0],p=y(u)||o,d=n.convert(s.format),f=n.convert(s.type),m=x(s.internalFormat,d,f);let _;if(E(34067,s,p),a){for(let t=0;t<6;t++){_=l[t].mipmaps;for(let e=0;e<_.length;e++){const r=_[e];s.format!==RGBAFormat&&s.format!==RGBFormat?null!==d?i.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,e,m,r.width,r.height,0,d,f,r.data)}}e.__maxMipLevel=_.length-1}else{_=s.mipmaps;for(let t=0;t<6;t++)if(h){i.texImage2D(34069+t,0,m,l[t].width,l[t].height,0,d,f,l[t].data);for(let e=0;e<_.length;e++){const s=_[e],r=s.image[t].image;i.texImage2D(34069+t,e+1,m,r.width,r.height,0,d,f,r.data)}}else{i.texImage2D(34069+t,0,m,d,f,l[t]);for(let e=0;e<_.length;e++){const s=_[e];i.texImage2D(34069+t,e+1,m,d,f,s.image[t])}}e.__maxMipLevel=_.length}v(s,p)&&b(34067,s,u.width,u.height);e.__version=s.version,s.onUpdate&&s.onUpdate(s)}(a,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,a.__webglTexture))}const C={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},L={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function E(i,n,a){a?(t.texParameteri(i,10242,C[n.wrapS]),t.texParameteri(i,10243,C[n.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,C[n.wrapR]),t.texParameteri(i,10240,L[n.magFilter]),t.texParameteri(i,10241,L[n.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),n.wrapS===ClampToEdgeWrapping&&n.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,_(n.magFilter)),t.texParameteri(i,10241,_(n.minFilter)),n.minFilter!==NearestFilter&&n.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const h=e.get("EXT_texture_filter_anisotropic");if(h){if(n.type===FloatType&&null===e.get("OES_texture_float_linear"))return;if(n.type===HalfFloatType&&null===(o||e.get("OES_texture_half_float_linear")))return;(n.anisotropy>1||s.get(n).__currentAnisotropy)&&(t.texParameterf(i,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,r.getMaxAnisotropy())),s.get(n).__currentAnisotropy=n.anisotropy)}}function z(e,i){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",M),e.__webglTexture=t.createTexture(),a.memory.textures++)}function R(e,s,r){let a=3553;s.isDataTexture2DArray&&(a=35866),s.isDataTexture3D&&(a=32879),z(e,s),i.activeTexture(33984+r),i.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,s.flipY),t.pixelStorei(37441,s.premultiplyAlpha),t.pixelStorei(3317,s.unpackAlignment);const h=function(t){return!o&&(t.wrapS!==ClampToEdgeWrapping||t.wrapT!==ClampToEdgeWrapping||t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter)}(s)&&!1===y(s.image),c=g(s.image,h,!1,l),u=y(c)||o,p=n.convert(s.format);let d,f=n.convert(s.type),m=x(s.internalFormat,p,f);E(a,s,u);const _=s.mipmaps;if(s.isDepthTexture)m=6402,o?m=s.type===FloatType?36012:s.type===UnsignedIntType?33190:s.type===UnsignedInt248Type?35056:33189:s.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),s.format===DepthFormat&&6402===m&&s.type!==UnsignedShortType&&s.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=UnsignedShortType,f=n.convert(s.type)),s.format===DepthStencilFormat&&6402===m&&(m=34041,s.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=UnsignedInt248Type,f=n.convert(s.type))),i.texImage2D(3553,0,m,c.width,c.height,0,p,f,null);else if(s.isDataTexture)if(_.length>0&&u){for(let t=0,e=_.length;t<e;t++)d=_[t],i.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);s.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else i.texImage2D(3553,0,m,c.width,c.height,0,p,f,c.data),e.__maxMipLevel=0;else if(s.isCompressedTexture){for(let t=0,e=_.length;t<e;t++)d=_[t],s.format!==RGBAFormat&&s.format!==RGBFormat?null!==p?i.compressedTexImage2D(3553,t,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);e.__maxMipLevel=_.length-1}else if(s.isDataTexture2DArray)i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(s.isDataTexture3D)i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(_.length>0&&u){for(let t=0,e=_.length;t<e;t++)d=_[t],i.texImage2D(3553,t,m,p,f,d);s.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else i.texImage2D(3553,0,m,p,f,c),e.__maxMipLevel=0;v(s,u)&&b(a,s,c.width,c.height),e.__version=s.version,s.onUpdate&&s.onUpdate(s)}function B(e,r,a,o){const h=n.convert(r.texture.format),c=n.convert(r.texture.type),l=x(r.texture.internalFormat,h,c);i.texImage2D(o,0,l,r.width,r.height,0,h,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,o,s.get(r.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function P(e,i,s){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(s){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===FloatType?r=36012:e.type===UnsignedIntType&&(r=33190));const s=I(i);t.renderbufferStorageMultisample(36161,s,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){if(s){const e=I(i);t.renderbufferStorageMultisample(36161,e,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=n.convert(i.texture.format),r=n.convert(i.texture.type),a=x(i.texture.internalFormat,e,r);if(s){const e=I(i);t.renderbufferStorageMultisample(36161,e,a,i.width,i.height)}else t.renderbufferStorage(36161,a,i.width,i.height)}t.bindRenderbuffer(36161,null)}function D(e){const i=s.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");s.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),A(i.depthTexture,0);const r=s.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===DepthFormat)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(i.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(i.__webglFramebuffer,e)}else if(r){i.__webglDepthbuffer=[];for(let s=0;s<6;s++)t.bindFramebuffer(36160,i.__webglFramebuffer[s]),i.__webglDepthbuffer[s]=t.createRenderbuffer(),P(i.__webglDepthbuffer[s],e,!1)}else t.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),P(i.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function I(t){return o&&t.isWebGLMultisampleRenderTarget?Math.min(u,t.samples):0}let O=!1,F=!1;this.allocateTextureUnit=function(){const t=S;return t>=h&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+h),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=A,this.setTexture2DArray=function(t,e){const r=s.get(t);t.version>0&&r.__version!==t.version?R(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=s.get(t);t.version>0&&r.__version!==t.version?R(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(e){const r=s.get(e),h=s.get(e.texture);e.addEventListener("dispose",w),h.__webglTexture=t.createTexture(),a.memory.textures++;const c=!0===e.isWebGLCubeRenderTarget,l=!0===e.isWebGLMultisampleRenderTarget,u=y(e)||o;if(!o||e.texture.format!==RGBFormat||e.texture.type!==FloatType&&e.texture.type!==HalfFloatType||(e.texture.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){r.__webglFramebuffer=[];for(let e=0;e<6;e++)r.__webglFramebuffer[e]=t.createFramebuffer()}else if(r.__webglFramebuffer=t.createFramebuffer(),l)if(o){r.__webglMultisampledFramebuffer=t.createFramebuffer(),r.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const i=n.convert(e.texture.format),s=n.convert(e.texture.type),a=x(e.texture.internalFormat,i,s),o=I(e);t.renderbufferStorageMultisample(36161,o,a,e.width,e.height),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(r.__webglDepthRenderbuffer=t.createRenderbuffer(),P(r.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){i.bindTexture(34067,h.__webglTexture),E(34067,e.texture,u);for(let t=0;t<6;t++)B(r.__webglFramebuffer[t],e,36064,34069+t);v(e.texture,u)&&b(34067,e.texture,e.width,e.height),i.bindTexture(34067,null)}else i.bindTexture(3553,h.__webglTexture),E(3553,e.texture,u),B(r.__webglFramebuffer,e,36064,3553),v(e.texture,u)&&b(3553,e.texture,e.width,e.height),i.bindTexture(3553,null);e.depthBuffer&&D(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(v(e,y(t)||o)){const r=t.isWebGLCubeRenderTarget?34067:3553,n=s.get(e).__webglTexture;i.bindTexture(r,n),b(r,e,t.width,t.height),i.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(o){const i=s.get(e);t.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,i.__webglFramebuffer);const r=e.width,n=e.height;let a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,r,n,0,0,r,n,a,9728),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),t=t.texture),A(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),T(t,e)}}function WebGLUtils(t,e,i){const s=i.isWebGL2;return{convert:function(t){let i;if(t===UnsignedByteType)return 5121;if(t===UnsignedShort4444Type)return 32819;if(t===UnsignedShort5551Type)return 32820;if(t===UnsignedShort565Type)return 33635;if(t===ByteType)return 5120;if(t===ShortType)return 5122;if(t===UnsignedShortType)return 5123;if(t===IntType)return 5124;if(t===UnsignedIntType)return 5125;if(t===FloatType)return 5126;if(t===HalfFloatType)return s?5131:null!==(i=e.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(t===AlphaFormat)return 6406;if(t===RGBFormat)return 6407;if(t===RGBAFormat)return 6408;if(t===LuminanceFormat)return 6409;if(t===LuminanceAlphaFormat)return 6410;if(t===DepthFormat)return 6402;if(t===DepthStencilFormat)return 34041;if(t===RedFormat)return 6403;if(t===RedIntegerFormat)return 36244;if(t===RGFormat)return 33319;if(t===RGIntegerFormat)return 33320;if(t===RGBIntegerFormat)return 36248;if(t===RGBAIntegerFormat)return 36249;if(t===RGB_S3TC_DXT1_Format||t===RGBA_S3TC_DXT1_Format||t===RGBA_S3TC_DXT3_Format||t===RGBA_S3TC_DXT5_Format){if(null===(i=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===RGB_S3TC_DXT1_Format)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===RGBA_S3TC_DXT1_Format)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===RGBA_S3TC_DXT3_Format)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===RGBA_S3TC_DXT5_Format)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===RGB_PVRTC_4BPPV1_Format||t===RGB_PVRTC_2BPPV1_Format||t===RGBA_PVRTC_4BPPV1_Format||t===RGBA_PVRTC_2BPPV1_Format){if(null===(i=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===RGB_PVRTC_4BPPV1_Format)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===RGB_PVRTC_2BPPV1_Format)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===RGBA_PVRTC_4BPPV1_Format)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===RGBA_PVRTC_2BPPV1_Format)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===RGB_ETC1_Format)return null!==(i=e.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===RGB_ETC2_Format||t===RGBA_ETC2_EAC_Format)&&null!==(i=e.get("WEBGL_compressed_texture_etc"))){if(t===RGB_ETC2_Format)return i.COMPRESSED_RGB8_ETC2;if(t===RGBA_ETC2_EAC_Format)return i.COMPRESSED_RGBA8_ETC2_EAC}return t===RGBA_ASTC_4x4_Format||t===RGBA_ASTC_5x4_Format||t===RGBA_ASTC_5x5_Format||t===RGBA_ASTC_6x5_Format||t===RGBA_ASTC_6x6_Format||t===RGBA_ASTC_8x5_Format||t===RGBA_ASTC_8x6_Format||t===RGBA_ASTC_8x8_Format||t===RGBA_ASTC_10x5_Format||t===RGBA_ASTC_10x6_Format||t===RGBA_ASTC_10x8_Format||t===RGBA_ASTC_10x10_Format||t===RGBA_ASTC_12x10_Format||t===RGBA_ASTC_12x12_Format||t===SRGB8_ALPHA8_ASTC_4x4_Format||t===SRGB8_ALPHA8_ASTC_5x4_Format||t===SRGB8_ALPHA8_ASTC_5x5_Format||t===SRGB8_ALPHA8_ASTC_6x5_Format||t===SRGB8_ALPHA8_ASTC_6x6_Format||t===SRGB8_ALPHA8_ASTC_8x5_Format||t===SRGB8_ALPHA8_ASTC_8x6_Format||t===SRGB8_ALPHA8_ASTC_8x8_Format||t===SRGB8_ALPHA8_ASTC_10x5_Format||t===SRGB8_ALPHA8_ASTC_10x6_Format||t===SRGB8_ALPHA8_ASTC_10x8_Format||t===SRGB8_ALPHA8_ASTC_10x10_Format||t===SRGB8_ALPHA8_ASTC_12x10_Format||t===SRGB8_ALPHA8_ASTC_12x12_Format?null!==(i=e.get("WEBGL_compressed_texture_astc"))?t:null:t===RGBA_BPTC_Format?null!==(i=e.get("EXT_texture_compression_bptc"))?t:null:t===UnsignedInt248Type?s?34042:null!==(i=e.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function ArrayCamera(t=[]){PerspectiveCamera.call(this),this.cameras=t}function Group(){Object3D.call(this),this.type="Group"}function WebXRController(){this._targetRay=null,this._grip=null,this._hand=null}function WebXRManager(t,e){const i=this;let s=null,r=1,n=null,a="local-floor",o=null;const h=[],c=new Map,l=new PerspectiveCamera;l.layers.enable(1),l.viewport=new Vector4;const u=new PerspectiveCamera;u.layers.enable(2),u.viewport=new Vector4;const p=[l,u],d=new ArrayCamera;d.layers.enable(1),d.layers.enable(2);let f=null,m=null;function g(t){const e=c.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function y(){c.forEach(function(t,e){t.disconnect(e)}),c.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),S.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function v(t){n=t,S.setContext(s),S.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function b(t){const e=s.inputSources;for(let t=0;t<h.length;t++)c.set(e[t],h[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],s=c.get(i);s&&(s.dispatchEvent({type:"disconnected",data:i}),c.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],s=c.get(i);s&&s.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=h[t];return void 0===e&&(e=new WebXRController,h[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=h[t];return void 0===e&&(e=new WebXRController,h[t]=e),e.getGripSpace()},this.getHand=function(t){let e=h[t];return void 0===e&&(e=new WebXRController,h[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return n},this.getSession=function(){return s},this.setSession=function(t){if(null!==(s=t)){s.addEventListener("select",g),s.addEventListener("selectstart",g),s.addEventListener("selectend",g),s.addEventListener("squeeze",g),s.addEventListener("squeezestart",g),s.addEventListener("squeezeend",g),s.addEventListener("end",y);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r},n=new XRWebGLLayer(s,e,i);s.updateRenderState({baseLayer:n}),s.requestReferenceSpace(a).then(v),s.addEventListener("inputsourceschange",b)}};const x=new Vector3$1,_=new Vector3$1;function M(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){d.near=u.near=l.near=t.near,d.far=u.far=l.far=t.far,f===d.near&&m===d.far||(s.updateRenderState({depthNear:d.near,depthFar:d.far}),f=d.near,m=d.far);const e=t.parent,i=d.cameras;M(d,e);for(let t=0;t<i.length;t++)M(i[t],e);t.matrixWorld.copy(d.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);return 2===i.length?function(t,e,i){x.setFromMatrixPosition(e.matrixWorld),_.setFromMatrixPosition(i.matrixWorld);const s=x.distanceTo(_),r=e.projectionMatrix.elements,n=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),h=(r[9]+1)/r[5],c=(r[9]-1)/r[5],l=(r[8]-1)/r[0],u=(n[8]+1)/n[0],p=a*l,d=a*u,f=s/(-l+u),m=f*-l;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+f,y=o+f,v=p-m,b=d+(s-m),M=h*o/y*g,w=c*o/y*g;t.projectionMatrix.makePerspective(v,b,M,w,g,y)}(d,l,u):d.projectionMatrix.copy(l.projectionMatrix),d};let w=null;const S=new WebGLAnimation;S.setAnimationLoop(function(e,i){if(null!==(o=i.getViewerPose(n))){const e=o.views,i=s.renderState.baseLayer;t.setFramebuffer(i.framebuffer);let r=!1;e.length!==d.cameras.length&&(d.cameras.length=0,r=!0);for(let t=0;t<e.length;t++){const s=e[t],n=i.getViewport(s),a=p[t];a.matrix.fromArray(s.transform.matrix),a.projectionMatrix.fromArray(s.projectionMatrix),a.viewport.set(n.x,n.y,n.width,n.height),0===t&&d.matrix.copy(a.matrix),!0===r&&d.cameras.push(a)}}const r=s.inputSources;for(let t=0;t<h.length;t++){const e=h[t],s=r[t];e.update(s,i,n)}w&&w(e,i)}),this.setAnimationLoop=function(t){w=t},this.dispose=function(){}}function WebGLMaterials(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap);const s=t.get(i).envMap;if(s){e.envMap.value=s,e.flipEnvMap.value=s.isCubeTexture&&s._needsFlipEnvMap?-1:1,e.reflectivity.value=i.reflectivity,e.refractionRatio.value=i.refractionRatio;const r=t.get(s).__maxMipLevel;void 0!==r&&(e.maxMipLevel.value=r)}let r,n;i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(r=i.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?n=i.aoMap:i.lightMap&&(n=i.lightMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uv2Transform.value.copy(n.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,i.side===BackSide&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),i.side===BackSide&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,s,r,n){s.isMeshBasicMaterial?e(t,s):s.isMeshLambertMaterial?(e(t,s),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,s)):s.isMeshToonMaterial?(e(t,s),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,s)):s.isMeshPhongMaterial?(e(t,s),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,s)):s.isMeshStandardMaterial?(e(t,s),s.isMeshPhysicalMaterial?function(t,e){i(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===BackSide&&t.clearcoatNormalScale.value.negate()),t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,s):i(t,s)):s.isMeshMatcapMaterial?(e(t,s),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,s)):s.isMeshDepthMaterial?(e(t,s),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,s)):s.isMeshDistanceMaterial?(e(t,s),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,s)):s.isMeshNormalMaterial?(e(t,s),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,s)):s.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,s),s.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,s)):s.isPointsMaterial?function(t,e,i,s){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*s,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,s,r,n):s.isSpriteMaterial?function(t,e){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,s):s.isShadowMaterial?(t.color.value.copy(s.color),t.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function createCanvasElement(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}function WebGLRenderer(t){const e=void 0!==(t=t||{}).canvas?t.canvas:createCanvasElement(),i=void 0!==t.context?t.context:null,s=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,n=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,h=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",l=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,p=null;const d=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,y=0,v=0,b=null,x=null,_=-1,M=null;const w=new Vector4,S=new Vector4;let A=null,T=e.width,C=e.height,L=1,E=null,z=null;const R=new Vector4(0,0,T,C),B=new Vector4(0,0,T,C);let P=!1;const D=new Frustum;let I=!1,O=!1;const F=new Matrix4,G=new Vector3$1,N={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===b?L:1}let V,U,k,H,W,q,$,J,X,Y,K,Z,Q,tt,et,it,st,rt,nt,at,ot,ht=i;function ct(t,i){for(let s=0;s<t.length;s++){const r=t[s],n=e.getContext(r,i);if(null!==n)return n}return null}try{const t={alpha:s,depth:r,stencil:n,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:h,powerPreference:c,failIfMajorPerformanceCaveat:l};if(e.addEventListener("webglcontextlost",dt,!1),e.addEventListener("webglcontextrestored",ft,!1),null===ht){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),null===(ht=ct(e,t)))throw ct(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ht.getShaderPrecisionFormat&&(ht.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function lt(){V=new WebGLExtensions(ht),!1===(U=new WebGLCapabilities(ht,V,t)).isWebGL2&&(V.get("WEBGL_depth_texture"),V.get("OES_texture_float"),V.get("OES_texture_half_float"),V.get("OES_texture_half_float_linear"),V.get("OES_standard_derivatives"),V.get("OES_element_index_uint"),V.get("OES_vertex_array_object"),V.get("ANGLE_instanced_arrays")),V.get("OES_texture_float_linear"),at=new WebGLUtils(ht,V,U),(k=new WebGLState(ht,V,U)).scissor(S.copy(B).multiplyScalar(L).floor()),k.viewport(w.copy(R).multiplyScalar(L).floor()),H=new WebGLInfo(ht),W=new WebGLProperties,q=new WebGLTextures(ht,V,k,W,U,at,H),$=new WebGLCubeMaps(f),J=new WebGLAttributes(ht,U),ot=new WebGLBindingStates(ht,V,J,U),X=new WebGLGeometries(ht,J,H,ot),Y=new WebGLObjects(ht,X,J,H),st=new WebGLMorphtargets(ht),et=new WebGLClipping(W),K=new WebGLPrograms(f,$,V,U,ot,et),Z=new WebGLMaterials(W),Q=new WebGLRenderLists(W),tt=new WebGLRenderStates(V,U),it=new WebGLBackground(f,$,k,Y,o),rt=new WebGLBufferRenderer(ht,V,H,U),nt=new WebGLIndexedBufferRenderer(ht,V,H,U),H.programs=K.programs,f.capabilities=U,f.extensions=V,f.properties=W,f.renderLists=Q,f.state=k,f.info=H}lt();const ut=new WebXRManager(f,ht);this.xr=ut;const pt=new WebGLShadowMap(f,Y,U.maxTextureSize);function dt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,lt()}function mt(t){const e=t.target;e.removeEventListener("dispose",mt),function(t){gt(t),W.remove(t)}(e)}function gt(t){const e=W.get(t).program;void 0!==e&&K.releaseProgram(e)}this.shadowMap=pt,this.getContext=function(){return ht},this.getContextAttributes=function(){return ht.getContextAttributes()},this.forceContextLoss=function(){const t=V.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=V.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(t){void 0!==t&&(L=t,this.setSize(T,C,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Vector2),t.set(T,C)},this.setSize=function(t,i,s){ut.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,C=i,e.width=Math.floor(t*L),e.height=Math.floor(i*L),!1!==s&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Vector2),t.set(T*L,C*L).floor()},this.setDrawingBufferSize=function(t,i,s){T=t,C=i,L=s,e.width=Math.floor(t*s),e.height=Math.floor(i*s),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Vector4),t.copy(w)},this.getViewport=function(t){return t.copy(R)},this.setViewport=function(t,e,i,s){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,i,s),k.viewport(w.copy(R).multiplyScalar(L).floor())},this.getScissor=function(t){return t.copy(B)},this.setScissor=function(t,e,i,s){t.isVector4?B.set(t.x,t.y,t.z,t.w):B.set(t,e,i,s),k.scissor(S.copy(B).multiplyScalar(L).floor())},this.getScissorTest=function(){return P},this.setScissorTest=function(t){k.setScissorTest(P=t)},this.setOpaqueSort=function(t){E=t},this.setTransparentSort=function(t){z=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new Color),t.copy(it.getClearColor())},this.setClearColor=function(){it.setClearColor.apply(it,arguments)},this.getClearAlpha=function(){return it.getClearAlpha()},this.setClearAlpha=function(){it.setClearAlpha.apply(it,arguments)},this.clear=function(t,e,i){let s=0;(void 0===t||t)&&(s|=16384),(void 0===e||e)&&(s|=256),(void 0===i||i)&&(s|=1024),ht.clear(s)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",dt,!1),e.removeEventListener("webglcontextrestored",ft,!1),Q.dispose(),tt.dispose(),W.dispose(),$.dispose(),Y.dispose(),ot.dispose(),ut.dispose(),vt.stop()},this.renderBufferImmediate=function(t,e){ot.initAttributes();const i=W.get(t);t.hasPositions&&!i.position&&(i.position=ht.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=ht.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=ht.createBuffer()),t.hasColors&&!i.color&&(i.color=ht.createBuffer());const s=e.getAttributes();t.hasPositions&&(ht.bindBuffer(34962,i.position),ht.bufferData(34962,t.positionArray,35048),ot.enableAttribute(s.position),ht.vertexAttribPointer(s.position,3,5126,!1,0,0)),t.hasNormals&&(ht.bindBuffer(34962,i.normal),ht.bufferData(34962,t.normalArray,35048),ot.enableAttribute(s.normal),ht.vertexAttribPointer(s.normal,3,5126,!1,0,0)),t.hasUvs&&(ht.bindBuffer(34962,i.uv),ht.bufferData(34962,t.uvArray,35048),ot.enableAttribute(s.uv),ht.vertexAttribPointer(s.uv,2,5126,!1,0,0)),t.hasColors&&(ht.bindBuffer(34962,i.color),ht.bufferData(34962,t.colorArray,35048),ot.enableAttribute(s.color),ht.vertexAttribPointer(s.color,3,5126,!1,0,0)),ot.disableUnusedAttributes(),ht.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,s,r,n){null===e&&(e=N);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=Mt(t,e,s,r);k.setMaterial(s,a);let h=i.index;const c=i.attributes.position;if(null===h){if(void 0===c||0===c.count)return}else if(0===h.count)return;let l,u=1;!0===s.wireframe&&(h=X.getWireframeAttribute(i),u=2),(s.morphTargets||s.morphNormals)&&st.update(r,i,s,o),ot.setup(r,s,o,i,h);let p=rt;null!==h&&(l=J.get(h),(p=nt).setIndex(l));const d=null!==h?h.count:c.count,f=i.drawRange.start*u,m=i.drawRange.count*u,g=null!==n?n.start*u:0,y=null!==n?n.count*u:1/0,v=Math.max(f,g),b=Math.min(d,f+m,g+y)-1,x=Math.max(0,b-v+1);if(0!==x){if(r.isMesh)!0===s.wireframe?(k.setLineWidth(s.wireframeLinewidth*j()),p.setMode(1)):p.setMode(4);else if(r.isLine){let t=s.linewidth;void 0===t&&(t=1),k.setLineWidth(t*j()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(v,x,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(v,x,t)}else p.render(v,x)}},this.compile=function(t,e){(p=tt.get(t)).init(),t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))}),p.setupLights();const i=new WeakMap;t.traverse(function(e){const s=e.material;if(s)if(Array.isArray(s))for(let r=0;r<s.length;r++){const n=s[r];!1===i.has(n)&&(_t(n,t,e),i.set(n))}else!1===i.has(s)&&(_t(s,t,e),i.set(s))})};let yt=null;const vt=new WebGLAnimation;function bt(t,e,i){const s=!0===e.isScene?e.overrideMaterial:null;for(let r=0,n=t.length;r<n;r++){const n=t[r],a=n.object,o=n.geometry,h=null===s?n.material:s,c=n.group;if(i.isArrayCamera){const t=i.cameras;for(let i=0,s=t.length;i<s;i++){const s=t[i];a.layers.test(s.layers)&&(k.viewport(w.copy(s.viewport)),p.setupLightsView(s),xt(a,e,s,o,h,c))}}else xt(a,e,i,o,h,c)}}function xt(t,e,i,s,r,n){if(t.onBeforeRender(f,e,i,s,r,n),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const s=Mt(i,e,r,t);k.setMaterial(r),ot.reset(),function(t,e){t.render(function(t){f.renderBufferImmediate(t,e)})}(t,s)}else f.renderBufferDirect(i,e,s,r,t,n);t.onAfterRender(f,e,i,s,r,n)}function _t(t,e,i){!0!==e.isScene&&(e=N);const s=W.get(t),r=p.state.lights,n=p.state.shadowsArray,a=r.state.version,o=K.getParameters(t,r.state,n,e,i),h=K.getProgramCacheKey(o);let c=s.program,l=!0;if(void 0===c)t.addEventListener("dispose",mt);else if(c.cacheKey!==h)gt(t);else if(s.lightsStateVersion!==a)l=!1;else{if(void 0!==o.shaderID){const i=t.isMeshStandardMaterial?e.environment:null;return void(s.envMap=$.get(t.envMap||i))}l=!1}l&&(o.uniforms=K.getUniforms(t),t.onBeforeCompile(o,f),c=K.acquireProgram(o,h),s.program=c,s.uniforms=o.uniforms,s.outputEncoding=o.outputEncoding);const u=s.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(s.numClippingPlanes=et.numPlanes,s.numIntersection=et.numIntersection,u.clippingPlanes=et.uniform),s.environment=t.isMeshStandardMaterial?e.environment:null,s.fog=e.fog,s.envMap=$.get(t.envMap||s.environment),s.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),s.lightsStateVersion=a,s.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=s.program.getUniforms(),m=WebGLUniforms.seqWithValue(d.seq,u);s.uniformsList=m}function Mt(t,e,i,s){!0!==e.isScene&&(e=N),q.resetTextureUnits();const r=e.fog,n=i.isMeshStandardMaterial?e.environment:null,a=null===b?f.outputEncoding:b.texture.encoding,o=$.get(i.envMap||n),h=W.get(i),c=p.state.lights;if(!0===I&&(!0===O||t!==M)){const e=t===M&&i.id===_;et.setState(i,t,e)}i.version===h.__version?i.fog&&h.fog!==r?_t(i,e,s):h.environment!==n?_t(i,e,s):h.needsLights&&h.lightsStateVersion!==c.state.version?_t(i,e,s):void 0===h.numClippingPlanes||h.numClippingPlanes===et.numPlanes&&h.numIntersection===et.numIntersection?h.outputEncoding!==a?_t(i,e,s):h.envMap!==o&&_t(i,e,s):_t(i,e,s):(_t(i,e,s),h.__version=i.version);let l=!1,u=!1,d=!1;const m=h.program,g=m.getUniforms(),y=h.uniforms;if(k.useProgram(m.program)&&(l=!0,u=!0,d=!0),i.id!==_&&(_=i.id,u=!0),l||M!==t){if(g.setValue(ht,"projectionMatrix",t.projectionMatrix),U.logarithmicDepthBuffer&&g.setValue(ht,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),M!==t&&(M=t,u=!0,d=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=g.map.cameraPosition;void 0!==e&&e.setValue(ht,G.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&g.setValue(ht,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&g.setValue(ht,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){g.setOptional(ht,s,"bindMatrix"),g.setOptional(ht,s,"bindMatrixInverse");const t=s.skeleton;if(t){const e=t.bones;if(U.floatVertexTextures){if(null===t.boneTexture){let i=Math.sqrt(4*e.length);i=MathUtils.ceilPowerOfTwo(i),i=Math.max(i,4);const s=new Float32Array(i*i*4);s.set(t.boneMatrices);const r=new DataTexture(s,i,i,RGBAFormat,FloatType);t.boneMatrices=s,t.boneTexture=r,t.boneTextureSize=i}g.setValue(ht,"boneTexture",t.boneTexture,q),g.setValue(ht,"boneTextureSize",t.boneTextureSize)}else g.setOptional(ht,t,"boneMatrices")}}var v,x;return(u||h.receiveShadow!==s.receiveShadow)&&(h.receiveShadow=s.receiveShadow,g.setValue(ht,"receiveShadow",s.receiveShadow)),u&&(g.setValue(ht,"toneMappingExposure",f.toneMappingExposure),h.needsLights&&(x=d,(v=y).ambientLightColor.needsUpdate=x,v.lightProbe.needsUpdate=x,v.directionalLights.needsUpdate=x,v.directionalLightShadows.needsUpdate=x,v.pointLights.needsUpdate=x,v.pointLightShadows.needsUpdate=x,v.spotLights.needsUpdate=x,v.spotLightShadows.needsUpdate=x,v.rectAreaLights.needsUpdate=x,v.hemisphereLights.needsUpdate=x),r&&i.fog&&Z.refreshFogUniforms(y,r),Z.refreshMaterialUniforms(y,i,L,C),WebGLUniforms.upload(ht,h.uniformsList,y,q)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(WebGLUniforms.upload(ht,h.uniformsList,y,q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&g.setValue(ht,"center",s.center),g.setValue(ht,"modelViewMatrix",s.modelViewMatrix),g.setValue(ht,"normalMatrix",s.normalMatrix),g.setValue(ht,"modelMatrix",s.matrixWorld),m}vt.setAnimationLoop(function(t){ut.isPresenting||yt&&yt(t)}),"undefined"!=typeof window&&vt.setContext(window),this.setAnimationLoop=function(t){yt=t,ut.setAnimationLoop(t),null===t?vt.stop():vt.start()},this.render=function(t,e){let i,s;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),s=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;ot.resetDefaultState(),_=-1,M=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ut.enabled&&!0===ut.isPresenting&&(e=ut.getCamera(e)),!0===t.isScene&&t.onBeforeRender(f,t,e,i||b),(p=tt.get(t,d.length)).init(),d.push(p),F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(F),O=this.localClippingEnabled,I=et.init(this.clippingPlanes,O,e),(u=Q.get(t,e)).init(),function t(e,i,s,r){if(!1===e.visible)return;const n=e.layers.test(i.layers);if(n)if(e.isGroup)s=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(i);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||D.intersectsSprite(e)){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=Y.update(e),i=e.material;i.visible&&u.push(e,t,i,s,G.z,null)}}else if(e.isImmediateRenderObject)r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F),u.push(e,null,e.material,s,G.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==H.render.frame&&(e.skeleton.update(),e.skeleton.frame=H.render.frame),!e.frustumCulled||D.intersectsObject(e))){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=Y.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let n=0,a=r.length;n<a;n++){const a=r[n],o=i[a.materialIndex];o&&o.visible&&u.push(e,t,o,s,G.z,a)}}else i.visible&&u.push(e,t,i,s,G.z,null)}const a=e.children;for(let e=0,n=a.length;e<n;e++)t(a[e],i,s,r)}(t,e,0,f.sortObjects),u.finish(),!0===f.sortObjects&&u.sort(E,z),!0===I&&et.beginShadows();const r=p.state.shadowsArray;pt.render(r,t,e),p.setupLights(),p.setupLightsView(e),!0===I&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),it.render(u,t,e,s);const n=u.opaque,a=u.transparent;n.length>0&&bt(n,t,e),a.length>0&&bt(a,t,e),!0===t.isScene&&t.onAfterRender(f,t,e),null!==b&&(q.updateRenderTargetMipmap(b),q.updateMultisampleRenderTarget(b)),k.buffers.depth.setTest(!0),k.buffers.depth.setMask(!0),k.buffers.color.setMask(!0),k.setPolygonOffset(!1),d.pop(),p=d.length>0?d[d.length-1]:null,u=null},this.setFramebuffer=function(t){g!==t&&null===b&&ht.bindFramebuffer(36160,t),g=t},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return v},this.getRenderList=function(){return u},this.setRenderList=function(t){u=t},this.getRenderTarget=function(){return b},this.setRenderTarget=function(t,e=0,i=0){b=t,y=e,v=i,t&&void 0===W.get(t).__webglFramebuffer&&q.setupRenderTarget(t);let s=g,r=!1;if(t){const i=W.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(s=i[e],r=!0):s=t.isWebGLMultisampleRenderTarget?W.get(t).__webglMultisampledFramebuffer:i,w.copy(t.viewport),S.copy(t.scissor),A=t.scissorTest}else w.copy(R).multiplyScalar(L).floor(),S.copy(B).multiplyScalar(L).floor(),A=P;if(x!==s&&(ht.bindFramebuffer(36160,s),x=s),k.viewport(w),k.scissor(S),k.setScissorTest(A),r){const s=W.get(t.texture);ht.framebufferTexture2D(36160,36064,34069+e,s.__webglTexture,i)}},this.readRenderTargetPixels=function(t,e,i,s,r,n,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=W.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){let a=!1;o!==x&&(ht.bindFramebuffer(36160,o),a=!0);try{const o=t.texture,h=o.format,c=o.type;if(h!==RGBAFormat&&at.convert(h)!==ht.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===UnsignedByteType||at.convert(c)===ht.getParameter(35738)||c===FloatType&&(U.isWebGL2||V.get("OES_texture_float")||V.get("WEBGL_color_buffer_float"))||c===HalfFloatType&&(U.isWebGL2?V.get("EXT_color_buffer_float"):V.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ht.checkFramebufferStatus(36160)?e>=0&&e<=t.width-s&&i>=0&&i<=t.height-r&&ht.readPixels(e,i,s,r,at.convert(h),at.convert(c),n):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&ht.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,i=0){const s=Math.pow(2,-i),r=Math.floor(e.image.width*s),n=Math.floor(e.image.height*s),a=at.convert(e.format);q.setTexture2D(e,0),ht.copyTexImage2D(3553,i,a,t.x,t.y,r,n,0),k.unbindTexture()},this.copyTextureToTexture=function(t,e,i,s=0){const r=e.image.width,n=e.image.height,a=at.convert(i.format),o=at.convert(i.type);q.setTexture2D(i,0),ht.pixelStorei(37440,i.flipY),ht.pixelStorei(37441,i.premultiplyAlpha),ht.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?ht.texSubImage2D(3553,s,t.x,t.y,r,n,a,o,e.image.data):e.isCompressedTexture?ht.compressedTexSubImage2D(3553,s,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):ht.texSubImage2D(3553,s,t.x,t.y,a,o,e.image),0===s&&i.generateMipmaps&&ht.generateMipmap(3553),k.unbindTexture()},this.initTexture=function(t){q.setTexture2D(t,0),k.unbindTexture()},this.resetState=function(){k.reset(),ot.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function WebGL1Renderer(t){WebGLRenderer.call(this,t)}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Object.assign(WebXRController.prototype,{constructor:WebXRController,getHandSpace:function(){if(null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){const t=new Group;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,i){let s=null,r=null,n=null;const a=this._targetRay,o=this._grip,h=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(h&&t.hand){n=!0;for(let s=0;s<=window.XRHand.LITTLE_PHALANX_TIP;s++)if(t.hand[s]){const r=e.getJointPose(t.hand[s],i),n=h.joints[s];null!==r&&(n.matrix.fromArray(r.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=r.radius),n.visible=null!==r;const a=h.joints[window.XRHand.INDEX_PHALANX_TIP],o=h.joints[window.XRHand.THUMB_PHALANX_TIP],c=a.position.distanceTo(o.position),l=.02,u=.005;h.inputState.pinching&&c>l+u?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&c<=l-u&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==a&&null!==(s=e.getPose(t.targetRaySpace,i))&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)),null!==o&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,i))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale));return null!==a&&(a.visible=null!==s),null!==o&&(o.visible=null!==r),null!==h&&(h.visible=null!==n),this}}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype),WebGL1Renderer.prototype=Object.assign(Object.create(WebGLRenderer.prototype),{constructor:WebGL1Renderer,isWebGL1Renderer:!0});class FogExp2{constructor(t,e){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Color(t),this.density=void 0!==e?e:25e-5}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(t,e,i){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Color(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}function InterleavedBuffer(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=MathUtils.generateUUID()}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(let s=0,r=this.stride;s<r;s++)this.array[t+s]=e.array[i+s];return this},set:function(t,e=0){return this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=MathUtils.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new InterleavedBuffer(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=MathUtils.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const _vector$6=new Vector3$1;function InterleavedBufferAttribute(t,e,i,s){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===s}function SpriteMaterial(t){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let _geometry;Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,i=this.data.count;e<i;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.applyMatrix4(t),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,s){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this},setXYZW:function(t,e,i,s,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this.data.array[t+3]=r,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const _intersectPoint=new Vector3$1,_worldScale=new Vector3$1,_mvPosition=new Vector3$1,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$1=new Vector3$1,_vB$1=new Vector3$1,_vC$1=new Vector3$1,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2;function Sprite(t){if(Object3D.call(this),this.type="Sprite",void 0===_geometry){_geometry=new BufferGeometry;const t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=_geometry,this.material=void 0!==t?t:new SpriteMaterial,this.center=new Vector2(.5,.5)}function transformVertex(t,e,i,s,r,n){_alignedPosition.subVectors(t,i).addScalar(.5).multiply(s),void 0!==r?(_rotatedPosition.x=n*_alignedPosition.x-r*_alignedPosition.y,_rotatedPosition.y=r*_alignedPosition.x+n*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),t.copy(e),t.x+=_rotatedPosition.x,t.y+=_rotatedPosition.y,t.applyMatrix4(_viewWorldMatrix)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);const i=this.material.rotation;let s,r;0!==i&&(r=Math.cos(i),s=Math.sin(i));const n=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,n,_worldScale,s,r),transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,n,_worldScale,s,r),transformVertex(_vC$1.set(.5,.5,0),_mvPosition,n,_worldScale,s,r),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);let a=t.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,!1,_intersectPoint);if(null===a&&(transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,n,_worldScale,s,r),_uvB$1.set(0,1),null===(a=t.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,!1,_intersectPoint))))return;const o=t.ray.origin.distanceTo(_intersectPoint);o<t.near||o>t.far||e.push({distance:o,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})},copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const _v1$4=new Vector3$1,_v2$2=new Vector3$1;function LOD(){Object3D.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(t){Object3D.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e=0){e=Math.abs(e);const i=this.levels;let s;for(s=0;s<i.length&&!(e<i[s].distance);s++);return i.splice(s,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let i,s;for(i=1,s=e.length;i<s&&!(t<e[i].distance);i++);return e[i-1].object}return null},raycast:function(t,e){if(this.levels.length>0){_v1$4.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(_v1$4);this.getObjectForDistance(i).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){_v1$4.setFromMatrixPosition(t.matrixWorld),_v2$2.setFromMatrixPosition(this.matrixWorld);const i=_v1$4.distanceTo(_v2$2)/t.zoom;let s,r;for(e[0].object.visible=!0,s=1,r=e.length;s<r&&i>=e[s].distance;s++)e[s-1].object.visible=!1,e[s].object.visible=!0;for(this._currentLevel=s-1;s<r;s++)e[s].object.visible=!1}},toJSON:function(t){const e=Object3D.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,s=i.length;t<s;t++){const s=i[t];e.object.levels.push({object:s.object.uuid,distance:s.distance})}return e}});const _basePosition=new Vector3$1,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector$7=new Vector3$1,_matrix$1=new Matrix4;function SkinnedMesh(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}function Bone(){Object3D.call(this),this.type="Bone"}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,copy:function(t){return Mesh.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Vector4,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Mesh.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,e){const i=this.skeleton,s=this.geometry;_skinIndex.fromBufferAttribute(s.attributes.skinIndex,t),_skinWeight.fromBufferAttribute(s.attributes.skinWeight,t),_basePosition.fromBufferAttribute(s.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const s=_skinWeight.getComponent(t);if(0!==s){const r=_skinIndex.getComponent(t);_matrix$1.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(_vector$7.copy(_basePosition).applyMatrix4(_matrix$1),s)}}return e.applyMatrix4(this.bindMatrixInverse)}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;function Skeleton(t=[],e=[]){this.uuid=MathUtils.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Skeleton.prototype,{init:function(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Matrix4)}},calculateInverses:function(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Matrix4;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let s=0,r=t.length;s<r;s++){const r=t[s]?t[s].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(r,e[s]),_offsetMatrix.toArray(i,16*s)}null!==s&&(s.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,e){this.uuid=t.uuid;for(let i=0,s=t.bones.length;i<s;i++){const s=t.bones[i];let r=e[s];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),r=new Bone),this.bones.push(r),this.boneInverses.push((new Matrix4).fromArray(t.boneInverses[i]))}return this.init(),this},toJSON:function(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let s=0,r=e.length;s<r;s++){const r=e[s];t.bones.push(r.uuid);const n=i[s];t.boneInverses.push(n.toArray())}return t}});const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;function InstancedMesh(t,e,i){Mesh.call(this,t,e),this.instanceMatrix=new BufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function LineBasicMaterial(t){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,copy:function(t){return Mesh.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getColorAt:function(t,e){e.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const i=this.matrixWorld,s=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material)for(let r=0;r<s;r++){this.getMatrixAt(r,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(i,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(t,_instanceIntersects);for(let t=0,i=_instanceIntersects.length;t<i;t++){const i=_instanceIntersects[t];i.instanceId=r,i.object=this,e.push(i)}_instanceIntersects.length=0}},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new BufferAttribute(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const _start=new Vector3$1,_end=new Vector3$1,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$2=new Sphere;function Line(t=new BufferGeometry,e=new LineBasicMaterial){Object3D.call(this),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,s=e.count;t<s;t++)_start.fromBufferAttribute(e,t-1),_end.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=_start.distanceTo(_end);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,i=t.lineDistances;i[0]=0;for(let t=1,s=e.length;t<s;t++)i[t]=i[t-1],i[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const i=this.geometry,s=this.matrixWorld,r=t.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere$2.copy(i.boundingSphere),_sphere$2.applyMatrix4(s),_sphere$2.radius+=r,!1===t.ray.intersectsSphere(_sphere$2))return;_inverseMatrix$1.copy(s).invert(),_ray$1.copy(t.ray).applyMatrix4(_inverseMatrix$1);const n=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=n*n,o=new Vector3$1,h=new Vector3$1,c=new Vector3$1,l=new Vector3$1,u=this.isLineSegments?2:1;if(i.isBufferGeometry){const s=i.index,r=i.attributes.position;if(null!==s){const i=s.array;for(let s=0,n=i.length-1;s<n;s+=u){const n=i[s],u=i[s+1];if(o.fromBufferAttribute(r,n),h.fromBufferAttribute(r,u),_ray$1.distanceSqToSegment(o,h,l,c)>a)continue;l.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(l);p<t.near||p>t.far||e.push({distance:p,point:c.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this})}}else for(let i=0,s=r.count-1;i<s;i+=u){if(o.fromBufferAttribute(r,i),h.fromBufferAttribute(r,i+1),_ray$1.distanceSqToSegment(o,h,l,c)>a)continue;l.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(l);s<t.near||s>t.far||e.push({distance:s,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){const s=i.vertices,r=s.length;for(let i=0;i<r-1;i+=u){if(_ray$1.distanceSqToSegment(s[i],s[i+1],l,c)>a)continue;l.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(l);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const _start$1=new Vector3$1,_end$1=new Vector3$1;function LineSegments(t,e){Line.call(this,t,e),this.type="LineSegments"}function LineLoop(t,e){Line.call(this,t,e),this.type="LineLoop"}function PointsMaterial(t){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,s=e.count;t<s;t+=2)_start$1.fromBufferAttribute(e,t),_end$1.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+_start$1.distanceTo(_end$1);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,i=t.lineDistances;for(let t=0,s=e.length;t<s;t+=2)_start$1.copy(e[t]),_end$1.copy(e[t+1]),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+_start$1.distanceTo(_end$1)}return this}}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_position$1=new Vector3$1;function Points(t=new BufferGeometry,e=new PointsMaterial){Object3D.call(this),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}function testPoint(t,e,i,s,r,n,a){const o=_ray$2.distanceSqToPoint(t);if(o<i){const i=new Vector3$1;_ray$2.closestPointToPoint(t,i),i.applyMatrix4(s);const h=r.ray.origin.distanceTo(i);if(h<r.near||h>r.far)return;n.push({distance:h,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}function VideoTexture(t,e,i,s,r,n,a,o,h){Texture.call(this,t,e,i,s,r,n,a,o,h),this.format=void 0!==a?a:RGBFormat,this.minFilter=void 0!==n?n:LinearFilter,this.magFilter=void 0!==r?r:LinearFilter,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)})}function CompressedTexture(t,e,i,s,r,n,a,o,h,c,l,u){Texture.call(this,null,n,a,o,h,c,s,r,l,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(t,e,i,s,r,n,a,o,h){Texture.call(this,t,e,i,s,r,n,a,o,h),this.needsUpdate=!0}function DepthTexture(t,e,i,s,r,n,a,o,h,c){if((c=void 0!==c?c:DepthFormat)!==DepthFormat&&c!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===DepthFormat&&(i=UnsignedShortType),void 0===i&&c===DepthStencilFormat&&(i=UnsignedInt248Type),Texture.call(this,null,s,r,n,a,o,c,i,h),this.image={width:t,height:e},this.magFilter=void 0!==a?a:NearestFilter,this.minFilter=void 0!==o?o:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const i=this.geometry,s=this.matrixWorld,r=t.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere$3.copy(i.boundingSphere),_sphere$3.applyMatrix4(s),_sphere$3.radius+=r,!1===t.ray.intersectsSphere(_sphere$3))return;_inverseMatrix$2.copy(s).invert(),_ray$2.copy(t.ray).applyMatrix4(_inverseMatrix$2);const n=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=n*n;if(i.isBufferGeometry){const r=i.index,n=i.attributes.position;if(null!==r){const i=r.array;for(let r=0,o=i.length;r<o;r++){const o=i[r];_position$1.fromBufferAttribute(n,o),testPoint(_position$1,o,a,s,t,e,this)}}else for(let i=0,r=n.count;i<r;i++)_position$1.fromBufferAttribute(n,i),testPoint(_position$1,i,a,s,t,e,this)}else{const r=i.vertices;for(let i=0,n=r.length;i<n;i++)testPoint(r[i],i,a,s,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0;let _geometryId=0;const _m1$3=new Matrix4,_obj$1=new Object3D,_offset$1=new Vector3$1;function Geometry(){Object.defineProperty(this,"id",{value:_geometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(t){const e=(new Matrix3).getNormalMatrix(t);for(let e=0,i=this.vertices.length;e<i;e++){this.vertices[e].applyMatrix4(t)}for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t];i.normal.applyMatrix3(e).normalize();for(let t=0,s=i.vertexNormals.length;t<s;t++)i.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return _m1$3.makeRotationX(t),this.applyMatrix4(_m1$3),this},rotateY:function(t){return _m1$3.makeRotationY(t),this.applyMatrix4(_m1$3),this},rotateZ:function(t){return _m1$3.makeRotationZ(t),this.applyMatrix4(_m1$3),this},translate:function(t,e,i){return _m1$3.makeTranslation(t,e,i),this.applyMatrix4(_m1$3),this},scale:function(t,e,i){return _m1$3.makeScale(t,e,i),this.applyMatrix4(_m1$3),this},lookAt:function(t){return _obj$1.lookAt(t),_obj$1.updateMatrix(),this.applyMatrix4(_obj$1.matrix),this},fromBufferGeometry:function(t){const e=this,i=null!==t.index?t.index:void 0,s=t.attributes;if(void 0===s.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=s.position,n=s.normal,a=s.color,o=s.uv,h=s.uv2;void 0!==h&&(this.faceVertexUvs[1]=[]);for(let t=0;t<r.count;t++)e.vertices.push((new Vector3$1).fromBufferAttribute(r,t)),void 0!==a&&e.colors.push((new Color).fromBufferAttribute(a,t));function c(t,i,s,r){const c=void 0===a?[]:[e.colors[t].clone(),e.colors[i].clone(),e.colors[s].clone()],l=void 0===n?[]:[(new Vector3$1).fromBufferAttribute(n,t),(new Vector3$1).fromBufferAttribute(n,i),(new Vector3$1).fromBufferAttribute(n,s)],u=new Face3(t,i,s,l,c,r);e.faces.push(u),void 0!==o&&e.faceVertexUvs[0].push([(new Vector2).fromBufferAttribute(o,t),(new Vector2).fromBufferAttribute(o,i),(new Vector2).fromBufferAttribute(o,s)]),void 0!==h&&e.faceVertexUvs[1].push([(new Vector2).fromBufferAttribute(h,t),(new Vector2).fromBufferAttribute(h,i),(new Vector2).fromBufferAttribute(h,s)])}const l=t.groups;if(l.length>0)for(let t=0;t<l.length;t++){const e=l[t],s=e.start;for(let t=s,r=s+e.count;t<r;t+=3)void 0!==i?c(i.getX(t),i.getX(t+1),i.getX(t+2),e.materialIndex):c(t,t+1,t+2,e.materialIndex)}else if(void 0!==i)for(let t=0;t<i.count;t+=3)c(i.getX(t),i.getX(t+1),i.getX(t+2));else for(let t=0;t<r.count;t+=3)c(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$1).negate(),this.translate(_offset$1.x,_offset$1.y,_offset$1.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,s=new Matrix4;return s.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(s),this},computeFaceNormals:function(){const t=new Vector3$1,e=new Vector3$1;for(let i=0,s=this.faces.length;i<s;i++){const s=this.faces[i],r=this.vertices[s.a],n=this.vertices[s.b],a=this.vertices[s.c];t.subVectors(a,n),e.subVectors(r,n),t.cross(e),t.normalize(),s.normal.copy(t)}},computeVertexNormals:function(t=!0){const e=new Array(this.vertices.length);for(let t=0,i=this.vertices.length;t<i;t++)e[t]=new Vector3$1;if(t){const t=new Vector3$1,i=new Vector3$1;for(let s=0,r=this.faces.length;s<r;s++){const r=this.faces[s],n=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,a),i.subVectors(n,a),t.cross(i),e[r.a].add(t),e[r.b].add(t),e[r.c].add(t)}}else{this.computeFaceNormals();for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t];e[i.a].add(i.normal),e[i.b].add(i.normal),e[i.c].add(i.normal)}}for(let t=0,i=this.vertices.length;t<i;t++)e[t].normalize();for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t],s=i.vertexNormals;3===s.length?(s[0].copy(e[i.a]),s[1].copy(e[i.b]),s[2].copy(e[i.c])):(s[0]=e[i.a].clone(),s[1]=e[i.b].clone(),s[2]=e[i.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],i=e.vertexNormals;3===i.length?(i[0].copy(e.normal),i[1].copy(e.normal),i[2].copy(e.normal)):(i[0]=e.normal.clone(),i[1]=e.normal.clone(),i[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,i=e.vertexNormals.length;t<i;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const t=new Geometry;t.faces=this.faces;for(let e=0,i=this.morphTargets.length;e<i;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,i=this.morphNormals[e].vertexNormals;for(let e=0,s=this.faces.length;e<s;e++){const e=new Vector3$1,s={a:new Vector3$1,b:new Vector3$1,c:new Vector3$1};t.push(e),i.push(s)}}const i=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],s=i.faceNormals[t],r=i.vertexNormals[t];s.copy(e.normal),r.a.copy(e.vertexNormals[0]),r.b.copy(e.vertexNormals[1]),r.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i=0){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let s;const r=this.vertices.length,n=this.vertices,a=t.vertices,o=this.faces,h=t.faces,c=this.colors,l=t.colors;void 0!==e&&(s=(new Matrix3).getNormalMatrix(e));for(let t=0,i=a.length;t<i;t++){const i=a[t].clone();void 0!==e&&i.applyMatrix4(e),n.push(i)}for(let t=0,e=l.length;t<e;t++)c.push(l[t].clone());for(let t=0,e=h.length;t<e;t++){const e=h[t];let n,a;const c=e.vertexNormals,l=e.vertexColors,u=new Face3(e.a+r,e.b+r,e.c+r);u.normal.copy(e.normal),void 0!==s&&u.normal.applyMatrix3(s).normalize();for(let t=0,e=c.length;t<e;t++)n=c[t].clone(),void 0!==s&&n.applyMatrix3(s).normalize(),u.vertexNormals.push(n);u.color.copy(e.color);for(let t=0,e=l.length;t<e;t++)a=l[t],u.vertexColors.push(a.clone());u.materialIndex=e.materialIndex+i,o.push(u)}for(let e=0,i=t.faceVertexUvs.length;e<i;e++){const i=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,s=i.length;t<s;t++){const s=i[t],r=[];for(let t=0,e=s.length;t<e;t++)r.push(s[t].clone());this.faceVertexUvs[e].push(r)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(t=4){const e={},i=[],s=[],r=Math.pow(10,t);for(let t=0,n=this.vertices.length;t<n;t++){const n=this.vertices[t],a=Math.round(n.x*r)+"_"+Math.round(n.y*r)+"_"+Math.round(n.z*r);void 0===e[a]?(e[a]=t,i.push(this.vertices[t]),s[t]=i.length-1):s[t]=s[e[a]]}const n=[];for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.a=s[e.a],e.b=s[e.b],e.c=s[e.c];const i=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(i[e]===i[(e+1)%3]){n.push(t);break}}for(let t=n.length-1;t>=0;t--){const e=n[t];this.faces.splice(e,1);for(let t=0,i=this.faceVertexUvs.length;t<i;t++)this.faceVertexUvs[t].splice(e,1)}const a=this.vertices.length-i.length;return this.vertices=i,a},setFromPoints:function(t){this.vertices=[];for(let e=0,i=t.length;e<i;e++){const i=t[e];this.vertices.push(new Vector3$1(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});const i=this.faceVertexUvs[0],s=this.faceVertexUvs[1];let r,n;i&&i.length===e&&(r=[]),s&&s.length===e&&(n=[]);for(let a=0;a<e;a++){const e=t[a]._id;r&&r.push(i[e]),n&&n.push(s[e])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}const e=[];for(let t=0;t<this.vertices.length;t++){const i=this.vertices[t];e.push(i.x,i.y,i.z)}const i=[],s=[],r={},n=[],a={},o=[],h={};for(let t=0;t<this.faces.length;t++){const e=this.faces[t],s=!0,r=!1,n=void 0!==this.faceVertexUvs[0][t],a=e.normal.length()>0,o=e.vertexNormals.length>0,h=1!==e.color.r||1!==e.color.g||1!==e.color.b,d=e.vertexColors.length>0;let f=0;if(f=c(f,0,0),f=c(f,1,s),f=c(f,2,r),f=c(f,3,n),f=c(f,4,a),f=c(f,5,o),f=c(f,6,h),f=c(f,7,d),i.push(f),i.push(e.a,e.b,e.c),i.push(e.materialIndex),n){const e=this.faceVertexUvs[0][t];i.push(p(e[0]),p(e[1]),p(e[2]))}if(a&&i.push(l(e.normal)),o){const t=e.vertexNormals;i.push(l(t[0]),l(t[1]),l(t[2]))}if(h&&i.push(u(e.color)),d){const t=e.vertexColors;i.push(u(t[0]),u(t[1]),u(t[2]))}}function c(t,e,i){return i?t|1<<e:t&~(1<<e)}function l(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]?r[e]:(r[e]=s.length/3,s.push(t.x,t.y,t.z),r[e])}function u(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==a[e]?a[e]:(a[e]=n.length,n.push(t.getHex()),a[e])}function p(t){const e=t.x.toString()+t.y.toString();return void 0!==h[e]?h[e]:(h[e]=o.length/2,o.push(t.x,t.y),h[e])}return t.data={},t.data.vertices=e,t.data.normals=s,n.length>0&&(t.data.colors=n),o.length>0&&(t.data.uvs=[o]),t.data.faces=i,t},clone:function(){return(new Geometry).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let t=0,i=e.length;t<i;t++)this.vertices.push(e[t].clone());const i=t.colors;for(let t=0,e=i.length;t<e;t++)this.colors.push(i[t].clone());const s=t.faces;for(let t=0,e=s.length;t<e;t++)this.faces.push(s[t].clone());for(let e=0,i=t.faceVertexUvs.length;e<i;e++){const i=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,s=i.length;t<s;t++){const s=i[t],r=[];for(let t=0,e=s.length;t<e;t++){const e=s[t];r.push(e.clone())}this.faceVertexUvs[e].push(r)}}const r=t.morphTargets;for(let t=0,e=r.length;t<e;t++){const e={};if(e.name=r[t].name,void 0!==r[t].vertices){e.vertices=[];for(let i=0,s=r[t].vertices.length;i<s;i++)e.vertices.push(r[t].vertices[i].clone())}if(void 0!==r[t].normals){e.normals=[];for(let i=0,s=r[t].normals.length;i<s;i++)e.normals.push(r[t].normals[i].clone())}this.morphTargets.push(e)}const n=t.morphNormals;for(let t=0,e=n.length;t<e;t++){const e={};if(void 0!==n[t].vertexNormals){e.vertexNormals=[];for(let i=0,s=n[t].vertexNormals.length;i<s;i++){const s=n[t].vertexNormals[i],r={};r.a=s.a.clone(),r.b=s.b.clone(),r.c=s.c.clone(),e.vertexNormals.push(r)}}if(void 0!==n[t].faceNormals){e.faceNormals=[];for(let i=0,s=n[t].faceNormals.length;i<s;i++)e.faceNormals.push(n[t].faceNormals[i].clone())}this.morphNormals.push(e)}const a=t.skinWeights;for(let t=0,e=a.length;t<e;t++)this.skinWeights.push(a[t].clone());const o=t.skinIndices;for(let t=0,e=o.length;t<e;t++)this.skinIndices.push(o[t].clone());const h=t.lineDistances;for(let t=0,e=h.length;t<e;t++)this.lineDistances.push(h[t]);const c=t.boundingBox;null!==c&&(this.boundingBox=c.clone());const l=t.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxGeometry extends Geometry{constructor(t,e,i,s,r,n){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:s,heightSegments:r,depthSegments:n},this.fromBufferGeometry(new BoxBufferGeometry(t,e,i,s,r,n)),this.mergeVertices()}}class CircleBufferGeometry extends BufferGeometry{constructor(t=1,e=8,i=0,s=2*Math.PI){super(),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:s},e=Math.max(3,e);const r=[],n=[],a=[],o=[],h=new Vector3$1,c=new Vector2;n.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,l=3;r<=e;r++,l+=3){const u=i+r/e*s;h.x=t*Math.cos(u),h.y=t*Math.sin(u),n.push(h.x,h.y,h.z),a.push(0,0,1),c.x=(n[l]/t+1)/2,c.y=(n[l+1]/t+1)/2,o.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2))}}class CircleGeometry extends Geometry{constructor(t,e,i,s){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:s},this.fromBufferGeometry(new CircleBufferGeometry(t,e,i,s)),this.mergeVertices()}}class CylinderBufferGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,s=8,r=1,n=!1,a=0,o=2*Math.PI){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:s,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o};const h=this;s=Math.floor(s),r=Math.floor(r);const c=[],l=[],u=[],p=[];let d=0;const f=[],m=i/2;let g=0;function y(i){const r=d,n=new Vector2,f=new Vector3$1;let y=0;const v=!0===i?t:e,b=!0===i?1:-1;for(let t=1;t<=s;t++)l.push(0,m*b,0),u.push(0,b,0),p.push(.5,.5),d++;const x=d;for(let t=0;t<=s;t++){const e=t/s*o+a,i=Math.cos(e),r=Math.sin(e);f.x=v*r,f.y=m*b,f.z=v*i,l.push(f.x,f.y,f.z),u.push(0,b,0),n.x=.5*i+.5,n.y=.5*r*b+.5,p.push(n.x,n.y),d++}for(let t=0;t<s;t++){const e=r+t,s=x+t;!0===i?c.push(s,s+1,e):c.push(s+1,s,e),y+=3}h.addGroup(g,y,!0===i?1:2),g+=y}!function(){const n=new Vector3$1,y=new Vector3$1;let v=0;const b=(e-t)/i;for(let h=0;h<=r;h++){const c=[],g=h/r,v=g*(e-t)+t;for(let t=0;t<=s;t++){const e=t/s,r=e*o+a,h=Math.sin(r),f=Math.cos(r);y.x=v*h,y.y=-g*i+m,y.z=v*f,l.push(y.x,y.y,y.z),n.set(h,b,f).normalize(),u.push(n.x,n.y,n.z),p.push(e,1-g),c.push(d++)}f.push(c)}for(let t=0;t<s;t++)for(let e=0;e<r;e++){const i=f[e][t],s=f[e+1][t],r=f[e+1][t+1],n=f[e][t+1];c.push(i,s,n),c.push(s,r,n),v+=6}h.addGroup(g,v,0),g+=v}(),!1===n&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(p,2))}}class CylinderGeometry extends Geometry{constructor(t,e,i,s,r,n,a,o){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:s,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new CylinderBufferGeometry(t,e,i,s,r,n,a,o)),this.mergeVertices()}}class ConeGeometry extends CylinderGeometry{constructor(t,e,i,s,r,n,a){super(0,t,e,i,s,r,n,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:n,thetaLength:a}}}class ConeBufferGeometry extends CylinderBufferGeometry{constructor(t=1,e=1,i=8,s=1,r=!1,n=0,a=2*Math.PI){super(0,t,e,i,s,r,n,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:n,thetaLength:a}}}class PolyhedronBufferGeometry extends BufferGeometry{constructor(t,e,i=1,s=0){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:s};const r=[],n=[];function a(t,e,i,s){const r=s+1,n=[];for(let s=0;s<=r;s++){n[s]=[];const a=t.clone().lerp(i,s/r),o=e.clone().lerp(i,s/r),h=r-s;for(let t=0;t<=h;t++)n[s][t]=0===t&&s===r?a:a.clone().lerp(o,t/h)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(n[t][i+1]),o(n[t+1][i]),o(n[t][i])):(o(n[t][i+1]),o(n[t+1][i+1]),o(n[t+1][i]))}}function o(t){r.push(t.x,t.y,t.z)}function h(e,i){const s=3*e;i.x=t[s+0],i.y=t[s+1],i.z=t[s+2]}function c(t,e,i,s){s<0&&1===t.x&&(n[e]=t.x-1),0===i.x&&0===i.z&&(n[e]=s/2/Math.PI+.5)}function l(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new Vector3$1,s=new Vector3$1,r=new Vector3$1;for(let n=0;n<e.length;n+=3)h(e[n+0],i),h(e[n+1],s),h(e[n+2],r),a(i,s,r,t)}(s),function(t){const e=new Vector3$1;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new Vector3$1;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const s=l(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);n.push(s,1-a)}var e;(function(){const t=new Vector3$1,e=new Vector3$1,i=new Vector3$1,s=new Vector3$1,a=new Vector2,o=new Vector2,h=new Vector2;for(let u=0,p=0;u<r.length;u+=9,p+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),a.set(n[p+0],n[p+1]),o.set(n[p+2],n[p+3]),h.set(n[p+4],n[p+5]),s.copy(t).add(e).add(i).divideScalar(3);const d=l(s);c(a,p+0,t,d),c(o,p+2,e,d),c(h,p+4,i,d)}})(),function(){for(let t=0;t<n.length;t+=6){const e=n[t+0],i=n[t+2],s=n[t+4],r=Math.max(e,i,s),a=Math.min(e,i,s);r>.9&&a<.1&&(e<.2&&(n[t+0]+=1),i<.2&&(n[t+2]+=1),s<.2&&(n[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("normal",new Float32BufferAttribute(r.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(n,2)),0===s?this.computeVertexNormals():this.normalizeNormals()}}class DodecahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,s=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-i,0,-s,i,0,s,-i,0,s,i,-s,-i,0,-s,i,0,s,-i,0,s,i,0,-i,0,-s,i,0,-s,-i,0,s,i,0,s],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class DodecahedronGeometry extends Geometry{constructor(t,e){super(),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new DodecahedronBufferGeometry(t,e)),this.mergeVertices()}}const _v0$2=new Vector3$1,_v1$5=new Vector3$1,_normal$1=new Vector3$1,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t,e){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,t.isGeometry&&(t=(new BufferGeometry).fromGeometry(t));const i=Math.pow(10,4),s=Math.cos(MathUtils.DEG2RAD*e),r=t.getIndex(),n=t.getAttribute("position"),a=r?r.count:n.count,o=[0,0,0],h=["a","b","c"],c=new Array(3),l={},u=[];for(let t=0;t<a;t+=3){r?(o[0]=r.getX(t),o[1]=r.getX(t+1),o[2]=r.getX(t+2)):(o[0]=t,o[1]=t+1,o[2]=t+2);const{a:e,b:a,c:p}=_triangle;if(e.fromBufferAttribute(n,o[0]),a.fromBufferAttribute(n,o[1]),p.fromBufferAttribute(n,o[2]),_triangle.getNormal(_normal$1),c[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,c[1]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,c[2]=`${Math.round(p.x*i)},${Math.round(p.y*i)},${Math.round(p.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=c[t],r=c[e],n=_triangle[h[t]],a=_triangle[h[e]],p=`${i}_${r}`,d=`${r}_${i}`;d in l&&l[d]?(_normal$1.dot(l[d].normal)<=s&&(u.push(n.x,n.y,n.z),u.push(a.x,a.y,a.z)),l[d]=null):p in l||(l[p]={index0:o[t],index1:o[e],normal:_normal$1.clone()})}}for(const t in l)if(l[t]){const{index0:e,index1:i}=l[t];_v0$2.fromBufferAttribute(n,e),_v1$5.fromBufferAttribute(n,i),u.push(_v0$2.x,_v0$2.y,_v0$2.z),u.push(_v1$5.x,_v1$5.y,_v1$5.z)}this.setAttribute("position",new Float32BufferAttribute(u,3))}}const Earcut={triangulate:function(t,e,i){i=i||2;const s=e&&e.length,r=s?e[0]*i:t.length;let n=linkedList(t,0,r,i,!0);const a=[];if(!n||n.next===n.prev)return a;let o,h,c,l,u,p,d;if(s&&(n=eliminateHoles(t,e,n,i)),t.length>80*i){o=c=t[0],h=l=t[1];for(let e=i;e<r;e+=i)(u=t[e])<o&&(o=u),(p=t[e+1])<h&&(h=p),u>c&&(c=u),p>l&&(l=p);d=0!==(d=Math.max(c-o,l-h))?1/d:0}return earcutLinked(n,a,i,o,h,d),a}};function linkedList(t,e,i,s,r){let n,a;if(r===signedArea(t,e,i,s)>0)for(n=e;n<i;n+=s)a=insertNode(n,t[n],t[n+1],a);else for(n=i-s;n>=e;n-=s)a=insertNode(n,t[n],t[n+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(t,e){if(!t)return t;e||(e=t);let i,s=t;do{if(i=!1,s.steiner||!equals(s,s.next)&&0!==area(s.prev,s,s.next))s=s.next;else{if(removeNode(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function earcutLinked(t,e,i,s,r,n,a){if(!t)return;!a&&n&&indexCurve(t,s,r,n);let o,h,c=t;for(;t.prev!==t.next;)if(o=t.prev,h=t.next,n?isEarHashed(t,s,r,n):isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(h.i/i),removeNode(t),t=h.next,c=h.next;else if((t=h)===c){a?1===a?earcutLinked(t=cureLocalIntersections(filterPoints(t),e,i),e,i,s,r,n,2):2===a&&splitEarcut(t,e,i,s,r,n):earcutLinked(filterPoints(t),e,i,s,r,n,1);break}}function isEar(t){const e=t.prev,i=t,s=t.next;if(area(e,i,s)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(t,e,i,s){const r=t.prev,n=t,a=t.next;if(area(r,n,a)>=0)return!1;const o=r.x<n.x?r.x<a.x?r.x:a.x:n.x<a.x?n.x:a.x,h=r.y<n.y?r.y<a.y?r.y:a.y:n.y<a.y?n.y:a.y,c=r.x>n.x?r.x>a.x?r.x:a.x:n.x>a.x?n.x:a.x,l=r.y>n.y?r.y>a.y?r.y:a.y:n.y>a.y?n.y:a.y,u=zOrder(o,h,e,i,s),p=zOrder(c,l,e,i,s);let d=t.prevZ,f=t.nextZ;for(;d&&d.z>=u&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function cureLocalIntersections(t,e,i){let s=t;do{const r=s.prev,n=s.next.next;!equals(r,n)&&intersects(r,s,s.next,n)&&locallyInside(r,n)&&locallyInside(n,r)&&(e.push(r.i/i),e.push(s.i/i),e.push(n.i/i),removeNode(s),removeNode(s.next),s=t=n),s=s.next}while(s!==t);return filterPoints(s)}function splitEarcut(t,e,i,s,r,n){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&isValidDiagonal(a,t)){let o=splitPolygon(a,t);return a=filterPoints(a,a.next),o=filterPoints(o,o.next),earcutLinked(a,e,i,s,r,n),void earcutLinked(o,e,i,s,r,n)}t=t.next}a=a.next}while(a!==t)}function eliminateHoles(t,e,i,s){const r=[];let n,a,o,h,c;for(n=0,a=e.length;n<a;n++)(c=linkedList(t,o=e[n]*s,h=n<a-1?e[n+1]*s:t.length,s,!1))===c.next&&(c.steiner=!0),r.push(getLeftmost(c));for(r.sort(compareX),n=0;n<r.length;n++)eliminateHole(r[n],i),i=filterPoints(i,i.next);return i}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=findHoleBridge(t,e)){const i=splitPolygon(e,t);filterPoints(e,e.next),filterPoints(i,i.next)}}function findHoleBridge(t,e){let i=e;const s=t.x,r=t.y;let n,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>a){if(a=t,t===s){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(s===a)return n;const o=n,h=n.x,c=n.y;let l,u=1/0;i=n;do{s>=i.x&&i.x>=h&&s!==i.x&&pointInTriangle(r<c?s:a,r,h,c,r<c?a:s,r,i.x,i.y)&&(l=Math.abs(r-i.y)/(s-i.x),locallyInside(i,t)&&(l<u||l===u&&(i.x>n.x||i.x===n.x&&sectorContainsSector(n,i)))&&(n=i,u=l)),i=i.next}while(i!==o);return n}function sectorContainsSector(t,e){return area(t.prev,t,e.prev)<0&&area(e.next,t,t.next)<0}function indexCurve(t,e,i,s){let r=t;do{null===r.z&&(r.z=zOrder(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,sortLinked(r)}function sortLinked(t){let e,i,s,r,n,a,o,h,c=1;do{for(i=t,t=null,n=null,a=0;i;){for(a++,s=i,o=0,e=0;e<c&&(o++,s=s.nextZ);e++);for(h=c;o>0||h>0&&s;)0!==o&&(0===h||!s||i.z<=s.z)?(r=i,i=i.nextZ,o--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=s}n.nextZ=null,c*=2}while(a>1);return t}function zOrder(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,s,r,n,a,o){return(r-a)*(e-o)-(t-a)*(n-o)>=0&&(t-a)*(s-o)-(i-a)*(e-o)>=0&&(i-a)*(n-o)-(r-a)*(s-o)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&(locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)&&(area(t.prev,t,e.prev)||area(t,e.prev,e))||equals(t,e)&&area(t.prev,t,t.next)>0&&area(e.prev,e,e.next)>0)}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,s){const r=sign(area(t,e,i)),n=sign(area(t,e,s)),a=sign(area(i,s,t)),o=sign(area(i,s,e));return r!==n&&a!==o||(!(0!==r||!onSegment(t,i,e))||(!(0!==n||!onSegment(t,s,e))||(!(0!==a||!onSegment(i,t,s))||!(0!==o||!onSegment(i,e,s)))))}function onSegment(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function sign(t){return t>0?1:t<0?-1:0}function intersectsPolygon(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function middleInside(t,e){let i=t,s=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}function splitPolygon(t,e){const i=new Node(t.i,t.x,t.y),s=new Node(e.i,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function insertNode(t,e,i,s){const r=new Node(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,i,s){let r=0;for(let n=e,a=i-s;n<i;n+=s)r+=(t[a]-t[n])*(t[n+1]+t[a+1]),a=n;return r}const ShapeUtils={area:function(t){const e=t.length;let i=0;for(let s=e-1,r=0;r<e;s=r++)i+=t[s].x*t[r].y-t[r].x*t[s].y;return.5*i},isClockWise:function(t){return ShapeUtils.area(t)<0},triangulateShape:function(t,e){const i=[],s=[],r=[];removeDupEndPts(t),addContour(i,t);let n=t.length;e.forEach(removeDupEndPts);for(let t=0;t<e.length;t++)s.push(n),n+=e[t].length,addContour(i,e[t]);const a=Earcut.triangulate(i,s);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}};function removeDupEndPts(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function addContour(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class ExtrudeBufferGeometry extends BufferGeometry{constructor(t,e){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,s=[],r=[];for(let e=0,i=t.length;e<i;e++){n(t[e])}function n(t){const n=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let h=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,l=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:l-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:WorldUVGenerator;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),h=e.amount);let g,y,v,b,x,_=!1;f&&(g=f.getSpacedPoints(o),_=!0,c=!1,y=f.computeFrenetFrames(o,!1),v=new Vector3$1,b=new Vector3$1,x=new Vector3$1),c||(d=0,l=0,u=0,p=0);const M=t.extractPoints(a);let w=M.shape;const S=M.holes;if(!ShapeUtils.isClockWise(w)){w=w.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];ShapeUtils.isClockWise(e)&&(S[t]=e.reverse())}}const A=ShapeUtils.triangulateShape(w,S),T=w;for(let t=0,e=S.length;t<e;t++){const e=S[t];w=w.concat(e)}function C(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const L=w.length,E=A.length;function z(t,e,i){let s,r,n;const a=t.x-e.x,o=t.y-e.y,h=i.x-t.x,c=i.y-t.y,l=a*a+o*o,u=a*c-o*h;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(l),p=Math.sqrt(h*h+c*c),d=e.x-o/u,f=e.y+a/u,m=((i.x-c/p-d)*c-(i.y+h/p-f)*h)/(a*c-o*h),g=(s=d+a*m-t.x)*s+(r=f+o*m-t.y)*r;if(g<=2)return new Vector2(s,r);n=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?h>Number.EPSILON&&(t=!0):a<-Number.EPSILON?h<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(c)&&(t=!0),t?(s=-o,r=a,n=Math.sqrt(l)):(s=a,r=o,n=Math.sqrt(l/2))}return new Vector2(s/n,r/n)}const R=[];for(let t=0,e=T.length,i=e-1,s=t+1;t<e;t++,i++,s++)i===e&&(i=0),s===e&&(s=0),R[t]=z(T[t],T[i],T[s]);const B=[];let P,D=R.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];P=[];for(let t=0,i=e.length,s=i-1,r=t+1;t<i;t++,s++,r++)s===i&&(s=0),r===i&&(r=0),P[t]=z(e[t],e[s],e[r]);B.push(P),D=D.concat(P)}for(let t=0;t<d;t++){const e=t/d,i=l*Math.cos(e*Math.PI/2),s=u*Math.sin(e*Math.PI/2)+p;for(let t=0,e=T.length;t<e;t++){const e=C(T[t],R[t],s);F(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];P=B[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],P[t],s);F(r.x,r.y,-i)}}}const I=u+p;for(let t=0;t<L;t++){const e=c?C(w[t],D[t],I):w[t];_?(b.copy(y.normals[0]).multiplyScalar(e.x),v.copy(y.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(b).add(v),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<L;e++){const i=c?C(w[e],D[e],I):w[e];_?(b.copy(y.normals[t]).multiplyScalar(i.x),v.copy(y.binormals[t]).multiplyScalar(i.y),x.copy(g[t]).add(b).add(v),F(x.x,x.y,x.z)):F(i.x,i.y,h/o*t)}for(let t=d-1;t>=0;t--){const e=t/d,i=l*Math.cos(e*Math.PI/2),s=u*Math.sin(e*Math.PI/2)+p;for(let t=0,e=T.length;t<e;t++){const e=C(T[t],R[t],s);F(e.x,e.y,h+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];P=B[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],P[t],s);_?F(r.x,r.y+g[o-1].y,g[o-1].x+i):F(r.x,r.y,h+i)}}}function O(t,e){let i=t.length;for(;--i>=0;){const s=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*d;t<i;t++){const i=L*t,n=L*(t+1);N(e+s+i,e+r+i,e+r+n,e+s+n)}}}function F(t,e,i){n.push(t),n.push(e),n.push(i)}function G(t,e,r){j(t),j(e),j(r);const n=s.length/3,a=m.generateTopUV(i,s,n-3,n-2,n-1);V(a[0]),V(a[1]),V(a[2])}function N(t,e,r,n){j(t),j(e),j(n),j(e),j(r),j(n);const a=s.length/3,o=m.generateSideWallUV(i,s,a-6,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[3]),V(o[1]),V(o[2]),V(o[3])}function j(t){s.push(n[3*t+0]),s.push(n[3*t+1]),s.push(n[3*t+2])}function V(t){r.push(t.x),r.push(t.y)}!function(){const t=s.length/3;if(c){let t=0,e=L*t;for(let t=0;t<E;t++){const i=A[t];G(i[2]+e,i[1]+e,i[0]+e)}e=L*(t=o+2*d);for(let t=0;t<E;t++){const i=A[t];G(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<E;t++){const e=A[t];G(e[2],e[1],e[0])}for(let t=0;t<E;t++){const e=A[t];G(e[0]+L*o,e[1]+L*o,e[2]+L*o)}}i.addGroup(t,s.length/3-t,0)}(),function(){const t=s.length/3;let e=0;O(T,e),e+=T.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];O(i,e),e+=i.length}i.addGroup(t,s.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(r,2)),this.computeVertexNormals()}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,t)}}const WorldUVGenerator={generateTopUV:function(t,e,i,s,r){const n=e[3*i],a=e[3*i+1],o=e[3*s],h=e[3*s+1],c=e[3*r],l=e[3*r+1];return[new Vector2(n,a),new Vector2(o,h),new Vector2(c,l)]},generateSideWallUV:function(t,e,i,s,r,n){const a=e[3*i],o=e[3*i+1],h=e[3*i+2],c=e[3*s],l=e[3*s+1],u=e[3*s+2],p=e[3*r],d=e[3*r+1],f=e[3*r+2],m=e[3*n],g=e[3*n+1],y=e[3*n+2];return Math.abs(o-l)<.01?[new Vector2(a,1-h),new Vector2(c,1-u),new Vector2(p,1-f),new Vector2(m,1-y)]:[new Vector2(o,1-h),new Vector2(l,1-u),new Vector2(d,1-f),new Vector2(g,1-y)]}};function toJSON(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,s=t.length;e<s;e++){const s=t[e];i.shapes.push(s.uuid)}else i.shapes.push(t.uuid);return void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class ExtrudeGeometry extends Geometry{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new ExtrudeBufferGeometry(t,e)),this.mergeVertices()}toJSON(){const t=super.toJSON();return toJSON$1(this.parameters.shapes,this.parameters.options,t)}}function toJSON$1(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,s=t.length;e<s;e++){const s=t[e];i.shapes.push(s.uuid)}else i.shapes.push(t.uuid);return void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class IcosahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class IcosahedronGeometry extends Geometry{constructor(t,e){super(),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new IcosahedronBufferGeometry(t,e)),this.mergeVertices()}}class LatheBufferGeometry extends BufferGeometry{constructor(t,e=12,i=0,s=2*Math.PI){super(),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:s},e=Math.floor(e),s=MathUtils.clamp(s,0,2*Math.PI);const r=[],n=[],a=[],o=1/e,h=new Vector3$1,c=new Vector2;for(let r=0;r<=e;r++){const l=i+r*o*s,u=Math.sin(l),p=Math.cos(l);for(let i=0;i<=t.length-1;i++)h.x=t[i].x*u,h.y=t[i].y,h.z=t[i].x*p,n.push(h.x,h.y,h.z),c.x=r/e,c.y=i/(t.length-1),a.push(c.x,c.y)}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const s=e+i*t.length,n=s,a=s+t.length,o=s+t.length+1,h=s+1;r.push(n,a,h),r.push(a,o,h)}if(this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2)),this.computeVertexNormals(),s===2*Math.PI){const i=this.attributes.normal.array,s=new Vector3$1,r=new Vector3$1,n=new Vector3$1,a=e*t.length*3;for(let e=0,o=0;e<t.length;e++,o+=3)s.x=i[o+0],s.y=i[o+1],s.z=i[o+2],r.x=i[a+o+0],r.y=i[a+o+1],r.z=i[a+o+2],n.addVectors(s,r).normalize(),i[o+0]=i[a+o+0]=n.x,i[o+1]=i[a+o+1]=n.y,i[o+2]=i[a+o+2]=n.z}}}class LatheGeometry extends Geometry{constructor(t,e,i,s){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:s},this.fromBufferGeometry(new LatheBufferGeometry(t,e,i,s)),this.mergeVertices()}}class OctahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class OctahedronGeometry extends Geometry{constructor(t,e){super(),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new OctahedronBufferGeometry(t,e)),this.mergeVertices()}}function ParametricBufferGeometry(t,e,i){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};const s=[],r=[],n=[],a=[],o=new Vector3$1,h=new Vector3$1,c=new Vector3$1,l=new Vector3$1,u=new Vector3$1;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let s=0;s<=i;s++){const p=s/i;for(let i=0;i<=e;i++){const s=i/e;t(s,p,h),r.push(h.x,h.y,h.z),s-1e-5>=0?(t(s-1e-5,p,c),l.subVectors(h,c)):(t(s+1e-5,p,c),l.subVectors(c,h)),p-1e-5>=0?(t(s,p-1e-5,c),u.subVectors(h,c)):(t(s,p+1e-5,c),u.subVectors(c,h)),o.crossVectors(l,u).normalize(),n.push(o.x,o.y,o.z),a.push(s,p)}}for(let t=0;t<i;t++)for(let i=0;i<e;i++){const e=t*p+i,r=t*p+i+1,n=(t+1)*p+i+1,a=(t+1)*p+i;s.push(e,r,a),s.push(r,n,a)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("normal",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2))}function ParametricGeometry(t,e,i){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new ParametricBufferGeometry(t,e,i)),this.mergeVertices()}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry;class PlaneGeometry extends Geometry{constructor(t,e,i,s){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:s},this.fromBufferGeometry(new PlaneBufferGeometry(t,e,i,s)),this.mergeVertices()}}class PolyhedronGeometry extends Geometry{constructor(t,e,i,s){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:s},this.fromBufferGeometry(new PolyhedronBufferGeometry(t,e,i,s)),this.mergeVertices()}}class RingBufferGeometry extends BufferGeometry{constructor(t=.5,e=1,i=8,s=1,r=0,n=2*Math.PI){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:s,thetaStart:r,thetaLength:n},i=Math.max(3,i);const a=[],o=[],h=[],c=[];let l=t;const u=(e-t)/(s=Math.max(1,s)),p=new Vector3$1,d=new Vector2;for(let t=0;t<=s;t++){for(let t=0;t<=i;t++){const s=r+t/i*n;p.x=l*Math.cos(s),p.y=l*Math.sin(s),o.push(p.x,p.y,p.z),h.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,c.push(d.x,d.y)}l+=u}for(let t=0;t<s;t++){const e=t*(i+1);for(let t=0;t<i;t++){const s=t+e,r=s,n=s+i+1,o=s+i+2,h=s+1;a.push(r,n,h),a.push(n,o,h)}}this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}}class RingGeometry extends Geometry{constructor(t,e,i,s,r,n){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:s,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new RingBufferGeometry(t,e,i,s,r,n)),this.mergeVertices()}}class ShapeBufferGeometry extends BufferGeometry{constructor(t,e=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],s=[],r=[],n=[];let a=0,o=0;if(!1===Array.isArray(t))h(t);else for(let e=0;e<t.length;e++)h(t[e]),this.addGroup(a,o,e),a+=o,o=0;function h(t){const a=s.length/3,h=t.extractPoints(e);let c=h.shape;const l=h.holes;!1===ShapeUtils.isClockWise(c)&&(c=c.reverse());for(let t=0,e=l.length;t<e;t++){const e=l[t];!0===ShapeUtils.isClockWise(e)&&(l[t]=e.reverse())}const u=ShapeUtils.triangulateShape(c,l);for(let t=0,e=l.length;t<e;t++){const e=l[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];s.push(e.x,e.y,0),r.push(0,0,1),n.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],s=e[0]+a,r=e[1]+a,n=e[2]+a;i.push(s,r,n),o+=3}}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(r,3)),this.setAttribute("uv",new Float32BufferAttribute(n,2))}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return toJSON$2(this.parameters.shapes,t)}}function toJSON$2(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,s=t.length;i<s;i++){const s=t[i];e.shapes.push(s.uuid)}else e.shapes.push(t.uuid);return e}class ShapeGeometry extends Geometry{constructor(t,e){super(),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new ShapeBufferGeometry(t,e)),this.mergeVertices()}toJSON(){const t=Geometry.prototype.toJSON.call(this);return toJSON$3(this.parameters.shapes,t)}}function toJSON$3(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,s=t.length;i<s;i++){const s=t[i];e.shapes.push(s.uuid)}else e.shapes.push(t.uuid);return e}class SphereBufferGeometry extends BufferGeometry{constructor(t=1,e=8,i=6,s=0,r=2*Math.PI,n=0,a=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:s,phiLength:r,thetaStart:n,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(n+a,Math.PI);let h=0;const c=[],l=new Vector3$1,u=new Vector3$1,p=[],d=[],f=[],m=[];for(let p=0;p<=i;p++){const g=[],y=p/i;let v=0;0==p&&0==n?v=.5/e:p==i&&o==Math.PI&&(v=-.5/e);for(let i=0;i<=e;i++){const o=i/e;l.x=-t*Math.cos(s+o*r)*Math.sin(n+y*a),l.y=t*Math.cos(n+y*a),l.z=t*Math.sin(s+o*r)*Math.sin(n+y*a),d.push(l.x,l.y,l.z),u.copy(l).normalize(),f.push(u.x,u.y,u.z),m.push(o+v,1-y),g.push(h++)}c.push(g)}for(let t=0;t<i;t++)for(let s=0;s<e;s++){const e=c[t][s+1],r=c[t][s],a=c[t+1][s],h=c[t+1][s+1];(0!==t||n>0)&&p.push(e,r,h),(t!==i-1||o<Math.PI)&&p.push(r,a,h)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}}class SphereGeometry extends Geometry{constructor(t,e,i,s,r,n,a){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:s,phiLength:r,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new SphereBufferGeometry(t,e,i,s,r,n,a)),this.mergeVertices()}}class TetrahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class TetrahedronGeometry extends Geometry{constructor(t,e){super(),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new TetrahedronBufferGeometry(t,e)),this.mergeVertices()}}class TextBufferGeometry extends ExtrudeBufferGeometry{constructor(t,e={}){const i=e.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new BufferGeometry;const s=i.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(s,e),this.type="TextBufferGeometry"}}class TextGeometry extends Geometry{constructor(t,e){super(),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new TextBufferGeometry(t,e)),this.mergeVertices()}}class TorusBufferGeometry extends BufferGeometry{constructor(t=1,e=.4,i=8,s=6,r=2*Math.PI){super(),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const n=[],a=[],o=[],h=[],c=new Vector3$1,l=new Vector3$1,u=new Vector3$1;for(let n=0;n<=i;n++)for(let p=0;p<=s;p++){const d=p/s*r,f=n/i*Math.PI*2;l.x=(t+e*Math.cos(f))*Math.cos(d),l.y=(t+e*Math.cos(f))*Math.sin(d),l.z=e*Math.sin(f),a.push(l.x,l.y,l.z),c.x=t*Math.cos(d),c.y=t*Math.sin(d),u.subVectors(l,c).normalize(),o.push(u.x,u.y,u.z),h.push(p/s),h.push(n/i)}for(let t=1;t<=i;t++)for(let e=1;e<=s;e++){const i=(s+1)*t+e-1,r=(s+1)*(t-1)+e-1,a=(s+1)*(t-1)+e,o=(s+1)*t+e;n.push(i,r,o),n.push(r,a,o)}this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}}class TorusGeometry extends Geometry{constructor(t,e,i,s,r){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:s,arc:r},this.fromBufferGeometry(new TorusBufferGeometry(t,e,i,s,r)),this.mergeVertices()}}class TorusKnotBufferGeometry extends BufferGeometry{constructor(t=1,e=.4,i=64,s=8,r=2,n=3){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:s,p:r,q:n},i=Math.floor(i),s=Math.floor(s);const a=[],o=[],h=[],c=[],l=new Vector3$1,u=new Vector3$1,p=new Vector3$1,d=new Vector3$1,f=new Vector3$1,m=new Vector3$1,g=new Vector3$1;for(let a=0;a<=i;++a){const v=a/i*r*Math.PI*2;y(v,r,n,t,p),y(v+.01,r,n,t,d),m.subVectors(d,p),g.addVectors(d,p),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=s;++t){const r=t/s*Math.PI*2,n=-e*Math.cos(r),d=e*Math.sin(r);l.x=p.x+(n*g.x+d*f.x),l.y=p.y+(n*g.y+d*f.y),l.z=p.z+(n*g.z+d*f.z),o.push(l.x,l.y,l.z),u.subVectors(l,p).normalize(),h.push(u.x,u.y,u.z),c.push(a/i),c.push(t/s)}}for(let t=1;t<=i;t++)for(let e=1;e<=s;e++){const i=(s+1)*(t-1)+(e-1),r=(s+1)*t+(e-1),n=(s+1)*t+e,o=(s+1)*(t-1)+e;a.push(i,r,o),a.push(r,n,o)}function y(t,e,i,s,r){const n=Math.cos(t),a=Math.sin(t),o=i/e*t,h=Math.cos(o);r.x=s*(2+h)*.5*n,r.y=s*(2+h)*a*.5,r.z=s*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}}class TorusKnotGeometry extends Geometry{constructor(t,e,i,s,r,n,a){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:s,p:r,q:n},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(t,e,i,s,r,n)),this.mergeVertices()}}class TubeBufferGeometry extends BufferGeometry{constructor(t,e=64,i=1,s=8,r=!1){super(),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:s,closed:r};const n=t.computeFrenetFrames(e,r);this.tangents=n.tangents,this.normals=n.normals,this.binormals=n.binormals;const a=new Vector3$1,o=new Vector3$1,h=new Vector2;let c=new Vector3$1;const l=[],u=[],p=[],d=[];function f(r){c=t.getPointAt(r/e,c);const h=n.normals[r],p=n.binormals[r];for(let t=0;t<=s;t++){const e=t/s*Math.PI*2,r=Math.sin(e),n=-Math.cos(e);o.x=n*h.x+r*p.x,o.y=n*h.y+r*p.y,o.z=n*h.z+r*p.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+i*o.x,a.y=c.y+i*o.y,a.z=c.z+i*o.z,l.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=s;i++)h.x=t/e,h.y=i/s,p.push(h.x,h.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=s;e++){const i=(s+1)*(t-1)+(e-1),r=(s+1)*t+(e-1),n=(s+1)*t+e,a=(s+1)*(t-1)+e;d.push(i,r,a),d.push(r,n,a)}}()}(),this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(p,2))}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class TubeGeometry extends Geometry{constructor(t,e,i,s,r,n){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:s,closed:r},void 0!==n&&console.warn("THREE.TubeGeometry: taper has been removed.");const a=new TubeBufferGeometry(t,e,i,s,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}}class WireframeGeometry extends BufferGeometry{constructor(t){super(),this.type="WireframeGeometry";const e=[],i=[0,0],s={},r=["a","b","c"];if(t&&t.isGeometry){const n=t.faces;for(let t=0,e=n.length;t<e;t++){const e=n[t];for(let t=0;t<3;t++){const n=e[r[t]],a=e[r[(t+1)%3]];i[0]=Math.min(n,a),i[1]=Math.max(n,a);const o=i[0]+","+i[1];void 0===s[o]&&(s[o]={index1:i[0],index2:i[1]})}}for(const i in s){const r=s[i];let n=t.vertices[r.index1];e.push(n.x,n.y,n.z),n=t.vertices[r.index2],e.push(n.x,n.y,n.z)}}else if(t&&t.isBufferGeometry){const r=new Vector3$1;if(null!==t.index){const n=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,e=o.length;t<e;++t){const e=o[t],r=e.start;for(let t=r,n=r+e.count;t<n;t+=3)for(let e=0;e<3;e++){const r=a.getX(t+e),n=a.getX(t+(e+1)%3);i[0]=Math.min(r,n),i[1]=Math.max(r,n);const o=i[0]+","+i[1];void 0===s[o]&&(s[o]={index1:i[0],index2:i[1]})}}for(const t in s){const i=s[t];r.fromBufferAttribute(n,i.index1),e.push(r.x,r.y,r.z),r.fromBufferAttribute(n,i.index2),e.push(r.x,r.y,r.z)}}else{const i=t.attributes.position;for(let t=0,s=i.count/3;t<s;t++)for(let s=0;s<3;s++){const n=3*t+s;r.fromBufferAttribute(i,n),e.push(r.x,r.y,r.z);const a=3*t+(s+1)%3;r.fromBufferAttribute(i,a),e.push(r.x,r.y,r.z)}}}this.setAttribute("position",new Float32BufferAttribute(e,3))}}var Geometries=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,WireframeGeometry:WireframeGeometry});function ShadowMaterial(t){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(t)}function RawShaderMaterial(t){ShaderMaterial.call(this,t),this.type="RawShaderMaterial"}function MeshStandardMaterial(t){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function MeshPhysicalMaterial(t){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=MathUtils.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function MeshPhongMaterial(t){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshToonMaterial(t){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshNormalMaterial(t){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshLambertMaterial(t){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshMatcapMaterial(t){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function LineDashedMaterial(t){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(t){return MeshStandardMaterial.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Color).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshToonMaterial.prototype=Object.create(Material.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(t){return LineBasicMaterial.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Materials=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material});const AnimationUtils={arraySlice:function(t,e,i){return AnimationUtils.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort(function(e,i){return t[e]-t[i]}),i},sortedArray:function(t,e,i){const s=t.length,r=new t.constructor(s);for(let n=0,a=0;a!==s;++n){const s=i[n]*e;for(let i=0;i!==e;++i)r[a++]=t[s+i]}return r},flattenJSON:function(t,e,i,s){let r=1,n=t[0];for(;void 0!==n&&void 0===n[s];)n=t[r++];if(void 0===n)return;let a=n[s];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=n[s])&&(e.push(n.time),i.push.apply(i,a)),n=t[r++]}while(void 0!==n);else if(void 0!==a.toArray)do{void 0!==(a=n[s])&&(e.push(n.time),a.toArray(i,i.length)),n=t[r++]}while(void 0!==n);else do{void 0!==(a=n[s])&&(e.push(n.time),i.push(a)),n=t[r++]}while(void 0!==n)},subclip:function(t,e,i,s,r=30){const n=t.clone();n.name=e;const a=[];for(let t=0;t<n.tracks.length;++t){const e=n.tracks[t],o=e.getValueSize(),h=[],c=[];for(let t=0;t<e.times.length;++t){const n=e.times[t]*r;if(!(n<i||n>=s)){h.push(e.times[t]);for(let i=0;i<o;++i)c.push(e.values[t*o+i])}}0!==h.length&&(e.times=AnimationUtils.convertArray(h,e.times.constructor),e.values=AnimationUtils.convertArray(c,e.values.constructor),a.push(e))}n.tracks=a;let o=1/0;for(let t=0;t<n.tracks.length;++t)o>n.tracks[t].times[0]&&(o=n.tracks[t].times[0]);for(let t=0;t<n.tracks.length;++t)n.tracks[t].shift(-1*o);return n.resetDuration(),n},makeClipAdditive:function(t,e=0,i=t,s=30){s<=0&&(s=30);const r=i.tracks.length,n=e/s;for(let e=0;e<r;++e){const s=i.tracks[e],r=s.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find(function(t){return t.name===s.name&&t.ValueTypeName===r});if(void 0===a)continue;let o=0;const h=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=h/3);let c=0;const l=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=l/3);const u=s.times.length-1;let p;if(n<=s.times[0]){const t=o,e=h-o;p=AnimationUtils.arraySlice(s.values,t,e)}else if(n>=s.times[u]){const t=u*h+o,e=t+h-o;p=AnimationUtils.arraySlice(s.values,t,e)}else{const t=s.createInterpolant(),e=o,i=h-o;t.evaluate(n),p=AnimationUtils.arraySlice(t.resultBuffer,e,i)}if("quaternion"===r){(new Quaternion).fromArray(p).normalize().conjugate().toArray(p)}const d=a.times.length;for(let t=0;t<d;++t){const e=t*l+c;if("quaternion"===r)Quaternion.multiplyQuaternionsFlat(a.values,e,p,0,a.values,e);else{const t=l-2*c;for(let i=0;i<t;++i)a.values[e+i]-=p[i]}}}return t.blendMode=AdditiveAnimationBlendMode,t}};function Interpolant(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==s?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function CubicInterpolant(t,e,i,s){Interpolant.call(this,t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(t,e,i,s){Interpolant.call(this,t,e,i,s)}function DiscreteInterpolant(t,e,i,s){Interpolant.call(this,t,e,i,s)}function KeyframeTrack(t,e,i,s){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=AnimationUtils.convertArray(e,this.TimeBufferType),this.values=AnimationUtils.convertArray(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}function BooleanKeyframeTrack(t,e,i){KeyframeTrack.call(this,t,e,i)}function ColorKeyframeTrack(t,e,i,s){KeyframeTrack.call(this,t,e,i,s)}function NumberKeyframeTrack(t,e,i,s){KeyframeTrack.call(this,t,e,i,s)}function QuaternionLinearInterpolant(t,e,i,s){Interpolant.call(this,t,e,i,s)}function QuaternionKeyframeTrack(t,e,i,s){KeyframeTrack.call(this,t,e,i,s)}function StringKeyframeTrack(t,e,i,s){KeyframeTrack.call(this,t,e,i,s)}function VectorKeyframeTrack(t,e,i,s){KeyframeTrack.call(this,t,e,i,s)}function AnimationClip(t,e=-1,i,s=NormalAnimationBlendMode){this.name=t,this.tracks=i,this.duration=e,this.blendMode=s,this.uuid=MathUtils.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=getTrackTypeForValueTypeName(t.type);if(void 0===t.times){const e=[],i=[];AnimationUtils.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(Interpolant.prototype,{evaluate:function(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],r=e[i-1];t:{e:{let n;i:{s:if(!(t<s)){for(let n=i+2;;){if(void 0===s){if(t<r)break s;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===n)break;if(r=s,t<(s=e[++i]))break e}n=e.length;break i}if(t>=r)break t;{const a=e[1];t<a&&(i=2,r=a);for(let n=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,s);if(i===n)break;if(s=r,t>=(r=e[--i-1]))break e}n=i,i=0}}for(;i<n;){const s=i+n>>>1;t<e[s]?n=s:i=s+1}if(s=e[i],void 0===(r=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,s);if(void 0===s)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,t,s)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s;for(let t=0;t!==s;++t)e[t]=i[r+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(t,e,i){const s=this.parameterPositions;let r=t-2,n=t+1,a=s[r],o=s[n];if(void 0===a)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:r=t,a=2*e-i;break;case WrapAroundEnding:a=e+s[r=s.length-2]-s[r+1];break;default:r=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:n=t,o=2*i-e;break;case WrapAroundEnding:n=1,o=i+s[1]-s[0];break;default:n=t-1,o=e}const h=.5*(i-e),c=this.valueSize;this._weightPrev=h/(e-a),this._weightNext=h/(o-i),this._offsetPrev=r*c,this._offsetNext=n*c},interpolate_:function(t,e,i,s){const r=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=t*a,h=o-a,c=this._offsetPrev,l=this._offsetNext,u=this._weightPrev,p=this._weightNext,d=(i-e)/(s-e),f=d*d,m=f*d,g=-u*m+2*u*f-u*d,y=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*d+1,v=(-1-p)*m+(1.5+p)*f+.5*d,b=p*m-p*f;for(let t=0;t!==a;++t)r[t]=g*n[c+t]+y*n[h+t]+v*n[o+t]+b*n[l+t];return r}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(t,e,i,s){const r=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=t*a,h=o-a,c=(i-e)/(s-e),l=1-c;for(let t=0;t!==a;++t)r[t]=n[h+t]*l+n[o+t]*c;return r}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(KeyframeTrack,{toJSON:function(t){const e=t.constructor;let i;if(void 0!==e.toJSON)i=e.toJSON(t);else{i={name:t.name,times:AnimationUtils.convertArray(t.times,Array),values:AnimationUtils.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this},trim:function(t,e){const i=this.times,s=i.length;let r=0,n=s-1;for(;r!==s&&i[r]<t;)++r;for(;-1!==n&&i[n]>e;)--n;if(++n,0!==r||n!==s){r>=n&&(r=(n=Math.max(n,1))-1);const t=this.getValueSize();this.times=AnimationUtils.arraySlice(i,r,n),this.values=AnimationUtils.arraySlice(this.values,r*t,n*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let n=null;for(let e=0;e!==r;e++){const s=i[e];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,s),t=!1;break}if(null!==n&&n>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,s,n),t=!1;break}n=s}if(void 0!==s&&AnimationUtils.isTypedArray(s))for(let e=0,i=s.length;e!==i;++e){const i=s[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t},optimize:function(){const t=AnimationUtils.arraySlice(this.times),e=AnimationUtils.arraySlice(this.values),i=this.getValueSize(),s=2302===this.getInterpolation(),r=t.length-1;let n=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==o[0]))if(s)r=!0;else{const t=a*i,s=t-i,n=t+i;for(let a=0;a!==i;++a){const i=e[t+a];if(i!==e[s+a]||i!==e[n+a]){r=!0;break}}}if(r){if(a!==n){t[n]=t[a];const s=a*i,r=n*i;for(let t=0;t!==i;++t)e[r+t]=e[s+t]}++n}}if(r>0){t[n]=t[r];for(let t=r*i,s=n*i,a=0;a!==i;++a)e[s+a]=e[t+a];++n}return n!==t.length?(this.times=AnimationUtils.arraySlice(t,0,n),this.values=AnimationUtils.arraySlice(e,0,n*i)):(this.times=t,this.values=e),this},clone:function(){const t=AnimationUtils.arraySlice(this.times,0),e=AnimationUtils.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(t,e,i,s){const r=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=(i-e)/(s-e);let h=t*a;for(let t=h+a;h!==t;h+=4)Quaternion.slerpFlat(r,0,n,h-a,n,h,o);return r}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(t){const e=[],i=t.tracks,s=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(parseKeyframeTrack(i[t]).scale(s));const r=new AnimationClip(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r},toJSON:function(t){const e=[],i=t.tracks,s={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,s=i.length;t!==s;++t)e.push(KeyframeTrack.toJSON(i[t]));return s},CreateFromMorphTargetSequence:function(t,e,i,s){const r=e.length,n=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const h=AnimationUtils.getKeyframeOrder(a);a=AnimationUtils.sortedArray(a,1,h),o=AnimationUtils.sortedArray(o,1,h),s||0!==a[0]||(a.push(r),o.push(o[0])),n.push(new NumberKeyframeTrack(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/i))}return new AnimationClip(t,-1,n)},findByName:function(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],n=i.name.match(r);if(n&&n.length>1){const t=n[1];let e=s[t];e||(s[t]=e=[]),e.push(i)}}const n=[];for(const t in s)n.push(AnimationClip.CreateFromMorphTargetSequence(t,s[t],e,i));return n},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,s,r){if(0!==i.length){const n=[],a=[];AnimationUtils.flattenJSON(i,n,a,s),0!==n.length&&r.push(new t(e,n,a))}},s=[],r=t.name||"default",n=t.fps||30,a=t.blendMode;let o=t.length||-1;const h=t.hierarchy||[];for(let t=0;t<h.length;t++){const r=h[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],n=[];for(let s=0;s!==r[e].morphTargets.length;++s){const s=r[e];t.push(s.time),n.push(s.morphTarget===i?1:0)}s.push(new NumberKeyframeTrack(".morphTargetInfluence["+i+"]",t,n))}o=t.length*(n||1)}else{const n=".bones["+e[t].name+"]";i(VectorKeyframeTrack,n+".position",r,"pos",s),i(QuaternionKeyframeTrack,n+".quaternion",r,"rot",s),i(VectorKeyframeTrack,n+".scale",r,"scl",s)}}return 0===s.length?null:new AnimationClip(r,o,s,a)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new AnimationClip(this.name,this.duration,t,this.blendMode)},toJSON:function(){return AnimationClip.toJSON(this)}});const Cache={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function LoadingManager(t,e,i){const s=this;let r=!1,n=0,a=0,o=void 0;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===r&&void 0!==s.onStart&&s.onStart(t,n,a),r=!0},this.itemEnd=function(t){n++,void 0!==s.onProgress&&s.onProgress(t,n,a),n===a&&(r=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(t){void 0!==s.onError&&s.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this},this.addHandler=function(t,e){return h.push(t,e),this},this.removeHandler=function(t){const e=h.indexOf(t);return-1!==e&&h.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=h.length;e<i;e+=2){const i=h[e],s=h[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return s}return null}}const DefaultLoadingManager=new LoadingManager;function Loader(t){this.manager=void 0!==t?t:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(t,e){const i=this;return new Promise(function(s,r){i.load(t,s,e,r)})},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const loading={};function FileLoader(t){Loader.call(this,t)}function AnimationLoader(t){Loader.call(this,t)}function CompressedTextureLoader(t){Loader.call(this,t)}function ImageLoader(t){Loader.call(this,t)}function CubeTextureLoader(t){Loader.call(this,t)}function DataTextureLoader(t){Loader.call(this,t)}function TextureLoader(t){Loader.call(this,t)}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(t,e,i,s,r,n,a,o){Curve.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=i||1,this.yRadius=s||1,this.aStartAngle=r||0,this.aEndAngle=n||2*Math.PI,this.aClockwise=a||!1,this.aRotation=o||0}function ArcCurve(t,e,i,s,r,n){EllipseCurve.call(this,t,e,i,i,s,r,n),this.type="ArcCurve"}function CubicPoly(){let t=0,e=0,i=0,s=0;function r(r,n,a,o){t=r,e=a,i=-3*r+3*n-2*a-o,s=2*r-2*n+a+o}return{initCatmullRom:function(t,e,i,s,n){r(e,i,n*(i-t),n*(s-e))},initNonuniformCatmullRom:function(t,e,i,s,n,a,o){let h=(e-t)/n-(i-t)/(n+a)+(i-e)/a,c=(i-e)/a-(s-e)/(a+o)+(s-i)/o;r(e,i,h*=a,c*=a)},calc:function(r){const n=r*r;return t+e*r+i*n+s*(n*r)}}}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(t,e,i,s){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,n=Cache.get(t);if(void 0!==n)return r.manager.itemStart(t),setTimeout(function(){e&&e(n),r.manager.itemEnd(t)},0),n;if(void 0!==loading[t])return void loading[t].push({onLoad:e,onProgress:i,onError:s});const a=t.match(/^data:(.*?)(;base64)?,(.*)$/);let o;if(a){const i=a[1],n=!!a[2];let o=a[3];o=decodeURIComponent(o),n&&(o=atob(o));try{let n;const a=(this.responseType||"").toLowerCase();switch(a){case"arraybuffer":case"blob":const t=new Uint8Array(o.length);for(let e=0;e<o.length;e++)t[e]=o.charCodeAt(e);n="blob"===a?new Blob([t.buffer],{type:i}):t.buffer;break;case"document":const e=new DOMParser;n=e.parseFromString(o,i);break;case"json":n=JSON.parse(o);break;default:n=o}setTimeout(function(){e&&e(n),r.manager.itemEnd(t)},0)}catch(e){setTimeout(function(){s&&s(e),r.manager.itemError(t),r.manager.itemEnd(t)},0)}}else{loading[t]=[],loading[t].push({onLoad:e,onProgress:i,onError:s}),(o=new XMLHttpRequest).open("GET",t,!0),o.addEventListener("load",function(e){const i=this.response,s=loading[t];if(delete loading[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(t,i);for(let t=0,e=s.length;t<e;t++){const e=s[t];e.onLoad&&e.onLoad(i)}r.manager.itemEnd(t)}else{for(let t=0,i=s.length;t<i;t++){const i=s[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}},!1),o.addEventListener("progress",function(e){const i=loading[t];for(let t=0,s=i.length;t<s;t++){const s=i[t];s.onProgress&&s.onProgress(e)}},!1),o.addEventListener("error",function(e){const i=loading[t];delete loading[t];for(let t=0,s=i.length;t<s;t++){const s=i[t];s.onError&&s.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),o.addEventListener("abort",function(e){const i=loading[t];delete loading[t];for(let t=0,s=i.length;t<s;t++){const s=i[t];s.onError&&s.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)o.setRequestHeader(t,this.requestHeader[t]);o.send(null)}return r.manager.itemStart(t),o},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(t,e,i,s){const r=this,n=new FileLoader(r.manager);n.setPath(r.path),n.setRequestHeader(r.requestHeader),n.setWithCredentials(r.withCredentials),n.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){s?s(e):console.error(e),r.manager.itemError(t)}},i,s)},parse:function(t){const e=[];for(let i=0;i<t.length;i++){const s=AnimationClip.parse(t[i]);e.push(s)}return e}}),CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(t,e,i,s){const r=this,n=[],a=new CompressedTexture,o=new FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let h=0;function c(c){o.load(t[c],function(t){const i=r.parse(t,!0);n[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(h+=1)&&(1===i.mipmapCount&&(a.minFilter=LinearFilter),a.image=n,a.format=i.format,a.needsUpdate=!0,e&&e(a))},i,s)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)c(e);else o.load(t,function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){n[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)n[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),n[e].format=i.format,n[e].width=i.width,n[e].height=i.height}a.image=n}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=LinearFilter),a.format=i.format,a.needsUpdate=!0,e&&e(a)},i,s);return a}}),ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(t,e,i,s){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,n=Cache.get(t);if(void 0!==n)return r.manager.itemStart(t),setTimeout(function(){e&&e(n),r.manager.itemEnd(t)},0),n;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",h,!1),Cache.add(t,this),e&&e(this),r.manager.itemEnd(t)}function h(e){a.removeEventListener("load",o,!1),a.removeEventListener("error",h,!1),s&&s(e),r.manager.itemError(t),r.manager.itemEnd(t)}return a.addEventListener("load",o,!1),a.addEventListener("error",h,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}),CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(t,e,i,s){const r=new CubeTexture,n=new ImageLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);let a=0;function o(i){n.load(t[i],function(t){r.images[i]=t,6===++a&&(r.needsUpdate=!0,e&&e(r))},void 0,s)}for(let e=0;e<t.length;++e)o(e);return r}}),DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(t,e,i,s){const r=this,n=new DataTexture,a=new FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,function(t){const i=r.parse(t);i&&(void 0!==i.image?n.image=i.image:void 0!==i.data&&(n.image.width=i.width,n.image.height=i.height,n.image.data=i.data),n.wrapS=void 0!==i.wrapS?i.wrapS:ClampToEdgeWrapping,n.wrapT=void 0!==i.wrapT?i.wrapT:ClampToEdgeWrapping,n.magFilter=void 0!==i.magFilter?i.magFilter:LinearFilter,n.minFilter=void 0!==i.minFilter?i.minFilter:LinearFilter,n.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(n.format=i.format),void 0!==i.type&&(n.type=i.type),void 0!==i.mipmaps&&(n.mipmaps=i.mipmaps,n.minFilter=LinearMipmapLinearFilter),1===i.mipmapCount&&(n.minFilter=LinearFilter),n.needsUpdate=!0,e&&e(n,i))},i,s),n}}),TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(t,e,i,s){const r=new Texture,n=new ImageLoader(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(t,function(i){r.image=i;const s=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=s?RGBFormat:RGBAFormat,r.needsUpdate=!0,void 0!==e&&e(r)},i,s),r}}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)},getPoints:function(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,s=this.getPoint(0),r=0;e.push(0);for(let n=1;n<=t;n++)r+=(i=this.getPoint(n/t)).distanceTo(s),e.push(r),s=i;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const i=this.getLengths();let s=0;const r=i.length;let n;n=e||t*i[r-1];let a,o=0,h=r-1;for(;o<=h;)if((a=i[s=Math.floor(o+(h-o)/2)]-n)<0)o=s+1;else{if(!(a>0)){h=s;break}h=s-1}if(i[s=h]===n)return s/(r-1);const c=i[s];return(s+(n-c)/(i[s+1]-c))/(r-1)},getTangent:function(t,e){let i=t-1e-4,s=t+1e-4;i<0&&(i=0),s>1&&(s=1);const r=this.getPoint(i),n=this.getPoint(s),a=e||(r.isVector2?new Vector2:new Vector3$1);return a.copy(n).sub(r).normalize(),a},getTangentAt:function(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)},computeFrenetFrames:function(t,e){const i=new Vector3$1,s=[],r=[],n=[],a=new Vector3$1,o=new Matrix4;for(let e=0;e<=t;e++){const i=e/t;s[e]=this.getTangentAt(i,new Vector3$1),s[e].normalize()}r[0]=new Vector3$1,n[0]=new Vector3$1;let h=Number.MAX_VALUE;const c=Math.abs(s[0].x),l=Math.abs(s[0].y),u=Math.abs(s[0].z);c<=h&&(h=c,i.set(1,0,0)),l<=h&&(h=l,i.set(0,1,0)),u<=h&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],a),n[0].crossVectors(s[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),n[e]=n[e-1].clone(),a.crossVectors(s[e-1],s[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(MathUtils.clamp(s[e-1].dot(s[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}n[e].crossVectors(s[e],r[e])}if(!0===e){let e=Math.acos(MathUtils.clamp(r[0].dot(r[t]),-1,1));e/=t,s[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(s[i],e*i)),n[i].crossVectors(s[i],r[i])}return{tangents:s,normals:r,binormals:n}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(t,e){const i=e||new Vector2,s=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const n=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(r=n?0:s),!0!==this.aClockwise||n||(r===s?r=-s:r-=s);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),h=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,s=h-this.aY;o=i*t-s*e+this.aX,h=i*e+s*t+this.aY}return i.set(o,h)},EllipseCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},EllipseCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},EllipseCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;const tmp=new Vector3$1,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(t=[],e=!1,i="centripetal",s=.5){Curve.call(this),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=s}function CatmullRom(t,e,i,s,r){const n=.5*(s-e),a=.5*(r-i),o=t*t;return(2*i-2*s+n+a)*(t*o)+(-3*i+3*s-2*n-a)*o+n*t+i}function QuadraticBezierP0(t,e){const i=1-t;return i*i*e}function QuadraticBezierP1(t,e){return 2*(1-t)*t*e}function QuadraticBezierP2(t,e){return t*t*e}function QuadraticBezier(t,e,i,s){return QuadraticBezierP0(t,e)+QuadraticBezierP1(t,i)+QuadraticBezierP2(t,s)}function CubicBezierP0(t,e){const i=1-t;return i*i*i*e}function CubicBezierP1(t,e){const i=1-t;return 3*i*i*t*e}function CubicBezierP2(t,e){return 3*(1-t)*t*t*e}function CubicBezierP3(t,e){return t*t*t*e}function CubicBezier(t,e,i,s,r){return CubicBezierP0(t,e)+CubicBezierP1(t,i)+CubicBezierP2(t,s)+CubicBezierP3(t,r)}function CubicBezierCurve(t=new Vector2,e=new Vector2,i=new Vector2,s=new Vector2){Curve.call(this),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=s}function CubicBezierCurve3(t=new Vector3$1,e=new Vector3$1,i=new Vector3$1,s=new Vector3$1){Curve.call(this),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=s}function LineCurve(t=new Vector2,e=new Vector2){Curve.call(this),this.type="LineCurve",this.v1=t,this.v2=e}function LineCurve3(t=new Vector3$1,e=new Vector3$1){Curve.call(this),this.type="LineCurve3",this.v1=t,this.v2=e}function QuadraticBezierCurve(t=new Vector2,e=new Vector2,i=new Vector2){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}function QuadraticBezierCurve3(t=new Vector3$1,e=new Vector3$1,i=new Vector3$1){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}function SplineCurve(t=[]){Curve.call(this),this.type="SplineCurve",this.points=t}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(t,e=new Vector3$1){const i=e,s=this.points,r=s.length,n=(r-(this.closed?0:1))*t;let a,o,h=Math.floor(n),c=n-h;this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/r)+1)*r:0===c&&h===r-1&&(h=r-2,c=1),this.closed||h>0?a=s[(h-1)%r]:(tmp.subVectors(s[0],s[1]).add(s[0]),a=tmp);const l=s[h%r],u=s[(h+1)%r];if(this.closed||h+2<r?o=s[(h+2)%r]:(tmp.subVectors(s[r-1],s[r-2]).add(s[r-1]),o=tmp),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(l),t),i=Math.pow(l.distanceToSquared(u),t),s=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),s<1e-4&&(s=i),px.initNonuniformCatmullRom(a.x,l.x,u.x,o.x,e,i,s),py.initNonuniformCatmullRom(a.y,l.y,u.y,o.y,e,i,s),pz.initNonuniformCatmullRom(a.z,l.z,u.z,o.z,e,i,s)}else"catmullrom"===this.curveType&&(px.initCatmullRom(a.x,l.x,u.x,o.x,this.tension),py.initCatmullRom(a.y,l.y,u.y,o.y,this.tension),pz.initCatmullRom(a.z,l.z,u.z,o.z,this.tension));return i.set(px.calc(c),py.calc(c),pz.calc(c)),i},CatmullRomCurve3.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CatmullRomCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},CatmullRomCurve3.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Vector3$1).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(t,e=new Vector2){const i=e,s=this.v0,r=this.v1,n=this.v2,a=this.v3;return i.set(CubicBezier(t,s.x,r.x,n.x,a.x),CubicBezier(t,s.y,r.y,n.y,a.y)),i},CubicBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(t,e=new Vector3$1){const i=e,s=this.v0,r=this.v1,n=this.v2,a=this.v3;return i.set(CubicBezier(t,s.x,r.x,n.x,a.x),CubicBezier(t,s.y,r.y,n.y,a.y),CubicBezier(t,s.z,r.z,n.z,a.z)),i},CubicBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(t,e=new Vector2){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},LineCurve.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},LineCurve.prototype.getTangent=function(t,e){const i=e||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i},LineCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(t,e=new Vector3$1){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},LineCurve3.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},LineCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(t,e=new Vector2){const i=e,s=this.v0,r=this.v1,n=this.v2;return i.set(QuadraticBezier(t,s.x,r.x,n.x),QuadraticBezier(t,s.y,r.y,n.y)),i},QuadraticBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(t,e=new Vector3$1){const i=e,s=this.v0,r=this.v1,n=this.v2;return i.set(QuadraticBezier(t,s.x,r.x,n.x),QuadraticBezier(t,s.y,r.y,n.y),QuadraticBezier(t,s.z,r.z,n.z)),i},QuadraticBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(t,e=new Vector2){const i=e,s=this.points,r=(s.length-1)*t,n=Math.floor(r),a=r-n,o=s[0===n?n:n-1],h=s[n],c=s[n>s.length-2?s.length-1:n+1],l=s[n>s.length-3?s.length-1:n+2];return i.set(CatmullRom(a,o.x,h.x,c.x,l.x),CatmullRom(a,o.y,h.y,c.y,l.y)),i},SplineCurve.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this},SplineCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t},SplineCurve.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Vector2).fromArray(i))}return this};var Curves=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(t){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}function Shape(t){Path.call(this,t),this.uuid=MathUtils.generateUUID(),this.type="Shape",this.holes=[]}function Light(t,e=1){Object3D.call(this),this.type="Light",this.color=new Color(t),this.intensity=e}function HemisphereLight(t,e,i){Light.call(this,t,i),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(e)}function LightShadow(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500)),this.focus=1}function SpotLight(t,e,i,s,r,n){Light.call(this,t,e),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==s?s:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new SpotLightShadow}function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3$1(1,0,0),new Vector3$1(-1,0,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1),new Vector3$1(0,1,0),new Vector3$1(0,-1,0)],this._cubeUps=[new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1)]}function PointLight(t,e,i,s){Light.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==s?s:1,this.shadow=new PointLightShadow}function OrthographicCamera(t=-1,e=1,i=1,s=-1,r=.1,n=2e3){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=n,this.updateProjectionMatrix()}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(t,e){Light.call(this,t,e),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(t,e){Light.call(this,t,e),this.type="AmbientLight"}function RectAreaLight(t,e,i,s){Light.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==s?s:10}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new LineCurve(e,t))},getPoint:function(t){const e=t*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=e){const t=i[s]-e,r=this.curves[s],n=r.getLength(),a=0===n?0:1-t/n;return r.getPointAt(a)}s++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,s=this.curves.length;i<s;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t=12){const e=[];let i;for(let s=0,r=this.curves;s<r.length;s++){const n=r[s],a=n&&n.isEllipseCurve?2*t:n&&(n.isLineCurve||n.isLineCurve3)?1:n&&n.isSplineCurve?t*n.points.length:t,o=n.getPoints(a);for(let t=0;t<o.length;t++){const s=o[t];i&&i.equals(s)||(e.push(s),i=s)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Curve.prototype.copy.call(this,t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Curve.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t},fromJSON:function(t){Curve.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Curves[i.type]).fromJSON(i))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const i=new LineCurve(this.currentPoint.clone(),new Vector2(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,i,s){const r=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(i,s));return this.curves.push(r),this.currentPoint.set(i,s),this},bezierCurveTo:function(t,e,i,s,r,n){const a=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(i,s),new Vector2(r,n));return this.curves.push(a),this.currentPoint.set(r,n),this},splineThru:function(t){const e=new SplineCurve([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,i,s,r,n){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,s,r,n),this},absarc:function(t,e,i,s,r,n){return this.absellipse(t,e,i,i,s,r,n),this},ellipse:function(t,e,i,s,r,n,a,o){const h=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+h,e+c,i,s,r,n,a,o),this},absellipse:function(t,e,i,s,r,n,a,o){const h=new EllipseCurve(t,e,i,s,r,n,a,o);if(this.curves.length>0){const t=h.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(h);const c=h.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return CurvePath.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=CurvePath.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return CurvePath.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(t){const e=[];for(let i=0,s=this.holes.length;i<s;i++)e[i]=this.holes[i].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Path.prototype.copy.call(this,t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this},toJSON:function(){const t=Path.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t},fromJSON:function(t){Path.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Path).fromJSON(i))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3$1,_lookTarget:new Vector3$1,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,i=this.matrix,s=this._projScreenMatrix,r=this._lookTarget,n=this._lightPositionWorld;n.setFromMatrixPosition(t.matrixWorld),e.position.copy(n),r.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),s.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,i=2*MathUtils.RAD2DEG*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&s===e.aspect&&r===e.far||(e.fov=i,e.aspect=s,e.far=r,e.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,t)}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(t,e=0){const i=this.camera,s=this.matrix,r=this._lightPositionWorld,n=this._lookTarget,a=this._projScreenMatrix;r.setFromMatrixPosition(t.matrixWorld),i.position.copy(r),n.copy(i.position),n.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(n),i.updateMatrixWorld(),s.makeTranslation(-r.x,-r.y,-r.z),a.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(t,e){return Camera.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,s,r,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,n=i+t,a=s+e,o=s-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n=(r+=t*this.view.offsetX)+t*this.view.width,o=(a-=e*this.view.offsetY)-e*this.view.height}this.projectionMatrix.makeOrthographic(r,n,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=Object3D.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(t){LightShadow.prototype.updateMatrices.call(this,t)}}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=Light.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});class SphericalHarmonics3{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3$1)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,s=t.y,r=t.z,n=this.coefficients;return e.copy(n[0]).multiplyScalar(.282095),e.addScaledVector(n[1],.488603*s),e.addScaledVector(n[2],.488603*r),e.addScaledVector(n[3],.488603*i),e.addScaledVector(n[4],i*s*1.092548),e.addScaledVector(n[5],s*r*1.092548),e.addScaledVector(n[6],.315392*(3*r*r-1)),e.addScaledVector(n[7],i*r*1.092548),e.addScaledVector(n[8],.546274*(i*i-s*s)),e}getIrradianceAt(t,e){const i=t.x,s=t.y,r=t.z,n=this.coefficients;return e.copy(n[0]).multiplyScalar(.886227),e.addScaledVector(n[1],1.023328*s),e.addScaledVector(n[2],1.023328*r),e.addScaledVector(n[3],1.023328*i),e.addScaledVector(n[4],.858086*i*s),e.addScaledVector(n[5],.858086*s*r),e.addScaledVector(n[6],.743125*r*r-.247708),e.addScaledVector(n[7],.858086*i*r),e.addScaledVector(n[8],.429043*(i*i-s*s)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(t,e+3*s);return this}toArray(t=[],e=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(t,e+3*s);return t}static getBasisAt(t,e){const i=t.x,s=t.y,r=t.z;e[0]=.282095,e[1]=.488603*s,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*s,e[5]=1.092548*s*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-s*s)}}function LightProbe(t,e){Light.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new SphericalHarmonics3}function MaterialLoader(t){Loader.call(this,t),this.textures={}}LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=Light.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(t,e,i,s){const r=this,n=new FileLoader(r.manager);n.setPath(r.path),n.setRequestHeader(r.requestHeader),n.setWithCredentials(r.withCredentials),n.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){s?s(e):console.error(e),r.manager.itemError(t)}},i,s)},parse:function(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const s=new Materials[t.type];if(void 0!==t.uuid&&(s.uuid=t.uuid),void 0!==t.name&&(s.name=t.name),void 0!==t.color&&void 0!==s.color&&s.color.setHex(t.color),void 0!==t.roughness&&(s.roughness=t.roughness),void 0!==t.metalness&&(s.metalness=t.metalness),void 0!==t.sheen&&(s.sheen=(new Color).setHex(t.sheen)),void 0!==t.emissive&&void 0!==s.emissive&&s.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==s.specular&&s.specular.setHex(t.specular),void 0!==t.shininess&&(s.shininess=t.shininess),void 0!==t.clearcoat&&(s.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(s.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(s.fog=t.fog),void 0!==t.flatShading&&(s.flatShading=t.flatShading),void 0!==t.blending&&(s.blending=t.blending),void 0!==t.combine&&(s.combine=t.combine),void 0!==t.side&&(s.side=t.side),void 0!==t.opacity&&(s.opacity=t.opacity),void 0!==t.transparent&&(s.transparent=t.transparent),void 0!==t.alphaTest&&(s.alphaTest=t.alphaTest),void 0!==t.depthTest&&(s.depthTest=t.depthTest),void 0!==t.depthWrite&&(s.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(s.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(s.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(s.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(s.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(s.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(s.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(s.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(s.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(s.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(s.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(s.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(s.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(s.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(s.rotation=t.rotation),1!==t.linewidth&&(s.linewidth=t.linewidth),void 0!==t.dashSize&&(s.dashSize=t.dashSize),void 0!==t.gapSize&&(s.gapSize=t.gapSize),void 0!==t.scale&&(s.scale=t.scale),void 0!==t.polygonOffset&&(s.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(s.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(s.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(s.skinning=t.skinning),void 0!==t.morphTargets&&(s.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(s.morphNormals=t.morphNormals),void 0!==t.dithering&&(s.dithering=t.dithering),void 0!==t.vertexTangents&&(s.vertexTangents=t.vertexTangents),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.toneMapped&&(s.toneMapped=t.toneMapped),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?s.vertexColors=t.vertexColors>0:s.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(s.uniforms[e]={},r.type){case"t":s.uniforms[e].value=i(r.value);break;case"c":s.uniforms[e].value=(new Color).setHex(r.value);break;case"v2":s.uniforms[e].value=(new Vector2).fromArray(r.value);break;case"v3":s.uniforms[e].value=(new Vector3$1).fromArray(r.value);break;case"v4":s.uniforms[e].value=(new Vector4).fromArray(r.value);break;case"m3":s.uniforms[e].value=(new Matrix3).fromArray(r.value);break;case"m4":s.uniforms[e].value=(new Matrix4).fromArray(r.value);break;default:s.uniforms[e].value=r.value}}if(void 0!==t.defines&&(s.defines=t.defines),void 0!==t.vertexShader&&(s.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(s.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)s.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(s.flatShading=1===t.shading),void 0!==t.size&&(s.size=t.size),void 0!==t.sizeAttenuation&&(s.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(s.map=i(t.map)),void 0!==t.matcap&&(s.matcap=i(t.matcap)),void 0!==t.alphaMap&&(s.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(s.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(s.bumpScale=t.bumpScale),void 0!==t.normalMap&&(s.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(s.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),s.normalScale=(new Vector2).fromArray(e)}return void 0!==t.displacementMap&&(s.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(s.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(s.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(s.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(s.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(s.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(s.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(s.specularMap=i(t.specularMap)),void 0!==t.envMap&&(s.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(s.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(s.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(s.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(s.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(s.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(s.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(s.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(s.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(s.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(s.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(s.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(s.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(s.transmission=t.transmission),void 0!==t.transmissionMap&&(s.transmissionMap=i(t.transmissionMap)),s},setTextures:function(t){return this.textures=t,this}});const LoaderUtils={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,s=t.length;i<s;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function InstancedBufferAttribute(t,e,i,s){"number"==typeof i&&(s=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,t,e,i),this.meshPerAttribute=s||1}function BufferGeometryLoader(t){Loader.call(this,t)}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(t){return BufferGeometry.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=BufferGeometry.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(t){return BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=BufferAttribute.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(t,e,i,s){const r=this,n=new FileLoader(r.manager);n.setPath(r.path),n.setRequestHeader(r.requestHeader),n.setWithCredentials(r.withCredentials),n.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){s?s(e):console.error(e),r.manager.itemError(t)}},i,s)},parse:function(t){const e={},i={};function s(t,s){if(void 0!==e[s])return e[s];const r=t.interleavedBuffers[s],n=function(t,e){if(void 0!==i[e])return i[e];const s=t.arrayBuffers[e],r=new Uint32Array(s).buffer;return i[e]=r,r}(t,r.buffer),a=new InterleavedBuffer(getTypedArray(r.type,n),r.stride);return a.uuid=r.uuid,e[s]=a,a}const r=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,n=t.data.index;if(void 0!==n){const t=getTypedArray(n.type,n.array);r.setIndex(new BufferAttribute(t,1))}const a=t.data.attributes;for(const e in a){const i=a[e];let n;if(i.isInterleavedBufferAttribute){n=new InterleavedBufferAttribute(s(t.data,i.data),i.itemSize,i.offset,i.normalized)}else{const t=getTypedArray(i.type,i.array);n=new(i.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(t,i.itemSize,i.normalized)}void 0!==i.name&&(n.name=i.name),r.setAttribute(e,n)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],n=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let a;if(r.isInterleavedBufferAttribute){a=new InterleavedBufferAttribute(s(t.data,r.data),r.itemSize,r.offset,r.normalized)}else{a=new BufferAttribute(getTypedArray(r.type,r.array),r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),n.push(a)}r.morphAttributes[e]=n}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==h)for(let t=0,e=h.length;t!==e;++t){const e=h[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new Vector3$1;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new Sphere(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}});class ObjectLoader extends Loader{constructor(t){super(t)}load(t,e,i,s){const r=this,n=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const a=new FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(i){let n=null;try{n=JSON.parse(i)}catch(e){return void 0!==s&&s(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=n.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(n,e):console.error("THREE.ObjectLoader: Can't load "+t)},i,s)}parse(t,e){const i=this.parseAnimations(t.animations),s=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,s),n=this.parseImages(t.images,function(){void 0!==e&&e(h)}),a=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,a),h=this.parseObject(t.object,r,o,i),c=this.parseSkeletons(t.skeletons,h);if(this.bindSkeletons(h,c),void 0!==e){let t=!1;for(const e in n)if(n[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(h)}return h}parseShapes(t){const e={};if(void 0!==t)for(let i=0,s=t.length;i<s;i++){const s=(new Shape).fromJSON(t[i]);e[s.uuid]=s}return e}parseSkeletons(t,e){const i={},s={};if(e.traverse(function(t){t.isBone&&(s[t.uuid]=t)}),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Skeleton).fromJSON(t[e],s);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};let s;if(void 0!==t){const r=new BufferGeometryLoader;for(let n=0,a=t.length;n<a;n++){let a;const o=t[n];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Geometries[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Geometries[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Geometries[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Geometries[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Geometries[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Geometries[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Geometries[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Geometries[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Geometries[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Geometries[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Geometries[o.type]((new Curves[o.path.type]).fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Geometries[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Geometries[o.type](o.vertices,o.indices,o.radius,o.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":s=[];for(let t=0,i=o.shapes.length;t<i;t++){const i=e[o.shapes[t]];s.push(i)}a=new Geometries[o.type](s,o.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":s=[];for(let t=0,i=o.shapes.length;t<i;t++){const i=e[o.shapes[t]];s.push(i)}const t=o.options.extrudePath;void 0!==t&&(o.options.extrudePath=(new Curves[t.type]).fromJSON(t)),a=new Geometries[o.type](s,o.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(o);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),!0===a.isBufferGeometry&&void 0!==o.userData&&(a.userData=o.userData),i[o.uuid]=a}}return i}parseMaterials(t,e){const i={},s={};if(void 0!==t){const r=new MaterialLoader;r.setTextures(e);for(let e=0,n=t.length;e<n;e++){const n=t[e];if("MultiMaterial"===n.type){const t=[];for(let e=0;e<n.materials.length;e++){const s=n.materials[e];void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),t.push(i[s.uuid])}s[n.uuid]=t}else void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),s[n.uuid]=i[n.uuid]}}return s}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const s=t[i],r=AnimationClip.parse(s);e[r.uuid]=r}return e}parseImages(t,e){const i=this,s={};let r;function n(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),r.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemError(t),i.manager.itemEnd(t)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new LoadingManager(e);(r=new ImageLoader(i)).setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){s[i.uuid]=[];for(let t=0,e=r.length;t<e;t++){const e=n(r[t]);null!==e&&(e instanceof HTMLImageElement?s[i.uuid].push(e):s[i.uuid].push(new DataTexture(e.data,e.width,e.height)))}}else{const t=n(i.url);null!==t&&(s[i.uuid]=t)}}}return s}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const s={};if(void 0!==t)for(let r=0,n=t.length;r<n;r++){const n=t[r];let a;void 0===n.image&&console.warn('THREE.ObjectLoader: No "image" specified for',n.uuid),void 0===e[n.image]&&console.warn("THREE.ObjectLoader: Undefined image",n.image);const o=e[n.image];Array.isArray(o)?(a=new CubeTexture(o),6===o.length&&(a.needsUpdate=!0)):(a=o&&o.data?new DataTexture(o.data,o.width,o.height):new Texture(o),o&&(a.needsUpdate=!0)),a.uuid=n.uuid,void 0!==n.name&&(a.name=n.name),void 0!==n.mapping&&(a.mapping=i(n.mapping,TEXTURE_MAPPING)),void 0!==n.offset&&a.offset.fromArray(n.offset),void 0!==n.repeat&&a.repeat.fromArray(n.repeat),void 0!==n.center&&a.center.fromArray(n.center),void 0!==n.rotation&&(a.rotation=n.rotation),void 0!==n.wrap&&(a.wrapS=i(n.wrap[0],TEXTURE_WRAPPING),a.wrapT=i(n.wrap[1],TEXTURE_WRAPPING)),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.minFilter&&(a.minFilter=i(n.minFilter,TEXTURE_FILTER)),void 0!==n.magFilter&&(a.magFilter=i(n.magFilter,TEXTURE_FILTER)),void 0!==n.anisotropy&&(a.anisotropy=n.anisotropy),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.premultiplyAlpha&&(a.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(a.unpackAlignment=n.unpackAlignment),s[n.uuid]=a}return s}parseObject(t,e,i,s){let r,n,a;function o(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function h(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let s=0,r=t.length;s<r;s++){const r=t[s];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}switch(t.type){case"Scene":r=new Scene,void 0!==t.background&&Number.isInteger(t.background)&&(r.background=new Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":r=new DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":r=(new LightProbe).fromJSON(t);break;case"SkinnedMesh":r=new SkinnedMesh(n=o(t.geometry),a=h(t.material)),void 0!==t.bindMode&&(r.bindMode=t.bindMode),void 0!==t.bindMatrix&&r.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(r.skeleton=t.skeleton);break;case"Mesh":r=new Mesh(n=o(t.geometry),a=h(t.material));break;case"InstancedMesh":n=o(t.geometry),a=h(t.material);const e=t.count,i=t.instanceMatrix;(r=new InstancedMesh(n,a,e)).instanceMatrix=new BufferAttribute(new Float32Array(i.array),16);break;case"LOD":r=new LOD;break;case"Line":r=new Line(o(t.geometry),h(t.material));break;case"LineLoop":r=new LineLoop(o(t.geometry),h(t.material));break;case"LineSegments":r=new LineSegments(o(t.geometry),h(t.material));break;case"PointCloud":case"Points":r=new Points(o(t.geometry),h(t.material));break;case"Sprite":r=new Sprite(h(t.material));break;case"Group":r=new Group;break;case"Bone":r=new Bone;break;default:r=new Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(r.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.layers&&(r.layers.mask=t.layers),void 0!==t.children){const n=t.children;for(let t=0;t<n.length;t++)r.add(this.parseObject(n[t],e,i,s))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];r.animations.push(s[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(r.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],s=r.getObjectByProperty("uuid",i.object);void 0!==s&&r.addLevel(s,i.distance)}}return r}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse(function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}})}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const TEXTURE_MAPPING={UVMapping:300,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter};function ImageBitmapLoader(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,t),this.options={premultiplyAlpha:"none"}}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}function Font(t){this.type="Font",this.data=t}function createPaths(t,e,i){const s=Array.from?Array.from(t):String(t).split(""),r=e/i.resolution,n=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[];let o=0,h=0;for(let t=0;t<s.length;t++){const e=s[t];if("\n"===e)o=0,h-=n;else{const t=createPath(e,r,o,h,i);o+=t.offsetX,a.push(t.path)}}return a}function createPath(t,e,i,s,r){const n=r.glyphs[t]||r.glyphs["?"];if(!n)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const a=new ShapePath;let o,h,c,l,u,p,d,f;if(n.o){const t=n._cachedOutline||(n._cachedOutline=n.o.split(" "));for(let r=0,n=t.length;r<n;){switch(t[r++]){case"m":o=t[r++]*e+i,h=t[r++]*e+s,a.moveTo(o,h);break;case"l":o=t[r++]*e+i,h=t[r++]*e+s,a.lineTo(o,h);break;case"q":c=t[r++]*e+i,l=t[r++]*e+s,u=t[r++]*e+i,p=t[r++]*e+s,a.quadraticCurveTo(u,p,c,l);break;case"b":c=t[r++]*e+i,l=t[r++]*e+s,u=t[r++]*e+i,p=t[r++]*e+s,d=t[r++]*e+i,f=t[r++]*e+s,a.bezierCurveTo(u,p,d,f,c,l)}}}return{offsetX:n.ha*e,path:a}}function FontLoader(t){Loader.call(this,t)}let _context;ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,i,s){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,n=Cache.get(t);if(void 0!==n)return r.manager.itemStart(t),setTimeout(function(){e&&e(n),r.manager.itemEnd(t)},0),n;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,a).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,r.options)}).then(function(i){Cache.add(t,i),e&&e(i),r.manager.itemEnd(t)}).catch(function(e){s&&s(e),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}),Object.assign(ShapePath.prototype,{moveTo:function(t,e){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,i,s){return this.currentPath.quadraticCurveTo(t,e,i,s),this},bezierCurveTo:function(t,e,i,s,r,n){return this.currentPath.bezierCurveTo(t,e,i,s,r,n),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function i(t){const e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i],r=new Shape;r.curves=s.curves,e.push(r)}return e}function s(t,e){const i=e.length;let s=!1;for(let r=i-1,n=0;n<i;r=n++){let i=e[r],a=e[n],o=a.x-i.x,h=a.y-i.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(i=e[n],o=-o,a=e[r],h=-h),t.y<i.y||t.y>a.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=h*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;s=!s}}else{if(t.y!==i.y)continue;if(a.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=a.x)return!0}}return s}const r=ShapeUtils.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===e)return i(n);let a,o,h;const c=[];if(1===n.length)return o=n[0],(h=new Shape).curves=o.curves,c.push(h),c;let l=!r(n[0].getPoints());l=t?!l:l;const u=[],p=[];let d,f,m=[],g=0;p[g]=void 0,m[g]=[];for(let e=0,i=n.length;e<i;e++)a=r(d=(o=n[e]).getPoints()),(a=t?!a:a)?(!l&&p[g]&&g++,p[g]={s:new Shape,p:d},p[g].s.curves=o.curves,l&&g++,m[g]=[]):m[g].push({h:o,p:d[0]});if(!p[0])return i(n);if(p.length>1){let t=!1;const e=[];for(let t=0,e=p.length;t<e;t++)u[t]=[];for(let i=0,r=p.length;i<r;i++){const r=m[i];for(let n=0;n<r.length;n++){const a=r[n];let o=!0;for(let r=0;r<p.length;r++)s(a.p,p[r].p)&&(i!==r&&e.push({froms:i,tos:r,hole:n}),o?(o=!1,u[r].push(a)):t=!0);o&&u[i].push(a)}}e.length>0&&(t||(m=u))}for(let t=0,e=p.length;t<e;t++){h=p[t].s,c.push(h);for(let e=0,i=(f=m[t]).length;e<i;e++)h.holes.push(f[e].h)}return c}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(t,e=100){const i=[],s=createPaths(t,e,this.data);for(let t=0,e=s.length;t<e;t++)Array.prototype.push.apply(i,s[t].toShapes());return i}}),FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(t,e,i,s){const r=this,n=new FileLoader(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(r.withCredentials),n.load(t,function(t){let i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}const s=r.parse(i);e&&e(s)},i,s)},parse:function(t){return new Font(t)}});const AudioContext={getContext:function(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(t){_context=t}};function AudioLoader(t){Loader.call(this,t)}function HemisphereLightProbe(t,e,i){LightProbe.call(this,void 0,i);const s=(new Color).set(t),r=(new Color).set(e),n=new Vector3$1(s.r,s.g,s.b),a=new Vector3$1(r.r,r.g,r.b),o=Math.sqrt(Math.PI),h=o*Math.sqrt(.75);this.sh.coefficients[0].copy(n).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(n).sub(a).multiplyScalar(h)}function AmbientLightProbe(t,e){LightProbe.call(this,void 0,e);const i=(new Color).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(t,e,i,s){const r=this,n=new FileLoader(r.manager);n.setResponseType("arraybuffer"),n.setPath(r.path),n.setRequestHeader(r.requestHeader),n.setWithCredentials(r.withCredentials),n.load(t,function(i){try{const n=i.slice(0);AudioContext.getContext().decodeAudioData(n,function(t){e(t)})}catch(e){s?s(e):console.error(e),r.manager.itemError(t)}},i,s)}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}}),AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}});const _eyeRight=new Matrix4,_eyeLeft=new Matrix4;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const i=t.projectionMatrix.clone(),s=e.eyeSep/2,r=s*e.near/e.focus,n=e.near*Math.tan(MathUtils.DEG2RAD*e.fov*.5)/e.zoom;let a,o;_eyeLeft.elements[12]=-s,_eyeRight.elements[12]=s,a=-n*e.aspect+r,o=n*e.aspect+r,i.elements[0]=2*e.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(i),a=-n*e.aspect-r,o=n*e.aspect-r,i.elements[0]=2*e.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_eyeRight)}});class Clock{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function now(){return("undefined"==typeof performance?Date:performance).now()}const _position$2=new Vector3$1,_quaternion$3=new Quaternion,_scale$1=new Vector3$1,_orientation=new Vector3$1;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$2,_quaternion$3,_scale$1),_orientation.set(0,0,-1).applyQuaternion(_quaternion$3),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(_position$2.x,t),e.positionY.linearRampToValueAtTime(_position$2.y,t),e.positionZ.linearRampToValueAtTime(_position$2.z,t),e.forwardX.linearRampToValueAtTime(_orientation.x,t),e.forwardY.linearRampToValueAtTime(_orientation.y,t),e.forwardZ.linearRampToValueAtTime(_orientation.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(_position$2.x,_position$2.y,_position$2.z),e.setOrientation(_orientation.x,_orientation.y,_orientation.z,i.x,i.y,i.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const _position$3=new Vector3$1,_quaternion$4=new Quaternion,_scale$2=new Vector3$1,_orientation$1=new Vector3$1;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(_position$3,_quaternion$4,_scale$2),_orientation$1.set(0,0,1).applyQuaternion(_quaternion$4);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(_position$3.x,t),e.positionY.linearRampToValueAtTime(_position$3.y,t),e.positionZ.linearRampToValueAtTime(_position$3.z,t),e.orientationX.linearRampToValueAtTime(_orientation$1.x,t),e.orientationY.linearRampToValueAtTime(_orientation$1.y,t),e.orientationZ.linearRampToValueAtTime(_orientation$1.z,t)}else e.setPosition(_position$3.x,_position$3.y,_position$3.z),e.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z)}}class AudioAnalyser{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}function PropertyMixer(t,e,i){let s,r,n;switch(this.binding=t,this.valueSize=i,e){case"quaternion":s=this._slerp,r=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:s=this._lerp,r=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function(t,e){const i=this.buffer,s=this.valueSize,r=t*s+s;let n=this.cumulativeWeight;if(0===n){for(let t=0;t!==s;++t)i[r+t]=i[t];n=e}else{const t=e/(n+=e);this._mixBufferRegion(i,r,0,t,s)}this.cumulativeWeight=n},accumulateAdditive:function(t){const e=this.buffer,i=this.valueSize,s=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,s,0,t,i),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,i=this.buffer,s=t*e+e,r=this.cumulativeWeight,n=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,s,t,1-r,e)}n>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){a.setValue(i,s);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,i=this.valueSize,s=i*this._origIndex;t.getValue(e,s);for(let t=i,r=s;t!==r;++t)e[t]=e[s+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]},_select:function(t,e,i,s,r){if(s>=.5)for(let s=0;s!==r;++s)t[e+s]=t[i+s]},_slerp:function(t,e,i,s){Quaternion.slerpFlat(t,e,t,e,t,i,s)},_slerpAdditive:function(t,e,i,s,r){const n=this._workIndex*r;Quaternion.multiplyQuaternionsFlat(t,n,t,e,t,i),Quaternion.slerpFlat(t,e,t,e,t,n,s)},_lerp:function(t,e,i,s,r){const n=1-s;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*n+t[i+a]*s}},_lerpAdditive:function(t,e,i,s,r){for(let n=0;n!==r;++n){const r=e+n;t[r]=t[r]+t[i+n]*s}}});const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("[\\[\\]\\.:\\/]","g"),_wordChar="[^\\[\\]\\.:\\/]",_wordCharOrDot="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];function Composite(t,e,i){const s=i||PropertyBinding.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,s)}function PropertyBinding(t,e,i){this.path=e,this.parsedPath=i||PropertyBinding.parseTrackName(e),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function AnimationObjectGroup(){this.uuid=MathUtils.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(Composite.prototype,{getValue:function(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];void 0!==s&&s.getValue(t,e)},setValue:function(t,e){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(t,e,i){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,e,i):new PropertyBinding(t,e,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(t){const e=_trackRe.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const t=i.nodeName.substring(s+1);-1!==_supportedObjectNames.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let s=0;s<t.length;s++){const r=t[s];if(r.name===e||r.uuid===e)return r;const n=i(r.children);if(n)return n}return null},s=i(t.children);if(s)return s}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)t[e++]=i[s]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=t[e++]},function(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,i=e.objectName,s=e.propertyName;let r=e.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let s=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===s){s=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==s){if(void 0===t[s])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}const n=t[s];if(void 0===n){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+s+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=r}else void 0!==n.fromArray&&void 0!==n.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(o=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=s;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,i=this._paths,s=this._parsedPaths,r=this._bindings,n=r.length;let a=void 0,o=t.length,h=this.nCachedObjects_;for(let c=0,l=arguments.length;c!==l;++c){const l=arguments[c],u=l.uuid;let p=e[u];if(void 0===p){p=o++,e[u]=p,t.push(l);for(let t=0,e=n;t!==e;++t)r[t].push(new PropertyBinding(l,i[t],s[t]))}else if(p<h){a=t[p];const o=--h,c=t[o];e[c.uuid]=p,t[p]=c,e[u]=o,t[o]=l;for(let t=0,e=n;t!==e;++t){const e=r[t],n=e[o];let a=e[p];e[p]=n,void 0===a&&(a=new PropertyBinding(l,i[t],s[t])),e[o]=a}}else t[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h},remove:function(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_;for(let n=0,a=arguments.length;n!==a;++n){const a=arguments[n],o=a.uuid,h=e[o];if(void 0!==h&&h>=r){const n=r++,c=t[n];e[c.uuid]=h,t[h]=c,e[o]=n,t[n]=a;for(let t=0,e=s;t!==e;++t){const e=i[t],s=e[n],r=e[h];e[h]=s,e[n]=r}}}this.nCachedObjects_=r},uncache:function(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_,n=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,h=e[o];if(void 0!==h)if(delete e[o],h<r){const a=--r,o=t[a],c=--n,l=t[c];e[o.uuid]=h,t[h]=o,e[l.uuid]=a,t[a]=l,t.pop();for(let t=0,e=s;t!==e;++t){const e=i[t],s=e[a],r=e[c];e[h]=s,e[a]=r,e.pop()}}else{const r=--n,a=t[r];r>0&&(e[a.uuid]=h),t[h]=a,t.pop();for(let t=0,e=s;t!==e;++t){const e=i[t];e[h]=e[r],e.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){const i=this._bindingsIndicesByPath;let s=i[t];const r=this._bindings;if(void 0!==s)return r[s];const n=this._paths,a=this._parsedPaths,o=this._objects,h=o.length,c=this.nCachedObjects_,l=new Array(h);s=r.length,i[t]=s,n.push(t),a.push(e),r.push(l);for(let i=c,s=o.length;i!==s;++i){const s=o[i];l[i]=new PropertyBinding(s,t,e)}return l},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const s=this._paths,r=this._parsedPaths,n=this._bindings,a=n.length-1,o=n[a];e[t[a]]=i,n[i]=o,n.pop(),r[i]=r[a],r.pop(),s[i]=s[a],s.pop()}}});class AnimationAction{constructor(t,e,i=null,s=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=s;const r=e.tracks,n=r.length,a=new Array(n),o={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let t=0;t!==n;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,s=t._clip.duration,r=s/i,n=i/s;t.warp(1,r,e),this.warp(n,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const s=this._mixer,r=s.time,n=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,h=a.sampleValues;return o[0]=r,o[1]=r+i,h[0]=t/n,h[1]=e/n,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,s){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const s=(t-r)*i;if(s<0||0===i)return;this._startTime=null,e=i*s}e*=this._updateTimeScale(t);const n=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let i=0,s=t.length;i!==s;++i)t[i].evaluate(n),e[i].accumulateAdditive(a);break;case NormalAnimationBlendMode:default:for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(n),e[i].accumulate(s,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const s=i.evaluate(t)[0];e*=s,t>i.parameterPositions[1]&&(this.stopFading(),0===s&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let s=this.time+t,r=this._loopCount;const n=i===LoopPingPong;if(0===t)return-1===r?s:n&&1==(1&r)?e-s:s;if(i===LoopOnce){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(s>=e)s=e;else{if(!(s<0)){this.time=s;break t}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,n)):this._setEndings(0===this.repetitions,!0,n)),s>=e||s<0){const i=Math.floor(s/e);s-=e*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=t>0?e:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,n)}else this._setEndings(!1,!1,n);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=s;if(n&&1==(1&r))return e-s}return s}_setEndings(t,e,i){const s=this._interpolantSettings;i?(s.endingStart=ZeroSlopeEnding,s.endingEnd=ZeroSlopeEnding):(s.endingStart=t?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,s.endingEnd=e?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)}_scheduleFading(t,e,i){const s=this._mixer,r=s.time;let n=this._weightInterpolant;null===n&&(n=s._lendControlInterpolant(),this._weightInterpolant=n);const a=n.parameterPositions,o=n.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}}function AnimationMixer(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(t,e){const i=t._localRoot||this._root,s=t._clip.tracks,r=s.length,n=t._propertyBindings,a=t._interpolants,o=i.uuid,h=this._bindingsByRootAndName;let c=h[o];void 0===c&&(c={},h[o]=c);for(let t=0;t!==r;++t){const r=s[t],h=r.name;let l=c[h];if(void 0!==l)n[t]=l;else{if(void 0!==(l=n[t])){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,h));continue}const s=e&&e._propertyBindings[t].binding.parsedPath;++(l=new PropertyMixer(PropertyBinding.create(i,h,s),r.ValueTypeName,r.getValueSize())).referenceCount,this._addInactiveBinding(l,o,h),n[t]=l}a[t].resultBuffer=l.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,s=this._actionsByClip[i];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){const s=this._actions,r=this._actionsByClip;let n=r[e];if(void 0===n)n={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=n;else{const e=n.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=s.length,s.push(t),n.actionByRoot[i]=t},_removeInactiveAction:function(t){const e=this._actions,i=e[e.length-1],s=t._cacheIndex;i._cacheIndex=s,e[s]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,n=this._actionsByClip,a=n[r],o=a.knownActions,h=o[o.length-1],c=t._byClipCacheIndex;h._byClipCacheIndex=c,o[c]=h,o.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete n[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){const e=this._actions,i=t._cacheIndex,s=this._nActiveActions++,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=i,e[i]=r},_takeBackAction:function(t){const e=this._actions,i=t._cacheIndex,s=--this._nActiveActions,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=i,e[i]=r},_addInactiveBinding:function(t,e,i){const s=this._bindingsByRootAndName,r=this._bindings;let n=s[e];void 0===n&&(n={},s[e]=n),n[i]=t,t._cacheIndex=r.length,r.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,i=t.binding,s=i.rootNode.uuid,r=i.path,n=this._bindingsByRootAndName,a=n[s],o=e[e.length-1],h=t._cacheIndex;o._cacheIndex=h,e[h]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete n[s]},_lendBinding:function(t){const e=this._bindings,i=t._cacheIndex,s=this._nActiveBindings++,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=i,e[i]=r},_takeBackBinding:function(t){const e=this._bindings,i=t._cacheIndex,s=--this._nActiveBindings,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=i,e[i]=r},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&((i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,i=t.__cacheIndex,s=--this._nActiveControlInterpolants,r=e[s];t.__cacheIndex=s,e[s]=t,r.__cacheIndex=i,e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,i){const s=e||this._root,r=s.uuid;let n="string"==typeof t?AnimationClip.findByName(s,t):t;const a=null!==n?n.uuid:t,o=this._actionsByClip[a];let h=null;if(void 0===i&&(i=null!==n?n.blendMode:NormalAnimationBlendMode),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;h=o.knownActions[0],null===n&&(n=h._clip)}if(null===n)return null;const c=new AnimationAction(this,n,e,i);return this._bindAction(c,h),this._addInactiveAction(c,a,r),c},existingAction:function(t,e){const i=e||this._root,s=i.uuid,r="string"==typeof t?AnimationClip.findByName(i,t):t,n=r?r.uuid:t,a=this._actionsByClip[n];return void 0!==a&&a.actionByRoot[s]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,s=this.time+=t,r=Math.sign(t),n=this._accuIndex^=1;for(let a=0;a!==i;++a){e[a]._update(s,t,r,n)}const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(n);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,i=t.uuid,s=this._actionsByClip,r=s[i];if(void 0!==r){const t=r.knownActions;for(let i=0,s=t.length;i!==s;++i){const s=t[i];this._deactivateAction(s);const r=s._cacheIndex,n=e[e.length-1];s._cacheIndex=null,s._byClipCacheIndex=null,n._cacheIndex=r,e[r]=n,e.pop(),this._removeInactiveBindingsForAction(s)}delete s[i]}},uncacheRoot:function(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const s=i[t].actionByRoot[e];void 0!==s&&(this._deactivateAction(s),this._removeInactiveAction(s))}const s=this._bindingsByRootAndName[e];if(void 0!==s)for(const t in s){const e=s[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});class Uniform{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}function InstancedInterleavedBuffer(t,e,i){InterleavedBuffer.call(this,t,e),this.meshPerAttribute=i||1}function GLBufferAttribute(t,e,i,s,r){this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=s,this.count=r,this.version=0}function Raycaster(t,e,i,s){this.ray=new Ray(t,e),this.near=i||0,this.far=s||1/0,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(t,e){return t.distance-e.distance}function intersectObject(t,e,i,s){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===s){const s=t.children;for(let t=0,r=s.length;t<r;t++)intersectObject(s[t],e,i,!0)}}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(t){return InterleavedBuffer.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=InterleavedBuffer.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=InterleavedBuffer.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(GLBufferAttribute.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(GLBufferAttribute.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(Raycaster.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(t,e,i){const s=i||[];return intersectObject(t,this,s,e),s.sort(ascSort),s},intersectObjects:function(t,e,i){const s=i||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),s;for(let i=0,r=t.length;i<r;i++)intersectObject(t[i],this,s,e);return s.sort(ascSort),s}});class Spherical{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(MathUtils.clamp(e/this.radius,-1,1))),this}}class Cylindrical{constructor(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}}const _vector$8=new Vector2;class Box2{constructor(t,e){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Vector2(1/0,1/0),this.max=void 0!==e?e:new Vector2(-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=_vector$8.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Vector2),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Vector2),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return _vector$8.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _startP=new Vector3$1,_startEnd=new Vector3$1;class Line3{constructor(t,e){this.start=void 0!==t?t:new Vector3$1,this.end=void 0!==e?e:new Vector3$1}set(t,e){return this.start.copy(t),this.end.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Vector3$1),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Vector3$1),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Vector3$1),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){_startP.subVectors(t,this.start),_startEnd.subVectors(this.end,this.start);const i=_startEnd.dot(_startEnd);let s=_startEnd.dot(_startP)/i;return e&&(s=MathUtils.clamp(s,0,1)),s}closestPointToPoint(t,e,i){const s=this.closestPointToPointParameter(t,e);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Vector3$1),this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function ImmediateRenderObject(t){Object3D.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const _vector$9=new Vector3$1;class SpotLightHelper extends Object3D{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new BufferGeometry,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,n=e/i*Math.PI*2;s.push(Math.cos(r),Math.sin(r),1,Math.cos(n),Math.sin(n),1)}i.setAttribute("position",new Float32BufferAttribute(s,3));const r=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),_vector$9.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$9),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$a=new Vector3$1,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const e=getBoneList(t),i=new BufferGeometry,s=[],r=[],n=new Color(0,0,1),a=new Color(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(n.r,n.g,n.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Float32BufferAttribute(s,3)),i.setAttribute("color",new Float32BufferAttribute(r,3)),super(i,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,s=i.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,r.matrixWorld),_vector$a.setFromMatrixPosition(_boneMatrix),s.setXYZ(i,_vector$a.x,_vector$a.y,_vector$a.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,r.parent.matrixWorld),_vector$a.setFromMatrixPosition(_boneMatrix),s.setXYZ(i+1,_vector$a.x,_vector$a.y,_vector$a.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function getBoneList(t){const e=[];t&&t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,getBoneList(t.children[i]));return e}class PointLightHelper extends Mesh{constructor(t,e,i){super(new SphereBufferGeometry(e,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$b=new Vector3$1,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const s=new OctahedronBufferGeometry(e);s.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),n=new Float32Array(3*r.count);s.setAttribute("color",new BufferAttribute(n,3)),this.add(new Mesh(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const s=t<i/2?_color1:_color2;e.setXYZ(t,s.r,s.g,s.b)}e.needsUpdate=!0}t.lookAt(_vector$b.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t=10,e=10,i=4473924,s=8947848){i=new Color(i),s=new Color(s);const r=e/2,n=t/e,a=t/2,o=[],h=[];for(let t=0,c=0,l=-a;t<=e;t++,l+=n){o.push(-a,0,l,a,0,l),o.push(l,0,-a,l,0,a);const e=t===r?i:s;e.toArray(h,c),c+=3,e.toArray(h,c),c+=3,e.toArray(h,c),c+=3,e.toArray(h,c),c+=3}const c=new BufferGeometry;c.setAttribute("position",new Float32BufferAttribute(o,3)),c.setAttribute("color",new Float32BufferAttribute(h,3)),super(c,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(t=10,e=16,i=8,s=64,r=4473924,n=8947848){r=new Color(r),n=new Color(n);const a=[],o=[];for(let i=0;i<=e;i++){const s=i/e*(2*Math.PI),h=Math.sin(s)*t,c=Math.cos(s)*t;a.push(0,0,0),a.push(h,0,c);const l=1&i?r:n;o.push(l.r,l.g,l.b),o.push(l.r,l.g,l.b)}for(let e=0;e<=i;e++){const h=1&e?r:n,c=t-t/i*e;for(let t=0;t<s;t++){let e=t/s*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c;a.push(i,0,r),o.push(h.r,h.g,h.b),e=(t+1)/s*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c,a.push(i,0,r),o.push(h.r,h.g,h.b)}}const h=new BufferGeometry;h.setAttribute("position",new Float32BufferAttribute(a,3)),h.setAttribute("color",new Float32BufferAttribute(o,3)),super(h,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const _v1$6=new Vector3$1,_v2$3=new Vector3$1,_v3$1=new Vector3$1;class DirectionalLightHelper extends Object3D{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(s,r),this.add(this.lightPlane),(s=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){_v1$6.setFromMatrixPosition(this.light.matrixWorld),_v2$3.setFromMatrixPosition(this.light.target.matrixWorld),_v3$1.subVectors(_v2$3,_v1$6),this.lightPlane.lookAt(_v2$3),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$3),this.targetLine.scale.z=_v3$1.length()}}const _vector$c=new Vector3$1,_camera=new Camera;class CameraHelper extends LineSegments{constructor(t){const e=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],n={},a=new Color(16755200),o=new Color(16711680),h=new Color(43775),c=new Color(16777215),l=new Color(3355443);function u(t,e,i){p(t,i),p(e,i)}function p(t,e){s.push(0,0,0),r.push(e.r,e.g,e.b),void 0===n[t]&&(n[t]=[]),n[t].push(s.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",h),u("u2","u3",h),u("u3","u1",h),u("c","t",c),u("p","c",l),u("cn1","cn2",l),u("cn3","cn4",l),u("cf1","cf2",l),u("cf3","cf4",l),e.setAttribute("position",new Float32BufferAttribute(s,3)),e.setAttribute("color",new Float32BufferAttribute(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()}update(){const t=this.geometry,e=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",e,t,_camera,0,0,-1),setPoint("t",e,t,_camera,0,0,1),setPoint("n1",e,t,_camera,-1,-1,-1),setPoint("n2",e,t,_camera,1,-1,-1),setPoint("n3",e,t,_camera,-1,1,-1),setPoint("n4",e,t,_camera,1,1,-1),setPoint("f1",e,t,_camera,-1,-1,1),setPoint("f2",e,t,_camera,1,-1,1),setPoint("f3",e,t,_camera,-1,1,1),setPoint("f4",e,t,_camera,1,1,1),setPoint("u1",e,t,_camera,.7,1.1,-1),setPoint("u2",e,t,_camera,-.7,1.1,-1),setPoint("u3",e,t,_camera,0,2,-1),setPoint("cf1",e,t,_camera,-1,0,1),setPoint("cf2",e,t,_camera,1,0,1),setPoint("cf3",e,t,_camera,0,-1,1),setPoint("cf4",e,t,_camera,0,1,1),setPoint("cn1",e,t,_camera,-1,0,-1),setPoint("cn2",e,t,_camera,1,0,-1),setPoint("cn3",e,t,_camera,0,-1,-1),setPoint("cn4",e,t,_camera,0,1,-1),t.getAttribute("position").needsUpdate=!0}}function setPoint(t,e,i,s,r,n,a){_vector$c.set(r,n,a).unproject(s);const o=e[t];if(void 0!==o){const t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],_vector$c.x,_vector$c.y,_vector$c.z)}}const _box$3=new Box3;class BoxHelper extends LineSegments{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(24),r=new BufferGeometry;r.setIndex(new BufferAttribute(i,1)),r.setAttribute("position",new BufferAttribute(s,3)),super(r,new LineBasicMaterial({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box$3.setFromObject(this.object),_box$3.isEmpty())return;const e=_box$3.min,i=_box$3.max,s=this.geometry.attributes.position,r=s.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return LineSegments.prototype.copy.call(this,t),this.object=t.object,this}}class Box3Helper extends LineSegments{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new BufferGeometry;s.setIndex(new BufferAttribute(i,1)),s.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(s,new LineBasicMaterial({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class PlaneHelper extends Line{constructor(t,e=1,i=16776960){const s=i,r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new LineBasicMaterial({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),n.computeBoundingSphere(),this.add(new Mesh(n,new MeshBasicMaterial({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?BackSide:FrontSide,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const _axis=new Vector3$1;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(t,e,i,s,r,n){super(),this.type="ArrowHelper",void 0===t&&(t=new Vector3$1(0,0,1)),void 0===e&&(e=new Vector3$1(0,0,0)),void 0===i&&(i=1),void 0===s&&(s=16776960),void 0===r&&(r=.2*i),void 0===n&&(n=.2*r),void 0===_lineGeometry&&((_lineGeometry=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(_coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,n)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(_axis,e)}}setLength(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class AxesHelper extends LineSegments{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute(e,3)),i.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const _floatView=new Float32Array(1),_int32View=new Int32Array(_floatView.buffer),DataUtils={toHalfFloat:function(t){_floatView[0]=t;const e=_int32View[0];let i=e>>16&32768,s=e>>12&2047;const r=e>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&e):r<113?i|=((s|=2048)>>114-r)+(s>>113-r&1):(i|=r-112<<10|s>>1,i+=1&s)}},LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS={[LinearEncoding]:0,[sRGBEncoding]:1,[RGBEEncoding]:2,[RGBM7Encoding]:3,[RGBM16Encoding]:4,[RGBDEncoding]:5,[GammaEncoding]:6},_flatCamera=new OrthographicCamera,{_lodPlanes:_lodPlanes,_sizeLods:_sizeLods,_sigmas:_sigmas}=_createPlanes(),_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3$1(1,1,1),new Vector3$1(-1,1,1),new Vector3$1(1,1,-1),new Vector3$1(-1,1,-1),new Vector3$1(0,PHI,INV_PHI),new Vector3$1(0,PHI,-INV_PHI),new Vector3$1(INV_PHI,0,PHI),new Vector3$1(-INV_PHI,0,PHI),new Vector3$1(PHI,INV_PHI,0),new Vector3$1(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=_getBlurShader(MAX_SAMPLES),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,s=100){_oldTarget=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,i,s,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<_lodPlanes.length;t++)_lodPlanes[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(_oldTarget),t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t){_oldTarget=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:UnsignedByteType,format:RGBEFormat,encoding:_isLDR(t)?t.encoding:RGBEEncoding,depthBuffer:!1},i=_createRenderTarget(e);return i.depthBuffer=!t,this._pingPongRenderTarget=_createRenderTarget(e),i}_compileMaterial(t){const e=new Mesh(_lodPlanes[0],t);this._renderer.compile(e,_flatCamera)}_sceneToCubeUV(t,e,i,s){const r=new PerspectiveCamera(90,1,e,i),n=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,h=o.outputEncoding,c=o.toneMapping;o.getClearColor(_clearColor);const l=o.getClearAlpha();o.toneMapping=NoToneMapping,o.outputEncoding=LinearEncoding;let u=t.background;if(u&&u.isColor){u.convertSRGBToLinear();const e=Math.max(u.r,u.g,u.b),i=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);u=u.multiplyScalar(Math.pow(2,-i));const s=(i+128)/255;o.setClearColor(u,s),t.background=null}for(let e=0;e<6;e++){const i=e%3;0==i?(r.up.set(0,n[e],0),r.lookAt(a[e],0,0)):1==i?(r.up.set(0,0,n[e]),r.lookAt(0,a[e],0)):(r.up.set(0,n[e],0),r.lookAt(0,0,a[e])),_setViewport(s,i*SIZE_MAX,e>2?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),o.setRenderTarget(s),o.render(t,r)}o.toneMapping=c,o.outputEncoding=h,o.setClearColor(_clearColor,l)}_textureToCubeUV(t,e){const i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=_getCubemapShader()):null==this._equirectShader&&(this._equirectShader=_getEquirectShader());const s=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new Mesh(_lodPlanes[0],s),n=s.uniforms;n.envMap.value=t,t.isCubeTexture||n.texelSize.value.set(1/t.image.width,1/t.image.height),n.inputEncoding.value=ENCODINGS[t.encoding],n.outputEncoding.value=ENCODINGS[e.texture.encoding],_setViewport(e,0,0,3*SIZE_MAX,2*SIZE_MAX),i.setRenderTarget(e),i.render(r,_flatCamera)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<TOTAL_LODS;e++){const i=Math.sqrt(_sigmas[e]*_sigmas[e]-_sigmas[e-1]*_sigmas[e-1]),s=_axisDirections[(e-1)%_axisDirections.length];this._blur(t,e-1,e,i,s)}e.autoClear=i}_blur(t,e,i,s,r){const n=this._pingPongRenderTarget;this._halfBlur(t,n,e,i,s,"latitudinal",r),this._halfBlur(n,t,i,i,s,"longitudinal",r)}_halfBlur(t,e,i,s,r,n,a){const o=this._renderer,h=this._blurMaterial;"latitudinal"!==n&&"longitudinal"!==n&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Mesh(_lodPlanes[s],h),l=h.uniforms,u=_sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*u):2*Math.PI/(2*MAX_SAMPLES-1),d=r/p,f=isFinite(r)?1+Math.floor(3*d):MAX_SAMPLES;f>MAX_SAMPLES&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${MAX_SAMPLES}`);const m=[];let g=0;for(let t=0;t<MAX_SAMPLES;++t){const e=t/d,i=Math.exp(-e*e/2);m.push(i),0==t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;l.envMap.value=t.texture,l.samples.value=f,l.weights.value=m,l.latitudinal.value="latitudinal"===n,a&&(l.poleAxis.value=a),l.dTheta.value=p,l.mipInt.value=LOD_MAX-i,l.inputEncoding.value=ENCODINGS[t.texture.encoding],l.outputEncoding.value=ENCODINGS[t.texture.encoding];const y=_sizeLods[s];_setViewport(e,3*Math.max(0,SIZE_MAX-2*y),(0===s?0:2*SIZE_MAX)+2*y*(s>LOD_MAX-LOD_MIN?s-LOD_MAX+LOD_MIN:0),3*y,2*y),o.setRenderTarget(e),o.render(c,_flatCamera)}}function _isLDR(t){return void 0!==t&&t.type===UnsignedByteType&&(t.encoding===LinearEncoding||t.encoding===sRGBEncoding||t.encoding===GammaEncoding)}function _createPlanes(){const t=[],e=[],i=[];let s=LOD_MAX;for(let r=0;r<TOTAL_LODS;r++){const n=Math.pow(2,s);e.push(n);let a=1/n;r>LOD_MAX-LOD_MIN?a=EXTRA_LOD_SIGMA[r-LOD_MAX+LOD_MIN-1]:0==r&&(a=0),i.push(a);const o=1/(n-1),h=-o/2,c=1+o/2,l=[h,h,c,h,c,c,h,h,c,c,h,c],u=6,p=6,d=3,f=2,m=1,g=new Float32Array(d*p*u),y=new Float32Array(f*p*u),v=new Float32Array(m*p*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,s=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(s,d*p*t),y.set(l,f*p*t);const r=[t,t,t,t,t,t];v.set(r,m*p*t)}const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(g,d)),b.setAttribute("uv",new BufferAttribute(y,f)),b.setAttribute("faceIndex",new BufferAttribute(v,m)),t.push(b),s>LOD_MIN&&s--}return{_lodPlanes:t,_sizeLods:e,_sigmas:i}}function _createRenderTarget(t){const e=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,t);return e.texture.mapping=CubeUVReflectionMapping,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function _setViewport(t,e,i,s,r){t.viewport.set(e,i,s,r),t.scissor.set(e,i,s,r)}function _getBlurShader(t){return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(t)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Vector3$1(0,1,0)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${_getEncodings()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectShader(){return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Vector2(1,1)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${_getEncodings()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${_getEncodings()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function _getEncodings(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Face4(t,e,i,s,r,n,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(t,e,i,r,n,a)}const LineStrip=0,LinePieces=1,NoColors=0,FaceColors=1,VertexColors=2;function MeshFaceMaterial(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function MultiMaterial(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function PointCloud(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(t,e)}function Particle(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(t)}function ParticleSystem(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(t,e)}function PointCloudMaterial(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleBasicMaterial(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleSystemMaterial(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function Vertex(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3$1(t,e,i)}function DynamicBufferAttribute(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(t,e).setUsage(DynamicDrawUsage)}function Int8Attribute(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(t,e)}function Uint8Attribute(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(t,e)}function Uint8ClampedAttribute(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(t,e)}function Int16Attribute(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(t,e)}function Uint16Attribute(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(t,e)}function Int32Attribute(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(t,e)}function Uint32Attribute(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(t,e)}function Float32Attribute(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(t,e)}function Float64Attribute(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(t,e)}function ClosedSplineCurve3(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom",this.closed=!0}function SplineCurve3(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function Spline(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function AxisHelper(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(t)}function BoundingBoxHelper(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(t,e)}function EdgesHelper(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(t.geometry),new LineBasicMaterial({color:void 0!==e?e:16777215}))}function WireframeHelper(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(t.geometry),new LineBasicMaterial({color:void 0!==e?e:16777215}))}function XHRLoader(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(t)}function BinaryTextureLoader(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(t)}function WebGLRenderTargetCube(t,e,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(t,i)}Curve.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Curve.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(CurvePath.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new Geometry;for(let i=0,s=t.length;i<s;i++){const s=t[i];e.vertices.push(new Vector3$1(s.x,s.y,s.z||0))}return e}}),Object.assign(Path.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(t)}}),Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Box2.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Box3.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Sphere.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Frustum.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Line3.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(MathUtils,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),MathUtils.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),MathUtils.ceilPowerOfTwo(t)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(Matrix4.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3$1).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,s,r,n){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,s,i,r,n)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Plane.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Object.assign(Quaternion.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(Ray.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Triangle,{barycoordFromPoint:function(t,e,i,s,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(t,e,i,s,r)},normal:function(t,e,i,s){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(t,e,i,s)}}),Object.assign(Shape.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,t)}}),Object.assign(Vector2.prototype,{fromAttribute:function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3$1.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(Object3D.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),PerspectiveCamera.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}}),Object.assign(BufferAttribute.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?DynamicDrawUsage:StaticDrawUsage),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(BufferGeometry.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new BufferAttribute(arguments[1],arguments[2])))},addDrawCall:function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(InstancedBufferGeometry.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(InterleavedBuffer.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?DynamicDrawUsage:StaticDrawUsage),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Scene.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(MeshPhysicalMaterial.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(WebGLRenderer.prototype,{clearTarget:function(t,e,i,s){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,s)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?sRGBEncoding:LinearEncoding}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Audio.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new AudioLoader).load(t,function(t){e.setBuffer(t)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},CubeCamera.prototype.clear=function(t,e,i,s){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,s)};const GeometryUtils={merge:function(t,e,i){let s;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),s=e.matrix,e=e.geometry),t.merge(e,s,i)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(t,e,i,s){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new TextureLoader;r.setCrossOrigin(this.crossOrigin);const n=r.load(t,i,void 0,s);return e&&(n.mapping=e),n},ImageUtils.loadTextureCube=function(t,e,i,s){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new CubeTextureLoader;r.setCrossOrigin(this.crossOrigin);const n=r.load(t,i,void 0,s);return e&&(n.mapping=e),n},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"124"}}));var S={};!function(t){function e(t){this.Cc=-1,this.ha=new vt,this.pa=new vt,this.a=new vt;var e=t.position;this.ha.v=e.x,this.ha.A=e.y,this.ha.B=e.z,e=t.rotation,this.ha.o=e.e00,this.ha.f=e.e01,this.ha.h=e.e02,this.ha.i=e.e10,this.ha.m=e.e11,this.ha.j=e.e12,this.ha.l=e.e20,this.ha.g=e.e21,this.ha.s=e.e22,e=this.pa;var i=this.ha;e.v=i.v,e.A=i.A,e.B=i.B,e.o=i.o,e.f=i.f,e.h=i.h,e.i=i.i,e.m=i.m,e.j=i.j,e.l=i.l,e.g=i.g,e.s=i.s,e=this.a,i=this.ha,e.v=i.v,e.A=i.A,e.B=i.B,e.o=i.o,e.f=i.f,e.h=i.h,e.i=i.i,e.m=i.m,e.j=i.j,e.l=i.l,e.g=i.g,e.s=i.s,this.hk=t.restitution,this.Xj=t.friction,this.Dk=t.density,this.Kb=t.geometry,this.Tj=t.collisionGroup,this.Uj=t.collisionMask,this.yd=t.contactCallback,this.u=new Wt,this.tb=null,this.rc=new bt}function i(){}function s(t){this.Fi=this.Dc=this.ia=this.M=null,this.zg=0,this.kc=this.Ob=null,this.Ae=0,this.Ze=this.ze=null,this.kh=0;var e=t.linearVelocity;this.gb=e.x,this.hb=e.y,this.ib=e.z,e=t.angularVelocity,this.kb=e.x,this.lb=e.y,this.mb=e.z,this.Wc=this.Vc=this.Uc=this.$c=this.Zc=this.Yc=0,this.pa=new vt,this.a=new vt,e=t.position,this.pa.v=e.x,this.pa.A=e.y,this.pa.B=e.z,e=t.rotation,this.pa.o=e.e00,this.pa.f=e.e01,this.pa.h=e.e02,this.pa.i=e.e10,this.pa.m=e.e11,this.pa.j=e.e12,this.pa.l=e.e20,this.pa.g=e.e21,this.pa.s=e.e22,e=this.a;var i=this.pa;e.v=i.v,e.A=i.A,e.B=i.B,e.o=i.o,e.f=i.f,e.h=i.h,e.i=i.i,e.m=i.m,e.j=i.j,e.l=i.l,e.g=i.g,e.s=i.s,this.Lb=t.type,this.yb=0,this.Gb=!1,this.Bk=t.autoSleep,this.Y=this.X=this.W=this.V=this.U=this.T=this.S=this.R=this.P=this.yi=this.xi=this.wi=this.vi=this.ui=this.ti=this.si=this.ri=this.pi=this.Za=this.Ya=this.Xa=this.Wa=this.Va=this.Ua=this.Ta=this.Sa=this.Ra=this.Id=this.Hd=this.Gd=this.Fd=this.Ed=this.Dd=this.Cd=this.Bd=this.Ad=this.$a=this.Pc=0,this.$j=t.linearDamping,this.Qj=t.angularDamping,this.xf=this.wf=this.vf=this.Oh=this.Nh=this.Mh=0,this.N=new bt(1,1,1),this.Nf=!1,this.eh=1,this.oc=null}function r(){this.mass=0,this.localInertia=new dt}function n(t){J.call(this),this.$=t,this.info=new G,this.ac=Array(yt.maxJacobianRows),t=0;for(var e=this.ac.length;t<e;){var i=t++;this.ac[i]=new d}}function a(t){J.call(this),this.Ji=t,this.info=new j,this.ac=Array(yt.maxManifoldPoints),t=0;for(var e=this.ac.length;t<e;){var i=t++;this.ac[i]=new f}}function o(t){this.Ag=t,this.wk=Array(this.Ag),this.$a=Array(this.Ag),this.cj=Array(this.Ag),t=0;for(var e=this.Ag;t<e;){var i=t++;this.wk[i]=Array(this.Ag),this.$a[i]=Array(this.Ag),this.cj[i]=Array(this.Ag);for(var s=0,r=this.Ag;s<r;){var n=s++;this.wk[i][n]=0,this.$a[i][n]=0,this.cj[i][n]=0}}for(this.ak=1<<this.Ag,this.Sj=Array(this.ak),this.Ck=Array(this.ak),t=0,e=this.ak;t<e;){s=(15&(s=(51&(s=(85&(s=i=t++))+(s>>1&85)))+(s>>2&51)))+(s>>4&15),r=Array(s),n=0;for(var a=s;n<a;){var o=n++;r[o]=Array(s);for(var h=0,c=s;h<c;){var l=h++;r[o][l]=0}}this.Sj[i]=!1,this.Ck[i]=r}}function h(t){J.call(this),this.$=t,this.info=new G,t=yt.maxJacobianRows,this.ei=new o(t),this.Se=new l(t),this.ac=Array(t);for(var e=0,i=this.ac.length;e<i;){var s=e++;this.ac[s]=new d}for(e=this.Se.Th.length,this.Ml=new c(e),this.Ki=new c(e),this.Qg=Array(t),this.Yh=Array(t),this.Cf=Array(t),this.Aj=Array(t),e=0;e<t;)i=e++,this.Qg[i]=0,this.Yh[i]=0,this.Cf[i]=0,this.Aj[i]=0}function c(t){this.n=t,this.sc=Array(t),this.kf=Array(t);for(var e=0;e<t;){var i=e++;this.sc[i]=i}}function l(t){this.Qn=t,this.jf=0,this.Th=Array(1<<t),this.cf=new u(t)}function u(t){this.size=t,this.Sc=0,this.uh=Array(t),this.zh=Array(t),this.ie=0,this.Mg=Array(t)}function p(t){this.uh=Array(t),this.Mg=Array(t),this.zh=Array(t),this.il=Array(t),this.ie=this.Sc=0}function d(){this.Ff=this.mass=this.pd=this.od=this.nd=this.md=this.ld=this.kd=this.vd=this.ud=this.td=this.sd=this.rd=this.qd=0}function f(){this.Bm=this.Am=this.zm=this.ym=this.he=this.rk=this.qk=this.pk=this.nk=this.mk=this.lk=this.xl=this.wl=this.vl=this.ul=this.tl=this.sl=this.Jj=this.Ij=this.Hj=this.Gj=this.Fj=this.Ej=this.Dl=this.Cl=this.Bl=this.Al=this.zl=this.yl=this.bg=this.ag=this.$f=this.Zf=this.Yf=this.Xf=this.di=this.ci=this.bi=this.ai=this.$h=this.Zh=0}function m(){}function g(){D.call(this),this.localAxis1=new bt(1,0,0),this.localAxis2=new bt(1,0,0),this.springDamper1=new b,this.springDamper2=new b,this.limitMotor1=new M,this.limitMotor2=new M}function y(t){O.call(this,t,E.UNIVERSAL);var e=t.localAxis1;this.qa=e.x,this.ra=e.y,this.sa=e.z,e=t.localAxis2,this.Mc=e.x,this.Nc=e.y,this.Oc=e.z,this.qa*this.qa+this.ra*this.ra+this.sa*this.sa?(0<(e=this.qa*this.qa+this.ra*this.ra+this.sa*this.sa)&&(e=1/Math.sqrt(e)),this.qa*=e,this.ra*=e,this.sa*=e):(this.qa=1,this.sa=this.ra=0),this.Mc*this.Mc+this.Nc*this.Nc+this.Oc*this.Oc?(0<(e=this.Mc*this.Mc+this.Nc*this.Nc+this.Oc*this.Oc)&&(e=1/Math.sqrt(e)),this.Mc*=e,this.Nc*=e,this.Oc*=e):(this.Nc=this.Mc=0,this.Oc=1);var i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b=this.C.a;e=this.D.a,d=b.o*this.qa+b.f*this.ra+b.h*this.sa,f=b.i*this.qa+b.m*this.ra+b.j*this.sa,i=b.l*this.qa+b.g*this.ra+b.s*this.sa,m=e.o*this.Mc+e.f*this.Nc+e.h*this.Oc,(a=(g=e.i*this.Mc+e.m*this.Nc+e.j*this.Oc)*i-(p=e.l*this.Mc+e.g*this.Nc+e.s*this.Oc)*f)*a+(o=p*d-m*i)*o+(h=m*f-g*d)*h||(h=i*i,(a=d*d)<(o=f*f)?a<h?(a=0,o=i*(h=1/Math.sqrt(o+h)),h*=-f):(a=f*(h=1/Math.sqrt(a+o)),o=-d*h,h=0):o<h?(a=-i*(h=1/Math.sqrt(h+a)),o=0,h*=d):(a=f*(h=1/Math.sqrt(a+o)),o=-d*h,h=0)),s=f*h-i*o,r=i*a-d*h,n=d*o-f*a,c=o*p-h*g,l=h*m-a*p,u=a*g-o*m,y=b.o*d+b.i*f+b.l*i,v=b.f*d+b.m*f+b.g*i,i=b.h*d+b.j*f+b.s*i,this.qa=y,this.ra=v,this.sa=i,i=b.o*a+b.i*o+b.l*h,d=b.f*a+b.m*o+b.g*h,f=b.h*a+b.j*o+b.s*h,this.Ab=i,this.Bb=d,this.Cb=f,i=b.o*s+b.i*r+b.l*n,d=b.f*s+b.m*r+b.g*n,b=b.h*s+b.j*r+b.s*n,this.lc=i,this.mc=d,this.nc=b,b=e.o*c+e.i*l+e.l*u,s=e.f*c+e.m*l+e.g*u,c=e.h*c+e.j*l+e.s*u,this.nb=b,this.ob=s,this.pb=c,b=e.o*a+e.i*o+e.l*h,c=e.f*a+e.m*o+e.g*h,a=e.h*a+e.j*o+e.s*h,this.gh=b,this.hh=c,this.ih=a,a=e.o*m+e.i*g+e.l*p,o=e.f*m+e.m*g+e.g*p,e=e.h*m+e.j*g+e.s*p,this.Mc=a,this.Nc=o,this.Oc=e,this.Oi=this.Pl=this.Ni=0,this.Lm=this.Km=this.Jm=!1,this.Yk=t.springDamper1.clone(),this.Zk=t.springDamper2.clone(),this.Qk=t.limitMotor1.clone(),this.Rk=t.limitMotor2.clone()}function v(){this.lowerLimit=1,this.motorForce=this.upperLimit=0}function b(){this.dampingRatio=this.frequency=0,this.useSymplecticEuler=!1}function x(){D.call(this),this.springDamper=new b}function _(t){O.call(this,t,0),this.Ce=t.springDamper.clone()}function M(){this.lowerLimit=1,this.motorTorque=this.upperLimit=0}function w(){D.call(this),this.localAxis1=new bt(1,0,0),this.localAxis2=new bt(1,0,0),this.springDamper=new b,this.limitMotor=new M}function S(t){O.call(this,t,1);var e,i,s,r,n,a,o,h,c=t.localAxis1;this.qa=c.x,this.ra=c.y,this.sa=c.z,c=t.localAxis2,this.nb=c.x,this.ob=c.y,this.pb=c.z,this.qa*this.qa+this.ra*this.ra+this.sa*this.sa?(0<(c=this.qa*this.qa+this.ra*this.ra+this.sa*this.sa)&&(c=1/Math.sqrt(c)),this.qa*=c,this.ra*=c,this.sa*=c):(this.qa=1,this.sa=this.ra=0),this.nb*this.nb+this.ob*this.ob+this.pb*this.pb?(0<(c=this.nb*this.nb+this.ob*this.ob+this.pb*this.pb)&&(c=1/Math.sqrt(c)),this.nb*=c,this.ob*=c,this.pb*=c):(this.nb=1,this.pb=this.ob=0),-.999999999>(i=this.qa*this.nb+this.ra*this.ob+this.sa*this.pb)?(c=this.qa,e=this.ra,n=(s=this.sa)*s,(i=c*c)<(r=e*e)?i<n?(i=0,s*=r=1/Math.sqrt(r+n),r*=-e):(i=e*(r=1/Math.sqrt(i+r)),s=-c*r,r=0):r<n?(i=-s*(r=1/Math.sqrt(n+i)),s=0,r*=c):(i=e*(r=1/Math.sqrt(i+r)),s=-c*r,r=0),c=i,e=s,i=r,s=0):(c=this.ra*this.pb-this.sa*this.ob,e=this.sa*this.nb-this.qa*this.pb,r=this.qa*this.ob-this.ra*this.nb,c*=i=.5/(s=Math.sqrt(.5*(1+i))),e*=i,i*=r),a=e,e=s,h=c*(u=2*c);var l=a*(n=2*a);r=i*(s=2*i),i=c*n,o=a*s,a=c*s;var u=e*u,p=e*n;c=1-l-r,e=i-(n=e*s),s=a+p,i+=n,r=1-h-r,n=o-u,a-=p,o+=u,h=1-h-l;var d=(l=this.qa)*l,f=(u=this.ra)*u,m=(p=this.sa)*p;d<f?d<m?(d=1/Math.sqrt(f+m),this.Ab=0,this.Bb=p*d,this.Cb=-u*d):(d=1/Math.sqrt(d+f),this.Ab=u*d,this.Bb=-l*d,this.Cb=0):f<m?(d=1/Math.sqrt(m+d),this.Ab=-p*d,this.Bb=0,this.Cb=l*d):(d=1/Math.sqrt(d+f),this.Ab=u*d,this.Bb=-l*d,this.Cb=0),this.lc=this.ra*this.Cb-this.sa*this.Bb,this.mc=this.sa*this.Ab-this.qa*this.Cb,this.nc=this.qa*this.Bb-this.ra*this.Ab,l=c*this.qa+e*this.ra+s*this.sa,u=i*this.qa+r*this.ra+n*this.sa,p=a*this.qa+o*this.ra+h*this.sa,this.nb=l,this.ob=u,this.pb=p,l=c*this.Ab+e*this.Bb+s*this.Cb,u=i*this.Ab+r*this.Bb+n*this.Cb,p=a*this.Ab+o*this.Bb+h*this.Cb,this.gh=l,this.hh=u,this.ih=p,c=c*this.lc+e*this.mc+s*this.nc,e=i*this.lc+r*this.mc+n*this.nc,s=a*this.lc+o*this.mc+h*this.nc,this.Mc=c,this.Nc=e,this.Oc=s,this.Fe=this.Ee=this.angle=0,this.da=new B(this),this.Ce=t.springDamper.clone(),this.Rh=t.limitMotor.clone()}function A(){D.call(this),this.localTwistAxis1=new bt(1,0,0),this.localTwistAxis2=new bt(1,0,0),this.localSwingAxis1=new bt(0,1,0),this.twistSpringDamper=new b,this.swingSpringDamper=new b,this.twistLimitMotor=new M,this.maxSwingAngle2=this.maxSwingAngle1=3.14159265358979}function T(t){O.call(this,t,E.RAGDOLL);var e,i,s,r,n=t.localTwistAxis1;if(this.qa=n.x,this.ra=n.y,this.sa=n.z,n=t.localSwingAxis1,this.Ab=n.x,this.Bb=n.y,this.Cb=n.z,n=t.localTwistAxis2,this.nb=n.x,this.ob=n.y,this.pb=n.z,this.qa*this.qa+this.ra*this.ra+this.sa*this.sa?(0<(n=this.qa*this.qa+this.ra*this.ra+this.sa*this.sa)&&(n=1/Math.sqrt(n)),this.qa*=n,this.ra*=n,this.sa*=n):(this.qa=1,this.sa=this.ra=0),this.lc=this.ra*this.Cb-this.sa*this.Bb,this.mc=this.sa*this.Ab-this.qa*this.Cb,this.nc=this.qa*this.Bb-this.ra*this.Ab,this.lc*this.lc+this.mc*this.mc+this.nc*this.nc)0<(n=this.lc*this.lc+this.mc*this.mc+this.nc*this.nc)&&(n=1/Math.sqrt(n)),this.lc*=n,this.mc*=n,this.nc*=n,this.Ab=this.mc*this.sa-this.nc*this.ra,this.Bb=this.nc*this.qa-this.lc*this.sa,this.Cb=this.lc*this.ra-this.mc*this.qa;else{n=this.qa;var a,o=this.ra,h=this.sa,c=o*o,l=h*h;(a=n*n)<c?a<l?(a=1/Math.sqrt(c+l),this.Ab=0,this.Bb=h*a,this.Cb=-o*a):(a=1/Math.sqrt(a+c),this.Ab=o*a,this.Bb=-n*a,this.Cb=0):c<l?(a=1/Math.sqrt(l+a),this.Ab=-h*a,this.Bb=0,this.Cb=n*a):(a=1/Math.sqrt(a+c),this.Ab=o*a,this.Bb=-n*a,this.Cb=0),this.lc=this.ra*this.Cb-this.sa*this.Bb,this.mc=this.sa*this.Ab-this.qa*this.Cb,this.nc=this.qa*this.Bb-this.ra*this.Ab}-.999999999>(a=this.qa*this.nb+this.ra*this.ob+this.sa*this.pb)?(n=this.qa,o=this.ra,l=(h=this.sa)*h,(a=n*n)<(c=o*o)?a<l?(a=0,h*=c=1/Math.sqrt(c+l),c*=-o):(a=o*(c=1/Math.sqrt(a+c)),h=-n*c,c=0):c<l?(a=-h*(c=1/Math.sqrt(l+a)),h=0,c*=n):(a=o*(c=1/Math.sqrt(a+c)),h=-n*c,c=0),n=a,o=h,a=c,h=0):(n=this.ra*this.pb-this.sa*this.ob,o=this.sa*this.nb-this.qa*this.pb,c=this.qa*this.ob-this.ra*this.nb,n*=a=.5/(h=Math.sqrt(.5*(1+a))),o*=a,a*=c),s=o,l=a,o=h,a=n*(u=2*n),c=s*(i=2*s),e=l*(h=2*l),l=n*i,r=s*h,s=n*h;var u=o*u,p=o*i;n=1-c-e,o=l-(i=o*h),h=s+p,l+=i,e=1-a-e,i=r-u,s-=p,r+=u,a=1-a-c,c=n*this.qa+o*this.ra+h*this.sa,u=l*this.qa+e*this.ra+i*this.sa,p=s*this.qa+r*this.ra+a*this.sa,this.nb=c,this.ob=u,this.pb=p,c=n*this.Ab+o*this.Bb+h*this.Cb,u=l*this.Ab+e*this.Bb+i*this.Cb,p=s*this.Ab+r*this.Bb+a*this.Cb,this.gh=c,this.hh=u,this.ih=p,n=n*this.lc+o*this.mc+h*this.nc,o=l*this.lc+e*this.mc+i*this.nc,h=s*this.lc+r*this.mc+a*this.nc,this.Mc=n,this.Nc=o,this.Oc=h,this.fl=t.twistSpringDamper.clone(),this.el=t.twistLimitMotor.clone(),this.$k=t.swingSpringDamper.clone(),this.bk=t.maxSwingAngle1,this.ck=t.maxSwingAngle2,this.bk<yt.minRagdollMaxSwingAngle&&(this.bk=yt.minRagdollMaxSwingAngle),this.ck<yt.minRagdollMaxSwingAngle&&(this.ck=yt.minRagdollMaxSwingAngle),this.nl=new M,this.nl.lowerLimit=-1,this.ii=this.hi=this.gi=this.le=this.ke=this.je=this.Nj=this.tj=this.kj=this.nl.upperLimit=0}function C(){D.call(this),this.localAxis1=new bt(1,0,0),this.localAxis2=new bt(1,0,0),this.limitMotor=new v,this.springDamper=new b}function L(t){O.call(this,t,E.PRISMATIC);var e,i,s,r,n,a,o,h,c=t.localAxis1;this.qa=c.x,this.ra=c.y,this.sa=c.z,c=t.localAxis2,this.nb=c.x,this.ob=c.y,this.pb=c.z,this.qa*this.qa+this.ra*this.ra+this.sa*this.sa?(0<(c=this.qa*this.qa+this.ra*this.ra+this.sa*this.sa)&&(c=1/Math.sqrt(c)),this.qa*=c,this.ra*=c,this.sa*=c):(this.qa=1,this.sa=this.ra=0),this.nb*this.nb+this.ob*this.ob+this.pb*this.pb?(0<(c=this.nb*this.nb+this.ob*this.ob+this.pb*this.pb)&&(c=1/Math.sqrt(c)),this.nb*=c,this.ob*=c,this.pb*=c):(this.nb=1,this.pb=this.ob=0),-.999999999>(i=this.qa*this.nb+this.ra*this.ob+this.sa*this.pb)?(c=this.qa,e=this.ra,n=(s=this.sa)*s,(i=c*c)<(r=e*e)?i<n?(i=0,s*=r=1/Math.sqrt(r+n),r*=-e):(i=e*(r=1/Math.sqrt(i+r)),s=-c*r,r=0):r<n?(i=-s*(r=1/Math.sqrt(n+i)),s=0,r*=c):(i=e*(r=1/Math.sqrt(i+r)),s=-c*r,r=0),c=i,e=s,i=r,s=0):(c=this.ra*this.pb-this.sa*this.ob,e=this.sa*this.nb-this.qa*this.pb,r=this.qa*this.ob-this.ra*this.nb,c*=i=.5/(s=Math.sqrt(.5*(1+i))),e*=i,i*=r),a=e,e=s,h=c*(u=2*c);var l=a*(n=2*a);r=i*(s=2*i),i=c*n,o=a*s,a=c*s;var u=e*u,p=e*n;c=1-l-r,e=i-(n=e*s),s=a+p,i+=n,r=1-h-r,n=o-u,a-=p,o+=u,h=1-h-l;var d=(l=this.qa)*l,f=(u=this.ra)*u,m=(p=this.sa)*p;d<f?d<m?(d=1/Math.sqrt(f+m),this.Ab=0,this.Bb=p*d,this.Cb=-u*d):(d=1/Math.sqrt(d+f),this.Ab=u*d,this.Bb=-l*d,this.Cb=0):f<m?(d=1/Math.sqrt(m+d),this.Ab=-p*d,this.Bb=0,this.Cb=l*d):(d=1/Math.sqrt(d+f),this.Ab=u*d,this.Bb=-l*d,this.Cb=0),this.lc=this.ra*this.Cb-this.sa*this.Bb,this.mc=this.sa*this.Ab-this.qa*this.Cb,this.nc=this.qa*this.Bb-this.ra*this.Ab,l=c*this.qa+e*this.ra+s*this.sa,u=i*this.qa+r*this.ra+n*this.sa,p=a*this.qa+o*this.ra+h*this.sa,this.nb=l,this.ob=u,this.pb=p,l=c*this.Ab+e*this.Bb+s*this.Cb,u=i*this.Ab+r*this.Bb+n*this.Cb,p=a*this.Ab+o*this.Bb+h*this.Cb,this.gh=l,this.hh=u,this.ih=p,c=c*this.lc+e*this.mc+s*this.nc,e=i*this.lc+r*this.mc+n*this.nc,s=a*this.lc+o*this.mc+h*this.nc,this.Mc=c,this.Nc=e,this.Oc=s,this.da=new B(this),this.Fe=this.Ee=this.rh=this.Ef=this.Df=this.eg=0,this.Ce=t.springDamper.clone(),this.Rh=t.limitMotor.clone()}function E(){}function z(t){this.Pk=t}function R(){this.ub=this.ad=this.ta=0}function B(t){this.$=t,this.oe=this.ne=this.me=this.Sd=this.Rd=this.Qd=this.ed=this.dd=this.cd=0}function P(){D.call(this),this.localAxis1=new bt(1,0,0),this.localAxis2=new bt(1,0,0),this.translationalLimitMotor=new v,this.translationalSpringDamper=new b,this.rotationalLimitMotor=new M,this.rotationalSpringDamper=new b}function D(){this.rigidBody2=this.rigidBody1=null,this.localAnchor1=new bt,this.localAnchor2=new bt,this.allowCollision=!1,this.solverType=yt.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=yt.defaultJointPositionCorrectionAlgorithm,this.breakTorque=this.breakForce=0}function I(t){O.call(this,t,2);var e,i,s,r,n,a,o,h,c=t.localAxis1;this.qa=c.x,this.ra=c.y,this.sa=c.z,c=t.localAxis2,this.nb=c.x,this.ob=c.y,this.pb=c.z,this.qa*this.qa+this.ra*this.ra+this.sa*this.sa?(0<(c=this.qa*this.qa+this.ra*this.ra+this.sa*this.sa)&&(c=1/Math.sqrt(c)),this.qa*=c,this.ra*=c,this.sa*=c):(this.qa=1,this.sa=this.ra=0),this.nb*this.nb+this.ob*this.ob+this.pb*this.pb?(0<(c=this.nb*this.nb+this.ob*this.ob+this.pb*this.pb)&&(c=1/Math.sqrt(c)),this.nb*=c,this.ob*=c,this.pb*=c):(this.nb=1,this.pb=this.ob=0),-.999999999>(i=this.qa*this.nb+this.ra*this.ob+this.sa*this.pb)?(c=this.qa,e=this.ra,n=(s=this.sa)*s,(i=c*c)<(r=e*e)?i<n?(i=0,s*=r=1/Math.sqrt(r+n),r*=-e):(i=e*(r=1/Math.sqrt(i+r)),s=-c*r,r=0):r<n?(i=-s*(r=1/Math.sqrt(n+i)),s=0,r*=c):(i=e*(r=1/Math.sqrt(i+r)),s=-c*r,r=0),c=i,e=s,i=r,s=0):(c=this.ra*this.pb-this.sa*this.ob,e=this.sa*this.nb-this.qa*this.pb,r=this.qa*this.ob-this.ra*this.nb,c*=i=.5/(s=Math.sqrt(.5*(1+i))),e*=i,i*=r),a=e,e=s,h=c*(u=2*c);var l=a*(n=2*a);r=i*(s=2*i),i=c*n,o=a*s,a=c*s;var u=e*u,p=e*n;c=1-l-r,e=i-(n=e*s),s=a+p,i+=n,r=1-h-r,n=o-u,a-=p,o+=u,h=1-h-l;var d=(l=this.qa)*l,f=(u=this.ra)*u,m=(p=this.sa)*p;d<f?d<m?(d=1/Math.sqrt(f+m),this.Ab=0,this.Bb=p*d,this.Cb=-u*d):(d=1/Math.sqrt(d+f),this.Ab=u*d,this.Bb=-l*d,this.Cb=0):f<m?(d=1/Math.sqrt(m+d),this.Ab=-p*d,this.Bb=0,this.Cb=l*d):(d=1/Math.sqrt(d+f),this.Ab=u*d,this.Bb=-l*d,this.Cb=0),this.lc=this.ra*this.Cb-this.sa*this.Bb,this.mc=this.sa*this.Ab-this.qa*this.Cb,this.nc=this.qa*this.Bb-this.ra*this.Ab,l=c*this.qa+e*this.ra+s*this.sa,u=i*this.qa+r*this.ra+n*this.sa,p=a*this.qa+o*this.ra+h*this.sa,this.nb=l,this.ob=u,this.pb=p,l=c*this.Ab+e*this.Bb+s*this.Cb,u=i*this.Ab+r*this.Bb+n*this.Cb,p=a*this.Ab+o*this.Bb+h*this.Cb,this.gh=l,this.hh=u,this.ih=p,c=c*this.lc+e*this.mc+s*this.nc,e=i*this.lc+r*this.mc+n*this.nc,s=a*this.lc+o*this.mc+h*this.nc,this.Mc=c,this.Nc=e,this.Oc=s,this.Ef=this.Df=this.eg=this.Fe=this.Ee=this.angle=0,this.da=new B(this),this.dl=t.translationalSpringDamper.clone(),this.cl=t.translationalLimitMotor.clone(),this.Xk=t.rotationalSpringDamper.clone(),this.Wk=t.rotationalLimitMotor.clone()}function O(t,e){switch(this.rb=new z(this),this.sb=new z(this),this.Hc=yt.defaultJointPositionCorrectionAlgorithm,this.Lb=e,this.oc=null,this.C=t.rigidBody1,this.D=t.rigidBody2,this.Ak=t.allowCollision,this.Yi=t.breakForce,this.Zi=t.breakTorque,t.solverType){case 0:this.jk=new n(this);break;case 1:this.jk=new h(this)}for(e=t.localAnchor1,this.dj=e.x,this.ej=e.y,this.fj=e.z,t=t.localAnchor2,this.gj=t.x,this.hj=t.y,this.ij=t.z,this.Oc=this.Nc=this.Mc=this.ih=this.hh=this.gh=this.pb=this.ob=this.nb=this.nc=this.mc=this.lc=this.Cb=this.Bb=this.Ab=this.sa=this.ra=this.qa=this.Tf=this.Sf=this.Rf=this.Qf=this.Pf=this.Of=this.Xb=this.Wb=this.Vb=this.Ub=this.Tb=this.Sb=0,this.Pb=Array(yt.maxJacobianRows),t=0,e=yt.maxJacobianRows;t<e;){var i=t++;this.Pb[i]=new R}}function F(){this.Aa=new V,this.fb=this.motorSpeed=this.Ha=this.Ia=this.Ma=this.Fa=0,this.ta=null}function G(){this.Re=this.Qe=null,this.Ka=0,this.rows=Array(yt.maxJacobianRows);for(var t=0,e=this.rows.length;t<e;){var i=t++;this.rows[i]=new F}}function N(){this.Ng=new V,this.Lj=new V,this.Kj=new V,this.friction=this.Ma=this.Fa=0,this.ta=null}function j(){this.Re=this.Qe=null,this.Ka=0,this.rows=Array(yt.maxManifoldPoints);for(var t=0,e=this.rows.length;t<e;){var i=t++;this.rows[i]=new N}}function V(){this.xc=this.ga=this.fa=this.ea=this.ca=this.ba=this.aa=this.Da=this.Ca=this.Ba=this.xa=this.wa=this.va=0}function U(t){this.Ja=t,this.Gl=0,this.Hl=Array(yt.maxManifoldPoints),t=0;for(var e=yt.maxManifoldPoints;t<e;){var i=t++;this.Hl[i]=new k}}function k(){this.Gc=this.Od=this.Nd=this.Md=this.Ld=this.Kd=this.Jd=this.gc=this.fc=this.ec=this.Fb=this.Eb=this.Db=this.sf=this.rf=this.qf=this.pf=this.nf=this.mf=0,this.ae=new W,this.lf=this.Pe=!1,this.Cc=-1}function H(){this.be=this.Xi=this.Wi=this.Vi=this.nj=this.mj=this.lj=this.yg=this.xg=this.wg=0,this.wc=Array(yt.maxManifoldPoints);for(var t=0,e=yt.maxManifoldPoints;t<e;){var i=t++;this.wc[i]=new k}}function W(){this.ff=this.ef=this.df=this.ub=this.yc=this.zc=this.bd=0}function q(t){this.jk=new a(this),this.Ja=t}function $(){}function J(){this.D=this.C=null,this.Nf=!1}function X(){}function Y(){this.position=new bt,this.normal=new bt,this.shape=null,this.fraction=1,this.position.Z(),this.normal.Z(),this.hit=!1}function K(){}function Z(){}function Q(){}function tt(){this.u=new Wt,this.Ql=null}function et(){this.Mi=new Gt,this.vj=new vt,this.eg=new bt,this.Z=new bt,this.em=this.xj=null}function it(){this.Mi=new Gt,this.vj=new bt,this.end=new bt,this.xj=null}function st(t,e){switch(null==t&&(t=2),t){case 1:this.jc=new Kt;break;case 2:this.jc=new Yt}this.Kh=new at(this.jc),null==e&&(e=new bt(0,-9.80665,0)),this.Fk=new bt(e.x,e.y,e.z),this.zi=this.Ph=this.Ei=this.uf=null,this.ek=this.Sk=this.zg=this.jj=0,this.Uk=10,this.Tk=5,this.gk=new it,this.aj=new et,this.yk=new tt,this.vg=new nt,this.af=Array(yt.islandInitialConstraintArraySize),this.ph=Array(yt.islandInitialRigidBodyArraySize),this.Sh=new rt,this.Ga=new lt,this.Xl=0}function rt(){this.invDt=this.dt=0,this.dtRatio=1}function nt(){this.Jf=Array(yt.islandInitialRigidBodyArraySize),this.Kf=Array(yt.islandInitialConstraintArraySize),this.Eh=Array(yt.islandInitialConstraintArraySize),this.Dh=Array(yt.islandInitialConstraintArraySize),this.vh=this.wh=this.If=this.Hf=0}function at(t){this.jc=t,this.Xm=new Ot,this.Bi=0}function ot(){this.Qc=this.Zd=this.M=this.ia=null}function ht(){this.ia=this.M=null,this.rb=new ot,this.sb=new ot,this.Lh=this.D=this.C=this.$b=this.Zb=null,this.$i=new Et,this.Ym=new It,this.ik=this.Zj=!1,this.Ja=new H,this.Zl=new U(this.Ja),this.Ye=new q(this.Ja),this.Td=!1}function ct(t,e,i,s){null==s&&(s=1),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.x=t,this.y=e,this.z=i,this.w=s,ct.numCreations++}function lt(){this.b=Array(256),this.c=0,this.bb=Array(256),this.eb=0,this.Lf=Array(256),this.dg=0,this.Wd=Array(256),this.ee=0}function ut(){}function pt(t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m){null==m&&(m=1),null==f&&(f=0),null==d&&(d=0),null==p&&(p=0),null==u&&(u=0),null==l&&(l=1),null==c&&(c=0),null==h&&(h=0),null==o&&(o=0),null==a&&(a=0),null==n&&(n=1),null==r&&(r=0),null==s&&(s=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=1),this.e00=t,this.e01=e,this.e02=i,this.e03=s,this.e10=r,this.e11=n,this.e12=a,this.e13=o,this.e20=h,this.e21=c,this.e22=l,this.e23=u,this.e30=p,this.e31=d,this.e32=f,this.e33=m,pt.numCreations++}function dt(t,e,i,s,r,n,a,o,h){null==h&&(h=1),null==o&&(o=0),null==a&&(a=0),null==n&&(n=0),null==r&&(r=1),null==s&&(s=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=1),this.e00=t,this.e01=e,this.e02=i,this.e10=s,this.e11=r,this.e12=n,this.e20=a,this.e21=o,this.e22=h,dt.numCreations++}function ft(){}function mt(){}function gt(){this.Na=Array(4),this.jb=Array(4),this.qb=Array(4),this.uj=Array(3),this.uj[0]=new bt(1,0,0),this.uj[1]=new bt(0,1,0),this.uj[2]=new bt(0,0,1),this.bo=new bt,this.co=new bt,this.Vn=new bt,this.Un=new bt,this.ao=new vt;for(var t=0;4>t;){var e=t++;this.Na[e]=new bt,this.jb[e]=new bt,this.qb[e]=new bt}this.dir=new bt,this.closest=new bt,this.closestPoint1=new bt,this.closestPoint2=new bt,this.Og=new wt}function yt(){}function vt(){this.B=this.A=this.v=0,this.o=1,this.i=this.h=this.f=0,this.m=1,this.g=this.l=this.j=0,this.s=1}function bt(t,e,i){null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.x=t,this.y=e,this.z=i,bt.numCreations++}function xt(){this.Il=new bt}function _t(){this.xd=new bt,this.jb=new bt,this.qb=new bt}function Mt(){this.id=++Mt.Mb,this.ia=this.M=null,this.dk=new bt,this.bl=this.Wj=0,this.rj=!1,this.zb=Array(3),this.Ge=Array(3),this.We=Array(3),this.fi=new bt,this.Ai=Array(3),this.Ai[0]=1,this.Ai[1]=2,this.Ai[2]=0}function wt(){this.zb=Array(yt.maxEPAVertices),this.mi=new bt,this.Ne=0,this.Rc=this.jd=null,this.lh=0,this.bf=this.De=null}function St(){this.Sg=!1}function At(t){this.Sg=t}function Tt(t){this.Sg=t}function Ct(){this.Sg=!1}function Lt(){this.Sg=!1}function Et(){}function zt(){this.hc=this.Tc=this.Dj=this.w=0,this.Bc=Array(8),this.ic=Array(8);for(var t=0;8>t;){var e=t++;this.Bc[e]=new Rt,this.ic[e]=new Rt}}function Rt(){this.Qa=this.Pa=this.Oa=this.y=this.x=0}function Bt(){this.Sg=!1,this.Dg=new zt}function Pt(t){this.Sg=t}function Dt(){this.position1=new bt,this.position2=new bt,this.id=this.depth=0}function It(){this.numPoints=0,this.normal=new bt,this.points=Array(yt.maxManifoldPoints),this.incremental=!1;for(var t=0,e=yt.maxManifoldPoints;t<e;){var i=t++;this.points[i]=new Dt}}function Ot(){this.Jb=Array(8);for(var t=0;6>t;){var e=t++;this.Jb[e]=Array(8)}t=new Ct,this.Jb[0][0]=new St,this.Jb[0][1]=new Tt(!1),this.Jb[0][2]=t,this.Jb[0][3]=t,this.Jb[0][4]=new At(!1),this.Jb[0][5]=t,this.Jb[1][0]=new Tt(!0),this.Jb[1][1]=new Bt,this.Jb[1][2]=t,this.Jb[1][3]=t,this.Jb[1][4]=t,this.Jb[1][5]=t,this.Jb[2][0]=t,this.Jb[2][1]=t,this.Jb[2][2]=t,this.Jb[2][3]=t,this.Jb[2][4]=t,this.Jb[2][5]=t,this.Jb[3][0]=t,this.Jb[3][1]=t,this.Jb[3][2]=t,this.Jb[3][3]=t,this.Jb[3][4]=t,this.Jb[3][5]=t,this.Jb[4][0]=new At(!0),this.Jb[4][1]=t,this.Jb[4][2]=t,this.Jb[4][3]=t,this.Jb[4][4]=new Lt,this.Jb[4][5]=t,this.Jb[5][0]=t,this.Jb[5][1]=t,this.Jb[5][2]=t,this.Jb[5][3]=t,this.Jb[5][4]=t,this.Jb[5][5]=t}function Ft(t){re.call(this,0),this.Rb=this.ab=t,this.Oe()}function Gt(){this.position=new bt,this.normal=new bt,this.fraction=0}function Nt(){}function jt(t,e){re.call(this,2),this.ab=t,this.Ib=e,this.Oe()}function Vt(t){re.call(this,5),this.Ne=t.length,this.zb=Array(this.Ne),this.Bg=Array(this.Ne);for(var e=0,i=this.Ne;e<i;){var s=e++;this.zb[s]=t[s],this.Bg[s]=new bt}this.$l=!0,this.Oe()}function Ut(t,e){re.call(this,3),this.ab=t,this.Ib=e,this.uk=t/Math.sqrt(t*t+4*e*e),this.kk=2*e/Math.sqrt(t*t+4*e*e),this.Oe()}function kt(t,e){re.call(this,4),this.ab=t,this.Ib=e,this.Rb=this.ab,this.Oe()}function Ht(t){re.call(this,1),this.Ke=t.x,this.Le=t.y,this.Me=t.z,this.Gk=t.x,this.Jk=this.Ik=this.Hk=0,this.Kk=t.y,this.Nk=this.Mk=this.Lk=0,this.Ok=t.z,this.Oe(),t=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y,this.Rb>.2*t&&(this.Rb=.2*t)}function Wt(){this.la=this.ka=this.ja=this.oa=this.na=this.ma=0}function qt(){this.Qb=null,this.fk=0,this.Gi=new $t,this.gf=this.cg=this.Xc=null,this.fi=Array(1024)}function $t(){this.Vl=0,this.Rj=!1}function Jt(t,e){Qt.call(this,t,e),this.Qh=null,this.jh=!1}function Xt(){this.Uf=this.Vf=this.M=null,this.F=Array(2),this.La=0,this.Ea=null,this.O=0,this.tb=null,this.I=this.H=this.G=this.L=this.K=this.J=0}function Yt(){ae.call(this,2),this.Yj=!0,this.ge=new qt,this.hf=Array(1024),this.Gf=0}function Kt(){ae.call(this,1),this.Yj=!1}function Zt(){this.nh=this.mh=null}function Qt(t,e){this.userData=t,this.Cc=e,this.M=this.ia=null,this.I=this.H=this.G=this.L=this.K=this.J=0}function te(){}function ee(){}function ie(){re.call(this,-1),this.min=new bt,this.max=new bt}function se(){re.call(this,-1)}function re(t){ne.call(this,t),this.Rb=yt.defaultGJKMargin,this.$l=!1}function ne(t){this.Lb=t,this.yf=0}function ae(t){this.Lb=t,this.Ci=0,this.ce=this.$e=this.Be=null,this.Yj=!1,this.oj=0,this.oh=null,this.Ul=0,this.Vj=new se,this.u=new ie,this.Wf=new vt,this.Z=new bt,this.Mi=new Gt}function oe(t,e){function i(){}for(var s in i.prototype=t,t=new i,e)t[s]=e[s];return e.toString!==Object.prototype.toString&&(t.toString=e.toString),t}ae.prototype={Vh:function(){return null},Wh:function(){},wd:function(){},Mb:function(t,e){return t.J<e.G&&t.G>e.J&&t.K<e.H&&t.H>e.K&&t.L<e.I&&t.I>e.L},Ii:function(){},ua:function(){return this.ce},Hb:function(){return this.Yj},cb:function(){return this.oj},Vd:function(){},Bf:function(){},qh:function(){}},ne.prototype={Oe:function(){},Nb:function(){},Di:function(){return!1},cb:function(){return this.Lb},ua:function(){return this.yf},Vd:function(t,e,i,s){var r,n,a,o,h,c,l,u;return r=t.x,n=t.y,t=t.z,a=e.x,o=e.y,e=e.z,r-=i.v,n-=i.A,t-=i.B,a-=i.v,o-=i.A,e-=i.B,!!this.Di(i.o*r+i.i*n+i.l*t,i.f*r+i.m*n+i.g*t,i.h*r+i.j*n+i.s*t,i.o*a+i.i*o+i.l*e,i.f*a+i.m*o+i.g*e,i.h*a+i.j*o+i.s*e,s)&&(r=(e=s.position).x,n=e.y,a=e.z,o=(e=s.normal).x,h=e.y,c=e.z,l=i.o*r+i.f*n+i.h*a,u=i.i*r+i.m*n+i.j*a,a=i.l*r+i.g*n+i.s*a,e=i.o*o+i.f*h+i.h*c,t=i.i*o+i.m*h+i.j*c,o=i.l*o+i.g*h+i.s*c,r=l+i.v,n=u+i.A,a+=i.B,(i=s.position).x=r,i.y=n,i.z=a,(s=s.normal).x=e,s.y=t,s.z=o,!0)}},re.ua=ne,re.prototype=oe(ne.prototype,{un:function(){return this.Rb},Zn:function(t){0>t&&(t=0),this.Rb=t},Pd:function(){},Vd:function(t,e,i,s){return this.$l?gt.cb.Vd(this,i,t,e,s):ne.prototype.Vd.call(this,t,e,i,s)}}),se.ua=re,se.prototype=oe(re.prototype,{za:function(t,e,i){var s,r,n,a;this.ln=t,s=i.x,r=i.y,n=i.z,i=e.o*s+e.i*r+e.l*n,a=e.f*s+e.m*r+e.g*n,e=e.h*s+e.j*r+e.s*n,(s=this.Fl=new bt).x=i,s.y=a,s.z=e,this.Rb=t.Rb},Pd:function(t,e){this.ln.Pd(t,e);var i=this.Fl;if(0<t.x*i.x+t.y*i.y+t.z*i.z){t=this.Fl,i=e.y+t.y;var s=e.z+t.z;e.x+=t.x,e.y=i,e.z=s}}}),ie.ua=re,ie.prototype=oe(re.prototype,{Pd:function(t,e){e.x=0<t.x?this.max.x:this.min.x,e.y=0<t.y?this.max.y:this.min.y,e.z=0<t.z?this.max.z:this.min.z}}),ee.prototype={process:function(){}},Qt.prototype={Hb:function(){return this.Cc},ua:function(){var t=new Wt;return t.ma=this.J,t.na=this.K,t.oa=this.L,t.ja=this.G,t.ka=this.H,t.la=this.I,t},cb:function(t){t.ma=this.J,t.na=this.K,t.oa=this.L,t.ja=this.G,t.ka=this.H,t.la=this.I}},Zt.prototype={ua:function(){return this.mh},cb:function(){return this.nh},Hb:function(){return this.M}},Kt.ua=ae,Kt.prototype=oe(ae.prototype,{Vh:function(t,e){return t=new Qt(t,this.Ul++),this.Ci++,null==this.Be?this.Be=t:(this.$e.M=t,t.ia=this.$e),this.$e=t,t.J=e.ma,t.K=e.na,t.L=e.oa,t.G=e.ja,t.H=e.ka,t.I=e.la,t},Wh:function(t){this.Ci--;var e=t.ia,i=t.M;null!=e&&(e.M=i),null!=i&&(i.ia=e),t==this.Be&&(this.Be=this.Be.M),t==this.$e&&(this.$e=this.$e.ia),t.M=null,t.ia=null,t.userData=null},wd:function(t,e){t.J=e.ma,t.K=e.na,t.L=e.oa,t.G=e.ja,t.H=e.ka,t.I=e.la},Ii:function(){var t=this.ce;if(null!=t){for(;t.mh=null,t.nh=null,null!=(t=t.M););this.ce.M=this.oh,this.oh=this.ce,this.ce=null}for(this.oj=0,t=this.Be;null!=t;){for(var e=t.M,i=t.M;null!=i;){var s=i.M;if(this.oj++,t.J<i.G&&t.G>i.J&&t.K<i.H&&t.H>i.K&&t.L<i.I&&t.I>i.L){var r=this.oh;null!=r?(this.oh=r.M,r.M=null):r=new Zt,null!=this.ce&&(r.M=this.ce),this.ce=r,r.mh=t,r.nh=i}i=s}t=e}},Vd:function(t,e,i){var s,r,n,a;s=t.x,r=t.y,t=t.z,n=e.x,a=e.y,e=e.z;for(var o=this.Be;null!=o;){var h=o.M,c=(T=s)<(x=n)?T:x,l=(_=r)<(w=a)?_:w,u=(M=t)<(A=e)?M:A,p=_>w?_:w,d=M>A?M:A,f=o.J,m=o.K,g=o.L,y=o.G,v=o.H,b=o.I;if(f>(T>x?T:x)||y<c||m>p||v<l||g>d||b<u)M=!1;else{var x,_,M,w=w-_,S=A-M,A=0>(x-=T)?-x:x,T=(l=.5*(y-f),d=.5*(b-g),T-.5*(y+f));M=!(M=!!(M=0<(0>(g=(_-=.5*(v+m))*S-(M-=.5*(b+g))*w)?-g:g)-((u=.5*(v-m))*(p=0>S?-S:S)+d*(c=0>w?-w:w))||0<(0>(M=M*x-T*S)?-M:M)-(d*A+l*p))||0<(0>(M=T*w-_*x)?-M:M)-(l*c+u*A))}M&&i.process(o),o=h}},Bf:function(t,e,i,s){for(var r=this.Be;null!=r;){var n=r.M,a=this.u.min;a.x=r.J,a.y=r.K,a.z=r.L,(a=this.u.max).x=r.G,a.y=r.H,a.z=r.I,this.Vj.za(t,e,i),0==(a=gt.cb).zj(this.Vj,this.u,e,this.Wf,null,!1)&&0>=a.distance&&s.process(r),r=n}},qh:function(t,e){for(var i=this.Be;null!=i;){var s=i.M;t.ma<i.G&&t.ja>i.J&&t.na<i.H&&t.ka>i.K&&t.oa<i.I&&t.la>i.L&&e.process(i),i=s}}}),Yt.ua=ae,Yt.prototype=oe(ae.prototype,{sh:function(t,e){this.oj++;var i=0==t.O,s=0==e.O;t==e?i||(this.sh(t.F[0],e),this.sh(t.F[1],e)):t.J<e.G&&t.G>e.J&&t.K<e.H&&t.H>e.K&&t.L<e.I&&t.I>e.L&&(i&&s?(t=t.tb,e=e.tb,null!=(i=this.oh)?(this.oh=i.M,i.M=null):i=new Zt,null!=this.ce&&(i.M=this.ce),this.ce=i,i.mh=t,i.nh=e):s||t.O>e.O?(this.sh(t.F[0],e),this.sh(t.F[1],e)):(this.sh(e.F[0],t),this.sh(e.F[1],t)))},Jl:function(t,e,i,s,r,n,a,o){var h,c=t.J,l=t.K,u=t.L,p=t.G,d=t.H,f=t.I;if(c>(e>r?e:r)||p<(e<r?e:r)||l>(i>n?i:n)||d<(i<n?i:n)||u>(s>a?s:a)||f<(s<a?s:a))h=!1;else{var m=r-e,g=n-i,y=a-s;h=0>m?-m:m;var v=0>g?-g:g,b=0>y?-y:y,x=.5*(p-c),_=.5*(d-l),M=.5*(f-u);c=e-.5*(p+c),h=!(h=!!(b=0<(0>(f=(l=i-.5*(d+l))*y-(u=s-.5*(f+u))*g)?-f:f)-(_*b+M*v)||0<(0>(y=u*m-c*y)?-y:y)-(M*h+x*b))||0<(0>(m=c*g-l*m)?-m:m)-(x*v+_*h))}h&&(0==t.O?o.process(t.tb):(this.Jl(t.F[0],e,i,s,r,n,a,o),this.Jl(t.F[1],e,i,s,r,n,a,o)))},ml:function(t,e,i,s,r){var n=this.u.min;n.x=t.J,n.y=t.K,n.z=t.L,(n=this.u.max).x=t.G,n.y=t.H,n.z=t.I,this.Vj.za(e,i,s),0==(n=gt.cb).zj(this.Vj,this.u,i,this.Wf,null,!1)&&0>=n.distance&&(0==t.O?r.process(t.tb):(this.ml(t.F[0],e,i,s,r),this.ml(t.F[1],e,i,s,r)))},hl:function(t,e,i){t.J<e.ja&&t.G>e.ma&&t.K<e.ka&&t.H>e.na&&t.L<e.la&&t.I>e.oa&&(0==t.O?i.process(t.tb):(this.hl(t.F[0],e,i),this.hl(t.F[1],e,i)))},Vh:function(t,e){if(t=new Jt(t,this.Ul++),this.Ci++,null==this.Be?this.Be=t:(this.$e.M=t,t.ia=this.$e),this.$e=t,t.J=e.ma,t.K=e.na,t.L=e.oa,t.G=e.ja,t.H=e.ka,t.I=e.la,e=yt.bvhProxyPadding,t.J-=e,t.K-=e,t.L-=e,t.G+=e,t.H+=e,t.I+=e,null!=(s=(e=this.ge).Xc)?(e.Xc=s.M,s.M=null):s=new Xt,(a=s).tb=t,t.Qh=a,a.J=t.J,a.K=t.K,a.L=t.L,a.G=t.G,a.H=t.H,a.I=t.I,e.fk++,null==e.cg?e.cg=a:(e.gf.Uf=a,a.Vf=e.gf),e.gf=a,null==e.Qb)e.Qb=a;else{for(var i=e.Qb;0<i.O&&-1!=(s=e.Gi.Sl(i,a));)i=i.F[s];var s,r=i.Ea;if(null!=(s=e.Xc)?(e.Xc=s.M,s.M=null):s=new Xt,null==r)e.Qb=s;else{var n=i.La;r.F[n]=s,s.Ea=r,s.La=n}for(r=i.La,s.F[r]=i,i.Ea=s,i.La=r,i=1^i.La,s.F[i]=a,a.Ea=s,a.La=i;null!=s;){if(e.Gi.Rj&&!(2>s.O)){var a=s.Ea,o=(r=s.F[0],n=s.F[1],r.O-n.O);i=s.La,1<o?(n=r.F[0],o=r.F[1],n.O>o.O?(r.F[1]=s,s.Ea=r,s.La=1,s.F[0]=o,o.Ea=s,o.La=0):(r.F[0]=s,s.Ea=r,s.La=0,s.F[0]=n,n.Ea=s,n.La=0),n=r.F[0],o=r.F[1],r.J=n.J<o.J?n.J:o.J,r.K=n.K<o.K?n.K:o.K,r.L=n.L<o.L?n.L:o.L,r.G=n.G>o.G?n.G:o.G,r.H=n.H>o.H?n.H:o.H,r.I=n.I>o.I?n.I:o.I,n=r.F[0].O,o=r.F[1].O,r.O=(n>o?n:o)+1,n=s.F[0],o=s.F[1],s.J=n.J<o.J?n.J:o.J,s.K=n.K<o.K?n.K:o.K,s.L=n.L<o.L?n.L:o.L,s.G=n.G>o.G?n.G:o.G,s.H=n.H>o.H?n.H:o.H,s.I=n.I>o.I?n.I:o.I,n=s.F[0].O,o=s.F[1].O,s.O=(n>o?n:o)+1,null!=a?(a.F[i]=r,r.Ea=a,r.La=i):(e.Qb=r,r.Ea=null),s=r):-1>o&&(r=n.F[0],o=n.F[1],r.O>o.O?(n.F[1]=s,s.Ea=n,s.La=1,s.F[1]=o,o.Ea=s,o.La=1):(n.F[0]=s,s.Ea=n,s.La=0,s.F[1]=r,r.Ea=s,r.La=1),r=n.F[0],o=n.F[1],n.J=r.J<o.J?r.J:o.J,n.K=r.K<o.K?r.K:o.K,n.L=r.L<o.L?r.L:o.L,n.G=r.G>o.G?r.G:o.G,n.H=r.H>o.H?r.H:o.H,n.I=r.I>o.I?r.I:o.I,r=n.F[0].O,o=n.F[1].O,n.O=(r>o?r:o)+1,r=s.F[0],o=s.F[1],s.J=r.J<o.J?r.J:o.J,s.K=r.K<o.K?r.K:o.K,s.L=r.L<o.L?r.L:o.L,s.G=r.G>o.G?r.G:o.G,s.H=r.H>o.H?r.H:o.H,s.I=r.I>o.I?r.I:o.I,r=s.F[0].O,o=s.F[1].O,s.O=(r>o?r:o)+1,null!=a?(a.F[i]=n,n.Ea=a,n.La=i):(e.Qb=n,n.Ea=null),s=n)}a=s.F[0].O,i=s.F[1].O,s.O=(a>i?a:i)+1,a=s.F[0],i=s.F[1],s.J=a.J<i.J?a.J:i.J,s.K=a.K<i.K?a.K:i.K,s.L=a.L<i.L?a.L:i.L,s.G=a.G>i.G?a.G:i.G,s.H=a.H>i.H?a.H:i.H,s.I=a.I>i.I?a.I:i.I,s=s.Ea}}if(!t.jh){if(t.jh=!0,this.hf.length==this.Gf){for(e=Array(this.Gf<<1),s=0,a=this.Gf;s<a;)e[i=s++]=this.hf[i],this.hf[i]=null;this.hf=e}this.hf[this.Gf++]=t}return t},Wh:function(t){this.Ci--;var e=t.ia,i=t.M;null!=e&&(e.M=i),null!=i&&(i.ia=e),t==this.Be&&(this.Be=this.Be.M),t==this.$e&&(this.$e=this.$e.ia),t.M=null,t.ia=null,e=this.ge,i=t.Qh,e.fk--;var s=i.Vf,r=i.Uf;if(null!=s&&(s.Uf=r),null!=r&&(r.Vf=s),i==e.cg&&(e.cg=e.cg.Uf),i==e.gf&&(e.gf=e.gf.Vf),i.Uf=null,i.Vf=null,e.Qb==i)e.Qb=null;else if(r=(s=i.Ea).F[1^i.La],null==(h=s.Ea))r.Ea=null,r.La=0,e.Qb=r,s.F[0]=null,s.F[1]=null,s.La=0,s.Ea=null,s.O=0,s.tb=null,s.M=e.Xc,e.Xc=s;else{var n=s.La;for(h.F[n]=r,r.Ea=h,r.La=n,s.F[0]=null,s.F[1]=null,s.La=0,s.Ea=null,s.O=0,s.tb=null,s.M=e.Xc,e.Xc=s,s=h;null!=s;){if(e.Gi.Rj&&!(2>s.O)){r=s.Ea,n=s.F[0];var a=s.F[1],o=n.O-a.O,h=s.La;1<o?(a=n.F[0],o=n.F[1],a.O>o.O?(n.F[1]=s,s.Ea=n,s.La=1,s.F[0]=o,o.Ea=s,o.La=0):(n.F[0]=s,s.Ea=n,s.La=0,s.F[0]=a,a.Ea=s,a.La=0),a=n.F[0],o=n.F[1],n.J=a.J<o.J?a.J:o.J,n.K=a.K<o.K?a.K:o.K,n.L=a.L<o.L?a.L:o.L,n.G=a.G>o.G?a.G:o.G,n.H=a.H>o.H?a.H:o.H,n.I=a.I>o.I?a.I:o.I,a=n.F[0].O,o=n.F[1].O,n.O=(a>o?a:o)+1,a=s.F[0],o=s.F[1],s.J=a.J<o.J?a.J:o.J,s.K=a.K<o.K?a.K:o.K,s.L=a.L<o.L?a.L:o.L,s.G=a.G>o.G?a.G:o.G,s.H=a.H>o.H?a.H:o.H,s.I=a.I>o.I?a.I:o.I,a=s.F[0].O,o=s.F[1].O,s.O=(a>o?a:o)+1,null!=r?(r.F[h]=n,n.Ea=r,n.La=h):(e.Qb=n,n.Ea=null),s=n):-1>o&&(n=a.F[0],o=a.F[1],n.O>o.O?(a.F[1]=s,s.Ea=a,s.La=1,s.F[1]=o,o.Ea=s,o.La=1):(a.F[0]=s,s.Ea=a,s.La=0,s.F[1]=n,n.Ea=s,n.La=1),n=a.F[0],o=a.F[1],a.J=n.J<o.J?n.J:o.J,a.K=n.K<o.K?n.K:o.K,a.L=n.L<o.L?n.L:o.L,a.G=n.G>o.G?n.G:o.G,a.H=n.H>o.H?n.H:o.H,a.I=n.I>o.I?n.I:o.I,n=a.F[0].O,o=a.F[1].O,a.O=(n>o?n:o)+1,n=s.F[0],o=s.F[1],s.J=n.J<o.J?n.J:o.J,s.K=n.K<o.K?n.K:o.K,s.L=n.L<o.L?n.L:o.L,s.G=n.G>o.G?n.G:o.G,s.H=n.H>o.H?n.H:o.H,s.I=n.I>o.I?n.I:o.I,n=s.F[0].O,o=s.F[1].O,s.O=(n>o?n:o)+1,null!=r?(r.F[h]=a,a.Ea=r,a.La=h):(e.Qb=a,a.Ea=null),s=a)}r=s.F[0].O,h=s.F[1].O,s.O=(r>h?r:h)+1,r=s.F[0],h=s.F[1],s.J=r.J<h.J?r.J:h.J,s.K=r.K<h.K?r.K:h.K,s.L=r.L<h.L?r.L:h.L,s.G=r.G>h.G?r.G:h.G,s.H=r.H>h.H?r.H:h.H,s.I=r.I>h.I?r.I:h.I,s=s.Ea}}t.Qh=null,i.F[0]=null,i.F[1]=null,i.La=0,i.Ea=null,i.O=0,i.tb=null,i.M=e.Xc,e.Xc=i,t.userData=null,t.M=null,t.ia=null,t.jh&&(t.jh=!1)},wd:function(t,e,i){var s;if(!(t.J<=e.ma&&t.G>=e.ja&&t.K<=e.na&&t.H>=e.ka&&t.L<=e.oa&&t.I>=e.la)&&(t.J=e.ma,t.K=e.na,t.L=e.oa,t.G=e.ja,t.H=e.ka,t.I=e.la,e=yt.bvhProxyPadding,t.J-=e,t.K-=e,t.L-=e,t.G+=e,t.H+=e,t.I+=e,null!=i&&(e=i.x,s=i.y,i=i.z,t.J+=0<e?0:e,t.K+=0<s?0:s,t.L+=0<i?0:i,t.G+=0>e?0:e,t.H+=0>s?0:s,t.I+=0>i?0:i),!t.jh)){if(t.jh=!0,this.hf.length==this.Gf){for(i=Array(this.Gf<<1),e=0,s=this.Gf;e<s;){var r=e++;i[r]=this.hf[r],this.hf[r]=null}this.hf=i}this.hf[this.Gf++]=t}},Ii:function(){var t=this.ce;if(null!=t){for(;t.mh=null,t.nh=null,null!=(t=t.M););this.ce.M=this.oh,this.oh=this.ce,this.ce=null}if(this.oj=0,!(2>this.Ci)){for(var e=this.Gf/this.Ci<yt.bvhIncrementalCollisionThreshold,i=0,s=this.Gf;i<s;){var r=i++,n=this.hf[r];if(n.jh){var a=this.ge,o=n.Qh;a.fk--;var h=o.Vf,c=o.Uf;if(null!=h&&(h.Uf=c),null!=c&&(c.Vf=h),o==a.cg&&(a.cg=a.cg.Uf),o==a.gf&&(a.gf=a.gf.Vf),o.Uf=null,o.Vf=null,a.Qb==o)a.Qb=null;else{var l=o.Ea,u=l.F[1^o.La],p=l.Ea;if(null==p)u.Ea=null,u.La=0,a.Qb=u,l.M=null,l.La=0,l.F[0]=null,l.F[1]=null,l.La=0,l.Ea=null,l.O=0,l.tb=null,l.M=a.Xc,a.Xc=l;else{u.Ea=p;var d=l.La;p.F[d]=u,u.Ea=p,u.La=d,l.M=null,l.La=0,l.F[0]=null,l.F[1]=null,l.La=0,l.Ea=null,l.O=0,l.tb=null,l.M=a.Xc,a.Xc=l;for(var f=p;null!=f;){if(a.Gi.Rj&&!(2>f.O)){var m=f.Ea,g=f.F[0],y=f.F[1],v=g.O-y.O,b=f.La;if(1<v){var x=g.F[0],_=g.F[1];if(x.O>_.O){g.F[1]=f,f.Ea=g,f.La=1,f.F[0]=_,_.Ea=f,_.La=0;var M=g.F[0],w=g.F[1];g.J=M.J<w.J?M.J:w.J,g.K=M.K<w.K?M.K:w.K,g.L=M.L<w.L?M.L:w.L,g.G=M.G>w.G?M.G:w.G,g.H=M.H>w.H?M.H:w.H,g.I=M.I>w.I?M.I:w.I;var S=g.F[0].O,A=g.F[1].O;g.O=(S>A?S:A)+1;var T=f.F[0],C=f.F[1];f.J=T.J<C.J?T.J:C.J,f.K=T.K<C.K?T.K:C.K,f.L=T.L<C.L?T.L:C.L,f.G=T.G>C.G?T.G:C.G,f.H=T.H>C.H?T.H:C.H,f.I=T.I>C.I?T.I:C.I;var L=f.F[0].O,E=f.F[1].O;f.O=(L>E?L:E)+1}else{g.F[0]=f,f.Ea=g,f.La=0,f.F[0]=x,x.Ea=f,x.La=0;var z=g.F[0],R=g.F[1];g.J=z.J<R.J?z.J:R.J,g.K=z.K<R.K?z.K:R.K,g.L=z.L<R.L?z.L:R.L,g.G=z.G>R.G?z.G:R.G,g.H=z.H>R.H?z.H:R.H,g.I=z.I>R.I?z.I:R.I;var B=g.F[0].O,P=g.F[1].O;g.O=(B>P?B:P)+1;var D=f.F[0],I=f.F[1];f.J=D.J<I.J?D.J:I.J,f.K=D.K<I.K?D.K:I.K,f.L=D.L<I.L?D.L:I.L,f.G=D.G>I.G?D.G:I.G,f.H=D.H>I.H?D.H:I.H,f.I=D.I>I.I?D.I:I.I;var O=f.F[0].O,F=f.F[1].O;f.O=(O>F?O:F)+1}null!=m?(m.F[b]=g,g.Ea=m,g.La=b):(a.Qb=g,g.Ea=null),f=g}else if(-1>v){var G=y.F[0],N=y.F[1];if(G.O>N.O){y.F[1]=f,f.Ea=y,f.La=1,f.F[1]=N,N.Ea=f,N.La=1;var j=y.F[0],V=y.F[1];y.J=j.J<V.J?j.J:V.J,y.K=j.K<V.K?j.K:V.K,y.L=j.L<V.L?j.L:V.L,y.G=j.G>V.G?j.G:V.G,y.H=j.H>V.H?j.H:V.H,y.I=j.I>V.I?j.I:V.I;var U=y.F[0].O,k=y.F[1].O;y.O=(U>k?U:k)+1;var H=f.F[0],W=f.F[1];f.J=H.J<W.J?H.J:W.J,f.K=H.K<W.K?H.K:W.K,f.L=H.L<W.L?H.L:W.L,f.G=H.G>W.G?H.G:W.G,f.H=H.H>W.H?H.H:W.H,f.I=H.I>W.I?H.I:W.I;var q=f.F[0].O,$=f.F[1].O;f.O=(q>$?q:$)+1}else{y.F[0]=f,f.Ea=y,f.La=0,f.F[1]=G,G.Ea=f,G.La=1;var J=y.F[0],X=y.F[1];y.J=J.J<X.J?J.J:X.J,y.K=J.K<X.K?J.K:X.K,y.L=J.L<X.L?J.L:X.L,y.G=J.G>X.G?J.G:X.G,y.H=J.H>X.H?J.H:X.H,y.I=J.I>X.I?J.I:X.I;var Y=y.F[0].O,K=y.F[1].O;y.O=(Y>K?Y:K)+1;var Z=f.F[0],Q=f.F[1];f.J=Z.J<Q.J?Z.J:Q.J,f.K=Z.K<Q.K?Z.K:Q.K,f.L=Z.L<Q.L?Z.L:Q.L,f.G=Z.G>Q.G?Z.G:Q.G,f.H=Z.H>Q.H?Z.H:Q.H,f.I=Z.I>Q.I?Z.I:Q.I;var tt=f.F[0].O,et=f.F[1].O;f.O=(tt>et?tt:et)+1}null!=m?(m.F[b]=y,y.Ea=m,y.La=b):(a.Qb=y,y.Ea=null),f=y}}var it=f.F[0].O,st=f.F[1].O;f.O=(it>st?it:st)+1;var rt=f.F[0],nt=f.F[1];f.J=rt.J<nt.J?rt.J:nt.J,f.K=rt.K<nt.K?rt.K:nt.K,f.L=rt.L<nt.L?rt.L:nt.L,f.G=rt.G>nt.G?rt.G:nt.G,f.H=rt.H>nt.H?rt.H:nt.H,f.I=rt.I>nt.I?rt.I:nt.I,f=f.Ea}}}n.Qh=null,o.M=null,o.La=0,o.F[0]=null,o.F[1]=null,o.La=0,o.Ea=null,o.O=0,o.tb=null,o.M=a.Xc,a.Xc=o;var at=this.ge,ot=at.Xc;null!=ot?(at.Xc=ot.M,ot.M=null):ot=new Xt;var ht=ot;if(ht.tb=n,n.Qh=ht,ht.J=n.J,ht.K=n.K,ht.L=n.L,ht.G=n.G,ht.H=n.H,ht.I=n.I,at.fk++,null==at.cg?at.cg=ht:(at.gf.Uf=ht,ht.Vf=at.gf),at.gf=ht,null==at.Qb)at.Qb=ht;else{for(var ct=at.Qb;0<ct.O;){var lt=at.Gi.Sl(ct,ht);if(-1==lt)break;ct=ct.F[lt]}var ut=ct.Ea,pt=at.Xc;null!=pt?(at.Xc=pt.M,pt.M=null):pt=new Xt;var dt=pt;if(null==ut)at.Qb=dt;else{var ft=ct.La;ut.F[ft]=dt,dt.Ea=ut,dt.La=ft}var mt=ct.La;dt.F[mt]=ct,ct.Ea=dt,ct.La=mt;var gt=1^ct.La;for(dt.F[gt]=ht,ht.Ea=dt,ht.La=gt;null!=dt;){if(at.Gi.Rj&&!(2>dt.O)){var vt=dt.Ea,bt=dt.F[0],xt=dt.F[1],_t=bt.O-xt.O,Mt=dt.La;if(1<_t){var wt=bt.F[0],St=bt.F[1];if(wt.O>St.O){bt.F[1]=dt,dt.Ea=bt,dt.La=1,dt.F[0]=St,St.Ea=dt,St.La=0;var At=bt.F[0],Tt=bt.F[1];bt.J=At.J<Tt.J?At.J:Tt.J,bt.K=At.K<Tt.K?At.K:Tt.K,bt.L=At.L<Tt.L?At.L:Tt.L,bt.G=At.G>Tt.G?At.G:Tt.G,bt.H=At.H>Tt.H?At.H:Tt.H,bt.I=At.I>Tt.I?At.I:Tt.I;var Ct=bt.F[0].O,Lt=bt.F[1].O;bt.O=(Ct>Lt?Ct:Lt)+1;var Et=dt.F[0],zt=dt.F[1];dt.J=Et.J<zt.J?Et.J:zt.J,dt.K=Et.K<zt.K?Et.K:zt.K,dt.L=Et.L<zt.L?Et.L:zt.L,dt.G=Et.G>zt.G?Et.G:zt.G,dt.H=Et.H>zt.H?Et.H:zt.H,dt.I=Et.I>zt.I?Et.I:zt.I;var Rt=dt.F[0].O,Bt=dt.F[1].O;dt.O=(Rt>Bt?Rt:Bt)+1}else{bt.F[0]=dt,dt.Ea=bt,dt.La=0,dt.F[0]=wt,wt.Ea=dt,wt.La=0;var Pt=bt.F[0],Dt=bt.F[1];bt.J=Pt.J<Dt.J?Pt.J:Dt.J,bt.K=Pt.K<Dt.K?Pt.K:Dt.K,bt.L=Pt.L<Dt.L?Pt.L:Dt.L,bt.G=Pt.G>Dt.G?Pt.G:Dt.G,bt.H=Pt.H>Dt.H?Pt.H:Dt.H,bt.I=Pt.I>Dt.I?Pt.I:Dt.I;var It=bt.F[0].O,Ot=bt.F[1].O;bt.O=(It>Ot?It:Ot)+1;var Ft=dt.F[0],Gt=dt.F[1];dt.J=Ft.J<Gt.J?Ft.J:Gt.J,dt.K=Ft.K<Gt.K?Ft.K:Gt.K,dt.L=Ft.L<Gt.L?Ft.L:Gt.L,dt.G=Ft.G>Gt.G?Ft.G:Gt.G,dt.H=Ft.H>Gt.H?Ft.H:Gt.H,dt.I=Ft.I>Gt.I?Ft.I:Gt.I;var Nt=dt.F[0].O,jt=dt.F[1].O;dt.O=(Nt>jt?Nt:jt)+1}null!=vt?(vt.F[Mt]=bt,bt.Ea=vt,bt.La=Mt):(at.Qb=bt,bt.Ea=null),dt=bt}else if(-1>_t){var Vt=xt.F[0],Ut=xt.F[1];if(Vt.O>Ut.O){xt.F[1]=dt,dt.Ea=xt,dt.La=1,dt.F[1]=Ut,Ut.Ea=dt,Ut.La=1;var kt=xt.F[0],Ht=xt.F[1];xt.J=kt.J<Ht.J?kt.J:Ht.J,xt.K=kt.K<Ht.K?kt.K:Ht.K,xt.L=kt.L<Ht.L?kt.L:Ht.L,xt.G=kt.G>Ht.G?kt.G:Ht.G,xt.H=kt.H>Ht.H?kt.H:Ht.H,xt.I=kt.I>Ht.I?kt.I:Ht.I;var Wt=xt.F[0].O,qt=xt.F[1].O;xt.O=(Wt>qt?Wt:qt)+1;var $t=dt.F[0],Jt=dt.F[1];dt.J=$t.J<Jt.J?$t.J:Jt.J,dt.K=$t.K<Jt.K?$t.K:Jt.K,dt.L=$t.L<Jt.L?$t.L:Jt.L,dt.G=$t.G>Jt.G?$t.G:Jt.G,dt.H=$t.H>Jt.H?$t.H:Jt.H,dt.I=$t.I>Jt.I?$t.I:Jt.I;var Yt=dt.F[0].O,Kt=dt.F[1].O;dt.O=(Yt>Kt?Yt:Kt)+1}else{xt.F[0]=dt,dt.Ea=xt,dt.La=0,dt.F[1]=Vt,Vt.Ea=dt,Vt.La=1;var Zt=xt.F[0],Qt=xt.F[1];xt.J=Zt.J<Qt.J?Zt.J:Qt.J,xt.K=Zt.K<Qt.K?Zt.K:Qt.K,xt.L=Zt.L<Qt.L?Zt.L:Qt.L,xt.G=Zt.G>Qt.G?Zt.G:Qt.G,xt.H=Zt.H>Qt.H?Zt.H:Qt.H,xt.I=Zt.I>Qt.I?Zt.I:Qt.I;var te=xt.F[0].O,ee=xt.F[1].O;xt.O=(te>ee?te:ee)+1;var ie=dt.F[0],se=dt.F[1];dt.J=ie.J<se.J?ie.J:se.J,dt.K=ie.K<se.K?ie.K:se.K,dt.L=ie.L<se.L?ie.L:se.L,dt.G=ie.G>se.G?ie.G:se.G,dt.H=ie.H>se.H?ie.H:se.H,dt.I=ie.I>se.I?ie.I:se.I;var re=dt.F[0].O,ne=dt.F[1].O;dt.O=(re>ne?re:ne)+1}null!=vt?(vt.F[Mt]=xt,xt.Ea=vt,xt.La=Mt):(at.Qb=xt,xt.Ea=null),dt=xt}}var ae=dt.F[0].O,oe=dt.F[1].O;dt.O=(ae>oe?ae:oe)+1;var he=dt.F[0],ce=dt.F[1];dt.J=he.J<ce.J?he.J:ce.J,dt.K=he.K<ce.K?he.K:ce.K,dt.L=he.L<ce.L?he.L:ce.L,dt.G=he.G>ce.G?he.G:ce.G,dt.H=he.H>ce.H?he.H:ce.H,dt.I=he.I>ce.I?he.I:ce.I,dt=dt.Ea}}e&&this.sh(this.ge.Qb,n.Qh),n.jh=!1}this.hf[r]=null}e||this.sh(this.ge.Qb,this.ge.Qb),this.Gf=0}},Vd:function(t,e,i){null!=this.ge.Qb&&this.Jl(this.ge.Qb,t.x,t.y,t.z,e.x,e.y,e.z,i)},Bf:function(t,e,i,s){null!=this.ge.Qb&&this.ml(this.ge.Qb,t,e,i,s)},qh:function(t,e){null!=this.ge.Qb&&this.hl(this.ge.Qb,t,e)},Jn:function(){return this.ge.cn()}}),Jt.ua=Qt,Jt.prototype=oe(Qt.prototype,{}),$t.prototype={Sl:function(t,e){switch(this.Vl){case 0:var i,s,r;i=e.J+e.G,s=e.K+e.H,r=e.L+e.I;var n,a,o=t.F[0],h=t.F[1];return e=o.J+o.G,t=o.K+o.H,o=o.L+o.I,n=h.J+h.G,a=h.K+h.H,h=h.L+h.I,(e-=i)*e+(t-=s)*t+(o-=r)*o<(n-=i)*n+(a-=s)*a+(h-=r)*h?0:1;case 1:var c,l;o=t.F[0],i=t.F[1],s=t.H-t.K,r=t.I-t.L,h=2*((t.G-t.J)*(s+r)+s*r),s=t.J<e.J?t.J:e.J,c=t.K<e.K?t.K:e.K,n=t.L<e.L?t.L:e.L,r=t.G>e.G?t.G:e.G,l=t.H>e.H?t.H:e.H,a=t.I>e.I?t.I:e.I,t=2*(s=2*((r-s)*((t=l-c)+(n=a-n))+t*n));var u=2*(s-h);return h=u,s=o.J<e.J?o.J:e.J,c=o.K<e.K?o.K:e.K,n=o.L<e.L?o.L:e.L,r=o.G>e.G?o.G:e.G,l=o.H>e.H?o.H:e.H,a=o.I>e.I?o.I:e.I,0==o.O?h+=2*((r-s)*((o=l-c)+(n=a-n))+o*n):(c=l-c,n=a-n,a=o.H-o.K,l=o.I-o.L,h+=2*((r-s)*(c+n)+c*n)-2*((o.G-o.J)*(a+l)+a*l)),o=u,s=i.J<e.J?i.J:e.J,c=i.K<e.K?i.K:e.K,n=i.L<e.L?i.L:e.L,r=i.G>e.G?i.G:e.G,l=i.H>e.H?i.H:e.H,a=i.I>e.I?i.I:e.I,0==i.O?o+=2*((r-s)*((i=l-c)+(e=a-n))+i*e):(e=l-c,n=a-n,a=i.H-i.K,u=i.I-i.L,o+=2*((r-s)*(e+n)+e*n)-2*((i.G-i.J)*(a+u)+a*u)),t<h?t<o?-1:1:h<o?0:1;default:return console.log("BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this.Vl),-1}}},qt.prototype={cn:function(){return this.pl(this.Qb)},pl:function(t){if(null==t||0==t.O)return 0;var e=t.F[0].O-t.F[1].O;return 0>e&&(e=-e),e+this.pl(t.F[0])+this.pl(t.F[1])}},Wt.prototype={za:function(t,e){return this.ma=t.x,this.na=t.y,this.oa=t.z,this.ja=e.x,this.ka=e.y,this.la=e.z,this},Jc:function(){var t=new bt;return t.x=this.ma,t.y=this.na,t.z=this.oa,t},Kc:function(t){t.x=this.ma,t.y=this.na,t.z=this.oa},Yd:function(t){return this.ma=t.x,this.na=t.y,this.oa=t.z,this},Ac:function(){var t=new bt;return t.x=this.ja,t.y=this.ka,t.z=this.la,t},Ec:function(t){t.x=this.ja,t.y=this.ka,t.z=this.la},fd:function(t){return this.ja=t.x,this.ka=t.y,this.la=t.z,this},Hb:function(){var t,e,i,s=new bt;return t=this.ma+this.ja,e=this.na+this.ka,i=this.oa+this.la,s.x=.5*t,s.y=.5*e,s.z=.5*i,s},Mb:function(t){var e,i,s;e=this.ma+this.ja,i=this.na+this.ka,s=this.oa+this.la,t.x=.5*e,t.y=.5*i,t.z=.5*s},pc:function(){var t,e,i,s=new bt;return t=this.ja-this.ma,e=this.ka-this.na,i=this.la-this.oa,s.x=.5*t,s.y=.5*e,s.z=.5*i,s},qc:function(t){var e,i,s;e=this.ja-this.ma,i=this.ka-this.na,s=this.la-this.oa,t.x=.5*e,t.y=.5*i,t.z=.5*s},ua:function(t){return this.ma=this.ma<t.ma?this.ma:t.ma,this.na=this.na<t.na?this.na:t.na,this.oa=this.oa<t.oa?this.oa:t.oa,this.ja=this.ja>t.ja?this.ja:t.ja,this.ka=this.ka>t.ka?this.ka:t.ka,this.la=this.la>t.la?this.la:t.la,this},cb:function(t){var e=new Wt;return e.ma=this.ma<t.ma?this.ma:t.ma,e.na=this.na<t.na?this.na:t.na,e.oa=this.oa<t.oa?this.oa:t.oa,e.ja=this.ja>t.ja?this.ja:t.ja,e.ka=this.ka>t.ka?this.ka:t.ka,e.la=this.la>t.la?this.la:t.la,e},Lc:function(t){return this.ma<t.ja&&this.ja>t.ma&&this.na<t.ka&&this.ka>t.na&&this.oa<t.la&&this.la>t.oa},uc:function(t){var e=new Wt;return e.ma=this.ma>t.ma?this.ma:t.ma,e.na=this.na>t.na?this.na:t.na,e.oa=this.oa>t.oa?this.oa:t.oa,e.ja=this.ja<t.ja?this.ja:t.ja,e.ka=this.ka<t.ka?this.ka:t.ka,e.la=this.la<t.la?this.la:t.la,e},vc:function(t,e){e.ma=this.ma>t.ma?this.ma:t.ma,e.na=this.na>t.na?this.na:t.na,e.oa=this.oa>t.oa?this.oa:t.oa,e.ja=this.ja<t.ja?this.ja:t.ja,e.ka=this.ka<t.ka?this.ka:t.ka,e.la=this.la<t.la?this.la:t.la},de:function(t){return this.ma=t.ma,this.na=t.na,this.oa=t.oa,this.ja=t.ja,this.ka=t.ka,this.la=t.la,this},clone:function(){var t=new Wt;return t.ma=this.ma,t.na=this.na,t.oa=this.oa,t.ja=this.ja,t.ka=this.ka,t.la=this.la,t}},Ht.ua=re,Ht.prototype=oe(re.prototype,{vn:function(){var t=new bt;return t.x=this.Ke,t.y=this.Le,t.z=this.Me,t},wn:function(t){t.x=this.Ke,t.y=this.Le,t.z=this.Me},Oe:function(){var t,e,i;this.yf=8*this.Ke*this.Le*this.Me,t=this.Ke*this.Ke,e=this.Le*this.Le,i=this.Me*this.Me,this.mg=.3333333333333333*(e+i),this.pg=this.og=this.ng=0,this.qg=.3333333333333333*(i+t),this.tg=this.sg=this.rg=0,this.ug=.3333333333333333*(t+e)},Nb:function(t,e){var i,s,r,n,a,o,h,c,l;n=e.o*this.Gk+e.f*this.Hk+e.h*this.Ik,a=e.i*this.Gk+e.m*this.Hk+e.j*this.Ik,i=e.l*this.Gk+e.g*this.Hk+e.s*this.Ik,o=e.o*this.Jk+e.f*this.Kk+e.h*this.Lk,h=e.i*this.Jk+e.m*this.Kk+e.j*this.Lk,s=e.l*this.Jk+e.g*this.Kk+e.s*this.Lk,n=(0>n?-n:n)+(0>o?-o:o)+(0>(c=e.o*this.Mk+e.f*this.Nk+e.h*this.Ok)?-c:c),a=(0>a?-a:a)+(0>h?-h:h)+(0>(l=e.i*this.Mk+e.m*this.Nk+e.j*this.Ok)?-l:l),i=(0>i?-i:i)+(0>s?-s:s)+(0>(r=e.l*this.Mk+e.g*this.Nk+e.s*this.Ok)?-r:r),t.ma=e.v-n,t.na=e.A-a,t.oa=e.B-i,t.ja=e.v+n,t.ka=e.A+a,t.la=e.B+i},Pd:function(t,e){var i,s,r;r=s=i=this.Rb,i=i<this.Ke?i:this.Ke,s=s<this.Le?s:this.Le,r=r<this.Me?r:this.Me,i=this.Ke-i,s=this.Le-s,r=this.Me-r,e.x=0<t.x?i:-i,e.y=0<t.y?s:-s,e.z=0<t.z?r:-r},Di:function(t,e,i,s,r,n,a){var o=this.Ke,h=this.Le,c=this.Me,l=0,u=0,p=0,d=1,f=1,m=1;if(-1e-6<(s-=t)&&1e-6>s){if(t<=-o||t>=o)return!1}else{var g=1/s,y=(-o-t)*g;y>(o=(o-t)*g)&&(g=y,y=o,o=g),0<y&&(l=y),1>o&&(d=o)}if(-1e-6<(r-=e)&&1e-6>r){if(e<=-h||e>=h)return!1}else(o=(-h-e)*(y=1/r))>(h=(h-e)*y)&&(y=o,o=h,h=y),0<o&&(u=o),1>h&&(f=h);if(-1e-6<(n-=i)&&1e-6>n){if(i<=-c||i>=c)return!1}else(h=(-c-i)*(o=1/n))>(c=(c-i)*o)&&(o=h,h=c,c=o),0<h&&(p=h),1>c&&(m=c);if(1<=l||1<=u||1<=p||0>=d||0>=f||0>=m)return!1;if(c=l,l=0,u>c&&(c=u,l=1),p>c&&(c=p,l=2),f<d&&(d=f),m<d&&(d=m),c>d||!c)return!1;switch(l){case 0:a.normal.za(0<s?-1:1,0,0);break;case 1:a.normal.za(0,0<r?-1:1,0);break;case 2:a.normal.za(0,0,0<n?-1:1)}return a.position.za(t+c*s,e+c*r,i+c*n),a.fraction=c,!0}}),kt.ua=re,kt.prototype=oe(re.prototype,{Xh:function(){return this.ab},Bj:function(){return this.Ib},Oe:function(){var t=this.ab*this.ab,e=this.Ib*this.Ib,i=6.28318530717958*t*this.Ib,s=3.14159265358979*t*this.ab*4/3,r=(this.yf=i+s)?1/this.yf:0;this.mg=e=r*(i*(.25*t+e/3)+s*(.4*t+this.Ib*this.ab*.75+e)),this.pg=this.og=this.ng=0,this.qg=r*(i*t*.5+s*t*.4),this.tg=this.sg=this.rg=0,this.ug=e},Nb:function(t,e){var i,s,r,n,a,o;r=s=i=this.ab,n=e.f,a=e.m,o=e.g,i+=n=(0>n?-n:n)*this.Ib,s+=a=(0>a?-a:a)*this.Ib,r+=o=(0>o?-o:o)*this.Ib,t.ma=e.v-i,t.na=e.A-s,t.oa=e.B-r,t.ja=e.v+i,t.ka=e.A+s,t.la=e.B+r},Pd:function(t,e){0<t.y?e.za(0,this.Ib,0):e.za(0,-this.Ib,0)},Di:function(t,e,i,s,r,n,a){var o,h,c,l=this.Ib,u=n-i,p=(h=s-t)*h+u*u,d=t*h+i*u,f=d*d-p*(o=t*t+i*i-this.ab*this.ab);if(0>f)return!1;if(0<p){if(1<=(o=(-d-(f=Math.sqrt(f)))/p)||0>=(-d+f)/p)return!1}else{if(0<=o)return!1;o=0}return(p=e+(r-e)*o)>-l&&p<l?0<o&&(n=o,d=a.normal.za(t+h*n,0,i+u*n),0<(e=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z))&&(e=1/e),r=d.y*e,s=d.z*e,d.x=d.x*e,d.y=r,d.z=s,a.position.za(t+n*h,p,i+n*u),a.fraction=n,!0):!(0>(f=(d=(c=t-0)*(t=s-t)+(l=e-(h=0>p?-l:l))*(e=r-e)+(u=i-0)*(i=n-i))*d-(p=t*t+e*e+i*i)*(o=c*c+l*l+u*u-this.ab*this.ab))||0>(n=(-d-Math.sqrt(f))/p)||1<n||(0<(d=(t=c+t*n)*t+(p=l+e*n)*p+(i=u+i*n)*i)&&(d=1/Math.sqrt(d)),(e=a.position).x=t+0,e.y=p+h,e.z=i+0,(h=a.normal).x=t*d,h.y=p*d,h.z=i*d,a.fraction=n,0))}}),Ut.ua=re,Ut.prototype=oe(re.prototype,{Xh:function(){return this.ab},Bj:function(){return this.Ib},Oe:function(){var t=this.ab*this.ab,e=this.Ib*this.Ib*4;this.yf=3.14159265358979*t*this.Ib*2/3,this.mg=.05*(3*t+2*e),this.pg=this.og=this.ng=0,this.qg=.3*t,this.tg=this.sg=this.rg=0,this.ug=.08333333333333333*(3*t+2*e)},Nb:function(t,e){var i,s,r,n,a,o,h,c,l,u,p,d;i=e.f,s=e.m,r=e.g,n=Math.sqrt(1-i*i),a=Math.sqrt(1-s*s),o=Math.sqrt(1-r*r),n*=this.ab,a*=this.ab,o*=this.ab,i*=this.Ib,s*=this.Ib,l=-(r*=this.Ib)-o,d=-r+o,o=(h=-i-n)>(u=-i+n)?h:u,a=(c=-s-a)>(p=-s+a)?c:p,n=l>d?l:d,h=h<u?h:u,c=c<p?c:p,l=l<d?l:d,t.ma=e.v+(h<i?h:i),t.na=e.A+(c<s?c:s),t.oa=e.B+(l<r?l:r),t.ja=e.v+(o>i?o:i),t.ka=e.A+(a>s?a:s),t.la=e.B+(n>r?n:r)},Pd:function(t,e){var i=t.x,s=t.y,r=t.z;0<s&&s*s>this.uk*this.uk*(i*i+s*s+r*r)?(e.za(0,this.Ib-this.Rb/this.uk,0),0>e.y&&(e.y=0)):(s=(i=t.x)*i+(t=t.z)*t,0>(r=((r=2*this.Ib)-this.Rb)/r*this.ab-this.Rb/this.kk)&&(r=0),s=0<s?r/Math.sqrt(s):0,0>(r=this.Ib-this.Rb)&&(r=0),e.x=i*s,e.y=-r,e.z=t*s)},Di:function(t,e,i,s,r,n,a){var o=this.Ib;s-=t,n-=i;var h=0,c=1;if(-1e-6<(r-=e)&&1e-6>r){if(e<=-o||e>=o)return!1}else{if((u=(-o-e)*(p=1/r))>(p*=o-e))var l=u,u=p,p=l;0<u&&(h=u),1>p&&(c=p)}if(1<=h||0>=c)return!1;e-=o;var d=(u=(l=this.kk*this.kk)*(t*s+e*r+i*n)-e*r)*u-(p=l*(s*s+r*r+n*n)-r*r)*(l=l*(t*t+e*e+i*i)-e*e);if(p){if(0>d)return!1;if(d=Math.sqrt(d),0>p){if(0<r){if(l=0,0>=(u=(-u+d)/p))return!1}else if(l=(-u-d)/p,u=1,1<=l)return!1}else if(l=(-u-d)/p,u=(-u+d)/p,1<=l||0>=u)return!1}else if(p=-l/(2*u),0<u){if(l=0,u=p,0>=p)return!1}else if(l=p,u=1,1<=p)return!1;if(e+=o,u<=h||c<=l)return!1;if(l<h){if(!(o=h))return!1;a.normal.za(0,0<r?-1:1,0)}else{if(!(o=l))return!1;h=a.normal.za(t+s*o,0,i+n*o),0<(c=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z))&&(c=1/c),u=h.y*c,p=h.z*c,h.x=h.x*c,h.y=u,h.z=p,c=this.kk,u=h.y*c,p=h.z*c,h.x=h.x*c,h.y=u,h.z=p,a.normal.y+=this.uk}return a.position.za(t+o*s,e+o*r,i+o*n),a.fraction=o,!0}}),Vt.ua=re,Vt.prototype=oe(re.prototype,{Nn:function(){return this.zb},Oe:function(){this.mg=this.yf=1,this.pg=this.og=this.ng=0,this.qg=1,this.tg=this.sg=this.rg=0,this.ug=1;for(var t=this.zb[0].x,e=this.zb[0].y,i=this.zb[0].z,s=this.zb[0].x,r=this.zb[0].y,n=this.zb[0].z,a=1,o=this.Ne;a<o;){var h=a++,c=this.zb[h].x,l=this.zb[h].y;c<t?t=c:c>s&&(s=c),l<e?e=l:l>r&&(r=l),(h=this.zb[h].z)<i?i=h:h>n&&(n=h)}a=s-t,o=r-e,c=n-i,this.yf=a*o*c,t=.25*((t+s)*(t+s)+(e+r)*(e+r)+(i+n)*(i+n)),a=a*a*.25,o=o*o*.25,c=c*c*.25,this.mg=.3333333333333333*(o+c)+t,this.pg=this.og=this.ng=0,this.qg=.3333333333333333*(c+a)+t,this.tg=this.sg=this.rg=0,this.ug=.3333333333333333*(a+o)+t},Nb:function(t,e){var i,s,r,n,a,o,h,c,l,u,p,d;l=c=h=this.Rb,u=(i=this.zb[0]).x,p=i.y,d=i.z,s=e.o*u+e.f*p+e.h*d,i=e.i*u+e.m*p+e.j*d,r=e.l*u+e.g*p+e.s*d,u=s+e.v,p=i+e.A,i=u,s=p,r=d=r+e.B,n=u,a=p,o=d;for(var f=1,m=this.Ne;f<m;){var g,y;u=f++,u=(d=this.zb[u]).x,p=d.y,d=d.z,g=e.o*u+e.f*p+e.h*d,y=e.i*u+e.m*p+e.j*d,d=e.l*u+e.g*p+e.s*d,u=g,p=y,i=i<(u+=e.v)?i:u,s=s<(p+=e.A)?s:p,r=r<(d+=e.B)?r:d,n=n>u?n:u,a=a>p?a:p,o=o>d?o:d}t.ma=i-h,t.na=s-c,t.oa=r-l,t.ja=n+h,t.ka=a+c,t.la=o+l},Pd:function(t,e){for(var i=(i=this.zb[0]).x*t.x+i.y*t.y+i.z*t.z,s=0,r=1,n=this.Ne;r<n;){var a,o=r++;(a=(a=this.zb[o]).x*t.x+a.y*t.y+a.z*t.z)>i&&(i=a,s=o)}t=this.zb[s],e.x=t.x,e.y=t.y,e.z=t.z}}),jt.ua=re,jt.prototype=oe(re.prototype,{Xh:function(){return this.ab},Bj:function(){return this.Ib},Oe:function(){var t=this.ab*this.ab,e=this.Ib*this.Ib*4;this.yf=3.14159265358979*t*this.Ib*2,this.mg=.08333333333333333*(3*t+e),this.pg=this.og=this.ng=0,this.qg=.5*t,this.tg=this.sg=this.rg=0,this.ug=.08333333333333333*(3*t+e)},Nb:function(t,e){var i,s,r,n,a,o;i=0>(i=e.f)?-i:i,s=0>(s=e.m)?-s:s,r=0>(r=e.g)?-r:r,n=Math.sqrt(1-i*i),a=Math.sqrt(1-s*s),o=Math.sqrt(1-r*r),n*=this.ab,a*=this.ab,o*=this.ab,n+=i*=this.Ib,a+=s*=this.Ib,o+=r*=this.Ib,t.ma=e.v-n,t.na=e.A-a,t.oa=e.B-o,t.ja=e.v+n,t.ka=e.A+a,t.la=e.B+o},Pd:function(t,e){var i=t.x,s=t.z,r=i*i+s*s,n=this.ab-this.Rb;0>n&&(n=0),r=0<r?n/Math.sqrt(r):0,0>(n=this.Ib-this.Rb)&&(n=0),e.x=i*r,e.y=0<t.y?n:-n,e.z=s*r},Di:function(t,e,i,s,r,n,a){var o=this.Ib,h=0,c=1;if(-1e-6<(r-=e)&&1e-6>r){if(e<=-o||e>=o)return!1}else(l=(-o-e)*(u=1/r))>(o=(o-e)*u)&&(u=l,l=o,o=u),0<l&&(h=l),1>o&&(c=o);if(1<=h||0>=c)return!1;var l,u,p=(l=t*(s-=t)+i*(n-=i))*l-(o=s*s+n*n)*(u=t*t+i*i-this.ab*this.ab);if(0>p)return!1;if(0<o){if(u=(-l-(p=Math.sqrt(p)))/o,o=(-l+p)/o,1<=u||0>=o)return!1}else{if(0<=u)return!1;u=0,o=1}if(o<=h||c<=u)return!1;if(u<h){if(!h)return!1;a.normal.za(0,0<r?-1:1,0)}else{if(!(h=u))return!1;c=a.normal.za(t+s*h,0,i+n*h),0<(o=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z))&&(o=1/o),l=c.y*o,u=c.z*o,c.x=c.x*o,c.y=l,c.z=u}return a.position.za(t+h*s,e+h*r,i+h*n),a.fraction=h,!0}}),Ft.ua=re,Ft.prototype=oe(re.prototype,{Xh:function(){return this.ab},Oe:function(){this.yf=4.188790204786386*this.ab*this.ab*this.ab,this.mg=.4*this.ab*this.ab,this.pg=this.og=this.ng=0,this.qg=.4*this.ab*this.ab,this.tg=this.sg=this.rg=0,this.ug=.4*this.ab*this.ab},Nb:function(t,e){var i,s,r;r=s=i=this.ab,t.ma=e.v-i,t.na=e.A-s,t.oa=e.B-r,t.ja=e.v+i,t.ka=e.A+s,t.la=e.B+r},Pd:function(t,e){e.Z()},Di:function(t,e,i,s,r,n,a){var o,h=t*(s-=t)+e*(r-=e)+i*(o=n-i),c=h*h-(n=s*s+r*r+o*o)*(t*t+e*e+i*i-this.ab*this.ab);return!(0>c||0>(n=(-h-Math.sqrt(c))/n)||1<n||(0<(s=(t+=s*n)*t+(e+=r*n)*e+(i+=o*n)*i)&&(s=1/Math.sqrt(s)),(r=a.position).x=t,r.y=e,r.z=i,(r=a.normal).x=t*s,r.y=e*s,r.z=i*s,a.fraction=n,0))}}),Ot.prototype={ua:function(t,e){return this.Jb[t][e]}},It.prototype={mm:function(){for(var t=0,e=0,i=this.numPoints;e<i;){var s=e++;this.points[s].depth>t&&(t=this.points[s].depth)}return t},clear:function(){for(var t=this.numPoints=0,e=this.points;t<e.length;){var i=e[t];++t,i.position1.Z(),i.position2.Z(),i.depth=0,i.id=0}this.normal.Z()}},Pt.prototype={yh:function(t,e,i,s){var r=t.normal;r.x=e,r.y=i,r.z=s,this.Sg&&(e=-(t=t.normal).y,i=-t.z,t.x=-t.x,t.y=e,t.z=i)},Cg:function(t,e,i,s,r,n,a,o,h){(t=t.points[t.numPoints++]).depth=o,t.id=h,this.Sg?((o=t.position1).x=r,o.y=n,o.z=a,(r=t.position2).x=e,r.y=i,r.z=s):((o=t.position1).x=e,o.y=i,o.z=s,(e=t.position2).x=r,e.y=n,e.z=a)},th:function(){},hm:function(t,e,i,s,r,n){for(var a=t.numPoints=0,o=t.points;a<o.length;){var h=o[a];++a,h.position1.Z(),h.position2.Z(),h.depth=0,h.id=0}t.normal.Z(),this.Sg?this.th(t,i,e,r,s,n):this.th(t,e,i,s,r,n)}},Bt.ua=Pt,Bt.prototype=oe(Pt.prototype,{th:function(t,e,i,s,r){var n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w,S,A,T,C,L,E,z,R,B,P,D,I,O,F,G,N,j,V,U,k,H,W,q,$,J,X,Y=e,K=i;t.incremental=!1,n=s.v,a=s.A,o=s.B,u=(h=r.v)-n,p=(c=r.A)-a,d=(l=r.B)-o,f=s.o,m=s.i,g=s.l,y=s.f,v=s.m,b=s.g,x=s.h,_=s.j,M=s.s,w=r.o,S=r.i,A=r.l,T=r.f,C=r.m,L=r.g,E=r.h,z=r.j,R=r.s,B=f*(As=Y.Ke),P=m*As,D=g*As,I=y*(Ls=Y.Le),O=v*Ls,F=b*Ls,G=x*(Rs=Y.Me),N=_*Rs,j=M*Rs;var Z,Q,tt,et=1/0,it=-1,st=0;tt=Q=Z=0;var rt=f*(V=w*(Ts=K.Ke))+m*(U=S*Ts)+g*(k=A*Ts),nt=f*(H=T*(Es=K.Le))+m*(W=C*Es)+g*(q=L*Es),at=f*($=E*(Bs=K.Me))+m*(J=z*Bs)+g*(X=R*Bs);0>rt&&(rt=-rt),0>nt&&(nt=-nt),0>at&&(at=-at);var ot=As+(rt+nt+at),ht=0>(bi=f*u+m*p+g*d),ct=ht?-bi:bi;if(ct<ot){var lt=ot-ct;lt<et&&(et=lt,it=0,Z=f,Q=m,tt=g,st=ht?-1:1);var ut=y*V+v*U+b*k,pt=y*H+v*W+b*q,dt=y*$+v*J+b*X;0>ut&&(ut=-ut),0>pt&&(pt=-pt),0>dt&&(dt=-dt);var ft=Ls+(ut+pt+dt),mt=0>(bi=y*u+v*p+b*d),gt=mt?-bi:bi;if(gt<ft){var vt=ft-gt;vt<et&&(et=vt,it=1,Z=y,Q=v,tt=b,st=mt?-1:1);var bt=x*V+_*U+M*k,xt=x*H+_*W+M*q,_t=x*$+_*J+M*X;0>bt&&(bt=-bt),0>xt&&(xt=-xt),0>_t&&(_t=-_t);var Mt=Rs+(bt+xt+_t),wt=0>(bi=x*u+_*p+M*d),St=wt?-bi:bi;if(St<Mt){var At=Mt-St;At<et&&(et=At,it=2,Z=x,Q=_,tt=M,st=wt?-1:1),et=et>yt.linearSlop?et-yt.linearSlop:0;var Tt=w*B+S*P+A*D,Ct=w*I+S*O+A*F,Lt=w*G+S*N+A*j;0>Tt&&(Tt=-Tt),0>Ct&&(Ct=-Ct),0>Lt&&(Lt=-Lt);var Et=Tt+Ct+Lt+Ts,zt=0>(bi=w*u+S*p+A*d),Rt=zt?-bi:bi;if(Rt<Et){var Bt=Et-Rt;Bt<et&&(et=Bt,it=3,Z=w,Q=S,tt=A,st=zt?-1:1);var Pt=T*B+C*P+L*D,Dt=T*I+C*O+L*F,It=T*G+C*N+L*j;0>Pt&&(Pt=-Pt),0>Dt&&(Dt=-Dt),0>It&&(It=-It);var Ot=Pt+Dt+It+Es,Ft=0>(bi=T*u+C*p+L*d),Gt=Ft?-bi:bi;if(Gt<Ot){var Nt=Ot-Gt;Nt<et&&(et=Nt,it=4,Z=T,Q=C,tt=L,st=Ft?-1:1);var jt=E*B+z*P+R*D,Vt=E*I+z*O+R*F,Ut=E*G+z*N+R*j;0>jt&&(jt=-jt),0>Vt&&(Vt=-Vt),0>Ut&&(Ut=-Ut);var kt=jt+Vt+Ut+Bs,Ht=0>(bi=E*u+z*p+R*d),Wt=Ht?-bi:bi;if(Wt<kt){var qt,$t,Jt,Xt=kt-Wt;if(Xt<et&&(et=Xt,it=5,Z=E,Q=z,tt=R,st=Ht?-1:1),et=et>yt.linearSlop?et-yt.linearSlop:0,$t=g*w-f*A,Jt=f*S-m*w,(qt=m*A-g*S)||$t||Jt){var Yt=qt*qt+$t*$t+Jt*Jt;0<Yt&&(Yt=1/Math.sqrt(Yt));var Kt=(qt*=Yt)*I+($t*=Yt)*O+(Jt*=Yt)*F,Zt=qt*G+$t*N+Jt*j;0>Kt&&(Kt=-Kt),0>Zt&&(Zt=-Zt);var Qt=qt*H+$t*W+Jt*q,te=qt*$+$t*J+Jt*X;0>Qt&&(Qt=-Qt),0>te&&(te=-te);var ee=Kt+Zt+(Qt+te),ie=0>(bi=qt*u+$t*p+Jt*d),se=ie?-bi:bi;if(!(se<ee))return;var re=ee-se;re<et&&(et=re,it=6,Z=qt,Q=$t,tt=Jt,st=ie?-1:1)}if($t=g*T-f*L,Jt=f*C-m*T,(qt=m*L-g*C)||$t||Jt){var ne=qt*qt+$t*$t+Jt*Jt;0<ne&&(ne=1/Math.sqrt(ne));var ae=(qt*=ne)*I+($t*=ne)*O+(Jt*=ne)*F,oe=qt*G+$t*N+Jt*j;0>ae&&(ae=-ae),0>oe&&(oe=-oe);var he=qt*V+$t*U+Jt*k,ce=qt*$+$t*J+Jt*X;0>he&&(he=-he),0>ce&&(ce=-ce);var le=ae+oe+(he+ce),ue=0>(bi=qt*u+$t*p+Jt*d),pe=ue?-bi:bi;if(!(pe<le))return;var de=le-pe;de<et&&(et=de,it=7,Z=qt,Q=$t,tt=Jt,st=ue?-1:1)}if($t=g*E-f*R,Jt=f*z-m*E,(qt=m*R-g*z)||$t||Jt){var fe=qt*qt+$t*$t+Jt*Jt;0<fe&&(fe=1/Math.sqrt(fe));var me=(qt*=fe)*I+($t*=fe)*O+(Jt*=fe)*F,ge=qt*G+$t*N+Jt*j;0>me&&(me=-me),0>ge&&(ge=-ge);var ye=qt*V+$t*U+Jt*k,ve=qt*H+$t*W+Jt*q;0>ye&&(ye=-ye),0>ve&&(ve=-ve);var be=me+ge+(ye+ve),xe=0>(bi=qt*u+$t*p+Jt*d),_e=xe?-bi:bi;if(!(_e<be))return;var Me=be-_e;Me<et&&(et=Me,it=8,Z=qt,Q=$t,tt=Jt,st=xe?-1:1)}if($t=b*w-y*A,Jt=y*S-v*w,(qt=v*A-b*S)||$t||Jt){var we=qt*qt+$t*$t+Jt*Jt;0<we&&(we=1/Math.sqrt(we));var Se=(qt*=we)*B+($t*=we)*P+(Jt*=we)*D,Ae=qt*G+$t*N+Jt*j;0>Se&&(Se=-Se),0>Ae&&(Ae=-Ae);var Te=qt*H+$t*W+Jt*q,Ce=qt*$+$t*J+Jt*X;0>Te&&(Te=-Te),0>Ce&&(Ce=-Ce);var Le=Se+Ae+(Te+Ce),Ee=0>(bi=qt*u+$t*p+Jt*d),ze=Ee?-bi:bi;if(!(ze<Le))return;var Re=Le-ze;Re<et&&(et=Re,it=9,Z=qt,Q=$t,tt=Jt,st=Ee?-1:1)}if($t=b*T-y*L,Jt=y*C-v*T,(qt=v*L-b*C)||$t||Jt){var Be=qt*qt+$t*$t+Jt*Jt;0<Be&&(Be=1/Math.sqrt(Be));var Pe=(qt*=Be)*B+($t*=Be)*P+(Jt*=Be)*D,De=qt*G+$t*N+Jt*j;0>Pe&&(Pe=-Pe),0>De&&(De=-De);var Ie=qt*V+$t*U+Jt*k,Oe=qt*$+$t*J+Jt*X;0>Ie&&(Ie=-Ie),0>Oe&&(Oe=-Oe);var Fe=Pe+De+(Ie+Oe),Ge=0>(bi=qt*u+$t*p+Jt*d),Ne=Ge?-bi:bi;if(!(Ne<Fe))return;var je=Fe-Ne;je<et&&(et=je,it=10,Z=qt,Q=$t,tt=Jt,st=Ge?-1:1)}if($t=b*E-y*R,Jt=y*z-v*E,(qt=v*R-b*z)||$t||Jt){var Ve=qt*qt+$t*$t+Jt*Jt;0<Ve&&(Ve=1/Math.sqrt(Ve));var Ue=(qt*=Ve)*B+($t*=Ve)*P+(Jt*=Ve)*D,ke=qt*G+$t*N+Jt*j;0>Ue&&(Ue=-Ue),0>ke&&(ke=-ke);var He=qt*V+$t*U+Jt*k,We=qt*H+$t*W+Jt*q;0>He&&(He=-He),0>We&&(We=-We);var qe=Ue+ke+(He+We),$e=0>(bi=qt*u+$t*p+Jt*d),Je=$e?-bi:bi;if(!(Je<qe))return;var Xe=qe-Je;Xe<et&&(et=Xe,it=11,Z=qt,Q=$t,tt=Jt,st=$e?-1:1)}if($t=M*w-x*A,Jt=x*S-_*w,(qt=_*A-M*S)||$t||Jt){var Ye=qt*qt+$t*$t+Jt*Jt;0<Ye&&(Ye=1/Math.sqrt(Ye));var Ke=(qt*=Ye)*B+($t*=Ye)*P+(Jt*=Ye)*D,Ze=qt*I+$t*O+Jt*F;0>Ke&&(Ke=-Ke),0>Ze&&(Ze=-Ze);var Qe=qt*H+$t*W+Jt*q,ti=qt*$+$t*J+Jt*X;0>Qe&&(Qe=-Qe),0>ti&&(ti=-ti);var ei=Ke+Ze+(Qe+ti),ii=0>(bi=qt*u+$t*p+Jt*d),si=ii?-bi:bi;if(!(si<ei))return;var ri=ei-si;ri<et&&(et=ri,it=12,Z=qt,Q=$t,tt=Jt,st=ii?-1:1)}if($t=M*T-x*L,Jt=x*C-_*T,(qt=_*L-M*C)||$t||Jt){var ni=qt*qt+$t*$t+Jt*Jt;0<ni&&(ni=1/Math.sqrt(ni));var ai=(qt*=ni)*B+($t*=ni)*P+(Jt*=ni)*D,oi=qt*I+$t*O+Jt*F;0>ai&&(ai=-ai),0>oi&&(oi=-oi);var hi=qt*V+$t*U+Jt*k,ci=qt*$+$t*J+Jt*X;0>hi&&(hi=-hi),0>ci&&(ci=-ci);var li=ai+oi+(hi+ci),ui=0>(bi=qt*u+$t*p+Jt*d),pi=ui?-bi:bi;if(!(pi<li))return;var di=li-pi;di<et&&(et=di,it=13,Z=qt,Q=$t,tt=Jt,st=ui?-1:1)}if($t=M*E-x*R,Jt=x*z-_*E,(qt=_*R-M*z)||$t||Jt){var fi=qt*qt+$t*$t+Jt*Jt;0<fi&&(fi=1/Math.sqrt(fi));var mi=(qt*=fi)*B+($t*=fi)*P+(Jt*=fi)*D,gi=qt*I+$t*O+Jt*F;0>mi&&(mi=-mi),0>gi&&(gi=-gi);var yi=qt*V+$t*U+Jt*k,vi=qt*H+$t*W+Jt*q;0>yi&&(yi=-yi),0>vi&&(vi=-vi);var bi,xi=mi+gi+(yi+vi),_i=0>(bi=qt*u+$t*p+Jt*d),Mi=_i?-bi:bi;if(!(Mi<xi))return;var wi=xi-Mi;wi<et&&(et=wi,it=14,Z=qt,Q=$t,tt=Jt,st=_i?-1:1)}if(6<=it){Z*=st,Q*=st,tt*=st;var Si,Ai,Ti,Ci,Li,Ei,zi,Ri,Bi,Pi,Di,Ii,Oi,Fi,Gi,Ni=(it-6)/3|0,ji=it-6-3*Ni;switch(Ni){case 0:zi=f,Ri=m,Bi=g;var Vi=0<G*Z+N*Q+j*tt;0<I*Z+O*Q+F*tt?Vi?(Si=I+G,Ai=O+N,Ti=F+j):(Si=I-G,Ai=O-N,Ti=F-j):Vi?(Si=G-I,Ai=N-O,Ti=j-F):(Si=-(Si=I+G),Ai=-(Ai=O+N),Ti=-(Ti=F+j));break;case 1:zi=y,Ri=v,Bi=b;var Ui=0<G*Z+N*Q+j*tt;0<B*Z+P*Q+D*tt?Ui?(Si=B+G,Ai=P+N,Ti=D+j):(Si=B-G,Ai=P-N,Ti=D-j):Ui?(Si=G-B,Ai=N-P,Ti=j-D):(Si=-(Si=B+G),Ai=-(Ai=P+N),Ti=-(Ti=D+j));break;default:zi=x,Ri=_,Bi=M;var ki=0<I*Z+O*Q+F*tt;0<B*Z+P*Q+D*tt?ki?(Si=B+I,Ai=P+O,Ti=D+F):(Si=B-I,Ai=P-O,Ti=D-F):ki?(Si=I-B,Ai=O-P,Ti=F-D):(Si=-(Si=B+I),Ai=-(Ai=P+O),Ti=-(Ti=D+F))}switch(Si=n+Si,Ai=a+Ai,Ti=o+Ti,ji){case 0:Pi=w,Di=S,Ii=A;var Hi=0<$*Z+J*Q+X*tt;0<H*Z+W*Q+q*tt?Hi?(Ci=H+$,Li=W+J,Ei=q+X):(Ci=H-$,Li=W-J,Ei=q-X):Hi?(Ci=$-H,Li=J-W,Ei=X-q):(Ci=-(Ci=H+$),Li=-(Li=W+J),Ei=-(Ei=q+X));break;case 1:Pi=T,Di=C,Ii=L;var Wi=0<$*Z+J*Q+X*tt;0<V*Z+U*Q+k*tt?Wi?(Ci=V+$,Li=U+J,Ei=k+X):(Ci=V-$,Li=U-J,Ei=k-X):Wi?(Ci=$-V,Li=J-U,Ei=X-k):(Ci=-(Ci=V+$),Li=-(Li=U+J),Ei=-(Ei=k+X));break;default:Pi=E,Di=z,Ii=R;var qi=0<H*Z+W*Q+q*tt;0<V*Z+U*Q+k*tt?qi?(Ci=V+H,Li=U+W,Ei=k+q):(Ci=V-H,Li=U-W,Ei=k-q):qi?(Ci=H-V,Li=W-U,Ei=q-k):(Ci=-(Ci=V+H),Li=-(Li=U+W),Ei=-(Ei=k+q))}var $i,Ji,Xi,Yi,Ki,Zi,Qi=zi*Pi+Ri*Di+Bi*Ii,ts=zi*(Oi=Si-(Ci=h-Ci))+Ri*(Fi=Ai-(Li=c-Li))+Bi*(Gi=Ti-(Ei=l-Ei)),es=Pi*Oi+Di*Fi+Ii*Gi,is=1/(1-Qi*Qi),ss=(Qi*es-ts)*is,rs=(es-Qi*ts)*is;$i=Si+zi*ss,Ji=Ai+Ri*ss,Xi=Ti+Bi*ss,Yi=Ci+Pi*rs,Ki=Li+Di*rs,Zi=Ei+Ii*rs,this.yh(t,-Z,-Q,-tt),this.Cg(t,$i,Ji,Xi,Yi,Ki,Zi,et,4)}else{var ns,as,os,hs,cs,ls,us,ps,ds,fs,ms,gs,ys,vs,bs,xs,_s,Ms;if(3<=it){st=-st,u=-u,p=-p,d=-d;var ws=Y,Ss=(Y=K,K=ws,As),As=Ts,Ts=Ss,Cs=Ls,Ls=Es,Es=Cs,zs=Rs,Rs=Bs,Bs=zs;ns=n,as=a,os=o,n=h,a=c,o=l,h=ns,c=as,l=os,ns=f,as=m,os=g,f=w,m=S,g=A,w=ns,S=as,A=os,ns=y,as=v,os=b,y=T,v=C,b=L,T=ns,C=as,L=os,ns=x,as=_,os=M,x=E,_=z,M=R,E=ns,z=as,R=os,ns=B,as=P,os=D,B=V,P=U,D=k,V=ns,U=as,k=os,ns=I,as=O,os=F,I=H,O=W,F=q,H=ns,W=as,q=os,ns=G,as=N,os=j,G=$,N=J,j=X,$=ns,J=as,X=os,it-=3,hs=!0}else hs=!1;switch(it){case 0:cs=B,ls=P,us=D,ps=f,ds=m,fs=g,ms=y,gs=v,ys=b,vs=x,bs=_,xs=M,_s=Ls,Ms=Rs;break;case 1:cs=I,ls=O,us=F,ps=y,ds=v,fs=b,ms=x,gs=_,ys=M,vs=f,bs=m,xs=g,_s=Rs,Ms=As;break;default:cs=G,ls=N,us=j,ps=x,ds=_,fs=M,ms=f,gs=m,ys=g,vs=y,bs=v,xs=b,_s=As,Ms=Ls}if(0>st){cs=-cs,ls=-ls,us=-us,ps=-ps,ds=-ds,fs=-fs,ns=ms,as=gs,os=ys,ms=vs,gs=bs,ys=xs,vs=ns,bs=as,xs=os;var Ps=_s;_s=Ms,Ms=Ps}cs+=n,ls+=a,us+=o;var Ds,Is,Os,Fs,Gs,Ns,js,Vs,Us,ks,Hs,Ws,qs=1,$s=0,Js=ps*w+ds*S+fs*A;switch(Js<qs&&(qs=Js,$s=0),-Js<qs&&(qs=-Js,$s=1),(Js=ps*T+ds*C+fs*L)<qs&&(qs=Js,$s=2),-Js<qs&&(qs=-Js,$s=3),(Js=ps*E+ds*z+fs*R)<qs&&(qs=Js,$s=4),-Js<qs&&(qs=-Js,$s=5),$s){case 0:Ds=V+H,Is=U+W,Os=k+q,Ds+=$,Is+=J,Os+=X,Fs=V-H,Gs=U-W,Ns=k-q,Fs+=$,Gs+=J,Ns+=X,js=V-H,Vs=U-W,Us=k-q,js-=$,Vs-=J,Us-=X,ks=V+H,Hs=U+W,Ws=k+q,ks-=$,Hs-=J,Ws-=X;break;case 1:Ds=H-V,Is=W-U,Os=q-k,Ds+=$,Is+=J,Os+=X,Fs=H-V,Gs=W-U,Ns=q-k,Fs-=$,Gs-=J,Ns-=X,js=-(js=V+H),Vs=-(Vs=U+W),Us=-(Us=k+q),js-=$,Vs-=J,Us-=X,ks=-(ks=V+H),Hs=-(Hs=U+W),Ws=-(Ws=k+q),ks+=$,Hs+=J,Ws+=X;break;case 2:Ds=V+H,Is=U+W,Os=k+q,Ds+=$,Is+=J,Os+=X,Fs=V+H,Gs=U+W,Ns=k+q,Fs-=$,Gs-=J,Ns-=X,js=H-V,Vs=W-U,Us=q-k,js-=$,Vs-=J,Us-=X,ks=H-V,Hs=W-U,Ws=q-k,ks+=$,Hs+=J,Ws+=X;break;case 3:Ds=V-H,Is=U-W,Os=k-q,Ds+=$,Is+=J,Os+=X,Fs=-(Fs=V+H),Gs=-(Gs=U+W),Ns=-(Ns=k+q),Fs+=$,Gs+=J,Ns+=X,js=-(js=V+H),Vs=-(Vs=U+W),Us=-(Us=k+q),js-=$,Vs-=J,Us-=X,ks=V-H,Hs=U-W,Ws=k-q,ks-=$,Hs-=J,Ws-=X;break;case 4:Ds=V+H,Is=U+W,Os=k+q,Ds+=$,Is+=J,Os+=X,Fs=H-V,Gs=W-U,Ns=q-k,Fs+=$,Gs+=J,Ns+=X,js=-(js=V+H),Vs=-(Vs=U+W),Us=-(Us=k+q),js+=$,Vs+=J,Us+=X,ks=V-H,Hs=U-W,Ws=k-q,ks+=$,Hs+=J,Ws+=X;break;default:Ds=V+H,Is=U+W,Os=k+q,Ds-=$,Is-=J,Os-=X,Fs=V-H,Gs=U-W,Ns=k-q,Fs-=$,Gs-=J,Ns-=X,js=-(js=V+H),Vs=-(Vs=U+W),Us=-(Us=k+q),js-=$,Vs-=J,Us-=X,ks=H-V,Hs=W-U,Ws=q-k,ks-=$,Hs-=J,Ws-=X}Ds+=u,Is+=p,Os+=d,Fs+=u,Gs+=p,Ns+=d,js+=u,Vs+=p,Us+=d,ks+=u,Hs+=p,Ws+=d;var Xs=this.Dg;Xs.w=_s,Xs.Dj=Ms,Xs.Tc=0,Xs.hc=0;var Ys=this.Dg,Ks=Ys.Bc[Ys.Tc++];Ks.x=Ds*ms+Is*gs+Os*ys,Ks.y=Ds*vs+Is*bs+Os*xs,Ks.Oa=Ds,Ks.Pa=Is,Ks.Qa=Os;var Zs=this.Dg,Qs=Zs.Bc[Zs.Tc++];Qs.x=Fs*ms+Gs*gs+Ns*ys,Qs.y=Fs*vs+Gs*bs+Ns*xs,Qs.Oa=Fs,Qs.Pa=Gs,Qs.Qa=Ns;var tr=this.Dg,er=tr.Bc[tr.Tc++];er.x=js*ms+Vs*gs+Us*ys,er.y=js*vs+Vs*bs+Us*xs,er.Oa=js,er.Pa=Vs,er.Qa=Us;var ir,sr,rr,nr=this.Dg,ar=nr.Bc[nr.Tc++];ar.x=ks*ms+Hs*gs+Ws*ys,ar.y=ks*vs+Hs*bs+Ws*xs,ar.Oa=ks,ar.Pa=Hs,ar.Qa=Ws,this.Dg.clip(),this.Dg.reduce(),hs?(ir=ps,sr=ds,rr=fs):(ir=-ps,sr=-ds,rr=-fs),this.yh(t,ir,sr,rr);for(var or=0,hr=this.Dg.Tc;or<hr;){var cr,lr,ur,pr=or++,dr=this.Dg.Bc[pr];cr=dr.Oa,lr=dr.Pa,ur=dr.Qa;var fr,mr,gr,yr=(cs-(cr+=n))*ps+(ls-(lr+=a))*ds+(us-(ur+=o))*fs;fr=cr+ps*yr,mr=lr+ds*yr,gr=ur+fs*yr,yr>-yt.contactPersistenceThreshold&&(hs?this.Cg(t,cr,lr,ur,fr,mr,gr,yr,pr):this.Cg(t,fr,mr,gr,cr,lr,ur,yr,pr))}}}}}}}}}}),zt.prototype={clip:function(){for(var t=0,e=this.Tc;t<e;){var i=t++,s=this.Bc[i],r=(i=this.Bc[(i+1)%this.Tc],this.w+s.x),n=this.w+i.x;if(0<r&&0<n)(i=this.ic[this.hc++]).x=s.x,i.y=s.y,i.Oa=s.Oa,i.Pa=s.Pa,i.Qa=s.Qa;else if(0<r&&0>=n){var a=this.ic[this.hc++];a.x=s.x,a.y=s.y,a.Oa=s.Oa,a.Pa=s.Pa,a.Qa=s.Qa,r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r}else 0>=r&&0<n&&(r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r)}for(t=this.Bc,this.Bc=this.ic,this.ic=t,this.Tc=this.hc,t=this.hc=0,e=this.Tc;t<e;)i=t++,s=this.Bc[i],i=this.Bc[(i+1)%this.Tc],r=this.w-s.x,n=this.w-i.x,0<r&&0<n?((i=this.ic[this.hc++]).x=s.x,i.y=s.y,i.Oa=s.Oa,i.Pa=s.Pa,i.Qa=s.Qa):0<r&&0>=n?((a=this.ic[this.hc++]).x=s.x,a.y=s.y,a.Oa=s.Oa,a.Pa=s.Pa,a.Qa=s.Qa,r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r):0>=r&&0<n&&(r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r);for(t=this.Bc,this.Bc=this.ic,this.ic=t,this.Tc=this.hc,t=this.hc=0,e=this.Tc;t<e;)i=t++,s=this.Bc[i],i=this.Bc[(i+1)%this.Tc],r=this.Dj+s.y,n=this.Dj+i.y,0<r&&0<n?((i=this.ic[this.hc++]).x=s.x,i.y=s.y,i.Oa=s.Oa,i.Pa=s.Pa,i.Qa=s.Qa):0<r&&0>=n?((a=this.ic[this.hc++]).x=s.x,a.y=s.y,a.Oa=s.Oa,a.Pa=s.Pa,a.Qa=s.Qa,r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r):0>=r&&0<n&&(r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r);for(t=this.Bc,this.Bc=this.ic,this.ic=t,this.Tc=this.hc,t=this.hc=0,e=this.Tc;t<e;)i=t++,s=this.Bc[i],i=this.Bc[(i+1)%this.Tc],r=this.Dj-s.y,n=this.Dj-i.y,0<r&&0<n?((i=this.ic[this.hc++]).x=s.x,i.y=s.y,i.Oa=s.Oa,i.Pa=s.Pa,i.Qa=s.Qa):0<r&&0>=n?((a=this.ic[this.hc++]).x=s.x,a.y=s.y,a.Oa=s.Oa,a.Pa=s.Pa,a.Qa=s.Qa,r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r):0>=r&&0<n&&(r/=r-n,(n=this.ic[this.hc++]).x=s.x+(i.x-s.x)*r,n.y=s.y+(i.y-s.y)*r,n.Oa=s.Oa+(i.Oa-s.Oa)*r,n.Pa=s.Pa+(i.Pa-s.Pa)*r,n.Qa=s.Qa+(i.Qa-s.Qa)*r);t=this.Bc,this.Bc=this.ic,this.ic=t,this.Tc=this.hc,this.hc=0},reduce:function(){if(!(4>this.Tc)){for(var t=-1/0,e=1/0,i=-1/0,s=1/0,r=null,n=null,a=null,o=null,h=0,c=this.Tc;h<c;){var l=h++,u=1*(l=this.Bc[l]).x+1*l.y,p=-1*l.x+1*l.y;u>t&&(t=u,r=l),u<e&&(e=u,n=l),p>i&&(i=p,a=l),p<s&&(s=p,o=l)}(t=this.ic[this.hc++]).x=r.x,t.y=r.y,t.Oa=r.Oa,t.Pa=r.Pa,t.Qa=r.Qa,(r=this.ic[this.hc++]).x=a.x,r.y=a.y,r.Oa=a.Oa,r.Pa=a.Pa,r.Qa=a.Qa,(a=this.ic[this.hc++]).x=n.x,a.y=n.y,a.Oa=n.Oa,a.Pa=n.Pa,a.Qa=n.Qa,(n=this.ic[this.hc++]).x=o.x,n.y=o.y,n.Oa=o.Oa,n.Pa=o.Pa,n.Qa=o.Qa,o=this.Bc,this.Bc=this.ic,this.ic=o,this.Tc=this.hc,this.hc=0}}},Et.prototype={Xe:function(){null!=this.oi&&this.oi.clear()}},Lt.ua=Pt,Lt.prototype=oe(Pt.prototype,{th:function(t,e,i,s,r){var n,a,o,h,c,l;t.incremental=!1,n=s.f,a=s.m,o=s.g,h=r.f,c=r.m,l=r.g;var u,p,d,f,m,g,y,v,b,x=e.Ib,_=i.Ib;e=e.ab,i=i.ab,u=s.v+n*-x,p=s.A+a*-x,d=s.B+o*-x,n=s.v+n*x,f=s.A+a*x,m=s.B+o*x,a=r.v+h*-_,o=r.A+c*-_,s=r.B+l*-_,h=r.v+h*_,c=r.A+c*_,g=r.B+l*_,r=m-d,m=c-o,c=-((y=u-a)*(n-=u)+(v=p-o)*(f-=p)+(b=d-s)*r),y=y*(l=h-a)+v*m+b*(h=g-s),b=n*l+f*m+r*h,g=_*_*4,(v=x*x*4)||g?v?g?(x=(_=v*g-b*b)?0>(x=b*y+g*c)?0:x>_?1:x/_:0,0>(_=x*b+y)?(_=0,x=0>(x=c)?0:x>v?1:x/v):_>g?(_=1,x=0>(x=b+c)?0:x>v?1:x/v):_/=g):(_=0,x=0>(x=c)?0:x>v?1:x/v):(x=0,_=0>(_=y)?0:_>g?1:_/g):_=x=0,p+=f*x,(x=(f=(u+=n*x)-(a+=l*_))*f+(n=p-(o+=m*_))*n+(_=(d+=r*x)-(s+=h*_))*_)>=(e+i)*(e+i)||(0<(x=Math.sqrt(x))?(f*=1/x,n*=1/x,_*=1/x):(f=1,_=n=0),this.yh(t,f,n,_),this.Cg(t,u+f*-e,p+n*-e,d+_*-e,a+f*i,o+n*i,s+_*i,e+i-x,0))}}),Ct.ua=Pt,Ct.prototype=oe(Pt.prototype,{th:function(t,e,i,s,r,n){var a=gt.cb;if(s=a.zj(e,i,s,r,yt.enableGJKCaching?n:null,!0),t.incremental=!0,s!=mt.SUCCEEDED)console.log("GjkEpaDetector.hx:28:","GJK/EPA failed: status="+s);else if(!(a.distance>e.Rb+i.Rb)){var o,h,c,l,u,p;if(s=(n=a.closestPoint1).x,r=n.y,n=n.z,(l=s-(o=(c=a.closestPoint2).x))*l+(u=r-(h=c.y))*u+(p=n-(c=c.z))*p){0>a.distance&&(l=-l,u=-u,p=-p);var d=l*l+u*u+p*p;0<d&&(d=1/Math.sqrt(d)),l*=d,u*=d,p*=d,this.yh(t,l,u,p),s+=l*-e.Rb,r+=u*-e.Rb,n+=p*-e.Rb,o+=l*i.Rb,h+=u*i.Rb,c+=p*i.Rb,this.Cg(t,s,r,n,o,h,c,e.Rb+i.Rb-a.distance,0)}}}}),Tt.ua=Pt,Tt.prototype=oe(Pt.prototype,{th:function(t,e,i,s,r){var n,a,o,h,c,l,u,p,d,f;if(t.incremental=!1,o=-(n=i.Ke),h=-(a=i.Le),c=-(i=i.Me),e=e.ab,l=s.v-r.v,u=s.A-r.A,p=s.B-r.B,d=r.o*l+r.i*u+r.l*p,f=r.f*l+r.m*u+r.g*p,l=r.h*l+r.j*u+r.s*p,o<d&&n>d&&h<f&&a>f&&c<l&&i>l){var m,g,y,v=i-(0>l?-l:l);(u=n-(0>d?-d:d))<(m=a-(0>f?-f:f))?u<v?(o=0<d?1:-1,g=c=h=0,p=y=1):(0<l?(h=o=0,c=1):(h=o=0,c=-1),y=g=1,p=0,u=v):m<v?(0<f?(o=0,h=1):(o=0,h=-1),c=0,g=1,y=0,p=1,u=m):(0<l?(h=o=0,c=1):(h=o=0,c=-1),y=g=1,p=0,u=v),d=o*n+g*d,a=h*a+y*f,l=c*i+p*l,i=r.o*d+r.f*a+r.h*l,f=r.i*d+r.m*a+r.j*l,a=r.l*d+r.g*a+r.s*l,l=r.o*o+r.f*h+r.h*c,d=r.i*o+r.m*h+r.j*c,n=r.l*o+r.g*h+r.s*c,this.yh(t,l,d,n),this.Cg(t,s.v+l*-e,s.A+d*-e,s.B+n*-e,r.v+i,r.A+f,r.B+a,u,0)}else(i=(d-=n=(n=d<(n-=1e-9)?d:n)>(o+=1e-9)?n:o)*d+(o=f-(u=(u=f<(a-=1e-9)?f:a)>(h+=1e-9)?u:h))*o+(h=l-(p=(p=l<(i-=1e-9)?l:i)>(c+=1e-9)?p:c))*h)>=e*e||(i=Math.sqrt(i),f=r.o*n+r.f*u+r.h*p,a=r.i*n+r.m*u+r.j*p,l=r.l*n+r.g*u+r.s*p,0<(h=(c=r.o*d+r.f*o+r.h*h)*c+(n=r.i*d+r.m*o+r.j*h)*n+(d=r.l*d+r.g*o+r.s*h)*d)&&(h=1/Math.sqrt(h)),o=c*h,n*=h,d*=h,this.yh(t,o,n,d),this.Cg(t,s.v+o*-e,s.A+n*-e,s.B+d*-e,r.v+f,r.A+a,r.B+l,e-i,0))}}),At.ua=Pt,At.prototype=oe(Pt.prototype,{th:function(t,e,i,s,r){t.incremental=!1;var n,a,o,h,c,l,u,p,d,f=i.Ib;e=e.ab,i=i.ab,n=r.f,a=r.m,o=r.g,h=s.v,c=s.A,s=s.B,l=r.v+n*-f,u=r.A+a*-f,p=r.B+o*-f,n=r.v+n*f,a=r.A+a*f,d=r.B+o*f,o=a-u,f=f*f*4,p+=(a=d-p)*(n=0>(n=(h-l)*(r=n-l)+(c-u)*o+(s-p)*a)?0:n>f?1:n/f),(r=(a=h-(f=l+r*n))*a+(o=c-(u+=o*n))*o+(l=s-p)*l)>=(e+i)*(e+i)||(0<(r=Math.sqrt(r))?(a*=1/r,o*=1/r,l*=1/r):(a=1,l=o=0),this.yh(t,a,o,l),this.Cg(t,h+a*-e,c+o*-e,s+l*-e,f+a*i,u+o*i,p+l*i,e+i-r,0))}}),St.ua=Pt,St.prototype=oe(Pt.prototype,{th:function(t,e,i,s,r){var n,a,o;t.incremental=!1;var h=(n=s.v-r.v)*n+(a=s.A-r.A)*a+(o=s.B-r.B)*o;h>=((e=e.ab)+(i=i.ab))*(e+i)||(0<(h=Math.sqrt(h))?(n*=1/h,a*=1/h,o*=1/h):(n=1,o=a=0),this.yh(t,n,a,o),this.Cg(t,s.v+n*-e,s.A+a*-e,s.B+o*-e,r.v+n*i,r.A+a*i,r.B+o*i,e+i-h,0))}}),wt.prototype={io:function(){for(var t=this.jd;null!=t;){for(var e=t.M,i=0;3>i;){var s=i++;if(t.zb[s].sj=null,t.zb[s].Hi=null,-1==t.We[s])return this.Fc=2,!1;if(null==t.Ge[s])return this.Fc=3,!1}t=e}return!0},km:function(t,e,i){if(e.bl!=t){e.bl=t;var s=e.fi;s.x=i.x,s.y=i.y,s.z=i.z;var r=e.zb[0].xd,n=s.y-r.y,a=s.z-r.z;if(s.x=s.x-r.x,s.y=n,s.z=a,s=e.fi,r=e.dk,e.rj=0<s.x*r.x+s.y*r.y+s.z*r.z,e.rj){for(s=0;3>s;)if(r=s++,null!=(n=e.Ge[r])){(a=n.fi).x=i.x,a.y=i.y,a.z=i.z;var o=n.zb[0].xd,h=a.y-o.y,c=a.z-o.z;a.x=a.x-o.x,a.y=h,a.z=c,a=n.fi,o=n.dk,n.rj=0<a.x*o.x+a.y*o.y+a.z*o.z,n.rj?this.km(t,n,i):((a=e.zb[r]).Hi=e.zb[e.Ai[r]],a.sj=n)}for(t=0;3>t;)i=t++,null!=(s=e.Ge[i])&&(r=e.We[i],s.Ge[r]=null,s.We[r]=-1,e.Ge[i]=null,e.We[i]=-1);this.lh--,t=e.ia,i=e.M,null!=t&&(t.M=i),null!=i&&(i.ia=t),e==this.jd&&(this.jd=this.jd.M),e==this.Rc&&(this.Rc=this.Rc.ia),e.M=null,e.ia=null,e.tk(),e.M=this.De,this.De=e}else this.Fc=6}},fh:function(t,e,i,s){this.Fc=0,this.Ne=4,this.zb[0]=t,this.zb[1]=e,this.zb[2]=i,this.zb[3]=s;var r=this.mi,n=t.xd;r.x=n.x,r.y=n.y,r.z=n.z,n=e.xd;var a=r.y+n.y,o=r.z+n.z;return r.x+=n.x,r.y=a,r.z=o,n=i.xd,a=r.y+n.y,o=r.z+n.z,r.x+=n.x,r.y=a,r.z=o,n=s.xd,a=r.y+n.y,o=r.z+n.z,r.x+=n.x,r.y=a,r.z=o,n=.25*r.y,a=.25*r.z,r.x=.25*r.x,r.y=n,r.z=a,null!=(r=this.De)?(this.De=r.M,r.M=null):r=new Mt,null!=(n=this.De)?(this.De=n.M,n.M=null):n=new Mt,null!=(a=this.De)?(this.De=a.M,a.M=null):a=new Mt,null!=(o=this.De)?(this.De=o.M,o.M=null):o=new Mt,r.za(t,e,i,this.mi,!0)||(this.Fc=1),n.za(t,e,s,this.mi,!0)||(this.Fc=1),a.za(t,i,s,this.mi,!0)||(this.Fc=1),o.za(e,i,s,this.mi,!0)||(this.Fc=1),r.Rg(n)||(this.Fc=1),r.Rg(a)||(this.Fc=1),r.Rg(o)||(this.Fc=1),n.Rg(a)||(this.Fc=1),n.Rg(o)||(this.Fc=1),a.Rg(o)||(this.Fc=1),this.lh++,null==this.jd?this.jd=r:(this.Rc.M=r,r.ia=this.Rc),this.Rc=r,this.lh++,null==this.jd?this.jd=n:(this.Rc.M=n,n.ia=this.Rc),this.Rc=n,this.lh++,null==this.jd?this.jd=a:(this.Rc.M=a,a.ia=this.Rc),this.Rc=a,this.lh++,null==this.jd?this.jd=o:(this.Rc.M=o,o.ia=this.Rc),this.Rc=o,!this.Fc},Vm:function(t,e){this.zb[this.Ne++]=t;var i=e.zb[0];if(this.km(this.Ne,e,t.xd),0!=this.Fc)return!1;e=i;for(var s=null,r=null;;){if(null==e.Hi)return this.Fc=4,!1;if(null==e.sj)return this.Fc=5,!1;var n=this.De;if(null!=n?(this.De=n.M,n.M=null):n=new Mt,null==r&&(r=n),n.za(e,e.Hi,t,this.mi,!1)||(this.Fc=1),0!=this.Fc)return!1;if(this.lh++,null==this.jd?this.jd=n:(this.Rc.M=n,n.ia=this.Rc),this.Rc=n,n.Rg(e.sj)||(this.Fc=1),null==s||n.Rg(s)||(this.Fc=1),s=n,(e=e.Hi)==i)break}return s.Rg(r)||(this.Fc=1),0==this.Fc&&this.io()}},Mt.prototype={za:function(t,e,i,s,r){null==r&&(r=!1);var n,a,o,h,c,l,u,p,d,f=t.xd;n=f.x,a=f.y,o=f.z;var m=e.xd;h=m.x,c=m.y,l=m.z;var g,y,v,b,x,_,M,w,S,A=i.xd;u=A.x,p=A.y,d=A.z;var T=!1;if(0>(n-s.x)*(M=(y=c-a)*(_=d-o)-(v=l-o)*(x=p-a))+(a-s.y)*(w=v*(b=u-n)-(g=h-n)*_)+(o-s.z)*(S=g*x-y*b))if(r){var C=e;e=i,i=C,M*=-1,w*=-1,S*=-1}else T=!0;this.zb[0]=t,this.zb[1]=e,this.zb[2]=i;var L=this.dk;L.x=M,L.y=w,L.z=S;var E,z,R,B,P,D,I,O,F,G,N,j,V,U,k,H,W,q,$,J,X,Y=t.xd,K=e.xd,Z=i.xd,Q=this.fi;E=Y.x,z=Y.y,R=Y.z,B=K.x,P=K.y,D=K.z,I=Z.x;var tt,et,it,st=B*((U=(O=Z.y)-P)*(X=(G=B-E)*U-(N=P-z)*(V=I-B))-(k=(F=Z.z)-D)*(J=(j=D-R)*V-G*k))+P*(k*($=N*k-j*U)-V*X)+D*(V*J-U*$),rt=I*((W=z-O)*X-(q=R-F)*J)+O*(q*$-(H=E-I)*X)+F*(H*J-W*$),nt=-1;if(it=et=tt=0,0>E*(N*X-j*J)+z*(j*$-G*X)+R*(G*J-N*$)){var at,ot,ht,ct,lt,ut,pt,dt,ft,mt;if(at=Y.x,ot=Y.y,ht=Y.z,0>(mt=-(mt=(pt=(ct=K.x)-at)*at+(dt=(lt=K.y)-ot)*ot+(ft=(ut=K.z)-ht)*ht)/(pt*pt+dt*dt+ft*ft)))Q.x=at,Q.y=ot,Q.z=ht;else if(1<mt)Q.x=ct,Q.y=lt,Q.z=ut;else{var gt,yt,vt;gt=at+pt*mt,yt=ot+dt*mt,vt=ht+ft*mt,Q.x=gt,Q.y=yt,Q.z=vt}nt=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z,tt=Q.x,et=Q.y,it=Q.z}if(0>st){var bt,xt,_t,Mt,wt,St,At,Tt,Ct,Lt;if(bt=K.x,xt=K.y,_t=K.z,0>(Lt=-(Lt=(At=(Mt=Z.x)-bt)*bt+(Tt=(wt=Z.y)-xt)*xt+(Ct=(St=Z.z)-_t)*_t)/(At*At+Tt*Tt+Ct*Ct)))Q.x=bt,Q.y=xt,Q.z=_t;else if(1<Lt)Q.x=Mt,Q.y=wt,Q.z=St;else{var Et,zt,Rt;Et=bt+At*Lt,zt=xt+Tt*Lt,Rt=_t+Ct*Lt,Q.x=Et,Q.y=zt,Q.z=Rt}var Bt=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;(0>nt||Bt<nt)&&(nt=Bt,tt=Q.x,et=Q.y,it=Q.z)}if(0>rt){var Pt,Dt,It,Ot,Ft,Gt,Nt,jt,Vt,Ut;if(Pt=Y.x,Dt=Y.y,It=Y.z,0>(Ut=-(Ut=(Nt=(Ot=Z.x)-Pt)*Pt+(jt=(Ft=Z.y)-Dt)*Dt+(Vt=(Gt=Z.z)-It)*It)/(Nt*Nt+jt*jt+Vt*Vt)))Q.x=Pt,Q.y=Dt,Q.z=It;else if(1<Ut)Q.x=Ot,Q.y=Ft,Q.z=Gt;else{var kt,Ht,Wt;kt=Pt+Nt*Ut,Ht=Dt+jt*Ut,Wt=It+Vt*Ut,Q.x=kt,Q.y=Ht,Q.z=Wt}var qt=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;(0>nt||qt<nt)&&(nt=qt,tt=Q.x,et=Q.y,it=Q.z)}if(0<nt)Q.x=tt,Q.y=et,Q.z=it;else{var $t,Jt=$*$+J*J+X*X;0<Jt&&(Jt=1/Math.sqrt(Jt)),tt=($*=Jt)*($t=(E*$+z*(J*=Jt)+R*(X*=Jt))/($t=$*$+J*J+X*X)),et=J*$t,it=X*$t,Q.x=tt,Q.y=et,Q.z=it}var Xt=this.fi;return this.Wj=Xt.x*Xt.x+Xt.y*Xt.y+Xt.z*Xt.z,this.Ge[0]=null,this.Ge[1]=null,this.Ge[2]=null,this.We[0]=-1,this.We[1]=-1,this.We[2]=-1,!T},Rg:function(t){for(var e=0,i=0;3>i;)for(var s=i++,r=0;3>r;){var n=r++,a=this.Ai[s];this.zb[s]==t.zb[this.Ai[n]]&&this.zb[a]==t.zb[n]&&(this.Ge[s]=t,this.We[s]=n,t.Ge[n]=this,t.We[n]=s,++e)}return 1==e},tk:function(){this.ia=this.M=null,this.bl=0,this.rj=!1,this.Wj=0,this.zb[0]=null,this.zb[1]=null,this.zb[2]=null,this.Ge[0]=null,this.Ge[1]=null,this.Ge[2]=null,this.We[0]=0,this.We[1]=0,this.We[2]=0}},_t.prototype={za:function(t,e,i){var s=this.xd;return s.x=t.x,s.y=t.y,s.z=t.z,(t=this.jb).x=e.x,t.y=e.y,t.z=e.z,(e=this.qb).x=i.x,e.y=i.y,e.z=i.z,this.sj=this.Hi=this.M=null,this},tk:function(){this.sj=this.Hi=this.M=null}},xt.prototype={clear:function(){this.Il.Z()}},bt.prototype={za:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},Z:function(){return this.z=this.y=this.x=0,this},Lc:function(t){return new bt(this.x+t.x,this.y+t.y,this.z+t.z)},ua:function(t,e){return new bt(this.x+t.x*e,this.y+t.y*e,this.z+t.z*e)},ue:function(t){return new bt(this.x-t.x,this.y-t.y,this.z-t.z)},se:function(t){return new bt(this.x*t,this.y*t,this.z*t)},Ve:function(t,e,i){return new bt(this.x*t,this.y*e,this.z*i)},Yd:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},Hb:function(t){return new bt(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},fd:function(t){var e=this.y+t.y,i=this.z+t.z;return this.x+=t.x,this.y=e,this.z=i,this},cb:function(t,e){var i=this.y+t.y*e,s=this.z+t.z*e;return this.x+=t.x*e,this.y=i,this.z=s,this},Ue:function(t){var e=this.y-t.y,i=this.z-t.z;return this.x=this.x-t.x,this.y=e,this.z=i,this},te:function(t){var e=this.y*t,i=this.z*t;return this.x=this.x*t,this.y=e,this.z=i,this},Mf:function(t,e,i){return e=this.y*e,i=this.z*i,this.x=this.x*t,this.y=e,this.z=i,this},Mb:function(t){var e=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=e,this.z=i,this},pc:function(t){return new bt(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)},uc:function(t){return new bt(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)},Ac:function(t){var e,i,s,r,n;return e=this.x,i=this.y,s=this.z,r=t.o*e+t.f*i+t.h*s,n=t.i*e+t.m*i+t.j*s,s=t.l*e+t.g*i+t.s*s,e=r+t.v,i=n+t.A,s+=t.B,(t=new bt).x=e,t.y=i,t.z=s,t},qc:function(t){var e=this.x*t.e10+this.y*t.e11+this.z*t.e12,i=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=e,this.z=i,this},vc:function(t){var e=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,i=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=e,this.z=i,this},Ec:function(t){var e,i,s,r,n;return e=this.x,i=this.y,s=this.z,r=t.o*e+t.f*i+t.h*s,n=t.i*e+t.m*i+t.j*s,s=t.l*e+t.g*i+t.s*s,e=r+t.v,i=n+t.A,s+=t.B,this.x=e,this.y=i,this.z=s,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},pe:function(){return this.x*this.x+this.y*this.y+this.z*this.z},re:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0<t&&(t=1/t),new bt(this.x*t,this.y*t,this.z*t)},qe:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);0<t&&(t=1/t);var e=this.y*t,i=this.z*t;return this.x=this.x*t,this.y=e,this.z=i,this},Jc:function(){return new bt(-this.x,-this.y,-this.z)},Kc:function(){var t=-this.y,e=-this.z;return this.x=-this.x,this.y=t,this.z=e,this},de:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},clone:function(){return new bt(this.x,this.y,this.z)},toString:function(){return"Vec3["+(0<this.x?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(0<this.y?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(0<this.z?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}},vt.prototype={Wf:function(){return this.B=this.A=this.v=0,this.o=1,this.i=this.h=this.f=0,this.m=1,this.g=this.l=this.j=0,this.s=1,this},Hb:function(){var t=new bt;return t.x=this.v,t.y=this.A,t.z=this.B,t},Mb:function(t){t.x=this.v,t.y=this.A,t.z=this.B},Ec:function(t){return this.v=t.x,this.A=t.y,this.B=t.z,this},Lc:function(t){var e,i;e=t.x,i=t.y,t=t.z,this.v+=e,this.A+=i,this.B+=t},pc:function(){var t=new dt;return t.e00=this.o,t.e01=this.f,t.e02=this.h,t.e10=this.i,t.e11=this.m,t.e12=this.j,t.e20=this.l,t.e21=this.g,t.e22=this.s,t},qc:function(t){t.e00=this.o,t.e01=this.f,t.e02=this.h,t.e10=this.i,t.e11=this.m,t.e12=this.j,t.e20=this.l,t.e21=this.g,t.e22=this.s},Jc:function(t){return this.o=t.e00,this.f=t.e01,this.h=t.e02,this.i=t.e10,this.m=t.e11,this.j=t.e12,this.l=t.e20,this.g=t.e21,this.s=t.e22,this},Kc:function(t){var e,i,s;e=t.x,i=t.y,s=t.z,t=Math.sin(e);var r=Math.sin(i),n=Math.sin(s);e=Math.cos(e),i=Math.cos(i),s=Math.cos(s),this.o=i*s,this.f=-i*n,this.h=r,this.i=e*n+s*t*r,this.m=e*s-t*r*n,this.j=-i*t,this.l=t*n-e*s*r,this.g=s*t+e*r*n,this.s=e*i},uc:function(t){var e,i,s,r,n,a,o,h,c,l;e=t.e00,i=t.e01,s=t.e02,r=t.e10,n=t.e11,a=t.e12,o=t.e20,h=t.e21,c=t.e22,t=e*this.o+i*this.i+s*this.l,l=e*this.f+i*this.m+s*this.g,e=e*this.h+i*this.j+s*this.s,i=r*this.o+n*this.i+a*this.l,s=r*this.f+n*this.m+a*this.g,r=r*this.h+n*this.j+a*this.s,n=o*this.o+h*this.i+c*this.l,a=o*this.f+h*this.m+c*this.g,o=o*this.h+h*this.j+c*this.s,this.o=t,this.f=l,this.h=e,this.i=i,this.m=s,this.j=r,this.l=n,this.g=a,this.s=o},vc:function(t){var e,i,s,r,n,a,o;e=t.x,i=t.y,t=t.z,a=Math.sin(e);var h=Math.sin(i),c=Math.sin(t),l=Math.cos(e);o=Math.cos(i);var u=Math.cos(t);s=o*u,r=-o*c,t=l*c+u*a*h,e=l*u-a*h*c,n=-o*a,i=a*c-l*u*h,a=u*a+l*h*c,o*=l,c=s*this.o+r*this.i+h*this.l,l=s*this.f+r*this.m+h*this.g,h=s*this.h+r*this.j+h*this.s,s=t*this.o+e*this.i+n*this.l,r=t*this.f+e*this.m+n*this.g,t=t*this.h+e*this.j+n*this.s,e=i*this.o+a*this.i+o*this.l,n=i*this.f+a*this.m+o*this.g,i=i*this.h+a*this.j+o*this.s,this.o=c,this.f=l,this.h=h,this.i=s,this.m=r,this.j=t,this.l=e,this.g=n,this.s=i},ua:function(){var t,e,i,s,r,n=new ct;return 0<(s=(t=this.o)+(e=this.m)+(i=this.s))?(s=.5*(r=Math.sqrt(s+1)),r=.5/r,t=(this.g-this.j)*r,e=(this.h-this.l)*r,i=(this.i-this.f)*r):t>e?t>i?(t=.5*(r=Math.sqrt(t-e-i+1)),r=.5/r,e=(this.f+this.i)*r,i=(this.h+this.l)*r,s=(this.g-this.j)*r):(i=.5*(r=Math.sqrt(i-t-e+1)),r=.5/r,t=(this.h+this.l)*r,e=(this.j+this.g)*r,s=(this.i-this.f)*r):e>i?(e=.5*(r=Math.sqrt(e-i-t+1)),r=.5/r,t=(this.f+this.i)*r,i=(this.j+this.g)*r,s=(this.h-this.l)*r):(i=.5*(r=Math.sqrt(i-t-e+1)),r=.5/r,t=(this.h+this.l)*r,e=(this.j+this.g)*r,s=(this.i-this.f)*r),n.x=t,n.y=e,n.z=i,n.w=s,n},cb:function(t){var e,i,s,r,n;0<(r=(e=this.o)+(i=this.m)+(s=this.s))?(r=.5*(n=Math.sqrt(r+1)),n=.5/n,e=(this.g-this.j)*n,i=(this.h-this.l)*n,s=(this.i-this.f)*n):e>i?e>s?(e=.5*(n=Math.sqrt(e-i-s+1)),n=.5/n,i=(this.f+this.i)*n,s=(this.h+this.l)*n,r=(this.g-this.j)*n):(s=.5*(n=Math.sqrt(s-e-i+1)),n=.5/n,e=(this.h+this.l)*n,i=(this.j+this.g)*n,r=(this.i-this.f)*n):i>s?(i=.5*(n=Math.sqrt(i-s-e+1)),n=.5/n,e=(this.f+this.i)*n,s=(this.j+this.g)*n,r=(this.h-this.l)*n):(s=.5*(n=Math.sqrt(s-e-i+1)),n=.5/n,e=(this.h+this.l)*n,i=(this.j+this.g)*n,r=(this.i-this.f)*n),t.x=e,t.y=i,t.z=s,t.w=r},Ac:function(t){var e,i,s;e=t.x,i=t.y,s=t.z;var r=t.w,n=2*e,a=2*i,o=2*s;t=e*n;var h=i*a;s*=o;var c=e*a;return i*=o,e*=o,n*=r,a*=r,r*=o,this.o=1-h-s,this.f=c-r,this.h=e+a,this.i=c+r,this.m=1-t-s,this.j=i-n,this.l=e-a,this.g=i+n,this.s=1-t-h,this},clone:function(){var t=new vt;return t.v=this.v,t.A=this.A,t.B=this.B,t.o=this.o,t.f=this.f,t.h=this.h,t.i=this.i,t.m=this.m,t.j=this.j,t.l=this.l,t.g=this.g,t.s=this.s,t},de:function(t){return this.v=t.v,this.A=t.A,this.B=t.B,this.o=t.o,this.f=t.f,this.h=t.h,this.i=t.i,this.m=t.m,this.j=t.j,this.l=t.l,this.g=t.g,this.s=t.s,this}},gt.pc=function(){return gt.cb},gt.prototype={zj:function(t,e,i,s,r,n){this.wj=t,this.jl=e,this.tc=i,this.Ic=s;var a,o,h,c=this.Na,l=this.jb,u=this.qb,p=this.closest,d=this.dir;null!=r?(null==r.oi&&(r.oi=new xt),this.Pn(r.oi)):d.Z(),d.x*d.x+d.y*d.y+d.z*d.z||(a=s.v-i.v,o=s.A-i.A,h=s.B-i.B,d.x=a,d.y=o,d.z=h,1e-6>d.x*d.x+d.y*d.y+d.z*d.z&&d.za(1,0,0)),this.ya=0,this.zf(!1),this.Af(!1);var f=this.Na[this.ya],m=this.jb[this.ya];f.x=m.x,f.y=m.y,f.z=m.z;var g=this.qb[this.ya],y=f.y-g.y,v=f.z-g.z;f.x=f.x-g.x,f.y=y,f.z=v,this.ya=1;for(var b=0;40>b;){var x=0;switch(this.ya){case 1:var _=c[0];p.x=_.x,p.y=_.y,p.z=_.z,x=1;break;case 2:var M,w,S,A,T,C,L=c[0];M=L.x,w=L.y,S=L.z;var E,z,R,B,P=c[1];if(0>(B=-(B=(E=(A=P.x)-M)*M+(z=(T=P.y)-w)*w+(R=(C=P.z)-S)*S)/(E*E+z*z+R*R))){var D=p;D.x=M,D.y=w,D.z=S,x=1}else if(1<B){var I=p;I.x=A,I.y=T,I.z=C,x=2}else{var O,F,G;O=M+E*B,F=w+z*B,G=S+R*B;var N=p;N.x=O,N.y=F,N.z=G,x=3}break;case 3:var j,V,U,k,H,W,q,$,J,X,Y,K,Z,Q,tt,et,it,st,rt=c[0],nt=c[1],at=c[2],ot=rt;j=ot.x,V=ot.y,U=ot.z;var ht=nt;k=ht.x,H=ht.y,W=ht.z;var ct,lt,ut,pt=at;q=pt.x;var dt,ft,mt,gt=k*((Q=($=pt.y)-H)*(ut=(X=k-j)*Q-(Y=H-V)*(Z=q-k))-(tt=(J=pt.z)-W)*(lt=(K=W-U)*Z-X*tt))+H*(tt*(ct=Y*tt-K*Q)-Z*ut)+W*(Z*lt-Q*ct),yt=q*((it=V-$)*ut-(st=U-J)*lt)+$*(st*ct-(et=j-q)*ut)+J*(et*lt-it*ct),vt=-1,bt=0;if(mt=ft=dt=0,0>j*(Y*ut-K*lt)+V*(K*ct-X*ut)+U*(X*lt-Y*ct)){var _t,Mt,wt,St,At,Tt,Ct=rt;_t=Ct.x,Mt=Ct.y,wt=Ct.z;var Lt,Et,zt,Rt,Bt,Pt=nt;if(0>(Rt=-(Rt=(Lt=(St=Pt.x)-_t)*_t+(Et=(At=Pt.y)-Mt)*Mt+(zt=(Tt=Pt.z)-wt)*wt)/(Lt*Lt+Et*Et+zt*zt))){var Dt=p;Dt.x=_t,Dt.y=Mt,Dt.z=wt,Bt=1}else if(1<Rt){var It=p;It.x=St,It.y=At,It.z=Tt,Bt=2}else{var Ot,Ft,Gt;Ot=_t+Lt*Rt,Ft=Mt+Et*Rt,Gt=wt+zt*Rt;var Nt=p;Nt.x=Ot,Nt.y=Ft,Nt.z=Gt,Bt=3}bt=Bt,vt=p.x*p.x+p.y*p.y+p.z*p.z;var jt=p;dt=jt.x,ft=jt.y,mt=jt.z}if(0>gt){var Vt,Ut,kt,Ht,Wt,qt,$t=nt;Vt=$t.x,Ut=$t.y,kt=$t.z;var Jt,Xt,Yt,Kt,Zt,Qt=at;if(0>(Kt=-(Kt=(Jt=(Ht=Qt.x)-Vt)*Vt+(Xt=(Wt=Qt.y)-Ut)*Ut+(Yt=(qt=Qt.z)-kt)*kt)/(Jt*Jt+Xt*Xt+Yt*Yt))){var te=p;te.x=Vt,te.y=Ut,te.z=kt,Zt=1}else if(1<Kt){var ee=p;ee.x=Ht,ee.y=Wt,ee.z=qt,Zt=2}else{var ie,se,re;ie=Vt+Jt*Kt,se=Ut+Xt*Kt,re=kt+Yt*Kt;var ne=p;ne.x=ie,ne.y=se,ne.z=re,Zt=3}var ae=p.x*p.x+p.y*p.y+p.z*p.z;if(0>vt||ae<vt){bt=Zt<<1,vt=ae;var oe=p;dt=oe.x,ft=oe.y,mt=oe.z}}if(0>yt){var he,ce,le,ue,pe,de,fe=rt;he=fe.x,ce=fe.y,le=fe.z;var me,ge,ye,ve,be,xe=at;if(0>(ve=-(ve=(me=(ue=xe.x)-he)*he+(ge=(pe=xe.y)-ce)*ce+(ye=(de=xe.z)-le)*le)/(me*me+ge*ge+ye*ye))){var _e=p;_e.x=he,_e.y=ce,_e.z=le,be=1}else if(1<ve){var Me=p;Me.x=ue,Me.y=pe,Me.z=de,be=2}else{var we,Se,Ae;we=he+me*ve,Se=ce+ge*ve,Ae=le+ye*ve;var Te=p;Te.x=we,Te.y=Se,Te.z=Ae,be=3}var Ce=p.x*p.x+p.y*p.y+p.z*p.z;if(0>vt||Ce<vt){bt=1&be|(2&be)<<1,vt=Ce;var Le=p;dt=Le.x,ft=Le.y,mt=Le.z}}if(0<vt){var Ee=p;Ee.x=dt,Ee.y=ft,Ee.z=mt,x=bt}else{var ze,Re=ct*ct+lt*lt+ut*ut;0<Re&&(Re=1/Math.sqrt(Re)),dt=(ct*=Re)*(ze=(j*ct+V*(lt*=Re)+U*(ut*=Re))/(ze=ct*ct+lt*lt+ut*ut)),ft=lt*ze,mt=ut*ze;var Be=p;Be.x=dt,Be.y=ft,Be.z=mt,x=7}break;case 4:var Pe,De,Ie,Oe,Fe,Ge,Ne,je,Ve,Ue,ke,He,We,qe,$e,Je,Xe,Ye,Ke,Ze,Qe,ti,ei,ii,si,ri,ni,ai=c[0],oi=c[1],hi=c[2],ci=c[3],li=ai;Pe=li.x,De=li.y,Ie=li.z;var ui=oi;Oe=ui.x,Fe=ui.y,Ge=ui.z;var pi=hi;Ne=pi.x,je=pi.y,Ve=pi.z;var di,fi,mi,gi=ci;Ue=gi.x;var yi,vi,bi,xi=0<(We=Oe-Pe)*(di=(ri=(ke=gi.y)-Fe)*(ii=Ve-Ge)-(ni=(He=gi.z)-Ge)*(ei=je-Fe))+(qe=Fe-De)*(fi=ni*(ti=Ne-Oe)-(si=Ue-Oe)*ii)+($e=Ge-Ie)*(mi=si*ei-ri*ti)?1:-1,_i=Pe*((Xe=je-De)*(Qe=He-Ie)-(Ye=Ve-Ie)*(Ze=ke-De))+De*(Ye*(Ke=Ue-Pe)-(Je=Ne-Pe)*Qe)+Ie*(Je*Ze-Xe*Ke),Mi=Pe*(Ze*$e-Qe*qe)+De*(Qe*We-Ke*$e)+Ie*(Ke*qe-Ze*We),wi=Oe*di+Fe*fi+Ge*mi,Si=-1,Ai=0;if(bi=vi=yi=0,0>(Pe*(qe*Ye-$e*Xe)+De*($e*Je-We*Ye)+Ie*(We*Xe-qe*Je))*xi){var Ti,Ci,Li,Ei,zi,Ri,Bi,Pi,Di,Ii,Oi,Fi,Gi,Ni,ji,Vi,Ui,ki,Hi=ai;Ti=Hi.x,Ci=Hi.y,Li=Hi.z;var Wi=oi;Ei=Wi.x,zi=Wi.y,Ri=Wi.z;var qi,$i,Ji,Xi=hi;Bi=Xi.x;var Yi,Ki,Zi,Qi,ts=Ei*((Ni=(Pi=Xi.y)-zi)*(Ji=(Ii=Ei-Ti)*Ni-(Oi=zi-Ci)*(Gi=Bi-Ei))-(ji=(Di=Xi.z)-Ri)*($i=(Fi=Ri-Li)*Gi-Ii*ji))+zi*(ji*(qi=Oi*ji-Fi*Ni)-Gi*Ji)+Ri*(Gi*$i-Ni*qi),es=Bi*((Ui=Ci-Pi)*Ji-(ki=Li-Di)*$i)+Pi*(ki*qi-(Vi=Ti-Bi)*Ji)+Di*(Vi*$i-Ui*qi),is=-1,ss=0;if(Zi=Ki=Yi=0,0>Ti*(Oi*Ji-Fi*$i)+Ci*(Fi*qi-Ii*Ji)+Li*(Ii*$i-Oi*qi)){var rs,ns,as,os,hs,cs,ls=ai;rs=ls.x,ns=ls.y,as=ls.z;var us,ps,ds,fs,ms,gs=oi;if(0>(fs=-(fs=(us=(os=gs.x)-rs)*rs+(ps=(hs=gs.y)-ns)*ns+(ds=(cs=gs.z)-as)*as)/(us*us+ps*ps+ds*ds))){var ys=p;ys.x=rs,ys.y=ns,ys.z=as,ms=1}else if(1<fs){var vs=p;vs.x=os,vs.y=hs,vs.z=cs,ms=2}else{var bs,xs,_s;bs=rs+us*fs,xs=ns+ps*fs,_s=as+ds*fs;var Ms=p;Ms.x=bs,Ms.y=xs,Ms.z=_s,ms=3}ss=ms,is=p.x*p.x+p.y*p.y+p.z*p.z;var ws=p;Yi=ws.x,Ki=ws.y,Zi=ws.z}if(0>ts){var Ss,As,Ts,Cs,Ls,Es,zs=oi;Ss=zs.x,As=zs.y,Ts=zs.z;var Rs,Bs,Ps,Ds,Is,Os=hi;if(0>(Ds=-(Ds=(Rs=(Cs=Os.x)-Ss)*Ss+(Bs=(Ls=Os.y)-As)*As+(Ps=(Es=Os.z)-Ts)*Ts)/(Rs*Rs+Bs*Bs+Ps*Ps))){var Fs=p;Fs.x=Ss,Fs.y=As,Fs.z=Ts,Is=1}else if(1<Ds){var Gs=p;Gs.x=Cs,Gs.y=Ls,Gs.z=Es,Is=2}else{var Ns,js,Vs;Ns=Ss+Rs*Ds,js=As+Bs*Ds,Vs=Ts+Ps*Ds;var Us=p;Us.x=Ns,Us.y=js,Us.z=Vs,Is=3}var ks=p.x*p.x+p.y*p.y+p.z*p.z;if(0>is||ks<is){ss=Is<<1,is=ks;var Hs=p;Yi=Hs.x,Ki=Hs.y,Zi=Hs.z}}if(0>es){var Ws,qs,$s,Js,Xs,Ys,Ks=ai;Ws=Ks.x,qs=Ks.y,$s=Ks.z;var Zs,Qs,tr,er,ir,sr=hi;if(0>(er=-(er=(Zs=(Js=sr.x)-Ws)*Ws+(Qs=(Xs=sr.y)-qs)*qs+(tr=(Ys=sr.z)-$s)*$s)/(Zs*Zs+Qs*Qs+tr*tr))){var rr=p;rr.x=Ws,rr.y=qs,rr.z=$s,ir=1}else if(1<er){var nr=p;nr.x=Js,nr.y=Xs,nr.z=Ys,ir=2}else{var ar,or,hr;ar=Ws+Zs*er,or=qs+Qs*er,hr=$s+tr*er;var cr=p;cr.x=ar,cr.y=or,cr.z=hr,ir=3}var lr=p.x*p.x+p.y*p.y+p.z*p.z;if(0>is||lr<is){ss=1&ir|(2&ir)<<1,is=lr;var ur=p;Yi=ur.x,Ki=ur.y,Zi=ur.z}}if(0<is){var pr=p;pr.x=Yi,pr.y=Ki,pr.z=Zi,Qi=ss}else{var dr,fr=qi*qi+$i*$i+Ji*Ji;0<fr&&(fr=1/Math.sqrt(fr)),Yi=(qi*=fr)*(dr=(Ti*qi+Ci*($i*=fr)+Li*(Ji*=fr))/(dr=qi*qi+$i*$i+Ji*Ji)),Ki=$i*dr,Zi=Ji*dr;var mr=p;mr.x=Yi,mr.y=Ki,mr.z=Zi,Qi=7}Ai=Qi,Si=p.x*p.x+p.y*p.y+p.z*p.z;var gr=p;yi=gr.x,vi=gr.y,bi=gr.z}if(0>_i*xi){var yr,vr,br,xr,_r,Mr,wr,Sr,Ar,Tr,Cr,Lr,Er,zr,Rr,Br,Pr,Dr,Ir=ai;yr=Ir.x,vr=Ir.y,br=Ir.z;var Or=hi;xr=Or.x,_r=Or.y,Mr=Or.z;var Fr,Gr,Nr,jr=ci;wr=jr.x;var Vr,Ur,kr,Hr,Wr=xr*((zr=(Sr=jr.y)-_r)*(Nr=(Tr=xr-yr)*zr-(Cr=_r-vr)*(Er=wr-xr))-(Rr=(Ar=jr.z)-Mr)*(Gr=(Lr=Mr-br)*Er-Tr*Rr))+_r*(Rr*(Fr=Cr*Rr-Lr*zr)-Er*Nr)+Mr*(Er*Gr-zr*Fr),qr=wr*((Pr=vr-Sr)*Nr-(Dr=br-Ar)*Gr)+Sr*(Dr*Fr-(Br=yr-wr)*Nr)+Ar*(Br*Gr-Pr*Fr),$r=-1,Jr=0;if(kr=Ur=Vr=0,0>yr*(Cr*Nr-Lr*Gr)+vr*(Lr*Fr-Tr*Nr)+br*(Tr*Gr-Cr*Fr)){var Xr,Yr,Kr,Zr,Qr,tn,en=ai;Xr=en.x,Yr=en.y,Kr=en.z;var sn,rn,nn,an,on,hn=hi;if(0>(an=-(an=(sn=(Zr=hn.x)-Xr)*Xr+(rn=(Qr=hn.y)-Yr)*Yr+(nn=(tn=hn.z)-Kr)*Kr)/(sn*sn+rn*rn+nn*nn))){var cn=p;cn.x=Xr,cn.y=Yr,cn.z=Kr,on=1}else if(1<an){var ln=p;ln.x=Zr,ln.y=Qr,ln.z=tn,on=2}else{var un,pn,dn;un=Xr+sn*an,pn=Yr+rn*an,dn=Kr+nn*an;var fn=p;fn.x=un,fn.y=pn,fn.z=dn,on=3}Jr=on,$r=p.x*p.x+p.y*p.y+p.z*p.z;var mn=p;Vr=mn.x,Ur=mn.y,kr=mn.z}if(0>Wr){var gn,yn,vn,bn,xn,_n,Mn=hi;gn=Mn.x,yn=Mn.y,vn=Mn.z;var wn,Sn,An,Tn,Cn,Ln=ci;if(0>(Tn=-(Tn=(wn=(bn=Ln.x)-gn)*gn+(Sn=(xn=Ln.y)-yn)*yn+(An=(_n=Ln.z)-vn)*vn)/(wn*wn+Sn*Sn+An*An))){var En=p;En.x=gn,En.y=yn,En.z=vn,Cn=1}else if(1<Tn){var zn=p;zn.x=bn,zn.y=xn,zn.z=_n,Cn=2}else{var Rn,Bn,Pn;Rn=gn+wn*Tn,Bn=yn+Sn*Tn,Pn=vn+An*Tn;var Dn=p;Dn.x=Rn,Dn.y=Bn,Dn.z=Pn,Cn=3}var In=p.x*p.x+p.y*p.y+p.z*p.z;if(0>$r||In<$r){Jr=Cn<<1,$r=In;var On=p;Vr=On.x,Ur=On.y,kr=On.z}}if(0>qr){var Fn,Gn,Nn,jn,Vn,Un,kn=ai;Fn=kn.x,Gn=kn.y,Nn=kn.z;var Hn,Wn,qn,$n,Jn,Xn=ci;if(0>($n=-($n=(Hn=(jn=Xn.x)-Fn)*Fn+(Wn=(Vn=Xn.y)-Gn)*Gn+(qn=(Un=Xn.z)-Nn)*Nn)/(Hn*Hn+Wn*Wn+qn*qn))){var Yn=p;Yn.x=Fn,Yn.y=Gn,Yn.z=Nn,Jn=1}else if(1<$n){var Kn=p;Kn.x=jn,Kn.y=Vn,Kn.z=Un,Jn=2}else{var Zn,Qn,ta;Zn=Fn+Hn*$n,Qn=Gn+Wn*$n,ta=Nn+qn*$n;var ea=p;ea.x=Zn,ea.y=Qn,ea.z=ta,Jn=3}var ia=p.x*p.x+p.y*p.y+p.z*p.z;if(0>$r||ia<$r){Jr=1&Jn|(2&Jn)<<1,$r=ia;var sa=p;Vr=sa.x,Ur=sa.y,kr=sa.z}}if(0<$r){var ra=p;ra.x=Vr,ra.y=Ur,ra.z=kr,Hr=Jr}else{var na,aa=Fr*Fr+Gr*Gr+Nr*Nr;0<aa&&(aa=1/Math.sqrt(aa)),Vr=(Fr*=aa)*(na=(yr*Fr+vr*(Gr*=aa)+br*(Nr*=aa))/(na=Fr*Fr+Gr*Gr+Nr*Nr)),Ur=Gr*na,kr=Nr*na;var oa=p;oa.x=Vr,oa.y=Ur,oa.z=kr,Hr=7}var ha=p.x*p.x+p.y*p.y+p.z*p.z;if(0>Si||ha<Si){Ai=1&Hr|(6&Hr)<<1,Si=ha;var ca=p;yi=ca.x,vi=ca.y,bi=ca.z}}if(0>Mi*xi){var la,ua,pa,da,fa,ma,ga,ya,va,ba,xa,_a,Ma,wa,Sa,Aa,Ta,Ca,La=ai;la=La.x,ua=La.y,pa=La.z;var Ea=oi;da=Ea.x,fa=Ea.y,ma=Ea.z;var za,Ra,Ba,Pa=ci;ga=Pa.x;var Da,Ia,Oa,Fa,Ga=da*((wa=(ya=Pa.y)-fa)*(Ba=(ba=da-la)*wa-(xa=fa-ua)*(Ma=ga-da))-(Sa=(va=Pa.z)-ma)*(Ra=(_a=ma-pa)*Ma-ba*Sa))+fa*(Sa*(za=xa*Sa-_a*wa)-Ma*Ba)+ma*(Ma*Ra-wa*za),Na=ga*((Ta=ua-ya)*Ba-(Ca=pa-va)*Ra)+ya*(Ca*za-(Aa=la-ga)*Ba)+va*(Aa*Ra-Ta*za),ja=-1,Va=0;if(Oa=Ia=Da=0,0>la*(xa*Ba-_a*Ra)+ua*(_a*za-ba*Ba)+pa*(ba*Ra-xa*za)){var Ua,ka,Ha,Wa,qa,$a,Ja=ai;Ua=Ja.x,ka=Ja.y,Ha=Ja.z;var Xa,Ya,Ka,Za,Qa,to=oi;if(0>(Za=-(Za=(Xa=(Wa=to.x)-Ua)*Ua+(Ya=(qa=to.y)-ka)*ka+(Ka=($a=to.z)-Ha)*Ha)/(Xa*Xa+Ya*Ya+Ka*Ka))){var eo=p;eo.x=Ua,eo.y=ka,eo.z=Ha,Qa=1}else if(1<Za){var io=p;io.x=Wa,io.y=qa,io.z=$a,Qa=2}else{var so,ro,no;so=Ua+Xa*Za,ro=ka+Ya*Za,no=Ha+Ka*Za;var ao=p;ao.x=so,ao.y=ro,ao.z=no,Qa=3}Va=Qa,ja=p.x*p.x+p.y*p.y+p.z*p.z;var oo=p;Da=oo.x,Ia=oo.y,Oa=oo.z}if(0>Ga){var ho,co,lo,uo,po,fo,mo=oi;ho=mo.x,co=mo.y,lo=mo.z;var go,yo,vo,bo,xo,_o=ci;if(0>(bo=-(bo=(go=(uo=_o.x)-ho)*ho+(yo=(po=_o.y)-co)*co+(vo=(fo=_o.z)-lo)*lo)/(go*go+yo*yo+vo*vo))){var Mo=p;Mo.x=ho,Mo.y=co,Mo.z=lo,xo=1}else if(1<bo){var wo=p;wo.x=uo,wo.y=po,wo.z=fo,xo=2}else{var So,Ao,To;So=ho+go*bo,Ao=co+yo*bo,To=lo+vo*bo;var Co=p;Co.x=So,Co.y=Ao,Co.z=To,xo=3}var Lo=p.x*p.x+p.y*p.y+p.z*p.z;if(0>ja||Lo<ja){Va=xo<<1,ja=Lo;var Eo=p;Da=Eo.x,Ia=Eo.y,Oa=Eo.z}}if(0>Na){var zo,Ro,Bo,Po,Do,Io,Oo=ai;zo=Oo.x,Ro=Oo.y,Bo=Oo.z;var Fo,Go,No,jo,Vo,Uo=ci;if(0>(jo=-(jo=(Fo=(Po=Uo.x)-zo)*zo+(Go=(Do=Uo.y)-Ro)*Ro+(No=(Io=Uo.z)-Bo)*Bo)/(Fo*Fo+Go*Go+No*No))){var ko=p;ko.x=zo,ko.y=Ro,ko.z=Bo,Vo=1}else if(1<jo){var Ho=p;Ho.x=Po,Ho.y=Do,Ho.z=Io,Vo=2}else{var Wo,qo,$o;Wo=zo+Fo*jo,qo=Ro+Go*jo,$o=Bo+No*jo;var Jo=p;Jo.x=Wo,Jo.y=qo,Jo.z=$o,Vo=3}var Xo=p.x*p.x+p.y*p.y+p.z*p.z;if(0>ja||Xo<ja){Va=1&Vo|(2&Vo)<<1,ja=Xo;var Yo=p;Da=Yo.x,Ia=Yo.y,Oa=Yo.z}}if(0<ja){var Ko=p;Ko.x=Da,Ko.y=Ia,Ko.z=Oa,Fa=Va}else{var Zo,Qo=za*za+Ra*Ra+Ba*Ba;0<Qo&&(Qo=1/Math.sqrt(Qo)),Da=(za*=Qo)*(Zo=(la*za+ua*(Ra*=Qo)+pa*(Ba*=Qo))/(Zo=za*za+Ra*Ra+Ba*Ba)),Ia=Ra*Zo,Oa=Ba*Zo;var th=p;th.x=Da,th.y=Ia,th.z=Oa,Fa=7}var eh=p.x*p.x+p.y*p.y+p.z*p.z;if(0>Si||eh<Si){Ai=3&Fa|(4&Fa)<<1,Si=eh;var ih=p;yi=ih.x,vi=ih.y,bi=ih.z}}if(0>wi*xi){var sh,rh,nh,ah,oh,hh,ch,lh,uh,ph,dh,fh,mh,gh,yh,vh,bh,xh,_h=oi;sh=_h.x,rh=_h.y,nh=_h.z;var Mh=hi;ah=Mh.x,oh=Mh.y,hh=Mh.z;var wh,Sh,Ah,Th=ci;ch=Th.x;var Ch,Lh,Eh,zh,Rh=ah*((gh=(lh=Th.y)-oh)*(Ah=(ph=ah-sh)*gh-(dh=oh-rh)*(mh=ch-ah))-(yh=(uh=Th.z)-hh)*(Sh=(fh=hh-nh)*mh-ph*yh))+oh*(yh*(wh=dh*yh-fh*gh)-mh*Ah)+hh*(mh*Sh-gh*wh),Bh=ch*((bh=rh-lh)*Ah-(xh=nh-uh)*Sh)+lh*(xh*wh-(vh=sh-ch)*Ah)+uh*(vh*Sh-bh*wh),Ph=-1,Dh=0;if(Eh=Lh=Ch=0,0>sh*(dh*Ah-fh*Sh)+rh*(fh*wh-ph*Ah)+nh*(ph*Sh-dh*wh)){var Ih,Oh,Fh,Gh,Nh,jh,Vh=oi;Ih=Vh.x,Oh=Vh.y,Fh=Vh.z;var Uh,kh,Hh,Wh,qh,$h=hi;if(0>(Wh=-(Wh=(Uh=(Gh=$h.x)-Ih)*Ih+(kh=(Nh=$h.y)-Oh)*Oh+(Hh=(jh=$h.z)-Fh)*Fh)/(Uh*Uh+kh*kh+Hh*Hh))){var Jh=p;Jh.x=Ih,Jh.y=Oh,Jh.z=Fh,qh=1}else if(1<Wh){var Xh=p;Xh.x=Gh,Xh.y=Nh,Xh.z=jh,qh=2}else{var Yh,Kh,Zh;Yh=Ih+Uh*Wh,Kh=Oh+kh*Wh,Zh=Fh+Hh*Wh;var Qh=p;Qh.x=Yh,Qh.y=Kh,Qh.z=Zh,qh=3}Dh=qh,Ph=p.x*p.x+p.y*p.y+p.z*p.z;var tc=p;Ch=tc.x,Lh=tc.y,Eh=tc.z}if(0>Rh){var ec,ic,sc,rc,nc,ac,oc=hi;ec=oc.x,ic=oc.y,sc=oc.z;var hc,cc,lc,uc,pc,dc=ci;if(0>(uc=-(uc=(hc=(rc=dc.x)-ec)*ec+(cc=(nc=dc.y)-ic)*ic+(lc=(ac=dc.z)-sc)*sc)/(hc*hc+cc*cc+lc*lc))){var fc=p;fc.x=ec,fc.y=ic,fc.z=sc,pc=1}else if(1<uc){var mc=p;mc.x=rc,mc.y=nc,mc.z=ac,pc=2}else{var gc,yc,vc;gc=ec+hc*uc,yc=ic+cc*uc,vc=sc+lc*uc;var bc=p;bc.x=gc,bc.y=yc,bc.z=vc,pc=3}var xc=p.x*p.x+p.y*p.y+p.z*p.z;if(0>Ph||xc<Ph){Dh=pc<<1,Ph=xc;var _c=p;Ch=_c.x,Lh=_c.y,Eh=_c.z}}if(0>Bh){var Mc,wc,Sc,Ac,Tc,Cc,Lc=oi;Mc=Lc.x,wc=Lc.y,Sc=Lc.z;var Ec,zc,Rc,Bc,Pc,Dc=ci;if(0>(Bc=-(Bc=(Ec=(Ac=Dc.x)-Mc)*Mc+(zc=(Tc=Dc.y)-wc)*wc+(Rc=(Cc=Dc.z)-Sc)*Sc)/(Ec*Ec+zc*zc+Rc*Rc))){var Ic=p;Ic.x=Mc,Ic.y=wc,Ic.z=Sc,Pc=1}else if(1<Bc){var Oc=p;Oc.x=Ac,Oc.y=Tc,Oc.z=Cc,Pc=2}else{var Fc,Gc,Nc;Fc=Mc+Ec*Bc,Gc=wc+zc*Bc,Nc=Sc+Rc*Bc;var jc=p;jc.x=Fc,jc.y=Gc,jc.z=Nc,Pc=3}var Vc=p.x*p.x+p.y*p.y+p.z*p.z;if(0>Ph||Vc<Ph){Dh=1&Pc|(2&Pc)<<1,Ph=Vc;var Uc=p;Ch=Uc.x,Lh=Uc.y,Eh=Uc.z}}if(0<Ph){var kc=p;kc.x=Ch,kc.y=Lh,kc.z=Eh,zh=Dh}else{var Hc,Wc=wh*wh+Sh*Sh+Ah*Ah;0<Wc&&(Wc=1/Math.sqrt(Wc)),Ch=(wh*=Wc)*(Hc=(sh*wh+rh*(Sh*=Wc)+nh*(Ah*=Wc))/(Hc=wh*wh+Sh*Sh+Ah*Ah)),Lh=Sh*Hc,Eh=Ah*Hc;var qc=p;qc.x=Ch,qc.y=Lh,qc.z=Eh,zh=7}var $c=p.x*p.x+p.y*p.y+p.z*p.z;if(0>Si||$c<Si){Ai=zh<<1,Si=$c;var Jc=p;yi=Jc.x,vi=Jc.y,bi=Jc.z}}if(0<Si){var Xc=p;Xc.x=yi,Xc.y=vi,Xc.z=bi,x=Ai}else p.Z(),x=15}if(1e-8>p.x*p.x+p.y*p.y+p.z*p.z){if(!n)return this.distance=0;switch(this.ya){case 1:this.Rn();break;case 2:this.El();break;case 3:this.Ll()}if(4==this.ya){var Yc=this.mn(t,e,i,s,c,l,u);return 0!=Yc?(this.distance=0,Yc):(this.distance=-this.depth,0)}return this.distance=0,1}this.Hm(x),d.x=p.x,d.y=p.y,d.z=p.z;var Kc=d,Zc=-Kc.y,Qc=-Kc.z;Kc.x=-Kc.x,Kc.y=Zc,Kc.z=Qc,this.zf(!1),this.Af(!1);var tl=this.Na[this.ya],el=this.jb[this.ya];tl.x=el.x,tl.y=el.y,tl.z=el.z;var il=tl,sl=this.qb[this.ya],rl=il.y-sl.y,nl=il.z-sl.z;if(il.x=il.x-sl.x,il.y=rl,il.z=nl,1e-8>d.x*d.x+d.y*d.y+d.z*d.z)throw Error("!?");var al=c[this.ya];if(1e-8>al.x*d.x+al.y*d.y+al.z*d.z-(p.x*d.x+p.y*d.y+p.z*d.z))return this.sm(),this.distance=Math.sqrt(p.x*p.x+p.y*p.y+p.z*p.z),null!=r&&null!=r.oi&&this.Yn(r.oi),0;this.ya++,++b}return 2},fm:function(t,e,i,s,r,n,a){this.wj=t,this.jl=e,this.tc=i,this.Ic=s;var o,h,c,l=this.Na,u=this.closest,p=this.dir;if(o=s.v-i.v,h=s.A-i.A,c=s.B-i.B,p.x=o,p.y=h,p.z=c,1e-6>p.x*p.x+p.y*p.y+p.z*p.z&&p.za(1,0,0),this.ya=0,null!=this.wj)this.zf(!0);else{var d=this.jb[this.ya];d.x=this.tc.v,d.y=this.tc.A,d.z=this.tc.B}this.Af(!0);var f=this.Na[this.ya],m=this.jb[this.ya];f.x=m.x,f.y=m.y,f.z=m.z;var g=this.qb[this.ya],y=f.y-g.y,v=f.z-g.z;f.x=f.x-g.x,f.y=y,f.z=v,this.ya=1;var b=0,x=0,_=this.Vn,M=this.Un;_.Z(),M.x=n.x,M.y=n.y,M.z=n.z;var w=M.y-r.y,S=M.z-r.z;for(M.x=M.x-r.x,M.y=w,M.z=S;40>b;){var A=0;switch(this.ya){case 1:var T=l[0];u.x=T.x,u.y=T.y,u.z=T.z,A=1;break;case 2:var C,L,E,z,R,B,P=l[0];C=P.x,L=P.y,E=P.z;var D,I,O,F,G=l[1];if(0>(F=-(F=(D=(z=G.x)-C)*C+(I=(R=G.y)-L)*L+(O=(B=G.z)-E)*E)/(D*D+I*I+O*O))){var N=u;N.x=C,N.y=L,N.z=E,A=1}else if(1<F){var j=u;j.x=z,j.y=R,j.z=B,A=2}else{var V,U,k;V=C+D*F,U=L+I*F,k=E+O*F;var H=u;H.x=V,H.y=U,H.z=k,A=3}break;case 3:var W,q,$,J,X,Y,K,Z,Q,tt,et,it,st,rt,nt,at,ot,ht,ct=l[0],lt=l[1],ut=l[2],pt=ct;W=pt.x,q=pt.y,$=pt.z;var dt=lt;J=dt.x,X=dt.y,Y=dt.z;var ft,mt,gt,yt=ut;K=yt.x;var vt,bt,xt,_t=J*((rt=(Z=yt.y)-X)*(gt=(tt=J-W)*rt-(et=X-q)*(st=K-J))-(nt=(Q=yt.z)-Y)*(mt=(it=Y-$)*st-tt*nt))+X*(nt*(ft=et*nt-it*rt)-st*gt)+Y*(st*mt-rt*ft),Mt=K*((ot=q-Z)*gt-(ht=$-Q)*mt)+Z*(ht*ft-(at=W-K)*gt)+Q*(at*mt-ot*ft),wt=-1,St=0;if(xt=bt=vt=0,0>W*(et*gt-it*mt)+q*(it*ft-tt*gt)+$*(tt*mt-et*ft)){var At,Tt,Ct,Lt,Et,zt,Rt=ct;At=Rt.x,Tt=Rt.y,Ct=Rt.z;var Bt,Pt,Dt,It,Ot,Ft=lt;if(0>(It=-(It=(Bt=(Lt=Ft.x)-At)*At+(Pt=(Et=Ft.y)-Tt)*Tt+(Dt=(zt=Ft.z)-Ct)*Ct)/(Bt*Bt+Pt*Pt+Dt*Dt))){var Gt=u;Gt.x=At,Gt.y=Tt,Gt.z=Ct,Ot=1}else if(1<It){var Nt=u;Nt.x=Lt,Nt.y=Et,Nt.z=zt,Ot=2}else{var jt,Vt,Ut;jt=At+Bt*It,Vt=Tt+Pt*It,Ut=Ct+Dt*It;var kt=u;kt.x=jt,kt.y=Vt,kt.z=Ut,Ot=3}St=Ot,wt=u.x*u.x+u.y*u.y+u.z*u.z;var Ht=u;vt=Ht.x,bt=Ht.y,xt=Ht.z}if(0>_t){var Wt,qt,$t,Jt,Xt,Yt,Kt=lt;Wt=Kt.x,qt=Kt.y,$t=Kt.z;var Zt,Qt,te,ee,ie,se=ut;if(0>(ee=-(ee=(Zt=(Jt=se.x)-Wt)*Wt+(Qt=(Xt=se.y)-qt)*qt+(te=(Yt=se.z)-$t)*$t)/(Zt*Zt+Qt*Qt+te*te))){var re=u;re.x=Wt,re.y=qt,re.z=$t,ie=1}else if(1<ee){var ne=u;ne.x=Jt,ne.y=Xt,ne.z=Yt,ie=2}else{var ae,oe,he;ae=Wt+Zt*ee,oe=qt+Qt*ee,he=$t+te*ee;var ce=u;ce.x=ae,ce.y=oe,ce.z=he,ie=3}var le=u.x*u.x+u.y*u.y+u.z*u.z;if(0>wt||le<wt){St=ie<<1,wt=le;var ue=u;vt=ue.x,bt=ue.y,xt=ue.z}}if(0>Mt){var pe,de,fe,me,ge,ye,ve=ct;pe=ve.x,de=ve.y,fe=ve.z;var be,xe,_e,Me,we,Se=ut;if(0>(Me=-(Me=(be=(me=Se.x)-pe)*pe+(xe=(ge=Se.y)-de)*de+(_e=(ye=Se.z)-fe)*fe)/(be*be+xe*xe+_e*_e))){var Ae=u;Ae.x=pe,Ae.y=de,Ae.z=fe,we=1}else if(1<Me){var Te=u;Te.x=me,Te.y=ge,Te.z=ye,we=2}else{var Ce,Le,Ee;Ce=pe+be*Me,Le=de+xe*Me,Ee=fe+_e*Me;var ze=u;ze.x=Ce,ze.y=Le,ze.z=Ee,we=3}var Re=u.x*u.x+u.y*u.y+u.z*u.z;if(0>wt||Re<wt){St=1&we|(2&we)<<1,wt=Re;var Be=u;vt=Be.x,bt=Be.y,xt=Be.z}}if(0<wt){var Pe=u;Pe.x=vt,Pe.y=bt,Pe.z=xt,A=St}else{var De,Ie=ft*ft+mt*mt+gt*gt;0<Ie&&(Ie=1/Math.sqrt(Ie)),vt=(ft*=Ie)*(De=(W*ft+q*(mt*=Ie)+$*(gt*=Ie))/(De=ft*ft+mt*mt+gt*gt)),bt=mt*De,xt=gt*De;var Oe=u;Oe.x=vt,Oe.y=bt,Oe.z=xt,A=7}break;case 4:var Fe,Ge,Ne,je,Ve,Ue,ke,He,We,qe,$e,Je,Xe,Ye,Ke,Ze,Qe,ti,ei,ii,si,ri,ni,ai,oi,hi,ci,li=l[0],ui=l[1],pi=l[2],di=l[3],fi=li;Fe=fi.x,Ge=fi.y,Ne=fi.z;var mi=ui;je=mi.x,Ve=mi.y,Ue=mi.z;var gi=pi;ke=gi.x,He=gi.y,We=gi.z;var yi,vi,bi,xi=di;qe=xi.x;var _i,Mi,wi,Si=0<(Xe=je-Fe)*(yi=(hi=($e=xi.y)-Ve)*(ai=We-Ue)-(ci=(Je=xi.z)-Ue)*(ni=He-Ve))+(Ye=Ve-Ge)*(vi=ci*(ri=ke-je)-(oi=qe-je)*ai)+(Ke=Ue-Ne)*(bi=oi*ni-hi*ri)?1:-1,Ai=Fe*((Qe=He-Ge)*(si=Je-Ne)-(ti=We-Ne)*(ii=$e-Ge))+Ge*(ti*(ei=qe-Fe)-(Ze=ke-Fe)*si)+Ne*(Ze*ii-Qe*ei),Ti=Fe*(ii*Ke-si*Ye)+Ge*(si*Xe-ei*Ke)+Ne*(ei*Ye-ii*Xe),Ci=je*yi+Ve*vi+Ue*bi,Li=-1,Ei=0;if(wi=Mi=_i=0,0>(Fe*(Ye*ti-Ke*Qe)+Ge*(Ke*Ze-Xe*ti)+Ne*(Xe*Qe-Ye*Ze))*Si){var zi,Ri,Bi,Pi,Di,Ii,Oi,Fi,Gi,Ni,ji,Vi,Ui,ki,Hi,Wi,qi,$i,Ji=li;zi=Ji.x,Ri=Ji.y,Bi=Ji.z;var Xi=ui;Pi=Xi.x,Di=Xi.y,Ii=Xi.z;var Yi,Ki,Zi,Qi=pi;Oi=Qi.x;var ts,es,is,ss,rs=Pi*((ki=(Fi=Qi.y)-Di)*(Zi=(Ni=Pi-zi)*ki-(ji=Di-Ri)*(Ui=Oi-Pi))-(Hi=(Gi=Qi.z)-Ii)*(Ki=(Vi=Ii-Bi)*Ui-Ni*Hi))+Di*(Hi*(Yi=ji*Hi-Vi*ki)-Ui*Zi)+Ii*(Ui*Ki-ki*Yi),ns=Oi*((qi=Ri-Fi)*Zi-($i=Bi-Gi)*Ki)+Fi*($i*Yi-(Wi=zi-Oi)*Zi)+Gi*(Wi*Ki-qi*Yi),as=-1,os=0;if(is=es=ts=0,0>zi*(ji*Zi-Vi*Ki)+Ri*(Vi*Yi-Ni*Zi)+Bi*(Ni*Ki-ji*Yi)){var hs,cs,ls,us,ps,ds,fs=li;hs=fs.x,cs=fs.y,ls=fs.z;var ms,gs,ys,vs,bs,xs=ui;if(0>(vs=-(vs=(ms=(us=xs.x)-hs)*hs+(gs=(ps=xs.y)-cs)*cs+(ys=(ds=xs.z)-ls)*ls)/(ms*ms+gs*gs+ys*ys))){var _s=u;_s.x=hs,_s.y=cs,_s.z=ls,bs=1}else if(1<vs){var Ms=u;Ms.x=us,Ms.y=ps,Ms.z=ds,bs=2}else{var ws,Ss,As;ws=hs+ms*vs,Ss=cs+gs*vs,As=ls+ys*vs;var Ts=u;Ts.x=ws,Ts.y=Ss,Ts.z=As,bs=3}os=bs,as=u.x*u.x+u.y*u.y+u.z*u.z;var Cs=u;ts=Cs.x,es=Cs.y,is=Cs.z}if(0>rs){var Ls,Es,zs,Rs,Bs,Ps,Ds=ui;Ls=Ds.x,Es=Ds.y,zs=Ds.z;var Is,Os,Fs,Gs,Ns,js=pi;if(0>(Gs=-(Gs=(Is=(Rs=js.x)-Ls)*Ls+(Os=(Bs=js.y)-Es)*Es+(Fs=(Ps=js.z)-zs)*zs)/(Is*Is+Os*Os+Fs*Fs))){var Vs=u;Vs.x=Ls,Vs.y=Es,Vs.z=zs,Ns=1}else if(1<Gs){var Us=u;Us.x=Rs,Us.y=Bs,Us.z=Ps,Ns=2}else{var ks,Hs,Ws;ks=Ls+Is*Gs,Hs=Es+Os*Gs,Ws=zs+Fs*Gs;var qs=u;qs.x=ks,qs.y=Hs,qs.z=Ws,Ns=3}var $s=u.x*u.x+u.y*u.y+u.z*u.z;if(0>as||$s<as){os=Ns<<1,as=$s;var Js=u;ts=Js.x,es=Js.y,is=Js.z}}if(0>ns){var Xs,Ys,Ks,Zs,Qs,tr,er=li;Xs=er.x,Ys=er.y,Ks=er.z;var ir,sr,rr,nr,ar,or=pi;if(0>(nr=-(nr=(ir=(Zs=or.x)-Xs)*Xs+(sr=(Qs=or.y)-Ys)*Ys+(rr=(tr=or.z)-Ks)*Ks)/(ir*ir+sr*sr+rr*rr))){var hr=u;hr.x=Xs,hr.y=Ys,hr.z=Ks,ar=1}else if(1<nr){var cr=u;cr.x=Zs,cr.y=Qs,cr.z=tr,ar=2}else{var lr,ur,pr;lr=Xs+ir*nr,ur=Ys+sr*nr,pr=Ks+rr*nr;var dr=u;dr.x=lr,dr.y=ur,dr.z=pr,ar=3}var fr=u.x*u.x+u.y*u.y+u.z*u.z;if(0>as||fr<as){os=1&ar|(2&ar)<<1,as=fr;var mr=u;ts=mr.x,es=mr.y,is=mr.z}}if(0<as){var gr=u;gr.x=ts,gr.y=es,gr.z=is,ss=os}else{var yr,vr=Yi*Yi+Ki*Ki+Zi*Zi;0<vr&&(vr=1/Math.sqrt(vr)),ts=(Yi*=vr)*(yr=(zi*Yi+Ri*(Ki*=vr)+Bi*(Zi*=vr))/(yr=Yi*Yi+Ki*Ki+Zi*Zi)),es=Ki*yr,is=Zi*yr;var br=u;br.x=ts,br.y=es,br.z=is,ss=7}Ei=ss,Li=u.x*u.x+u.y*u.y+u.z*u.z;var xr=u;_i=xr.x,Mi=xr.y,wi=xr.z}if(0>Ai*Si){var _r,Mr,wr,Sr,Ar,Tr,Cr,Lr,Er,zr,Rr,Br,Pr,Dr,Ir,Or,Fr,Gr,Nr=li;_r=Nr.x,Mr=Nr.y,wr=Nr.z;var jr=pi;Sr=jr.x,Ar=jr.y,Tr=jr.z;var Vr,Ur,kr,Hr=di;Cr=Hr.x;var Wr,qr,$r,Jr,Xr=Sr*((Dr=(Lr=Hr.y)-Ar)*(kr=(zr=Sr-_r)*Dr-(Rr=Ar-Mr)*(Pr=Cr-Sr))-(Ir=(Er=Hr.z)-Tr)*(Ur=(Br=Tr-wr)*Pr-zr*Ir))+Ar*(Ir*(Vr=Rr*Ir-Br*Dr)-Pr*kr)+Tr*(Pr*Ur-Dr*Vr),Yr=Cr*((Fr=Mr-Lr)*kr-(Gr=wr-Er)*Ur)+Lr*(Gr*Vr-(Or=_r-Cr)*kr)+Er*(Or*Ur-Fr*Vr),Kr=-1,Zr=0;if($r=qr=Wr=0,0>_r*(Rr*kr-Br*Ur)+Mr*(Br*Vr-zr*kr)+wr*(zr*Ur-Rr*Vr)){var Qr,tn,en,sn,rn,nn,an=li;Qr=an.x,tn=an.y,en=an.z;var on,hn,cn,ln,un,pn=pi;if(0>(ln=-(ln=(on=(sn=pn.x)-Qr)*Qr+(hn=(rn=pn.y)-tn)*tn+(cn=(nn=pn.z)-en)*en)/(on*on+hn*hn+cn*cn))){var dn=u;dn.x=Qr,dn.y=tn,dn.z=en,un=1}else if(1<ln){var fn=u;fn.x=sn,fn.y=rn,fn.z=nn,un=2}else{var mn,gn,yn;mn=Qr+on*ln,gn=tn+hn*ln,yn=en+cn*ln;var vn=u;vn.x=mn,vn.y=gn,vn.z=yn,un=3}Zr=un,Kr=u.x*u.x+u.y*u.y+u.z*u.z;var bn=u;Wr=bn.x,qr=bn.y,$r=bn.z}if(0>Xr){var xn,_n,Mn,wn,Sn,An,Tn=pi;xn=Tn.x,_n=Tn.y,Mn=Tn.z;var Cn,Ln,En,zn,Rn,Bn=di;if(0>(zn=-(zn=(Cn=(wn=Bn.x)-xn)*xn+(Ln=(Sn=Bn.y)-_n)*_n+(En=(An=Bn.z)-Mn)*Mn)/(Cn*Cn+Ln*Ln+En*En))){var Pn=u;Pn.x=xn,Pn.y=_n,Pn.z=Mn,Rn=1}else if(1<zn){var Dn=u;Dn.x=wn,Dn.y=Sn,Dn.z=An,Rn=2}else{var In,On,Fn;In=xn+Cn*zn,On=_n+Ln*zn,Fn=Mn+En*zn;var Gn=u;Gn.x=In,Gn.y=On,Gn.z=Fn,Rn=3}var Nn=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Kr||Nn<Kr){Zr=Rn<<1,Kr=Nn;var jn=u;Wr=jn.x,qr=jn.y,$r=jn.z}}if(0>Yr){var Vn,Un,kn,Hn,Wn,qn,$n=li;Vn=$n.x,Un=$n.y,kn=$n.z;var Jn,Xn,Yn,Kn,Zn,Qn=di;if(0>(Kn=-(Kn=(Jn=(Hn=Qn.x)-Vn)*Vn+(Xn=(Wn=Qn.y)-Un)*Un+(Yn=(qn=Qn.z)-kn)*kn)/(Jn*Jn+Xn*Xn+Yn*Yn))){var ta=u;ta.x=Vn,ta.y=Un,ta.z=kn,Zn=1}else if(1<Kn){var ea=u;ea.x=Hn,ea.y=Wn,ea.z=qn,Zn=2}else{var ia,sa,ra;ia=Vn+Jn*Kn,sa=Un+Xn*Kn,ra=kn+Yn*Kn;var na=u;na.x=ia,na.y=sa,na.z=ra,Zn=3}var aa=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Kr||aa<Kr){Zr=1&Zn|(2&Zn)<<1,Kr=aa;var oa=u;Wr=oa.x,qr=oa.y,$r=oa.z}}if(0<Kr){var ha=u;ha.x=Wr,ha.y=qr,ha.z=$r,Jr=Zr}else{var ca,la=Vr*Vr+Ur*Ur+kr*kr;0<la&&(la=1/Math.sqrt(la)),Wr=(Vr*=la)*(ca=(_r*Vr+Mr*(Ur*=la)+wr*(kr*=la))/(ca=Vr*Vr+Ur*Ur+kr*kr)),qr=Ur*ca,$r=kr*ca;var ua=u;ua.x=Wr,ua.y=qr,ua.z=$r,Jr=7}var pa=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Li||pa<Li){Ei=1&Jr|(6&Jr)<<1,Li=pa;var da=u;_i=da.x,Mi=da.y,wi=da.z}}if(0>Ti*Si){var fa,ma,ga,ya,va,ba,xa,_a,Ma,wa,Sa,Aa,Ta,Ca,La,Ea,za,Ra,Ba=li;fa=Ba.x,ma=Ba.y,ga=Ba.z;var Pa=ui;ya=Pa.x,va=Pa.y,ba=Pa.z;var Da,Ia,Oa,Fa=di;xa=Fa.x;var Ga,Na,ja,Va,Ua=ya*((Ca=(_a=Fa.y)-va)*(Oa=(wa=ya-fa)*Ca-(Sa=va-ma)*(Ta=xa-ya))-(La=(Ma=Fa.z)-ba)*(Ia=(Aa=ba-ga)*Ta-wa*La))+va*(La*(Da=Sa*La-Aa*Ca)-Ta*Oa)+ba*(Ta*Ia-Ca*Da),ka=xa*((za=ma-_a)*Oa-(Ra=ga-Ma)*Ia)+_a*(Ra*Da-(Ea=fa-xa)*Oa)+Ma*(Ea*Ia-za*Da),Ha=-1,Wa=0;if(ja=Na=Ga=0,0>fa*(Sa*Oa-Aa*Ia)+ma*(Aa*Da-wa*Oa)+ga*(wa*Ia-Sa*Da)){var qa,$a,Ja,Xa,Ya,Ka,Za=li;qa=Za.x,$a=Za.y,Ja=Za.z;var Qa,to,eo,io,so,ro=ui;if(0>(io=-(io=(Qa=(Xa=ro.x)-qa)*qa+(to=(Ya=ro.y)-$a)*$a+(eo=(Ka=ro.z)-Ja)*Ja)/(Qa*Qa+to*to+eo*eo))){var no=u;no.x=qa,no.y=$a,no.z=Ja,so=1}else if(1<io){var ao=u;ao.x=Xa,ao.y=Ya,ao.z=Ka,so=2}else{var oo,ho,co;oo=qa+Qa*io,ho=$a+to*io,co=Ja+eo*io;var lo=u;lo.x=oo,lo.y=ho,lo.z=co,so=3}Wa=so,Ha=u.x*u.x+u.y*u.y+u.z*u.z;var uo=u;Ga=uo.x,Na=uo.y,ja=uo.z}if(0>Ua){var po,fo,mo,go,yo,vo,bo=ui;po=bo.x,fo=bo.y,mo=bo.z;var xo,_o,Mo,wo,So,Ao=di;if(0>(wo=-(wo=(xo=(go=Ao.x)-po)*po+(_o=(yo=Ao.y)-fo)*fo+(Mo=(vo=Ao.z)-mo)*mo)/(xo*xo+_o*_o+Mo*Mo))){var To=u;To.x=po,To.y=fo,To.z=mo,So=1}else if(1<wo){var Co=u;Co.x=go,Co.y=yo,Co.z=vo,So=2}else{var Lo,Eo,zo;Lo=po+xo*wo,Eo=fo+_o*wo,zo=mo+Mo*wo;var Ro=u;Ro.x=Lo,Ro.y=Eo,Ro.z=zo,So=3}var Bo=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Ha||Bo<Ha){Wa=So<<1,Ha=Bo;var Po=u;Ga=Po.x,Na=Po.y,ja=Po.z}}if(0>ka){var Do,Io,Oo,Fo,Go,No,jo=li;Do=jo.x,Io=jo.y,Oo=jo.z;var Vo,Uo,ko,Ho,Wo,qo=di;if(0>(Ho=-(Ho=(Vo=(Fo=qo.x)-Do)*Do+(Uo=(Go=qo.y)-Io)*Io+(ko=(No=qo.z)-Oo)*Oo)/(Vo*Vo+Uo*Uo+ko*ko))){var $o=u;$o.x=Do,$o.y=Io,$o.z=Oo,Wo=1}else if(1<Ho){var Jo=u;Jo.x=Fo,Jo.y=Go,Jo.z=No,Wo=2}else{var Xo,Yo,Ko;Xo=Do+Vo*Ho,Yo=Io+Uo*Ho,Ko=Oo+ko*Ho;var Zo=u;Zo.x=Xo,Zo.y=Yo,Zo.z=Ko,Wo=3}var Qo=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Ha||Qo<Ha){Wa=1&Wo|(2&Wo)<<1,Ha=Qo;var th=u;Ga=th.x,Na=th.y,ja=th.z}}if(0<Ha){var eh=u;eh.x=Ga,eh.y=Na,eh.z=ja,Va=Wa}else{var ih,sh=Da*Da+Ia*Ia+Oa*Oa;0<sh&&(sh=1/Math.sqrt(sh)),Ga=(Da*=sh)*(ih=(fa*Da+ma*(Ia*=sh)+ga*(Oa*=sh))/(ih=Da*Da+Ia*Ia+Oa*Oa)),Na=Ia*ih,ja=Oa*ih;var rh=u;rh.x=Ga,rh.y=Na,rh.z=ja,Va=7}var nh=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Li||nh<Li){Ei=3&Va|(4&Va)<<1,Li=nh;var ah=u;_i=ah.x,Mi=ah.y,wi=ah.z}}if(0>Ci*Si){var oh,hh,ch,lh,uh,ph,dh,fh,mh,gh,yh,vh,bh,xh,_h,Mh,wh,Sh,Ah=ui;oh=Ah.x,hh=Ah.y,ch=Ah.z;var Th=pi;lh=Th.x,uh=Th.y,ph=Th.z;var Ch,Lh,Eh,zh=di;dh=zh.x;var Rh,Bh,Ph,Dh,Ih=lh*((xh=(fh=zh.y)-uh)*(Eh=(gh=lh-oh)*xh-(yh=uh-hh)*(bh=dh-lh))-(_h=(mh=zh.z)-ph)*(Lh=(vh=ph-ch)*bh-gh*_h))+uh*(_h*(Ch=yh*_h-vh*xh)-bh*Eh)+ph*(bh*Lh-xh*Ch),Oh=dh*((wh=hh-fh)*Eh-(Sh=ch-mh)*Lh)+fh*(Sh*Ch-(Mh=oh-dh)*Eh)+mh*(Mh*Lh-wh*Ch),Fh=-1,Gh=0;if(Ph=Bh=Rh=0,0>oh*(yh*Eh-vh*Lh)+hh*(vh*Ch-gh*Eh)+ch*(gh*Lh-yh*Ch)){var Nh,jh,Vh,Uh,kh,Hh,Wh=ui;Nh=Wh.x,jh=Wh.y,Vh=Wh.z;var qh,$h,Jh,Xh,Yh,Kh=pi;if(0>(Xh=-(Xh=(qh=(Uh=Kh.x)-Nh)*Nh+($h=(kh=Kh.y)-jh)*jh+(Jh=(Hh=Kh.z)-Vh)*Vh)/(qh*qh+$h*$h+Jh*Jh))){var Zh=u;Zh.x=Nh,Zh.y=jh,Zh.z=Vh,Yh=1}else if(1<Xh){var Qh=u;Qh.x=Uh,Qh.y=kh,Qh.z=Hh,Yh=2}else{var tc,ec,ic;tc=Nh+qh*Xh,ec=jh+$h*Xh,ic=Vh+Jh*Xh;var sc=u;sc.x=tc,sc.y=ec,sc.z=ic,Yh=3}Gh=Yh,Fh=u.x*u.x+u.y*u.y+u.z*u.z;var rc=u;Rh=rc.x,Bh=rc.y,Ph=rc.z}if(0>Ih){var nc,ac,oc,hc,cc,lc,uc=pi;nc=uc.x,ac=uc.y,oc=uc.z;var pc,dc,fc,mc,gc,yc=di;if(0>(mc=-(mc=(pc=(hc=yc.x)-nc)*nc+(dc=(cc=yc.y)-ac)*ac+(fc=(lc=yc.z)-oc)*oc)/(pc*pc+dc*dc+fc*fc))){var vc=u;vc.x=nc,vc.y=ac,vc.z=oc,gc=1}else if(1<mc){var bc=u;bc.x=hc,bc.y=cc,bc.z=lc,gc=2}else{var xc,_c,Mc;xc=nc+pc*mc,_c=ac+dc*mc,Mc=oc+fc*mc;var wc=u;wc.x=xc,wc.y=_c,wc.z=Mc,gc=3}var Sc=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Fh||Sc<Fh){Gh=gc<<1,Fh=Sc;var Ac=u;Rh=Ac.x,Bh=Ac.y,Ph=Ac.z}}if(0>Oh){var Tc,Cc,Lc,Ec,zc,Rc,Bc=ui;Tc=Bc.x,Cc=Bc.y,Lc=Bc.z;var Pc,Dc,Ic,Oc,Fc,Gc=di;if(0>(Oc=-(Oc=(Pc=(Ec=Gc.x)-Tc)*Tc+(Dc=(zc=Gc.y)-Cc)*Cc+(Ic=(Rc=Gc.z)-Lc)*Lc)/(Pc*Pc+Dc*Dc+Ic*Ic))){var Nc=u;Nc.x=Tc,Nc.y=Cc,Nc.z=Lc,Fc=1}else if(1<Oc){var jc=u;jc.x=Ec,jc.y=zc,jc.z=Rc,Fc=2}else{var Vc,Uc,kc;Vc=Tc+Pc*Oc,Uc=Cc+Dc*Oc,kc=Lc+Ic*Oc;var Hc=u;Hc.x=Vc,Hc.y=Uc,Hc.z=kc,Fc=3}var Wc=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Fh||Wc<Fh){Gh=1&Fc|(2&Fc)<<1,Fh=Wc;var qc=u;Rh=qc.x,Bh=qc.y,Ph=qc.z}}if(0<Fh){var $c=u;$c.x=Rh,$c.y=Bh,$c.z=Ph,Dh=Gh}else{var Jc,Xc=Ch*Ch+Lh*Lh+Eh*Eh;0<Xc&&(Xc=1/Math.sqrt(Xc)),Rh=(Ch*=Xc)*(Jc=(oh*Ch+hh*(Lh*=Xc)+ch*(Eh*=Xc))/(Jc=Ch*Ch+Lh*Lh+Eh*Eh)),Bh=Lh*Jc,Ph=Eh*Jc;var Yc=u;Yc.x=Rh,Yc.y=Bh,Yc.z=Ph,Dh=7}var Kc=u.x*u.x+u.y*u.y+u.z*u.z;if(0>Li||Kc<Li){Ei=Dh<<1,Li=Kc;var Zc=u;_i=Zc.x,Mi=Zc.y,wi=Zc.z}}if(0<Li){var Qc=u;Qc.x=_i,Qc.y=Mi,Qc.z=wi,A=Ei}else u.Z(),A=15}if(this.Hm(A),1e-8>u.x*u.x+u.y*u.y+u.z*u.z){if(!x||4==this.ya){a.fraction=x;break}this.sm(),a.fraction=x;var tl=a.normal;tl.x=p.x,tl.y=p.y,tl.z=p.z;var el=tl,il=Math.sqrt(el.x*el.x+el.y*el.y+el.z*el.z);0<il&&(il=1/il);var sl=el.y*il,rl=el.z*il;el.x=el.x*il,el.y=sl,el.z=rl;var nl=a.position,al=this.closestPoint1;nl.x=al.x,nl.y=al.y,nl.z=al.z;var ol=nl,hl=ol.y+r.y*x,cl=ol.z+r.z*x;return ol.x+=r.x*x,ol.y=hl,ol.z=cl,!0}p.x=u.x,p.y=u.y,p.z=u.z;var ll=p,ul=-ll.y,pl=-ll.z;if(ll.x=-ll.x,ll.y=ul,ll.z=pl,null!=this.wj)this.zf(!0);else{var dl=this.jb[this.ya];dl.x=this.tc.v,dl.y=this.tc.A,dl.z=this.tc.B}this.Af(!0);var fl=this.Na[this.ya],ml=this.jb[this.ya];fl.x=ml.x,fl.y=ml.y,fl.z=ml.z;var gl=fl,yl=this.qb[this.ya],vl=gl.y-yl.y,bl=gl.z-yl.z;gl.x=gl.x-yl.x,gl.y=vl,gl.z=bl;var xl=l[this.ya],_l=xl.y-_.y,Ml=xl.z-_.z;if(xl.x=xl.x-_.x,xl.y=_l,xl.z=Ml,1e-8>p.x*p.x+p.y*p.y+p.z*p.z)throw Error("!?");var wl=l[this.ya],Sl=p,Al=wl.x*Sl.x+wl.y*Sl.y+wl.z*Sl.z;if(0>Al){if(0<=M.x*Sl.x+M.y*Sl.y+M.z*Sl.z)break;var Tl=Al/(M.x*Sl.x+M.y*Sl.y+M.z*Sl.z);if(1<=(x+=Tl))break;var Cl=_.y+M.y*Tl,Ll=_.z+M.z*Tl;_.x=_.x+M.x*Tl,_.y=Cl,_.z=Ll;for(var El=0,zl=this.ya+1;El<zl;){var Rl=l[El++],Bl=-Tl,Pl=Rl.y+M.y*Bl,Dl=Rl.z+M.z*Bl;Rl.x=Rl.x+M.x*Bl,Rl.y=Pl,Rl.z=Dl}}for(var Il=!1,Ol=0,Fl=this.ya;Ol<Fl;){var Gl=Ol++,Nl=l[Gl].x-l[this.ya].x,jl=l[Gl].y-l[this.ya].y,Vl=l[Gl].z-l[this.ya].z;if(1e-8>Nl*Nl+jl*jl+Vl*Vl){Il=!0;break}}Il||this.ya++,++b}return!1},sm:function(){switch(this.ya){case 1:var t=this.closestPoint1,e=this.jb[0];t.x=e.x,t.y=e.y,t.z=e.z;var i=this.closestPoint2,s=this.qb[0];i.x=s.x,i.y=s.y,i.z=s.z;break;case 2:var r,n,a,o=this.closest;r=o.x,n=o.y,a=o.z;var h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w=this.Na[0];h=w.x,c=w.y,l=w.z;var S=this.jb[0];u=S.x,p=S.y,d=S.z;var A=this.qb[0];f=A.x,m=A.y,g=A.z;var T=this.Na[1];y=T.x,v=T.y,b=T.z;var C=this.jb[1];x=C.x,_=C.y,M=C.z;var L,E,z,R=this.qb[1],B=(L=y-h)*L+(E=v-c)*E+(z=b-l)*z;B&&(B=1/B);var P,D,I,O,F,G,N=((r-h)*L+(n-c)*E+(a-l)*z)*B;P=u+(x-u)*N,D=p+(_-p)*N,I=d+(M-d)*N,O=f+(R.x-f)*N,F=m+(R.y-m)*N,G=g+(R.z-g)*N;var j=this.closestPoint1;j.x=P,j.y=D,j.z=I;var V=this.closestPoint2;V.x=O,V.y=F,V.z=G;break;case 3:var U,k,H,W=this.closest;U=W.x,k=W.y,H=W.z;var q,$,J,X,Y,K,Z,Q,tt,et,it,st,rt,nt,at,ot,ht,ct,lt,ut,pt,dt,ft,mt,gt=this.Na[0];q=gt.x,$=gt.y,J=gt.z;var yt=this.jb[0];X=yt.x,Y=yt.y,K=yt.z;var vt=this.qb[0];Z=vt.x,Q=vt.y,tt=vt.z;var bt=this.Na[1];et=bt.x,it=bt.y,st=bt.z;var xt=this.jb[1];rt=xt.x,nt=xt.y,at=xt.z;var _t=this.qb[1];ot=_t.x,ht=_t.y,ct=_t.z;var Mt=this.Na[2];lt=Mt.x,ut=Mt.y,pt=Mt.z;var wt=this.jb[2];dt=wt.x,ft=wt.y,mt=wt.z;var St,At,Tt,Ct,Lt,Et,zt,Rt,Bt,Pt=this.qb[2],Dt=(St=et-q)*St+(At=it-$)*At+(Tt=st-J)*Tt,It=St*(Ct=lt-q)+At*(Lt=ut-$)+Tt*(Et=pt-J),Ot=Ct*Ct+Lt*Lt+Et*Et,Ft=St*(zt=U-q)+At*(Rt=k-$)+Tt*(Bt=H-J),Gt=Ct*zt+Lt*Rt+Et*Bt,Nt=Dt*Ot-It*It;Nt&&(Nt=1/Nt);var jt,Vt,Ut,kt,Ht,Wt,qt=(Ft*Ot-Gt*It)*Nt,$t=(-Ft*It+Gt*Dt)*Nt;jt=X+(rt-X)*qt,Vt=Y+(nt-Y)*qt,Ut=K+(at-K)*qt,jt+=(dt-X)*$t,Vt+=(ft-Y)*$t,Ut+=(mt-K)*$t,kt=Z+(ot-Z)*qt,Ht=Q+(ht-Q)*qt,Wt=tt+(ct-tt)*qt,kt+=(Pt.x-Z)*$t,Ht+=(Pt.y-Q)*$t,Wt+=(Pt.z-tt)*$t;var Jt=this.closestPoint1;Jt.x=jt,Jt.y=Vt,Jt.z=Ut;var Xt=this.closestPoint2;Xt.x=kt,Xt.y=Ht,Xt.z=Wt;break;default:throw Error("!?")}},Pn:function(t){var e=this.dir;t=t.Il,e.x=t.x,e.y=t.y,e.z=t.z},Yn:function(t){t=t.Il;var e=this.closest;t.x=e.x,t.y=e.y,t.z=e.z,e=-t.y;var i=-t.z;t.x=-t.x,t.y=e,t.z=i},Hm:function(t){switch(this.ya=t,this.ya=(5&this.ya)+(this.ya>>1&5),this.ya=(3&this.ya)+(this.ya>>2&3),t){case 2:t=this.Na[0];var e=this.Na[1];t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[0],e=this.jb[1],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[0],e=this.qb[1],t.x=e.x,t.y=e.y,t.z=e.z;break;case 4:t=this.Na[0],e=this.Na[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[0],e=this.jb[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[0],e=this.qb[2],t.x=e.x,t.y=e.y,t.z=e.z;break;case 5:t=this.Na[1],e=this.Na[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[1],e=this.jb[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[1],e=this.qb[2],t.x=e.x,t.y=e.y,t.z=e.z;break;case 6:t=this.Na[0],e=this.Na[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[0],e=this.jb[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[0],e=this.qb[2],t.x=e.x,t.y=e.y,t.z=e.z;break;case 8:t=this.Na[0],e=this.Na[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[0],e=this.jb[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[0],e=this.qb[3],t.x=e.x,t.y=e.y,t.z=e.z;break;case 9:t=this.Na[1],e=this.Na[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[1],e=this.jb[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[1],e=this.qb[3],t.x=e.x,t.y=e.y,t.z=e.z;break;case 10:t=this.Na[0],e=this.Na[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[0],e=this.jb[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[0],e=this.qb[3],t.x=e.x,t.y=e.y,t.z=e.z;break;case 11:t=this.Na[2],e=this.Na[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[2],e=this.jb[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[2],e=this.qb[3],t.x=e.x,t.y=e.y,t.z=e.z;break;case 12:t=this.Na[0],e=this.Na[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[0],e=this.jb[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[0],e=this.qb[2],t.x=e.x,t.y=e.y,t.z=e.z,t=this.Na[1],e=this.Na[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[1],e=this.jb[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[1],e=this.qb[3],t.x=e.x,t.y=e.y,t.z=e.z;break;case 13:t=this.Na[1],e=this.Na[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[1],e=this.jb[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[1],e=this.qb[3],t.x=e.x,t.y=e.y,t.z=e.z;break;case 14:t=this.Na[0],e=this.Na[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.jb[0],e=this.jb[3],t.x=e.x,t.y=e.y,t.z=e.z,t=this.qb[0],e=this.qb[3],t.x=e.x,t.y=e.y,t.z=e.z}},zf:function(t){var e,i,s,r,n,a,o;r=(a=this.dir).x,n=a.y,a=a.z,i=this.tc.o*r+this.tc.i*n+this.tc.l*a,o=this.tc.f*r+this.tc.m*n+this.tc.g*a,e=this.tc.h*r+this.tc.j*n+this.tc.s*a,(s=this.dir).x=i,s.y=o,s.z=e,this.wj.Pd(this.dir,this.jb[this.ya]),t&&(t=this.dir,0<(e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))&&(e=1/e),i=t.y*e,o=t.z*e,t.x=t.x*e,t.y=i,t.z=o,t=this.jb[this.ya],e=this.dir,i=this.wj.Rb,o=t.y+e.y*i,s=t.z+e.z*i,t.x+=e.x*i,t.y=o,t.z=s),e=(t=this.jb[this.ya]).x,i=t.y,s=t.z,o=this.tc.o*e+this.tc.f*i+this.tc.h*s,t=this.tc.i*e+this.tc.m*i+this.tc.j*s,i=this.tc.l*e+this.tc.g*i+this.tc.s*s,e=o+this.tc.v,t+=this.tc.A,i+=this.tc.B,(o=this.jb[this.ya]).x=e,o.y=t,o.z=i,(t=this.dir).x=r,t.y=n,t.z=a},Af:function(t){var e,i,s,r,n,a,o;r=(a=this.dir).x,n=a.y,a=a.z,e=this.Ic.o*r+this.Ic.i*n+this.Ic.l*a,i=this.Ic.f*r+this.Ic.m*n+this.Ic.g*a,o=this.Ic.h*r+this.Ic.j*n+this.Ic.s*a,(s=this.dir).x=-e,s.y=-i,s.z=-o,this.jl.Pd(this.dir,this.qb[this.ya]),t&&(t=this.dir,0<(e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))&&(e=1/e),i=t.y*e,o=t.z*e,t.x=t.x*e,t.y=i,t.z=o,t=this.qb[this.ya],e=this.dir,i=this.jl.Rb,o=t.y+e.y*i,s=t.z+e.z*i,t.x+=e.x*i,t.y=o,t.z=s),e=(t=this.qb[this.ya]).x,i=t.y,s=t.z,o=this.Ic.o*e+this.Ic.f*i+this.Ic.h*s,t=this.Ic.i*e+this.Ic.m*i+this.Ic.j*s,i=this.Ic.l*e+this.Ic.g*i+this.Ic.s*s,e=o+this.Ic.v,t+=this.Ic.A,i+=this.Ic.B,(o=this.qb[this.ya]).x=e,o.y=t,o.z=i,(t=this.dir).x=r,t.y=n,t.z=a},Rn:function(){for(var t=0;3>t;){var e=t++,i=this.dir;e=this.uj[e],i.x=e.x,i.y=e.y,i.z=e.z,this.zf(!1),this.Af(!1),i=this.Na[this.ya],e=this.jb[this.ya],i.x=e.x,i.y=e.y,i.z=e.z,e=this.qb[this.ya];var s=i.y-e.y,r=i.z-e.z;if(i.x=i.x-e.x,i.y=s,i.z=r,this.ya++,this.El(),4==this.ya)break;if(this.ya--,e=-(i=this.dir).y,s=-i.z,i.x=-i.x,i.y=e,i.z=s,this.zf(!1),this.Af(!1),i=this.Na[this.ya],e=this.jb[this.ya],i.x=e.x,i.y=e.y,i.z=e.z,e=this.qb[this.ya],s=i.y-e.y,r=i.z-e.z,i.x=i.x-e.x,i.y=s,i.z=r,this.ya++,this.El(),4==this.ya)break;this.ya--}},El:function(){var t,e,i,s,r,n,a,o,h;for(t=(i=this.dir).x,e=i.y,i=i.z,s=(n=this.Na[0]).x,r=n.y,n=n.z,s-=a=(h=this.Na[1]).x,r-=o=h.y,n-=h=h.z,o=0;3>o;){var c,l;if(h=o++,a=(h=this.uj[h]).x,c=h.y,h=r*(l=h.z)-n*c,l=n*a-s*l,a=s*c-r*a,(c=this.dir).x=h,c.y=l,c.z=a,this.zf(!1),this.Af(!1),h=this.Na[this.ya],a=this.jb[this.ya],h.x=a.x,h.y=a.y,h.z=a.z,a=this.qb[this.ya],c=h.y-a.y,l=h.z-a.z,h.x=h.x-a.x,h.y=c,h.z=l,this.ya++,this.Ll(),4==this.ya)break;if(this.ya--,a=-(h=this.dir).y,c=-h.z,h.x=-h.x,h.y=a,h.z=c,this.zf(!1),this.Af(!1),h=this.Na[this.ya],a=this.jb[this.ya],h.x=a.x,h.y=a.y,h.z=a.z,a=this.qb[this.ya],c=h.y-a.y,l=h.z-a.z,h.x=h.x-a.x,h.y=c,h.z=l,this.ya++,this.Ll(),4==this.ya)break;this.ya--}(s=this.dir).x=t,s.y=e,s.z=i},Ll:function(){var t,e,i;for(t=(i=this.dir).x,e=i.y,i=i.z;;){var s,r,n,a,o,h,c,l,u;if(s=(n=this.Na[0]).x,r=n.y,n=n.z,a=(l=this.Na[1]).x,o=l.y,h=l.z,c=(u=this.Na[2]).x,a-=s,o-=r,r=(l=u.y)-r,n=o*(l=(u=u.z)-n)-(h-=n)*r,l=h*(s=c-s)-a*l,r=a*r-o*s,(a=this.dir).x=n,a.y=l,a.z=r,this.zf(!1),this.Af(!1),r=this.Na[this.ya],n=this.jb[this.ya],r.x=n.x,r.y=n.y,r.z=n.z,n=this.qb[this.ya],a=r.y-n.y,s=r.z-n.z,r.x=r.x-n.x,r.y=a,r.z=s,this.ya++,this.tm())break;if(this.ya--,n=-(r=this.dir).y,a=-r.z,r.x=-r.x,r.y=n,r.z=a,this.zf(!1),this.Af(!1),r=this.Na[this.ya],n=this.jb[this.ya],r.x=n.x,r.y=n.y,r.z=n.z,n=this.qb[this.ya],a=r.y-n.y,s=r.z-n.z,r.x=r.x-n.x,r.y=a,r.z=s,this.ya++,this.tm())break;this.ya--;break}(r=this.dir).x=t,r.y=e,r.z=i},tm:function(){var t=this.Na[2].x-this.Na[0].x,e=this.Na[2].y-this.Na[0].y,i=this.Na[2].z-this.Na[0].z,s=this.Na[3].x-this.Na[0].x,r=this.Na[3].y-this.Na[0].y,n=this.Na[3].z-this.Na[0].z;return 1e-12<(t=(this.Na[1].x-this.Na[0].x)*(e*n-i*r)-(this.Na[1].y-this.Na[0].y)*(t*n-i*s)+(this.Na[1].z-this.Na[0].z)*(t*r-e*s))||-1e-12>t},mn:function(t,e,i,s,r,n,a){for(var o=this.Og;0<o.lh;){var h=o.jd;o.lh--;var c=h.ia,l=h.M;null!=c&&(c.M=l),null!=l&&(l.ia=c),h==o.jd&&(o.jd=o.jd.M),h==o.Rc&&(o.Rc=o.Rc.ia),h.M=null,h.ia=null,h.tk(),h.M=o.De,o.De=h}for(;0<o.Ne;){var u=o.zb[--o.Ne];u.tk(),u.M=o.bf,o.bf=u}var p=this.Og,d=this.Og,f=d.bf;null!=f?(d.bf=f.M,f.M=null):f=new _t;var m=f.za(r[0],n[0],a[0]),g=this.Og,y=g.bf;null!=y?(g.bf=y.M,y.M=null):y=new _t;var v=y.za(r[1],n[1],a[1]),b=this.Og,x=b.bf;null!=x?(b.bf=x.M,x.M=null):x=new _t;var _=x.za(r[2],n[2],a[2]),M=this.Og,w=M.bf;if(null!=w?(M.bf=w.M,w.M=null):w=new _t,!p.fh(m,v,_,w.za(r[3],n[3],a[3])))return mt.EPA_FAILED_TO_INIT;this.ya=0;for(var S=this.Na[0],A=this.jb[0],T=this.qb[0],C=0;40>C;){for(var L=this.Og.jd,E=1/0,z=null;null!=L;){var R=L.M;L.Wj<E&&(E=L.Wj,z=L),L=R}var B=z,P=this.dir,D=B.dk;P.x=D.x,P.y=D.y,P.z=D.z;var I=P,O=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);0<O&&(O=1/O);var F=I.y*O,G=I.z*O;I.x=I.x*O,I.y=F,I.z=G,this.zf(!1),this.Af(!1);var N=this.Na[this.ya],j=this.jb[this.ya];N.x=j.x,N.y=j.y,N.z=j.z;var V=N,U=this.qb[this.ya],k=V.y-U.y,H=V.z-U.z;V.x=V.x-U.x,V.y=k,V.z=H;var W=B.zb[0],q=B.zb[1],$=B.zb[2],J=W.xd,X=this.dir,Y=this.dir;if(1e-6>S.x*Y.x+S.y*Y.y+S.z*Y.z-(J.x*X.x+J.y*X.y+J.z*X.z)||39==C){var K=this.closest,Z=this.dir;K.x=Z.x,K.y=Z.y,K.z=Z.z;var Q=K,tt=this.dir,et=W.xd,it=this.dir,st=(tt.x*et.x+tt.y*et.y+tt.z*et.z)/(it.x*it.x+it.y*it.y+it.z*it.z),rt=Q.y*st,nt=Q.z*st;Q.x=Q.x*st,Q.y=rt,Q.z=nt;var at,ot,ht,ct=this.closest;at=ct.x,ot=ct.y,ht=ct.z;var lt,ut,pt,dt,ft,gt,yt,vt,bt,xt,Mt,wt,St,At,Tt,Ct,Lt,Et,zt,Rt,Bt,Pt,Dt,It,Ot=W.xd;lt=Ot.x,ut=Ot.y,pt=Ot.z;var Ft=W.jb;dt=Ft.x,ft=Ft.y,gt=Ft.z;var Gt=W.qb;yt=Gt.x,vt=Gt.y,bt=Gt.z;var Nt=q.xd;xt=Nt.x,Mt=Nt.y,wt=Nt.z;var jt=q.jb;St=jt.x,At=jt.y,Tt=jt.z;var Vt=q.qb;Ct=Vt.x,Lt=Vt.y,Et=Vt.z;var Ut=$.xd;zt=Ut.x,Rt=Ut.y,Bt=Ut.z;var kt=$.jb;Pt=kt.x,Dt=kt.y,It=kt.z;var Ht,Wt,qt,$t,Jt,Xt,Yt,Kt,Zt,Qt=$.qb,te=(Ht=xt-lt)*Ht+(Wt=Mt-ut)*Wt+(qt=wt-pt)*qt,ee=Ht*($t=zt-lt)+Wt*(Jt=Rt-ut)+qt*(Xt=Bt-pt),ie=$t*$t+Jt*Jt+Xt*Xt,se=Ht*(Yt=at-lt)+Wt*(Kt=ot-ut)+qt*(Zt=ht-pt),re=$t*Yt+Jt*Kt+Xt*Zt,ne=te*ie-ee*ee;ne&&(ne=1/ne);var ae,oe,he,ce,le,ue,pe=(se*ie-re*ee)*ne,de=(-se*ee+re*te)*ne;ae=dt+(St-dt)*pe,oe=ft+(At-ft)*pe,he=gt+(Tt-gt)*pe,ae+=(Pt-dt)*de,oe+=(Dt-ft)*de,he+=(It-gt)*de,ce=yt+(Ct-yt)*pe,le=vt+(Lt-vt)*pe,ue=bt+(Et-bt)*pe,ce+=(Qt.x-yt)*de,le+=(Qt.y-vt)*de,ue+=(Qt.z-bt)*de;var fe=this.closestPoint1;fe.x=ae,fe.y=oe,fe.z=he;var me=this.closestPoint2;me.x=ce,me.y=le,me.z=ue;var ge=this.closest;return this.depth=Math.sqrt(ge.x*ge.x+ge.y*ge.y+ge.z*ge.z),mt.SUCCEEDED}var ye=this.Og,ve=ye.bf;null!=ve?(ye.bf=ve.M,ve.M=null):ve=new _t;var be=ve.za(S,A,T);if(!this.Og.Vm(be,B))return mt.EPA_FAILED_TO_ADD_VERTEX;++C}return mt.EPA_DID_NOT_CONVERGE},ua:function(t,e,i,s,r){return this.zj(t,e,i,s,r,!0)},cb:function(t,e,i,s,r){return this.zj(t,e,i,s,r,!1)},Bf:function(t,e,i,s,r,n,a){return this.fm(t,e,i,s,r,n,a)},Vd:function(t,e,i,s,r){var n=this.ao;n.v=i.x,n.A=i.y,n.B=i.z;var a=this.bo,o=this.co;a.x=s.x,a.y=s.y,a.z=s.z,s=a.y-i.y;var h=a.z-i.z;return a.x=a.x-i.x,a.y=s,a.z=h,o.Z(),this.fm(null,t,n,e,a,o,r)}},ft.qc=function(t,e,i){var s,r,n,a,o,h,c,l;return s=t.x,r=t.y,t=t.z,0>(l=-((o=(n=e.x)-s)*s+(h=(a=e.y)-r)*r+(c=(e=e.z)-t)*t)/(o*o+h*h+c*c))?(i.x=s,i.y=r,i.z=t,1):1<l?(i.x=n,i.y=a,i.z=e,2):(i.x=s+o*l,i.y=r+h*l,i.z=t+c*l,3)},ft.uc=function(t,e,i,s){var r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w,S;r=t.x,n=t.y,a=t.z,o=e.x,h=e.y,c=e.z,b=r-(l=i.x),x=n-(u=i.y),_=a-(p=i.z);var A,T,C,L,E,z=-1,R=0;return C=T=A=0,0>r*((f=h-n)*(S=(d=o-r)*(y=u-h)-f*(g=l-o))-(m=c-a)*(w=m*g-d*(v=p-c)))+n*(m*(M=f*v-m*y)-d*S)+a*(d*w-f*M)&&(d=t.x,z=t.y,A=t.z,0>(R=-((E=(f=e.x)-d)*d+(C=(m=e.y)-z)*z+(T=(L=e.z)-A)*A)/(E*E+C*C+T*T))?(s.x=d,s.y=z,s.z=A,T=1):1<R?(s.x=f,s.y=m,s.z=L,T=2):(d+=E*R,z+=C*R,A+=T*R,s.x=d,s.y=z,s.z=A,T=3),R=T,z=A=s.x*s.x+s.y*s.y+s.z*s.z,A=s.x,T=s.y,C=s.z),0>o*(y*S-v*w)+h*(v*M-g*S)+c*(g*w-y*M)&&(g=e.x,o=e.y,e=e.z,0>(c=-((m=(v=i.x)-g)*g+(y=(d=i.y)-o)*o+(h=(f=i.z)-e)*e)/(m*m+y*y+h*h))?(s.x=g,s.y=o,s.z=e,e=1):1<c?(s.x=v,s.y=d,s.z=f,e=2):(g+=m*c,o+=y*c,e+=h*c,s.x=g,s.y=o,s.z=e,e=3),o=s.x*s.x+s.y*s.y+s.z*s.z,0>z||o<z)&&(R=e<<1,z=o,A=s.x,T=s.y,C=s.z),0>l*(x*S-_*w)+u*(_*M-b*S)+p*(b*w-x*M)&&(u=t.x,l=t.y,t=t.z,0>(p=-((o=(b=i.x)-u)*u+(_=(x=i.y)-l)*l+(i=(e=i.z)-t)*t)/(o*o+_*_+i*i))?(s.x=u,s.y=l,s.z=t,i=1):1<p?(s.x=b,s.y=x,s.z=e,i=2):(u+=o*p,l+=_*p,i=t+i*p,s.x=u,s.y=l,s.z=i,i=3),t=s.x*s.x+s.y*s.y+s.z*s.z,0>z||t<z)&&(R=1&i|(2&i)<<1,z=t,A=s.x,T=s.y,C=s.z),0<z?(s.x=A,s.y=T,s.z=C,R):(0<(i=M*M+w*w+S*S)&&(i=1/Math.sqrt(i)),A=(M*=i)*(r=(r*M+n*(w*=i)+a*(S*=i))/(M*M+w*w+S*S)),T=w*r,C=S*r,s.x=A,s.y=T,s.z=C,7)},ft.vc=function(t,e,i,s,r){var n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w,S,A,T,C,L,E,z,R,B,P,D;n=t.x,a=t.y,o=t.z,h=e.x,c=e.y,l=e.z,u=i.x,p=i.y,d=i.z,f=s.x;var I,O,F,G=0<(y=h-n)*(B=(z=(m=s.y)-c)*(L=d-l)-(R=(g=s.z)-l)*(C=p-c))+(v=c-a)*(P=R*(T=u-h)-(E=f-h)*L)+(b=l-o)*(D=E*C-z*T)?1:-1,N=n*((_=p-a)*(A=g-o)-(M=d-o)*(S=m-a))+a*(M*(w=f-n)-(x=u-n)*A)+o*(x*S-_*w),j=n*(S*b-A*v)+a*(A*y-w*b)+o*(w*v-S*y),V=h*B+c*P+l*D,U=-1,k=0;if(F=O=I=0,0>(n*(v*M-b*_)+a*(b*x-y*M)+o*(y*_-v*x))*G){var H,W,q,$,J,X,Y,K,Z,Q,tt,et,it,st,rt,nt,at,ot,ht,ct,lt;H=t.x,W=t.y,q=t.z,$=e.x,J=e.y,X=e.z,Y=i.x;var ut,pt,dt,ft,mt=$*((st=(K=i.y)-J)*(lt=(Q=$-H)*st-(tt=J-W)*(it=Y-$))-(rt=(Z=i.z)-X)*(ct=(et=X-q)*it-Q*rt))+J*(rt*(ht=tt*rt-et*st)-it*lt)+X*(it*ct-st*ht),gt=Y*((at=W-K)*lt-(ot=q-Z)*ct)+K*(ot*ht-(nt=H-Y)*lt)+Z*(nt*ct-at*ht),yt=-1,vt=0;if(dt=pt=ut=0,0>H*(tt*lt-et*ct)+W*(et*ht-Q*lt)+q*(Q*ct-tt*ht)){var bt,xt,_t,Mt,wt,St,At,Tt,Ct,Lt,Et;if(bt=t.x,xt=t.y,_t=t.z,0>(Lt=-(Lt=(At=(Mt=e.x)-bt)*bt+(Tt=(wt=e.y)-xt)*xt+(Ct=(St=e.z)-_t)*_t)/(At*At+Tt*Tt+Ct*Ct)))r.x=bt,r.y=xt,r.z=_t,Et=1;else if(1<Lt)r.x=Mt,r.y=wt,r.z=St,Et=2;else{var zt,Rt,Bt;zt=bt+At*Lt,Rt=xt+Tt*Lt,Bt=_t+Ct*Lt,r.x=zt,r.y=Rt,r.z=Bt,Et=3}vt=Et,yt=r.x*r.x+r.y*r.y+r.z*r.z,ut=r.x,pt=r.y,dt=r.z}if(0>mt){var Pt,Dt,It,Ot,Ft,Gt,Nt,jt,Vt,Ut,kt;if(Pt=e.x,Dt=e.y,It=e.z,0>(Ut=-(Ut=(Nt=(Ot=i.x)-Pt)*Pt+(jt=(Ft=i.y)-Dt)*Dt+(Vt=(Gt=i.z)-It)*It)/(Nt*Nt+jt*jt+Vt*Vt)))r.x=Pt,r.y=Dt,r.z=It,kt=1;else if(1<Ut)r.x=Ot,r.y=Ft,r.z=Gt,kt=2;else{var Ht,Wt,qt;Ht=Pt+Nt*Ut,Wt=Dt+jt*Ut,qt=It+Vt*Ut,r.x=Ht,r.y=Wt,r.z=qt,kt=3}var $t=r.x*r.x+r.y*r.y+r.z*r.z;(0>yt||$t<yt)&&(vt=kt<<1,yt=$t,ut=r.x,pt=r.y,dt=r.z)}if(0>gt){var Jt,Xt,Yt,Kt,Zt,Qt,te,ee,ie,se,re;if(Jt=t.x,Xt=t.y,Yt=t.z,0>(se=-(se=(te=(Kt=i.x)-Jt)*Jt+(ee=(Zt=i.y)-Xt)*Xt+(ie=(Qt=i.z)-Yt)*Yt)/(te*te+ee*ee+ie*ie)))r.x=Jt,r.y=Xt,r.z=Yt,re=1;else if(1<se)r.x=Kt,r.y=Zt,r.z=Qt,re=2;else{var ne,ae,oe;ne=Jt+te*se,ae=Xt+ee*se,oe=Yt+ie*se,r.x=ne,r.y=ae,r.z=oe,re=3}var he=r.x*r.x+r.y*r.y+r.z*r.z;(0>yt||he<yt)&&(vt=1&re|(2&re)<<1,yt=he,ut=r.x,pt=r.y,dt=r.z)}if(0<yt)r.x=ut,r.y=pt,r.z=dt,ft=vt;else{var ce,le=ht*ht+ct*ct+lt*lt;0<le&&(le=1/Math.sqrt(le)),ut=(ht*=le)*(ce=(H*ht+W*(ct*=le)+q*(lt*=le))/(ce=ht*ht+ct*ct+lt*lt)),pt=ct*ce,dt=lt*ce,r.x=ut,r.y=pt,r.z=dt,ft=7}k=ft,U=r.x*r.x+r.y*r.y+r.z*r.z,I=r.x,O=r.y,F=r.z}if(0>N*G){var ue,pe,de,fe,me,ge,ye,ve,be,xe,_e,Me,we,Se,Ae,Te,Ce,Le,Ee,ze,Re;ue=t.x,pe=t.y,de=t.z,fe=i.x,me=i.y,ge=i.z,ye=s.x;var Be,Pe,De,Ie,Oe=fe*((Se=(ve=s.y)-me)*(Re=(xe=fe-ue)*Se-(_e=me-pe)*(we=ye-fe))-(Ae=(be=s.z)-ge)*(ze=(Me=ge-de)*we-xe*Ae))+me*(Ae*(Ee=_e*Ae-Me*Se)-we*Re)+ge*(we*ze-Se*Ee),Fe=ye*((Ce=pe-ve)*Re-(Le=de-be)*ze)+ve*(Le*Ee-(Te=ue-ye)*Re)+be*(Te*ze-Ce*Ee),Ge=-1,Ne=0;if(De=Pe=Be=0,0>ue*(_e*Re-Me*ze)+pe*(Me*Ee-xe*Re)+de*(xe*ze-_e*Ee)){var je,Ve,Ue,ke,He,We,qe,$e,Je,Xe,Ye;if(je=t.x,Ve=t.y,Ue=t.z,0>(Xe=-(Xe=(qe=(ke=i.x)-je)*je+($e=(He=i.y)-Ve)*Ve+(Je=(We=i.z)-Ue)*Ue)/(qe*qe+$e*$e+Je*Je)))r.x=je,r.y=Ve,r.z=Ue,Ye=1;else if(1<Xe)r.x=ke,r.y=He,r.z=We,Ye=2;else{var Ke,Ze,Qe;Ke=je+qe*Xe,Ze=Ve+$e*Xe,Qe=Ue+Je*Xe,r.x=Ke,r.y=Ze,r.z=Qe,Ye=3}Ne=Ye,Ge=r.x*r.x+r.y*r.y+r.z*r.z,Be=r.x,Pe=r.y,De=r.z}if(0>Oe){var ti,ei,ii,si,ri,ni,ai,oi,hi,ci,li;if(ti=i.x,ei=i.y,ii=i.z,0>(ci=-(ci=(ai=(si=s.x)-ti)*ti+(oi=(ri=s.y)-ei)*ei+(hi=(ni=s.z)-ii)*ii)/(ai*ai+oi*oi+hi*hi)))r.x=ti,r.y=ei,r.z=ii,li=1;else if(1<ci)r.x=si,r.y=ri,r.z=ni,li=2;else{var ui,pi,di;ui=ti+ai*ci,pi=ei+oi*ci,di=ii+hi*ci,r.x=ui,r.y=pi,r.z=di,li=3}var fi=r.x*r.x+r.y*r.y+r.z*r.z;(0>Ge||fi<Ge)&&(Ne=li<<1,Ge=fi,Be=r.x,Pe=r.y,De=r.z)}if(0>Fe){var mi,gi,yi,vi,bi,xi,_i,Mi,wi,Si,Ai;if(mi=t.x,gi=t.y,yi=t.z,0>(Si=-(Si=(_i=(vi=s.x)-mi)*mi+(Mi=(bi=s.y)-gi)*gi+(wi=(xi=s.z)-yi)*yi)/(_i*_i+Mi*Mi+wi*wi)))r.x=mi,r.y=gi,r.z=yi,Ai=1;else if(1<Si)r.x=vi,r.y=bi,r.z=xi,Ai=2;else{var Ti,Ci,Li;Ti=mi+_i*Si,Ci=gi+Mi*Si,Li=yi+wi*Si,r.x=Ti,r.y=Ci,r.z=Li,Ai=3}var Ei=r.x*r.x+r.y*r.y+r.z*r.z;(0>Ge||Ei<Ge)&&(Ne=1&Ai|(2&Ai)<<1,Ge=Ei,Be=r.x,Pe=r.y,De=r.z)}if(0<Ge)r.x=Be,r.y=Pe,r.z=De,Ie=Ne;else{var zi,Ri=Ee*Ee+ze*ze+Re*Re;0<Ri&&(Ri=1/Math.sqrt(Ri)),Be=(Ee*=Ri)*(zi=(ue*Ee+pe*(ze*=Ri)+de*(Re*=Ri))/(zi=Ee*Ee+ze*ze+Re*Re)),Pe=ze*zi,De=Re*zi,r.x=Be,r.y=Pe,r.z=De,Ie=7}var Bi=r.x*r.x+r.y*r.y+r.z*r.z;(0>U||Bi<U)&&(k=1&Ie|(6&Ie)<<1,U=Bi,I=r.x,O=r.y,F=r.z)}if(0>j*G){var Pi,Di,Ii,Oi,Fi,Gi,Ni,ji,Vi,Ui,ki,Hi,Wi,qi,$i,Ji,Xi,Yi,Ki,Zi,Qi;Pi=t.x,Di=t.y,Ii=t.z,Oi=e.x,Fi=e.y,Gi=e.z,Ni=s.x;var ts,es,is,ss,rs=Oi*((qi=(ji=s.y)-Fi)*(Qi=(Ui=Oi-Pi)*qi-(ki=Fi-Di)*(Wi=Ni-Oi))-($i=(Vi=s.z)-Gi)*(Zi=(Hi=Gi-Ii)*Wi-Ui*$i))+Fi*($i*(Ki=ki*$i-Hi*qi)-Wi*Qi)+Gi*(Wi*Zi-qi*Ki),ns=Ni*((Xi=Di-ji)*Qi-(Yi=Ii-Vi)*Zi)+ji*(Yi*Ki-(Ji=Pi-Ni)*Qi)+Vi*(Ji*Zi-Xi*Ki),as=-1,os=0;if(is=es=ts=0,0>Pi*(ki*Qi-Hi*Zi)+Di*(Hi*Ki-Ui*Qi)+Ii*(Ui*Zi-ki*Ki)){var hs,cs,ls,us,ps,ds,fs,ms,gs,ys,vs;if(hs=t.x,cs=t.y,ls=t.z,0>(ys=-(ys=(fs=(us=e.x)-hs)*hs+(ms=(ps=e.y)-cs)*cs+(gs=(ds=e.z)-ls)*ls)/(fs*fs+ms*ms+gs*gs)))r.x=hs,r.y=cs,r.z=ls,vs=1;else if(1<ys)r.x=us,r.y=ps,r.z=ds,vs=2;else{var bs,xs,_s;bs=hs+fs*ys,xs=cs+ms*ys,_s=ls+gs*ys,r.x=bs,r.y=xs,r.z=_s,vs=3}os=vs,as=r.x*r.x+r.y*r.y+r.z*r.z,ts=r.x,es=r.y,is=r.z}if(0>rs){var Ms,ws,Ss,As,Ts,Cs,Ls,Es,zs,Rs,Bs;if(Ms=e.x,ws=e.y,Ss=e.z,0>(Rs=-(Rs=(Ls=(As=s.x)-Ms)*Ms+(Es=(Ts=s.y)-ws)*ws+(zs=(Cs=s.z)-Ss)*Ss)/(Ls*Ls+Es*Es+zs*zs)))r.x=Ms,r.y=ws,r.z=Ss,Bs=1;else if(1<Rs)r.x=As,r.y=Ts,r.z=Cs,Bs=2;else{var Ps,Ds,Is;Ps=Ms+Ls*Rs,Ds=ws+Es*Rs,Is=Ss+zs*Rs,r.x=Ps,r.y=Ds,r.z=Is,Bs=3}var Os=r.x*r.x+r.y*r.y+r.z*r.z;(0>as||Os<as)&&(os=Bs<<1,as=Os,ts=r.x,es=r.y,is=r.z)}if(0>ns){var Fs,Gs,Ns,js,Vs,Us,ks,Hs,Ws,qs,$s;if(Fs=t.x,Gs=t.y,Ns=t.z,0>(qs=-(qs=(ks=(js=s.x)-Fs)*Fs+(Hs=(Vs=s.y)-Gs)*Gs+(Ws=(Us=s.z)-Ns)*Ns)/(ks*ks+Hs*Hs+Ws*Ws)))r.x=Fs,r.y=Gs,r.z=Ns,$s=1;else if(1<qs)r.x=js,r.y=Vs,r.z=Us,$s=2;else{var Js,Xs,Ys;Js=Fs+ks*qs,Xs=Gs+Hs*qs,Ys=Ns+Ws*qs,r.x=Js,r.y=Xs,r.z=Ys,$s=3}var Ks=r.x*r.x+r.y*r.y+r.z*r.z;(0>as||Ks<as)&&(os=1&$s|(2&$s)<<1,as=Ks,ts=r.x,es=r.y,is=r.z)}if(0<as)r.x=ts,r.y=es,r.z=is,ss=os;else{var Zs,Qs=Ki*Ki+Zi*Zi+Qi*Qi;0<Qs&&(Qs=1/Math.sqrt(Qs)),ts=(Ki*=Qs)*(Zs=(Pi*Ki+Di*(Zi*=Qs)+Ii*(Qi*=Qs))/(Zs=Ki*Ki+Zi*Zi+Qi*Qi)),es=Zi*Zs,is=Qi*Zs,r.x=ts,r.y=es,r.z=is,ss=7}var tr=r.x*r.x+r.y*r.y+r.z*r.z;(0>U||tr<U)&&(k=3&ss|(4&ss)<<1,U=tr,I=r.x,O=r.y,F=r.z)}if(0>V*G){var er,ir,sr,rr,nr,ar,or,hr,cr,lr,ur,pr,dr,fr,mr,gr,yr,vr,br,xr,_r;er=e.x,ir=e.y,sr=e.z,rr=i.x,nr=i.y,ar=i.z,or=s.x;var Mr,wr,Sr,Ar,Tr=rr*((fr=(hr=s.y)-nr)*(_r=(lr=rr-er)*fr-(ur=nr-ir)*(dr=or-rr))-(mr=(cr=s.z)-ar)*(xr=(pr=ar-sr)*dr-lr*mr))+nr*(mr*(br=ur*mr-pr*fr)-dr*_r)+ar*(dr*xr-fr*br),Cr=or*((yr=ir-hr)*_r-(vr=sr-cr)*xr)+hr*(vr*br-(gr=er-or)*_r)+cr*(gr*xr-yr*br),Lr=-1,Er=0;if(Sr=wr=Mr=0,0>er*(ur*_r-pr*xr)+ir*(pr*br-lr*_r)+sr*(lr*xr-ur*br)){var zr,Rr,Br,Pr,Dr,Ir,Or,Fr,Gr,Nr,jr;if(zr=e.x,Rr=e.y,Br=e.z,0>(Nr=-(Nr=(Or=(Pr=i.x)-zr)*zr+(Fr=(Dr=i.y)-Rr)*Rr+(Gr=(Ir=i.z)-Br)*Br)/(Or*Or+Fr*Fr+Gr*Gr)))r.x=zr,r.y=Rr,r.z=Br,jr=1;else if(1<Nr)r.x=Pr,r.y=Dr,r.z=Ir,jr=2;else{var Vr,Ur,kr;Vr=zr+Or*Nr,Ur=Rr+Fr*Nr,kr=Br+Gr*Nr,r.x=Vr,r.y=Ur,r.z=kr,jr=3}Er=jr,Lr=r.x*r.x+r.y*r.y+r.z*r.z,Mr=r.x,wr=r.y,Sr=r.z}if(0>Tr){var Hr,Wr,qr,$r,Jr,Xr,Yr,Kr,Zr,Qr,tn;if(Hr=i.x,Wr=i.y,qr=i.z,0>(Qr=-(Qr=(Yr=($r=s.x)-Hr)*Hr+(Kr=(Jr=s.y)-Wr)*Wr+(Zr=(Xr=s.z)-qr)*qr)/(Yr*Yr+Kr*Kr+Zr*Zr)))r.x=Hr,r.y=Wr,r.z=qr,tn=1;else if(1<Qr)r.x=$r,r.y=Jr,r.z=Xr,tn=2;else{var en,sn,rn;en=Hr+Yr*Qr,sn=Wr+Kr*Qr,rn=qr+Zr*Qr,r.x=en,r.y=sn,r.z=rn,tn=3}var nn=r.x*r.x+r.y*r.y+r.z*r.z;(0>Lr||nn<Lr)&&(Er=tn<<1,Lr=nn,Mr=r.x,wr=r.y,Sr=r.z)}if(0>Cr){var an,on,hn,cn,ln,un,pn,dn,fn,mn,gn;if(an=e.x,on=e.y,hn=e.z,0>(mn=-(mn=(pn=(cn=s.x)-an)*an+(dn=(ln=s.y)-on)*on+(fn=(un=s.z)-hn)*hn)/(pn*pn+dn*dn+fn*fn)))r.x=an,r.y=on,r.z=hn,gn=1;else if(1<mn)r.x=cn,r.y=ln,r.z=un,gn=2;else{var yn,vn,bn;yn=an+pn*mn,vn=on+dn*mn,bn=hn+fn*mn,r.x=yn,r.y=vn,r.z=bn,gn=3}var xn=r.x*r.x+r.y*r.y+r.z*r.z;(0>Lr||xn<Lr)&&(Er=1&gn|(2&gn)<<1,Lr=xn,Mr=r.x,wr=r.y,Sr=r.z)}if(0<Lr)r.x=Mr,r.y=wr,r.z=Sr,Ar=Er;else{var _n,Mn=br*br+xr*xr+_r*_r;0<Mn&&(Mn=1/Math.sqrt(Mn)),Mr=(br*=Mn)*(_n=(er*br+ir*(xr*=Mn)+sr*(_r*=Mn))/(_n=br*br+xr*xr+_r*_r)),wr=xr*_n,Sr=_r*_n,r.x=Mr,r.y=wr,r.z=Sr,Ar=7}var wn=r.x*r.x+r.y*r.y+r.z*r.z;(0>U||wn<U)&&(k=Ar<<1,U=wn,I=r.x,O=r.y,F=r.z)}return 0<U?(r.x=I,r.y=O,r.z=F,k):(r.Z(),15)},dt.prototype={za:function(t,e,i,s,r,n,a,o,h){return this.e00=t,this.e01=e,this.e02=i,this.e10=s,this.e11=r,this.e12=n,this.e20=a,this.e21=o,this.e22=h,this},Wf:function(){return this.e00=1,this.e10=this.e02=this.e01=0,this.e11=1,this.e21=this.e20=this.e12=0,this.e22=1,this},Ac:function(t){return new dt(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)},Ug:function(t){return new dt(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)},Mf:function(t){return new dt(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)},re:function(t){return new dt(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)},Ec:function(t){var e=this.e01+t.e01,i=this.e02+t.e02,s=this.e10+t.e10,r=this.e11+t.e11,n=this.e12+t.e12,a=this.e20+t.e20,o=this.e21+t.e21,h=this.e22+t.e22;return this.e00+=t.e00,this.e01=e,this.e02=i,this.e10=s,this.e11=r,this.e12=n,this.e20=a,this.e21=o,this.e22=h,this},Vg:function(t){var e=this.e01-t.e01,i=this.e02-t.e02,s=this.e10-t.e10,r=this.e11-t.e11,n=this.e12-t.e12,a=this.e20-t.e20,o=this.e21-t.e21,h=this.e22-t.e22;return this.e00=this.e00-t.e00,this.e01=e,this.e02=i,this.e10=s,this.e11=r,this.e12=n,this.e20=a,this.e21=o,this.e22=h,this},Tg:function(t){var e=this.e01*t,i=this.e02*t,s=this.e10*t,r=this.e11*t,n=this.e12*t,a=this.e20*t,o=this.e21*t,h=this.e22*t;return this.e00=this.e00*t,this.e01=e,this.e02=i,this.e10=s,this.e11=r,this.e12=n,this.e20=a,this.e21=o,this.e22=h,this},se:function(t){var e=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,i=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,s=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,r=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,n=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,a=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,o=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=e,this.e02=i,this.e10=s,this.e11=r,this.e12=n,this.e20=a,this.e21=o,this.e22=h,this},Ue:function(t,e,i){return new dt(this.e00*t,this.e01*t,this.e02*t,this.e10*e,this.e11*e,this.e12*e,this.e20*i,this.e21*i,this.e22*i)},Lc:function(t,e,i){return new dt(this.e00*t,this.e01*e,this.e02*i,this.e10*t,this.e11*e,this.e12*i,this.e20*t,this.e21*e,this.e22*i)},te:function(t,e,i,s){var r=Math.sin(t),n=Math.cos(t),a=1-n;t=e*e*a+n;var o=e*i*a-s*r,h=e*s*a+i*r,c=i*e*a+s*r,l=i*i*a+n,u=i*s*a-e*r,p=s*e*a-i*r;return e=s*i*a+e*r,s=s*s*a+n,new dt(t*this.e00+o*this.e10+h*this.e20,t*this.e01+o*this.e11+h*this.e21,t*this.e02+o*this.e12+h*this.e22,c*this.e00+l*this.e10+u*this.e20,c*this.e01+l*this.e11+u*this.e21,c*this.e02+l*this.e12+u*this.e22,p*this.e00+e*this.e10+s*this.e20,p*this.e01+e*this.e11+s*this.e21,p*this.e02+e*this.e12+s*this.e22)},Jc:function(t,e,i,s){var r=Math.sin(t),n=Math.cos(t),a=1-n;t=e*e*a+n;var o=e*i*a-s*r,h=e*s*a+i*r,c=i*e*a+s*r,l=i*i*a+n,u=i*s*a-e*r,p=s*e*a-i*r;return e=s*i*a+e*r,s=s*s*a+n,new dt(this.e00*t+this.e01*c+this.e02*p,this.e00*o+this.e01*l+this.e02*e,this.e00*h+this.e01*u+this.e02*s,this.e10*t+this.e11*c+this.e12*p,this.e10*o+this.e11*l+this.e12*e,this.e10*h+this.e11*u+this.e12*s,this.e20*t+this.e21*c+this.e22*p,this.e20*o+this.e21*l+this.e22*e,this.e20*h+this.e21*u+this.e22*s)},Ve:function(t,e,i){var s=this.e01*t,r=this.e02*t,n=this.e10*e,a=this.e11*e;e=this.e12*e;var o=this.e20*i,h=this.e21*i;return i=this.e22*i,this.e00=this.e00*t,this.e01=s,this.e02=r,this.e10=n,this.e11=a,this.e12=e,this.e20=o,this.e21=h,this.e22=i,this},fd:function(t,e,i){var s=this.e01*e,r=this.e02*i,n=this.e10*t,a=this.e11*e,o=this.e12*i,h=this.e20*t;return e=this.e21*e,i=this.e22*i,this.e00=this.e00*t,this.e01=s,this.e02=r,this.e10=n,this.e11=a,this.e12=o,this.e20=h,this.e21=e,this.e22=i,this},ue:function(t,e,i,s){var r=Math.sin(t),n=Math.cos(t),a=1-n;t=e*e*a+n;var o=e*i*a-s*r,h=e*s*a+i*r,c=i*e*a+s*r,l=i*i*a+n,u=i*s*a-e*r,p=s*e*a-i*r;return e=s*i*a+e*r,a=s*s*a+n,s=t*this.e01+o*this.e11+h*this.e21,i=t*this.e02+o*this.e12+h*this.e22,r=c*this.e00+l*this.e10+u*this.e20,n=c*this.e01+l*this.e11+u*this.e21,c=c*this.e02+l*this.e12+u*this.e22,l=p*this.e00+e*this.e10+a*this.e20,u=p*this.e01+e*this.e11+a*this.e21,p=p*this.e02+e*this.e12+a*this.e22,this.e00=t*this.e00+o*this.e10+h*this.e20,this.e01=s,this.e02=i,this.e10=r,this.e11=n,this.e12=c,this.e20=l,this.e21=u,this.e22=p,this},Kc:function(t,e,i,s){var r=Math.sin(t);t=e*e*(d=1-(p=Math.cos(t)))+p;var n=e*i*d-s*r,a=e*s*d+i*r,o=i*e*d+s*r,h=i*i*d+p,c=i*s*d-e*r,l=s*e*d-i*r;e=s*i*d+e*r;var u=s*s*d+p;s=this.e00*n+this.e01*h+this.e02*e,i=this.e00*a+this.e01*c+this.e02*u,r=this.e10*t+this.e11*o+this.e12*l;var p=this.e10*n+this.e11*h+this.e12*e,d=this.e10*a+this.e11*c+this.e12*u,f=this.e20*t+this.e21*o+this.e22*l;return n=this.e20*n+this.e21*h+this.e22*e,a=this.e20*a+this.e21*c+this.e22*u,this.e00=this.e00*t+this.e01*o+this.e02*l,this.e01=s,this.e02=i,this.e10=r,this.e11=p,this.e12=d,this.e20=f,this.e21=n,this.e22=a,this},ji:function(){return new dt(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)},ki:function(){var t=this.e10,e=this.e20,i=this.e01,s=this.e11,r=this.e21,n=this.e02,a=this.e12,o=this.e22;return this.e00=this.e00,this.e01=t,this.e02=e,this.e10=i,this.e11=s,this.e12=r,this.e20=n,this.e21=a,this.e22=o,this},Yd:function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)},Xg:function(){return this.e00+this.e11+this.e22},pe:function(){var t=this.e11*this.e22-this.e12*this.e21,e=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,s=this.e01*this.e22-this.e02*this.e21,r=this.e00*this.e22-this.e02*this.e20,n=this.e00*this.e21-this.e01*this.e20,a=this.e01*this.e12-this.e02*this.e11,o=this.e00*this.e12-this.e02*this.e10,h=this.e00*this.e11-this.e01*this.e10,c=this.e00*t-this.e01*e+this.e02*i;return c&&(c=1/c),new dt(t*c,-s*c,a*c,-e*c,r*c,-o*c,i*c,-n*c,h*c)},qe:function(){var t=this.e11*this.e22-this.e12*this.e21,e=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,s=this.e01*this.e22-this.e02*this.e21,r=this.e00*this.e22-this.e02*this.e20,n=this.e00*this.e21-this.e01*this.e20,a=this.e01*this.e12-this.e02*this.e11,o=this.e00*this.e12-this.e02*this.e10,h=this.e00*this.e11-this.e01*this.e10,c=this.e00*t-this.e01*e+this.e02*i;return c&&(c=1/c),this.e00=t*c,this.e01=-s*c,this.e02=a*c,this.e10=-e*c,this.e11=r*c,this.e12=-o*c,this.e20=i*c,this.e21=-n*c,this.e22=h*c,this},Wg:function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]},de:function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this},clone:function(){return new dt(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)},Hb:function(t){var e=t.x,i=t.y,s=t.z,r=t.w,n=2*s;t=e*(h=2*e);var a=i*(c=2*i),o=(s*=n,e*c),h=(i*=n,e*=n,r*h),c=r*c;return r*=n,this.e00=1-a-s,this.e01=o-r,this.e02=e+c,this.e10=o+r,this.e11=1-t-s,this.e12=i-h,this.e20=e-c,this.e21=i+h,this.e22=1-t-a,this},Pj:function(){var t=new ct,e=this.e00,i=this.e11,s=this.e22,r=e+i+s;return 0<r?(e=Math.sqrt(r+1),t.w=.5*e,e=.5/e,t.x=(this.e21-this.e12)*e,t.y=(this.e02-this.e20)*e,t.z=(this.e10-this.e01)*e):e>i?e>s?(e=Math.sqrt(e-i-s+1),t.x=.5*e,e=.5/e,t.y=(this.e01+this.e10)*e,t.z=(this.e02+this.e20)*e,t.w=(this.e21-this.e12)*e):(e=Math.sqrt(s-e-i+1),t.z=.5*e,e=.5/e,t.x=(this.e02+this.e20)*e,t.y=(this.e12+this.e21)*e,t.w=(this.e10-this.e01)*e):i>s?(e=Math.sqrt(i-s-e+1),t.y=.5*e,e=.5/e,t.x=(this.e01+this.e10)*e,t.z=(this.e12+this.e21)*e,t.w=(this.e02-this.e20)*e):(e=Math.sqrt(s-e-i+1),t.z=.5*e,e=.5/e,t.x=(this.e02+this.e20)*e,t.y=(this.e12+this.e21)*e,t.w=(this.e10-this.e01)*e),t},cb:function(t){var e=Math.sin(t.x),i=Math.sin(t.y),s=Math.sin(t.z),r=Math.cos(t.x),n=Math.cos(t.y);return t=Math.cos(t.z),this.e00=n*t,this.e01=-n*s,this.e02=i,this.e10=r*s+t*e*i,this.e11=r*t-e*i*s,this.e12=-n*e,this.e20=e*s-r*t*i,this.e21=t*e+r*i*s,this.e22=r*n,this},li:function(){var t=this.e02;return-1>=t?new bt(.5*(t=Math.atan2(this.e21,this.e11)),-1.570796326794895,.5*-t):1<=t?new bt(.5*(t=Math.atan2(this.e21,this.e11)),1.570796326794895,.5*t):new bt(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))},uc:function(t){return 0==t?new bt(this.e00,this.e01,this.e02):1==t?new bt(this.e10,this.e11,this.e12):2==t?new bt(this.e20,this.e21,this.e22):null},pc:function(t){return 0==t?new bt(this.e00,this.e10,this.e20):1==t?new bt(this.e01,this.e11,this.e21):2==t?new bt(this.e02,this.e12,this.e22):null},vc:function(t,e){0==t?e.za(this.e00,this.e01,this.e02):1==t?e.za(this.e10,this.e11,this.e12):2==t?e.za(this.e20,this.e21,this.e22):e.Z()},qc:function(t,e){0==t?e.za(this.e00,this.e10,this.e20):1==t?e.za(this.e01,this.e11,this.e21):2==t?e.za(this.e02,this.e12,this.e22):e.Z()},Mb:function(t,e,i){var s=t.y,r=t.z,n=e.x,a=e.y;e=e.z;var o=i.x,h=i.y;return i=i.z,this.e00=t.x,this.e01=s,this.e02=r,this.e10=n,this.e11=a,this.e12=e,this.e20=o,this.e21=h,this.e22=i,this},ua:function(t,e,i){var s=e.x,r=i.x,n=t.y,a=e.y,o=i.y,h=t.z;return e=e.z,i=i.z,this.e00=t.x,this.e01=s,this.e02=r,this.e10=n,this.e11=a,this.e12=o,this.e20=h,this.e21=e,this.e22=i,this},toString:function(){return"Mat3["+(0<this.e00?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(0<this.e01?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(0<this.e02?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(0<this.e10?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(0<this.e11?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(0<this.e12?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(0<this.e20?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(0<this.e21?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(0<this.e22?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}},pt.prototype={za:function(t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m){return this.e00=t,this.e01=e,this.e02=i,this.e03=s,this.e10=r,this.e11=n,this.e12=a,this.e13=o,this.e20=h,this.e21=c,this.e22=l,this.e23=u,this.e30=p,this.e31=d,this.e32=f,this.e33=m,this},Wf:function(){return this.e00=1,this.e10=this.e03=this.e02=this.e01=0,this.e11=1,this.e21=this.e20=this.e13=this.e12=0,this.e22=1,this.e32=this.e31=this.e30=this.e23=0,this.e33=1,this},pc:function(t){return new pt(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)},Mf:function(t){return new pt(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)},Ue:function(t){return new pt(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)},Yd:function(t){return new pt(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)},qc:function(t){var e=this.e01+t.e01,i=this.e02+t.e02,s=this.e03+t.e03,r=this.e10+t.e10,n=this.e11+t.e11,a=this.e12+t.e12,o=this.e13+t.e13,h=this.e20+t.e20,c=this.e21+t.e21,l=this.e22+t.e22,u=this.e23+t.e23,p=this.e30+t.e30,d=this.e31+t.e31,f=this.e32+t.e32,m=this.e33+t.e33;return this.e00+=t.e00,this.e01=e,this.e02=i,this.e03=s,this.e10=r,this.e11=n,this.e12=a,this.e13=o,this.e20=h,this.e21=c,this.e22=l,this.e23=u,this.e30=p,this.e31=d,this.e32=f,this.e33=m,this},Tg:function(t){var e=this.e01-t.e01,i=this.e02-t.e02,s=this.e03-t.e03,r=this.e10-t.e10,n=this.e11-t.e11,a=this.e12-t.e12,o=this.e13-t.e13,h=this.e20-t.e20,c=this.e21-t.e21,l=this.e22-t.e22,u=this.e23-t.e23,p=this.e30-t.e30,d=this.e31-t.e31,f=this.e32-t.e32,m=this.e33-t.e33;return this.e00=this.e00-t.e00,this.e01=e,this.e02=i,this.e03=s,this.e10=r,this.e11=n,this.e12=a,this.e13=o,this.e20=h,this.e21=c,this.e22=l,this.e23=u,this.e30=p,this.e31=d,this.e32=f,this.e33=m,this},Ve:function(t){var e=this.e01*t,i=this.e02*t,s=this.e03*t,r=this.e10*t,n=this.e11*t,a=this.e12*t,o=this.e13*t,h=this.e20*t,c=this.e21*t,l=this.e22*t,u=this.e23*t,p=this.e30*t,d=this.e31*t,f=this.e32*t,m=this.e33*t;return this.e00=this.e00*t,this.e01=e,this.e02=i,this.e03=s,this.e10=r,this.e11=n,this.e12=a,this.e13=o,this.e20=h,this.e21=c,this.e22=l,this.e23=u,this.e30=p,this.e31=d,this.e32=f,this.e33=m,this},pe:function(t){var e=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,i=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,s=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,r=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,a=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,o=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,h=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,c=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,l=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,u=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,p=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,d=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,f=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,m=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=e,this.e02=i,this.e03=s,this.e10=r,this.e11=n,this.e12=a,this.e13=o,this.e20=h,this.e21=c,this.e22=l,this.e23=u,this.e30=p,this.e31=d,this.e32=f,this.e33=m,this},te:function(t,e,i){return new pt(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*e,this.e11*e,this.e12*e,this.e13*e,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30,this.e31,this.e32,this.e33)},Ac:function(t,e,i){return new pt(this.e00*t,this.e01*e,this.e02*i,this.e03,this.e10*t,this.e11*e,this.e12*i,this.e13,this.e20*t,this.e21*e,this.e22*i,this.e23,this.e30*t,this.e31*e,this.e32*i,this.e33)},re:function(t,e,i,s){var r=Math.sin(t),n=Math.cos(t),a=1-n;t=e*e*a+n;var o=e*i*a-s*r,h=e*s*a+i*r,c=i*e*a+s*r,l=i*i*a+n,u=i*s*a-e*r,p=s*e*a-i*r;return e=s*i*a+e*r,s=s*s*a+n,new pt(t*this.e00+o*this.e10+h*this.e20,t*this.e01+o*this.e11+h*this.e21,t*this.e02+o*this.e12+h*this.e22,t*this.e03+o*this.e13+h*this.e23,c*this.e00+l*this.e10+u*this.e20,c*this.e01+l*this.e11+u*this.e21,c*this.e02+l*this.e12+u*this.e22,c*this.e03+l*this.e13+u*this.e23,p*this.e00+e*this.e10+s*this.e20,p*this.e01+e*this.e11+s*this.e21,p*this.e02+e*this.e12+s*this.e22,p*this.e03+e*this.e13+s*this.e23,this.e30,this.e31,this.e32,this.e33)},uc:function(t,e,i,s){var r=Math.sin(t),n=Math.cos(t),a=1-n;t=e*e*a+n;var o=e*i*a-s*r,h=e*s*a+i*r,c=i*e*a+s*r,l=i*i*a+n,u=i*s*a-e*r,p=s*e*a-i*r;return e=s*i*a+e*r,s=s*s*a+n,new pt(this.e00*t+this.e01*c+this.e02*p,this.e00*o+this.e01*l+this.e02*e,this.e00*h+this.e01*u+this.e02*s,this.e03,this.e10*t+this.e11*c+this.e12*p,this.e10*o+this.e11*l+this.e12*e,this.e10*h+this.e11*u+this.e12*s,this.e13,this.e20*t+this.e21*c+this.e22*p,this.e20*o+this.e21*l+this.e22*e,this.e20*h+this.e21*u+this.e22*s,this.e23,this.e30*t+this.e31*c+this.e32*p,this.e30*o+this.e31*l+this.e32*e,this.e30*h+this.e31*u+this.e32*s,this.e33)},ki:function(t,e,i){return new pt(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+e*this.e30,this.e11+e*this.e31,this.e12+e*this.e32,this.e13+e*this.e33,this.e20+i*this.e30,this.e21+i*this.e31,this.e22+i*this.e32,this.e23+i*this.e33,this.e30,this.e31,this.e32,this.e33)},ua:function(t,e,i){return new pt(this.e00,this.e01,this.e02,this.e00*t+this.e01*e+this.e02*i+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*e+this.e12*i+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*e+this.e22*i+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*e+this.e32*i+this.e33)},ue:function(t,e,i){var s=this.e01*t,r=this.e02*t,n=this.e03*t,a=this.e10*e,o=this.e11*e,h=this.e12*e;e=this.e13*e;var c=this.e20*i,l=this.e21*i,u=this.e22*i;i=this.e23*i;var p=this.e30,d=this.e31,f=this.e32,m=this.e33;return this.e00=this.e00*t,this.e01=s,this.e02=r,this.e03=n,this.e10=a,this.e11=o,this.e12=h,this.e13=e,this.e20=c,this.e21=l,this.e22=u,this.e23=i,this.e30=p,this.e31=d,this.e32=f,this.e33=m,this},Ec:function(t,e,i){var s=this.e01*e,r=this.e02*i,n=this.e03,a=this.e10*t,o=this.e11*e,h=this.e12*i,c=this.e13,l=this.e20*t,u=this.e21*e,p=this.e22*i,d=this.e23,f=this.e30*t;e=this.e31*e,i=this.e32*i;var m=this.e33;return this.e00=this.e00*t,this.e01=s,this.e02=r,this.e03=n,this.e10=a,this.e11=o,this.e12=h,this.e13=c,this.e20=l,this.e21=u,this.e22=p,this.e23=d,this.e30=f,this.e31=e,this.e32=i,this.e33=m,this},se:function(t,e,i,s){var r=Math.sin(t),n=e*i*(f=1-(d=Math.cos(t)))-s*r,a=e*s*f+i*r,o=i*e*f+s*r,h=i*i*f+d,c=i*s*f-e*r,l=s*e*f-i*r,u=s*i*f+e*r,p=s*s*f+d;s=(t=e*e*f+d)*this.e01+n*this.e11+a*this.e21,e=t*this.e02+n*this.e12+a*this.e22,i=t*this.e03+n*this.e13+a*this.e23,r=o*this.e00+h*this.e10+c*this.e20;var d=o*this.e01+h*this.e11+c*this.e21,f=o*this.e02+h*this.e12+c*this.e22,m=(o=o*this.e03+h*this.e13+c*this.e23,h=l*this.e00+u*this.e10+p*this.e20,c=l*this.e01+u*this.e11+p*this.e21,l*this.e02+u*this.e12+p*this.e22),g=(l=l*this.e03+u*this.e13+p*this.e23,u=this.e30,p=this.e31,this.e32),y=this.e33;return this.e00=t*this.e00+n*this.e10+a*this.e20,this.e01=s,this.e02=e,this.e03=i,this.e10=r,this.e11=d,this.e12=f,this.e13=o,this.e20=h,this.e21=c,this.e22=m,this.e23=l,this.e30=u,this.e31=p,this.e32=g,this.e33=y,this},vc:function(t,e,i,s){var r=Math.sin(t);t=e*e*(d=1-(p=Math.cos(t)))+p;var n=e*i*d-s*r,a=e*s*d+i*r,o=i*e*d+s*r,h=i*i*d+p,c=i*s*d-e*r,l=s*e*d-i*r;e=s*i*d+e*r;var u=s*s*d+p;s=this.e00*n+this.e01*h+this.e02*e,i=this.e00*a+this.e01*c+this.e02*u,r=this.e03;var p=this.e10*t+this.e11*o+this.e12*l,d=this.e10*n+this.e11*h+this.e12*e,f=this.e10*a+this.e11*c+this.e12*u,m=this.e13,g=this.e20*t+this.e21*o+this.e22*l,y=this.e20*n+this.e21*h+this.e22*e,v=this.e20*a+this.e21*c+this.e22*u,b=this.e23,x=this.e30*t+this.e31*o+this.e32*l;return n=this.e30*n+this.e31*h+this.e32*e,a=this.e30*a+this.e31*c+this.e32*u,c=this.e33,this.e00=this.e00*t+this.e01*o+this.e02*l,this.e01=s,this.e02=i,this.e03=r,this.e10=p,this.e11=d,this.e12=f,this.e13=m,this.e20=g,this.e21=y,this.e22=v,this.e23=b,this.e30=x,this.e31=n,this.e32=a,this.e33=c,this},li:function(t,e,i){var s=this.e01+t*this.e31,r=this.e02+t*this.e32,n=this.e03+t*this.e33,a=this.e10+e*this.e30,o=this.e11+e*this.e31,h=this.e12+e*this.e32;e=this.e13+e*this.e33;var c=this.e20+i*this.e30,l=this.e21+i*this.e31,u=this.e22+i*this.e32;i=this.e23+i*this.e33;var p=this.e30,d=this.e31,f=this.e32,m=this.e33;return this.e00+=t*this.e30,this.e01=s,this.e02=r,this.e03=n,this.e10=a,this.e11=o,this.e12=h,this.e13=e,this.e20=c,this.e21=l,this.e22=u,this.e23=i,this.e30=p,this.e31=d,this.e32=f,this.e33=m,this},cb:function(t,e,i){var s=this.e01,r=this.e02,n=this.e00*t+this.e01*e+this.e02*i+this.e03,a=this.e10,o=this.e11,h=this.e12,c=this.e10*t+this.e11*e+this.e12*i+this.e13,l=this.e20,u=this.e21,p=this.e22,d=this.e20*t+this.e21*e+this.e22*i+this.e23,f=this.e30,m=this.e31,g=this.e32;return t=this.e30*t+this.e31*e+this.e32*i+this.e33,this.e00=this.e00,this.e01=s,this.e02=r,this.e03=n,this.e10=a,this.e11=o,this.e12=h,this.e13=c,this.e20=l,this.e21=u,this.e22=p,this.e23=d,this.e30=f,this.e31=m,this.e32=g,this.e33=t,this},Wg:function(){return new pt(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)},Xg:function(){var t=this.e10,e=this.e20,i=this.e30,s=this.e01,r=this.e11,n=this.e21,a=this.e31,o=this.e02,h=this.e12,c=this.e22,l=this.e32,u=this.e03,p=this.e13,d=this.e23,f=this.e33;return this.e00=this.e00,this.e01=t,this.e02=e,this.e03=i,this.e10=s,this.e11=r,this.e12=n,this.e13=a,this.e20=o,this.e21=h,this.e22=c,this.e23=l,this.e30=u,this.e31=p,this.e32=d,this.e33=f,this},Jc:function(){var t=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,i=this.e20*this.e33-this.e23*this.e30,s=this.e21*this.e32-this.e22*this.e31,r=this.e21*this.e33-this.e23*this.e31,n=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*n-this.e12*r+this.e13*s)-this.e01*(this.e10*n-this.e12*i+this.e13*e)+this.e02*(this.e10*r-this.e11*i+this.e13*t)-this.e03*(this.e10*s-this.e11*e+this.e12*t)},Vg:function(){return this.e00+this.e11+this.e22+this.e33},Lc:function(){var t=this.e00*this.e11-this.e01*this.e10,e=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,s=this.e01*this.e12-this.e02*this.e11,r=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,a=this.e20*this.e31-this.e21*this.e30,o=this.e20*this.e32-this.e22*this.e30,h=this.e20*this.e33-this.e23*this.e30,c=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,p=this.e11*u-this.e12*l+this.e13*c,d=this.e10*u-this.e12*h+this.e13*o,f=this.e10*l-this.e11*h+this.e13*a,m=this.e10*c-this.e11*o+this.e12*a,g=this.e01*u-this.e02*l+this.e03*c,y=(u=this.e00*u-this.e02*h+this.e03*o,h=this.e00*l-this.e01*h+this.e03*a,a=this.e00*c-this.e01*o+this.e02*a,o=this.e31*n-this.e32*r+this.e33*s,c=this.e30*n-this.e32*i+this.e33*e,l=this.e30*r-this.e31*i+this.e33*t,this.e30*s-this.e31*e+this.e32*t),v=this.e21*n-this.e22*r+this.e23*s;return n=this.e20*n-this.e22*i+this.e23*e,i=this.e20*r-this.e21*i+this.e23*t,t=this.e20*s-this.e21*e+this.e22*t,(e=this.e00*p-this.e01*d+this.e02*f-this.e03*m)&&(e=1/e),new pt(p*e,-g*e,o*e,-v*e,-d*e,u*e,-c*e,n*e,f*e,-h*e,l*e,-i*e,-m*e,a*e,-y*e,t*e)},fd:function(){var t=this.e00*this.e11-this.e01*this.e10,e=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,s=this.e01*this.e12-this.e02*this.e11,r=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,a=this.e20*this.e31-this.e21*this.e30,o=this.e20*this.e32-this.e22*this.e30,h=this.e20*this.e33-this.e23*this.e30,c=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,p=this.e11*u-this.e12*l+this.e13*c,d=this.e10*u-this.e12*h+this.e13*o,f=this.e10*l-this.e11*h+this.e13*a,m=this.e10*c-this.e11*o+this.e12*a,g=this.e01*u-this.e02*l+this.e03*c,y=(u=this.e00*u-this.e02*h+this.e03*o,h=this.e00*l-this.e01*h+this.e03*a,a=this.e00*c-this.e01*o+this.e02*a,o=this.e31*n-this.e32*r+this.e33*s,c=this.e30*n-this.e32*i+this.e33*e,l=this.e30*r-this.e31*i+this.e33*t,this.e30*s-this.e31*e+this.e32*t),v=this.e21*n-this.e22*r+this.e23*s;return n=this.e20*n-this.e22*i+this.e23*e,i=this.e20*r-this.e21*i+this.e23*t,t=this.e20*s-this.e21*e+this.e22*t,(e=this.e00*p-this.e01*d+this.e02*f-this.e03*m)&&(e=1/e),this.e00=p*e,this.e01=-g*e,this.e02=o*e,this.e03=-v*e,this.e10=-d*e,this.e11=u*e,this.e12=-c*e,this.e13=n*e,this.e20=f*e,this.e21=-h*e,this.e22=l*e,this.e23=-i*e,this.e30=-m*e,this.e31=a*e,this.e32=-y*e,this.e33=t*e,this},Mb:function(t,e,i,s,r,n,a,o,h){s=t-s,r=e-r,n=i-n,s*=l=1/Math.sqrt(s*s+r*r+n*n);var c=o*(n*=l)-h*(r*=l);h=h*s-a*n,a=a*r-o*s,o=r*(a*=l=1/Math.sqrt(c*c+h*h+a*a))-n*(h*=l);var l=n*(c*=l)-s*a,u=s*h-r*c;return this.e00=c,this.e01=h,this.e02=a,this.e03=-(c*t+h*e+a*i),this.e10=o,this.e11=l,this.e12=u,this.e13=-(o*t+l*e+u*i),this.e20=s,this.e21=r,this.e22=n,this.e23=-(s*t+r*e+n*i),this.e32=this.e31=this.e30=0,this.e33=1,this},qe:function(t,e,i,s){return t=1/Math.tan(.5*t),s/=i-s,this.e00=t/e,this.e10=this.e03=this.e02=this.e01=0,this.e11=t,this.e21=this.e20=this.e13=this.e12=0,this.e22=s,this.e23=i*s,this.e31=this.e30=0,this.e32=-1,this.e33=0,this},ji:function(t,e,i,s){return s=1/(i-s),this.e00=2/t,this.e10=this.e03=this.e02=this.e01=0,this.e11=2/e,this.e21=this.e20=this.e13=this.e12=0,this.e22=s,this.e23=i*s,this.e32=this.e31=this.e30=0,this.e33=1,this},Ug:function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]},de:function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this},Kc:function(t){var e=t.e01,i=t.e02,s=t.e10,r=t.e11,n=t.e12,a=t.e20,o=t.e21,h=t.e22;return this.e00=t.e00,this.e01=e,this.e02=i,this.e03=0,this.e10=s,this.e11=r,this.e12=n,this.e13=0,this.e20=a,this.e21=o,this.e22=h,this.e32=this.e31=this.e30=this.e23=0,this.e33=1,this},Hb:function(t){return this.e00=t.o,this.e01=t.f,this.e02=t.h,this.e10=t.i,this.e11=t.m,this.e12=t.j,this.e20=t.l,this.e21=t.g,this.e22=t.s,this.e03=t.v,this.e13=t.A,this.e23=t.B,this.e32=this.e31=this.e30=0,this.e33=1,this},clone:function(){return new pt(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)},toString:function(){return"Mat4["+(0<this.e00?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(0<this.e01?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(0<this.e02?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(0<this.e03?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(0<this.e10?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(0<this.e11?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(0<this.e12?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(0<this.e13?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(0<this.e20?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(0<this.e21?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(0<this.e22?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(0<this.e23?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(0<this.e30?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(0<this.e31?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(0<this.e32?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(0<this.e33?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}},ut.abs=function(t){return 0<t?t:-t},ut.sin=function(t){return Math.sin(t)},ut.cos=function(t){return Math.cos(t)},ut.tan=function(t){return Math.tan(t)},ut.asin=function(t){return Math.asin(t)},ut.acos=function(t){return Math.acos(t)},ut.atan=function(t){return Math.atan(t)},ut.fd=function(t){return-1>=t?-1.570796326794895:1<=t?1.570796326794895:Math.asin(t)},ut.Lc=function(t){return-1>=t?3.14159265358979:1<=t?0:Math.acos(t)},ut.atan2=function(t,e){return Math.atan2(t,e)},ut.sqrt=function(t){return Math.sqrt(t)},ut.Hb=function(t,e,i){return t<e?e:t>i?i:t},ut.Ac=function(){return Math.random()},ut.Ec=function(t,e){return t+Math.random()*(e-t)},ut.Kc=function(t,e){return new bt(t+Math.random()*(e-t),t+Math.random()*(e-t),t+Math.random()*(e-t))},ut.Jc=function(){return new bt(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)},lt.prototype={Ac:function(){return 0==this.c?new bt:this.b[--this.c]},qc:function(){return 0==this.eb?new dt:this.bb[--this.eb]},uc:function(){return 0==this.dg?new pt:this.Lf[--this.dg]},vc:function(){return 0==this.ee?new ct:this.Wd[--this.ee]},ua:function(t,e,i,s){if(null!=t){if(t.Z(),this.c==this.b.length){for(var r=Array(this.c<<1),n=0,a=this.c;n<a;){var o=n++;r[o]=this.b[o],this.b[o]=null}this.b=r}this.b[this.c++]=t}if(null!=e){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,this.eb==this.bb.length){for(t=Array(this.eb<<1),r=0,n=this.eb;r<n;)t[a=r++]=this.bb[a],this.bb[a]=null;this.bb=t}this.bb[this.eb++]=e}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e03=0,i.e10=0,i.e11=1,i.e12=0,i.e13=0,i.e20=0,i.e21=0,i.e22=1,i.e23=0,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this.dg==this.Lf.length){for(e=Array(this.dg<<1),t=0,r=this.dg;t<r;)e[n=t++]=this.Lf[n],this.Lf[n]=null;this.Lf=e}this.Lf[this.dg++]=i}if(null!=s){if(s.x=0,s.y=0,s.z=0,s.w=1,this.ee==this.Wd.length){for(i=Array(this.ee<<1),e=0,t=this.ee;e<t;)i[r=e++]=this.Wd[r],this.Wd[r]=null;this.Wd=i}this.Wd[this.ee++]=s}},pc:function(t){if(t.Z(),this.c==this.b.length){for(var e=Array(this.c<<1),i=0,s=this.c;i<s;){var r=i++;e[r]=this.b[r],this.b[r]=null}this.b=e}this.b[this.c++]=t},cb:function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.eb==this.bb.length){for(var e=Array(this.eb<<1),i=0,s=this.eb;i<s;){var r=i++;e[r]=this.bb[r],this.bb[r]=null}this.bb=e}this.bb[this.eb++]=t},Hb:function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.dg==this.Lf.length){for(var e=Array(this.dg<<1),i=0,s=this.dg;i<s;){var r=i++;e[r]=this.Lf[r],this.Lf[r]=null}this.Lf=e}this.Lf[this.dg++]=t},Mb:function(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.ee==this.Wd.length){for(var e=Array(this.ee<<1),i=0,s=this.ee;i<s;){var r=i++;e[r]=this.Wd[r],this.Wd[r]=null}this.Wd=e}this.Wd[this.ee++]=t}},ct.prototype={Wf:function(){return this.z=this.y=this.x=0,this.w=1,this},za:function(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this},ua:function(t){return new ct(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},Ec:function(t){return new ct(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},vc:function(t){return new ct(this.x*t,this.y*t,this.z*t,this.w*t)},cb:function(t){var e=this.y+t.y,i=this.z+t.z,s=this.w+t.w;return this.x+=t.x,this.y=e,this.z=i,this.w=s,this},Jc:function(t){var e=this.y-t.y,i=this.z-t.z,s=this.w-t.w;return this.x=this.x-t.x,this.y=e,this.z=i,this.w=s,this},Ac:function(t){var e=this.y*t,i=this.z*t,s=this.w*t;return this.x=this.x*t,this.y=e,this.z=i,this.w=s,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},pc:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},Hb:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},uc:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0<t&&(t=1/t),new ct(this.x*t,this.y*t,this.z*t,this.w*t)},qc:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0<t&&(t=1/t);var e=this.y*t,i=this.z*t,s=this.w*t;return this.x=this.x*t,this.y=e,this.z=i,this.w=s,this},Kc:function(t,e){var i=t.x,s=t.y;t=t.z;var r,n=e.x,a=e.y;return e=e.z,this.w=Math.sqrt(.5*(i*n+s*a+t*e+1)),this.w?(r=.5/this.w,this.x=(s*e-t*a)*r,this.y=(t*n-i*e)*r,this.z=(i*a-s*n)*r,this):(e=t*t,(n=i*i)<(a=s*s)?n<e?(r=1/Math.sqrt(a+e),this.x=0,this.y=t*r,this.z=-s*r):(r=1/Math.sqrt(n+a),this.z=0,this.x=s*r,this.y=-i*r):a<e?(r=1/Math.sqrt(e+n),this.y=0,this.z=i*r,this.x=-t*r):(r=1/Math.sqrt(n+a),this.z=0,this.x=s*r,this.y=-i*r),this)},Lc:function(t,e){var i,s,r;if(0>(n=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w)?(n=-n,i=-t.x,s=-t.y,r=-t.z,t=-t.w):(i=t.x,s=t.y,r=t.z,t=t.w),.999999<n)return i=new ct(this.x+(i-this.x)*e,this.y+(s-this.y)*e,this.z+(r-this.z)*e,this.w+(t-this.w)*e),0<(s=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z+i.w*i.w))&&(s=1/s),r=i.y*s,t=i.z*s,n=i.w*s,i.x=i.x*s,i.y=r,i.z=t,i.w=n,i;e*=Math.acos(n),i-=this.x*n,s-=this.y*n,r-=this.z*n,t-=this.w*n;var n=1/Math.sqrt(i*i+s*s+r*r+t*t),a=Math.sin(e);return e=Math.cos(e),new ct(this.x*e+i*n*a,this.y*e+s*n*a,this.z*e+r*n*a,this.w*e+t*n*a)},de:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},clone:function(){return new ct(this.x,this.y,this.z,this.w)},Mb:function(t){var e=t.e00,i=t.e11,s=t.e22,r=e+i+s;return 0<r?(e=Math.sqrt(r+1),this.w=.5*e,e=.5/e,this.x=(t.e21-t.e12)*e,this.y=(t.e02-t.e20)*e,this.z=(t.e10-t.e01)*e):e>i?e>s?(e=Math.sqrt(e-i-s+1),this.x=.5*e,e=.5/e,this.y=(t.e01+t.e10)*e,this.z=(t.e02+t.e20)*e,this.w=(t.e21-t.e12)*e):(e=Math.sqrt(s-e-i+1),this.z=.5*e,e=.5/e,this.x=(t.e02+t.e20)*e,this.y=(t.e12+t.e21)*e,this.w=(t.e10-t.e01)*e):i>s?(e=Math.sqrt(i-s-e+1),this.y=.5*e,e=.5/e,this.x=(t.e01+t.e10)*e,this.z=(t.e12+t.e21)*e,this.w=(t.e02-t.e20)*e):(e=Math.sqrt(s-e-i+1),this.z=.5*e,e=.5/e,this.x=(t.e02+t.e20)*e,this.y=(t.e12+t.e21)*e,this.w=(t.e10-t.e01)*e),this},fd:function(){var t=new dt,e=this.x,i=this.y,s=2*(a=this.z),r=e*(h=2*e),n=i*(c=2*i),a=a*s,o=e*c,h=(i*=s,e*=s,(l=this.w)*h),c=l*c,l=l*s;return t.e00=1-n-a,t.e01=o-l,t.e02=e+c,t.e10=o+l,t.e11=1-r-a,t.e12=i-h,t.e20=e-c,t.e21=i+h,t.e22=1-r-n,t},toString:function(){return"Quat["+(0<this.x?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(0<this.y?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(0<this.z?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(0<this.w?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}},ht.prototype={hn:function(){if(null!=this.Lh){var t=this.Td,e=this.Ym;if(this.Lh.hm(e,this.Zb.Kb,this.$b.Kb,this.Zb.a,this.$b.a,this.$i),(this.Td=0<e.numPoints)?(this.Ja.Wm(e.normal),this.Ye.Hc=e.mm()>yt.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?yt.alternativeContactPositionCorrectionAlgorithm:yt.defaultContactPositionCorrectionAlgorithm,e.incremental?this.Zl.On(e,this.C.a,this.D.a):this.Zl.eo(e,this.C.a,this.D.a)):this.Ja.Xe(),this.Td&&!t){e=this.Zb.yd;var i=this.$b.yd;e==i&&(i=null),null!=e&&e.beginContact(this),null!=i&&i.beginContact(this)}!this.Td&&t&&((t=this.Zb.yd)==(e=this.$b.yd)&&(e=null),null!=t&&t.endContact(this),null!=e&&e.endContact(this)),this.Td&&((t=this.Zb.yd)==(e=this.$b.yd)&&(e=null),null!=t&&t.preSolve(this),null!=e&&e.preSolve(this))}},Vk:function(){var t=this.Zb.yd,e=this.$b.yd;t==e&&(e=null),null!=t&&t.postSolve(this),null!=e&&e.postSolve(this)},pc:function(){return this.Zb},qc:function(){return this.$b},sk:function(){return this.Td},cb:function(){return this.Ja},ua:function(){return this.Ye},Mb:function(){return this.ia},Hb:function(){return this.M}},ot.prototype={ua:function(){return this.Zd},Hb:function(){return this.Qc},Mb:function(){return this.ia},cb:function(){return this.M}},at.prototype={pn:function(){for(var t=this.jc.ce;null!=t;){for(var e=t.M;;){var i;if(t.mh.Cc<t.nh.Cc?(i=t.mh.userData,t=t.nh.userData):(i=t.nh.userData,t=t.mh.userData),!this.Gm(i,t))break;var s,r=i.Yb,n=t.Yb;s=r.Ae<n.Ae?r.Ob:n.Ob,r=i.Cc,n=t.Cc;for(var a=!1;null!=s;){var o=s.M;if((s=s.Zd).Zb.Cc==r&&s.$b.Cc==n){a=s.Zj=!0;break}s=o}a||(null!=(r=this.lg)?(this.lg=r.M,r.M=null):r=new ht,null==this.zd?this.zd=r:(this.ye.M=r,r.ia=this.ye),this.ye=r,r.Zj=!0,n=this.Xm.Jb[i.Kb.Lb][t.Kb.Lb],r.Zb=i,r.$b=t,r.C=i.Yb,r.D=t.Yb,r.Td=!1,null==r.C.Ob?r.C.Ob=r.rb:(r.C.kc.M=r.rb,r.rb.ia=r.C.kc),r.C.kc=r.rb,null==r.D.Ob?r.D.Ob=r.sb:(r.D.kc.M=r.sb,r.sb.ia=r.D.kc),r.D.kc=r.sb,r.C.Ae++,r.D.Ae++,r.rb.Qc=r.D,r.sb.Qc=r.C,r.rb.Zd=r,r.sb.Zd=r,r.Lh=n,(r=r.Ye).Zb=i,r.$b=t,r.C=r.Zb.Yb,r.D=r.$b.Yb,r.pj=r.C.a,r.qj=r.D.a,this.Bi++);break}t=e}},qn:function(){for(var t=this.jc.Yj,e=this.zd;null!=e;){for(var i=e.M;;){if(e.Zj){e.Zj=!1,e.ik=!1;break}if(!t){var s=e.ia,r=e.M;null!=s&&(s.M=r),null!=r&&(r.ia=s),e==this.zd&&(this.zd=this.zd.M),e==this.ye&&(this.ye=this.ye.ia),e.M=null,e.ia=null,e.Td&&((s=e.Zb.yd)==(r=e.$b.yd)&&(r=null),null!=s&&s.endContact(e),null!=r&&r.endContact(e)),s=e.rb.ia,r=e.rb.M,null!=s&&(s.M=r),null!=r&&(r.ia=s),e.rb==e.C.Ob&&(e.C.Ob=e.C.Ob.M),e.rb==e.C.kc&&(e.C.kc=e.C.kc.ia),e.rb.M=null,e.rb.ia=null,s=e.sb.ia,r=e.sb.M,null!=s&&(s.M=r),null!=r&&(r.ia=s),e.sb==e.D.Ob&&(e.D.Ob=e.D.Ob.M),e.sb==e.D.kc&&(e.D.kc=e.D.kc.ia),e.sb.M=null,e.sb.ia=null,e.C.Ae--,e.D.Ae--,e.rb.Qc=null,e.sb.Qc=null,e.rb.Zd=null,e.sb.Zd=null,e.Zb=null,e.$b=null,e.C=null,e.D=null,e.Td=!1,e.$i.Xe(),e.Ja.Xe(),e.Lh=null,(s=e.Ye).Zb=null,s.$b=null,s.C=null,s.D=null,s.pj=null,s.qj=null,e.M=this.lg,this.lg=e,this.Bi--;break}s=e.Zb,r=e.$b;var n=s.Yb,a=!(a=r.Yb).Gb&&1!=a.Lb;if((n.Gb||1==n.Lb)&&!a){e.ik=!0;break}n=s.u,a=r.u;var o=s.tb,h=r.tb;if(!(o.J<h.G&&o.G>h.J&&o.K<h.H&&o.H>h.K&&o.L<h.I&&o.I>h.L&&this.Gm(s,r))){s=e.ia,r=e.M,null!=s&&(s.M=r),null!=r&&(r.ia=s),e==this.zd&&(this.zd=this.zd.M),e==this.ye&&(this.ye=this.ye.ia),e.M=null,e.ia=null,e.Td&&((s=e.Zb.yd)==(r=e.$b.yd)&&(r=null),null!=s&&s.endContact(e),null!=r&&r.endContact(e)),s=e.rb.ia,r=e.rb.M,null!=s&&(s.M=r),null!=r&&(r.ia=s),e.rb==e.C.Ob&&(e.C.Ob=e.C.Ob.M),e.rb==e.C.kc&&(e.C.kc=e.C.kc.ia),e.rb.M=null,e.rb.ia=null,s=e.sb.ia,r=e.sb.M,null!=s&&(s.M=r),null!=r&&(r.ia=s),e.sb==e.D.Ob&&(e.D.Ob=e.D.Ob.M),e.sb==e.D.kc&&(e.D.kc=e.D.kc.ia),e.sb.M=null,e.sb.ia=null,e.C.Ae--,e.D.Ae--,e.rb.Qc=null,e.sb.Qc=null,e.rb.Zd=null,e.sb.Zd=null,e.Zb=null,e.$b=null,e.C=null,e.D=null,e.Td=!1,e.$i.Xe(),e.Ja.Xe(),e.Lh=null,(s=e.Ye).Zb=null,s.$b=null,s.C=null,s.D=null,s.pj=null,s.qj=null,e.M=this.lg,this.lg=e,this.Bi--;break}e.ik=!(n.ma<a.ja&&n.ja>a.ma&&n.na<a.ka&&n.ka>a.na&&n.oa<a.la&&n.la>a.oa);break}e=i}},Gm:function(t,e){var i=t.Yb,s=e.Yb;if(i==s||0!=i.Lb&&0!=s.Lb||!(t.Tj&e.Uj&&e.Tj&t.Uj))return!1;for(i.kh<s.kh?(t=i.ze,i=s):t=s.ze;null!=t;){if(t.Qc==i&&!t.Pk.Ak)return!1;t=t.M}return!0},gl:function(){this.jc.Ii(),this.pn(),this.qn()},Vk:function(){for(var t=this.zd;null!=t;){var e=t.M;t.Td&&t.Vk(),t=e}},cb:function(){return this.Bi},ua:function(){return this.zd}},nt.prototype={Xe:function(){for(;0<this.Hf;)this.Jf[--this.Hf]=null;for(;0<this.If;)this.Kf[--this.If]=null;for(;0<this.wh;)this.Eh[--this.wh]=null;for(;0<this.vh;)this.Dh[--this.vh]=null},zk:function(t){if(this.Hf==this.Jf.length){for(var e=Array(this.Hf<<1),i=0,s=this.Hf;i<s;){var r=i++;e[r]=this.Jf[r],this.Jf[r]=null}this.Jf=e}t.Nf=!0,this.Jf[this.Hf++]=t},Ol:function(t,e){if(this.If==this.Kf.length){for(var i=Array(this.If<<1),s=0,r=this.If;s<r;){var n=s++;i[n]=this.Kf[n],this.Kf[n]=null}this.Kf=i}if(t.Nf=!0,this.Kf[this.If++]=t,e==$.SPLIT_IMPULSE){if(this.wh==this.Eh.length){for(i=Array(this.wh<<1),s=0,r=this.wh;s<r;)i[n=s++]=this.Eh[n],this.Eh[n]=null;this.Eh=i}this.Eh[this.wh++]=t}if(e==$.NGS){if(this.vh==this.Dh.length){for(e=Array(this.vh<<1),i=0,s=this.vh;i<s;)e[r=i++]=this.Dh[r],this.Dh[r]=null;this.Dh=e}this.Dh[this.vh++]=t}},gn:function(t,e){t=t.dt;var i=e.pa,s=e.a;if(i.v=s.v,i.A=s.A,i.B=s.B,i.o=s.o,i.f=s.f,i.h=s.h,i.i=s.i,i.m=s.m,i.j=s.j,i.l=s.l,i.g=s.g,i.s=s.s,e.Bk&&e.gb*e.gb+e.hb*e.hb+e.ib*e.ib<yt.sleepingVelocityThreshold*yt.sleepingVelocityThreshold&&e.kb*e.kb+e.lb*e.lb+e.mb*e.mb<yt.sleepingAngularVelocityThreshold*yt.sleepingAngularVelocityThreshold?(e.yb+=t,e.yb>yt.sleepingTimeThreshold&&(e.Gb=!0,e.yb=0)):e.yb=0,!e.Gb){if(0==e.Lb){i=1/(1+(i=t*e.$j)+(s=i*i)*(.5+.16666666666666666*i+.041666666666666664*s)),s=1/(1+(s=t*e.Qj)+(c=s*s)*(.5+.16666666666666666*s+.041666666666666664*c));var r,n,a,o,h,c=this.nm*e.eh;r=this.om*e.eh,n=this.pm*e.eh,c+=e.Mh*e.$a,r+=e.Nh*e.$a,n+=e.Oh*e.$a,o=e.P*e.vf+e.R*e.wf+e.S*e.xf,h=e.T*e.vf+e.U*e.wf+e.V*e.xf,a=e.W*e.vf+e.X*e.wf+e.Y*e.xf,e.gb+=c*t,e.hb+=r*t,e.ib+=n*t,e.gb*=i,e.hb*=i,e.ib*=i,e.kb+=o*t,e.lb+=h*t,e.mb+=a*t,e.kb*=s,e.lb*=s,e.mb*=s}for(e.Wl(t),t=e.Dc;null!=t;){var l,u,p,d,f;i=t.M,s=t.pa,r=t.ha,n=(c=e.pa).o*r.o+c.f*r.i+c.h*r.l,a=c.o*r.f+c.f*r.m+c.h*r.g,o=c.o*r.h+c.f*r.j+c.h*r.s,h=c.i*r.o+c.m*r.i+c.j*r.l,l=c.i*r.f+c.m*r.m+c.j*r.g,u=c.i*r.h+c.m*r.j+c.j*r.s,p=c.l*r.o+c.g*r.i+c.s*r.l,d=c.l*r.f+c.g*r.m+c.s*r.g,f=c.l*r.h+c.g*r.j+c.s*r.s,s.o=n,s.f=a,s.h=o,s.i=h,s.m=l,s.j=u,s.l=p,s.g=d,s.s=f,n=c.o*r.v+c.f*r.A+c.h*r.B,a=c.i*r.v+c.m*r.A+c.j*r.B,r=c.l*r.v+c.g*r.A+c.s*r.B,s.v=n,s.A=a,s.B=r,s.v+=c.v,s.A+=c.A,s.B+=c.B,s=t.a,r=t.ha,n=(c=e.a).o*r.o+c.f*r.i+c.h*r.l,a=c.o*r.f+c.f*r.m+c.h*r.g,o=c.o*r.h+c.f*r.j+c.h*r.s,h=c.i*r.o+c.m*r.i+c.j*r.l,l=c.i*r.f+c.m*r.m+c.j*r.g,u=c.i*r.h+c.m*r.j+c.j*r.s,p=c.l*r.o+c.g*r.i+c.s*r.l,d=c.l*r.f+c.g*r.m+c.s*r.g,f=c.l*r.h+c.g*r.j+c.s*r.s,s.o=n,s.f=a,s.h=o,s.i=h,s.m=l,s.j=u,s.l=p,s.g=d,s.s=f,n=c.o*r.v+c.f*r.A+c.h*r.B,a=c.i*r.v+c.m*r.A+c.j*r.B,r=c.l*r.v+c.g*r.A+c.s*r.B,s.v=n,s.A=a,s.B=r,s.v+=c.v,s.A+=c.A,s.B+=c.B,t.Kb.Nb(t.u,t.pa),s=t.u.ma,c=t.u.na,r=t.u.oa,n=t.u.ja,a=t.u.ka,o=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=s<t.u.ma?s:t.u.ma,t.u.na=c<t.u.na?c:t.u.na,t.u.oa=r<t.u.oa?r:t.u.oa,t.u.ja=n>t.u.ja?n:t.u.ja,t.u.ka=a>t.u.ka?a:t.u.ka,t.u.la=o>t.u.la?o:t.u.la,null!=t.tb&&(s=t.a.v-t.pa.v,c=t.a.A-t.pa.A,r=t.a.B-t.pa.B,(n=t.rc).x=s,n.y=c,n.z=r,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=i}}},fn:function(t,e,i){for(var s=t.dt,r=!0,n=0,a=this.Hf;n<a;){var o=n++,h=this.Jf[o],c=h.pa,l=h.a;if(c.v=l.v,c.A=l.A,c.B=l.B,c.o=l.o,c.f=l.f,c.h=l.h,c.i=l.i,c.m=l.m,c.j=l.j,c.l=l.l,c.g=l.g,c.s=l.s,h.Gb=!1,h.Bk&&h.gb*h.gb+h.hb*h.hb+h.ib*h.ib<yt.sleepingVelocityThreshold*yt.sleepingVelocityThreshold&&h.kb*h.kb+h.lb*h.lb+h.mb*h.mb<yt.sleepingAngularVelocityThreshold*yt.sleepingAngularVelocityThreshold?h.yb+=s:h.yb=0,h.yb<yt.sleepingTimeThreshold&&(r=!1),0==h.Lb){var u,p,d,f,m,g,y=s*h.$j,v=y*y,b=1/(1+y+v*(.5+.16666666666666666*y+.041666666666666664*v)),x=s*h.Qj,_=x*x,M=1/(1+x+_*(.5+.16666666666666666*x+.041666666666666664*_));u=this.nm*h.eh,p=this.om*h.eh,d=this.pm*h.eh,u+=h.Mh*h.$a,p+=h.Nh*h.$a,d+=h.Oh*h.$a,f=h.P*h.vf+h.R*h.wf+h.S*h.xf,m=h.T*h.vf+h.U*h.wf+h.V*h.xf,g=h.W*h.vf+h.X*h.wf+h.Y*h.xf,h.gb+=u*s,h.hb+=p*s,h.ib+=d*s,h.gb*=b,h.hb*=b,h.ib*=b,h.kb+=f*s,h.lb+=m*s,h.mb+=g*s,h.kb*=M,h.lb*=M,h.mb*=M}}if(r)for(var w=0,S=this.Hf;w<S;){var A=w++,T=this.Jf[A];T.Gb=!0,T.yb=0}else{for(var C=0,L=this.If;C<L;){var E=C++;this.Kf[E].xh(t)}for(var z=0,R=this.If;z<R;){var B=z++;this.Kf[B].Gh(t)}for(var P=0;P<e;){P++;for(var D=0,I=this.If;D<I;){var O=D++;this.Kf[O].Ch()}}for(var F=0,G=this.If;F<G;){var N=F++;this.Kf[N].Li(t)}for(var j=0,V=this.Hf;j<V;){var U=j++;this.Jf[U].Wl(s)}for(var k=0,H=this.wh;k<H;){var W=k++;this.Eh[W].Pg(t)}for(var q=0;q<i;){q++;for(var $=0,J=this.wh;$<J;){var X=$++;this.Eh[X].Bh()}}for(var Y=0,K=this.Hf;Y<K;){var Z=Y++;this.Jf[Z].dn()}for(var Q=0,tt=this.vh;Q<tt;){var et=Q++;this.Dh[et].Pg(t)}for(var it=0;it<i;){it++;for(var st=0,rt=this.vh;st<rt;){var nt=st++;this.Dh[nt].Ah(t)}}for(var at=0,ot=this.If;at<ot;){var ht=at++;this.Kf[ht].postSolve()}for(var ct=0,lt=this.Hf;ct<lt;)for(var ut=ct++,pt=this.Jf[ut],dt=pt.Dc;null!=dt;){var ft,mt,gt,vt,bt,xt,_t,Mt,wt,St,At,Tt,Ct=dt.M,Lt=dt.pa,Et=dt.ha,zt=pt.pa;ft=zt.o*Et.o+zt.f*Et.i+zt.h*Et.l,mt=zt.o*Et.f+zt.f*Et.m+zt.h*Et.g,gt=zt.o*Et.h+zt.f*Et.j+zt.h*Et.s,vt=zt.i*Et.o+zt.m*Et.i+zt.j*Et.l,bt=zt.i*Et.f+zt.m*Et.m+zt.j*Et.g,xt=zt.i*Et.h+zt.m*Et.j+zt.j*Et.s,_t=zt.l*Et.o+zt.g*Et.i+zt.s*Et.l,Mt=zt.l*Et.f+zt.g*Et.m+zt.s*Et.g,wt=zt.l*Et.h+zt.g*Et.j+zt.s*Et.s,Lt.o=ft,Lt.f=mt,Lt.h=gt,Lt.i=vt,Lt.m=bt,Lt.j=xt,Lt.l=_t,Lt.g=Mt,Lt.s=wt,St=zt.o*Et.v+zt.f*Et.A+zt.h*Et.B,At=zt.i*Et.v+zt.m*Et.A+zt.j*Et.B,Tt=zt.l*Et.v+zt.g*Et.A+zt.s*Et.B,Lt.v=St,Lt.A=At,Lt.B=Tt,Lt.v+=zt.v,Lt.A+=zt.A,Lt.B+=zt.B;var Rt,Bt,Pt,Dt,It,Ot,Ft,Gt,Nt,jt,Vt,Ut,kt,Ht,Wt,qt,$t,Jt,Xt=dt.a,Yt=dt.ha,Kt=pt.a;if(Rt=Kt.o*Yt.o+Kt.f*Yt.i+Kt.h*Yt.l,Bt=Kt.o*Yt.f+Kt.f*Yt.m+Kt.h*Yt.g,Pt=Kt.o*Yt.h+Kt.f*Yt.j+Kt.h*Yt.s,Dt=Kt.i*Yt.o+Kt.m*Yt.i+Kt.j*Yt.l,It=Kt.i*Yt.f+Kt.m*Yt.m+Kt.j*Yt.g,Ot=Kt.i*Yt.h+Kt.m*Yt.j+Kt.j*Yt.s,Ft=Kt.l*Yt.o+Kt.g*Yt.i+Kt.s*Yt.l,Gt=Kt.l*Yt.f+Kt.g*Yt.m+Kt.s*Yt.g,Nt=Kt.l*Yt.h+Kt.g*Yt.j+Kt.s*Yt.s,Xt.o=Rt,Xt.f=Bt,Xt.h=Pt,Xt.i=Dt,Xt.m=It,Xt.j=Ot,Xt.l=Ft,Xt.g=Gt,Xt.s=Nt,jt=Kt.o*Yt.v+Kt.f*Yt.A+Kt.h*Yt.B,Vt=Kt.i*Yt.v+Kt.m*Yt.A+Kt.j*Yt.B,Ut=Kt.l*Yt.v+Kt.g*Yt.A+Kt.s*Yt.B,Xt.v=jt,Xt.A=Vt,Xt.B=Ut,Xt.v+=Kt.v,Xt.A+=Kt.A,Xt.B+=Kt.B,dt.Kb.Nb(dt.u,dt.pa),kt=dt.u.ma,Ht=dt.u.na,Wt=dt.u.oa,qt=dt.u.ja,$t=dt.u.ka,Jt=dt.u.la,dt.Kb.Nb(dt.u,dt.a),dt.u.ma=kt<dt.u.ma?kt:dt.u.ma,dt.u.na=Ht<dt.u.na?Ht:dt.u.na,dt.u.oa=Wt<dt.u.oa?Wt:dt.u.oa,dt.u.ja=qt>dt.u.ja?qt:dt.u.ja,dt.u.ka=$t>dt.u.ka?$t:dt.u.ka,dt.u.la=Jt>dt.u.la?Jt:dt.u.la,null!=dt.tb){var Zt,Qt,te;Zt=dt.a.v-dt.pa.v,Qt=dt.a.A-dt.pa.A,te=dt.a.B-dt.pa.B;var ee=dt.rc;ee.x=Zt,ee.y=Qt,ee.z=te,dt.Yb.oc.jc.wd(dt.tb,dt.u,dt.rc)}dt=Ct}}}},st.prototype={gl:function(){var t=(new Date).getTime()/1e3;this.Kh.gl(),X.broadPhaseCollisionTime=1e3*((new Date).getTime()/1e3-t),t=(new Date).getTime()/1e3;for(var e=this.Kh.zd;null!=e;){var i=e.M;e.ik||e.hn(),e=i}X.narrowPhaseCollisionTime=1e3*((new Date).getTime()/1e3-t)},en:function(){var t=(new Date).getTime()/1e3;if(yt.disableSleeping)for(var e=this.uf;null!=e;){var i=e.M;e.Gb=!1,e.yb=0,e=i}if(this.ph.length<this.jj){for(e=this.ph.length<<1;e<this.jj;)e<<=1;this.ph=Array(e)}for(this.ek=0,e=this.vg,i=this.Fk,e.nm=i.x,e.om=i.y,e.pm=i.z,e=this.uf,this.tf=0;null!=e;){for(i=e.M;!e.Nf&&!e.Gb&&1!=e.Lb;){if(0==e.Ae&&0==e.kh){this.vg.gn(this.Sh,e),this.ek++;break}this.kn(e),this.vg.fn(this.Sh,this.Uk,this.Tk),this.vg.Xe(),this.ek++;break}e=i}for(this.Kh.Vk(),e=this.uf;null!=e;)i=e.M,e.Nf=!1,e=i;for(e=this.uf;null!=e;)i=e.M,e.Mh=0,e.Nh=0,e.Oh=0,e.vf=0,e.wf=0,e.xf=0,e=i;for(;0<this.tf;)this.af[--this.tf].Nf=!1,this.af[this.tf]=null;X.dynamicsTime=1e3*((new Date).getTime()/1e3-t)},kn:function(t){var e=1;for(this.vg.zk(t),this.ph[0]=t;0<e;)if(t=this.ph[--e],this.ph[e]=null,1!=t.Lb){for(var i=t.Ob;null!=i;){var s=i.M,r=i.Zd.Ye,n=i.Zd.Ye.jk;if(r.sk()&&!n.Nf){if(this.af.length==this.tf){for(var a=Array(this.tf<<1),o=0,h=this.tf;o<h;){var c=o++;a[c]=this.af[c],this.af[c]=null}this.af=a}this.af[this.tf++]=n,this.vg.Ol(n,r.Hc),(i=i.Qc).Nf||(this.vg.zk(i),this.ph[e++]=i)}i=s}for(s=t.ze;null!=s;){if(t=s.M,!(r=(i=s.Pk).jk).Nf){if(this.af.length==this.tf){for(n=Array(this.tf<<1),a=0,o=this.tf;a<o;)n[h=a++]=this.af[h],this.af[h]=null;this.af=n}this.af[this.tf++]=r,this.vg.Ol(r,i.Hc),(s=s.Qc).Nf||(this.vg.zk(s),this.ph[e++]=s)}s=t}}},pe:function(t){0<this.Sh.dt&&(this.Sh.dtRatio=t/this.Sh.dt),this.Sh.dt=t,this.Sh.invDt=1/t,t=(new Date).getTime()/1e3,this.gl(),this.en(),X.totalTime=1e3*((new Date).getTime()/1e3-t)},cb:function(t){if(null!=t.oc)throw Error("A rigid body cannot belong to multiple worlds.");for(null==this.uf?this.uf=t:(this.Ei.M=t,t.ia=this.Ei),this.Ei=t,t.oc=this,t=t.Dc;null!=t;){var e=t.M;t.tb=this.jc.Vh(t,t.u),t.Cc=this.Xl++,this.zg++,t=e}this.jj++},qe:function(t){if(t.oc!=this)throw Error("The rigid body doesn't belong to the world.");var e=t.ia,i=t.M;for(null!=e&&(e.M=i),null!=i&&(i.ia=e),t==this.uf&&(this.uf=this.uf.M),t==this.Ei&&(this.Ei=this.Ei.ia),t.M=null,t.ia=null,t.oc=null,t=t.Dc;null!=t;){e=t.M,this.jc.Wh(t.tb),t.tb=null,t.Cc=-1;for(var s=t.Yb.Ob;null!=s;){i=s.M;var r=s.Zd;if(r.Zb==t||r.$b==t){(s=s.Qc).Gb=!1,s.yb=0,s=this.Kh;var n=r.ia,a=r.M;null!=n&&(n.M=a),null!=a&&(a.ia=n),r==s.zd&&(s.zd=s.zd.M),r==s.ye&&(s.ye=s.ye.ia),r.M=null,r.ia=null,r.Td&&((n=r.Zb.yd)==(a=r.$b.yd)&&(a=null),null!=n&&n.endContact(r),null!=a&&a.endContact(r)),n=r.rb.ia,a=r.rb.M,null!=n&&(n.M=a),null!=a&&(a.ia=n),r.rb==r.C.Ob&&(r.C.Ob=r.C.Ob.M),r.rb==r.C.kc&&(r.C.kc=r.C.kc.ia),r.rb.M=null,r.rb.ia=null,n=r.sb.ia,a=r.sb.M,null!=n&&(n.M=a),null!=a&&(a.ia=n),r.sb==r.D.Ob&&(r.D.Ob=r.D.Ob.M),r.sb==r.D.kc&&(r.D.kc=r.D.kc.ia),r.sb.M=null,r.sb.ia=null,r.C.Ae--,r.D.Ae--,r.rb.Qc=null,r.sb.Qc=null,r.rb.Zd=null,r.sb.Zd=null,r.Zb=null,r.$b=null,r.C=null,r.D=null,r.Td=!1,r.$i.Xe(),r.Ja.Xe(),r.Lh=null,(n=r.Ye).Zb=null,n.$b=null,n.C=null,n.D=null,n.pj=null,n.qj=null,r.M=s.lg,s.lg=r,s.Bi--}s=i}this.zg--,t=e}this.jj--},ua:function(t){if(null!=t.oc)throw Error("A joint cannot belong to multiple worlds.");null==this.Ph?this.Ph=t:(this.zi.M=t,t.ia=this.zi),this.zi=t,t.oc=this,t.rb.Qc=t.D,t.sb.Qc=t.C,null==t.C.ze?t.C.ze=t.rb:(t.C.Ze.M=t.rb,t.rb.ia=t.C.Ze),t.C.Ze=t.rb,null==t.D.ze?t.D.ze=t.sb:(t.D.Ze.M=t.sb,t.sb.ia=t.D.Ze),t.D.Ze=t.sb,t.C.kh++,t.D.kh++;var e=t.C;e.Gb=!1,e.yb=0,(e=t.D).Gb=!1,e.yb=0,t.hd(),this.Sk++},Kl:function(t){if(t.oc!=this)throw Error("The joint doesn't belong to the world.");var e=t.ia,i=t.M;null!=e&&(e.M=i),null!=i&&(i.ia=e),t==this.Ph&&(this.Ph=this.Ph.M),t==this.zi&&(this.zi=this.zi.ia),t.M=null,t.ia=null,t.oc=null,e=t.rb.ia,i=t.rb.M,null!=e&&(e.M=i),null!=i&&(i.ia=e),t.rb==t.C.ze&&(t.C.ze=t.C.ze.M),t.rb==t.C.Ze&&(t.C.Ze=t.C.Ze.ia),t.rb.M=null,t.rb.ia=null,e=t.sb.ia,i=t.sb.M,null!=e&&(e.M=i),null!=i&&(i.ia=e),t.sb==t.D.ze&&(t.D.ze=t.D.ze.M),t.sb==t.D.Ze&&(t.D.Ze=t.D.Ze.ia),t.sb.M=null,t.sb.ia=null,t.rb.Qc=null,t.sb.Qc=null,t.C.kh--,t.D.kh--,(e=t.C).Gb=!1,e.yb=0,(t=t.D).Gb=!1,t.yb=0,this.Sk--},Hb:function(){null!=this.ni&&(2==this.jc.Lb&&this.Zm(this.ni,this.jc.ge),this.bn(this.ni),this.$m(this.ni))},Vd:function(t,e,i){var s=this.gk.vj;s.x=t.x,s.y=t.y,s.z=t.z,(s=this.gk.end).x=e.x,s.y=e.y,s.z=e.z,this.gk.xj=i,this.jc.Vd(t,e,this.gk)},Bf:function(t,e,i,s){this.aj.em=t;var r=this.aj.vj;r.v=e.v,r.A=e.A,r.B=e.B,r.o=e.o,r.f=e.f,r.h=e.h,r.i=e.i,r.m=e.m,r.j=e.j,r.l=e.l,r.g=e.g,r.s=e.s,(r=this.aj.eg).x=i.x,r.y=i.y,r.z=i.z,this.aj.xj=s,this.jc.Bf(t,e,i,this.aj)},qh:function(t,e){this.yk.u.de(t),this.yk.Ql=e,this.jc.qh(t,this.yk)},fd:function(){return this.uf},vc:function(){return this.Ph},Mb:function(){return this.jc},pc:function(){return this.Kh},Kc:function(){return this.jj},Ec:function(){return this.Sk},Yd:function(){return this.zg},Ac:function(){return this.ek},Lc:function(){return this.Uk},ue:function(t){this.Uk=t},Jc:function(){return this.Tk},te:function(t){this.Tk=t},uc:function(){return this.Fk},se:function(t){var e=this.Fk;e.x=t.x,e.y=t.y,e.z=t.z}},it.ua=ee,it.prototype=oe(ee.prototype,{process:function(t){(t=t.userData).Kb.Vd(this.vj,this.end,t.a,this.Mi)&&this.xj.process(t,this.Mi)}}),et.ua=ee,et.prototype=oe(ee.prototype,{process:function(t){var e=(t=t.userData).Kb.Lb;0>e||5<e||gt.cb.Bf(this.em,t.Kb,this.vj,t.a,this.eg,this.Z,this.Mi)&&this.xj.process(t,this.Mi)}}),tt.ua=ee,tt.prototype=oe(ee.prototype,{process:function(t){var e=(t=t.userData).u;e.ma<this.u.ja&&e.ja>this.u.ma&&e.na<this.u.ka&&e.ka>this.u.na&&e.oa<this.u.la&&e.la>this.u.oa&&this.Ql.process(t)}}),Q.prototype={process:function(){}},Z.prototype={beginContact:function(){},preSolve:function(){},postSolve:function(){},endContact:function(){}},K.prototype={process:function(){}},Y.ua=K,Y.prototype=oe(K.prototype,{clear:function(){this.shape=null,this.fraction=1,this.position.Z(),this.normal.Z(),this.hit=!1},process:function(t,e){if(e.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=e.fraction,t=this.position;var i=e.position;t.x=i.x,t.y=i.y,t.z=i.z,t=this.normal,e=e.normal,t.x=e.x,t.y=e.y,t.z=e.z}}}),J.prototype={xh:function(){},Gh:function(){},Ch:function(){},Li:function(){},Pg:function(){},Bh:function(){},Ah:function(){},postSolve:function(){}},q.prototype={$d:function(t,e){var i,s,r,n,a,o,h,c,l;e.Qe=this.C,e.Re=this.D,i=this.Ja.wg,s=this.Ja.xg,r=this.Ja.yg,n=this.Ja.lj,a=this.Ja.mj,o=this.Ja.nj,h=this.Ja.Vi,c=this.Ja.Wi,l=this.Ja.Xi;for(var u=Math.sqrt(this.Zb.Xj*this.$b.Xj),p=Math.sqrt(this.Zb.hk*this.$b.hk),d=this.Ja.be,f=e.Ka=0;f<d;){var m=f++;if(0>(m=this.Ja.wc[m]).Gc)m.lf=!0,(m=m.ae).bd=0,m.zc=0,m.yc=0,m.ub=0,m.df=0,m.ef=0,m.ff=0;else{m.lf=!1;var g=e.rows[e.Ka++];g.friction=u,g.Ma=0;var y=g.Ng;y.va=i,y.wa=s,y.xa=r,y.Ba=i,y.Ca=s,y.Da=r,y.aa=m.Eb*r-m.Fb*s,y.ba=m.Fb*i-m.Db*r,y.ca=m.Db*s-m.Eb*i,y.ea=m.fc*r-m.gc*s,y.fa=m.gc*i-m.ec*r,y.ga=m.ec*s-m.fc*i,(y=g.Lj).va=n,y.wa=a,y.xa=o,y.Ba=n,y.Ca=a,y.Da=o,y.aa=m.Eb*o-m.Fb*a,y.ba=m.Fb*n-m.Db*o,y.ca=m.Db*a-m.Eb*n,y.ea=m.fc*o-m.gc*a,y.fa=m.gc*n-m.ec*o,y.ga=m.ec*a-m.fc*n,(y=g.Kj).va=h,y.wa=c,y.xa=l,y.Ba=h,y.Ca=c,y.Da=l,y.aa=m.Eb*l-m.Fb*c,y.ba=m.Fb*h-m.Db*l,y.ca=m.Db*c-m.Eb*h,y.ea=m.fc*l-m.gc*c,y.fa=m.gc*h-m.ec*l,y.ga=m.ec*c-m.fc*h,y=(y=g.Ng).va*this.C.gb+y.wa*this.C.hb+y.xa*this.C.ib+(y.aa*this.C.kb+y.ba*this.C.lb+y.ca*this.C.mb)-(y.Ba*this.D.gb+y.Ca*this.D.hb+y.Da*this.D.ib+(y.ea*this.D.kb+y.fa*this.D.lb+y.ga*this.D.mb)),g.Fa=y<-yt.contactEnableBounceThreshold&&!m.Pe?-y*p:0,this.Hc==$.BAUMGARTE&&m.Gc>yt.linearSlop&&(y=(m.Gc-yt.linearSlop)*yt.velocityBaumgarte*t.invDt,g.Fa<y&&(g.Fa=y)),m.Pe||((y=m.ae).bd=0,y.zc=0,y.yc=0,y.ub=0,y.df=0,y.ef=0,y.ff=0),g.ta=m.ae}}},gd:function(t){var e,i,s;t.Qe=this.C,t.Re=this.D,e=this.Ja.wg,i=this.Ja.xg,s=this.Ja.yg;for(var r=this.Ja.be,n=t.Ka=0;n<r;){var a=n++;if(!(a=this.Ja.wc[a]).lf){var o=t.rows[t.Ka++],h=o.Ng;h.va=e,h.wa=i,h.xa=s,h.Ba=e,h.Ca=i,h.Da=s,h.aa=a.Eb*s-a.Fb*i,h.ba=a.Fb*e-a.Db*s,h.ca=a.Db*i-a.Eb*e,h.ea=a.fc*s-a.gc*i,h.fa=a.gc*e-a.ec*s,h.ga=a.ec*i-a.fc*e,o.Fa=a.Gc-yt.linearSlop,0>o.Fa&&(o.Fa=0),o.ta=a.ae}}},al:function(){this.Ja.Yl(this.pj,this.qj)},cb:function(){return this.Zb},Hb:function(){return this.$b},ua:function(){return this.Ja},sk:function(){for(var t=0,e=this.Ja.be;t<e;){var i=t++;if(0<=this.Ja.wc[i].Gc)return!0}return!1}},W.prototype={de:function(t){this.bd=t.bd,this.zc=t.zc,this.yc=t.yc,this.df=t.df,this.ef=t.ef,this.ff=t.ff}},H.prototype={Xe:function(){for(var t=0,e=this.be;t<e;){var i=t++;(i=this.wc[i]).mf=0,i.nf=0,i.pf=0,i.qf=0,i.rf=0,i.sf=0,i.Db=0,i.Eb=0,i.Fb=0,i.ec=0,i.fc=0,i.gc=0,i.Jd=0,i.Kd=0,i.Ld=0,i.Md=0,i.Nd=0,i.Od=0,i.Gc=0;var s=i.ae;s.bd=0,s.zc=0,s.yc=0,s.ub=0,s.df=0,s.ef=0,s.ff=0,i.Pe=!1,i.lf=!1,i.Cc=-1}this.be=0},Wm:function(t){this.wg=t.x,this.xg=t.y,this.yg=t.z;var e,i=t.x,s=t.y,r=i*i,n=s*s,a=(t=t.z)*t;r<n?r<a?(r=0,n=-t*(a=1/Math.sqrt(n+a)),e=s*(a*=s)-t*n,t=-i*a,i*=n):(r=-s*(n=1/Math.sqrt(r+n)),a=0,e=-t*(n*=i),t*=r,i=i*n-s*r):n<a?(r=t*(a=1/Math.sqrt(r+a)),n=0,e=s*(a*=-i),t=t*r-i*a,i=-s*r):(r=-s*(n=1/Math.sqrt(r+n)),a=0,e=-t*(n*=i),t*=r,i=i*n-s*r),this.lj=r,this.mj=n,this.nj=a,this.Vi=e,this.Wi=t,this.Xi=i},Yl:function(t,e){for(var i=0,s=this.be;i<s;){var r,n,a,o=i++;o=this.wc[o],r=t.o*o.mf+t.f*o.nf+t.h*o.pf,n=t.i*o.mf+t.m*o.nf+t.j*o.pf,a=t.l*o.mf+t.g*o.nf+t.s*o.pf,o.Db=r,o.Eb=n,o.Fb=a,r=e.o*o.qf+e.f*o.rf+e.h*o.sf,n=e.i*o.qf+e.m*o.rf+e.j*o.sf,a=e.l*o.qf+e.g*o.rf+e.s*o.sf,o.ec=r,o.fc=n,o.gc=a,o.Jd=o.Db+t.v,o.Kd=o.Eb+t.A,o.Ld=o.Fb+t.B,o.Md=o.ec+e.v,o.Nd=o.fc+e.A,o.Od=o.gc+e.B,o.Gc=-((o.Jd-o.Md)*this.wg+(o.Kd-o.Nd)*this.xg+(o.Ld-o.Od)*this.yg)}},Hb:function(){var t=new bt;return t.x=this.wg,t.y=this.xg,t.z=this.yg,t},Mb:function(t){t.x=this.wg,t.y=this.xg,t.z=this.yg},uc:function(){var t=new bt;return t.x=this.lj,t.y=this.mj,t.z=this.nj,t},vc:function(t){t.x=this.lj,t.y=this.mj,t.z=this.nj},ua:function(){var t=new bt;return t.x=this.Vi,t.y=this.Wi,t.z=this.Xi,t},cb:function(t){t.x=this.Vi,t.y=this.Wi,t.z=this.Xi},qc:function(){return this.wc},pc:function(){return this.be}},k.prototype={Mb:function(){var t=new bt;return t.x=this.Jd,t.y=this.Kd,t.z=this.Ld,t},pc:function(t){t.x=this.Jd,t.y=this.Kd,t.z=this.Ld},qc:function(){var t=new bt;return t.x=this.Md,t.y=this.Nd,t.z=this.Od,t},uc:function(t){t.x=this.Md,t.y=this.Nd,t.z=this.Od},cb:function(){return this.Gc},Ac:function(){return this.Pe},Hb:function(){return this.ae.bd},vc:function(){return this.ae.zc},ua:function(){return this.ae.yc},Ec:function(){return!this.lf}},U.prototype={Wn:function(){for(var t=this.Ja.be;0<=--t;){var e,i;e=(s=this.Ja.wc[t]).Jd-s.Md,i=s.Kd-s.Nd;var s=s.Ld-s.Od,r=this.Ja.wg*e+this.Ja.xg*i+this.Ja.yg*s;r>yt.contactPersistenceThreshold?this.Fm(t):(e+=this.Ja.wg*-r)*e+(i+=this.Ja.xg*-r)*i+(s+=this.Ja.yg*-r)*s>yt.contactPersistenceThreshold*yt.contactPersistenceThreshold&&this.Fm(t)}},Fm:function(t){var e=--this.Ja.be;if(t!=e){var i=this.Ja.wc[t];this.Ja.wc[t]=this.Ja.wc[e],this.Ja.wc[e]=i}(t=this.Ja.wc[e]).mf=0,t.nf=0,t.pf=0,t.qf=0,t.rf=0,t.sf=0,t.Db=0,t.Eb=0,t.Fb=0,t.ec=0,t.fc=0,t.gc=0,t.Jd=0,t.Kd=0,t.Ld=0,t.Md=0,t.Nd=0,t.Od=0,t.Gc=0,(e=t.ae).bd=0,e.zc=0,e.yc=0,e.ub=0,e.df=0,e.ef=0,e.ff=0,t.Pe=!1,t.lf=!1,t.Cc=-1},jn:function(t,e,i){if((r=this.Ja.be)==yt.maxManifoldPoints){var s,r=this.Ja.wc[this.on(t,e,i)],n=t.position1;r.Jd=n.x,r.Kd=n.y,r.Ld=n.z,n=t.position2,r.Md=n.x,r.Nd=n.y,r.Od=n.z,r.Db=r.Jd-e.v,r.Eb=r.Kd-e.A,r.Fb=r.Ld-e.B,r.ec=r.Md-i.v,r.fc=r.Nd-i.A,r.gc=r.Od-i.B,n=e.o*r.Db+e.i*r.Eb+e.l*r.Fb,s=e.f*r.Db+e.m*r.Eb+e.g*r.Fb,e=e.h*r.Db+e.j*r.Eb+e.s*r.Fb,r.mf=n,r.nf=s,r.pf=e,e=i.o*r.ec+i.i*r.fc+i.l*r.gc,n=i.f*r.ec+i.m*r.fc+i.g*r.gc,i=i.h*r.ec+i.j*r.fc+i.s*r.gc,r.qf=e,r.rf=n,r.sf=i,r.Gc=t.depth,(i=r.ae).bd=0,i.zc=0,i.yc=0,i.ub=0,i.df=0,i.ef=0,i.ff=0,r.Cc=t.id,r.Pe=!1,r.lf=!1}else r=this.Ja.wc[r],n=t.position1,r.Jd=n.x,r.Kd=n.y,r.Ld=n.z,n=t.position2,r.Md=n.x,r.Nd=n.y,r.Od=n.z,r.Db=r.Jd-e.v,r.Eb=r.Kd-e.A,r.Fb=r.Ld-e.B,r.ec=r.Md-i.v,r.fc=r.Nd-i.A,r.gc=r.Od-i.B,n=e.o*r.Db+e.i*r.Eb+e.l*r.Fb,s=e.f*r.Db+e.m*r.Eb+e.g*r.Fb,e=e.h*r.Db+e.j*r.Eb+e.s*r.Fb,r.mf=n,r.nf=s,r.pf=e,e=i.o*r.ec+i.i*r.fc+i.l*r.gc,n=i.f*r.ec+i.m*r.fc+i.g*r.gc,i=i.h*r.ec+i.j*r.fc+i.s*r.gc,r.qf=e,r.rf=n,r.sf=i,r.Gc=t.depth,(i=r.ae).bd=0,i.zc=0,i.yc=0,i.ub=0,i.df=0,i.ef=0,i.ff=0,r.Cc=t.id,r.Pe=!1,r.lf=!1,this.Ja.be++},on:function(t,e){var i=this.Ja.wc[0],s=this.Ja.wc[1],r=this.Ja.wc[2],n=this.Ja.wc[3],a=i.Gc,o=0;s.Gc>a&&(a=s.Gc,o=1),r.Gc>a&&(a=r.Gc,o=2),n.Gc>a&&(a=n.Gc,o=3);var h,c,l,u=t.position1;h=u.x,c=u.y,l=u.z,h-=e.v,c-=e.A,l-=e.B;var p,d,f,m,g,y,v,b,x,_,M,w,S,A,T,C,L,E,z,R,B,P,D,I,O,F,G,N,j,V,U,k,H,W,q,$,J,X,Y,K,Z,Q,tt,et,it,st,rt,nt,at,ot,ht,ct,lt,ut,pt,dt,ft,mt,gt,yt,vt,bt,xt,_t,Mt,wt,St,At,Tt,Ct,Lt,Et,zt,Rt,Bt,Pt,Dt,It,Ot,Ft,Gt,Nt,jt,Vt,Ut,kt,Ht,Wt,qt,$t,Jt,Xt,Yt,Kt,Zt,Qt,te,ee,ie,se,re,ne,ae,oe,he,ce,le,ue,pe=s.Db,de=s.Eb,fe=s.Fb,me=r.Db,ge=r.Eb,ye=r.Fb,ve=n.Db,be=n.Eb,xe=n.Fb,_e=(z=(d=ge-de)*(y=l-xe)-(f=ye-fe)*(g=c-be))*z+(R=f*(m=h-ve)-(p=me-pe)*y)*R+(B=p*g-d*m)*B,Me=(P=(b=be-de)*(w=l-ye)-(x=xe-fe)*(M=c-ge))*P+(D=x*(_=h-me)-(v=ve-pe)*w)*D+(I=v*M-b*_)*I,we=(O=(A=c-de)*(E=xe-ye)-(T=l-fe)*(L=be-ge))*O+(F=T*(C=ve-me)-(S=h-pe)*E)*F+(G=S*L-A*C)*G,Se=_e>Me?_e>we?_e:we:Me>we?Me:we,Ae=i.Db,Te=i.Eb,Ce=i.Fb,Le=r.Db,Ee=r.Eb,ze=r.Fb,Re=n.Db,Be=n.Eb,Pe=n.Fb,De=(st=(j=Ee-Te)*(H=l-Pe)-(V=ze-Ce)*(k=c-Be))*st+(rt=V*(U=h-Re)-(N=Le-Ae)*H)*rt+(nt=N*k-j*U)*nt,Ie=(at=(q=Be-Te)*(Y=l-ze)-($=Pe-Ce)*(X=c-Ee))*at+(ot=$*(J=h-Le)-(W=Re-Ae)*Y)*ot+(ht=W*X-q*J)*ht,Oe=(ct=(Z=c-Te)*(it=Pe-ze)-(Q=l-Ce)*(et=Be-Ee))*ct+(lt=Q*(tt=Re-Le)-(K=h-Ae)*it)*lt+(ut=K*et-Z*tt)*ut,Fe=De>Ie?De>Oe?De:Oe:Ie>Oe?Ie:Oe,Ge=i.Db,Ne=i.Eb,je=i.Fb,Ve=s.Db,Ue=s.Eb,ke=s.Fb,He=n.Db,We=n.Eb,qe=n.Fb,$e=(zt=(dt=Ue-Ne)*(yt=l-qe)-(ft=ke-je)*(gt=c-We))*zt+(Rt=ft*(mt=h-He)-(pt=Ve-Ge)*yt)*Rt+(Bt=pt*gt-dt*mt)*Bt,Je=(Pt=(bt=We-Ne)*(wt=l-ke)-(xt=qe-je)*(Mt=c-Ue))*Pt+(Dt=xt*(_t=h-Ve)-(vt=He-Ge)*wt)*Dt+(It=vt*Mt-bt*_t)*It,Xe=(Ot=(At=c-Ne)*(Et=qe-ke)-(Tt=l-je)*(Lt=We-Ue))*Ot+(Ft=Tt*(Ct=He-Ve)-(St=h-Ge)*Et)*Ft+(Gt=St*Lt-At*Ct)*Gt,Ye=$e>Je?$e>Xe?$e:Xe:Je>Xe?Je:Xe,Ke=i.Db,Ze=i.Eb,Qe=i.Fb,ti=s.Db,ei=s.Eb,ii=s.Fb,si=r.Db,ri=r.Eb,ni=r.Fb,ai=(se=(jt=ei-Ze)*(Ht=l-ni)-(Vt=ii-Qe)*(kt=c-ri))*se+(re=Vt*(Ut=h-si)-(Nt=ti-Ke)*Ht)*re+(ne=Nt*kt-jt*Ut)*ne,oi=(ae=(qt=ri-Ze)*(Yt=l-ii)-($t=ni-Qe)*(Xt=c-ei))*ae+(oe=$t*(Jt=h-ti)-(Wt=si-Ke)*Yt)*oe+(he=Wt*Xt-qt*Jt)*he,hi=(ce=(Zt=c-Ze)*(ie=ni-ii)-(Qt=l-Qe)*(ee=ri-ei))*ce+(le=Qt*(te=si-ti)-(Kt=h-Ke)*ie)*le+(ue=Kt*ee-Zt*te)*ue,ci=ai>oi?ai>hi?ai:hi:oi>hi?oi:hi,li=Se,ui=0;return(Fe>li&&1!=o||!o)&&(li=Fe,ui=1),Ye>li&&2!=o&&(li=Ye,ui=2),ci>li&&3!=o&&(li=ci,ui=3),ui},rn:function(t,e,i){for(var s=yt.contactPersistenceThreshold*yt.contactPersistenceThreshold,r=-1,n=0,a=this.Ja.be;n<a;){var o,h,c,l,u,p,d=n++,f=this.Ja.wc[d];o=(u=t.position1).x,h=u.y,c=u.z,l=(p=t.position2).x,u=p.y,p=p.z,o-=e.v,h-=e.A,c-=e.B,l-=i.v,u-=i.A,p-=i.B,o=f.Db-o,h=f.Eb-h,c=f.Fb-c,l=f.ec-l,u=f.fc-u,f=f.gc-p,(f=(p=o*o+h*h+c*c)<(f=l*l+u*u+f*f)?p:f)<s&&(s=f,r=d)}return r},eo:function(t,e,i){this.Gl=this.Ja.be;for(var s=0,r=this.Gl;s<r;){var n=s++,a=this.Hl[n];n=this.Ja.wc[n],a.mf=n.mf,a.nf=n.nf,a.pf=n.pf,a.qf=n.qf,a.rf=n.rf,a.sf=n.sf,a.Db=n.Db,a.Eb=n.Eb,a.Fb=n.Fb,a.ec=n.ec,a.fc=n.fc,a.gc=n.gc,a.Jd=n.Jd,a.Kd=n.Kd,a.Ld=n.Ld,a.Md=n.Md,a.Nd=n.Nd,a.Od=n.Od,a.Gc=n.Gc,a.ae.de(n.ae),a.Cc=n.Cc,a.Pe=n.Pe,a.lf=!1}for(s=t.numPoints,this.Ja.be=s,r=0;r<s;){n=r++,a=this.Ja.wc[n];var o,h,c=(n=t.points[n]).position1;for(a.Jd=c.x,a.Kd=c.y,a.Ld=c.z,c=n.position2,a.Md=c.x,a.Nd=c.y,a.Od=c.z,a.Db=a.Jd-e.v,a.Eb=a.Kd-e.A,a.Fb=a.Ld-e.B,a.ec=a.Md-i.v,a.fc=a.Nd-i.A,a.gc=a.Od-i.B,c=e.o*a.Db+e.i*a.Eb+e.l*a.Fb,o=e.f*a.Db+e.m*a.Eb+e.g*a.Fb,h=e.h*a.Db+e.j*a.Eb+e.s*a.Fb,a.mf=c,a.nf=o,a.pf=h,c=i.o*a.ec+i.i*a.fc+i.l*a.gc,o=i.f*a.ec+i.m*a.fc+i.g*a.gc,h=i.h*a.ec+i.j*a.fc+i.s*a.gc,a.qf=c,a.rf=o,a.sf=h,a.Gc=n.depth,(c=a.ae).bd=0,c.zc=0,c.yc=0,c.ub=0,c.df=0,c.ef=0,c.ff=0,a.Cc=n.id,a.Pe=!1,a.lf=!1,n=0,c=this.Gl;n<c;)if(o=n++,o=this.Hl[o],a.Cc==o.Cc){a.ae.de(o.ae),a.Pe=!0;break}}},On:function(t,e,i){this.Ja.Yl(e,i);for(var s=0,r=this.Ja.be;s<r;){var n=s++;this.Ja.wc[n].Pe=!0}t=t.points[0],-1==(s=this.rn(t,e,i))?this.jn(t,e,i):(s=this.Ja.wc[s],r=t.position1,s.Jd=r.x,s.Kd=r.y,s.Ld=r.z,r=t.position2,s.Md=r.x,s.Nd=r.y,s.Od=r.z,s.Db=s.Jd-e.v,s.Eb=s.Kd-e.A,s.Fb=s.Ld-e.B,s.ec=s.Md-i.v,s.fc=s.Nd-i.A,s.gc=s.Od-i.B,r=e.o*s.Db+e.i*s.Eb+e.l*s.Fb,n=e.f*s.Db+e.m*s.Eb+e.g*s.Fb,e=e.h*s.Db+e.j*s.Eb+e.s*s.Fb,s.mf=r,s.nf=n,s.pf=e,e=i.o*s.ec+i.i*s.fc+i.l*s.gc,r=i.f*s.ec+i.m*s.fc+i.g*s.gc,i=i.h*s.ec+i.j*s.fc+i.s*s.gc,s.qf=e,s.rf=r,s.sf=i,s.Gc=t.depth),this.Wn()}},V.prototype={Im:function(){this.xc=0,0==this.va&&0==this.wa&&0==this.xa&&0==this.Ba&&0==this.Ca&&0==this.Da||(this.xc|=1),0==this.aa&&0==this.ba&&0==this.ca&&0==this.ea&&0==this.fa&&0==this.ga||(this.xc|=2)}},O.prototype={hd:function(){var t,e,i,s=this.C.a,r=this.D.a;t=s.o*this.dj+s.f*this.ej+s.h*this.fj,e=s.i*this.dj+s.m*this.ej+s.j*this.fj,i=s.l*this.dj+s.g*this.ej+s.s*this.fj,this.Sb=t,this.Tb=e,this.Ub=i,t=r.o*this.gj+r.f*this.hj+r.h*this.ij,e=r.i*this.gj+r.m*this.hj+r.j*this.ij,i=r.l*this.gj+r.g*this.hj+r.s*this.ij,this.Vb=t,this.Wb=e,this.Xb=i,this.Of=this.Sb+s.v,this.Pf=this.Tb+s.A,this.Qf=this.Ub+s.B,this.Rf=this.Vb+r.v,this.Sf=this.Wb+r.A,this.Tf=this.Xb+r.B,t=s.o*this.qa+s.f*this.ra+s.h*this.sa,e=s.i*this.qa+s.m*this.ra+s.j*this.sa,i=s.l*this.qa+s.g*this.ra+s.s*this.sa,this.vb=t,this.wb=e,this.xb=i,t=s.o*this.Ab+s.f*this.Bb+s.h*this.Cb,e=s.i*this.Ab+s.m*this.Bb+s.j*this.Cb,i=s.l*this.Ab+s.g*this.Bb+s.s*this.Cb,this.He=t,this.Ie=e,this.Je=i,t=s.o*this.lc+s.f*this.mc+s.h*this.nc,e=s.i*this.lc+s.m*this.mc+s.j*this.nc,s=s.l*this.lc+s.g*this.mc+s.s*this.nc,this.Hh=t,this.Ih=e,this.Jh=s,s=r.o*this.nb+r.f*this.ob+r.h*this.pb,t=r.i*this.nb+r.m*this.ob+r.j*this.pb,e=r.l*this.nb+r.g*this.ob+r.s*this.pb,this.bc=s,this.cc=t,this.dc=e,s=r.o*this.gh+r.f*this.hh+r.h*this.ih,t=r.i*this.gh+r.m*this.hh+r.j*this.ih,e=r.l*this.gh+r.g*this.hh+r.s*this.ih,this.ve=s,this.we=t,this.xe=e,s=r.o*this.Mc+r.f*this.Nc+r.h*this.Oc,t=r.i*this.Mc+r.m*this.Nc+r.j*this.Oc,r=r.l*this.Mc+r.g*this.Nc+r.s*this.Oc,this.ah=s,this.bh=t,this.dh=r},$d:function(t,e){e.Qe=this.C,e.Re=this.D,e.Ka=0},gd:function(t){t.Qe=this.C,t.Re=this.D,t.Ka=0},Rl:function(){var t=this.Pi*this.Pi+this.Qi*this.Qi+this.Ri*this.Ri,e=this.Si*this.Si+this.Ti*this.Ti+this.Ui*this.Ui;0<this.Yi&&t>this.Yi*this.Yi?(this.oc.Kl(this),this.component.dispatchEvent({type:"break",force:Math.sqrt(t)})):0<this.Zi&&e>this.Zi*this.Zi&&(this.oc.Kl(this),this.component.dispatchEvent({type:"break",torque:Math.sqrt(e)}))},ue:function(){return this.C},Ue:function(){return this.D},Tg:function(){return this.Lb},cb:function(){var t=new bt;return t.x=this.Of,t.y=this.Pf,t.z=this.Qf,t},Mb:function(){var t=new bt;return t.x=this.Rf,t.y=this.Sf,t.z=this.Tf,t},Hb:function(t){t.x=this.Of,t.y=this.Pf,t.z=this.Qf},pc:function(t){t.x=this.Rf,t.y=this.Sf,t.z=this.Tf},pe:function(){var t=new bt;return t.x=this.dj,t.y=this.ej,t.z=this.fj,t},re:function(){var t=new bt;return t.x=this.gj,t.y=this.hj,t.z=this.ij,t},qe:function(t){t.x=this.dj,t.y=this.ej,t.z=this.fj},se:function(t){t.x=this.gj,t.y=this.hj,t.z=this.ij},Ec:function(){var t,e,i,s,r,n,a,o,h,c=new dt;return t=this.vb,e=this.He,i=this.Hh,s=this.wb,r=this.Ie,n=this.Ih,a=this.xb,o=this.Je,h=this.Jh,c.e00=t,c.e01=e,c.e02=i,c.e10=s,c.e11=r,c.e12=n,c.e20=a,c.e21=o,c.e22=h,c},Kc:function(){var t,e,i,s,r,n,a,o,h,c=new dt;return t=this.bc,e=this.ve,i=this.ah,s=this.cc,r=this.we,n=this.bh,a=this.dc,o=this.xe,h=this.dh,c.e00=t,c.e01=e,c.e02=i,c.e10=s,c.e11=r,c.e12=n,c.e20=a,c.e21=o,c.e22=h,c},Jc:function(t){var e,i,s,r,n,a,o,h,c;e=this.vb,i=this.He,s=this.Hh,r=this.wb,n=this.Ie,a=this.Ih,o=this.xb,h=this.Je,c=this.Jh,t.e00=e,t.e01=i,t.e02=s,t.e10=r,t.e11=n,t.e12=a,t.e20=o,t.e21=h,t.e22=c},Lc:function(t){var e,i,s,r,n,a,o,h,c;e=this.bc,i=this.ve,s=this.ah,r=this.cc,n=this.we,a=this.bh,o=this.dc,h=this.xe,c=this.dh,t.e00=e,t.e01=i,t.e02=s,t.e10=r,t.e11=n,t.e12=a,t.e20=o,t.e21=h,t.e22=c},ua:function(){return this.Ak},Ug:function(t){this.Ak=t},fd:function(){return this.Yi},Vg:function(t){this.Yi=t},Yd:function(){return this.Zi},Wg:function(t){this.Zi=t},te:function(){return this.Hc},Xg:function(t){switch(t){case 0:case 1:case 2:break;default:throw Error("invalid position correction algorithm id: "+t)}this.Hc=t},qc:function(){var t=new bt;return t.x=this.Pi,t.y=this.Qi,t.z=this.Ri,t},uc:function(t){t.x=this.Pi,t.y=this.Qi,t.z=this.Ri},vc:function(){var t=new bt;return t.x=this.Si,t.y=this.Ti,t.z=this.Ui,t},Ac:function(t){t.x=this.Si,t.y=this.Ti,t.z=this.Ui},Mf:function(){return this.ia},Ve:function(){return this.M}},I.ua=O,I.prototype=oe(O.prototype,{Ud:function(t,e,i){var s,r,n,a,o,h,c,l,u,p,d,f,m=i?1:this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0,g=this.Df*m,y=this.Ef*m,v=this.Ee*m;m=this.Fe*m,s=-this.Ub,r=this.Tb,n=this.Ub,a=-this.Sb,o=-this.Tb,h=this.Sb,c=-this.Xb,l=this.Wb,u=this.Xb,p=-this.Vb,d=-this.Wb,f=this.Vb;var b,x=1/(this.C.$a+this.D.$a),_=this.da.cd,M=this.da.dd,w=this.da.ed,S=(this.C.P*_+this.C.R*M+this.C.S*w)*_+(this.C.T*_+this.C.U*M+this.C.V*w)*M+(this.C.W*_+this.C.X*M+this.C.Y*w)*w;if(b=(this.D.P*_+this.D.R*M+this.D.S*w)*_+(this.D.T*_+this.D.U*M+this.D.V*w)*M+(this.D.W*_+this.D.X*M+this.D.Y*w)*w,0<S){var A=_*this.Sb+M*this.Tb+w*this.Ub;0<(A=this.Sb*this.Sb+this.Tb*this.Tb+this.Ub*this.Ub-A*A)&&(S=0<this.C.$a?1/(1/S+this.C.Pc*A):0)}if(0<b&&(_=_*this.Vb+M*this.Wb+w*this.Xb,0<(_=this.Vb*this.Vb+this.Wb*this.Wb+this.Xb*this.Xb-_*_)&&(b=0<this.D.$a?1/(1/b+this.D.Pc*_):0)),S=S+b?1/(S+b):0,0>=this.dl.frequency||!i){var T;if(b=this.Pb[0],(M=(_=t.rows[t.Ka++]).Aa).va=0,M.wa=0,M.xa=0,M.Ba=0,M.Ca=0,M.Da=0,M.aa=0,M.ba=0,M.ca=0,M.ea=0,M.fa=0,M.ga=0,_.Fa=0,_.Ma=0,_.Ia=0,_.Ha=0,_.motorSpeed=0,_.fb=0,_.ta=null,_.ta=b,b=_,_=this.eg,A=this.cl,w=this.dl,M=yt.linearSlop,i)w=0,T=1;else{if(0<w.frequency){M=0;var C=6.28318530717958*w.frequency;(L=w.dampingRatio)<yt.minSpringDamperDampingRatio&&(L=yt.minSpringDamperDampingRatio),T=e.dt,L=2*L*C,C*=C,w.useSymplecticEuler?(w=1/(T*L),T=C/L):(w=1/(T*(T*C+L)),T=C/(T*C+L))}else w=0,T=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;0<A.motorForce?(b.motorSpeed=A.motorSpeed,b.fb=A.motorForce*e.dt):(b.motorSpeed=0,b.fb=0)}var L=A.lowerLimit,E=A.upperLimit;L>E?_=C=A=0:L==E?(A=-1/0,C=1/0,_-=L):_<L?(A=-1/0,C=0,0<(_=_-L+M)&&(_=0)):_>E?(A=0,C=1/0,0>(_=_-E-M)&&(_=0)):_=C=A=0,b.Ia=A,b.Ha=C,b.Ma=w*(x?1/x:0),b.Fa=_*T,(b=b.Aa).va=this.da.cd,b.wa=this.da.dd,b.xa=this.da.ed,b.Ba=this.da.cd,b.Ca=this.da.dd,b.Da=this.da.ed,b.aa=-0,b.ba=-s,b.ca=-r,b.ea=-0,b.fa=-c,b.ga=-l}b=this.Pb[1],(r=(s=t.rows[t.Ka++]).Aa).va=0,r.wa=0,r.xa=0,r.Ba=0,r.Ca=0,r.Da=0,r.aa=0,r.ba=0,r.ca=0,r.ea=0,r.fa=0,r.ga=0,s.Fa=0,s.Ma=0,s.Ia=0,s.Ha=0,s.motorSpeed=0,s.fb=0,s.ta=b,(b=s).Fa=g,b.Ma=0,b.Ia=-1/0,b.Ha=1/0,(b=b.Aa).va=this.da.Qd,b.wa=this.da.Rd,b.xa=this.da.Sd,b.Ba=this.da.Qd,b.Ca=this.da.Rd,b.Da=this.da.Sd,b.aa=-n,b.ba=-0,b.ca=-a,b.ea=-u,b.fa=-0,b.ga=-p,g=this.Pb[2],(n=(b=t.rows[t.Ka++]).Aa).va=0,n.wa=0,n.xa=0,n.Ba=0,n.Ca=0,n.Da=0,n.aa=0,n.ba=0,n.ca=0,n.ea=0,n.fa=0,n.ga=0,b.Fa=0,b.Ma=0,b.Ia=0,b.Ha=0,b.motorSpeed=0,b.fb=0,b.ta=g,b.Fa=y,b.Ma=0,b.Ia=-1/0,b.Ha=1/0,(b=b.Aa).va=this.da.me,b.wa=this.da.ne,b.xa=this.da.oe,b.Ba=this.da.me,b.Ca=this.da.ne,b.Da=this.da.oe,b.aa=-o,b.ba=-h,b.ca=-0,b.ea=-d,b.fa=-f,b.ga=-0,(0>=this.Xk.frequency||!i)&&(y=this.Pb[3],(h=(o=t.rows[t.Ka++]).Aa).va=0,h.wa=0,h.xa=0,h.Ba=0,h.Ca=0,h.Da=0,h.aa=0,h.ba=0,h.ca=0,h.ea=0,h.fa=0,h.ga=0,o.Fa=0,o.Ma=0,o.Ia=0,o.Ha=0,o.motorSpeed=0,o.fb=0,o.ta=y,b=o,y=this.angle,h=this.Wk,d=this.Xk,o=yt.angularSlop,i?(i=0,d=1):(0<d.frequency?(o=0,i=6.28318530717958*d.frequency,(g=d.dampingRatio)<yt.minSpringDamperDampingRatio&&(g=yt.minSpringDamperDampingRatio),f=e.dt,g=2*g*i,n=i*i,d.useSymplecticEuler?(i=1/(f*g),d=n/g):(i=1/(f*(f*n+g)),d=n/(f*n+g))):(i=0,d=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0),0<h.motorTorque?(b.motorSpeed=h.motorSpeed,b.fb=h.motorTorque*e.dt):(b.motorSpeed=0,b.fb=0)),y=((y-(f=.5*((e=h.lowerLimit)+(h=h.upperLimit)))+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979+f,e>h?e=g=f=0:e==h?(f=-1/0,g=1/0,e=y-e):y<e?(f=-1/0,g=0,0<(e=y-e+o)&&(e=0)):y>h?(f=0,g=1/0,0>(e=y-h-o)&&(e=0)):e=g=f=0,b.Ia=f,b.Ha=g,b.Ma=i*(S?1/S:0),b.Fa=e*d,(b=b.Aa).aa=this.da.cd,b.ba=this.da.dd,b.ca=this.da.ed,b.ea=this.da.cd,b.fa=this.da.dd,b.ga=this.da.ed),e=this.Pb[4],(i=(S=t.rows[t.Ka++]).Aa).va=0,i.wa=0,i.xa=0,i.Ba=0,i.Ca=0,i.Da=0,i.aa=0,i.ba=0,i.ca=0,i.ea=0,i.fa=0,i.ga=0,S.Fa=0,S.Ma=0,S.Ia=0,S.Ha=0,S.motorSpeed=0,S.fb=0,S.ta=e,(b=S).Fa=v,b.Ma=0,b.Ia=-1/0,b.Ha=1/0,(b=b.Aa).aa=this.da.Qd,b.ba=this.da.Rd,b.ca=this.da.Sd,b.ea=this.da.Qd,b.fa=this.da.Rd,b.ga=this.da.Sd,v=this.Pb[5],(e=(t=t.rows[t.Ka++]).Aa).va=0,e.wa=0,e.xa=0,e.Ba=0,e.Ca=0,e.Da=0,e.aa=0,e.ba=0,e.ca=0,e.ea=0,e.fa=0,e.ga=0,t.Fa=0,t.Ma=0,t.Ia=0,t.Ha=0,t.motorSpeed=0,t.fb=0,t.ta=v,(b=t).Fa=m,b.Ma=0,b.Ia=-1/0,b.Ha=1/0,(b=b.Aa).aa=this.da.me,b.ba=this.da.ne,b.ca=this.da.oe,b.ea=this.da.me,b.fa=this.da.ne,b.ga=this.da.oe},hd:function(){O.prototype.hd.call(this);var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w,S,A,T,C,L,E,z,R,B,P,D,I,F,G=this.da,N=G.$.C.$a,j=G.$.D.$a;if(-.999999999>(tt=G.$.vb*G.$.bc+G.$.wb*G.$.cc+G.$.xb*G.$.dc)){var V,U,k,H,W=G.$.vb,q=G.$.wb,$=G.$.xb,J=W*W,X=q*q,Y=$*$;J<X?J<Y?(V=0,U=$*(H=1/Math.sqrt(X+Y)),k=-q*H):(V=q*(H=1/Math.sqrt(J+X)),U=-W*H,k=0):X<Y?(V=-$*(H=1/Math.sqrt(Y+J)),U=0,k=W*H):(V=q*(H=1/Math.sqrt(J+X)),U=-W*H,k=0),t=V,e=U,i=k,s=0}else{var K,Z,Q;K=G.$.wb*G.$.dc-G.$.xb*G.$.cc,Z=G.$.xb*G.$.bc-G.$.vb*G.$.dc,Q=G.$.vb*G.$.cc-G.$.wb*G.$.bc;var tt,et=Math.sqrt(.5*(1+tt));t=K*=tt=.5/et,e=Z*=tt,i=Q*=tt,s=et}R=z=E=0;var it=E*(P=t)+z*(D=e)+R*(I=i)+(B=1)*(F=s);if(0>it&&(it=-it,P=-P,D=-D,I=-I,F=-F),.999999<it){var st=(P=E+N/(N+j)*(P-E))*P+(D=z+N/(N+j)*(D-z))*D+(I=R+N/(N+j)*(I-R))*I+(F=B+N/(N+j)*(F-B))*F;1e-32<st&&(st=1/Math.sqrt(st)),r=P*st,n=D*st,a=I*st,o=F*st}else{var rt=N/(N+j)*Math.acos(it),nt=(P+=E*-it)*P+(D+=z*-it)*D+(I+=R*-it)*I+(F+=B*-it)*F;1e-32<nt&&(nt=1/Math.sqrt(nt)),P*=nt,D*=nt,I*=nt,F*=nt;var at=Math.sin(rt),ot=Math.cos(rt);r=(E*=ot)+P*at,n=(z*=ot)+D*at,a=(R*=ot)+I*at,o=(B*=ot)+F*at}var ht,ct,lt=2*r,ut=2*n,pt=2*a,dt=r*lt,ft=n*ut,mt=a*pt,gt=r*ut,yt=n*pt,vt=r*pt,bt=o*lt,xt=o*ut,_t=o*pt;if(h=gt-_t,c=vt+xt,l=gt+_t,u=1-dt-mt,p=yt-bt,d=vt-xt,f=yt+bt,m=1-dt-ft,ht=(1-ft-mt)*G.$.vb+h*G.$.wb+c*G.$.xb,ct=l*G.$.vb+u*G.$.wb+p*G.$.xb,g=d*G.$.vb+f*G.$.wb+m*G.$.xb,w=G.cd,S=G.dd,A=G.ed,T=G.Qd,C=G.Rd,L=G.Sd,-.999999999>(Bt=w*ht+S*ct+A*g)){var Mt,wt,St,At,Tt=w*w,Ct=S*S,Lt=A*A;Tt<Ct?Tt<Lt?(Mt=0,wt=A*(At=1/Math.sqrt(Ct+Lt)),St=-S*At):(Mt=S*(At=1/Math.sqrt(Tt+Ct)),wt=-w*At,St=0):Ct<Lt?(Mt=-A*(At=1/Math.sqrt(Lt+Tt)),wt=0,St=w*At):(Mt=S*(At=1/Math.sqrt(Tt+Ct)),wt=-w*At,St=0),r=Mt,n=wt,a=St,o=0}else{var Et,zt,Rt;Et=S*g-A*ct,zt=A*ht-w*g,Rt=w*ct-S*ht;var Bt,Pt=Math.sqrt(.5*(1+Bt));r=Et*=Bt=.5/Pt,n=zt*=Bt,a=Rt*=Bt,o=Pt}var Dt,It,Ot,Ft=2*r,Gt=2*n,Nt=2*a,jt=r*Ft,Vt=n*Gt,Ut=a*Nt,kt=r*Gt,Ht=n*Nt,Wt=r*Nt,qt=o*Ft,$t=o*Gt,Jt=o*Nt;if(1e-6<(x=ct*(b=(d=Wt-$t)*T+(f=Ht+qt)*C+(m=1-jt-Vt)*L)-g*(v=(l=kt+Jt)*T+(u=1-jt-Ut)*C+(p=Ht-qt)*L))*x+(_=g*(y=(1-Vt-Ut)*T+(h=kt-Jt)*C+(c=Wt+$t)*L)-ht*b)*_+(M=ht*v-ct*y)*M){var Xt=x*x+_*_+M*M;0<Xt&&(Xt=1/Math.sqrt(Xt)),x*=Xt,_*=Xt,M*=Xt}else{var Yt,Kt=ht*ht,Zt=ct*ct,Qt=g*g;Kt<Zt?Kt<Qt?(x=0,_=g*(Yt=1/Math.sqrt(Zt+Qt)),M=-ct*Yt):(x=ct*(Yt=1/Math.sqrt(Kt+Zt)),_=-ht*Yt,M=0):Zt<Qt?(x=-g*(Yt=1/Math.sqrt(Qt+Kt)),_=0,M=ht*Yt):(x=ct*(Yt=1/Math.sqrt(Kt+Zt)),_=-ht*Yt,M=0)}y=_*g-M*ct,v=M*ht-x*g,b=x*ct-_*ht,G.cd=ht,G.dd=ct,G.ed=g,G.Qd=y,G.Rd=v,G.Sd=b,G.me=x,G.ne=_,G.oe=M,Dt=this.wb*this.dc-this.xb*this.cc,It=this.xb*this.bc-this.vb*this.dc,Ot=this.vb*this.cc-this.wb*this.bc;var te,ee,ie,se,re,ne,ae=this.vb*this.bc+this.wb*this.cc+this.xb*this.dc,oe=-1>=ae?3.14159265358979:1<=ae?0:Math.acos(ae),he=Dt*Dt+It*It+Ot*Ot;0<he&&(he=1/Math.sqrt(he)),Dt*=he,It*=he,Ot*=he,Dt*=oe,It*=oe,Ot*=oe,this.Ee=Dt*this.da.Qd+It*this.da.Rd+Ot*this.da.Sd,this.Fe=Dt*this.da.me+It*this.da.ne+Ot*this.da.oe,te=this.Ie*this.xe-this.Je*this.we,ee=this.Je*this.ve-this.He*this.xe,ie=this.He*this.we-this.Ie*this.ve,ae=this.He*this.ve+this.Ie*this.we+this.Je*this.xe,this.angle=-1>=ae?3.14159265358979:1<=ae?0:Math.acos(ae),0>te*this.da.cd+ee*this.da.dd+ie*this.da.ed&&(this.angle=-this.angle),se=this.Rf-this.Of,re=this.Sf-this.Pf,ne=this.Tf-this.Qf,this.eg=se*this.da.cd+re*this.da.dd+ne*this.da.ed,this.Df=se*this.da.Qd+re*this.da.Rd+ne*this.da.Sd,this.Ef=se*this.da.me+re*this.da.ne+ne*this.da.oe},$d:function(t,e){O.prototype.$d.call(this,t,e),this.Ud(e,t,!1)},gd:function(t){O.prototype.gd.call(this,t),this.Ud(t,null,!0)},Eg:function(){var t=new bt;return t.x=this.vb,t.y=this.wb,t.z=this.xb,t},Gg:function(){var t=new bt;return t.x=this.bc,t.y=this.cc,t.z=this.dc,t},Fg:function(t){t.x=this.vb,t.y=this.wb,t.z=this.xb},Hg:function(t){t.x=this.bc,t.y=this.cc,t.z=this.dc},Ig:function(){var t=new bt;return t.x=this.qa,t.y=this.ra,t.z=this.sa,t},Kg:function(){var t=new bt;return t.x=this.nb,t.y=this.ob,t.z=this.pb,t},Jg:function(t){t.x=this.qa,t.y=this.ra,t.z=this.sa},Lg:function(t){t.x=this.nb,t.y=this.ob,t.z=this.pb},In:function(){return this.dl},An:function(){return this.Xk},Hn:function(){return this.cl},zn:function(){return this.Wk},ol:function(){return this.angle},rl:function(){return this.eg}}),D.prototype={fh:function(t,e,i){this.rigidBody1=t,this.rigidBody2=e;var s,r,n,a=this.rigidBody1;s=i.x,r=i.y,n=i.z,s-=a.a.v,r-=a.a.A,n-=a.a.B,t=a.a.o*s+a.a.i*r+a.a.l*n,e=a.a.f*s+a.a.m*r+a.a.g*n,a=a.a.h*s+a.a.j*r+a.a.s*n,(s=this.localAnchor1).x=t,s.y=e,s.z=a,e=this.rigidBody2,a=i.x,s=i.y,r=i.z,a-=e.a.v,s-=e.a.A,r-=e.a.B,i=e.a.o*a+e.a.i*s+e.a.l*r,t=e.a.f*a+e.a.m*s+e.a.g*r,e=e.a.h*a+e.a.j*s+e.a.s*r,(a=this.localAnchor2).x=i,a.y=t,a.z=e}},P.ua=D,P.prototype=oe(D.prototype,{za:function(t,e,i,s){var r,n,a,o;return this.fh(t,e,i),r=s.x,n=s.y,a=s.z,i=t.a.o*r+t.a.i*n+t.a.l*a,o=t.a.f*r+t.a.m*n+t.a.g*a,t=t.a.h*r+t.a.j*n+t.a.s*a,(r=this.localAxis1).x=i,r.y=o,r.z=t,o=s.x,t=s.y,r=s.z,s=e.a.o*o+e.a.i*t+e.a.l*r,i=e.a.f*o+e.a.m*t+e.a.g*r,e=e.a.h*o+e.a.j*t+e.a.s*r,(o=this.localAxis2).x=s,o.y=i,o.z=e,this}}),z.prototype={ua:function(){return this.Pk},Hb:function(){return this.Qc},Mb:function(){return this.ia},cb:function(){return this.M}},L.ua=O,L.prototype=oe(O.prototype,{Ud:function(t,e,i){var s,r,n,a,o,h,c,l,u,p,d,f,m,g,y=i?1:this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0,v=this.Df*y,b=this.Ef*y,x=this.rh*y,_=this.Ee*y;if(y=this.Fe*y,s=-this.Ub,r=this.Tb,n=this.Ub,a=-this.Sb,o=-this.Tb,h=this.Sb,c=-this.Xb,l=this.Wb,u=this.Xb,p=-this.Vb,d=-this.Wb,f=this.Vb,g=1/(this.C.$a+this.D.$a),0>=this.Ce.frequency||!i){m=this.Pb[0],(A=(M=t.rows[t.Ka++]).Aa).va=0,A.wa=0,A.xa=0,A.Ba=0,A.Ca=0,A.Da=0,A.aa=0,A.ba=0,A.ca=0,A.ea=0,A.fa=0,A.ga=0,M.Fa=0,M.Ma=0,M.Ia=0,M.Ha=0,M.motorSpeed=0,M.fb=0,M.ta=m,m=M;var M=this.eg,w=this.Rh,S=this.Ce,A=yt.linearSlop;if(i)S=0,i=1;else{if(0<S.frequency){A=0;var T=6.28318530717958*S.frequency,C=S.dampingRatio;C<yt.minSpringDamperDampingRatio&&(C=yt.minSpringDamperDampingRatio),i=e.dt,C=2*C*T,T*=T,S.useSymplecticEuler?(S=1/(i*C),i=T/C):(S=1/(i*(i*T+C)),i=T/(i*T+C))}else S=0,i=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;0<w.motorForce?(m.motorSpeed=w.motorSpeed,m.fb=w.motorForce*e.dt):(m.motorSpeed=0,m.fb=0)}(e=w.lowerLimit)>(T=w.upperLimit)?e=C=w=0:e==T?(w=-1/0,C=1/0,e=M-e):M<e?(w=-1/0,C=0,0<(e=M-e+A)&&(e=0)):M>T?(w=0,C=1/0,0>(e=M-T-A)&&(e=0)):e=C=w=0,m.Ia=w,m.Ha=C,m.Ma=S*(g?1/g:0),m.Fa=e*i,(g=m.Aa).va=this.da.cd,g.wa=this.da.dd,g.xa=this.da.ed,g.Ba=this.da.cd,g.Ca=this.da.dd,g.Da=this.da.ed,g.aa=-0,g.ba=-s,g.ca=-r,g.ea=-0,g.fa=-c,g.ga=-l}s=this.Pb[1],(c=(r=t.rows[t.Ka++]).Aa).va=0,c.wa=0,c.xa=0,c.Ba=0,c.Ca=0,c.Da=0,c.aa=0,c.ba=0,c.ca=0,c.ea=0,c.fa=0,c.ga=0,r.Fa=0,r.Ma=0,r.Ia=0,r.Ha=0,r.motorSpeed=0,r.fb=0,r.ta=s,(m=r).Fa=v,m.Ma=0,m.Ia=-1/0,m.Ha=1/0,(g=m.Aa).va=this.da.Qd,g.wa=this.da.Rd,g.xa=this.da.Sd,g.Ba=this.da.Qd,g.Ca=this.da.Rd,g.Da=this.da.Sd,g.aa=-n,g.ba=-0,g.ca=-a,g.ea=-u,g.fa=-0,g.ga=-p,v=this.Pb[2],(a=(n=t.rows[t.Ka++]).Aa).va=0,a.wa=0,a.xa=0,a.Ba=0,a.Ca=0,a.Da=0,a.aa=0,a.ba=0,a.ca=0,a.ea=0,a.fa=0,a.ga=0,n.Fa=0,n.Ma=0,n.Ia=0,n.Ha=0,n.motorSpeed=0,n.fb=0,n.ta=v,(m=n).Fa=b,m.Ma=0,m.Ia=-1/0,m.Ha=1/0,(g=m.Aa).va=this.da.me,g.wa=this.da.ne,g.xa=this.da.oe,g.Ba=this.da.me,g.Ca=this.da.ne,g.Da=this.da.oe,g.aa=-o,g.ba=-h,g.ca=-0,g.ea=-d,g.fa=-f,g.ga=-0,b=this.Pb[3],(h=(o=t.rows[t.Ka++]).Aa).va=0,h.wa=0,h.xa=0,h.Ba=0,h.Ca=0,h.Da=0,h.aa=0,h.ba=0,h.ca=0,h.ea=0,h.fa=0,h.ga=0,o.Fa=0,o.Ma=0,o.Ia=0,o.Ha=0,o.motorSpeed=0,o.fb=0,o.ta=b,(m=o).Fa=x,m.Ma=0,m.Ia=-1/0,m.Ha=1/0,(g=m.Aa).aa=1,g.ba=0,g.ca=0,g.ea=1,g.fa=0,g.ga=0,x=this.Pb[4],(o=(b=t.rows[t.Ka++]).Aa).va=0,o.wa=0,o.xa=0,o.Ba=0,o.Ca=0,o.Da=0,o.aa=0,o.ba=0,o.ca=0,o.ea=0,o.fa=0,o.ga=0,b.Fa=0,b.Ma=0,b.Ia=0,b.Ha=0,b.motorSpeed=0,b.fb=0,b.ta=x,(m=b).Fa=_,m.Ma=0,m.Ia=-1/0,m.Ha=1/0,(g=m.Aa).aa=0,g.ba=1,g.ca=0,g.ea=0,g.fa=1,g.ga=0,_=this.Pb[5],(x=(t=t.rows[t.Ka++]).Aa).va=0,x.wa=0,x.xa=0,x.Ba=0,x.Ca=0,x.Da=0,x.aa=0,x.ba=0,x.ca=0,x.ea=0,x.fa=0,x.ga=0,t.Fa=0,t.Ma=0,t.Ia=0,t.Ha=0,t.motorSpeed=0,t.fb=0,t.ta=_,(m=t).Fa=y,m.Ma=0,m.Ia=-1/0,m.Ha=1/0,(g=m.Aa).aa=0,g.ba=0,g.ca=1,g.ea=0,g.fa=0,g.ga=1},hd:function(){O.prototype.hd.call(this);var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w,S,A,T,C,L,E,z,R,B,P,D,I,F,G=this.da,N=G.$.C.$a,j=G.$.D.$a;if(-.999999999>(tt=G.$.vb*G.$.bc+G.$.wb*G.$.cc+G.$.xb*G.$.dc)){var V,U,k,H,W=G.$.vb,q=G.$.wb,$=G.$.xb,J=W*W,X=q*q,Y=$*$;J<X?J<Y?(V=0,U=$*(H=1/Math.sqrt(X+Y)),k=-q*H):(V=q*(H=1/Math.sqrt(J+X)),U=-W*H,k=0):X<Y?(V=-$*(H=1/Math.sqrt(Y+J)),U=0,k=W*H):(V=q*(H=1/Math.sqrt(J+X)),U=-W*H,k=0),t=V,e=U,i=k,s=0}else{var K,Z,Q;K=G.$.wb*G.$.dc-G.$.xb*G.$.cc,Z=G.$.xb*G.$.bc-G.$.vb*G.$.dc,Q=G.$.vb*G.$.cc-G.$.wb*G.$.bc;var tt,et=Math.sqrt(.5*(1+tt));t=K*=tt=.5/et,e=Z*=tt,i=Q*=tt,s=et}R=z=E=0;var it=E*(P=t)+z*(D=e)+R*(I=i)+(B=1)*(F=s);if(0>it&&(it=-it,P=-P,D=-D,I=-I,F=-F),.999999<it){var st=(P=E+N/(N+j)*(P-E))*P+(D=z+N/(N+j)*(D-z))*D+(I=R+N/(N+j)*(I-R))*I+(F=B+N/(N+j)*(F-B))*F;1e-32<st&&(st=1/Math.sqrt(st)),r=P*st,n=D*st,a=I*st,o=F*st}else{var rt=N/(N+j)*Math.acos(it),nt=(P+=E*-it)*P+(D+=z*-it)*D+(I+=R*-it)*I+(F+=B*-it)*F;1e-32<nt&&(nt=1/Math.sqrt(nt)),P*=nt,D*=nt,I*=nt,F*=nt;var at=Math.sin(rt),ot=Math.cos(rt);r=(E*=ot)+P*at,n=(z*=ot)+D*at,a=(R*=ot)+I*at,o=(B*=ot)+F*at}var ht,ct,lt=2*r,ut=2*n,pt=2*a,dt=r*lt,ft=n*ut,mt=a*pt,gt=r*ut,yt=n*pt,vt=r*pt,bt=o*lt,xt=o*ut,_t=o*pt;if(h=gt-_t,c=vt+xt,l=gt+_t,u=1-dt-mt,p=yt-bt,d=vt-xt,f=yt+bt,m=1-dt-ft,ht=(1-ft-mt)*G.$.vb+h*G.$.wb+c*G.$.xb,ct=l*G.$.vb+u*G.$.wb+p*G.$.xb,g=d*G.$.vb+f*G.$.wb+m*G.$.xb,w=G.cd,S=G.dd,A=G.ed,T=G.Qd,C=G.Rd,L=G.Sd,-.999999999>(Bt=w*ht+S*ct+A*g)){var Mt,wt,St,At,Tt=w*w,Ct=S*S,Lt=A*A;Tt<Ct?Tt<Lt?(Mt=0,wt=A*(At=1/Math.sqrt(Ct+Lt)),St=-S*At):(Mt=S*(At=1/Math.sqrt(Tt+Ct)),wt=-w*At,St=0):Ct<Lt?(Mt=-A*(At=1/Math.sqrt(Lt+Tt)),wt=0,St=w*At):(Mt=S*(At=1/Math.sqrt(Tt+Ct)),wt=-w*At,St=0),r=Mt,n=wt,a=St,o=0}else{var Et,zt,Rt;Et=S*g-A*ct,zt=A*ht-w*g,Rt=w*ct-S*ht;var Bt,Pt=Math.sqrt(.5*(1+Bt));r=Et*=Bt=.5/Pt,n=zt*=Bt,a=Rt*=Bt,o=Pt}var Dt,It,Ot,Ft,Gt,Nt,jt,Vt,Ut,kt,Ht,Wt,qt,$t,Jt,Xt,Yt,Kt,Zt,Qt,te,ee,ie,se,re,ne,ae=2*r,oe=2*n,he=2*a,ce=r*ae,le=n*oe,ue=a*he,pe=r*oe,de=n*he,fe=r*he,me=o*ae,ge=o*oe,ye=o*he;if(1e-6<(x=ct*(b=(d=fe-ge)*T+(f=de+me)*C+(m=1-ce-le)*L)-g*(v=(l=pe+ye)*T+(u=1-ce-ue)*C+(p=de-me)*L))*x+(_=g*(y=(1-le-ue)*T+(h=pe-ye)*C+(c=fe+ge)*L)-ht*b)*_+(M=ht*v-ct*y)*M){var ve=x*x+_*_+M*M;0<ve&&(ve=1/Math.sqrt(ve)),x*=ve,_*=ve,M*=ve}else{var be,xe=ht*ht,_e=ct*ct,Me=g*g;xe<_e?xe<Me?(x=0,_=g*(be=1/Math.sqrt(_e+Me)),M=-ct*be):(x=ct*(be=1/Math.sqrt(xe+_e)),_=-ht*be,M=0):_e<Me?(x=-g*(be=1/Math.sqrt(Me+xe)),_=0,M=ht*be):(x=ct*(be=1/Math.sqrt(xe+_e)),_=-ht*be,M=0)}y=_*g-M*ct,v=M*ht-x*g,b=x*ct-_*ht,G.cd=ht,G.dd=ct,G.ed=g,G.Qd=y,G.Rd=v,G.Sd=b,G.me=x,G.ne=_,G.oe=M,Dt=this.vb,It=this.He,Ot=this.Hh,Ft=this.wb,Gt=this.Ie,Nt=this.Ih,jt=this.xb,Vt=this.Je,Ut=this.Jh,Qt=(kt=this.bc)*Ft+(Ht=this.ve)*Gt+(Wt=this.ah)*Nt,te=kt*jt+Ht*Vt+Wt*Ut,ee=(qt=this.cc)*Dt+($t=this.we)*It+(Jt=this.bh)*Ot,se=qt*jt+$t*Vt+Jt*Ut,re=(Xt=this.dc)*Dt+(Yt=this.xe)*It+(Kt=this.dh)*Ot,ne=Xt*Ft+Yt*Gt+Kt*Nt;var we,Se,Ae,Te,Ce,Le=Xt*jt+Yt*Vt+Kt*Ut,Ee=(Zt=kt*Dt+Ht*It+Wt*Ot)+(ie=qt*Ft+$t*Gt+Jt*Nt)+Le;0<Ee?(Te=.5*(Ce=Math.sqrt(Ee+1)),we=(ne-se)*(Ce=.5/Ce),Se=(te-re)*Ce,Ae=(ee-Qt)*Ce):Zt>ie?Zt>Le?(we=.5*(Ce=Math.sqrt(Zt-ie-Le+1)),Se=(Qt+ee)*(Ce=.5/Ce),Ae=(te+re)*Ce,Te=(ne-se)*Ce):(Ae=.5*(Ce=Math.sqrt(Le-Zt-ie+1)),we=(te+re)*(Ce=.5/Ce),Se=(se+ne)*Ce,Te=(ee-Qt)*Ce):ie>Le?(Se=.5*(Ce=Math.sqrt(ie-Le-Zt+1)),we=(Qt+ee)*(Ce=.5/Ce),Ae=(se+ne)*Ce,Te=(te-re)*Ce):(Ae=.5*(Ce=Math.sqrt(Le-Zt-ie+1)),we=(te+re)*(Ce=.5/Ce),Se=(se+ne)*Ce,Te=(ee-Qt)*Ce);var ze=Te,Re=2*(-1>=ze?3.14159265358979:1<=ze?0:Math.acos(ze));this.rh=we,this.Ee=Se,this.Fe=Ae;var Be,Pe,De,Ie=this.rh*this.rh+this.Ee*this.Ee+this.Fe*this.Fe;0<Ie&&(Ie=1/Math.sqrt(Ie)),this.rh*=Ie,this.Ee*=Ie,this.Fe*=Ie,this.rh*=Re,this.Ee*=Re,this.Fe*=Re,Be=this.Rf-this.Of,Pe=this.Sf-this.Pf,De=this.Tf-this.Qf,this.eg=Be*this.da.cd+Pe*this.da.dd+De*this.da.ed,this.Df=Be*this.da.Qd+Pe*this.da.Rd+De*this.da.Sd,this.Ef=Be*this.da.me+Pe*this.da.ne+De*this.da.oe},$d:function(t,e){O.prototype.$d.call(this,t,e),this.Ud(e,t,!1)},gd:function(t){O.prototype.gd.call(this,t),this.Ud(t,null,!0)},Eg:function(){var t=new bt;return t.x=this.vb,t.y=this.wb,t.z=this.xb,t},Gg:function(){var t=new bt;return t.x=this.bc,t.y=this.cc,t.z=this.dc,t},Fg:function(t){t.x=this.vb,t.y=this.wb,t.z=this.xb},Hg:function(t){t.x=this.bc,t.y=this.cc,t.z=this.dc},Ig:function(){var t=new bt;return t.x=this.qa,t.y=this.ra,t.z=this.sa,t},Kg:function(){var t=new bt;return t.x=this.nb,t.y=this.ob,t.z=this.pb,t},Jg:function(t){t.x=this.qa,t.y=this.ra,t.z=this.sa},Lg:function(t){t.x=this.nb,t.y=this.ob,t.z=this.pb},Cj:function(){return this.Ce},ql:function(){return this.Rh},rl:function(){return this.eg}}),C.ua=D,C.prototype=oe(D.prototype,{za:function(t,e,i,s){var r,n,a,o;return this.fh(t,e,i),r=s.x,n=s.y,a=s.z,i=t.a.o*r+t.a.i*n+t.a.l*a,o=t.a.f*r+t.a.m*n+t.a.g*a,t=t.a.h*r+t.a.j*n+t.a.s*a,(r=this.localAxis1).x=i,r.y=o,r.z=t,o=s.x,t=s.y,r=s.z,s=e.a.o*o+e.a.i*t+e.a.l*r,i=e.a.f*o+e.a.m*t+e.a.g*r,e=e.a.h*o+e.a.j*t+e.a.s*r,(o=this.localAxis2).x=s,o.y=i,o.z=e,this}}),T.ua=O,T.prototype=oe(O.prototype,{Ud:function(t,e,i){var s,r,n=i?1:this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;s=this.Mj*n,r=this.Df*n;var a,o,h,c,l,u,p,d,f,m,g,y,v=this.Ef*n;a=-this.Ub,o=this.Tb,h=this.Ub,c=-this.Sb,l=-this.Tb,u=this.Sb,p=-this.Xb,d=this.Wb,f=this.Xb,m=-this.Vb,g=-this.Wb,y=this.Vb;var b=this.je,x=this.ke,_=this.le,M=(n=(this.C.P*b+this.C.R*x+this.C.S*_)*b+(this.C.T*b+this.C.U*x+this.C.V*_)*x+(this.C.W*b+this.C.X*x+this.C.Y*_)*_,(this.D.P*b+this.D.R*x+this.D.S*_)*b+(this.D.T*b+this.D.U*x+this.D.V*_)*x+(this.D.W*b+this.D.X*x+this.D.Y*_)*_);if(0<n){var w=b*this.Sb+x*this.Tb+_*this.Ub;0<(w=this.Sb*this.Sb+this.Tb*this.Tb+this.Ub*this.Ub-w*w)&&(n=0<this.C.$a?1/(1/n+this.C.Pc*w):0)}if(0<M&&(b=b*this.Vb+x*this.Wb+_*this.Xb,0<(b=this.Vb*this.Vb+this.Wb*this.Wb+this.Xb*this.Xb-b*b)&&(M=0<this.D.$a?1/(1/M+this.D.Pc*b):0)),M=n+M?1/(n+M):0,x=this.bc,_=this.cc,w=this.dc,n=(this.C.P*x+this.C.R*_+this.C.S*w)*x+(this.C.T*x+this.C.U*_+this.C.V*w)*_+(this.C.W*x+this.C.X*_+this.C.Y*w)*w,b=(this.D.P*x+this.D.R*_+this.D.S*w)*x+(this.D.T*x+this.D.U*_+this.D.V*w)*_+(this.D.W*x+this.D.X*_+this.D.Y*w)*w,0<n){var S=x*this.Sb+_*this.Tb+w*this.Ub;0<(S=this.Sb*this.Sb+this.Tb*this.Tb+this.Ub*this.Ub-S*S)&&(n=0<this.C.$a?1/(1/n+this.C.Pc*S):0)}0<b&&(x=x*this.Vb+_*this.Wb+w*this.Xb,0<(x=this.Vb*this.Vb+this.Wb*this.Wb+this.Xb*this.Xb-x*x)&&(b=0<this.D.$a?1/(1/b+this.D.Pc*x):0)),n=n+b?1/(n+b):0,b=this.Pb[0],(_=(x=t.rows[t.Ka++]).Aa).va=0,_.wa=0,_.xa=0,_.Ba=0,_.Ca=0,_.Da=0,_.aa=0,_.ba=0,_.ca=0,_.ea=0,_.fa=0,_.ga=0,x.Fa=0,x.Ma=0,x.Ia=0,x.Ha=0,x.motorSpeed=0,x.fb=0,x.ta=b,(b=x).Fa=s,b.Ma=0,b.Ia=-1/0,b.Ha=1/0,(b=b.Aa).va=1,b.wa=0,b.xa=0,b.Ba=1,b.Ca=0,b.Da=0,b.aa=-0,b.ba=-a,b.ca=-o,b.ea=-0,b.fa=-p,b.ga=-d,b=this.Pb[1],(a=(s=t.rows[t.Ka++]).Aa).va=0,a.wa=0,a.xa=0,a.Ba=0,a.Ca=0,a.Da=0,a.aa=0,a.ba=0,a.ca=0,a.ea=0,a.fa=0,a.ga=0,s.Fa=0,s.Ma=0,s.Ia=0,s.Ha=0,s.motorSpeed=0,s.fb=0,s.ta=b,(b=s).Fa=r,b.Ma=0,b.Ia=-1/0,b.Ha=1/0,(b=b.Aa).va=0,b.wa=1,b.xa=0,b.Ba=0,b.Ca=1,b.Da=0,b.aa=-h,b.ba=-0,b.ca=-c,b.ea=-f,b.fa=-0,b.ga=-m,b=this.Pb[2],(h=(r=t.rows[t.Ka++]).Aa).va=0,h.wa=0,h.xa=0,h.Ba=0,h.Ca=0,h.Da=0,h.aa=0,h.ba=0,h.ca=0,h.ea=0,h.fa=0,h.ga=0,r.Fa=0,r.Ma=0,r.Ia=0,r.Ha=0,r.motorSpeed=0,r.fb=0,r.ta=b,(b=r).Fa=v,b.Ma=0,b.Ia=-1/0,b.Ha=1/0,(b=b.Aa).va=0,b.wa=0,b.xa=1,b.Ba=0,b.Ca=0,b.Da=1,b.aa=-l,b.ba=-u,b.ca=-0,b.ea=-g,b.fa=-y,b.ga=-0,0<this.Nj&&(0>=this.$k.frequency||!i)&&(b=this.Pb[3],(l=(v=t.rows[t.Ka++]).Aa).va=0,l.wa=0,l.xa=0,l.Ba=0,l.Ca=0,l.Da=0,l.aa=0,l.ba=0,l.ca=0,l.ea=0,l.fa=0,l.ga=0,v.Fa=0,v.Ma=0,v.Ia=0,v.Ha=0,v.motorSpeed=0,v.fb=0,v.ta=b,b=v,v=this.Nj,g=this.nl,u=this.$k,l=yt.angularSlop,i?(u=0,y=1):(0<u.frequency?(l=0,h=6.28318530717958*u.frequency,(r=u.dampingRatio)<yt.minSpringDamperDampingRatio&&(r=yt.minSpringDamperDampingRatio),y=e.dt,r=2*r*h,h*=h,u.useSymplecticEuler?(u=1/(y*r),y=h/r):(u=1/(y*(y*h+r)),y=h/(y*h+r))):(u=0,y=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0),0<g.motorTorque?(b.motorSpeed=g.motorSpeed,b.fb=g.motorTorque*e.dt):(b.motorSpeed=0,b.fb=0)),v=((v-(h=.5*((r=g.lowerLimit)+(g=g.upperLimit)))+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,v+=h,r>g?v=c=h=0:r==g?(h=-1/0,c=1/0,v-=r):v<r?(h=-1/0,c=0,0<(v=v-r+l)&&(v=0)):v>g?(h=0,c=1/0,0>(v=v-g-l)&&(v=0)):v=c=h=0,b.Ia=h,b.Ha=c,b.Ma=u*(M?1/M:0),b.Fa=v*y,(b=b.Aa).aa=this.je,b.ba=this.ke,b.ca=this.le,b.ea=this.je,b.fa=this.ke,b.ga=this.le),(0>=this.fl.frequency||!i)&&(M=this.Pb[4],(b=(t=t.rows[t.Ka++]).Aa).va=0,b.wa=0,b.xa=0,b.Ba=0,b.Ca=0,b.Da=0,b.aa=0,b.ba=0,b.ca=0,b.ea=0,b.fa=0,b.ga=0,t.Fa=0,t.Ma=0,t.Ia=0,t.Ha=0,t.motorSpeed=0,t.fb=0,t.ta=M,b=t,t=this.tj,v=this.el,l=this.fl,M=yt.angularSlop,i?(i=0,l=1):(0<l.frequency?(M=0,i=6.28318530717958*l.frequency,(g=l.dampingRatio)<yt.minSpringDamperDampingRatio&&(g=yt.minSpringDamperDampingRatio),u=e.dt,g=2*g*i,y=i*i,l.useSymplecticEuler?(i=1/(u*g),l=y/g):(i=1/(u*(u*y+g)),l=y/(u*y+g))):(i=0,l=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0),0<v.motorTorque?(b.motorSpeed=v.motorSpeed,b.fb=v.motorTorque*e.dt):(b.motorSpeed=0,b.fb=0)),t=((t-(u=.5*((e=v.lowerLimit)+(v=v.upperLimit)))+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,t+=u,e>v?e=g=u=0:e==v?(u=-1/0,g=1/0,e=t-e):t<e?(u=-1/0,g=0,0<(e=t-e+M)&&(e=0)):t>v?(u=0,g=1/0,0>(e=t-v-M)&&(e=0)):e=g=u=0,b.Ia=u,b.Ha=g,b.Ma=i*(n?1/n:0),b.Fa=e*l,(b=b.Aa).aa=this.gi,b.ba=this.hi,b.ca=this.ii,b.ea=this.gi,b.fa=this.hi,b.ga=this.ii)},hd:function(){var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M;O.prototype.hd.call(this),t=this.vb,e=this.wb,i=this.xb,s=this.bc,r=this.cc,n=this.dc,a=this.vb,o=this.He,h=this.Hh,c=this.wb,l=this.Ie,u=this.Ih,p=this.xb,d=this.Je,f=this.Jh,-.999999999>(x=t*s+e*r+i*n)?(r=i*i,(b=t*t)<(s=e*e)?b<r?(b=0,i*=s=1/Math.sqrt(s+r),t=-e*s):(b=e*(s=1/Math.sqrt(b+s)),i=-t*s,t=0):s<r?(b=-i*(s=1/Math.sqrt(r+b)),i=0,t*=s):(b=e*(s=1/Math.sqrt(b+s)),i=-t*s,t=0),m=b,g=i,y=t,v=0):(m=(e*n-i*r)*(x=.5/(b=Math.sqrt(.5*(1+x)))),g=(i*s-t*n)*x,y=(t*r-e*s)*x,v=b),_=(x=m)*(r=2*x),M=(n=g)*(i=2*n),s=(b=y)*(e=2*b),b=x*i,n*=e,x*=e;var w=(t=v)*r,S=t*i;r=t*e,t=1-M-s,e=b-r,i=x+S,b+=r,s=1-_-s,r=n-w,x-=S,n+=w,_=1-_-M,this.kj=2*(-1>=v?3.14159265358979:1<=v?0:Math.acos(v)),v=m,M=y,y=t*this.ve+b*this.we+x*this.xe,w=e*this.ve+s*this.we+n*this.xe,m=i*this.ve+r*this.we+_*this.xe,this.tj=Math.atan2(this.Hh*y+this.Ih*w+this.Jh*m,this.He*y+this.Ie*w+this.Je*m),this.gi=this.vb+this.bc,this.hi=this.wb+this.cc,this.ii=this.xb+this.dc,0<(m=this.gi*this.gi+this.hi*this.hi+this.ii*this.ii)&&(m=1/Math.sqrt(m)),this.gi*=m,this.hi*=m,this.ii*=m,0<(y=Math.sqrt(v*v+g*g+M*M))&&(y=1/y),m=o*(v*=y*this.kj)+l*(g*=y*this.kj)+d*(M*=y*this.kj),g=h*v+u*g+f*M,(v=m*m*(y=1/((y=this.bk)*y))+g*g*(M=1/((v=this.ck)*v)))?(S=(v=m*(w=Math.sqrt(1/v)))*y,M*=w*=g,0<(m=(m-v)*(S*=y=1/Math.sqrt(S*S+M*M))+(g-w)*(M*=y))?(this.Nj=m,this.je=0,this.ke=S,this.le=M,a=a*this.je+o*this.ke+h*this.le,c=c*this.je+l*this.ke+u*this.le,p=p*this.je+d*this.ke+f*this.le,this.je=a,this.ke=c,this.le=p,p=t*this.je+e*this.ke+i*this.le,d=b*this.je+s*this.ke+r*this.le,f=x*this.je+n*this.ke+_*this.le,this.je=p,this.ke=d,this.le=f):this.Nj=0):this.Nj=this.le=this.ke=this.je=0,this.Mj=this.Rf-this.Of,this.Df=this.Sf-this.Pf,this.Ef=this.Tf-this.Qf},$d:function(t,e){O.prototype.$d.call(this,t,e),this.Ud(e,t,!1)},gd:function(t){O.prototype.gd.call(this,t),this.Ud(t,null,!0)},Eg:function(){var t=new bt;return t.x=this.vb,t.y=this.wb,t.z=this.xb,t},Gg:function(){var t=new bt;return t.x=this.bc,t.y=this.cc,t.z=this.dc,t},Fg:function(t){t.x=this.vb,t.y=this.wb,t.z=this.xb},Hg:function(t){t.x=this.bc,t.y=this.cc,t.z=this.dc},Ig:function(){var t=new bt;return t.x=this.qa,t.y=this.ra,t.z=this.sa,t},Kg:function(){var t=new bt;return t.x=this.nb,t.y=this.ob,t.z=this.pb,t},Jg:function(t){t.x=this.qa,t.y=this.ra,t.z=this.sa},Lg:function(t){t.x=this.nb,t.y=this.ob,t.z=this.pb},Mn:function(){return this.fl},Ln:function(){return this.el},Gn:function(){return this.$k},En:function(){var t=new bt;return t.x=this.je,t.y=this.ke,t.z=this.le,t},Fn:function(t){t.x=this.je,t.y=this.ke,t.z=this.le},Dn:function(){return this.kj},Kn:function(){return this.tj}}),A.ua=D,A.prototype=oe(D.prototype,{za:function(t,e,i,s,r){var n,a,o,h;return this.fh(t,e,i),n=s.x,a=s.y,o=s.z,i=t.a.o*n+t.a.i*a+t.a.l*o,h=t.a.f*n+t.a.m*a+t.a.g*o,n=t.a.h*n+t.a.j*a+t.a.s*o,(a=this.localTwistAxis1).x=i,a.y=h,a.z=n,h=s.x,n=s.y,a=s.z,s=e.a.o*h+e.a.i*n+e.a.l*a,i=e.a.f*h+e.a.m*n+e.a.g*a,e=e.a.h*h+e.a.j*n+e.a.s*a,(h=this.localTwistAxis2).x=s,h.y=i,h.z=e,s=r.x,i=r.y,h=r.z,r=t.a.o*s+t.a.i*i+t.a.l*h,e=t.a.f*s+t.a.m*i+t.a.g*h,t=t.a.h*s+t.a.j*i+t.a.s*h,(s=this.localSwingAxis1).x=r,s.y=e,s.z=t,this}}),S.ua=O,S.prototype=oe(O.prototype,{Ud:function(t,e,i){var s,r,n=i?1:this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;s=this.Mj*n,r=this.Df*n;var a,o,h,c,l,u,p,d,f,m,g,y,v=this.Ef*n,b=this.Ee*n;n=this.Fe*n,a=-this.Ub,o=this.Tb,h=this.Ub,c=-this.Sb,l=-this.Tb,u=this.Sb,p=-this.Xb,d=this.Wb,f=this.Xb,m=-this.Vb,g=-this.Wb,y=this.Vb;var x=this.da.cd,_=this.da.dd,M=this.da.ed,w=(this.C.P*x+this.C.R*_+this.C.S*M)*x+(this.C.T*x+this.C.U*_+this.C.V*M)*_+(this.C.W*x+this.C.X*_+this.C.Y*M)*M,S=(this.D.P*x+this.D.R*_+this.D.S*M)*x+(this.D.T*x+this.D.U*_+this.D.V*M)*_+(this.D.W*x+this.D.X*_+this.D.Y*M)*M;if(0<w){var A=x*this.Sb+_*this.Tb+M*this.Ub;0<(A=this.Sb*this.Sb+this.Tb*this.Tb+this.Ub*this.Ub-A*A)&&(w=0<this.C.$a?1/(1/w+this.C.Pc*A):0)}0<S&&(x=x*this.Vb+_*this.Wb+M*this.Xb,0<(x=this.Vb*this.Vb+this.Wb*this.Wb+this.Xb*this.Xb-x*x)&&(S=0<this.D.$a?1/(1/S+this.D.Pc*x):0)),w=w+S?1/(w+S):0,S=this.Pb[0],(_=(x=t.rows[t.Ka++]).Aa).va=0,_.wa=0,_.xa=0,_.Ba=0,_.Ca=0,_.Da=0,_.aa=0,_.ba=0,_.ca=0,_.ea=0,_.fa=0,_.ga=0,x.Fa=0,x.Ma=0,x.Ia=0,x.Ha=0,x.motorSpeed=0,x.fb=0,x.ta=S,(S=x).Fa=s,S.Ma=0,S.Ia=-1/0,S.Ha=1/0,(S=S.Aa).va=1,S.wa=0,S.xa=0,S.Ba=1,S.Ca=0,S.Da=0,S.aa=-0,S.ba=-a,S.ca=-o,S.ea=-0,S.fa=-p,S.ga=-d,S=this.Pb[1],(a=(s=t.rows[t.Ka++]).Aa).va=0,a.wa=0,a.xa=0,a.Ba=0,a.Ca=0,a.Da=0,a.aa=0,a.ba=0,a.ca=0,a.ea=0,a.fa=0,a.ga=0,s.Fa=0,s.Ma=0,s.Ia=0,s.Ha=0,s.motorSpeed=0,s.fb=0,s.ta=S,(S=s).Fa=r,S.Ma=0,S.Ia=-1/0,S.Ha=1/0,(S=S.Aa).va=0,S.wa=1,S.xa=0,S.Ba=0,S.Ca=1,S.Da=0,S.aa=-h,S.ba=-0,S.ca=-c,S.ea=-f,S.fa=-0,S.ga=-m,r=this.Pb[2],(h=(S=t.rows[t.Ka++]).Aa).va=0,h.wa=0,h.xa=0,h.Ba=0,h.Ca=0,h.Da=0,h.aa=0,h.ba=0,h.ca=0,h.ea=0,h.fa=0,h.ga=0,S.Fa=0,S.Ma=0,S.Ia=0,S.Ha=0,S.motorSpeed=0,S.fb=0,S.ta=r,S.Fa=v,S.Ma=0,S.Ia=-1/0,S.Ha=1/0,(S=S.Aa).va=0,S.wa=0,S.xa=1,S.Ba=0,S.Ca=0,S.Da=1,S.aa=-l,S.ba=-u,S.ca=-0,S.ea=-g,S.fa=-y,S.ga=-0,(0>=this.Ce.frequency||!i)&&(v=this.Pb[3],(u=(l=t.rows[t.Ka++]).Aa).va=0,u.wa=0,u.xa=0,u.Ba=0,u.Ca=0,u.Da=0,u.aa=0,u.ba=0,u.ca=0,u.ea=0,u.fa=0,u.ga=0,l.Fa=0,l.Ma=0,l.Ia=0,l.Ha=0,l.motorSpeed=0,l.fb=0,l.ta=v,S=l,v=this.angle,u=this.Rh,g=this.Ce,l=yt.angularSlop,i?(i=0,g=1):(0<g.frequency?(l=0,i=6.28318530717958*g.frequency,(r=g.dampingRatio)<yt.minSpringDamperDampingRatio&&(r=yt.minSpringDamperDampingRatio),y=e.dt,r=2*r*i,h=i*i,g.useSymplecticEuler?(i=1/(y*r),g=h/r):(i=1/(y*(y*h+r)),g=h/(y*h+r))):(i=0,g=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0),0<u.motorTorque?(S.motorSpeed=u.motorSpeed,S.fb=u.motorTorque*e.dt):(S.motorSpeed=0,S.fb=0)),v=((v-(y=.5*((e=u.lowerLimit)+(u=u.upperLimit)))+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979+y,e>u?e=r=y=0:e==u?(y=-1/0,r=1/0,e=v-e):v<e?(y=-1/0,r=0,0<(e=v-e+l)&&(e=0)):v>u?(y=0,r=1/0,0>(e=v-u-l)&&(e=0)):e=r=y=0,S.Ia=y,S.Ha=r,S.Ma=i*(w?1/w:0),S.Fa=e*g,(S=S.Aa).aa=this.da.cd,S.ba=this.da.dd,S.ca=this.da.ed,S.ea=this.da.cd,S.fa=this.da.dd,S.ga=this.da.ed),e=this.Pb[4],(i=(w=t.rows[t.Ka++]).Aa).va=0,i.wa=0,i.xa=0,i.Ba=0,i.Ca=0,i.Da=0,i.aa=0,i.ba=0,i.ca=0,i.ea=0,i.fa=0,i.ga=0,w.Fa=0,w.Ma=0,w.Ia=0,w.Ha=0,w.motorSpeed=0,w.fb=0,w.ta=e,(S=w).Fa=b,S.Ma=0,S.Ia=-1/0,S.Ha=1/0,(S=S.Aa).aa=this.da.Qd,S.ba=this.da.Rd,S.ca=this.da.Sd,S.ea=this.da.Qd,S.fa=this.da.Rd,S.ga=this.da.Sd,b=this.Pb[5],(e=(t=t.rows[t.Ka++]).Aa).va=0,e.wa=0,e.xa=0,e.Ba=0,e.Ca=0,e.Da=0,e.aa=0,e.ba=0,e.ca=0,e.ea=0,e.fa=0,e.ga=0,t.Fa=0,t.Ma=0,t.Ia=0,t.Ha=0,t.motorSpeed=0,t.fb=0,t.ta=b,(S=t).Fa=n,S.Ma=0,S.Ia=-1/0,S.Ha=1/0,(S=S.Aa).aa=this.da.me,S.ba=this.da.ne,S.ca=this.da.oe,S.ea=this.da.me,S.fa=this.da.ne,S.ga=this.da.oe},hd:function(){O.prototype.hd.call(this);var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w,S,A,T,C,L,E,z,R,B,P,D,I,F,G=this.da,N=G.$.C.$a,j=G.$.D.$a;if(-.999999999>(tt=G.$.vb*G.$.bc+G.$.wb*G.$.cc+G.$.xb*G.$.dc)){var V,U,k,H,W=G.$.vb,q=G.$.wb,$=G.$.xb,J=W*W,X=q*q,Y=$*$;J<X?J<Y?(V=0,U=$*(H=1/Math.sqrt(X+Y)),k=-q*H):(V=q*(H=1/Math.sqrt(J+X)),U=-W*H,k=0):X<Y?(V=-$*(H=1/Math.sqrt(Y+J)),U=0,k=W*H):(V=q*(H=1/Math.sqrt(J+X)),U=-W*H,k=0),t=V,e=U,i=k,s=0}else{var K,Z,Q;K=G.$.wb*G.$.dc-G.$.xb*G.$.cc,Z=G.$.xb*G.$.bc-G.$.vb*G.$.dc,Q=G.$.vb*G.$.cc-G.$.wb*G.$.bc;var tt,et=Math.sqrt(.5*(1+tt));t=K*=tt=.5/et,e=Z*=tt,i=Q*=tt,s=et}R=z=E=0;var it=E*(P=t)+z*(D=e)+R*(I=i)+(B=1)*(F=s);if(0>it&&(it=-it,P=-P,D=-D,I=-I,F=-F),.999999<it){var st=(P=E+N/(N+j)*(P-E))*P+(D=z+N/(N+j)*(D-z))*D+(I=R+N/(N+j)*(I-R))*I+(F=B+N/(N+j)*(F-B))*F;1e-32<st&&(st=1/Math.sqrt(st)),r=P*st,n=D*st,a=I*st,o=F*st}else{var rt=N/(N+j)*Math.acos(it),nt=(P+=E*-it)*P+(D+=z*-it)*D+(I+=R*-it)*I+(F+=B*-it)*F;1e-32<nt&&(nt=1/Math.sqrt(nt)),P*=nt,D*=nt,I*=nt,F*=nt;var at=Math.sin(rt),ot=Math.cos(rt);r=(E*=ot)+P*at,n=(z*=ot)+D*at,a=(R*=ot)+I*at,o=(B*=ot)+F*at}var ht,ct,lt=2*r,ut=2*n,pt=2*a,dt=r*lt,ft=n*ut,mt=a*pt,gt=r*ut,yt=n*pt,vt=r*pt,bt=o*lt,xt=o*ut,_t=o*pt;if(h=gt-_t,c=vt+xt,l=gt+_t,u=1-dt-mt,p=yt-bt,d=vt-xt,f=yt+bt,m=1-dt-ft,ht=(1-ft-mt)*G.$.vb+h*G.$.wb+c*G.$.xb,ct=l*G.$.vb+u*G.$.wb+p*G.$.xb,g=d*G.$.vb+f*G.$.wb+m*G.$.xb,w=G.cd,S=G.dd,A=G.ed,T=G.Qd,C=G.Rd,L=G.Sd,-.999999999>(Bt=w*ht+S*ct+A*g)){var Mt,wt,St,At,Tt=w*w,Ct=S*S,Lt=A*A;Tt<Ct?Tt<Lt?(Mt=0,wt=A*(At=1/Math.sqrt(Ct+Lt)),St=-S*At):(Mt=S*(At=1/Math.sqrt(Tt+Ct)),wt=-w*At,St=0):Ct<Lt?(Mt=-A*(At=1/Math.sqrt(Lt+Tt)),wt=0,St=w*At):(Mt=S*(At=1/Math.sqrt(Tt+Ct)),wt=-w*At,St=0),r=Mt,n=wt,a=St,o=0}else{var Et,zt,Rt;Et=S*g-A*ct,zt=A*ht-w*g,Rt=w*ct-S*ht;var Bt,Pt=Math.sqrt(.5*(1+Bt));r=Et*=Bt=.5/Pt,n=zt*=Bt,a=Rt*=Bt,o=Pt}var Dt,It,Ot,Ft=2*r,Gt=2*n,Nt=2*a,jt=r*Ft,Vt=n*Gt,Ut=a*Nt,kt=r*Gt,Ht=n*Nt,Wt=r*Nt,qt=o*Ft,$t=o*Gt,Jt=o*Nt;if(1e-6<(x=ct*(b=(d=Wt-$t)*T+(f=Ht+qt)*C+(m=1-jt-Vt)*L)-g*(v=(l=kt+Jt)*T+(u=1-jt-Ut)*C+(p=Ht-qt)*L))*x+(_=g*(y=(1-Vt-Ut)*T+(h=kt-Jt)*C+(c=Wt+$t)*L)-ht*b)*_+(M=ht*v-ct*y)*M){var Xt=x*x+_*_+M*M;0<Xt&&(Xt=1/Math.sqrt(Xt)),x*=Xt,_*=Xt,M*=Xt}else{var Yt,Kt=ht*ht,Zt=ct*ct,Qt=g*g;Kt<Zt?Kt<Qt?(x=0,_=g*(Yt=1/Math.sqrt(Zt+Qt)),M=-ct*Yt):(x=ct*(Yt=1/Math.sqrt(Kt+Zt)),_=-ht*Yt,M=0):Zt<Qt?(x=-g*(Yt=1/Math.sqrt(Qt+Kt)),_=0,M=ht*Yt):(x=ct*(Yt=1/Math.sqrt(Kt+Zt)),_=-ht*Yt,M=0)}y=_*g-M*ct,v=M*ht-x*g,b=x*ct-_*ht,G.cd=ht,G.dd=ct,G.ed=g,G.Qd=y,G.Rd=v,G.Sd=b,G.me=x,G.ne=_,G.oe=M,Dt=this.wb*this.dc-this.xb*this.cc,It=this.xb*this.bc-this.vb*this.dc,Ot=this.vb*this.cc-this.wb*this.bc;var te,ee,ie,se=this.vb*this.bc+this.wb*this.cc+this.xb*this.dc,re=-1>=se?3.14159265358979:1<=se?0:Math.acos(se),ne=Dt*Dt+It*It+Ot*Ot;0<ne&&(ne=1/Math.sqrt(ne)),Dt*=ne,It*=ne,Ot*=ne,Dt*=re,It*=re,Ot*=re,this.Ee=Dt*this.da.Qd+It*this.da.Rd+Ot*this.da.Sd,this.Fe=Dt*this.da.me+It*this.da.ne+Ot*this.da.oe,te=this.Ie*this.xe-this.Je*this.we,ee=this.Je*this.ve-this.He*this.xe,ie=this.He*this.we-this.Ie*this.ve,se=this.He*this.ve+this.Ie*this.we+this.Je*this.xe,this.angle=-1>=se?3.14159265358979:1<=se?0:Math.acos(se),0>te*this.da.cd+ee*this.da.dd+ie*this.da.ed&&(this.angle=-this.angle),this.Mj=this.Rf-this.Of,this.Df=this.Sf-this.Pf,this.Ef=this.Tf-this.Qf},$d:function(t,e){O.prototype.$d.call(this,t,e),this.Ud(e,t,!1)},gd:function(t){O.prototype.gd.call(this,t),this.Ud(t,null,!0)},Eg:function(){var t=new bt;return t.x=this.vb,t.y=this.wb,t.z=this.xb,t},Gg:function(){var t=new bt;return t.x=this.bc,t.y=this.cc,t.z=this.dc,t},Fg:function(t){t.x=this.vb,t.y=this.wb,t.z=this.xb},Hg:function(t){t.x=this.bc,t.y=this.cc,t.z=this.dc},Ig:function(){var t=new bt;return t.x=this.qa,t.y=this.ra,t.z=this.sa,t},Kg:function(){var t=new bt;return t.x=this.nb,t.y=this.ob,t.z=this.pb,t},Jg:function(t){t.x=this.qa,t.y=this.ra,t.z=this.sa},Lg:function(t){t.x=this.nb,t.y=this.ob,t.z=this.pb},Cj:function(){return this.Ce},ql:function(){return this.Rh},ol:function(){return this.angle}}),w.ua=D,w.prototype=oe(D.prototype,{za:function(t,e,i,s){var r,n,a,o;return this.fh(t,e,i),r=s.x,n=s.y,a=s.z,i=t.a.o*r+t.a.i*n+t.a.l*a,o=t.a.f*r+t.a.m*n+t.a.g*a,t=t.a.h*r+t.a.j*n+t.a.s*a,(r=this.localAxis1).x=i,r.y=o,r.z=t,o=s.x,t=s.y,r=s.z,s=e.a.o*o+e.a.i*t+e.a.l*r,i=e.a.f*o+e.a.m*t+e.a.g*r,e=e.a.h*o+e.a.j*t+e.a.s*r,(o=this.localAxis2).x=s,o.y=i,o.z=e,this}}),M.prototype={ua:function(t,e){return this.lowerLimit=t,this.upperLimit=e,this},cb:function(t,e){return this.motorSpeed=t,this.motorTorque=e,this},clone:function(){var t=new M;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}},_.ua=O,_.prototype=oe(O.prototype,{Ud:function(t,e,i){if(!(0<this.Ce.frequency&&i)){var s,r,n,a,o,h,c,l,u,p,d,f,m,g;if(s=this.Rf-this.Of,r=this.Sf-this.Pf,n=this.Tf-this.Qf,0<this.Ce.frequency){a=6.28318530717958*this.Ce.frequency,(i=this.Ce.dampingRatio)<yt.minSpringDamperDampingRatio&&(i=yt.minSpringDamperDampingRatio),e=e.dt,i=2*i*a;var y=a*a;this.Ce.useSymplecticEuler?(a=1/(e*i),e=y/i):(a=1/(e*(e*y+i)),e=y/(e*y+i)),a*=this.C.$a+this.D.$a}else a=0,e=i?1:this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;o=-this.Ub,h=this.Tb,c=this.Ub,l=-this.Sb,i=-this.Tb,y=this.Sb,u=-this.Xb,p=this.Wb,d=this.Xb,f=-this.Vb,m=-this.Wb,g=this.Vb;var v=this.Pb[0],b=t.rows[t.Ka++],x=b.Aa;x.va=0,x.wa=0,x.xa=0,x.Ba=0,x.Ca=0,x.Da=0,x.aa=0,x.ba=0,x.ca=0,x.ea=0,x.fa=0,x.ga=0,b.Fa=0,b.Ma=0,b.Ia=0,b.Ha=0,b.motorSpeed=0,b.fb=0,b.ta=v,(v=b).Fa=s*e,v.Ma=a,v.Ia=-1/0,v.Ha=1/0,(s=v.Aa).va=1,s.wa=0,s.xa=0,s.Ba=1,s.Ca=0,s.Da=0,s.aa=-0,s.ba=-o,s.ca=-h,s.ea=-0,s.fa=-u,s.ga=-p,s=this.Pb[1],(h=(o=t.rows[t.Ka++]).Aa).va=0,h.wa=0,h.xa=0,h.Ba=0,h.Ca=0,h.Da=0,h.aa=0,h.ba=0,h.ca=0,h.ea=0,h.fa=0,h.ga=0,o.Fa=0,o.Ma=0,o.Ia=0,o.Ha=0,o.motorSpeed=0,o.fb=0,o.ta=s,(v=o).Fa=r*e,v.Ma=a,v.Ia=-1/0,v.Ha=1/0,(s=v.Aa).va=0,s.wa=1,s.xa=0,s.Ba=0,s.Ca=1,s.Da=0,s.aa=-c,s.ba=-0,s.ca=-l,s.ea=-d,s.fa=-0,s.ga=-f,r=this.Pb[2],(s=(t=t.rows[t.Ka++]).Aa).va=0,s.wa=0,s.xa=0,s.Ba=0,s.Ca=0,s.Da=0,s.aa=0,s.ba=0,s.ca=0,s.ea=0,s.fa=0,s.ga=0,t.Fa=0,t.Ma=0,t.Ia=0,t.Ha=0,t.motorSpeed=0,t.fb=0,t.ta=r,(v=t).Fa=n*e,v.Ma=a,v.Ia=-1/0,v.Ha=1/0,(s=v.Aa).va=0,s.wa=0,s.xa=1,s.Ba=0,s.Ca=0,s.Da=1,s.aa=-i,s.ba=-y,s.ca=-0,s.ea=-m,s.fa=-g,s.ga=-0}},$d:function(t,e){O.prototype.$d.call(this,t,e),this.Ud(e,t,!1)},gd:function(t){O.prototype.gd.call(this,t),this.Ud(t,null,!0)},Cj:function(){return this.Ce}}),x.ua=D,x.prototype=oe(D.prototype,{za:function(t,e,i){return this.fh(t,e,i),this}}),b.prototype={ua:function(t,e){return this.frequency=t,this.dampingRatio=e,this},cb:function(t){return this.useSymplecticEuler=t,this},clone:function(){var t=new b;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}},v.prototype={ua:function(t,e){return this.lowerLimit=t,this.upperLimit=e,this},cb:function(t,e){return this.motorSpeed=t,this.motorForce=e,this},clone:function(){var t=new v;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}},y.ua=O,y.prototype=oe(O.prototype,{Ud:function(t,e,i){var s,r,n=i?1:this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;s=this.Mj*n,r=this.Df*n;var a,o,h,c,l,u,p,d,f,m,g,y,v,b,x,_,M,w,S=this.Ef*n,A=this.Pl*n;m=f=0,a=-(a=0),o=-(o=-this.Ub),h=-(h=this.Tb),c=-(c=this.Ub),l=-(l=0),u=-(u=-this.Sb),p=-(p=-this.Tb),d=-(d=this.Sb),f=-f,m=-m,g=-(g=-this.Xb),y=-(y=this.Wb),v=-(v=this.Xb),b=-(b=0),x=-(x=-this.Vb),_=-(_=-this.Wb),M=-(M=this.Vb),w=-(w=0);var T=this.fg,C=this.gg,L=this.hg,E=(this.C.P*T+this.C.R*C+this.C.S*L)*T+(this.C.T*T+this.C.U*C+this.C.V*L)*C+(this.C.W*T+this.C.X*C+this.C.Y*L)*L,z=(this.D.P*T+this.D.R*C+this.D.S*L)*T+(this.D.T*T+this.D.U*C+this.D.V*L)*C+(this.D.W*T+this.D.X*C+this.D.Y*L)*L;if(0<E){var R=T*this.Sb+C*this.Tb+L*this.Ub,B=this.Sb*this.Sb+this.Tb*this.Tb+this.Ub*this.Ub-R*R;0<B&&(E=0<this.C.$a?1/(1/E+this.C.Pc*B):0)}if(0<z){var P=T*this.Vb+C*this.Wb+L*this.Xb,D=this.Vb*this.Vb+this.Wb*this.Wb+this.Xb*this.Xb-P*P;0<D&&(z=0<this.D.$a?1/(1/z+this.D.Pc*D):0)}var I=E+z?1/(E+z):0,O=this.ig,F=this.jg,G=this.kg,N=(this.C.P*O+this.C.R*F+this.C.S*G)*O+(this.C.T*O+this.C.U*F+this.C.V*G)*F+(this.C.W*O+this.C.X*F+this.C.Y*G)*G,j=(this.D.P*O+this.D.R*F+this.D.S*G)*O+(this.D.T*O+this.D.U*F+this.D.V*G)*F+(this.D.W*O+this.D.X*F+this.D.Y*G)*G;if(0<N){var V=O*this.Sb+F*this.Tb+G*this.Ub,U=this.Sb*this.Sb+this.Tb*this.Tb+this.Ub*this.Ub-V*V;0<U&&(N=0<this.C.$a?1/(1/N+this.C.Pc*U):0)}if(0<j){var k=O*this.Vb+F*this.Wb+G*this.Xb,H=this.Vb*this.Vb+this.Wb*this.Wb+this.Xb*this.Xb-k*k;0<H&&(j=0<this.D.$a?1/(1/j+this.D.Pc*H):0)}var W=N+j?1/(N+j):0,q=this.Pb[0],J=t.rows[t.Ka++],X=J.Aa;X.va=0,X.wa=0,X.xa=0,X.Ba=0,X.Ca=0,X.Da=0,X.aa=0,X.ba=0,X.ca=0,X.ea=0,X.fa=0,X.ga=0,J.Fa=0,J.Ma=0,J.Ia=0,J.Ha=0,J.motorSpeed=0,J.fb=0,J.ta=q,(ht=J).Fa=s,ht.Ma=0,ht.Ia=-1/0,ht.Ha=1/0;var Y=ht.Aa;Y.va=1,Y.wa=0,Y.xa=0,Y.Ba=1,Y.Ca=0,Y.Da=0,Y.aa=a,Y.ba=o,Y.ca=h,Y.ea=m,Y.fa=g,Y.ga=y;var K=this.Pb[1],Z=t.rows[t.Ka++],Q=Z.Aa;Q.va=0,Q.wa=0,Q.xa=0,Q.Ba=0,Q.Ca=0,Q.Da=0,Q.aa=0,Q.ba=0,Q.ca=0,Q.ea=0,Q.fa=0,Q.ga=0,Z.Fa=0,Z.Ma=0,Z.Ia=0,Z.Ha=0,Z.motorSpeed=0,Z.fb=0,Z.ta=K,(ht=Z).Fa=r,ht.Ma=0,ht.Ia=-1/0,ht.Ha=1/0,(Y=ht.Aa).va=0,Y.wa=1,Y.xa=0,Y.Ba=0,Y.Ca=1,Y.Da=0,Y.aa=c,Y.ba=l,Y.ca=u,Y.ea=v,Y.fa=b,Y.ga=x;var tt=this.Pb[2],et=t.rows[t.Ka++],it=et.Aa;if(it.va=0,it.wa=0,it.xa=0,it.Ba=0,it.Ca=0,it.Da=0,it.aa=0,it.ba=0,it.ca=0,it.ea=0,it.fa=0,it.ga=0,et.Fa=0,et.Ma=0,et.Ia=0,et.Ha=0,et.motorSpeed=0,et.fb=0,et.ta=tt,(ht=et).Fa=S,ht.Ma=0,ht.Ia=-1/0,ht.Ha=1/0,(Y=ht.Aa).va=0,Y.wa=0,Y.xa=1,Y.Ba=0,Y.Ca=0,Y.Da=1,Y.aa=p,Y.ba=d,Y.ca=f,Y.ea=_,Y.fa=M,Y.ga=w,!this.Jm&&(0>=this.Yk.frequency||!i)){var st=this.Pb[3],rt=t.rows[t.Ka++],nt=rt.Aa;nt.va=0,nt.wa=0,nt.xa=0,nt.Ba=0,nt.Ca=0,nt.Da=0,nt.aa=0,nt.ba=0,nt.ca=0,nt.ea=0,nt.fa=0,nt.ga=0,rt.Fa=0,rt.Ma=0,rt.Ia=0,rt.Ha=0,rt.motorSpeed=0,rt.fb=0,rt.ta=st;var at,ot,ht=rt,ct=this.Ni,lt=this.Qk,ut=this.Yk,pt=yt.angularSlop;if(i)at=0,ot=1;else{if(0<ut.frequency){pt=0;var dt=6.28318530717958*ut.frequency,ft=ut.dampingRatio;ft<yt.minSpringDamperDampingRatio&&(ft=yt.minSpringDamperDampingRatio);var mt=e.dt,gt=2*ft*dt,vt=dt*dt;ut.useSymplecticEuler?(at=1/(mt*gt),ot=vt/gt):(at=1/(mt*(mt*vt+gt)),ot=vt/(mt*vt+gt))}else at=0,ot=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;0<lt.motorTorque?(ht.motorSpeed=lt.motorSpeed,ht.fb=lt.motorTorque*e.dt):(ht.motorSpeed=0,ht.fb=0)}var bt,xt,_t,Mt=lt.lowerLimit,wt=lt.upperLimit,St=.5*(Mt+wt);ct=(ct=((3.14159265358979+(ct-=St))%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979)+St,Mt>wt?_t=xt=bt=0:Mt==wt?(bt=-1/0,xt=1/0,_t=ct-Mt):ct<Mt?(bt=-1/0,xt=0,0<(_t=ct-Mt+pt)&&(_t=0)):ct>wt?(bt=0,xt=1/0,0>(_t=ct-wt-pt)&&(_t=0)):_t=xt=bt=0;var At=I?1/I:0;ht.Ia=bt,ht.Ha=xt,ht.Ma=at*At,ht.Fa=_t*ot,(Y=ht.Aa).aa=this.fg,Y.ba=this.gg,Y.ca=this.hg,Y.ea=this.fg,Y.fa=this.gg,Y.ga=this.hg}if(!this.Km){var Tt=this.Pb[4],Ct=t.rows[t.Ka++],Lt=Ct.Aa;Lt.va=0,Lt.wa=0,Lt.xa=0,Lt.Ba=0,Lt.Ca=0,Lt.Da=0,Lt.aa=0,Lt.ba=0,Lt.ca=0,Lt.ea=0,Lt.fa=0,Lt.ga=0,Ct.Fa=0,Ct.Ma=0,Ct.Ia=0,Ct.Ha=0,Ct.motorSpeed=0,Ct.fb=0,Ct.ta=Tt,(ht=Ct).Fa=A,ht.Ma=0,ht.Ia=-1/0,ht.Ha=1/0,(Y=ht.Aa).aa=this.Yg,Y.ba=this.Zg,Y.ca=this.$g,Y.ea=this.Yg,Y.fa=this.Zg,Y.ga=this.$g}if(!this.Lm&&(0>=this.Zk.frequency||!i)){var Et=this.Pb[5],zt=t.rows[t.Ka++],Rt=zt.Aa;Rt.va=0,Rt.wa=0,Rt.xa=0,Rt.Ba=0,Rt.Ca=0,Rt.Da=0,Rt.aa=0,Rt.ba=0,Rt.ca=0,Rt.ea=0,Rt.fa=0,Rt.ga=0,zt.Fa=0,zt.Ma=0,zt.Ia=0,zt.Ha=0,zt.motorSpeed=0,zt.fb=0,zt.ta=Et,ht=zt;var Bt,Pt,Dt=this.Oi,It=this.Rk,Ot=this.Zk,Ft=yt.angularSlop;if(i)Bt=0,Pt=1;else{if(0<Ot.frequency){Ft=0;var Gt=6.28318530717958*Ot.frequency,Nt=Ot.dampingRatio;Nt<yt.minSpringDamperDampingRatio&&(Nt=yt.minSpringDamperDampingRatio);var jt=e.dt,Vt=2*Nt*Gt,Ut=Gt*Gt;Ot.useSymplecticEuler?(Bt=1/(jt*Vt),Pt=Ut/Vt):(Bt=1/(jt*(jt*Ut+Vt)),Pt=Ut/(jt*Ut+Vt))}else Bt=0,Pt=this.Hc==$.BAUMGARTE?e.invDt*yt.velocityBaumgarte:0;0<It.motorTorque?(ht.motorSpeed=It.motorSpeed,ht.fb=It.motorTorque*e.dt):(ht.motorSpeed=0,ht.fb=0)}var kt,Ht,Wt,qt=It.lowerLimit,$t=It.upperLimit,Jt=.5*(qt+$t);Dt=(Dt=((3.14159265358979+(Dt-=Jt))%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979)+Jt,qt>$t?Wt=Ht=kt=0:qt==$t?(kt=-1/0,Ht=1/0,Wt=Dt-qt):Dt<qt?(kt=-1/0,Ht=0,0<(Wt=Dt-qt+Ft)&&(Wt=0)):Dt>$t?(kt=0,Ht=1/0,0>(Wt=Dt-$t-Ft)&&(Wt=0)):Wt=Ht=kt=0;var Xt=W?1/W:0;ht.Ia=kt,ht.Ha=Ht,ht.Ma=Bt*Xt,ht.Fa=Wt*Pt,(Y=ht.Aa).aa=this.ig,Y.ba=this.jg,Y.ca=this.kg,Y.ea=this.ig,Y.fa=this.jg,Y.ga=this.kg}},hd:function(){var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b,x;O.prototype.hd.call(this),t=this.vb,e=this.wb,i=this.xb,a=this.ah,s=(o=this.bh)*i-(h=this.dh)*e,r=h*t-a*i,n=a*e-o*t,this.fg=r*h-n*o,this.gg=n*a-s*h,this.hg=s*o-r*a,this.Yg=s,this.Zg=r,this.$g=n,this.ig=e*n-i*r,this.jg=i*s-t*n,this.kg=t*r-e*s,0<(t=this.fg*this.fg+this.gg*this.gg+this.hg*this.hg)&&(t=1/Math.sqrt(t)),this.fg*=t,this.gg*=t,this.hg*=t,0<(t=this.Yg*this.Yg+this.Zg*this.Zg+this.$g*this.$g)&&(t=1/Math.sqrt(t)),this.Yg*=t,this.Zg*=t,this.$g*=t,0<(t=this.ig*this.ig+this.jg*this.jg+this.kg*this.kg)&&(t=1/Math.sqrt(t)),this.ig*=t,this.jg*=t,this.kg*=t,this.Jm=!(this.fg*this.fg+this.gg*this.gg+this.hg*this.hg),this.Km=!(this.Yg*this.Yg+this.Zg*this.Zg+this.$g*this.$g),this.Lm=!(this.ig*this.ig+this.jg*this.jg+this.kg*this.kg),c=this.vb,t=this.He,e=this.Hh,l=this.wb,i=this.Ie,s=this.Ih,u=this.xb,r=this.Je,n=this.Jh,p=this.bc,d=this.ve,a=this.ah,f=this.cc,m=this.we,o=this.bh,g=this.dc,b=t*d+i*m+r*(y=this.xe),x=e*d+s*m+n*y,-1>=(v=c*a+l*o+u*(h=this.dh))?(t=.5*(i=Math.atan2(x,b)),e=-1.570796326794895,i=.5*-i):1<=v?(t=.5*(i=Math.atan2(x,b)),e=1.570796326794895,i*=.5):(v=Math.asin(v),c=Math.atan2(-(c*d+l*m+u*y),c*p+l*f+u*g),t=Math.atan2(-(t*a+i*o+r*h),e*a+s*o+n*h),e=v,i=c),this.Ni=t,this.Pl=e,this.Oi=i,this.Mj=this.Rf-this.Of,this.Df=this.Sf-this.Pf,this.Ef=this.Tf-this.Qf},$d:function(t,e){O.prototype.$d.call(this,t,e),this.Ud(e,t,!1)},gd:function(t){O.prototype.gd.call(this,t),this.Ud(t,null,!0)},Eg:function(){var t=new bt;return t.x=this.vb,t.y=this.wb,t.z=this.xb,t},Gg:function(){var t=new bt;return t.x=this.ah,t.y=this.bh,t.z=this.dh,t},Fg:function(t){t.x=this.vb,t.y=this.wb,t.z=this.xb},Hg:function(t){t.x=this.ah,t.y=this.bh,t.z=this.dh},Ig:function(){var t=new bt;return t.x=this.qa,t.y=this.ra,t.z=this.sa,t},Kg:function(){var t=new bt;return t.x=this.Mc,t.y=this.Nc,t.z=this.Oc,t},Jg:function(t){t.x=this.qa,t.y=this.ra,t.z=this.sa},Lg:function(t){t.x=this.Mc,t.y=this.Nc,t.z=this.Oc},Bn:function(){return this.Yk},Cn:function(){return this.Zk},xn:function(){return this.Qk},yn:function(){return this.Rk},sn:function(){return this.Ni},tn:function(){return this.Oi}}),g.ua=D,g.prototype=oe(D.prototype,{za:function(t,e,i,s,r){var n,a,o;return this.fh(t,e,i),n=s.x,a=s.y,o=s.z,s=t.a.o*n+t.a.i*a+t.a.l*o,i=t.a.f*n+t.a.m*a+t.a.g*o,t=t.a.h*n+t.a.j*a+t.a.s*o,(n=this.localAxis1).x=s,n.y=i,n.z=t,s=r.x,i=r.y,n=r.z,r=e.a.o*s+e.a.i*i+e.a.l*n,t=e.a.f*s+e.a.m*i+e.a.g*n,e=e.a.h*s+e.a.j*i+e.a.s*n,(s=this.localAxis2).x=r,s.y=t,s.z=e,this}}),p.prototype={za:function(t){this.Sc=t.Sc;for(var e=0,i=this.Sc;e<i;){var s=e++;this.uh[s]=t.uh[s],this.zh[s]=t.zh[s]}for(this.ie=t.ie,e=0,i=this.ie;e<i;)s=e++,this.Mg[s]=t.Mg[s]},kl:function(t,e,i,s,r,n,a){for(var o=0,h=this.ie;o<h;){var c=o++,l=(c=this.Mg[c],t.rows[c]);this.il[c]=l.Fa*n-i[c]-l.Ma*s[c]}for(o=e.cj,h=0,c=this.Sc;h<c;){var u=h++,p=(l=this.uh[u],u=this.zh[u],t.rows[l]);if(u=(0>u?p.Ia:0<u?p.Ha:0)-s[l],r[l]=u){p=0;for(var d=this.ie;p<d;){var f=p++,m=f=this.Mg[f];(g=this.il)[m]-=o[l][f]*u}}}for(h=this.Mg,c=this.ie,u=l=0;u<c;)l|=1<<h[p=u++];for(e.Sj[l]||(e.nn(l,h,c),e.Sj[l]=!0),h=e.Ck[l],e=!0,c=0,l=this.ie;c<l;){u=c++,p=this.Mg[u],d=t.rows[p],m=f=s[p];for(var g=0,y=this.ie;g<y;){var v=g++;m+=this.il[this.Mg[v]]*h[u][v]}if(m<d.Ia-yt.directMlcpSolverEps||m>d.Ha+yt.directMlcpSolverEps){e=!1;break}r[p]=m-f}if(a)return!0;if(!e)return!1;for(a=0,h=this.Sc;a<h;){for(u=a++,c=this.uh[u],l=t.rows[c],u=this.zh[u],p=s[c]+r[c],d=i[c],f=0,m=t.Ka;f<m;)g=f++,d+=o[c][g]*r[g];if(c=l.Fa*n-d-l.Ma*p,0>u&&c>yt.directMlcpSolverEps||0<u&&c<-yt.directMlcpSolverEps){e=!1;break}}return e}},l.prototype={Uh:function(t,e){if(e==t.Ka)null==this.Th[this.jf]&&(this.Th[this.jf]=new p(this.Qn)),this.Th[this.jf++].za(this.cf);else{var i=t.rows[e],s=i.Ia>-1/0,r=i.Ha<1/0;0==i.Ia&&0==i.Ha?((r=this.cf).uh[r.Sc]=e,r.zh[r.Sc]=0,r.Sc++,this.Uh(t,e+1),this.cf.Sc--):((i=this.cf).Mg[i.ie]=e,i.ie++,this.Uh(t,e+1),this.cf.ie--,s&&((s=this.cf).uh[s.Sc]=e,s.zh[s.Sc]=-1,s.Sc++,this.Uh(t,e+1),this.cf.Sc--),r&&((r=this.cf).uh[r.Sc]=e,r.zh[r.Sc]=1,r.Sc++,this.Uh(t,e+1),this.cf.Sc--))}}},c.prototype={},h.ua=J,h.prototype=oe(J.prototype,{xh:function(t){this.$.hd(),this.$.$d(t,this.info),this.C=this.info.Qe,this.D=this.info.Re,this.ei.ll(this.info,this.ac),(t=this.Se).jf=0,(e=t.cf).Sc=0,e.ie=0,t.Uh(this.info,0),t=this.Ml;for(var e=this.Se.jf,i=0,s=0,r=0,n=t.n;r<n;){var a=r++;(a=t.sc[a])<e?(t.kf[i]=a,++i):(t.kf[e+s]=a,++s)}e=t.sc,t.sc=t.kf,t.kf=e},Gh:function(t){if(0>=(u=(u=this.$.Hc==$.BAUMGARTE?yt.jointWarmStartingFactorForBaungarte:yt.jointWarmStartingFactor)*t.dtRatio))for(u=0,t=this.info.Ka;u<t;){var e=u++;(e=this.info.rows[e].ta).ta=0,e.ad=0,e.ub=0}else{for(t=0,e=this.info.Ka;t<e;){var i=t++;(f=(p=(d=this.info.rows[i]).ta).ta*u)<d.Ia?f=d.Ia:f>d.Ha&&(f=d.Ha),p.ta=f,0<d.fb?((f=p.ad*u)<-(d=d.fb)?f=-d:f>d&&(f=d),p.ad=f):p.ad=0,this.Cf[i]=p.ta+p.ad}var s,r,n,a,o,h,c,l,u=this.Cf,p=(e=t=!1,i=this.C.gb,this.C.hb),d=this.C.ib,f=this.D.gb;s=this.D.hb,r=this.D.ib,n=this.C.kb,a=this.C.lb,o=this.C.mb,h=this.D.kb,c=this.D.lb,l=this.D.mb;for(var m=0,g=this.info.Ka;m<g;){var y=m++,v=this.info.rows[y].Aa,b=this.ac[y];y=u[y],1&v.xc&&(i+=b.qd*y,p+=b.rd*y,d+=b.sd*y,f+=b.td*-y,s+=b.ud*-y,r+=b.vd*-y,t=!0),2&v.xc&&(n+=b.kd*y,a+=b.ld*y,o+=b.md*y,h+=b.nd*-y,c+=b.od*-y,l+=b.pd*-y,e=!0)}t&&(this.C.gb=i,this.C.hb=p,this.C.ib=d,this.D.gb=f,this.D.hb=s,this.D.ib=r),e&&(this.C.kb=n,this.C.lb=a,this.C.mb=o,this.D.kb=h,this.D.lb=c,this.D.mb=l)}},Ch:function(){var t,e,i,s,r,n,a,o,h,c,l,u,p=this.info.Ka;t=this.C.gb,e=this.C.hb,i=this.C.ib,s=this.D.gb,r=this.D.hb,n=this.D.ib,a=this.C.kb,o=this.C.lb,h=this.C.mb,c=this.D.kb,l=this.D.lb,u=this.D.mb;for(var d=0;d<p;){var f,m=d++,g=(f=this.info.rows[m]).ta,y=(y=(y=(y=(y=0)+(t*(f=f.Aa).va+e*f.wa+i*f.xa))-(s*f.Ba+r*f.Ca+n*f.Da))+(a*f.aa+o*f.ba+h*f.ca))-(c*f.ea+l*f.fa+u*f.ga);this.Qg[m]=y,this.Yh[m]=g.ta,this.Aj[m]=0}for(t=this.ei.cj,e=0;e<p;)if(i=e++,s=(n=this.info.rows[i]).ta,a=this.ac[i],0<n.fb)for((n=(r=s.ad)+a.Ff*(-n.motorSpeed-this.Qg[i]))<-(a=s.ad)?n=-a:n>a&&(n=a),s.ad=n,s=n-r,this.Aj[i]=s,r=0,n=p;r<n;)o=a=r++,(h=this.Qg)[o]+=s*t[i][a];for(e=!1,i=0,s=this.Se.jf;i<s;)if(t=i++,t=this.Ml.sc[t],this.Se.Th[t].kl(this.info,this.ei,this.Qg,this.Yh,this.Cf,1,!1)){for(e=0;e<p;)s=e++,i=this.Cf[s],this.info.rows[s].ta.ta+=i,(r=this.Aj)[s]+=i;for(p=this.Aj,i=e=!1,s=this.C.gb,r=this.C.hb,n=this.C.ib,a=this.D.gb,o=this.D.hb,h=this.D.ib,c=this.C.kb,l=this.C.lb,u=this.C.mb,d=this.D.kb,m=this.D.lb,g=this.D.mb,f=0,y=this.info.Ka;f<y;){var v=f++,b=this.info.rows[v].Aa,x=this.ac[v];v=p[v],1&b.xc&&(s+=x.qd*v,r+=x.rd*v,n+=x.sd*v,a+=x.td*-v,o+=x.ud*-v,h+=x.vd*-v,e=!0),2&b.xc&&(c+=x.kd*v,l+=x.ld*v,u+=x.md*v,d+=x.nd*-v,m+=x.od*-v,g+=x.pd*-v,i=!0)}for(e&&(this.C.gb=s,this.C.hb=r,this.C.ib=n,this.D.gb=a,this.D.hb=o,this.D.ib=h),i&&(this.C.kb=c,this.C.lb=l,this.C.mb=u,this.D.kb=d,this.D.lb=m,this.D.mb=g),p=this.Ml,e=0;p.sc[e]!=t;)++e;for(;0<e;)t=p.sc[e],p.sc[e]=p.sc[e-1],p.sc[e-1]=t,--e;e=!0;break}e||console.log("DirectJointConstraintSolver.hx:338:","could not find solution. (velocity)")},Li:function(t){for(var e,i,s,r,n,a,o=a=n=r=s=i=e=0,h=this.info.Ka;o<h;){var c,l=o++;l=(c=this.info.rows[l]).ta,1&(c=c.Aa).xc?(e+=c.va*l.ta,i+=c.wa*l.ta,s+=c.xa*l.ta):2&c.xc&&(r+=c.aa*l.ta,n+=c.ba*l.ta,a+=c.ca*l.ta)}this.$.Pi=e*t.invDt,this.$.Qi=i*t.invDt,this.$.Ri=s*t.invDt,this.$.Si=r*t.invDt,this.$.Ti=n*t.invDt,this.$.Ui=a*t.invDt},Pg:function(){this.$.hd(),this.$.gd(this.info),this.C=this.info.Qe,this.D=this.info.Re,this.ei.ll(this.info,this.ac),(t=this.Se).jf=0,(e=t.cf).Sc=0,e.ie=0,t.Uh(this.info,0);for(var t=this.Ki,e=this.Se.jf,i=0,s=0,r=0,n=t.n;r<n;){var a=r++;(a=t.sc[a])<e?(t.kf[i]=a,++i):(t.kf[e+s]=a,++s)}for(e=t.sc,t.sc=t.kf,t.kf=e,t=0,e=this.info.Ka;t<e;)i=t++,this.info.rows[i].ta.ub=0},Bh:function(){var t,e,i,s,r,n,a,o,h,c,l,u,p=this.info.Ka;t=this.C.Yc,e=this.C.Zc,i=this.C.$c,s=this.D.Yc,r=this.D.Zc,n=this.D.$c,a=this.C.Uc,o=this.C.Vc,h=this.C.Wc,c=this.D.Uc,l=this.D.Vc,u=this.D.Wc;for(var d=0;d<p;){var f,m=d++,g=(f=this.info.rows[m]).ta,y=(y=(y=(y=(y=0)+(t*(f=f.Aa).va+e*f.wa+i*f.xa))-(s*f.Ba+r*f.Ca+n*f.Da))+(a*f.aa+o*f.ba+h*f.ca))-(c*f.ea+l*f.fa+u*f.ga);this.Qg[m]=y,this.Yh[m]=g.ub}for(e=!1,i=0,s=this.Se.jf;i<s;)if(t=i++,t=this.Ki.sc[t],this.Se.Th[t].kl(this.info,this.ei,this.Qg,this.Yh,this.Cf,yt.positionSplitImpulseBaumgarte,!1)){for(e=0;e<p;)i=e++,this.info.rows[i].ta.ub+=this.Cf[i];for(p=this.Cf,i=e=!1,s=this.C.Yc,r=this.C.Zc,n=this.C.$c,a=this.D.Yc,o=this.D.Zc,h=this.D.$c,c=this.C.Uc,l=this.C.Vc,u=this.C.Wc,d=this.D.Uc,m=this.D.Vc,g=this.D.Wc,f=0,y=this.info.Ka;f<y;){var v=f++,b=this.info.rows[v].Aa,x=this.ac[v];v=p[v],1&b.xc&&(s+=x.qd*v,r+=x.rd*v,n+=x.sd*v,a+=x.td*-v,o+=x.ud*-v,h+=x.vd*-v,e=!0),2&b.xc&&(c+=x.kd*v,l+=x.ld*v,u+=x.md*v,d+=x.nd*-v,m+=x.od*-v,g+=x.pd*-v,i=!0)}for(e&&(this.C.Yc=s,this.C.Zc=r,this.C.$c=n,this.D.Yc=a,this.D.Zc=o,this.D.$c=h),i&&(this.C.Uc=c,this.C.Vc=l,this.C.Wc=u,this.D.Uc=d,this.D.Vc=m,this.D.Wc=g),p=this.Ki,e=0;p.sc[e]!=t;)++e;for(;0<e;)t=p.sc[e],p.sc[e]=p.sc[e-1],p.sc[e-1]=t,--e;e=!0;break}e||console.log("DirectJointConstraintSolver.hx:454:","could not find solution. (split impulse)")},Ah:function(){this.$.hd(),this.$.gd(this.info),this.C=this.info.Qe,this.D=this.info.Re,this.ei.ll(this.info,this.ac);var t=this.Se;t.jf=0;var e=t.cf;e.Sc=0,e.ie=0,t.Uh(this.info,0);for(var i=this.Ki,s=this.Se.jf,r=0,n=0,a=0,o=i.n;a<o;){var h=a++,c=i.sc[h];c<s?(i.kf[r]=c,++r):(i.kf[s+n]=c,++n)}var l=i.sc;i.sc=i.kf,i.kf=l;for(var u=this.info.Ka,p=0;p<u;){var d=p++,f=this.info.rows[d].ta;this.Qg[d]=0,this.Yh[d]=f.ub}for(var m=!1,g=0,y=this.Se.jf;g<y;){var v=g++,b=this.Ki.sc[v];if(this.Se.Th[b].kl(this.info,this.ei,this.Qg,this.Yh,this.Cf,yt.positionNgsBaumgarte,!1)){for(var x=0,_=u;x<_;){var M=x++;this.info.rows[M].ta.ub+=this.Cf[M]}for(var w,S,A,T,C,L,E,z,R,B,P,D,I=this.Cf,O=!1,F=!1,G=D=P=B=R=z=E=L=C=T=A=S=w=0,N=this.info.Ka;G<N;){var j=G++,V=this.info.rows[j].Aa,U=this.ac[j],k=I[j];1&V.xc&&(w+=U.qd*k,S+=U.rd*k,A+=U.sd*k,T+=U.td*-k,C+=U.ud*-k,L+=U.vd*-k,O=!0),2&V.xc&&(E+=U.kd*k,z+=U.ld*k,R+=U.md*k,B+=U.nd*-k,P+=U.od*-k,D+=U.pd*-k,F=!0)}if(O){var H=this.C;H.a.v+=w,H.a.A+=S,H.a.B+=A;var W=this.D;W.a.v+=T,W.a.A+=C,W.a.B+=L}if(F){var q,$,J,X,Y,K,Z=this.C,Q=Math.sqrt(E*E+z*z+R*R),tt=.5*Q;if(.5>tt){var et=tt*tt;q=.5*(1-.16666666666666666*et+et*et*.008333333333333333),$=1-.5*et+et*et*.041666666666666664}else q=Math.sin(tt)/Q,$=Math.cos(tt);J=E*q,X=z*q,Y=R*q,K=$;var it,st,rt,nt,at,ot=Z.a.o,ht=Z.a.m,ct=Z.a.s,lt=ot+ht+ct;0<lt?(nt=.5*(at=Math.sqrt(lt+1)),at=.5/at,it=(Z.a.g-Z.a.j)*at,st=(Z.a.h-Z.a.l)*at,rt=(Z.a.i-Z.a.f)*at):ot>ht?ot>ct?(it=.5*(at=Math.sqrt(ot-ht-ct+1)),at=.5/at,st=(Z.a.f+Z.a.i)*at,rt=(Z.a.h+Z.a.l)*at,nt=(Z.a.g-Z.a.j)*at):(rt=.5*(at=Math.sqrt(ct-ot-ht+1)),at=.5/at,it=(Z.a.h+Z.a.l)*at,st=(Z.a.j+Z.a.g)*at,nt=(Z.a.i-Z.a.f)*at):ht>ct?(st=.5*(at=Math.sqrt(ht-ct-ot+1)),at=.5/at,it=(Z.a.f+Z.a.i)*at,rt=(Z.a.j+Z.a.g)*at,nt=(Z.a.h-Z.a.l)*at):(rt=.5*(at=Math.sqrt(ct-ot-ht+1)),at=.5/at,it=(Z.a.h+Z.a.l)*at,st=(Z.a.j+Z.a.g)*at,nt=(Z.a.i-Z.a.f)*at);var ut=(it=K*it+J*nt+X*rt-Y*st)*it+(st=K*st-J*rt+X*nt+Y*it)*st+(rt=K*rt+J*st-X*it+Y*nt)*rt+(nt=K*nt-J*it-X*st-Y*rt)*nt;1e-32<ut&&(ut=1/Math.sqrt(ut));var pt,dt,ft,mt,gt,vt,bt,xt,_t,Mt,wt,St,At,Tt,Ct,Lt,Et,zt,Rt=2*(it*=ut),Bt=2*(st*=ut),Pt=2*(rt*=ut),Dt=it*Rt,It=st*Bt,Ot=rt*Pt,Ft=it*Bt,Gt=st*Pt,Nt=it*Pt,jt=(nt*=ut)*Rt,Vt=nt*Bt,Ut=nt*Pt;Z.a.o=1-It-Ot,Z.a.f=Ft-Ut,Z.a.h=Nt+Vt,Z.a.i=Ft+Ut,Z.a.m=1-Dt-Ot,Z.a.j=Gt-jt,Z.a.l=Nt-Vt,Z.a.g=Gt+jt,Z.a.s=1-Dt-It,pt=Z.a.o*Z.Ra+Z.a.f*Z.Ua+Z.a.h*Z.Xa,dt=Z.a.o*Z.Sa+Z.a.f*Z.Va+Z.a.h*Z.Ya,ft=Z.a.o*Z.Ta+Z.a.f*Z.Wa+Z.a.h*Z.Za,mt=Z.a.i*Z.Ra+Z.a.m*Z.Ua+Z.a.j*Z.Xa,gt=Z.a.i*Z.Sa+Z.a.m*Z.Va+Z.a.j*Z.Ya,vt=Z.a.i*Z.Ta+Z.a.m*Z.Wa+Z.a.j*Z.Za,bt=Z.a.l*Z.Ra+Z.a.g*Z.Ua+Z.a.s*Z.Xa,xt=Z.a.l*Z.Sa+Z.a.g*Z.Va+Z.a.s*Z.Ya,_t=Z.a.l*Z.Ta+Z.a.g*Z.Wa+Z.a.s*Z.Za,Z.P=pt,Z.R=dt,Z.S=ft,Z.T=mt,Z.U=gt,Z.V=vt,Z.W=bt,Z.X=xt,Z.Y=_t,Mt=Z.P*Z.a.o+Z.R*Z.a.f+Z.S*Z.a.h,wt=Z.P*Z.a.i+Z.R*Z.a.m+Z.S*Z.a.j,St=Z.P*Z.a.l+Z.R*Z.a.g+Z.S*Z.a.s,At=Z.T*Z.a.o+Z.U*Z.a.f+Z.V*Z.a.h,Tt=Z.T*Z.a.i+Z.U*Z.a.m+Z.V*Z.a.j,Ct=Z.T*Z.a.l+Z.U*Z.a.g+Z.V*Z.a.s,Lt=Z.W*Z.a.o+Z.X*Z.a.f+Z.Y*Z.a.h,Et=Z.W*Z.a.i+Z.X*Z.a.m+Z.Y*Z.a.j,zt=Z.W*Z.a.l+Z.X*Z.a.g+Z.Y*Z.a.s,Z.P=Mt,Z.R=wt,Z.S=St,Z.T=At,Z.U=Tt,Z.V=Ct,Z.W=Lt,Z.X=Et,Z.Y=zt,Z.P*=Z.N.x,Z.R*=Z.N.x,Z.S*=Z.N.x,Z.T*=Z.N.y,Z.U*=Z.N.y,Z.V*=Z.N.y,Z.W*=Z.N.z,Z.X*=Z.N.z,Z.Y*=Z.N.z;var kt,Ht,Wt,qt,$t,Jt,Xt=this.D,Yt=Math.sqrt(B*B+P*P+D*D),Kt=.5*Yt;if(.5>Kt){var Zt=Kt*Kt;kt=.5*(1-.16666666666666666*Zt+Zt*Zt*.008333333333333333),Ht=1-.5*Zt+Zt*Zt*.041666666666666664}else kt=Math.sin(Kt)/Yt,Ht=Math.cos(Kt);Wt=B*kt,qt=P*kt,$t=D*kt,Jt=Ht;var Qt,te,ee,ie,se,re=Xt.a.o,ne=Xt.a.m,ae=Xt.a.s,oe=re+ne+ae;0<oe?(ie=.5*(se=Math.sqrt(oe+1)),se=.5/se,Qt=(Xt.a.g-Xt.a.j)*se,te=(Xt.a.h-Xt.a.l)*se,ee=(Xt.a.i-Xt.a.f)*se):re>ne?re>ae?(Qt=.5*(se=Math.sqrt(re-ne-ae+1)),se=.5/se,te=(Xt.a.f+Xt.a.i)*se,ee=(Xt.a.h+Xt.a.l)*se,ie=(Xt.a.g-Xt.a.j)*se):(ee=.5*(se=Math.sqrt(ae-re-ne+1)),se=.5/se,Qt=(Xt.a.h+Xt.a.l)*se,te=(Xt.a.j+Xt.a.g)*se,ie=(Xt.a.i-Xt.a.f)*se):ne>ae?(te=.5*(se=Math.sqrt(ne-ae-re+1)),se=.5/se,Qt=(Xt.a.f+Xt.a.i)*se,ee=(Xt.a.j+Xt.a.g)*se,ie=(Xt.a.h-Xt.a.l)*se):(ee=.5*(se=Math.sqrt(ae-re-ne+1)),se=.5/se,Qt=(Xt.a.h+Xt.a.l)*se,te=(Xt.a.j+Xt.a.g)*se,ie=(Xt.a.i-Xt.a.f)*se);var he=(Qt=Jt*Qt+Wt*ie+qt*ee-$t*te)*Qt+(te=Jt*te-Wt*ee+qt*ie+$t*Qt)*te+(ee=Jt*ee+Wt*te-qt*Qt+$t*ie)*ee+(ie=Jt*ie-Wt*Qt-qt*te-$t*ee)*ie;1e-32<he&&(he=1/Math.sqrt(he));var ce,le,ue,pe,de,fe,me,ge,ye,ve,be,xe,_e,Me,we,Se,Ae,Te,Ce=2*(Qt*=he),Le=2*(te*=he),Ee=2*(ee*=he),ze=Qt*Ce,Re=te*Le,Be=ee*Ee,Pe=Qt*Le,De=te*Ee,Ie=Qt*Ee,Oe=(ie*=he)*Ce,Fe=ie*Le,Ge=ie*Ee;Xt.a.o=1-Re-Be,Xt.a.f=Pe-Ge,Xt.a.h=Ie+Fe,Xt.a.i=Pe+Ge,Xt.a.m=1-ze-Be,Xt.a.j=De-Oe,Xt.a.l=Ie-Fe,Xt.a.g=De+Oe,Xt.a.s=1-ze-Re,ce=Xt.a.o*Xt.Ra+Xt.a.f*Xt.Ua+Xt.a.h*Xt.Xa,le=Xt.a.o*Xt.Sa+Xt.a.f*Xt.Va+Xt.a.h*Xt.Ya,ue=Xt.a.o*Xt.Ta+Xt.a.f*Xt.Wa+Xt.a.h*Xt.Za,pe=Xt.a.i*Xt.Ra+Xt.a.m*Xt.Ua+Xt.a.j*Xt.Xa,de=Xt.a.i*Xt.Sa+Xt.a.m*Xt.Va+Xt.a.j*Xt.Ya,fe=Xt.a.i*Xt.Ta+Xt.a.m*Xt.Wa+Xt.a.j*Xt.Za,me=Xt.a.l*Xt.Ra+Xt.a.g*Xt.Ua+Xt.a.s*Xt.Xa,ge=Xt.a.l*Xt.Sa+Xt.a.g*Xt.Va+Xt.a.s*Xt.Ya,ye=Xt.a.l*Xt.Ta+Xt.a.g*Xt.Wa+Xt.a.s*Xt.Za,Xt.P=ce,Xt.R=le,Xt.S=ue,Xt.T=pe,Xt.U=de,Xt.V=fe,Xt.W=me,Xt.X=ge,Xt.Y=ye,ve=Xt.P*Xt.a.o+Xt.R*Xt.a.f+Xt.S*Xt.a.h,be=Xt.P*Xt.a.i+Xt.R*Xt.a.m+Xt.S*Xt.a.j,xe=Xt.P*Xt.a.l+Xt.R*Xt.a.g+Xt.S*Xt.a.s,_e=Xt.T*Xt.a.o+Xt.U*Xt.a.f+Xt.V*Xt.a.h,Me=Xt.T*Xt.a.i+Xt.U*Xt.a.m+Xt.V*Xt.a.j,we=Xt.T*Xt.a.l+Xt.U*Xt.a.g+Xt.V*Xt.a.s,Se=Xt.W*Xt.a.o+Xt.X*Xt.a.f+Xt.Y*Xt.a.h,Ae=Xt.W*Xt.a.i+Xt.X*Xt.a.m+Xt.Y*Xt.a.j,Te=Xt.W*Xt.a.l+Xt.X*Xt.a.g+Xt.Y*Xt.a.s,Xt.P=ve,Xt.R=be,Xt.S=xe,Xt.T=_e,Xt.U=Me,Xt.V=we,Xt.W=Se,Xt.X=Ae,Xt.Y=Te,Xt.P*=Xt.N.x,Xt.R*=Xt.N.x,Xt.S*=Xt.N.x,Xt.T*=Xt.N.y,Xt.U*=Xt.N.y,Xt.V*=Xt.N.y,Xt.W*=Xt.N.z,Xt.X*=Xt.N.z,Xt.Y*=Xt.N.z}for(var Ne=this.Ki,je=0;Ne.sc[je]!=b;)++je;for(;0<je;){var Ve=Ne.sc[je];Ne.sc[je]=Ne.sc[je-1],Ne.sc[je-1]=Ve,--je}m=!0;break}}m||console.log("DirectJointConstraintSolver.hx:506:","could not find solution. (NGS)")},postSolve:function(){this.$.hd(),this.$.Rl()}}),o.prototype={nn:function(t,e,i){for(var s=0;s<i;)for(var r=s++,n=e[r],a=0,o=i;a<o;){var h=a++;this.wk[r][h]=this.$a[n][e[h]]}var c;switch(s=this.wk,t=this.Ck[t],i){case 4:r=s[0],e=t[0],i=1/r[0],e[0]=i,r[1]*=i,r[2]*=i,r[3]*=i,h=s[1],(c=t[1])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h=s[2],(c=t[2])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h=s[3],(c=t[3])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],r=s[1],e=t[1],i=1/r[1],e[1]=i,e[0]*=i,r[2]*=i,r[3]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h=s[2],(c=t[2])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h=s[3],(c=t[3])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],r=s[2],e=t[2],i=1/r[2],e[2]=i,e[0]*=i,e[1]*=i,r[3]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[2],h[3]-=r[3]*h[2],h=s[1],(c=t[1])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],h[3]-=r[3]*h[2],h=s[3],(c=t[3])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],c[2]=-i*h[2],h[3]-=r[3]*h[2],r=s[3],e=t[3],i=1/r[3],e[3]=i,e[0]*=i,e[1]*=i,e[2]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[3],h=s[1],(c=t[1])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],h=s[2],(c=t[2])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],c[2]-=e[2]*h[3],e=t[1],t[0][1]=e[0],e=t[2],t[0][2]=e[0],t[1][2]=e[1],e=t[3],t[0][3]=e[0],t[1][3]=e[1],t[2][3]=e[2];break;case 5:r=s[0],e=t[0],i=1/r[0],e[0]=i,r[1]*=i,r[2]*=i,r[3]*=i,r[4]*=i,h=s[1],(c=t[1])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h=s[2],(c=t[2])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h=s[3],(c=t[3])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h=s[4],(c=t[4])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],r=s[1],e=t[1],i=1/r[1],e[1]=i,e[0]*=i,r[2]*=i,r[3]*=i,r[4]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h=s[2],(c=t[2])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h=s[3],(c=t[3])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h=s[4],(c=t[4])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],r=s[2],e=t[2],i=1/r[2],e[2]=i,e[0]*=i,e[1]*=i,r[3]*=i,r[4]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h=s[1],(c=t[1])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h=s[3],(c=t[3])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],c[2]=-i*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h=s[4],(c=t[4])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],c[2]=-i*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],r=s[3],e=t[3],i=1/r[3],e[3]=i,e[0]*=i,e[1]*=i,e[2]*=i,r[4]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[3],h[4]-=r[4]*h[3],h=s[1],(c=t[1])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],h[4]-=r[4]*h[3],h=s[2],(c=t[2])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],c[2]-=e[2]*h[3],h[4]-=r[4]*h[3],h=s[4],(c=t[4])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],c[2]-=e[2]*h[3],c[3]=-i*h[3],h[4]-=r[4]*h[3],r=s[4],e=t[4],i=1/r[4],e[4]=i,e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[4],h=s[1],(c=t[1])[0]-=e[0]*h[4],c[1]-=e[1]*h[4],h=s[2],(c=t[2])[0]-=e[0]*h[4],c[1]-=e[1]*h[4],c[2]-=e[2]*h[4],h=s[3],(c=t[3])[0]-=e[0]*h[4],c[1]-=e[1]*h[4],c[2]-=e[2]*h[4],c[3]-=e[3]*h[4],e=t[1],t[0][1]=e[0],e=t[2],t[0][2]=e[0],t[1][2]=e[1],e=t[3],t[0][3]=e[0],t[1][3]=e[1],t[2][3]=e[2],e=t[4],t[0][4]=e[0],t[1][4]=e[1],t[2][4]=e[2],t[3][4]=e[3];break;case 6:r=s[0],e=t[0],i=1/r[0],e[0]=i,r[1]*=i,r[2]*=i,r[3]*=i,r[4]*=i,r[5]*=i,h=s[1],(c=t[1])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h[5]-=r[5]*h[0],h=s[2],(c=t[2])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h[5]-=r[5]*h[0],h=s[3],(c=t[3])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h[5]-=r[5]*h[0],h=s[4],(c=t[4])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h[5]-=r[5]*h[0],h=s[5],(c=t[5])[0]=-i*h[0],h[1]-=r[1]*h[0],h[2]-=r[2]*h[0],h[3]-=r[3]*h[0],h[4]-=r[4]*h[0],h[5]-=r[5]*h[0],r=s[1],e=t[1],i=1/r[1],e[1]=i,e[0]*=i,r[2]*=i,r[3]*=i,r[4]*=i,r[5]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h[5]-=r[5]*h[1],h=s[2],(c=t[2])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h[5]-=r[5]*h[1],h=s[3],(c=t[3])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h[5]-=r[5]*h[1],h=s[4],(c=t[4])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h[5]-=r[5]*h[1],h=s[5],(c=t[5])[0]-=e[0]*h[1],c[1]=-i*h[1],h[2]-=r[2]*h[1],h[3]-=r[3]*h[1],h[4]-=r[4]*h[1],h[5]-=r[5]*h[1],r=s[2],e=t[2],i=1/r[2],e[2]=i,e[0]*=i,e[1]*=i,r[3]*=i,r[4]*=i,r[5]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h[5]-=r[5]*h[2],h=s[1],(c=t[1])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h[5]-=r[5]*h[2],h=s[3],(c=t[3])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],c[2]=-i*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h[5]-=r[5]*h[2],h=s[4],(c=t[4])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],c[2]=-i*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h[5]-=r[5]*h[2],h=s[5],(c=t[5])[0]-=e[0]*h[2],c[1]-=e[1]*h[2],c[2]=-i*h[2],h[3]-=r[3]*h[2],h[4]-=r[4]*h[2],h[5]-=r[5]*h[2],r=s[3],e=t[3],i=1/r[3],e[3]=i,e[0]*=i,e[1]*=i,e[2]*=i,r[4]*=i,r[5]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[3],h[4]-=r[4]*h[3],h[5]-=r[5]*h[3],h=s[1],(c=t[1])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],h[4]-=r[4]*h[3],h[5]-=r[5]*h[3],h=s[2],(c=t[2])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],c[2]-=e[2]*h[3],h[4]-=r[4]*h[3],h[5]-=r[5]*h[3],h=s[4],(c=t[4])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],c[2]-=e[2]*h[3],c[3]=-i*h[3],h[4]-=r[4]*h[3],h[5]-=r[5]*h[3],h=s[5],(c=t[5])[0]-=e[0]*h[3],c[1]-=e[1]*h[3],c[2]-=e[2]*h[3],c[3]=-i*h[3],h[4]-=r[4]*h[3],h[5]-=r[5]*h[3],r=s[4],e=t[4],i=1/r[4],e[4]=i,e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,r[5]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[4],h[5]-=r[5]*h[4],h=s[1],(c=t[1])[0]-=e[0]*h[4],c[1]-=e[1]*h[4],h[5]-=r[5]*h[4],h=s[2],(c=t[2])[0]-=e[0]*h[4],c[1]-=e[1]*h[4],c[2]-=e[2]*h[4],h[5]-=r[5]*h[4],h=s[3],(c=t[3])[0]-=e[0]*h[4],c[1]-=e[1]*h[4],c[2]-=e[2]*h[4],c[3]-=e[3]*h[4],h[5]-=r[5]*h[4],h=s[5],(c=t[5])[0]-=e[0]*h[4],c[1]-=e[1]*h[4],c[2]-=e[2]*h[4],c[3]-=e[3]*h[4],c[4]=-i*h[4],h[5]-=r[5]*h[4],r=s[5],e=t[5],i=1/r[5],e[5]=i,e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e[4]*=i,h=s[0],(c=t[0])[0]-=e[0]*h[5],h=s[1],(c=t[1])[0]-=e[0]*h[5],c[1]-=e[1]*h[5],h=s[2],(c=t[2])[0]-=e[0]*h[5],c[1]-=e[1]*h[5],c[2]-=e[2]*h[5],h=s[3],(c=t[3])[0]-=e[0]*h[5],c[1]-=e[1]*h[5],c[2]-=e[2]*h[5],c[3]-=e[3]*h[5],h=s[4],(c=t[4])[0]-=e[0]*h[5],c[1]-=e[1]*h[5],c[2]-=e[2]*h[5],c[3]-=e[3]*h[5],c[4]-=e[4]*h[5],e=t[1],t[0][1]=e[0],e=t[2],t[0][2]=e[0],t[1][2]=e[1],e=t[3],t[0][3]=e[0],t[1][3]=e[1],t[2][3]=e[2],e=t[4],t[0][4]=e[0],t[1][4]=e[1],t[2][4]=e[2],t[3][4]=e[3],e=t[5],t[0][5]=e[0],t[1][5]=e[1],t[2][5]=e[2],t[3][5]=e[3],t[4][5]=e[4];break;default:for(n=0;n<i;){for(r=s[a=n++],e=t[a],o=1/r[a],e[a]=o,h=0,c=a;h<c;)e[l=h++]*=o;for(h=a+1,c=i;h<c;)r[l=h++]*=o;for(var l=0,u=a;l<u;){h=s[d=l++],c=t[d];for(var p=0,d=d+1;p<d;){var f=p++;c[f]-=e[f]*h[a]}for(c=a+1,p=i;c<p;)h[d=c++]-=r[d]*h[a]}for(l=a+1,u=i;l<u;){for(h=s[c=l++],c=t[c],p=0,d=a;p<d;)c[f=p++]-=e[f]*h[a];for(c[a]=-o*h[a],c=a+1,p=i;c<p;)h[d=c++]-=r[d]*h[a]}}for(s=1;s<i;)for(e=t[r=s++],n=0,a=r;n<a;)t[o=n++][r]=e[o]}},ll:function(t,e){var i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v=this.$a,b=this.cj,x=t.Ka,_=t.Qe,M=t.Re,w=_.$a,S=M.$a;i=_.P,s=_.R,r=_.S,n=_.T,a=_.U,o=_.V,h=_.W,c=_.X,_=_.Y,l=M.P,u=M.R,p=M.S,d=M.T,f=M.U,m=M.V,g=M.W,y=M.X,M=M.Y;for(var A=0;A<x;){var T,C,L,E=A++,z=t.rows[E].Aa;E=e[E],z.Im(),1&z.xc?(E.qd=z.va*w,E.rd=z.wa*w,E.sd=z.xa*w,E.td=z.Ba*S,E.ud=z.Ca*S,E.vd=z.Da*S):(E.qd=0,E.rd=0,E.sd=0,E.td=0,E.ud=0,E.vd=0),2&z.xc?(T=i*z.aa+s*z.ba+r*z.ca,C=n*z.aa+a*z.ba+o*z.ca,L=h*z.aa+c*z.ba+_*z.ca,E.kd=T,E.ld=C,E.md=L,T=l*z.ea+u*z.fa+p*z.ga,C=d*z.ea+f*z.fa+m*z.ga,z=g*z.ea+y*z.fa+M*z.ga,E.nd=T,E.od=C,E.pd=z):(E.kd=0,E.ld=0,E.md=0,E.nd=0,E.od=0,E.pd=0)}for(w=0;w<x;)for(S=w++,i=t.rows[S].Aa,s=S,r=x;s<r;)a=e[n=s++],o=i.va*a.qd+i.wa*a.rd+i.xa*a.sd+(i.aa*a.kd+i.ba*a.ld+i.ca*a.md)+(i.Ba*a.td+i.Ca*a.ud+i.Da*a.vd)+(i.ea*a.nd+i.fa*a.od+i.ga*a.pd),S==n?(v[S][n]=o+t.rows[S].Ma,b[S][n]=o,a.mass=o+t.rows[S].Ma,a.Ff=o,0!=a.mass&&(a.mass=1/a.mass),a.Ff&&(a.Ff=1/a.Ff)):(v[S][n]=o,v[n][S]=o,b[S][n]=o,b[n][S]=o);for(t=0,e=this.ak;t<e;)v=t++,this.Sj[v]=!1}},a.ua=J,a.prototype=oe(J.prototype,{xh:function(t){this.Ji.$d(t,this.info),this.C=this.info.Qe,this.D=this.info.Re,t=this.C.$a;var e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b=this.D.$a;e=this.C.P,i=this.C.R,s=this.C.S,r=this.C.T,n=this.C.U,a=this.C.V,o=this.C.W,h=this.C.X,c=this.C.Y,l=this.D.P,u=this.D.R,p=this.D.S,d=this.D.T,f=this.D.U,m=this.D.V,g=this.D.W,y=this.D.X,v=this.D.Y;for(var x=0,_=this.info.Ka;x<_;){var M,w,S,A=x++,T=this.info.rows[A],C=(A=this.ac[A],T.Ng);A.Zh=C.va*t,A.$h=C.wa*t,A.ai=C.xa*t,A.bi=C.Ba*b,A.ci=C.Ca*b,A.di=C.Da*b,M=e*C.aa+i*C.ba+s*C.ca,w=r*C.aa+n*C.ba+a*C.ca,S=o*C.aa+h*C.ba+c*C.ca,A.Xf=M,A.Yf=w,A.Zf=S,M=l*C.ea+u*C.fa+p*C.ga,w=d*C.ea+f*C.fa+m*C.ga,S=g*C.ea+y*C.fa+v*C.ga,A.$f=M,A.ag=w,A.bg=S,A.he=t+b+(A.Xf*C.aa+A.Yf*C.ba+A.Zf*C.ca)+(A.$f*C.ea+A.ag*C.fa+A.bg*C.ga),0!=A.he&&(A.he=1/A.he),C=T.Lj,T=T.Kj,A.yl=C.va*t,A.zl=C.wa*t,A.Al=C.xa*t,A.Bl=C.Ba*b,A.Cl=C.Ca*b,A.Dl=C.Da*b,A.sl=T.va*t,A.tl=T.wa*t,A.ul=T.xa*t,A.vl=T.Ba*b,A.wl=T.Ca*b,A.xl=T.Da*b,M=e*C.aa+i*C.ba+s*C.ca,w=r*C.aa+n*C.ba+a*C.ca,S=o*C.aa+h*C.ba+c*C.ca,A.Ej=M,A.Fj=w,A.Gj=S,M=l*C.ea+u*C.fa+p*C.ga,w=d*C.ea+f*C.fa+m*C.ga,S=g*C.ea+y*C.fa+v*C.ga,A.Hj=M,A.Ij=w,A.Jj=S,M=e*T.aa+i*T.ba+s*T.ca,w=r*T.aa+n*T.ba+a*T.ca,S=o*T.aa+h*T.ba+c*T.ca,A.lk=M,A.mk=w,A.nk=S,M=l*T.ea+u*T.fa+p*T.ga,w=d*T.ea+f*T.fa+m*T.ga,S=g*T.ea+y*T.fa+v*T.ga,A.pk=M,A.qk=w,A.rk=S,C=t+b+(A.Ej*C.aa+A.Fj*C.ba+A.Gj*C.ca)+(A.Hj*C.ea+A.Ij*C.fa+A.Jj*C.ga),w=M=A.Ej*T.aa+A.Fj*T.ba+A.Gj*T.ca+(A.Hj*T.ea+A.Ij*T.fa+A.Jj*T.ga),(S=C*(T=t+b+(A.lk*T.aa+A.mk*T.ba+A.nk*T.ca)+(A.pk*T.ea+A.qk*T.fa+A.rk*T.ga))-M*w)&&(S=1/S),A.ym=T*S,A.zm=-M*S,A.Am=-w*S,A.Bm=C*S}},Gh:function(t){var e,i,s,r,n,a,o,h,c,l,u,p;e=this.C.gb,i=this.C.hb,s=this.C.ib,r=this.D.gb,n=this.D.hb,a=this.D.ib,o=this.C.kb,h=this.C.lb,c=this.C.mb,l=this.D.kb,u=this.D.lb,p=this.D.mb;for(var d=0,f=this.info.Ka;d<f;){var m=d++,g=(b=this.info.rows[m]).ta,y=(m=this.ac[m],b.Lj),v=b.Kj,b=g.bd;y=g.df*y.va+g.ef*y.wa+g.ff*y.xa,v=g.df*v.va+g.ef*v.wa+g.ff*v.xa,g.zc=y,g.yc=v,g.bd*=t.dtRatio,g.zc*=t.dtRatio,g.yc*=t.dtRatio,e+=m.Zh*b,i+=m.$h*b,s+=m.ai*b,e+=m.yl*y,i+=m.zl*y,s+=m.Al*y,e+=m.sl*v,i+=m.tl*v,s+=m.ul*v,r+=m.bi*-b,n+=m.ci*-b,a+=m.di*-b,r+=m.Bl*-y,n+=m.Cl*-y,a+=m.Dl*-y,r+=m.vl*-v,n+=m.wl*-v,a+=m.xl*-v,o+=m.Xf*b,h+=m.Yf*b,c+=m.Zf*b,o+=m.Ej*y,h+=m.Fj*y,c+=m.Gj*y,o+=m.lk*v,h+=m.mk*v,c+=m.nk*v,l+=m.$f*-b,u+=m.ag*-b,p+=m.bg*-b,l+=m.Hj*-y,u+=m.Ij*-y,p+=m.Jj*-y,l+=m.pk*-v,u+=m.qk*-v,p+=m.rk*-v}this.C.gb=e,this.C.hb=i,this.C.ib=s,this.D.gb=r,this.D.hb=n,this.D.ib=a,this.C.kb=o,this.C.lb=h,this.C.mb=c,this.D.kb=l,this.D.lb=u,this.D.mb=p},Ch:function(){var t,e,i,s,r,n,a,o,h,c,l,u;t=this.C.gb,e=this.C.hb,i=this.C.ib,s=this.D.gb,r=this.D.hb,n=this.D.ib,a=this.C.kb,o=this.C.lb,h=this.C.mb,c=this.D.kb,l=this.D.lb,u=this.D.mb;for(var p=0,d=this.info.Ka;p<d;){var f=p++,m=this.info.rows[f],g=(f=this.ac[f],m.ta),y=(y=(y=(y=(y=0)+(t*(b=m.Lj).va+e*b.wa+i*b.xa))-(s*b.Ba+r*b.Ca+n*b.Da))+(a*b.aa+o*b.ba+h*b.ca))-(c*b.ea+l*b.fa+u*b.ga),v=(v=(v=(v=(v=0)+(t*(b=m.Kj).va+e*b.wa+i*b.xa))-(s*b.Ba+r*b.Ca+n*b.Da))+(a*b.aa+o*b.ba+h*b.ca))-(c*b.ea+l*b.fa+u*b.ga),b=-(y*f.ym+v*f.zm),x=-(y*f.Am+v*f.Bm);y=g.zc,v=g.yc,g.zc+=b,g.yc+=x,(m=m.friction*g.bd)?(b=g.zc*g.zc+g.yc*g.yc)>m*m&&(m/=Math.sqrt(b),g.zc*=m,g.yc*=m):(g.zc=0,g.yc=0),b=g.zc-y,x=g.yc-v,t+=f.yl*b,e+=f.zl*b,i+=f.Al*b,t+=f.sl*x,e+=f.tl*x,i+=f.ul*x,s+=f.Bl*-b,r+=f.Cl*-b,n+=f.Dl*-b,s+=f.vl*-x,r+=f.wl*-x,n+=f.xl*-x,a+=f.Ej*b,o+=f.Fj*b,h+=f.Gj*b,a+=f.lk*x,o+=f.mk*x,h+=f.nk*x,c+=f.Hj*-b,l+=f.Ij*-b,u+=f.Jj*-b,c+=f.pk*-x,l+=f.qk*-x,u+=f.rk*-x}for(p=0,d=this.info.Ka;p<d;)f=p++,m=this.info.rows[f],f=this.ac[f],g=m.ta,y=0,y+=t*(v=m.Ng).va+e*v.wa+i*v.xa,y-=s*v.Ba+r*v.Ca+n*v.Da,y+=a*v.aa+o*v.ba+h*v.ca,y-=c*v.ea+l*v.fa+u*v.ga,m=(m.Fa-y)*f.he,y=g.bd,g.bd+=m,0>g.bd&&(g.bd=0),m=g.bd-y,t+=f.Zh*m,e+=f.$h*m,i+=f.ai*m,s+=f.bi*-m,r+=f.ci*-m,n+=f.di*-m,a+=f.Xf*m,o+=f.Yf*m,h+=f.Zf*m,c+=f.$f*-m,l+=f.ag*-m,u+=f.bg*-m;this.C.gb=t,this.C.hb=e,this.C.ib=i,this.D.gb=s,this.D.hb=r,this.D.ib=n,this.C.kb=a,this.C.lb=o,this.C.mb=h,this.D.kb=c,this.D.lb=l,this.D.mb=u},Pg:function(){this.Ji.al(),this.Ji.gd(this.info);var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v=this.C.$a,b=this.D.$a;t=this.C.P,e=this.C.R,i=this.C.S,s=this.C.T,r=this.C.U,n=this.C.V,a=this.C.W,o=this.C.X,h=this.C.Y,c=this.D.P,l=this.D.R,u=this.D.S,p=this.D.T,d=this.D.U,f=this.D.V,m=this.D.W,g=this.D.X,y=this.D.Y;for(var x=0,_=this.info.Ka;x<_;){var M,w,S,A=x++,T=this.ac[A];A=this.info.rows[A].Ng,T.Zh=A.va*v,T.$h=A.wa*v,T.ai=A.xa*v,T.bi=A.Ba*b,T.ci=A.Ca*b,T.di=A.Da*b,M=t*A.aa+e*A.ba+i*A.ca,w=s*A.aa+r*A.ba+n*A.ca,S=a*A.aa+o*A.ba+h*A.ca,T.Xf=M,T.Yf=w,T.Zf=S,M=c*A.ea+l*A.fa+u*A.ga,w=p*A.ea+d*A.fa+f*A.ga,S=m*A.ea+g*A.fa+y*A.ga,T.$f=M,T.ag=w,T.bg=S,T.he=v+b+(T.Xf*A.aa+T.Yf*A.ba+T.Zf*A.ca)+(T.$f*A.ea+T.ag*A.fa+T.bg*A.ga),0!=T.he&&(T.he=1/T.he)}for(v=0,b=this.info.Ka;v<b;)t=v++,this.info.rows[t].ta.ub=0},Bh:function(){var t,e,i,s,r,n,a,o,h,c,l,u;t=this.C.Yc,e=this.C.Zc,i=this.C.$c,s=this.D.Yc,r=this.D.Zc,n=this.D.$c,a=this.C.Uc,o=this.C.Vc,h=this.C.Wc,c=this.D.Uc,l=this.D.Vc,u=this.D.Wc;for(var p=0,d=this.info.Ka;p<d;){var f=p++,m=this.info.rows[f],g=(f=this.ac[f],m.ta),y=(y=(y=(y=(y=0)+(t*(v=m.Ng).va+e*v.wa+i*v.xa))-(s*v.Ba+r*v.Ca+n*v.Da))+(a*v.aa+o*v.ba+h*v.ca))-(c*v.ea+l*v.fa+u*v.ga),v=(m=(m.Fa-y)*f.he*yt.positionSplitImpulseBaumgarte,g.ub);g.ub+=m,0>g.ub&&(g.ub=0),m=g.ub-v,t+=f.Zh*m,e+=f.$h*m,i+=f.ai*m,s+=f.bi*-m,r+=f.ci*-m,n+=f.di*-m,a+=f.Xf*m,o+=f.Yf*m,h+=f.Zf*m,c+=f.$f*-m,l+=f.ag*-m,u+=f.bg*-m}this.C.Yc=t,this.C.Zc=e,this.C.$c=i,this.D.Yc=s,this.D.Zc=r,this.D.$c=n,this.C.Uc=a,this.C.Vc=o,this.C.Wc=h,this.D.Uc=c,this.D.Vc=l,this.D.Wc=u},Ah:function(){this.Ji.al(),this.Ji.gd(this.info);var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v=this.C.$a,b=this.D.$a;t=this.C.P,e=this.C.R,i=this.C.S,s=this.C.T,r=this.C.U,n=this.C.V,a=this.C.W,o=this.C.X,h=this.C.Y,c=this.D.P,l=this.D.R,u=this.D.S,p=this.D.T,d=this.D.U,f=this.D.V,m=this.D.W,g=this.D.X,y=this.D.Y;for(var x=0,_=this.info.Ka;x<_;){var M,w,S,A,T,C,L=x++,E=this.ac[L],z=this.info.rows[L].Ng;E.Zh=z.va*v,E.$h=z.wa*v,E.ai=z.xa*v,E.bi=z.Ba*b,E.ci=z.Ca*b,E.di=z.Da*b,M=t*z.aa+e*z.ba+i*z.ca,w=s*z.aa+r*z.ba+n*z.ca,S=a*z.aa+o*z.ba+h*z.ca,E.Xf=M,E.Yf=w,E.Zf=S,A=c*z.ea+l*z.fa+u*z.ga,T=p*z.ea+d*z.fa+f*z.ga,C=m*z.ea+g*z.fa+y*z.ga,E.$f=A,E.ag=T,E.bg=C,E.he=v+b+(E.Xf*z.aa+E.Yf*z.ba+E.Zf*z.ca)+(E.$f*z.ea+E.ag*z.fa+E.bg*z.ga),0!=E.he&&(E.he=1/E.he)}for(var R,B,P,D,I,O,F,G,N,j,V,U,k=U=V=j=N=G=F=O=I=D=P=B=R=0,H=this.info.Ka;k<H;){var W=k++,q=this.info.rows[W],$=this.ac[W],J=q.ta,X=q.Ng,Y=(Y=(Y=(Y=(Y=0)+(R*X.va+B*X.wa+P*X.xa))-(D*X.Ba+I*X.Ca+O*X.Da))+(F*X.aa+G*X.ba+N*X.ca))-(j*X.ea+V*X.fa+U*X.ga),K=(q.Fa-Y)*$.he*yt.positionNgsBaumgarte,Z=J.ub;J.ub+=K,0>J.ub&&(J.ub=0),K=J.ub-Z,R+=$.Zh*K,B+=$.$h*K,P+=$.ai*K,D+=$.bi*-K,I+=$.ci*-K,O+=$.di*-K,F+=$.Xf*K,G+=$.Yf*K,N+=$.Zf*K,j+=$.$f*-K,V+=$.ag*-K,U+=$.bg*-K}var Q=this.C;Q.a.v+=R,Q.a.A+=B,Q.a.B+=P;var tt=this.D;tt.a.v+=D,tt.a.A+=I,tt.a.B+=O;var et,it,st,rt,nt,at,ot=this.C,ht=Math.sqrt(F*F+G*G+N*N),ct=.5*ht;if(.5>ct){var lt=ct*ct;et=.5*(1-.16666666666666666*lt+lt*lt*.008333333333333333),it=1-.5*lt+lt*lt*.041666666666666664}else et=Math.sin(ct)/ht,it=Math.cos(ct);st=F*et,rt=G*et,nt=N*et,at=it;var ut,pt,dt,ft,mt,gt=ot.a.o,vt=ot.a.m,bt=ot.a.s,xt=gt+vt+bt;0<xt?(ft=.5*(mt=Math.sqrt(xt+1)),mt=.5/mt,ut=(ot.a.g-ot.a.j)*mt,pt=(ot.a.h-ot.a.l)*mt,dt=(ot.a.i-ot.a.f)*mt):gt>vt?gt>bt?(ut=.5*(mt=Math.sqrt(gt-vt-bt+1)),mt=.5/mt,pt=(ot.a.f+ot.a.i)*mt,dt=(ot.a.h+ot.a.l)*mt,ft=(ot.a.g-ot.a.j)*mt):(dt=.5*(mt=Math.sqrt(bt-gt-vt+1)),mt=.5/mt,ut=(ot.a.h+ot.a.l)*mt,pt=(ot.a.j+ot.a.g)*mt,ft=(ot.a.i-ot.a.f)*mt):vt>bt?(pt=.5*(mt=Math.sqrt(vt-bt-gt+1)),mt=.5/mt,ut=(ot.a.f+ot.a.i)*mt,dt=(ot.a.j+ot.a.g)*mt,ft=(ot.a.h-ot.a.l)*mt):(dt=.5*(mt=Math.sqrt(bt-gt-vt+1)),mt=.5/mt,ut=(ot.a.h+ot.a.l)*mt,pt=(ot.a.j+ot.a.g)*mt,ft=(ot.a.i-ot.a.f)*mt);var _t=(ut=at*ut+st*ft+rt*dt-nt*pt)*ut+(pt=at*pt-st*dt+rt*ft+nt*ut)*pt+(dt=at*dt+st*pt-rt*ut+nt*ft)*dt+(ft=at*ft-st*ut-rt*pt-nt*dt)*ft;1e-32<_t&&(_t=1/Math.sqrt(_t));var Mt,wt,St,At,Tt,Ct,Lt,Et,zt,Rt,Bt,Pt,Dt,It,Ot,Ft,Gt,Nt,jt=2*(ut*=_t),Vt=2*(pt*=_t),Ut=2*(dt*=_t),kt=ut*jt,Ht=pt*Vt,Wt=dt*Ut,qt=ut*Vt,$t=pt*Ut,Jt=ut*Ut,Xt=(ft*=_t)*jt,Yt=ft*Vt,Kt=ft*Ut;ot.a.o=1-Ht-Wt,ot.a.f=qt-Kt,ot.a.h=Jt+Yt,ot.a.i=qt+Kt,ot.a.m=1-kt-Wt,ot.a.j=$t-Xt,ot.a.l=Jt-Yt,ot.a.g=$t+Xt,ot.a.s=1-kt-Ht,Mt=ot.a.o*ot.Ra+ot.a.f*ot.Ua+ot.a.h*ot.Xa,wt=ot.a.o*ot.Sa+ot.a.f*ot.Va+ot.a.h*ot.Ya,St=ot.a.o*ot.Ta+ot.a.f*ot.Wa+ot.a.h*ot.Za,At=ot.a.i*ot.Ra+ot.a.m*ot.Ua+ot.a.j*ot.Xa,Tt=ot.a.i*ot.Sa+ot.a.m*ot.Va+ot.a.j*ot.Ya,Ct=ot.a.i*ot.Ta+ot.a.m*ot.Wa+ot.a.j*ot.Za,Lt=ot.a.l*ot.Ra+ot.a.g*ot.Ua+ot.a.s*ot.Xa,Et=ot.a.l*ot.Sa+ot.a.g*ot.Va+ot.a.s*ot.Ya,zt=ot.a.l*ot.Ta+ot.a.g*ot.Wa+ot.a.s*ot.Za,ot.P=Mt,ot.R=wt,ot.S=St,ot.T=At,ot.U=Tt,ot.V=Ct,ot.W=Lt,ot.X=Et,ot.Y=zt,Rt=ot.P*ot.a.o+ot.R*ot.a.f+ot.S*ot.a.h,Bt=ot.P*ot.a.i+ot.R*ot.a.m+ot.S*ot.a.j,Pt=ot.P*ot.a.l+ot.R*ot.a.g+ot.S*ot.a.s,Dt=ot.T*ot.a.o+ot.U*ot.a.f+ot.V*ot.a.h,It=ot.T*ot.a.i+ot.U*ot.a.m+ot.V*ot.a.j,Ot=ot.T*ot.a.l+ot.U*ot.a.g+ot.V*ot.a.s,Ft=ot.W*ot.a.o+ot.X*ot.a.f+ot.Y*ot.a.h,Gt=ot.W*ot.a.i+ot.X*ot.a.m+ot.Y*ot.a.j,Nt=ot.W*ot.a.l+ot.X*ot.a.g+ot.Y*ot.a.s,ot.P=Rt,ot.R=Bt,ot.S=Pt,ot.T=Dt,ot.U=It,ot.V=Ot,ot.W=Ft,ot.X=Gt,ot.Y=Nt,ot.P*=ot.N.x,ot.R*=ot.N.x,ot.S*=ot.N.x,ot.T*=ot.N.y,ot.U*=ot.N.y,ot.V*=ot.N.y,ot.W*=ot.N.z,ot.X*=ot.N.z,ot.Y*=ot.N.z;var Zt,Qt,te,ee,ie,se,re=this.D,ne=Math.sqrt(j*j+V*V+U*U),ae=.5*ne;if(.5>ae){var oe=ae*ae;Zt=.5*(1-.16666666666666666*oe+oe*oe*.008333333333333333),Qt=1-.5*oe+oe*oe*.041666666666666664}else Zt=Math.sin(ae)/ne,Qt=Math.cos(ae);te=j*Zt,ee=V*Zt,ie=U*Zt,se=Qt;var he,ce,le,ue,pe,de=re.a.o,fe=re.a.m,me=re.a.s,ge=de+fe+me;0<ge?(ue=.5*(pe=Math.sqrt(ge+1)),pe=.5/pe,he=(re.a.g-re.a.j)*pe,ce=(re.a.h-re.a.l)*pe,le=(re.a.i-re.a.f)*pe):de>fe?de>me?(he=.5*(pe=Math.sqrt(de-fe-me+1)),pe=.5/pe,ce=(re.a.f+re.a.i)*pe,le=(re.a.h+re.a.l)*pe,ue=(re.a.g-re.a.j)*pe):(le=.5*(pe=Math.sqrt(me-de-fe+1)),pe=.5/pe,he=(re.a.h+re.a.l)*pe,ce=(re.a.j+re.a.g)*pe,ue=(re.a.i-re.a.f)*pe):fe>me?(ce=.5*(pe=Math.sqrt(fe-me-de+1)),pe=.5/pe,he=(re.a.f+re.a.i)*pe,le=(re.a.j+re.a.g)*pe,ue=(re.a.h-re.a.l)*pe):(le=.5*(pe=Math.sqrt(me-de-fe+1)),pe=.5/pe,he=(re.a.h+re.a.l)*pe,ce=(re.a.j+re.a.g)*pe,ue=(re.a.i-re.a.f)*pe);var ye=(he=se*he+te*ue+ee*le-ie*ce)*he+(ce=se*ce-te*le+ee*ue+ie*he)*ce+(le=se*le+te*ce-ee*he+ie*ue)*le+(ue=se*ue-te*he-ee*ce-ie*le)*ue;1e-32<ye&&(ye=1/Math.sqrt(ye));var ve,be,xe,_e,Me,we,Se,Ae,Te,Ce,Le,Ee,ze,Re,Be,Pe,De,Ie,Oe=2*(he*=ye),Fe=2*(ce*=ye),Ge=2*(le*=ye),Ne=he*Oe,je=ce*Fe,Ve=le*Ge,Ue=he*Fe,ke=ce*Ge,He=he*Ge,We=(ue*=ye)*Oe,qe=ue*Fe,$e=ue*Ge;re.a.o=1-je-Ve,re.a.f=Ue-$e,re.a.h=He+qe,re.a.i=Ue+$e,re.a.m=1-Ne-Ve,re.a.j=ke-We,re.a.l=He-qe,re.a.g=ke+We,re.a.s=1-Ne-je,ve=re.a.o*re.Ra+re.a.f*re.Ua+re.a.h*re.Xa,be=re.a.o*re.Sa+re.a.f*re.Va+re.a.h*re.Ya,xe=re.a.o*re.Ta+re.a.f*re.Wa+re.a.h*re.Za,_e=re.a.i*re.Ra+re.a.m*re.Ua+re.a.j*re.Xa,Me=re.a.i*re.Sa+re.a.m*re.Va+re.a.j*re.Ya,we=re.a.i*re.Ta+re.a.m*re.Wa+re.a.j*re.Za,Se=re.a.l*re.Ra+re.a.g*re.Ua+re.a.s*re.Xa,Ae=re.a.l*re.Sa+re.a.g*re.Va+re.a.s*re.Ya,Te=re.a.l*re.Ta+re.a.g*re.Wa+re.a.s*re.Za,re.P=ve,re.R=be,re.S=xe,re.T=_e,re.U=Me,re.V=we,re.W=Se,re.X=Ae,re.Y=Te,Ce=re.P*re.a.o+re.R*re.a.f+re.S*re.a.h,Le=re.P*re.a.i+re.R*re.a.m+re.S*re.a.j,Ee=re.P*re.a.l+re.R*re.a.g+re.S*re.a.s,ze=re.T*re.a.o+re.U*re.a.f+re.V*re.a.h,Re=re.T*re.a.i+re.U*re.a.m+re.V*re.a.j,Be=re.T*re.a.l+re.U*re.a.g+re.V*re.a.s,Pe=re.W*re.a.o+re.X*re.a.f+re.Y*re.a.h,De=re.W*re.a.i+re.X*re.a.m+re.Y*re.a.j,Ie=re.W*re.a.l+re.X*re.a.g+re.Y*re.a.s,re.P=Ce,re.R=Le,re.S=Ee,re.T=ze,re.U=Re,re.V=Be,re.W=Pe,re.X=De,re.Y=Ie,re.P*=re.N.x,re.R*=re.N.x,re.S*=re.N.x,re.T*=re.N.y,re.U*=re.N.y,re.V*=re.N.y,re.W*=re.N.z,re.X*=re.N.z,re.Y*=re.N.z},postSolve:function(){for(var t=0,e=this.info.Ka;t<e;){var i,s,r,n=t++,a=(n=(o=this.info.rows[n]).ta,o.Lj),o=o.Kj;r=s=i=0,i+=a.va*n.zc,s+=a.wa*n.zc,r+=a.xa*n.zc,i+=o.va*n.yc,s+=o.wa*n.yc,r+=o.xa*n.yc,n.df=i,n.ef=s,n.ff=r}this.Ji.al()}}),n.ua=J,n.prototype=oe(J.prototype,{xh:function(t){this.$.hd(),this.$.$d(t,this.info),this.C=this.info.Qe,this.D=this.info.Re,t=this.C.$a;var e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v,b=this.D.$a;e=this.C.P,i=this.C.R,s=this.C.S,r=this.C.T,n=this.C.U,a=this.C.V,o=this.C.W,h=this.C.X,c=this.C.Y,l=this.D.P,u=this.D.R,p=this.D.S,d=this.D.T,f=this.D.U,m=this.D.V,g=this.D.W,y=this.D.X,v=this.D.Y;for(var x=0,_=this.info.Ka;x<_;){var M,w,S,A=x++,T=this.info.rows[A],C=(A=this.ac[A],T.Aa);C.Im(),1&C.xc?(A.qd=C.va*t,A.rd=C.wa*t,A.sd=C.xa*t,A.td=C.Ba*b,A.ud=C.Ca*b,A.vd=C.Da*b):(A.qd=0,A.rd=0,A.sd=0,A.td=0,A.ud=0,A.vd=0),2&C.xc?(M=e*C.aa+i*C.ba+s*C.ca,w=r*C.aa+n*C.ba+a*C.ca,S=o*C.aa+h*C.ba+c*C.ca,A.kd=M,A.ld=w,A.md=S,M=l*C.ea+u*C.fa+p*C.ga,w=d*C.ea+f*C.fa+m*C.ga,S=g*C.ea+y*C.fa+v*C.ga,A.nd=M,A.od=w,A.pd=S):(A.kd=0,A.ld=0,A.md=0,A.nd=0,A.od=0,A.pd=0),A.Ff=A.qd*C.va+A.rd*C.wa+A.sd*C.xa+(A.td*C.Ba+A.ud*C.Ca+A.vd*C.Da)+(A.kd*C.aa+A.ld*C.ba+A.md*C.ca)+(A.nd*C.ea+A.od*C.fa+A.pd*C.ga),A.mass=A.Ff+T.Ma,A.Ff&&(A.Ff=1/A.Ff),0!=A.mass&&(A.mass=1/A.mass)}},Gh:function(t){var e;if(0>=(e=(e=this.$.Hc==$.BAUMGARTE?yt.jointWarmStartingFactorForBaungarte:yt.jointWarmStartingFactor)*t.dtRatio))for(e=0,t=this.info.Ka;e<t;){var i=e++;(i=this.info.rows[i].ta).ta=0,i.ad=0,i.ub=0}else{var s,r,n,a,o,h,c,l,u,p;t=this.C.gb,i=this.C.hb,s=this.C.ib,r=this.D.gb,n=this.D.hb,a=this.D.ib,o=this.C.kb,h=this.C.lb,c=this.C.mb,l=this.D.kb,u=this.D.lb,p=this.D.mb;for(var d=0,f=this.info.Ka;d<f;){var m=d++,g=this.ac[m];(m=this.info.rows[m].ta).ta*=e,m.ad*=e,m=m.ta+m.ad,t+=g.qd*m,i+=g.rd*m,s+=g.sd*m,r+=g.td*-m,n+=g.ud*-m,a+=g.vd*-m,o+=g.kd*m,h+=g.ld*m,c+=g.md*m,l+=g.nd*-m,u+=g.od*-m,p+=g.pd*-m}this.C.gb=t,this.C.hb=i,this.C.ib=s,this.D.gb=r,this.D.hb=n,this.D.ib=a,this.C.kb=o,this.C.lb=h,this.C.mb=c,this.D.kb=l,this.D.lb=u,this.D.mb=p}},Ch:function(){var t,e,i,s,r,n,a,o,h,c,l,u;t=this.C.gb,e=this.C.hb,i=this.C.ib,s=this.D.gb,r=this.D.hb,n=this.D.ib,a=this.C.kb,o=this.C.lb,h=this.C.mb,c=this.D.kb,l=this.D.lb,u=this.D.mb;for(var p=0,d=this.info.Ka;p<d;){var f=p++,m=this.info.rows[f],g=(f=this.ac[f],m.ta),y=m.Aa;if(0!=m.fb){var v=(v=(v=(v=(v=0)+(t*y.va+e*y.wa+i*y.xa))-(s*y.Ba+r*y.Ca+n*y.Da))+(a*y.aa+o*y.ba+h*y.ca))-(c*y.ea+l*y.fa+u*y.ga),b=(v=(-m.motorSpeed-v)*f.Ff,g.ad);g.ad+=v,g.ad<-m.fb?g.ad=-m.fb:g.ad>m.fb&&(g.ad=m.fb),v=g.ad-b,1&y.xc&&(t+=f.qd*v,e+=f.rd*v,i+=f.sd*v,s+=f.td*-v,r+=f.ud*-v,n+=f.vd*-v),2&y.xc&&(a+=f.kd*v,o+=f.ld*v,h+=f.md*v,c+=f.nd*-v,l+=f.od*-v,u+=f.pd*-v)}}for(p=0,d=this.info.Ka;p<d;)f=p++,m=this.info.rows[f],f=this.ac[f],g=m.ta,v=0,v+=t*(y=m.Aa).va+e*y.wa+i*y.xa,v-=s*y.Ba+r*y.Ca+n*y.Da,v+=a*y.aa+o*y.ba+h*y.ca,v-=c*y.ea+l*y.fa+u*y.ga,v=(m.Fa-v-g.ta*m.Ma)*f.mass,b=g.ta,g.ta+=v,g.ta<m.Ia?g.ta=m.Ia:g.ta>m.Ha&&(g.ta=m.Ha),v=g.ta-b,1&y.xc&&(t+=f.qd*v,e+=f.rd*v,i+=f.sd*v,s+=f.td*-v,r+=f.ud*-v,n+=f.vd*-v),2&y.xc&&(a+=f.kd*v,o+=f.ld*v,h+=f.md*v,c+=f.nd*-v,l+=f.od*-v,u+=f.pd*-v);this.C.gb=t,this.C.hb=e,this.C.ib=i,this.D.gb=s,this.D.hb=r,this.D.ib=n,this.C.kb=a,this.C.lb=o,this.C.mb=h,this.D.kb=c,this.D.lb=l,this.D.mb=u},Li:function(t){for(var e,i,s,r,n,a,o=a=n=r=s=i=e=0,h=this.info.Ka;o<h;){var c,l=o++;l=(c=this.info.rows[l]).ta,1&(c=c.Aa).xc?(e+=c.va*l.ta,i+=c.wa*l.ta,s+=c.xa*l.ta):2&c.xc&&(r+=c.aa*l.ta,n+=c.ba*l.ta,a+=c.ca*l.ta)}this.$.Pi=e*t.invDt,this.$.Qi=i*t.invDt,this.$.Ri=s*t.invDt,this.$.Si=r*t.invDt,this.$.Ti=n*t.invDt,this.$.Ui=a*t.invDt},Pg:function(){this.$.hd(),this.$.gd(this.info),this.C=this.info.Qe,this.D=this.info.Re;var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v=this.C.$a,b=this.D.$a;t=this.C.P,e=this.C.R,i=this.C.S,s=this.C.T,r=this.C.U,n=this.C.V,a=this.C.W,o=this.C.X,h=this.C.Y,c=this.D.P,l=this.D.R,u=this.D.S,p=this.D.T,d=this.D.U,f=this.D.V,m=this.D.W,g=this.D.X,y=this.D.Y;for(var x=0,_=this.info.Ka;x<_;){var M,w,S,A=x++,T=this.ac[A];A=this.info.rows[A].Aa,T.qd=A.va*v,T.rd=A.wa*v,T.sd=A.xa*v,T.td=A.Ba*b,T.ud=A.Ca*b,T.vd=A.Da*b,M=t*A.aa+e*A.ba+i*A.ca,w=s*A.aa+r*A.ba+n*A.ca,S=a*A.aa+o*A.ba+h*A.ca,T.kd=M,T.ld=w,T.md=S,M=c*A.ea+l*A.fa+u*A.ga,w=p*A.ea+d*A.fa+f*A.ga,S=m*A.ea+g*A.fa+y*A.ga,T.nd=M,T.od=w,T.pd=S,T.mass=T.qd*A.va+T.rd*A.wa+T.sd*A.xa+(T.td*A.Ba+T.ud*A.Ca+T.vd*A.Da)+(T.kd*A.aa+T.ld*A.ba+T.md*A.ca)+(T.nd*A.ea+T.od*A.fa+T.pd*A.ga),T.mass&&(T.mass=1/T.mass)}for(v=0,b=this.info.Ka;v<b;)t=v++,this.info.rows[t].ta.ub=0},Bh:function(){var t,e,i,s,r,n,a,o,h,c,l,u;t=this.C.Yc,e=this.C.Zc,i=this.C.$c,s=this.D.Yc,r=this.D.Zc,n=this.D.$c,a=this.C.Uc,o=this.C.Vc,h=this.C.Wc,c=this.D.Uc,l=this.D.Vc,u=this.D.Wc;for(var p=0,d=this.info.Ka;p<d;){var f=p++,m=this.info.rows[f],g=(f=this.ac[f],m.ta),y=(y=(y=(y=(y=0)+(t*(v=m.Aa).va+e*v.wa+i*v.xa))-(s*v.Ba+r*v.Ca+n*v.Da))+(a*v.aa+o*v.ba+h*v.ca))-(c*v.ea+l*v.fa+u*v.ga),v=(m.Fa*yt.positionSplitImpulseBaumgarte-y)*f.mass;y=g.ub,g.ub+=v,g.ub<m.Ia?g.ub=m.Ia:g.ub>m.Ha&&(g.ub=m.Ha),v=g.ub-y,t+=f.qd*v,e+=f.rd*v,i+=f.sd*v,s+=f.td*-v,r+=f.ud*-v,n+=f.vd*-v,a+=f.kd*v,o+=f.ld*v,h+=f.md*v,c+=f.nd*-v,l+=f.od*-v,u+=f.pd*-v}this.C.Yc=t,this.C.Zc=e,this.C.$c=i,this.D.Yc=s,this.D.Zc=r,this.D.$c=n,this.C.Uc=a,this.C.Vc=o,this.C.Wc=h,this.D.Uc=c,this.D.Vc=l,this.D.Wc=u},Ah:function(){this.$.hd(),this.$.gd(this.info),this.C=this.info.Qe,this.D=this.info.Re;var t,e,i,s,r,n,a,o,h,c,l,u,p,d,f,m,g,y,v=this.C.$a,b=this.D.$a;t=this.C.P,e=this.C.R,i=this.C.S,s=this.C.T,r=this.C.U,n=this.C.V,a=this.C.W,o=this.C.X,h=this.C.Y,c=this.D.P,l=this.D.R,u=this.D.S,p=this.D.T,d=this.D.U,f=this.D.V,m=this.D.W,g=this.D.X,y=this.D.Y;for(var x=0,_=this.info.Ka;x<_;){var M,w,S,A,T,C,L=x++,E=this.ac[L],z=this.info.rows[L].Aa;E.qd=z.va*v,E.rd=z.wa*v,E.sd=z.xa*v,E.td=z.Ba*b,E.ud=z.Ca*b,E.vd=z.Da*b,M=t*z.aa+e*z.ba+i*z.ca,w=s*z.aa+r*z.ba+n*z.ca,S=a*z.aa+o*z.ba+h*z.ca,E.kd=M,E.ld=w,E.md=S,A=c*z.ea+l*z.fa+u*z.ga,T=p*z.ea+d*z.fa+f*z.ga,C=m*z.ea+g*z.fa+y*z.ga,E.nd=A,E.od=T,E.pd=C,E.mass=E.qd*z.va+E.rd*z.wa+E.sd*z.xa+(E.td*z.Ba+E.ud*z.Ca+E.vd*z.Da)+(E.kd*z.aa+E.ld*z.ba+E.md*z.ca)+(E.nd*z.ea+E.od*z.fa+E.pd*z.ga),E.mass&&(E.mass=1/E.mass)}for(var R,B,P,D,I,O,F,G,N,j,V,U,k=U=V=j=N=G=F=O=I=D=P=B=R=0,H=this.info.Ka;k<H;){var W=k++,q=this.info.rows[W],$=this.ac[W],J=q.ta,X=q.Aa,Y=(Y=(Y=(Y=(Y=0)+(R*X.va+B*X.wa+P*X.xa))-(D*X.Ba+I*X.Ca+O*X.Da))+(F*X.aa+G*X.ba+N*X.ca))-(j*X.ea+V*X.fa+U*X.ga),K=(q.Fa*yt.positionNgsBaumgarte-Y)*$.mass,Z=J.ub;J.ub+=K,J.ub<q.Ia?J.ub=q.Ia:J.ub>q.Ha&&(J.ub=q.Ha),K=J.ub-Z,R+=$.qd*K,B+=$.rd*K,P+=$.sd*K,D+=$.td*-K,I+=$.ud*-K,O+=$.vd*-K,F+=$.kd*K,G+=$.ld*K,N+=$.md*K,j+=$.nd*-K,V+=$.od*-K,U+=$.pd*-K}var Q=this.C;Q.a.v+=R,Q.a.A+=B,Q.a.B+=P;var tt=this.D;tt.a.v+=D,tt.a.A+=I,tt.a.B+=O;var et,it,st,rt,nt,at,ot=this.C,ht=Math.sqrt(F*F+G*G+N*N),ct=.5*ht;if(.5>ct){var lt=ct*ct;et=.5*(1-.16666666666666666*lt+lt*lt*.008333333333333333),it=1-.5*lt+lt*lt*.041666666666666664}else et=Math.sin(ct)/ht,it=Math.cos(ct);st=F*et,rt=G*et,nt=N*et,at=it;var ut,pt,dt,ft,mt,gt=ot.a.o,vt=ot.a.m,bt=ot.a.s,xt=gt+vt+bt;0<xt?(ft=.5*(mt=Math.sqrt(xt+1)),mt=.5/mt,ut=(ot.a.g-ot.a.j)*mt,pt=(ot.a.h-ot.a.l)*mt,dt=(ot.a.i-ot.a.f)*mt):gt>vt?gt>bt?(ut=.5*(mt=Math.sqrt(gt-vt-bt+1)),mt=.5/mt,pt=(ot.a.f+ot.a.i)*mt,dt=(ot.a.h+ot.a.l)*mt,ft=(ot.a.g-ot.a.j)*mt):(dt=.5*(mt=Math.sqrt(bt-gt-vt+1)),mt=.5/mt,ut=(ot.a.h+ot.a.l)*mt,pt=(ot.a.j+ot.a.g)*mt,ft=(ot.a.i-ot.a.f)*mt):vt>bt?(pt=.5*(mt=Math.sqrt(vt-bt-gt+1)),mt=.5/mt,ut=(ot.a.f+ot.a.i)*mt,dt=(ot.a.j+ot.a.g)*mt,ft=(ot.a.h-ot.a.l)*mt):(dt=.5*(mt=Math.sqrt(bt-gt-vt+1)),mt=.5/mt,ut=(ot.a.h+ot.a.l)*mt,pt=(ot.a.j+ot.a.g)*mt,ft=(ot.a.i-ot.a.f)*mt);var _t=(ut=at*ut+st*ft+rt*dt-nt*pt)*ut+(pt=at*pt-st*dt+rt*ft+nt*ut)*pt+(dt=at*dt+st*pt-rt*ut+nt*ft)*dt+(ft=at*ft-st*ut-rt*pt-nt*dt)*ft;1e-32<_t&&(_t=1/Math.sqrt(_t));var Mt,wt,St,At,Tt,Ct,Lt,Et,zt,Rt,Bt,Pt,Dt,It,Ot,Ft,Gt,Nt,jt=2*(ut*=_t),Vt=2*(pt*=_t),Ut=2*(dt*=_t),kt=ut*jt,Ht=pt*Vt,Wt=dt*Ut,qt=ut*Vt,$t=pt*Ut,Jt=ut*Ut,Xt=(ft*=_t)*jt,Yt=ft*Vt,Kt=ft*Ut;ot.a.o=1-Ht-Wt,ot.a.f=qt-Kt,ot.a.h=Jt+Yt,ot.a.i=qt+Kt,ot.a.m=1-kt-Wt,ot.a.j=$t-Xt,ot.a.l=Jt-Yt,ot.a.g=$t+Xt,ot.a.s=1-kt-Ht,Mt=ot.a.o*ot.Ra+ot.a.f*ot.Ua+ot.a.h*ot.Xa,wt=ot.a.o*ot.Sa+ot.a.f*ot.Va+ot.a.h*ot.Ya,St=ot.a.o*ot.Ta+ot.a.f*ot.Wa+ot.a.h*ot.Za,At=ot.a.i*ot.Ra+ot.a.m*ot.Ua+ot.a.j*ot.Xa,Tt=ot.a.i*ot.Sa+ot.a.m*ot.Va+ot.a.j*ot.Ya,Ct=ot.a.i*ot.Ta+ot.a.m*ot.Wa+ot.a.j*ot.Za,Lt=ot.a.l*ot.Ra+ot.a.g*ot.Ua+ot.a.s*ot.Xa,Et=ot.a.l*ot.Sa+ot.a.g*ot.Va+ot.a.s*ot.Ya,zt=ot.a.l*ot.Ta+ot.a.g*ot.Wa+ot.a.s*ot.Za,ot.P=Mt,ot.R=wt,ot.S=St,ot.T=At,ot.U=Tt,ot.V=Ct,ot.W=Lt,ot.X=Et,ot.Y=zt,Rt=ot.P*ot.a.o+ot.R*ot.a.f+ot.S*ot.a.h,Bt=ot.P*ot.a.i+ot.R*ot.a.m+ot.S*ot.a.j,Pt=ot.P*ot.a.l+ot.R*ot.a.g+ot.S*ot.a.s,Dt=ot.T*ot.a.o+ot.U*ot.a.f+ot.V*ot.a.h,It=ot.T*ot.a.i+ot.U*ot.a.m+ot.V*ot.a.j,Ot=ot.T*ot.a.l+ot.U*ot.a.g+ot.V*ot.a.s,Ft=ot.W*ot.a.o+ot.X*ot.a.f+ot.Y*ot.a.h,Gt=ot.W*ot.a.i+ot.X*ot.a.m+ot.Y*ot.a.j,Nt=ot.W*ot.a.l+ot.X*ot.a.g+ot.Y*ot.a.s,ot.P=Rt,ot.R=Bt,ot.S=Pt,ot.T=Dt,ot.U=It,ot.V=Ot,ot.W=Ft,ot.X=Gt,ot.Y=Nt,ot.P*=ot.N.x,ot.R*=ot.N.x,ot.S*=ot.N.x,ot.T*=ot.N.y,ot.U*=ot.N.y,ot.V*=ot.N.y,ot.W*=ot.N.z,ot.X*=ot.N.z,ot.Y*=ot.N.z;var Zt,Qt,te,ee,ie,se,re=this.D,ne=Math.sqrt(j*j+V*V+U*U),ae=.5*ne;if(.5>ae){var oe=ae*ae;Zt=.5*(1-.16666666666666666*oe+oe*oe*.008333333333333333),Qt=1-.5*oe+oe*oe*.041666666666666664}else Zt=Math.sin(ae)/ne,Qt=Math.cos(ae);te=j*Zt,ee=V*Zt,ie=U*Zt,se=Qt;var he,ce,le,ue,pe,de=re.a.o,fe=re.a.m,me=re.a.s,ge=de+fe+me;0<ge?(ue=.5*(pe=Math.sqrt(ge+1)),pe=.5/pe,he=(re.a.g-re.a.j)*pe,ce=(re.a.h-re.a.l)*pe,le=(re.a.i-re.a.f)*pe):de>fe?de>me?(he=.5*(pe=Math.sqrt(de-fe-me+1)),pe=.5/pe,ce=(re.a.f+re.a.i)*pe,le=(re.a.h+re.a.l)*pe,ue=(re.a.g-re.a.j)*pe):(le=.5*(pe=Math.sqrt(me-de-fe+1)),pe=.5/pe,he=(re.a.h+re.a.l)*pe,ce=(re.a.j+re.a.g)*pe,ue=(re.a.i-re.a.f)*pe):fe>me?(ce=.5*(pe=Math.sqrt(fe-me-de+1)),pe=.5/pe,he=(re.a.f+re.a.i)*pe,le=(re.a.j+re.a.g)*pe,ue=(re.a.h-re.a.l)*pe):(le=.5*(pe=Math.sqrt(me-de-fe+1)),pe=.5/pe,he=(re.a.h+re.a.l)*pe,ce=(re.a.j+re.a.g)*pe,ue=(re.a.i-re.a.f)*pe);var ye=(he=se*he+te*ue+ee*le-ie*ce)*he+(ce=se*ce-te*le+ee*ue+ie*he)*ce+(le=se*le+te*ce-ee*he+ie*ue)*le+(ue=se*ue-te*he-ee*ce-ie*le)*ue;1e-32<ye&&(ye=1/Math.sqrt(ye));var ve,be,xe,_e,Me,we,Se,Ae,Te,Ce,Le,Ee,ze,Re,Be,Pe,De,Ie,Oe=2*(he*=ye),Fe=2*(ce*=ye),Ge=2*(le*=ye),Ne=he*Oe,je=ce*Fe,Ve=le*Ge,Ue=he*Fe,ke=ce*Ge,He=he*Ge,We=(ue*=ye)*Oe,qe=ue*Fe,$e=ue*Ge;re.a.o=1-je-Ve,re.a.f=Ue-$e,re.a.h=He+qe,re.a.i=Ue+$e,re.a.m=1-Ne-Ve,re.a.j=ke-We,re.a.l=He-qe,re.a.g=ke+We,re.a.s=1-Ne-je,ve=re.a.o*re.Ra+re.a.f*re.Ua+re.a.h*re.Xa,be=re.a.o*re.Sa+re.a.f*re.Va+re.a.h*re.Ya,xe=re.a.o*re.Ta+re.a.f*re.Wa+re.a.h*re.Za,_e=re.a.i*re.Ra+re.a.m*re.Ua+re.a.j*re.Xa,Me=re.a.i*re.Sa+re.a.m*re.Va+re.a.j*re.Ya,we=re.a.i*re.Ta+re.a.m*re.Wa+re.a.j*re.Za,Se=re.a.l*re.Ra+re.a.g*re.Ua+re.a.s*re.Xa,Ae=re.a.l*re.Sa+re.a.g*re.Va+re.a.s*re.Ya,Te=re.a.l*re.Ta+re.a.g*re.Wa+re.a.s*re.Za,re.P=ve,re.R=be,re.S=xe,re.T=_e,re.U=Me,re.V=we,re.W=Se,re.X=Ae,re.Y=Te,Ce=re.P*re.a.o+re.R*re.a.f+re.S*re.a.h,Le=re.P*re.a.i+re.R*re.a.m+re.S*re.a.j,Ee=re.P*re.a.l+re.R*re.a.g+re.S*re.a.s,ze=re.T*re.a.o+re.U*re.a.f+re.V*re.a.h,Re=re.T*re.a.i+re.U*re.a.m+re.V*re.a.j,Be=re.T*re.a.l+re.U*re.a.g+re.V*re.a.s,Pe=re.W*re.a.o+re.X*re.a.f+re.Y*re.a.h,De=re.W*re.a.i+re.X*re.a.m+re.Y*re.a.j,Ie=re.W*re.a.l+re.X*re.a.g+re.Y*re.a.s,re.P=Ce,re.R=Le,re.S=Ee,re.T=ze,re.U=Re,re.V=Be,re.W=Pe,re.X=De,re.Y=Ie,re.P*=re.N.x,re.R*=re.N.x,re.S*=re.N.x,re.T*=re.N.y,re.U*=re.N.y,re.V*=re.N.y,re.W*=re.N.z,re.X*=re.N.z,re.Y*=re.N.z},postSolve:function(){this.$.hd(),this.$.Rl()}}),s.prototype={Wl:function(t){switch(this.Lb){case 1:this.Wc=this.Vc=this.Uc=this.$c=this.Zc=this.Yc=this.mb=this.lb=this.kb=this.ib=this.hb=this.gb=0;break;case 0:case 2:var e,i,s,r,n;e=this.gb*t,i=this.hb*t,s=this.ib*t;var a=(r=this.kb*t)*r+(n=this.lb*t)*n+(t=this.mb*t)*t;if((o=e*e+i*i+s*s)||a){var o,h;o>yt.maxTranslationPerStep*yt.maxTranslationPerStep&&(o=yt.maxTranslationPerStep/Math.sqrt(o),this.gb*=o,this.hb*=o,this.ib*=o,e*=o,i*=o,s*=o),a>yt.maxRotationPerStep*yt.maxRotationPerStep&&(a=yt.maxRotationPerStep/Math.sqrt(a),this.kb*=a,this.lb*=a,this.mb*=a,r*=a,n*=a,t*=a),this.a.v+=e,this.a.A+=i,this.a.B+=s,.5>(i=.5*(e=Math.sqrt(r*r+n*n+t*t)))?(e=.5*(1-.16666666666666666*(i*=i)+i*i*.008333333333333333),i=1-.5*i+i*i*.041666666666666664):(e=Math.sin(i)/e,i=Math.cos(i)),r*=e,n*=e,t*=e,e=i,0<(o=(i=this.a.o)+(s=this.a.m)+(a=this.a.s))?(i=.5*(h=Math.sqrt(o+1)),h=.5/h,o=(this.a.g-this.a.j)*h,a=(this.a.h-this.a.l)*h,s=(this.a.i-this.a.f)*h):i>s?i>a?(o=.5*(h=Math.sqrt(i-s-a+1)),h=.5/h,a=(this.a.f+this.a.i)*h,s=(this.a.h+this.a.l)*h,i=(this.a.g-this.a.j)*h):(s=.5*(h=Math.sqrt(a-i-s+1)),h=.5/h,o=(this.a.h+this.a.l)*h,a=(this.a.j+this.a.g)*h,i=(this.a.i-this.a.f)*h):s>a?(a=.5*(h=Math.sqrt(s-a-i+1)),h=.5/h,o=(this.a.f+this.a.i)*h,s=(this.a.j+this.a.g)*h,i=(this.a.h-this.a.l)*h):(s=.5*(h=Math.sqrt(a-i-s+1)),h=.5/h,o=(this.a.h+this.a.l)*h,a=(this.a.j+this.a.g)*h,i=(this.a.i-this.a.f)*h),1e-32<(t=(o=e*o+r*i+n*s-t*a)*o+(a=e*a-r*s+n*i+t*o)*a+(s=e*s+r*a-n*o+t*i)*s+(i=e*i-r*o-n*a-t*s)*i)&&(t=1/Math.sqrt(t)),n=o*t,o=a*t,s*=t,e=i*t;var c=2*n;t=n*c,r=o*(h=2*o),s*=i=2*s,a=n*h,o*=i,n*=i,c*=e,h*=e,e*=i,this.a.o=1-r-s,this.a.f=a-e,this.a.h=n+h,this.a.i=a+e,this.a.m=1-t-s,this.a.j=o-c,this.a.l=n-h,this.a.g=o+c,this.a.s=1-t-r,n=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,t=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,r=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,e=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,i=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,s=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,a=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,o=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,h=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=n,this.R=t,this.S=r,this.T=e,this.U=i,this.V=s,this.W=a,this.X=o,this.Y=h,n=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,t=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,r=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,e=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,i=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,s=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,a=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,o=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,h=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=n,this.R=t,this.S=r,this.T=e,this.U=i,this.V=s,this.W=a,this.X=o,this.Y=h,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z}}},dn:function(){var t=this.Uc*this.Uc+this.Vc*this.Vc+this.Wc*this.Wc;if(this.Yc*this.Yc+this.Zc*this.Zc+this.$c*this.$c||t)switch(this.Lb){case 1:this.Wc=this.Vc=this.Uc=this.$c=this.Zc=this.Yc=0;break;case 0:case 2:var e,i,s,r,n,a,o,h;e=this.Yc,i=this.Zc,s=this.$c,t=this.Uc,r=this.Vc,n=this.Wc,this.Wc=this.Vc=this.Uc=this.$c=this.Zc=this.Yc=0,this.a.v+=e,this.a.A+=i,this.a.B+=s,.5>(i=.5*(e=Math.sqrt(t*t+r*r+n*n)))?(e=.5*(1-.16666666666666666*(i*=i)+i*i*.008333333333333333),i=1-.5*i+i*i*.041666666666666664):(e=Math.sin(i)/e,i=Math.cos(i)),t*=e,r*=e,n*=e,e=i,0<(a=(i=this.a.o)+(s=this.a.m)+(o=this.a.s))?(i=.5*(h=Math.sqrt(a+1)),h=.5/h,a=(this.a.g-this.a.j)*h,o=(this.a.h-this.a.l)*h,s=(this.a.i-this.a.f)*h):i>s?i>o?(a=.5*(h=Math.sqrt(i-s-o+1)),h=.5/h,o=(this.a.f+this.a.i)*h,s=(this.a.h+this.a.l)*h,i=(this.a.g-this.a.j)*h):(s=.5*(h=Math.sqrt(o-i-s+1)),h=.5/h,a=(this.a.h+this.a.l)*h,o=(this.a.j+this.a.g)*h,i=(this.a.i-this.a.f)*h):s>o?(o=.5*(h=Math.sqrt(s-o-i+1)),h=.5/h,a=(this.a.f+this.a.i)*h,s=(this.a.j+this.a.g)*h,i=(this.a.h-this.a.l)*h):(s=.5*(h=Math.sqrt(o-i-s+1)),h=.5/h,a=(this.a.h+this.a.l)*h,o=(this.a.j+this.a.g)*h,i=(this.a.i-this.a.f)*h),1e-32<(r=(a=e*a+t*i+r*s-n*o)*a+(o=e*o-t*s+r*i+n*a)*o+(s=e*s+t*o-r*a+n*i)*s+(i=e*i-t*a-r*o-n*s)*i)&&(r=1/Math.sqrt(r)),t=a*r,a=o*r,s*=r,e=i*r;var c=2*t;r=t*c,n=a*(h=2*a),s*=i=2*s,o=t*h,a*=i,t*=i,c*=e,h*=e,e*=i,this.a.o=1-n-s,this.a.f=o-e,this.a.h=t+h,this.a.i=o+e,this.a.m=1-r-s,this.a.j=a-c,this.a.l=t-h,this.a.g=a+c,this.a.s=1-r-n,t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,r=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,n=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,e=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,i=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,s=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,o=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,a=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,h=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=r,this.S=n,this.T=e,this.U=i,this.V=s,this.W=o,this.X=a,this.Y=h,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,r=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,n=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,e=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,i=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,s=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,o=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,a=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,h=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=r,this.S=n,this.T=e,this.U=i,this.V=s,this.W=o,this.X=a,this.Y=h,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z}},Oj:function(){for(var t,e,i,s,r,n,a,o,h,c=h=o=a=n=r=s=i=e=t=0,l=this.Dc;null!=l;){var u=l.M;(E=l.Kb).Oe();var p,d,f,m,g,y,v,b,x=l.Dk*E.yf;p=l.ha.o*E.mg+l.ha.f*E.pg+l.ha.h*E.sg,d=l.ha.o*E.ng+l.ha.f*E.qg+l.ha.h*E.tg,f=l.ha.o*E.og+l.ha.f*E.rg+l.ha.h*E.ug,m=l.ha.i*E.mg+l.ha.m*E.pg+l.ha.j*E.sg,g=l.ha.i*E.ng+l.ha.m*E.qg+l.ha.j*E.tg,y=l.ha.i*E.og+l.ha.m*E.rg+l.ha.j*E.ug,v=l.ha.l*E.mg+l.ha.g*E.pg+l.ha.s*E.sg,b=l.ha.l*E.ng+l.ha.g*E.qg+l.ha.s*E.tg;var _,M,w,S,A,T,C,L,E=l.ha.l*E.og+l.ha.g*E.rg+l.ha.s*E.ug;_=p*l.ha.o+d*l.ha.f+f*l.ha.h,M=p*l.ha.i+d*l.ha.m+f*l.ha.j,f=p*l.ha.l+d*l.ha.g+f*l.ha.s,w=m*l.ha.o+g*l.ha.f+y*l.ha.h,S=m*l.ha.i+g*l.ha.m+y*l.ha.j,y=m*l.ha.l+g*l.ha.g+y*l.ha.s,A=v*l.ha.o+b*l.ha.f+E*l.ha.h,T=v*l.ha.i+b*l.ha.m+E*l.ha.j,E=v*l.ha.l+b*l.ha.g+E*l.ha.s,p=_,d=M,m=w,g=S,v=A,b=T,p*=x,d*=x,f*=x,m*=x,g*=x,y*=x,v*=x,b*=x,E*=x,w=l.ha.v*l.ha.v,S=l.ha.A*l.ha.A,C=l.ha.B*l.ha.B,A=-l.ha.v*l.ha.A,T=-l.ha.A*l.ha.B,L=-l.ha.B*l.ha.v,c+=x,t+=p+=(l=S+C)*x,e+=d+=(_=A)*x,i+=f+=(M=L)*x,s+=m+=A*x,r+=g+=(C=w+C)*x,n+=y+=T*x,a+=v+=L*x,o+=b+=T*x,h+=E+=(w+=S)*x,l=u}this.Pc=c,this.Ad=t,this.Bd=e,this.Cd=i,this.Dd=s,this.Ed=r,this.Fd=n,this.Gd=a,this.Hd=o,this.Id=h,t=this.Ad*(this.Ed*this.Id-this.Fd*this.Hd)-this.Bd*(this.Dd*this.Id-this.Fd*this.Gd)+this.Cd*(this.Dd*this.Hd-this.Ed*this.Gd),0==this.Lb?(this.$a=1/this.Pc,t=this.Ed*this.Id-this.Fd*this.Hd,e=this.Dd*this.Id-this.Fd*this.Gd,i=this.Dd*this.Hd-this.Ed*this.Gd,s=this.Bd*this.Id-this.Cd*this.Hd,r=this.Ad*this.Id-this.Cd*this.Gd,n=this.Ad*this.Hd-this.Bd*this.Gd,a=this.Bd*this.Fd-this.Cd*this.Ed,o=this.Ad*this.Fd-this.Cd*this.Dd,h=this.Ad*this.Ed-this.Bd*this.Dd,(-1e-32>(c=this.Ad*t-this.Bd*e+this.Cd*i)||1e-32<c)&&(c=1/c),this.Ra=t*c,this.Sa=-s*c,this.Ta=a*c,this.Ua=-e*c,this.Va=r*c,this.Wa=-o*c,this.Xa=i*c,this.Ya=-n*c,this.Za=h*c,this.pi=this.Ra,this.ri=this.Sa,this.si=this.Ta,this.ti=this.Ua,this.ui=this.Va,this.vi=this.Wa,this.wi=this.Xa,this.xi=this.Ya,this.yi=this.Za,this.Ra=this.pi*this.N.x,this.Sa=this.ri*this.N.x,this.Ta=this.si*this.N.x,this.Ua=this.ti*this.N.y,this.Va=this.ui*this.N.y,this.Wa=this.vi*this.N.y,this.Xa=this.wi*this.N.z,this.Ya=this.xi*this.N.z,this.Za=this.yi*this.N.z):this.yi=this.xi=this.wi=this.vi=this.ui=this.ti=this.si=this.ri=this.pi=this.Za=this.Ya=this.Xa=this.Wa=this.Va=this.Ua=this.Ta=this.Sa=this.Ra=this.$a=0,t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,e=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,i=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,s=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,r=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,n=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,a=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,o=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,h=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,e=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,i=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,s=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,r=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,n=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,a=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,o=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,h=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,this.Gb=!1,this.yb=0},qm:function(){var t=new bt;return t.x=this.a.v,t.y=this.a.A,t.z=this.a.B,t},rm:function(t){t.x=this.a.v,t.y=this.a.A,t.z=this.a.B},Xn:function(t){this.a.v=t.x,this.a.A=t.y,this.a.B=t.z,t=this.pa;var e=this.a;for(t.v=e.v,t.A=e.A,t.B=e.B,t.o=e.o,t.f=e.f,t.h=e.h,t.i=e.i,t.m=e.m,t.j=e.j,t.l=e.l,t.g=e.g,t.s=e.s,t=this.Dc;null!=t;){e=t.M;var i,s,r,n,a,o,h,c,l,u=t.pa,p=t.ha,d=this.pa;i=d.o*p.o+d.f*p.i+d.h*p.l,s=d.o*p.f+d.f*p.m+d.h*p.g,r=d.o*p.h+d.f*p.j+d.h*p.s,n=d.i*p.o+d.m*p.i+d.j*p.l,a=d.i*p.f+d.m*p.m+d.j*p.g,o=d.i*p.h+d.m*p.j+d.j*p.s,h=d.l*p.o+d.g*p.i+d.s*p.l,c=d.l*p.f+d.g*p.m+d.s*p.g,l=d.l*p.h+d.g*p.j+d.s*p.s,u.o=i,u.f=s,u.h=r,u.i=n,u.m=a,u.j=o,u.l=h,u.g=c,u.s=l,i=d.o*p.v+d.f*p.A+d.h*p.B,s=d.i*p.v+d.m*p.A+d.j*p.B,p=d.l*p.v+d.g*p.A+d.s*p.B,u.v=i,u.A=s,u.B=p,u.v+=d.v,u.A+=d.A,u.B+=d.B,u=t.a,p=t.ha,i=(d=this.a).o*p.o+d.f*p.i+d.h*p.l,s=d.o*p.f+d.f*p.m+d.h*p.g,r=d.o*p.h+d.f*p.j+d.h*p.s,n=d.i*p.o+d.m*p.i+d.j*p.l,a=d.i*p.f+d.m*p.m+d.j*p.g,o=d.i*p.h+d.m*p.j+d.j*p.s,h=d.l*p.o+d.g*p.i+d.s*p.l,c=d.l*p.f+d.g*p.m+d.s*p.g,l=d.l*p.h+d.g*p.j+d.s*p.s,u.o=i,u.f=s,u.h=r,u.i=n,u.m=a,u.j=o,u.l=h,u.g=c,u.s=l,i=d.o*p.v+d.f*p.A+d.h*p.B,s=d.i*p.v+d.m*p.A+d.j*p.B,p=d.l*p.v+d.g*p.A+d.s*p.B,u.v=i,u.A=s,u.B=p,u.v+=d.v,u.A+=d.A,u.B+=d.B,t.Kb.Nb(t.u,t.pa),u=t.u.ma,d=t.u.na,p=t.u.oa,i=t.u.ja,s=t.u.ka,r=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=u<t.u.ma?u:t.u.ma,t.u.na=d<t.u.na?d:t.u.na,t.u.oa=p<t.u.oa?p:t.u.oa,t.u.ja=i>t.u.ja?i:t.u.ja,t.u.ka=s>t.u.ka?s:t.u.ka,t.u.la=r>t.u.la?r:t.u.la,null!=t.tb&&(u=t.a.v-t.pa.v,d=t.a.A-t.pa.A,p=t.a.B-t.pa.B,(i=t.rc).x=u,i.y=d,i.z=p,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=e}this.Gb=!1,this.yb=0},jo:function(t){var e,i;for(e=t.x,i=t.y,t=t.z,this.a.v+=e,this.a.A+=i,this.a.B+=t,e=this.pa,i=this.a,e.v=i.v,e.A=i.A,e.B=i.B,e.o=i.o,e.f=i.f,e.h=i.h,e.i=i.i,e.m=i.m,e.j=i.j,e.l=i.l,e.g=i.g,e.s=i.s,e=this.Dc;null!=e;){i=e.M,t=e.pa;var s,r,n,a,o,h,c,l,u,p=e.ha,d=this.pa;s=d.o*p.o+d.f*p.i+d.h*p.l,r=d.o*p.f+d.f*p.m+d.h*p.g,n=d.o*p.h+d.f*p.j+d.h*p.s,a=d.i*p.o+d.m*p.i+d.j*p.l,o=d.i*p.f+d.m*p.m+d.j*p.g,h=d.i*p.h+d.m*p.j+d.j*p.s,c=d.l*p.o+d.g*p.i+d.s*p.l,l=d.l*p.f+d.g*p.m+d.s*p.g,u=d.l*p.h+d.g*p.j+d.s*p.s,t.o=s,t.f=r,t.h=n,t.i=a,t.m=o,t.j=h,t.l=c,t.g=l,t.s=u,s=d.o*p.v+d.f*p.A+d.h*p.B,r=d.i*p.v+d.m*p.A+d.j*p.B,p=d.l*p.v+d.g*p.A+d.s*p.B,t.v=s,t.A=r,t.B=p,t.v+=d.v,t.A+=d.A,t.B+=d.B,t=e.a,p=e.ha,s=(d=this.a).o*p.o+d.f*p.i+d.h*p.l,r=d.o*p.f+d.f*p.m+d.h*p.g,n=d.o*p.h+d.f*p.j+d.h*p.s,a=d.i*p.o+d.m*p.i+d.j*p.l,o=d.i*p.f+d.m*p.m+d.j*p.g,h=d.i*p.h+d.m*p.j+d.j*p.s,c=d.l*p.o+d.g*p.i+d.s*p.l,l=d.l*p.f+d.g*p.m+d.s*p.g,u=d.l*p.h+d.g*p.j+d.s*p.s,t.o=s,t.f=r,t.h=n,t.i=a,t.m=o,t.j=h,t.l=c,t.g=l,t.s=u,s=d.o*p.v+d.f*p.A+d.h*p.B,r=d.i*p.v+d.m*p.A+d.j*p.B,p=d.l*p.v+d.g*p.A+d.s*p.B,t.v=s,t.A=r,t.B=p,t.v+=d.v,t.A+=d.A,t.B+=d.B,e.Kb.Nb(e.u,e.pa),t=e.u.ma,d=e.u.na,p=e.u.oa,s=e.u.ja,r=e.u.ka,n=e.u.la,e.Kb.Nb(e.u,e.a),e.u.ma=t<e.u.ma?t:e.u.ma,e.u.na=d<e.u.na?d:e.u.na,e.u.oa=p<e.u.oa?p:e.u.oa,e.u.ja=s>e.u.ja?s:e.u.ja,e.u.ka=r>e.u.ka?r:e.u.ka,e.u.la=n>e.u.la?n:e.u.la,null!=e.tb&&(t=e.a.v-e.pa.v,d=e.a.A-e.pa.A,p=e.a.B-e.pa.B,(s=e.rc).x=t,s.y=d,s.z=p,e.Yb.oc.jc.wd(e.tb,e.u,e.rc)),e=i}this.Gb=!1,this.yb=0},vm:function(){var t=new dt;return t.e00=this.a.o,t.e01=this.a.f,t.e02=this.a.h,t.e10=this.a.i,t.e11=this.a.m,t.e12=this.a.j,t.e20=this.a.l,t.e21=this.a.g,t.e22=this.a.s,t},wm:function(t){t.e00=this.a.o,t.e01=this.a.f,t.e02=this.a.h,t.e10=this.a.i,t.e11=this.a.m,t.e12=this.a.j,t.e20=this.a.l,t.e21=this.a.g,t.e22=this.a.s},$n:function(t){var e,i,s,r,n,a,o,h;for(this.a.o=t.e00,this.a.f=t.e01,this.a.h=t.e02,this.a.i=t.e10,this.a.m=t.e11,this.a.j=t.e12,this.a.l=t.e20,this.a.g=t.e21,this.a.s=t.e22,t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,e=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,i=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,s=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,r=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,n=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,a=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,o=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,h=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,e=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,i=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,s=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,r=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,n=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,a=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,o=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,h=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,t=this.pa,e=this.a,t.v=e.v,t.A=e.A,t.B=e.B,t.o=e.o,t.f=e.f,t.h=e.h,t.i=e.i,t.m=e.m,t.j=e.j,t.l=e.l,t.g=e.g,t.s=e.s,t=this.Dc;null!=t;){var c,l,u,p,d;e=t.M,i=t.pa,r=t.ha,n=(s=this.pa).o*r.o+s.f*r.i+s.h*r.l,a=s.o*r.f+s.f*r.m+s.h*r.g,o=s.o*r.h+s.f*r.j+s.h*r.s,h=s.i*r.o+s.m*r.i+s.j*r.l,c=s.i*r.f+s.m*r.m+s.j*r.g,l=s.i*r.h+s.m*r.j+s.j*r.s,u=s.l*r.o+s.g*r.i+s.s*r.l,p=s.l*r.f+s.g*r.m+s.s*r.g,d=s.l*r.h+s.g*r.j+s.s*r.s,i.o=n,i.f=a,i.h=o,i.i=h,i.m=c,i.j=l,i.l=u,i.g=p,i.s=d,n=s.o*r.v+s.f*r.A+s.h*r.B,a=s.i*r.v+s.m*r.A+s.j*r.B,r=s.l*r.v+s.g*r.A+s.s*r.B,i.v=n,i.A=a,i.B=r,i.v+=s.v,i.A+=s.A,i.B+=s.B,i=t.a,r=t.ha,n=(s=this.a).o*r.o+s.f*r.i+s.h*r.l,a=s.o*r.f+s.f*r.m+s.h*r.g,o=s.o*r.h+s.f*r.j+s.h*r.s,h=s.i*r.o+s.m*r.i+s.j*r.l,c=s.i*r.f+s.m*r.m+s.j*r.g,l=s.i*r.h+s.m*r.j+s.j*r.s,u=s.l*r.o+s.g*r.i+s.s*r.l,p=s.l*r.f+s.g*r.m+s.s*r.g,d=s.l*r.h+s.g*r.j+s.s*r.s,i.o=n,i.f=a,i.h=o,i.i=h,i.m=c,i.j=l,i.l=u,i.g=p,i.s=d,n=s.o*r.v+s.f*r.A+s.h*r.B,a=s.i*r.v+s.m*r.A+s.j*r.B,r=s.l*r.v+s.g*r.A+s.s*r.B,i.v=n,i.A=a,i.B=r,i.v+=s.v,i.A+=s.A,i.B+=s.B,t.Kb.Nb(t.u,t.pa),i=t.u.ma,s=t.u.na,r=t.u.oa,n=t.u.ja,a=t.u.ka,o=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=i<t.u.ma?i:t.u.ma,t.u.na=s<t.u.na?s:t.u.na,t.u.oa=r<t.u.oa?r:t.u.oa,t.u.ja=n>t.u.ja?n:t.u.ja,t.u.ka=a>t.u.ka?a:t.u.ka,t.u.la=o>t.u.la?o:t.u.la,null!=t.tb&&(i=t.a.v-t.pa.v,s=t.a.A-t.pa.A,r=t.a.B-t.pa.B,(n=t.rc).x=i,n.y=s,n.z=r,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=e}this.Gb=!1,this.yb=0},fo:function(t){var e,i,s;e=t.x,i=t.y,s=t.z,t=Math.sin(e);var r,n,a,o=Math.sin(i),h=Math.sin(s);for(e=Math.cos(e),i=Math.cos(i),s=Math.cos(s),this.a.o=i*s,this.a.f=-i*h,this.a.h=o,this.a.i=e*h+s*t*o,this.a.m=e*s-t*o*h,this.a.j=-i*t,this.a.l=t*h-e*s*o,this.a.g=s*t+e*o*h,this.a.s=e*i,t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,o=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,h=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,i=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,s=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,e=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,r=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,n=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,a=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=o,this.S=h,this.T=i,this.U=s,this.V=e,this.W=r,this.X=n,this.Y=a,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,o=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,h=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,i=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,s=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,e=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,r=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,n=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,a=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=o,this.S=h,this.T=i,this.U=s,this.V=e,this.W=r,this.X=n,this.Y=a,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,t=this.pa,o=this.a,t.v=o.v,t.A=o.A,t.B=o.B,t.o=o.o,t.f=o.f,t.h=o.h,t.i=o.i,t.m=o.m,t.j=o.j,t.l=o.l,t.g=o.g,t.s=o.s,t=this.Dc;null!=t;){var c,l,u,p,d;o=t.M,h=t.pa,s=t.ha,e=(i=this.pa).o*s.o+i.f*s.i+i.h*s.l,r=i.o*s.f+i.f*s.m+i.h*s.g,n=i.o*s.h+i.f*s.j+i.h*s.s,a=i.i*s.o+i.m*s.i+i.j*s.l,c=i.i*s.f+i.m*s.m+i.j*s.g,l=i.i*s.h+i.m*s.j+i.j*s.s,u=i.l*s.o+i.g*s.i+i.s*s.l,p=i.l*s.f+i.g*s.m+i.s*s.g,d=i.l*s.h+i.g*s.j+i.s*s.s,h.o=e,h.f=r,h.h=n,h.i=a,h.m=c,h.j=l,h.l=u,h.g=p,h.s=d,e=i.o*s.v+i.f*s.A+i.h*s.B,r=i.i*s.v+i.m*s.A+i.j*s.B,s=i.l*s.v+i.g*s.A+i.s*s.B,h.v=e,h.A=r,h.B=s,h.v+=i.v,h.A+=i.A,h.B+=i.B,h=t.a,s=t.ha,e=(i=this.a).o*s.o+i.f*s.i+i.h*s.l,r=i.o*s.f+i.f*s.m+i.h*s.g,n=i.o*s.h+i.f*s.j+i.h*s.s,a=i.i*s.o+i.m*s.i+i.j*s.l,c=i.i*s.f+i.m*s.m+i.j*s.g,l=i.i*s.h+i.m*s.j+i.j*s.s,u=i.l*s.o+i.g*s.i+i.s*s.l,p=i.l*s.f+i.g*s.m+i.s*s.g,d=i.l*s.h+i.g*s.j+i.s*s.s,h.o=e,h.f=r,h.h=n,h.i=a,h.m=c,h.j=l,h.l=u,h.g=p,h.s=d,e=i.o*s.v+i.f*s.A+i.h*s.B,r=i.i*s.v+i.m*s.A+i.j*s.B,s=i.l*s.v+i.g*s.A+i.s*s.B,h.v=e,h.A=r,h.B=s,h.v+=i.v,h.A+=i.A,h.B+=i.B,t.Kb.Nb(t.u,t.pa),h=t.u.ma,i=t.u.na,s=t.u.oa,e=t.u.ja,r=t.u.ka,n=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=h<t.u.ma?h:t.u.ma,t.u.na=i<t.u.na?i:t.u.na,t.u.oa=s<t.u.oa?s:t.u.oa,t.u.ja=e>t.u.ja?e:t.u.ja,t.u.ka=r>t.u.ka?r:t.u.ka,t.u.la=n>t.u.la?n:t.u.la,null!=t.tb&&(h=t.a.v-t.pa.v,i=t.a.A-t.pa.A,s=t.a.B-t.pa.B,(e=t.rc).x=h,e.y=i,e.z=s,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=o}this.Gb=!1,this.yb=0},Em:function(t){var e,i,s,r,n,a,o,h,c,l;for(e=t.e00,i=t.e01,s=t.e02,r=t.e10,n=t.e11,a=t.e12,o=t.e20,h=t.e21,c=t.e22,t=e*this.a.o+i*this.a.i+s*this.a.l,l=e*this.a.f+i*this.a.m+s*this.a.g,e=e*this.a.h+i*this.a.j+s*this.a.s,i=r*this.a.o+n*this.a.i+a*this.a.l,s=r*this.a.f+n*this.a.m+a*this.a.g,r=r*this.a.h+n*this.a.j+a*this.a.s,n=o*this.a.o+h*this.a.i+c*this.a.l,a=o*this.a.f+h*this.a.m+c*this.a.g,o=o*this.a.h+h*this.a.j+c*this.a.s,this.a.o=t,this.a.f=l,this.a.h=e,this.a.i=i,this.a.m=s,this.a.j=r,this.a.l=n,this.a.g=a,this.a.s=o,o=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,h=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,t=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,l=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,c=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,r=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,n=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,a=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,e=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=o,this.R=h,this.S=t,this.T=l,this.U=c,this.V=r,this.W=n,this.X=a,this.Y=e,o=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,h=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,t=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,l=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,c=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,r=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,n=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,a=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,e=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=o,this.R=h,this.S=t,this.T=l,this.U=c,this.V=r,this.W=n,this.X=a,this.Y=e,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,o=this.pa,h=this.a,o.v=h.v,o.A=h.A,o.B=h.B,o.o=h.o,o.f=h.f,o.h=h.h,o.i=h.i,o.m=h.m,o.j=h.j,o.l=h.l,o.g=h.g,o.s=h.s,o=this.Dc;null!=o;){var u,p,d;h=o.M,t=o.pa,c=o.ha,r=(l=this.pa).o*c.o+l.f*c.i+l.h*c.l,n=l.o*c.f+l.f*c.m+l.h*c.g,a=l.o*c.h+l.f*c.j+l.h*c.s,e=l.i*c.o+l.m*c.i+l.j*c.l,i=l.i*c.f+l.m*c.m+l.j*c.g,s=l.i*c.h+l.m*c.j+l.j*c.s,u=l.l*c.o+l.g*c.i+l.s*c.l,p=l.l*c.f+l.g*c.m+l.s*c.g,d=l.l*c.h+l.g*c.j+l.s*c.s,t.o=r,t.f=n,t.h=a,t.i=e,t.m=i,t.j=s,t.l=u,t.g=p,t.s=d,r=l.o*c.v+l.f*c.A+l.h*c.B,n=l.i*c.v+l.m*c.A+l.j*c.B,c=l.l*c.v+l.g*c.A+l.s*c.B,t.v=r,t.A=n,t.B=c,t.v+=l.v,t.A+=l.A,t.B+=l.B,t=o.a,c=o.ha,r=(l=this.a).o*c.o+l.f*c.i+l.h*c.l,n=l.o*c.f+l.f*c.m+l.h*c.g,a=l.o*c.h+l.f*c.j+l.h*c.s,e=l.i*c.o+l.m*c.i+l.j*c.l,i=l.i*c.f+l.m*c.m+l.j*c.g,s=l.i*c.h+l.m*c.j+l.j*c.s,u=l.l*c.o+l.g*c.i+l.s*c.l,p=l.l*c.f+l.g*c.m+l.s*c.g,d=l.l*c.h+l.g*c.j+l.s*c.s,t.o=r,t.f=n,t.h=a,t.i=e,t.m=i,t.j=s,t.l=u,t.g=p,t.s=d,r=l.o*c.v+l.f*c.A+l.h*c.B,n=l.i*c.v+l.m*c.A+l.j*c.B,c=l.l*c.v+l.g*c.A+l.s*c.B,t.v=r,t.A=n,t.B=c,t.v+=l.v,t.A+=l.A,t.B+=l.B,o.Kb.Nb(o.u,o.pa),t=o.u.ma,l=o.u.na,c=o.u.oa,r=o.u.ja,n=o.u.ka,a=o.u.la,o.Kb.Nb(o.u,o.a),o.u.ma=t<o.u.ma?t:o.u.ma,o.u.na=l<o.u.na?l:o.u.na,o.u.oa=c<o.u.oa?c:o.u.oa,o.u.ja=r>o.u.ja?r:o.u.ja,o.u.ka=n>o.u.ka?n:o.u.ka,o.u.la=a>o.u.la?a:o.u.la,null!=o.tb&&(t=o.a.v-o.pa.v,l=o.a.A-o.pa.A,c=o.a.B-o.pa.B,(r=o.rc).x=t,r.y=l,r.z=c,o.Yb.oc.jc.wd(o.tb,o.u,o.rc)),o=h}this.Gb=!1,this.yb=0},Sn:function(t){var e,i,s,r,n,a,o;e=t.x,i=t.y,t=t.z,a=Math.sin(e);var h=Math.sin(i),c=Math.sin(t),l=Math.cos(e);o=Math.cos(i);var u=Math.cos(t);for(s=o*u,r=-o*c,t=l*c+u*a*h,e=l*u-a*h*c,n=-o*a,i=a*c-l*u*h,a=u*a+l*h*c,o*=l,c=s*this.a.o+r*this.a.i+h*this.a.l,l=s*this.a.f+r*this.a.m+h*this.a.g,h=s*this.a.h+r*this.a.j+h*this.a.s,s=t*this.a.o+e*this.a.i+n*this.a.l,r=t*this.a.f+e*this.a.m+n*this.a.g,t=t*this.a.h+e*this.a.j+n*this.a.s,e=i*this.a.o+a*this.a.i+o*this.a.l,n=i*this.a.f+a*this.a.m+o*this.a.g,i=i*this.a.h+a*this.a.j+o*this.a.s,this.a.o=c,this.a.f=l,this.a.h=h,this.a.i=s,this.a.m=r,this.a.j=t,this.a.l=e,this.a.g=n,this.a.s=i,i=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,t=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,e=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,n=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,a=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,h=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,c=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,l=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,o=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=i,this.R=t,this.S=e,this.T=n,this.U=a,this.V=h,this.W=c,this.X=l,this.Y=o,i=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,t=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,e=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,n=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,a=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,h=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,c=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,l=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,o=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=i,this.R=t,this.S=e,this.T=n,this.U=a,this.V=h,this.W=c,this.X=l,this.Y=o,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,i=this.pa,t=this.a,i.v=t.v,i.A=t.A,i.B=t.B,i.o=t.o,i.f=t.f,i.h=t.h,i.i=t.i,i.m=t.m,i.j=t.j,i.l=t.l,i.g=t.g,i.s=t.s,i=this.Dc;null!=i;){var p,d;t=i.M,e=i.pa,a=i.ha,h=(n=this.pa).o*a.o+n.f*a.i+n.h*a.l,c=n.o*a.f+n.f*a.m+n.h*a.g,l=n.o*a.h+n.f*a.j+n.h*a.s,o=n.i*a.o+n.m*a.i+n.j*a.l,s=n.i*a.f+n.m*a.m+n.j*a.g,r=n.i*a.h+n.m*a.j+n.j*a.s,u=n.l*a.o+n.g*a.i+n.s*a.l,p=n.l*a.f+n.g*a.m+n.s*a.g,d=n.l*a.h+n.g*a.j+n.s*a.s,e.o=h,e.f=c,e.h=l,e.i=o,e.m=s,e.j=r,e.l=u,e.g=p,e.s=d,h=n.o*a.v+n.f*a.A+n.h*a.B,c=n.i*a.v+n.m*a.A+n.j*a.B,a=n.l*a.v+n.g*a.A+n.s*a.B,e.v=h,e.A=c,e.B=a,e.v+=n.v,e.A+=n.A,e.B+=n.B,e=i.a,a=i.ha,h=(n=this.a).o*a.o+n.f*a.i+n.h*a.l,c=n.o*a.f+n.f*a.m+n.h*a.g,l=n.o*a.h+n.f*a.j+n.h*a.s,o=n.i*a.o+n.m*a.i+n.j*a.l,s=n.i*a.f+n.m*a.m+n.j*a.g,r=n.i*a.h+n.m*a.j+n.j*a.s,u=n.l*a.o+n.g*a.i+n.s*a.l,p=n.l*a.f+n.g*a.m+n.s*a.g,d=n.l*a.h+n.g*a.j+n.s*a.s,e.o=h,e.f=c,e.h=l,e.i=o,e.m=s,e.j=r,e.l=u,e.g=p,e.s=d,h=n.o*a.v+n.f*a.A+n.h*a.B,c=n.i*a.v+n.m*a.A+n.j*a.B,a=n.l*a.v+n.g*a.A+n.s*a.B,e.v=h,e.A=c,e.B=a,e.v+=n.v,e.A+=n.A,e.B+=n.B,i.Kb.Nb(i.u,i.pa),e=i.u.ma,n=i.u.na,a=i.u.oa,h=i.u.ja,c=i.u.ka,l=i.u.la,i.Kb.Nb(i.u,i.a),i.u.ma=e<i.u.ma?e:i.u.ma,i.u.na=n<i.u.na?n:i.u.na,i.u.oa=a<i.u.oa?a:i.u.oa,i.u.ja=h>i.u.ja?h:i.u.ja,i.u.ka=c>i.u.ka?c:i.u.ka,i.u.la=l>i.u.la?l:i.u.la,null!=i.tb&&(e=i.a.v-i.pa.v,n=i.a.A-i.pa.A,a=i.a.B-i.pa.B,(h=i.rc).x=e,h.y=n,h.z=a,i.Yb.oc.jc.wd(i.tb,i.u,i.rc)),i=t}this.Gb=!1,this.yb=0},jm:function(){var t,e,i,s,r,n=new ct;return 0<(s=(t=this.a.o)+(e=this.a.m)+(i=this.a.s))?(s=.5*(r=Math.sqrt(s+1)),r=.5/r,t=(this.a.g-this.a.j)*r,e=(this.a.h-this.a.l)*r,i=(this.a.i-this.a.f)*r):t>e?t>i?(t=.5*(r=Math.sqrt(t-e-i+1)),r=.5/r,e=(this.a.f+this.a.i)*r,i=(this.a.h+this.a.l)*r,s=(this.a.g-this.a.j)*r):(i=.5*(r=Math.sqrt(i-t-e+1)),r=.5/r,t=(this.a.h+this.a.l)*r,e=(this.a.j+this.a.g)*r,s=(this.a.i-this.a.f)*r):e>i?(e=.5*(r=Math.sqrt(e-i-t+1)),r=.5/r,t=(this.a.f+this.a.i)*r,i=(this.a.j+this.a.g)*r,s=(this.a.h-this.a.l)*r):(i=.5*(r=Math.sqrt(i-t-e+1)),r=.5/r,t=(this.a.h+this.a.l)*r,e=(this.a.j+this.a.g)*r,s=(this.a.i-this.a.f)*r),n.x=t,n.y=e,n.z=i,n.w=s,n},lm:function(t){var e,i,s,r,n;0<(r=(e=this.a.o)+(i=this.a.m)+(s=this.a.s))?(r=.5*(n=Math.sqrt(r+1)),n=.5/n,e=(this.a.g-this.a.j)*n,i=(this.a.h-this.a.l)*n,s=(this.a.i-this.a.f)*n):e>i?e>s?(e=.5*(n=Math.sqrt(e-i-s+1)),n=.5/n,i=(this.a.f+this.a.i)*n,s=(this.a.h+this.a.l)*n,r=(this.a.g-this.a.j)*n):(s=.5*(n=Math.sqrt(s-e-i+1)),n=.5/n,e=(this.a.h+this.a.l)*n,i=(this.a.j+this.a.g)*n,r=(this.a.i-this.a.f)*n):i>s?(i=.5*(n=Math.sqrt(i-s-e+1)),n=.5/n,e=(this.a.f+this.a.i)*n,s=(this.a.j+this.a.g)*n,r=(this.a.h-this.a.l)*n):(s=.5*(n=Math.sqrt(s-e-i+1)),n=.5/n,e=(this.a.h+this.a.l)*n,i=(this.a.j+this.a.g)*n,r=(this.a.i-this.a.f)*n),t.x=e,t.y=i,t.z=s,t.w=r},Tn:function(t){var e,i,s;e=t.x,i=t.y,s=t.z;var r=t.w,n=2*e;t=e*n;var a=i*(d=2*i);s*=h=2*s;var o=e*d;for(i*=h,e*=h,n*=r,d*=r,r*=h,this.a.o=1-a-s,this.a.f=o-r,this.a.h=e+d,this.a.i=o+r,this.a.m=1-t-s,this.a.j=i-n,this.a.l=e-d,this.a.g=i+n,this.a.s=1-t-a,t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,a=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,r=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,h=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,s=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,o=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,d=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,i=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,e=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=a,this.S=r,this.T=h,this.U=s,this.V=o,this.W=d,this.X=i,this.Y=e,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,a=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,r=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,h=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,s=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,o=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,d=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,i=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,e=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=a,this.S=r,this.T=h,this.U=s,this.V=o,this.W=d,this.X=i,this.Y=e,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,t=this.pa,a=this.a,t.v=a.v,t.A=a.A,t.B=a.B,t.o=a.o,t.f=a.f,t.h=a.h,t.i=a.i,t.m=a.m,t.j=a.j,t.l=a.l,t.g=a.g,t.s=a.s,t=this.Dc;null!=t;){a=t.M,r=t.pa,s=t.ha,o=(h=this.pa).o*s.o+h.f*s.i+h.h*s.l;var h,c,l,u,p,d=h.o*s.f+h.f*s.m+h.h*s.g;i=h.o*s.h+h.f*s.j+h.h*s.s,e=h.i*s.o+h.m*s.i+h.j*s.l,n=h.i*s.f+h.m*s.m+h.j*s.g,c=h.i*s.h+h.m*s.j+h.j*s.s,l=h.l*s.o+h.g*s.i+h.s*s.l,u=h.l*s.f+h.g*s.m+h.s*s.g,p=h.l*s.h+h.g*s.j+h.s*s.s,r.o=o,r.f=d,r.h=i,r.i=e,r.m=n,r.j=c,r.l=l,r.g=u,r.s=p,o=h.o*s.v+h.f*s.A+h.h*s.B,d=h.i*s.v+h.m*s.A+h.j*s.B,s=h.l*s.v+h.g*s.A+h.s*s.B,r.v=o,r.A=d,r.B=s,r.v+=h.v,r.A+=h.A,r.B+=h.B,r=t.a,s=t.ha,o=(h=this.a).o*s.o+h.f*s.i+h.h*s.l,d=h.o*s.f+h.f*s.m+h.h*s.g,i=h.o*s.h+h.f*s.j+h.h*s.s,e=h.i*s.o+h.m*s.i+h.j*s.l,n=h.i*s.f+h.m*s.m+h.j*s.g,c=h.i*s.h+h.m*s.j+h.j*s.s,l=h.l*s.o+h.g*s.i+h.s*s.l,u=h.l*s.f+h.g*s.m+h.s*s.g,p=h.l*s.h+h.g*s.j+h.s*s.s,r.o=o,r.f=d,r.h=i,r.i=e,r.m=n,r.j=c,r.l=l,r.g=u,r.s=p,o=h.o*s.v+h.f*s.A+h.h*s.B,d=h.i*s.v+h.m*s.A+h.j*s.B,s=h.l*s.v+h.g*s.A+h.s*s.B,r.v=o,r.A=d,r.B=s,r.v+=h.v,r.A+=h.A,r.B+=h.B,t.Kb.Nb(t.u,t.pa),r=t.u.ma,h=t.u.na,s=t.u.oa,o=t.u.ja,d=t.u.ka,i=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=r<t.u.ma?r:t.u.ma,t.u.na=h<t.u.na?h:t.u.na,t.u.oa=s<t.u.oa?s:t.u.oa,t.u.ja=o>t.u.ja?o:t.u.ja,t.u.ka=d>t.u.ka?d:t.u.ka,t.u.la=i>t.u.la?i:t.u.la,null!=t.tb&&(r=t.a.v-t.pa.v,h=t.a.A-t.pa.A,s=t.a.B-t.pa.B,(o=t.rc).x=r,o.y=h,o.z=s,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=a}this.Gb=!1,this.yb=0},xm:function(){var t=this.a,e=new vt;return e.v=t.v,e.A=t.A,e.B=t.B,e.o=t.o,e.f=t.f,e.h=t.h,e.i=t.i,e.m=t.m,e.j=t.j,e.l=t.l,e.g=t.g,e.s=t.s,e},Cm:function(t){var e=this.a;t.v=e.v,t.A=e.A,t.B=e.B,t.o=e.o,t.f=e.f,t.h=e.h,t.i=e.i,t.m=e.m,t.j=e.j,t.l=e.l,t.g=e.g,t.s=e.s},ho:function(t){var e,i,s,r,n,a,o,h;for(this.a.v=t.v,this.a.A=t.A,this.a.B=t.B,this.a.o=t.o,this.a.f=t.f,this.a.h=t.h,this.a.i=t.i,this.a.m=t.m,this.a.j=t.j,this.a.l=t.l,this.a.g=t.g,this.a.s=t.s,t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,e=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,i=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,s=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,r=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,n=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,a=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,o=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,h=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,e=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,i=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,s=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,r=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,n=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,a=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,o=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,h=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,t=this.pa,e=this.a,t.v=e.v,t.A=e.A,t.B=e.B,t.o=e.o,t.f=e.f,t.h=e.h,t.i=e.i,t.m=e.m,t.j=e.j,t.l=e.l,t.g=e.g,t.s=e.s,t=this.Dc;null!=t;){var c,l,u,p,d;e=t.M,i=t.pa,r=t.ha,n=(s=this.pa).o*r.o+s.f*r.i+s.h*r.l,a=s.o*r.f+s.f*r.m+s.h*r.g,o=s.o*r.h+s.f*r.j+s.h*r.s,h=s.i*r.o+s.m*r.i+s.j*r.l,c=s.i*r.f+s.m*r.m+s.j*r.g,l=s.i*r.h+s.m*r.j+s.j*r.s,u=s.l*r.o+s.g*r.i+s.s*r.l,p=s.l*r.f+s.g*r.m+s.s*r.g,d=s.l*r.h+s.g*r.j+s.s*r.s,i.o=n,i.f=a,i.h=o,i.i=h,i.m=c,i.j=l,i.l=u,i.g=p,i.s=d,n=s.o*r.v+s.f*r.A+s.h*r.B,a=s.i*r.v+s.m*r.A+s.j*r.B,r=s.l*r.v+s.g*r.A+s.s*r.B,i.v=n,i.A=a,i.B=r,i.v+=s.v,i.A+=s.A,i.B+=s.B,i=t.a,r=t.ha,n=(s=this.a).o*r.o+s.f*r.i+s.h*r.l,a=s.o*r.f+s.f*r.m+s.h*r.g,o=s.o*r.h+s.f*r.j+s.h*r.s,h=s.i*r.o+s.m*r.i+s.j*r.l,c=s.i*r.f+s.m*r.m+s.j*r.g,l=s.i*r.h+s.m*r.j+s.j*r.s,u=s.l*r.o+s.g*r.i+s.s*r.l,p=s.l*r.f+s.g*r.m+s.s*r.g,d=s.l*r.h+s.g*r.j+s.s*r.s,i.o=n,i.f=a,i.h=o,i.i=h,i.m=c,i.j=l,i.l=u,i.g=p,i.s=d,n=s.o*r.v+s.f*r.A+s.h*r.B,a=s.i*r.v+s.m*r.A+s.j*r.B,r=s.l*r.v+s.g*r.A+s.s*r.B,i.v=n,i.A=a,i.B=r,i.v+=s.v,i.A+=s.A,i.B+=s.B,t.Kb.Nb(t.u,t.pa),i=t.u.ma,s=t.u.na,r=t.u.oa,n=t.u.ja,a=t.u.ka,o=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=i<t.u.ma?i:t.u.ma,t.u.na=s<t.u.na?s:t.u.na,t.u.oa=r<t.u.oa?r:t.u.oa,t.u.ja=n>t.u.ja?n:t.u.ja,t.u.ka=a>t.u.ka?a:t.u.ka,t.u.la=o>t.u.la?o:t.u.la,null!=t.tb&&(i=t.a.v-t.pa.v,s=t.a.A-t.pa.A,r=t.a.B-t.pa.B,(n=t.rc).x=i,n.y=s,n.z=r,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=e}this.Gb=!1,this.yb=0},Tg:function(){return this.Pc},se:function(){var t=new dt;return t.e00=this.Ad,t.e01=this.Bd,t.e02=this.Cd,t.e10=this.Dd,t.e11=this.Ed,t.e12=this.Fd,t.e20=this.Gd,t.e21=this.Hd,t.e22=this.Id,t},te:function(t){t.e00=this.Ad,t.e01=this.Bd,t.e02=this.Cd,t.e10=this.Dd,t.e11=this.Ed,t.e12=this.Fd,t.e20=this.Gd,t.e21=this.Hd,t.e22=this.Id},Ug:function(){var t=new r;t.mass=this.Pc;var e=t.localInertia;return e.e00=this.Ad,e.e01=this.Bd,e.e02=this.Cd,e.e10=this.Dd,e.e11=this.Ed,e.e12=this.Fd,e.e20=this.Gd,e.e21=this.Hd,e.e22=this.Id,t},Vg:function(t){t.mass=this.Pc,(t=t.localInertia).e00=this.Ad,t.e01=this.Bd,t.e02=this.Cd,t.e10=this.Dd,t.e11=this.Ed,t.e12=this.Fd,t.e20=this.Gd,t.e21=this.Hd,t.e22=this.Id},Qm:function(t){if(this.Pc=t.mass,t=t.localInertia,this.Ad=t.e00,this.Bd=t.e01,this.Cd=t.e02,this.Dd=t.e10,this.Ed=t.e11,this.Fd=t.e12,this.Gd=t.e20,this.Hd=t.e21,this.Id=t.e22,t=this.Ad*(this.Ed*this.Id-this.Fd*this.Hd)-this.Bd*(this.Dd*this.Id-this.Fd*this.Gd)+this.Cd*(this.Dd*this.Hd-this.Ed*this.Gd),0==this.Lb){this.$a=1/this.Pc,t=this.Ed*this.Id-this.Fd*this.Hd;var e=this.Dd*this.Id-this.Fd*this.Gd,i=this.Dd*this.Hd-this.Ed*this.Gd,s=this.Bd*this.Id-this.Cd*this.Hd,r=this.Ad*this.Id-this.Cd*this.Gd,n=this.Ad*this.Hd-this.Bd*this.Gd,a=this.Bd*this.Fd-this.Cd*this.Ed,o=this.Ad*this.Fd-this.Cd*this.Dd,h=this.Ad*this.Ed-this.Bd*this.Dd,c=this.Ad*t-this.Bd*e+this.Cd*i;(-1e-32>c||1e-32<c)&&(c=1/c),this.Ra=t*c,this.Sa=-s*c,this.Ta=a*c,this.Ua=-e*c,this.Va=r*c,this.Wa=-o*c,this.Xa=i*c,this.Ya=-n*c,this.Za=h*c,this.pi=this.Ra,this.ri=this.Sa,this.si=this.Ta,this.ti=this.Ua,this.ui=this.Va,this.vi=this.Wa,this.wi=this.Xa,this.xi=this.Ya,this.yi=this.Za,this.Ra=this.pi*this.N.x,this.Sa=this.ri*this.N.x,this.Ta=this.si*this.N.x,this.Ua=this.ti*this.N.y,this.Va=this.ui*this.N.y,this.Wa=this.vi*this.N.y,this.Xa=this.wi*this.N.z,this.Ya=this.xi*this.N.z,this.Za=this.yi*this.N.z}else this.yi=this.xi=this.wi=this.vi=this.ui=this.ti=this.si=this.ri=this.pi=this.Za=this.Ya=this.Xa=this.Wa=this.Va=this.Ua=this.Ta=this.Sa=this.Ra=this.$a=0;t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,e=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,i=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,s=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,r=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,n=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,a=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,o=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,h=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,e=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,i=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,s=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,r=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,n=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,a=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,o=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,h=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=e,this.S=i,this.T=s,this.U=r,this.V=n,this.W=a,this.X=o,this.Y=h,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,this.Gb=!1,this.yb=0},ji:function(){var t=this.N;return new bt(t.x,t.y,t.z)},Rm:function(t){var e,i,s,r,n,a,o,h=this.N;h.x=t.x,h.y=t.y,h.z=t.z,t=this.a.o*this.Ra+this.a.f*this.Ua+this.a.h*this.Xa,h=this.a.o*this.Sa+this.a.f*this.Va+this.a.h*this.Ya,e=this.a.o*this.Ta+this.a.f*this.Wa+this.a.h*this.Za,i=this.a.i*this.Ra+this.a.m*this.Ua+this.a.j*this.Xa,s=this.a.i*this.Sa+this.a.m*this.Va+this.a.j*this.Ya,r=this.a.i*this.Ta+this.a.m*this.Wa+this.a.j*this.Za,n=this.a.l*this.Ra+this.a.g*this.Ua+this.a.s*this.Xa,a=this.a.l*this.Sa+this.a.g*this.Va+this.a.s*this.Ya,o=this.a.l*this.Ta+this.a.g*this.Wa+this.a.s*this.Za,this.P=t,this.R=h,this.S=e,this.T=i,this.U=s,this.V=r,this.W=n,this.X=a,this.Y=o,t=this.P*this.a.o+this.R*this.a.f+this.S*this.a.h,h=this.P*this.a.i+this.R*this.a.m+this.S*this.a.j,e=this.P*this.a.l+this.R*this.a.g+this.S*this.a.s,i=this.T*this.a.o+this.U*this.a.f+this.V*this.a.h,s=this.T*this.a.i+this.U*this.a.m+this.V*this.a.j,r=this.T*this.a.l+this.U*this.a.g+this.V*this.a.s,n=this.W*this.a.o+this.X*this.a.f+this.Y*this.a.h,a=this.W*this.a.i+this.X*this.a.m+this.Y*this.a.j,o=this.W*this.a.l+this.X*this.a.g+this.Y*this.a.s,this.P=t,this.R=h,this.S=e,this.T=i,this.U=s,this.V=r,this.W=n,this.X=a,this.Y=o,this.P*=this.N.x,this.R*=this.N.x,this.S*=this.N.x,this.T*=this.N.y,this.U*=this.N.y,this.V*=this.N.y,this.W*=this.N.z,this.X*=this.N.z,this.Y*=this.N.z,this.Gb=!1,this.yb=0},qe:function(){var t=new bt;return t.x=this.gb,t.y=this.hb,t.z=this.ib,t},re:function(t){t.x=this.gb,t.y=this.hb,t.z=this.ib},Pm:function(t){1==this.Lb?this.ib=this.hb=this.gb=0:(this.gb=t.x,this.hb=t.y,this.ib=t.z),this.Gb=!1,this.yb=0},Jc:function(){var t=new bt;return t.x=this.kb,t.y=this.lb,t.z=this.mb,t},Kc:function(t){t.x=this.gb,t.y=this.hb,t.z=this.ib},mo:function(t){1==this.Lb?this.mb=this.lb=this.kb=0:(this.kb=t.x,this.lb=t.y,this.mb=t.z),this.Gb=!1,this.yb=0},cb:function(t){var e,i;1!=this.Lb&&(e=t.x,i=t.y,t=t.z,this.gb+=e,this.hb+=i,this.ib+=t),this.Gb=!1,this.yb=0},ua:function(t){var e,i;1!=this.Lb&&(e=t.x,i=t.y,t=t.z,this.kb+=e,this.lb+=i,this.mb+=t),this.Gb=!1,this.yb=0},uc:function(t,e){var i,s,r,n,a;i=t.x,s=t.y,t=t.z,this.gb+=i*this.$a,this.hb+=s*this.$a,this.ib+=t*this.$a,r=e.x,n=e.y,a=e.z,r-=this.a.v,e=(n-=this.a.A)*t-(a-=this.a.B)*s,t=a*i-r*t,r=r*s-n*i,i=this.P*e+this.R*t+this.S*r,s=this.T*e+this.U*t+this.V*r,e=this.W*e+this.X*t+this.Y*r,this.kb+=i,this.lb+=s,this.mb+=e,this.Gb=!1,this.yb=0},vc:function(t){var e,i;e=t.x,i=t.y,t=t.z,this.gb+=e*this.$a,this.hb+=i*this.$a,this.ib+=t*this.$a,this.Gb=!1,this.yb=0},Mb:function(t){var e,i,s,r;e=t.x,i=t.y,s=t.z,t=this.P*e+this.R*i+this.S*s,r=this.T*e+this.U*i+this.V*s,e=this.W*e+this.X*i+this.Y*s,this.kb+=t,this.lb+=r,this.mb+=e,this.Gb=!1,this.yb=0},pc:function(t,e){var i,s,r,n;i=t.x,s=t.y,t=t.z,this.Mh+=i,this.Nh+=s,this.Oh+=t,r=e.x,n=e.y,e=e.z,r-=this.a.v,n-=this.a.A,e-=this.a.B,this.vf+=n*t-e*s,this.wf+=e*i-r*t,this.xf+=r*s-n*i,this.Gb=!1,this.yb=0},qc:function(t){var e,i;e=t.x,i=t.y,t=t.z,this.Mh+=e,this.Nh+=i,this.Oh+=t,this.Gb=!1,this.yb=0},Ac:function(t){var e,i;e=t.x,i=t.y,t=t.z,this.vf+=e,this.wf+=i,this.xf+=t,this.Gb=!1,this.yb=0},fd:function(){return this.eh},Nm:function(t){this.eh=t,this.Gb=!1,this.yb=0},ue:function(t){var e,i,s,r;return e=t.x,i=t.y,t=t.z,e-=this.a.v,i-=this.a.A,t-=this.a.B,s=this.a.o*e+this.a.i*i+this.a.l*t,r=this.a.f*e+this.a.m*i+this.a.g*t,t=this.a.h*e+this.a.j*i+this.a.s*t,e=s,i=r,(s=new bt).x=e,s.y=i,s.z=t,s},Ue:function(t,e){var i,s,r,n;i=t.x,s=t.y,r=t.z,i-=this.a.v,s-=this.a.A,r-=this.a.B,t=this.a.o*i+this.a.i*s+this.a.l*r,n=this.a.f*i+this.a.m*s+this.a.g*r,i=this.a.h*i+this.a.j*s+this.a.s*r,e.x=t,e.y=n,e.z=i},Ve:function(t){var e,i,s,r;return e=t.x,i=t.y,t=t.z,s=this.a.o*e+this.a.i*i+this.a.l*t,r=this.a.f*e+this.a.m*i+this.a.g*t,t=this.a.h*e+this.a.j*i+this.a.s*t,e=s,i=r,(s=new bt).x=e,s.y=i,s.z=t,s},Mf:function(t,e){var i,s,r,n;i=t.x,s=t.y,r=t.z,t=this.a.o*i+this.a.i*s+this.a.l*r,n=this.a.f*i+this.a.m*s+this.a.g*r,i=this.a.h*i+this.a.j*s+this.a.s*r,e.x=t,e.y=n,e.z=i},Pj:function(t){var e,i,s,r;return e=t.x,i=t.y,t=t.z,s=this.a.o*e+this.a.f*i+this.a.h*t,r=this.a.i*e+this.a.m*i+this.a.j*t,t=this.a.l*e+this.a.g*i+this.a.s*t,e=s+this.a.v,i=r+this.a.A,t+=this.a.B,(s=new bt).x=e,s.y=i,s.z=t,s},Nl:function(t,e){var i,s,r,n;i=t.x,s=t.y,r=t.z,t=this.a.o*i+this.a.f*s+this.a.h*r,n=this.a.i*i+this.a.m*s+this.a.j*r,r=this.a.l*i+this.a.g*s+this.a.s*r,i=t+this.a.v,s=n+this.a.A,r+=this.a.B,e.x=i,e.y=s,e.z=r},am:function(t){var e,i,s,r;return e=t.x,i=t.y,t=t.z,s=this.a.o*e+this.a.f*i+this.a.h*t,r=this.a.i*e+this.a.m*i+this.a.j*t,t=this.a.l*e+this.a.g*i+this.a.s*t,e=s,i=r,(s=new bt).x=e,s.y=i,s.z=t,s},bm:function(t,e){var i,s,r,n;i=t.x,s=t.y,r=t.z,t=this.a.o*i+this.a.f*s+this.a.h*r,n=this.a.i*i+this.a.m*s+this.a.j*r,i=this.a.l*i+this.a.g*s+this.a.s*r,e.x=t,e.y=n,e.z=i},im:function(){return this.zg},ki:function(){return this.Dc},Wg:function(){return this.Ae},Lc:function(){return this.Ob},Xg:function(){return this.kh},Yd:function(){return this.ze},Hb:function(t){if(null==this.Dc?this.Dc=t:(this.Fi.M=t,t.ia=this.Fi),this.Fi=t,this.zg++,t.Yb=this,null!=this.oc){var e=this.oc;t.tb=e.jc.Vh(t,t.u),t.Cc=e.Xl++,e.zg++}for(this.Oj(),t=this.Dc;null!=t;){e=t.M;var i,s,r,n,a,o,h,c,l,u=t.pa,p=t.ha,d=this.pa;i=d.o*p.o+d.f*p.i+d.h*p.l,s=d.o*p.f+d.f*p.m+d.h*p.g,r=d.o*p.h+d.f*p.j+d.h*p.s,n=d.i*p.o+d.m*p.i+d.j*p.l,a=d.i*p.f+d.m*p.m+d.j*p.g,o=d.i*p.h+d.m*p.j+d.j*p.s,h=d.l*p.o+d.g*p.i+d.s*p.l,c=d.l*p.f+d.g*p.m+d.s*p.g,l=d.l*p.h+d.g*p.j+d.s*p.s,u.o=i,u.f=s,u.h=r,u.i=n,u.m=a,u.j=o,u.l=h,u.g=c,u.s=l,i=d.o*p.v+d.f*p.A+d.h*p.B,s=d.i*p.v+d.m*p.A+d.j*p.B,p=d.l*p.v+d.g*p.A+d.s*p.B,u.v=i,u.A=s,u.B=p,u.v+=d.v,u.A+=d.A,u.B+=d.B,u=t.a,p=t.ha,i=(d=this.a).o*p.o+d.f*p.i+d.h*p.l,s=d.o*p.f+d.f*p.m+d.h*p.g,r=d.o*p.h+d.f*p.j+d.h*p.s,n=d.i*p.o+d.m*p.i+d.j*p.l,a=d.i*p.f+d.m*p.m+d.j*p.g,o=d.i*p.h+d.m*p.j+d.j*p.s,h=d.l*p.o+d.g*p.i+d.s*p.l,c=d.l*p.f+d.g*p.m+d.s*p.g,l=d.l*p.h+d.g*p.j+d.s*p.s,u.o=i,u.f=s,u.h=r,u.i=n,u.m=a,u.j=o,u.l=h,u.g=c,u.s=l,i=d.o*p.v+d.f*p.A+d.h*p.B,s=d.i*p.v+d.m*p.A+d.j*p.B,p=d.l*p.v+d.g*p.A+d.s*p.B,u.v=i,u.A=s,u.B=p,u.v+=d.v,u.A+=d.A,u.B+=d.B,t.Kb.Nb(t.u,t.pa),u=t.u.ma,d=t.u.na,p=t.u.oa,i=t.u.ja,s=t.u.ka,r=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=u<t.u.ma?u:t.u.ma,t.u.na=d<t.u.na?d:t.u.na,t.u.oa=p<t.u.oa?p:t.u.oa,t.u.ja=i>t.u.ja?i:t.u.ja,t.u.ka=s>t.u.ka?s:t.u.ka,t.u.la=r>t.u.la?r:t.u.la,null!=t.tb&&(u=t.a.v-t.pa.v,d=t.a.A-t.pa.A,p=t.a.B-t.pa.B,(i=t.rc).x=u,i.y=d,i.z=p,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=e}},ko:function(t){var e=t.ia,i=t.M;if(null!=e&&(e.M=i),null!=i&&(i.ia=e),t==this.Dc&&(this.Dc=this.Dc.M),t==this.Fi&&(this.Fi=this.Fi.ia),t.M=null,t.ia=null,this.zg--,null!=this.oc){(e=this.oc).jc.Wh(t.tb),t.tb=null,t.Cc=-1;for(var s=t.Yb.Ob;null!=s;){if(i=s.M,(a=s.Zd).Zb==t||a.$b==t){(s=s.Qc).Gb=!1,s.yb=0,s=e.Kh;var r=a.ia,n=a.M;null!=r&&(r.M=n),null!=n&&(n.ia=r),a==s.zd&&(s.zd=s.zd.M),a==s.ye&&(s.ye=s.ye.ia),a.M=null,a.ia=null,a.Td&&((r=a.Zb.yd)==(n=a.$b.yd)&&(n=null),null!=r&&r.endContact(a),null!=n&&n.endContact(a)),r=a.rb.ia,n=a.rb.M,null!=r&&(r.M=n),null!=n&&(n.ia=r),a.rb==a.C.Ob&&(a.C.Ob=a.C.Ob.M),a.rb==a.C.kc&&(a.C.kc=a.C.kc.ia),a.rb.M=null,a.rb.ia=null,r=a.sb.ia,n=a.sb.M,null!=r&&(r.M=n),null!=n&&(n.ia=r),a.sb==a.D.Ob&&(a.D.Ob=a.D.Ob.M),a.sb==a.D.kc&&(a.D.kc=a.D.kc.ia),a.sb.M=null,a.sb.ia=null,a.C.Ae--,a.D.Ae--,a.rb.Qc=null,a.sb.Qc=null,a.rb.Zd=null,a.sb.Zd=null,a.Zb=null,a.$b=null,a.C=null,a.D=null,a.Td=!1,a.$i.Xe(),a.Ja.Xe(),a.Lh=null,(r=a.Ye).Zb=null,r.$b=null,r.C=null,r.D=null,r.pj=null,r.qj=null,a.M=s.lg,s.lg=a,s.Bi--}s=i}e.zg--}for(t.Yb=null,this.Oj(),t=this.Dc;null!=t;){var a,o,h,c,l,u,p,d;e=t.M,i=t.pa,s=t.ha,r=(a=this.pa).o*s.o+a.f*s.i+a.h*s.l,n=a.o*s.f+a.f*s.m+a.h*s.g,o=a.o*s.h+a.f*s.j+a.h*s.s,h=a.i*s.o+a.m*s.i+a.j*s.l,c=a.i*s.f+a.m*s.m+a.j*s.g,l=a.i*s.h+a.m*s.j+a.j*s.s,u=a.l*s.o+a.g*s.i+a.s*s.l,p=a.l*s.f+a.g*s.m+a.s*s.g,d=a.l*s.h+a.g*s.j+a.s*s.s,i.o=r,i.f=n,i.h=o,i.i=h,i.m=c,i.j=l,i.l=u,i.g=p,i.s=d,r=a.o*s.v+a.f*s.A+a.h*s.B,n=a.i*s.v+a.m*s.A+a.j*s.B,s=a.l*s.v+a.g*s.A+a.s*s.B,i.v=r,i.A=n,i.B=s,i.v+=a.v,i.A+=a.A,i.B+=a.B,i=t.a,s=t.ha,r=(a=this.a).o*s.o+a.f*s.i+a.h*s.l,n=a.o*s.f+a.f*s.m+a.h*s.g,o=a.o*s.h+a.f*s.j+a.h*s.s,h=a.i*s.o+a.m*s.i+a.j*s.l,c=a.i*s.f+a.m*s.m+a.j*s.g,l=a.i*s.h+a.m*s.j+a.j*s.s,u=a.l*s.o+a.g*s.i+a.s*s.l,p=a.l*s.f+a.g*s.m+a.s*s.g,d=a.l*s.h+a.g*s.j+a.s*s.s,i.o=r,i.f=n,i.h=o,i.i=h,i.m=c,i.j=l,i.l=u,i.g=p,i.s=d,r=a.o*s.v+a.f*s.A+a.h*s.B,n=a.i*s.v+a.m*s.A+a.j*s.B,s=a.l*s.v+a.g*s.A+a.s*s.B,i.v=r,i.A=n,i.B=s,i.v+=a.v,i.A+=a.A,i.B+=a.B,t.Kb.Nb(t.u,t.pa),i=t.u.ma,a=t.u.na,s=t.u.oa,r=t.u.ja,n=t.u.ka,o=t.u.la,t.Kb.Nb(t.u,t.a),t.u.ma=i<t.u.ma?i:t.u.ma,t.u.na=a<t.u.na?a:t.u.na,t.u.oa=s<t.u.oa?s:t.u.oa,t.u.ja=r>t.u.ja?r:t.u.ja,t.u.ka=n>t.u.ka?n:t.u.ka,t.u.la=o>t.u.la?o:t.u.la,null!=t.tb&&(i=t.a.v-t.pa.v,a=t.a.A-t.pa.A,s=t.a.B-t.pa.B,(r=t.rc).x=i,r.y=a,r.z=s,t.Yb.oc.jc.wd(t.tb,t.u,t.rc)),t=e}},Dm:function(){return this.Lb},Sm:function(t){this.Lb=t,this.Oj()},Um:function(){this.Gb=!1,this.yb=0},Tm:function(){this.Gb=!0,this.yb=0},cm:function(){return this.Gb},li:function(){return this.yb},Mm:function(t){this.Bk=t,this.Gb=!1,this.yb=0},pe:function(){return this.$j},Om:function(t){this.$j=t},Ec:function(){return this.Qj},lo:function(t){this.Qj=t},um:function(){return this.ia},gm:function(){return this.M}},e.prototype={uc:function(){return this.Xj},ue:function(t){this.Xj=t},Jc:function(){return this.hk},Ve:function(t){this.hk=t},Ac:function(){var t=this.ha,e=new vt;return e.v=t.v,e.A=t.A,e.B=t.B,e.o=t.o,e.f=t.f,e.h=t.h,e.i=t.i,e.m=t.m,e.j=t.j,e.l=t.l,e.g=t.g,e.s=t.s,e},Ec:function(t){var e=this.ha;t.v=e.v,t.A=e.A,t.B=e.B,t.o=e.o,t.f=e.f,t.h=e.h,t.i=e.i,t.m=e.m,t.j=e.j,t.l=e.l,t.g=e.g,t.s=e.s},Yd:function(){var t=this.a,e=new vt;return e.v=t.v,e.A=t.A,e.B=t.B,e.o=t.o,e.f=t.f,e.h=t.h,e.i=t.i,e.m=t.m,e.j=t.j,e.l=t.l,e.g=t.g,e.s=t.s,e},pe:function(t){var e=this.a;t.v=e.v,t.A=e.A,t.B=e.B,t.o=e.o,t.f=e.f,t.h=e.h,t.i=e.i,t.m=e.m,t.j=e.j,t.l=e.l,t.g=e.g,t.s=e.s},Ue:function(t){var e=this.ha;if(e.v=t.v,e.A=t.A,e.B=t.B,e.o=t.o,e.f=t.f,e.h=t.h,e.i=t.i,e.m=t.m,e.j=t.j,e.l=t.l,e.g=t.g,e.s=t.s,null!=this.Yb)for((t=this.Yb).Oj(),e=t.Dc;null!=e;){var i,s,r,n,a,o,h,c,l,u=e.M,p=e.pa,d=e.ha,f=t.pa;i=f.o*d.o+f.f*d.i+f.h*d.l,s=f.o*d.f+f.f*d.m+f.h*d.g,r=f.o*d.h+f.f*d.j+f.h*d.s,n=f.i*d.o+f.m*d.i+f.j*d.l,a=f.i*d.f+f.m*d.m+f.j*d.g,o=f.i*d.h+f.m*d.j+f.j*d.s,h=f.l*d.o+f.g*d.i+f.s*d.l,c=f.l*d.f+f.g*d.m+f.s*d.g,l=f.l*d.h+f.g*d.j+f.s*d.s,p.o=i,p.f=s,p.h=r,p.i=n,p.m=a,p.j=o,p.l=h,p.g=c,p.s=l,i=f.o*d.v+f.f*d.A+f.h*d.B,s=f.i*d.v+f.m*d.A+f.j*d.B,d=f.l*d.v+f.g*d.A+f.s*d.B,p.v=i,p.A=s,p.B=d,p.v+=f.v,p.A+=f.A,p.B+=f.B,p=e.a,d=e.ha,i=(f=t.a).o*d.o+f.f*d.i+f.h*d.l,s=f.o*d.f+f.f*d.m+f.h*d.g,r=f.o*d.h+f.f*d.j+f.h*d.s,n=f.i*d.o+f.m*d.i+f.j*d.l,a=f.i*d.f+f.m*d.m+f.j*d.g,o=f.i*d.h+f.m*d.j+f.j*d.s,h=f.l*d.o+f.g*d.i+f.s*d.l,c=f.l*d.f+f.g*d.m+f.s*d.g,l=f.l*d.h+f.g*d.j+f.s*d.s,p.o=i,p.f=s,p.h=r,p.i=n,p.m=a,p.j=o,p.l=h,p.g=c,p.s=l,i=f.o*d.v+f.f*d.A+f.h*d.B,s=f.i*d.v+f.m*d.A+f.j*d.B,d=f.l*d.v+f.g*d.A+f.s*d.B,p.v=i,p.A=s,p.B=d,p.v+=f.v,p.A+=f.A,p.B+=f.B,e.Kb.Nb(e.u,e.pa),p=e.u.ma,f=e.u.na,d=e.u.oa,i=e.u.ja,s=e.u.ka,r=e.u.la,e.Kb.Nb(e.u,e.a),e.u.ma=p<e.u.ma?p:e.u.ma,e.u.na=f<e.u.na?f:e.u.na,e.u.oa=d<e.u.oa?d:e.u.oa,e.u.ja=i>e.u.ja?i:e.u.ja,e.u.ka=s>e.u.ka?s:e.u.ka,e.u.la=r>e.u.la?r:e.u.la,null!=e.tb&&(p=e.a.v-e.pa.v,f=e.a.A-e.pa.A,d=e.a.B-e.pa.B,(i=e.rc).x=p,i.y=f,i.z=d,e.Yb.oc.jc.wd(e.tb,e.u,e.rc)),e=u}},qc:function(){return this.Dk},te:function(t){if(this.Dk=t,null!=this.Yb){(t=this.Yb).Oj();for(var e=t.Dc;null!=e;){var i,s,r,n,a,o,h,c,l,u=e.M,p=e.pa,d=e.ha,f=t.pa;i=f.o*d.o+f.f*d.i+f.h*d.l,s=f.o*d.f+f.f*d.m+f.h*d.g,r=f.o*d.h+f.f*d.j+f.h*d.s,n=f.i*d.o+f.m*d.i+f.j*d.l,a=f.i*d.f+f.m*d.m+f.j*d.g,o=f.i*d.h+f.m*d.j+f.j*d.s,h=f.l*d.o+f.g*d.i+f.s*d.l,c=f.l*d.f+f.g*d.m+f.s*d.g,l=f.l*d.h+f.g*d.j+f.s*d.s,p.o=i,p.f=s,p.h=r,p.i=n,p.m=a,p.j=o,p.l=h,p.g=c,p.s=l,i=f.o*d.v+f.f*d.A+f.h*d.B,s=f.i*d.v+f.m*d.A+f.j*d.B,d=f.l*d.v+f.g*d.A+f.s*d.B,p.v=i,p.A=s,p.B=d,p.v+=f.v,p.A+=f.A,p.B+=f.B,p=e.a,d=e.ha,i=(f=t.a).o*d.o+f.f*d.i+f.h*d.l,s=f.o*d.f+f.f*d.m+f.h*d.g,r=f.o*d.h+f.f*d.j+f.h*d.s,n=f.i*d.o+f.m*d.i+f.j*d.l,a=f.i*d.f+f.m*d.m+f.j*d.g,o=f.i*d.h+f.m*d.j+f.j*d.s,h=f.l*d.o+f.g*d.i+f.s*d.l,c=f.l*d.f+f.g*d.m+f.s*d.g,l=f.l*d.h+f.g*d.j+f.s*d.s,p.o=i,p.f=s,p.h=r,p.i=n,p.m=a,p.j=o,p.l=h,p.g=c,p.s=l,i=f.o*d.v+f.f*d.A+f.h*d.B,s=f.i*d.v+f.m*d.A+f.j*d.B,d=f.l*d.v+f.g*d.A+f.s*d.B,p.v=i,p.A=s,p.B=d,p.v+=f.v,p.A+=f.A,p.B+=f.B,e.Kb.Nb(e.u,e.pa),p=e.u.ma,f=e.u.na,d=e.u.oa,i=e.u.ja,s=e.u.ka,r=e.u.la,e.Kb.Nb(e.u,e.a),e.u.ma=p<e.u.ma?p:e.u.ma,e.u.na=f<e.u.na?f:e.u.na,e.u.oa=d<e.u.oa?d:e.u.oa,e.u.ja=i>e.u.ja?i:e.u.ja,e.u.ka=s>e.u.ka?s:e.u.ka,e.u.la=r>e.u.la?r:e.u.la,null!=e.tb&&(p=e.a.v-e.pa.v,f=e.a.A-e.pa.A,d=e.a.B-e.pa.B,(i=e.rc).x=p,i.y=f,i.z=d,e.Yb.oc.jc.wd(e.tb,e.u,e.rc)),e=u}}},ua:function(){return this.u.clone()},cb:function(t){t.de(this.u)},vc:function(){return this.Kb},Kc:function(){return this.Yb},Hb:function(){return this.Tj},qe:function(t){this.Tj=t},Mb:function(){return this.Uj},re:function(t){this.Uj=t},pc:function(){return this.yd},se:function(t){this.yd=t},fd:function(){return this.ia},Lc:function(){return this.M}},te.Ve=1,te.Mf=2,te.BRUTE_FORCE=1,te.BVH=2,Nt.vm=0,Nt.Ue=1,Nt.ji=2,Nt.Ug=3,Nt.Tg=4,Nt.Vg=5,Nt.Xg=0,Nt.Wg=5,Nt.SPHERE=0,Nt.BOX=1,Nt.CYLINDER=2,Nt.CONE=3,Nt.CAPSULE=4,Nt.CONVEX_HULL=5,Bt.re=1,Mt.Mb=0,bt.numCreations=0,yt.defaultFriction=.2,yt.defaultRestitution=.2,yt.defaultDensity=1,yt.defaultCollisionGroup=1,yt.defaultCollisionMask=1,yt.maxTranslationPerStep=20,yt.maxRotationPerStep=3.14159265358979,yt.bvhProxyPadding=.1,yt.bvhIncrementalCollisionThreshold=.45,yt.defaultGJKMargin=.05,yt.enableGJKCaching=!0,yt.maxEPAVertices=128,yt.maxEPAPolyhedronFaces=128,yt.contactEnableBounceThreshold=.5,yt.velocityBaumgarte=.2,yt.positionSplitImpulseBaumgarte=.4,yt.positionNgsBaumgarte=1,yt.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,yt.defaultContactPositionCorrectionAlgorithm=0,yt.alternativeContactPositionCorrectionAlgorithm=1,yt.contactPersistenceThreshold=.05,yt.maxManifoldPoints=4,yt.defaultJointConstraintSolverType=0,yt.defaultJointPositionCorrectionAlgorithm=0,yt.jointWarmStartingFactorForBaungarte=.8,yt.jointWarmStartingFactor=.95,yt.minSpringDamperDampingRatio=1e-6,yt.minRagdollMaxSwingAngle=1e-6,yt.maxJacobianRows=6,yt.directMlcpSolverEps=1e-9,yt.islandInitialRigidBodyArraySize=128,yt.islandInitialConstraintArraySize=128,yt.sleepingVelocityThreshold=.2,yt.sleepingAngularVelocityThreshold=.5,yt.sleepingTimeThreshold=1,yt.disableSleeping=!1,yt.linearSlop=.005,yt.angularSlop=.017453292519943278,gt.cb=new gt,mt.Dm=0,mt.gm=1,mt.cm=2,mt.bm=257,mt.am=258,mt.Nl=259,mt.SUCCEEDED=0,mt.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,mt.GJK_DID_NOT_CONVERGE=2,mt.EPA_FAILED_TO_INIT=257,mt.EPA_FAILED_TO_ADD_VERTEX=258,mt.EPA_DID_NOT_CONVERGE=259,dt.numCreations=0,pt.numCreations=0,ut.POSITIVE_INFINITY=1/0,ut.NEGATIVE_INFINITY=-1/0,ut.PI=3.14159265358979,ut.TWO_PI=6.28318530717958,ut.HALF_PI=1.570796326794895,ut.TO_RADIANS=.017453292519943278,ut.TO_DEGREES=57.29577951308238,ct.numCreations=0,X.broadPhaseCollisionTime=0,X.narrowPhaseCollisionTime=0,X.dynamicsTime=0,X.totalTime=0,$.ue=0,$.xm=1,$.lm=2,$.BAUMGARTE=0,$.SPLIT_IMPULSE=1,$.NGS=2,V.pe=1,V.Yd=2,E.wm=0,E.um=1,E.ki=2,E.qm=3,E.Em=4,E.rm=5,E.SPHERICAL=0,E.REVOLUTE=1,E.CYLINDRICAL=2,E.PRISMATIC=3,E.UNIVERSAL=4,E.RAGDOLL=5,m.im=0,m.li=1,m.ITERATIVE=0,m.DIRECT=1,i.Pj=0,i.Cm=1,i.jm=2,i.DYNAMIC=0,i.STATIC=1,i.KINEMATIC=2,t.OIMO={},t.OIMO.BroadPhase=ae,ae.prototype.createProxy=ae.prototype.Vh,ae.prototype.destroyProxy=ae.prototype.Wh,ae.prototype.moveProxy=ae.prototype.wd,ae.prototype.isOverlapping=ae.prototype.Mb,ae.prototype.collectPairs=ae.prototype.Ii,ae.prototype.getProxyPairList=ae.prototype.ua,ae.prototype.isIncremental=ae.prototype.Hb,ae.prototype.getTestCount=ae.prototype.cb,ae.prototype.rayCast=ae.prototype.Vd,ae.prototype.convexCast=ae.prototype.Bf,ae.prototype.aabbTest=ae.prototype.qh,t.OIMO.Geometry=ne,ne.prototype.getType=ne.prototype.cb,ne.prototype.getVolume=ne.prototype.ua,ne.prototype.rayCast=ne.prototype.Vd,t.OIMO.ConvexGeometry=re,re.prototype.getGjkMargin=re.prototype.un,re.prototype.setGjkMargin=re.prototype.Zn,re.prototype.computeLocalSupportingVertex=re.prototype.Pd,re.prototype.rayCast=re.prototype.Vd,t.OIMO.BroadPhaseProxyCallback=ee,ee.prototype.process=ee.prototype.process,t.OIMO.BroadPhaseType=te,t.OIMO.Proxy=Qt,Qt.prototype.getId=Qt.prototype.Hb,Qt.prototype.getFatAabb=Qt.prototype.ua,Qt.prototype.getFatAabbTo=Qt.prototype.cb,t.OIMO.ProxyPair=Zt,Zt.prototype.getProxy1=Zt.prototype.ua,Zt.prototype.getProxy2=Zt.prototype.cb,Zt.prototype.getNext=Zt.prototype.Hb,t.OIMO.BruteForceBroadPhase=Kt,Kt.prototype.createProxy=Kt.prototype.Vh,Kt.prototype.destroyProxy=Kt.prototype.Wh,Kt.prototype.moveProxy=Kt.prototype.wd,Kt.prototype.collectPairs=Kt.prototype.Ii,Kt.prototype.rayCast=Kt.prototype.Vd,Kt.prototype.convexCast=Kt.prototype.Bf,Kt.prototype.aabbTest=Kt.prototype.qh,t.OIMO.BvhBroadPhase=Yt,Yt.prototype.createProxy=Yt.prototype.Vh,Yt.prototype.destroyProxy=Yt.prototype.Wh,Yt.prototype.moveProxy=Yt.prototype.wd,Yt.prototype.collectPairs=Yt.prototype.Ii,Yt.prototype.rayCast=Yt.prototype.Vd,Yt.prototype.convexCast=Yt.prototype.Bf,Yt.prototype.aabbTest=Yt.prototype.qh,Yt.prototype.getTreeBalance=Yt.prototype.Jn,t.OIMO.Aabb=Wt,Wt.prototype.init=Wt.prototype.za,Wt.prototype.getMin=Wt.prototype.Jc,Wt.prototype.getMinTo=Wt.prototype.Kc,Wt.prototype.setMin=Wt.prototype.Yd,Wt.prototype.getMax=Wt.prototype.Ac,Wt.prototype.getMaxTo=Wt.prototype.Ec,Wt.prototype.setMax=Wt.prototype.fd,Wt.prototype.getCenter=Wt.prototype.Hb,Wt.prototype.getCenterTo=Wt.prototype.Mb,Wt.prototype.getExtents=Wt.prototype.pc,Wt.prototype.getExtentsTo=Wt.prototype.qc,Wt.prototype.combine=Wt.prototype.ua,Wt.prototype.combined=Wt.prototype.cb,Wt.prototype.overlap=Wt.prototype.Lc,Wt.prototype.getIntersection=Wt.prototype.uc,Wt.prototype.getIntersectionTo=Wt.prototype.vc,Wt.prototype.copyFrom=Wt.prototype.de,Wt.prototype.clone=Wt.prototype.clone,t.OIMO.BoxGeometry=Ht,Ht.prototype.getHalfExtents=Ht.prototype.vn,Ht.prototype.getHalfExtentsTo=Ht.prototype.wn,Ht.prototype.computeLocalSupportingVertex=Ht.prototype.Pd,t.OIMO.CapsuleGeometry=kt,kt.prototype.getRadius=kt.prototype.Xh,kt.prototype.getHalfHeight=kt.prototype.Bj,kt.prototype.computeLocalSupportingVertex=kt.prototype.Pd,t.OIMO.ConeGeometry=Ut,Ut.prototype.getRadius=Ut.prototype.Xh,Ut.prototype.getHalfHeight=Ut.prototype.Bj,Ut.prototype.computeLocalSupportingVertex=Ut.prototype.Pd,t.OIMO.ConvexHullGeometry=Vt,Vt.prototype.getVertices=Vt.prototype.Nn,Vt.prototype.computeLocalSupportingVertex=Vt.prototype.Pd,t.OIMO.CylinderGeometry=jt,jt.prototype.getRadius=jt.prototype.Xh,jt.prototype.getHalfHeight=jt.prototype.Bj,jt.prototype.computeLocalSupportingVertex=jt.prototype.Pd,t.OIMO.GeometryType=Nt,t.OIMO.RayCastHit=Gt,t.OIMO.SphereGeometry=Ft,Ft.prototype.getRadius=Ft.prototype.Xh,Ft.prototype.computeLocalSupportingVertex=Ft.prototype.Pd,t.OIMO.CollisionMatrix=Ot,Ot.prototype.getDetector=Ot.prototype.ua,t.OIMO.DetectorResult=It,It.prototype.getMaxDepth=It.prototype.mm,It.prototype.clear=It.prototype.clear,t.OIMO.DetectorResultPoint=Dt,t.OIMO.Detector=Pt,Pt.prototype.detect=Pt.prototype.hm,t.OIMO.BoxBoxDetector=Bt,t.OIMO.CapsuleCapsuleDetector=Lt,t.OIMO.GjkEpaDetector=Ct,t.OIMO.SphereBoxDetector=Tt,t.OIMO.SphereCapsuleDetector=At,t.OIMO.SphereSphereDetector=St,t.OIMO.Vec3=bt,bt.prototype.init=bt.prototype.za,bt.prototype.zero=bt.prototype.Z,bt.prototype.add=bt.prototype.Lc,bt.prototype.addScaled=bt.prototype.ua,bt.prototype.sub=bt.prototype.ue,bt.prototype.scale=bt.prototype.se,bt.prototype.scale3=bt.prototype.Ve,bt.prototype.dot=bt.prototype.Yd,bt.prototype.cross=bt.prototype.Hb,bt.prototype.addEq=bt.prototype.fd,bt.prototype.addScaledEq=bt.prototype.cb,bt.prototype.subEq=bt.prototype.Ue,bt.prototype.scaleEq=bt.prototype.te,bt.prototype.scale3Eq=bt.prototype.Mf,bt.prototype.crossEq=bt.prototype.Mb,bt.prototype.mulMat3=bt.prototype.pc,bt.prototype.mulMat4=bt.prototype.uc,bt.prototype.mulTransform=bt.prototype.Ac,bt.prototype.mulMat3Eq=bt.prototype.qc,bt.prototype.mulMat4Eq=bt.prototype.vc,bt.prototype.mulTransformEq=bt.prototype.Ec,bt.prototype.length=bt.prototype.length,bt.prototype.lengthSq=bt.prototype.pe,bt.prototype.normalized=bt.prototype.re,bt.prototype.normalize=bt.prototype.qe,bt.prototype.negate=bt.prototype.Jc,bt.prototype.negateEq=bt.prototype.Kc,bt.prototype.copyFrom=bt.prototype.de,bt.prototype.clone=bt.prototype.clone,bt.prototype.toString=bt.prototype.toString,t.OIMO.Transform=vt,vt.prototype.identity=vt.prototype.Wf,vt.prototype.getPosition=vt.prototype.Hb,vt.prototype.getPositionTo=vt.prototype.Mb,vt.prototype.setPosition=vt.prototype.Ec,vt.prototype.translate=vt.prototype.Lc,vt.prototype.getRotation=vt.prototype.pc,vt.prototype.getRotationTo=vt.prototype.qc,vt.prototype.setRotation=vt.prototype.Jc,vt.prototype.setRotationXyz=vt.prototype.Kc,vt.prototype.rotate=vt.prototype.uc,vt.prototype.rotateXyz=vt.prototype.vc,vt.prototype.getOrientation=vt.prototype.ua,vt.prototype.getOrientationTo=vt.prototype.cb,vt.prototype.setOrientation=vt.prototype.Ac,vt.prototype.clone=vt.prototype.clone,vt.prototype.copyFrom=vt.prototype.de,t.OIMO.Setting=yt,t.OIMO.GjkEpa=gt,gt.prototype.computeClosestPoints=gt.prototype.ua,gt.prototype.computeDistance=gt.prototype.cb,gt.prototype.convexCast=gt.prototype.Bf,gt.prototype.rayCast=gt.prototype.Vd,gt.getInstance=gt.pc,t.OIMO.GjkEpaResultState=mt,t.OIMO.SimplexUtil=ft,ft.projectOrigin2=ft.qc,ft.projectOrigin3=ft.uc,ft.projectOrigin4=ft.vc,t.OIMO.Mat3=dt,dt.prototype.init=dt.prototype.za,dt.prototype.identity=dt.prototype.Wf,dt.prototype.add=dt.prototype.Ac,dt.prototype.sub=dt.prototype.Ug,dt.prototype.scale=dt.prototype.Mf,dt.prototype.mul=dt.prototype.re,dt.prototype.addEq=dt.prototype.Ec,dt.prototype.subEq=dt.prototype.Vg,dt.prototype.scaleEq=dt.prototype.Tg,dt.prototype.mulEq=dt.prototype.se,dt.prototype.prependScale=dt.prototype.Ue,dt.prototype.appendScale=dt.prototype.Lc,dt.prototype.prependRotation=dt.prototype.te,dt.prototype.appendRotation=dt.prototype.Jc,dt.prototype.prependScaleEq=dt.prototype.Ve,dt.prototype.appendScaleEq=dt.prototype.fd,dt.prototype.prependRotationEq=dt.prototype.ue,dt.prototype.appendRotationEq=dt.prototype.Kc,dt.prototype.transpose=dt.prototype.ji,dt.prototype.transposeEq=dt.prototype.ki,dt.prototype.determinant=dt.prototype.Yd,dt.prototype.trace=dt.prototype.Xg,dt.prototype.inverse=dt.prototype.pe,dt.prototype.inverseEq=dt.prototype.qe,dt.prototype.toArray=dt.prototype.Wg,dt.prototype.copyFrom=dt.prototype.de,dt.prototype.clone=dt.prototype.clone,dt.prototype.fromQuat=dt.prototype.Hb,dt.prototype.toQuat=dt.prototype.Pj,dt.prototype.fromEulerXyz=dt.prototype.cb,dt.prototype.toEulerXyz=dt.prototype.li,dt.prototype.getRow=dt.prototype.uc,dt.prototype.getCol=dt.prototype.pc,dt.prototype.getRowTo=dt.prototype.vc,dt.prototype.getColTo=dt.prototype.qc,dt.prototype.fromRows=dt.prototype.Mb,dt.prototype.fromCols=dt.prototype.ua,dt.prototype.toString=dt.prototype.toString,t.OIMO.Mat4=pt,pt.prototype.init=pt.prototype.za,pt.prototype.identity=pt.prototype.Wf,pt.prototype.add=pt.prototype.pc,pt.prototype.sub=pt.prototype.Mf,pt.prototype.scale=pt.prototype.Ue,pt.prototype.mul=pt.prototype.Yd,pt.prototype.addEq=pt.prototype.qc,pt.prototype.subEq=pt.prototype.Tg,pt.prototype.scaleEq=pt.prototype.Ve,pt.prototype.mulEq=pt.prototype.pe,pt.prototype.prependScale=pt.prototype.te,pt.prototype.appendScale=pt.prototype.Ac,pt.prototype.prependRotation=pt.prototype.re,pt.prototype.appendRotation=pt.prototype.uc,pt.prototype.prependTranslation=pt.prototype.ki,pt.prototype.appendTranslation=pt.prototype.ua,pt.prototype.prependScaleEq=pt.prototype.ue,pt.prototype.appendScaleEq=pt.prototype.Ec,pt.prototype.prependRotationEq=pt.prototype.se,pt.prototype.appendRotationEq=pt.prototype.vc,pt.prototype.prependTranslationEq=pt.prototype.li,pt.prototype.appendTranslationEq=pt.prototype.cb,pt.prototype.transpose=pt.prototype.Wg,pt.prototype.transposeEq=pt.prototype.Xg,pt.prototype.determinant=pt.prototype.Jc,pt.prototype.trace=pt.prototype.Vg,pt.prototype.inverse=pt.prototype.Lc,pt.prototype.inverseEq=pt.prototype.fd,pt.prototype.lookAt=pt.prototype.Mb,pt.prototype.perspective=pt.prototype.qe,pt.prototype.ortho=pt.prototype.ji,pt.prototype.toArray=pt.prototype.Ug,pt.prototype.copyFrom=pt.prototype.de,pt.prototype.fromMat3=pt.prototype.Kc,pt.prototype.fromTransform=pt.prototype.Hb,pt.prototype.clone=pt.prototype.clone,pt.prototype.toString=pt.prototype.toString,t.OIMO.MathUtil=ut,ut.abs=ut.abs,ut.sin=ut.sin,ut.cos=ut.cos,ut.tan=ut.tan,ut.asin=ut.asin,ut.acos=ut.acos,ut.atan=ut.atan,ut.safeAsin=ut.fd,ut.safeAcos=ut.Lc,ut.atan2=ut.atan2,ut.sqrt=ut.sqrt,ut.clamp=ut.Hb,ut.rand=ut.Ac,ut.randIn=ut.Ec,ut.randVec3In=ut.Kc,ut.randVec3=ut.Jc,t.OIMO.Pool=lt,lt.prototype.vec3=lt.prototype.Ac,lt.prototype.mat3=lt.prototype.qc,lt.prototype.mat4=lt.prototype.uc,lt.prototype.quat=lt.prototype.vc,lt.prototype.dispose=lt.prototype.ua,lt.prototype.disposeVec3=lt.prototype.pc,lt.prototype.disposeMat3=lt.prototype.cb,lt.prototype.disposeMat4=lt.prototype.Hb,lt.prototype.disposeQuat=lt.prototype.Mb,t.OIMO.Quat=ct,ct.prototype.identity=ct.prototype.Wf,ct.prototype.init=ct.prototype.za,ct.prototype.add=ct.prototype.ua,ct.prototype.sub=ct.prototype.Ec,ct.prototype.scale=ct.prototype.vc,ct.prototype.addEq=ct.prototype.cb,ct.prototype.subEq=ct.prototype.Jc,ct.prototype.scaleEq=ct.prototype.Ac,ct.prototype.length=ct.prototype.length,ct.prototype.lengthSq=ct.prototype.pc,ct.prototype.dot=ct.prototype.Hb,ct.prototype.normalized=ct.prototype.uc,ct.prototype.normalize=ct.prototype.qc,ct.prototype.setArc=ct.prototype.Kc,ct.prototype.slerp=ct.prototype.Lc,ct.prototype.copyFrom=ct.prototype.de,ct.prototype.clone=ct.prototype.clone,ct.prototype.fromMat3=ct.prototype.Mb,ct.prototype.toMat3=ct.prototype.fd,ct.prototype.toString=ct.prototype.toString,t.OIMO.Contact=ht,ht.prototype.getShape1=ht.prototype.pc,ht.prototype.getShape2=ht.prototype.qc,ht.prototype.isTouching=ht.prototype.sk,ht.prototype.getManifold=ht.prototype.cb,ht.prototype.getContactConstraint=ht.prototype.ua,ht.prototype.getPrev=ht.prototype.Mb,ht.prototype.getNext=ht.prototype.Hb,t.OIMO.ContactLink=ot,ot.prototype.getContact=ot.prototype.ua,ot.prototype.getOther=ot.prototype.Hb,ot.prototype.getPrev=ot.prototype.Mb,ot.prototype.getNext=ot.prototype.cb,t.OIMO.ContactManager=at,at.prototype.getNumContacts=at.prototype.cb,at.prototype.getContactList=at.prototype.ua,t.OIMO.TimeStep=rt,t.OIMO.World=st,st.prototype.step=st.prototype.pe,st.prototype.addRigidBody=st.prototype.cb,st.prototype.removeRigidBody=st.prototype.qe,st.prototype.addJoint=st.prototype.ua,st.prototype.removeJoint=st.prototype.Kl,st.prototype.rayCast=st.prototype.Vd,st.prototype.convexCast=st.prototype.Bf,st.prototype.aabbTest=st.prototype.qh,st.prototype.getRigidBodyList=st.prototype.fd,st.prototype.getJointList=st.prototype.vc,st.prototype.getBroadPhase=st.prototype.Mb,st.prototype.getContactManager=st.prototype.pc,st.prototype.getNumRigidBodies=st.prototype.Kc,st.prototype.getNumJoints=st.prototype.Ec,st.prototype.getNumShapes=st.prototype.Yd,st.prototype.getNumIslands=st.prototype.Ac,st.prototype.getNumVelocityIterations=st.prototype.Lc,st.prototype.setNumVelocityIterations=st.prototype.ue,st.prototype.getNumPositionIterations=st.prototype.Jc,st.prototype.setNumPositionIterations=st.prototype.te,st.prototype.getGravity=st.prototype.uc,st.prototype.setGravity=st.prototype.se,t.OIMO.AabbTestCallback=Q,t.OIMO.ContactCallback=Z,t.OIMO.RayCastCallback=K,t.OIMO.RayCastClosest=Y,Y.prototype.clear=Y.prototype.clear,Y.prototype.process=Y.prototype.process,t.OIMO.Performance=X,t.OIMO.ConstraintSolver=J,J.prototype.preSolveVelocity=J.prototype.xh,J.prototype.warmStart=J.prototype.Gh,J.prototype.solveVelocity=J.prototype.Ch,J.prototype.postSolveVelocity=J.prototype.Li,J.prototype.preSolvePosition=J.prototype.Pg,J.prototype.solvePositionSplitImpulse=J.prototype.Bh,J.prototype.solvePositionNgs=J.prototype.Ah,J.prototype.postSolve=J.prototype.postSolve,t.OIMO.PositionCorrectionAlgorithm=$,t.OIMO.ContactConstraint=q,q.prototype.getShape1=q.prototype.cb,q.prototype.getShape2=q.prototype.Hb,q.prototype.getManifold=q.prototype.ua,q.prototype.isTouching=q.prototype.sk,t.OIMO.Manifold=H,H.prototype.getNormal=H.prototype.Hb,H.prototype.getNormalTo=H.prototype.Mb,H.prototype.getTangent=H.prototype.uc,H.prototype.getTangentTo=H.prototype.vc,H.prototype.getBinormal=H.prototype.ua,H.prototype.getBinormalTo=H.prototype.cb,H.prototype.getPoints=H.prototype.qc,H.prototype.getNumPoints=H.prototype.pc,t.OIMO.ManifoldPoint=k,k.prototype.getPosition1=k.prototype.Mb,k.prototype.getPosition1To=k.prototype.pc,k.prototype.getPosition2=k.prototype.qc,k.prototype.getPosition2To=k.prototype.uc,k.prototype.getDepth=k.prototype.cb,k.prototype.isWarmStarted=k.prototype.Ac,k.prototype.getNormalImpulse=k.prototype.Hb,k.prototype.getTangentImpulse=k.prototype.vc,k.prototype.getBinormalImpulse=k.prototype.ua,k.prototype.isEnabled=k.prototype.Ec,t.OIMO.Joint=O,O.prototype.getRigidBody1=O.prototype.ue,O.prototype.getRigidBody2=O.prototype.Ue,O.prototype.getType=O.prototype.Tg,O.prototype.getAnchor1=O.prototype.cb,O.prototype.getAnchor2=O.prototype.Mb,O.prototype.getAnchor1To=O.prototype.Hb,O.prototype.getAnchor2To=O.prototype.pc,O.prototype.getLocalAnchor1=O.prototype.pe,O.prototype.getLocalAnchor2=O.prototype.re,O.prototype.getLocalAnchor1To=O.prototype.qe,O.prototype.getLocalAnchor2To=O.prototype.se,O.prototype.getBasis1=O.prototype.Ec,O.prototype.getBasis2=O.prototype.Kc,O.prototype.getBasis1To=O.prototype.Jc,O.prototype.getBasis2To=O.prototype.Lc,O.prototype.getAllowCollision=O.prototype.ua,O.prototype.setAllowCollision=O.prototype.Ug,O.prototype.getBreakForce=O.prototype.fd,O.prototype.setBreakForce=O.prototype.Vg,O.prototype.getBreakTorque=O.prototype.Yd,O.prototype.setBreakTorque=O.prototype.Wg,O.prototype.getPositionCorrectionAlgorithm=O.prototype.te,O.prototype.setPositionCorrectionAlgorithm=O.prototype.Xg,O.prototype.getAppliedForce=O.prototype.qc,O.prototype.getAppliedForceTo=O.prototype.uc,O.prototype.getAppliedTorque=O.prototype.vc,O.prototype.getAppliedTorqueTo=O.prototype.Ac,O.prototype.getPrev=O.prototype.Mf,O.prototype.getNext=O.prototype.Ve,t.OIMO.CylindricalJoint=I,I.prototype.getAxis1=I.prototype.Eg,I.prototype.getAxis2=I.prototype.Gg,I.prototype.getAxis1To=I.prototype.Fg,I.prototype.getAxis2To=I.prototype.Hg,I.prototype.getLocalAxis1=I.prototype.Ig,I.prototype.getLocalAxis2=I.prototype.Kg,I.prototype.getLocalAxis1To=I.prototype.Jg,I.prototype.getLocalAxis2To=I.prototype.Lg,I.prototype.getTranslationalSpringDamper=I.prototype.In,I.prototype.getRotationalSpringDamper=I.prototype.An,I.prototype.getTranslationalLimitMotor=I.prototype.Hn,I.prototype.getRotationalLimitMotor=I.prototype.zn,I.prototype.getAngle=I.prototype.ol,I.prototype.getTranslation=I.prototype.rl,t.OIMO.JointConfig=D,t.OIMO.CylindricalJointConfig=P,P.prototype.init=P.prototype.za,t.OIMO.JointLink=z,z.prototype.getContact=z.prototype.ua,z.prototype.getOther=z.prototype.Hb,z.prototype.getPrev=z.prototype.Mb,z.prototype.getNext=z.prototype.cb,t.OIMO.JointType=E,t.OIMO.PrismaticJoint=L,L.prototype.getAxis1=L.prototype.Eg,L.prototype.getAxis2=L.prototype.Gg,L.prototype.getAxis1To=L.prototype.Fg,L.prototype.getAxis2To=L.prototype.Hg,L.prototype.getLocalAxis1=L.prototype.Ig,L.prototype.getLocalAxis2=L.prototype.Kg,L.prototype.getLocalAxis1To=L.prototype.Jg,L.prototype.getLocalAxis2To=L.prototype.Lg,L.prototype.getSpringDamper=L.prototype.Cj,L.prototype.getLimitMotor=L.prototype.ql,L.prototype.getTranslation=L.prototype.rl,t.OIMO.PrismaticJointConfig=C,C.prototype.init=C.prototype.za,t.OIMO.RagdollJoint=T,T.prototype.getAxis1=T.prototype.Eg,T.prototype.getAxis2=T.prototype.Gg,T.prototype.getAxis1To=T.prototype.Fg,T.prototype.getAxis2To=T.prototype.Hg,T.prototype.getLocalAxis1=T.prototype.Ig,T.prototype.getLocalAxis2=T.prototype.Kg,T.prototype.getLocalAxis1To=T.prototype.Jg,T.prototype.getLocalAxis2To=T.prototype.Lg,T.prototype.getTwistSpringDamper=T.prototype.Mn,T.prototype.getTwistLimitMotor=T.prototype.Ln,T.prototype.getSwingSpringDamper=T.prototype.Gn,T.prototype.getSwingAxis=T.prototype.En,T.prototype.getSwingAxisTo=T.prototype.Fn,T.prototype.getSwingAngle=T.prototype.Dn,T.prototype.getTwistAngle=T.prototype.Kn,t.OIMO.RagdollJointConfig=A,A.prototype.init=A.prototype.za,t.OIMO.RevoluteJoint=S,S.prototype.getAxis1=S.prototype.Eg,S.prototype.getAxis2=S.prototype.Gg,S.prototype.getAxis1To=S.prototype.Fg,S.prototype.getAxis2To=S.prototype.Hg,S.prototype.getLocalAxis1=S.prototype.Ig,S.prototype.getLocalAxis2=S.prototype.Kg,S.prototype.getLocalAxis1To=S.prototype.Jg,S.prototype.getLocalAxis2To=S.prototype.Lg,S.prototype.getSpringDamper=S.prototype.Cj,S.prototype.getLimitMotor=S.prototype.ql,S.prototype.getAngle=S.prototype.ol,t.OIMO.RevoluteJointConfig=w,w.prototype.init=w.prototype.za,t.OIMO.RotationalLimitMotor=M,M.prototype.setLimits=M.prototype.ua,M.prototype.setMotor=M.prototype.cb,M.prototype.clone=M.prototype.clone,t.OIMO.SphericalJoint=_,_.prototype.getSpringDamper=_.prototype.Cj,t.OIMO.SphericalJointConfig=x,x.prototype.init=x.prototype.za,t.OIMO.SpringDamper=b,b.prototype.setSpring=b.prototype.ua,b.prototype.setSymplecticEuler=b.prototype.cb,b.prototype.clone=b.prototype.clone,t.OIMO.TranslationalLimitMotor=v,v.prototype.setLimits=v.prototype.ua,v.prototype.setMotor=v.prototype.cb,v.prototype.clone=v.prototype.clone,t.OIMO.UniversalJoint=y,y.prototype.getAxis1=y.prototype.Eg,y.prototype.getAxis2=y.prototype.Gg,y.prototype.getAxis1To=y.prototype.Fg,y.prototype.getAxis2To=y.prototype.Hg,y.prototype.getLocalAxis1=y.prototype.Ig,y.prototype.getLocalAxis2=y.prototype.Kg,y.prototype.getLocalAxis1To=y.prototype.Jg,y.prototype.getLocalAxis2To=y.prototype.Lg,y.prototype.getSpringDamper1=y.prototype.Bn,y.prototype.getSpringDamper2=y.prototype.Cn,y.prototype.getLimitMotor1=y.prototype.xn,y.prototype.getLimitMotor2=y.prototype.yn,y.prototype.getAngle1=y.prototype.sn,y.prototype.getAngle2=y.prototype.tn,t.OIMO.UniversalJointConfig=g,g.prototype.init=g.prototype.za,t.OIMO.ConstraintSolverType=m,t.OIMO.DirectJointConstraintSolver=h,h.prototype.preSolveVelocity=h.prototype.xh,h.prototype.warmStart=h.prototype.Gh,h.prototype.solveVelocity=h.prototype.Ch,h.prototype.postSolveVelocity=h.prototype.Li,h.prototype.preSolvePosition=h.prototype.Pg,h.prototype.solvePositionSplitImpulse=h.prototype.Bh,h.prototype.solvePositionNgs=h.prototype.Ah,h.prototype.postSolve=h.prototype.postSolve,t.OIMO.PgsContactConstraintSolver=a,a.prototype.preSolveVelocity=a.prototype.xh,a.prototype.warmStart=a.prototype.Gh,a.prototype.solveVelocity=a.prototype.Ch,a.prototype.preSolvePosition=a.prototype.Pg,a.prototype.solvePositionSplitImpulse=a.prototype.Bh,a.prototype.solvePositionNgs=a.prototype.Ah,a.prototype.postSolve=a.prototype.postSolve,t.OIMO.PgsJointConstraintSolver=n,n.prototype.preSolveVelocity=n.prototype.xh,n.prototype.warmStart=n.prototype.Gh,n.prototype.solveVelocity=n.prototype.Ch,n.prototype.postSolveVelocity=n.prototype.Li,n.prototype.preSolvePosition=n.prototype.Pg,n.prototype.solvePositionSplitImpulse=n.prototype.Bh,n.prototype.solvePositionNgs=n.prototype.Ah,n.prototype.postSolve=n.prototype.postSolve,t.OIMO.MassData=r,t.OIMO.RigidBody=s,s.prototype.getPosition=s.prototype.qm,s.prototype.getPositionTo=s.prototype.rm,s.prototype.setPosition=s.prototype.Xn,s.prototype.translate=s.prototype.jo,s.prototype.getRotation=s.prototype.vm,s.prototype.getRotationTo=s.prototype.wm,s.prototype.setRotation=s.prototype.$n,s.prototype.setRotationXyz=s.prototype.fo,s.prototype.rotate=s.prototype.Em,s.prototype.rotateXyz=s.prototype.Sn,s.prototype.getOrientation=s.prototype.jm,s.prototype.getOrientationTo=s.prototype.lm,s.prototype.setOrientation=s.prototype.Tn,s.prototype.getTransform=s.prototype.xm,s.prototype.getTransformTo=s.prototype.Cm,s.prototype.setTransform=s.prototype.ho,s.prototype.getMass=s.prototype.Tg,s.prototype.getLocalInertia=s.prototype.se,s.prototype.getLocalInertiaTo=s.prototype.te,s.prototype.getMassData=s.prototype.Ug,s.prototype.getMassDataTo=s.prototype.Vg,s.prototype.setMassData=s.prototype.Qm,s.prototype.getRotationFactor=s.prototype.ji,s.prototype.setRotationFactor=s.prototype.Rm,s.prototype.getLinearVelocity=s.prototype.qe,s.prototype.getLinearVelocityTo=s.prototype.re,s.prototype.setLinearVelocity=s.prototype.Pm,s.prototype.getAngularVelocity=s.prototype.Jc,s.prototype.getAngularVelocityTo=s.prototype.Kc,s.prototype.setAngularVelocity=s.prototype.mo,s.prototype.addLinearVelocity=s.prototype.cb,s.prototype.addAngularVelocity=s.prototype.ua,s.prototype.applyImpulse=s.prototype.uc,s.prototype.applyLinearImpulse=s.prototype.vc,s.prototype.applyAngularImpulse=s.prototype.Mb,s.prototype.applyForce=s.prototype.pc,s.prototype.applyForceToCenter=s.prototype.qc,s.prototype.applyTorque=s.prototype.Ac,s.prototype.getGravityScale=s.prototype.fd,s.prototype.setGravityScale=s.prototype.Nm,s.prototype.getLocalPoint=s.prototype.ue,s.prototype.getLocalPointTo=s.prototype.Ue,s.prototype.getLocalVector=s.prototype.Ve,s.prototype.getLocalVectorTo=s.prototype.Mf,s.prototype.getWorldPoint=s.prototype.Pj,s.prototype.getWorldPointTo=s.prototype.Nl,s.prototype.getWorldVector=s.prototype.am,s.prototype.getWorldVectorTo=s.prototype.bm,s.prototype.getNumShapes=s.prototype.im,s.prototype.getShapeList=s.prototype.ki,s.prototype.getNumContectLinks=s.prototype.Wg,s.prototype.getContactLinkList=s.prototype.Lc,s.prototype.getNumJointLinks=s.prototype.Xg,s.prototype.getJointLinkList=s.prototype.Yd,s.prototype.addShape=s.prototype.Hb,s.prototype.removeShape=s.prototype.ko,s.prototype.getType=s.prototype.Dm,s.prototype.setType=s.prototype.Sm,s.prototype.wakeUp=s.prototype.Um,s.prototype.sleep=s.prototype.Tm,s.prototype.isSleeping=s.prototype.cm,s.prototype.getSleepTime=s.prototype.li,s.prototype.setAutoSleep=s.prototype.Mm,s.prototype.getLinearDamping=s.prototype.pe,s.prototype.setLinearDamping=s.prototype.Om,s.prototype.getAngularDamping=s.prototype.Ec,s.prototype.setAngularDamping=s.prototype.lo,s.prototype.getPrev=s.prototype.um,s.prototype.getNext=s.prototype.gm,t.OIMO.RigidBodyConfig=function(){this.position=new bt,this.rotation=new dt,this.linearVelocity=new bt,this.angularVelocity=new bt,this.type=0,this.autoSleep=!0,this.angularDamping=this.linearDamping=0},t.OIMO.RigidBodyType=i,t.OIMO.Shape=e,e.prototype.getFriction=e.prototype.uc,e.prototype.setFriction=e.prototype.ue,e.prototype.getRestitution=e.prototype.Jc,e.prototype.setRestitution=e.prototype.Ve,e.prototype.getLocalTransform=e.prototype.Ac,e.prototype.getLocalTransformTo=e.prototype.Ec,e.prototype.getTransform=e.prototype.Yd,e.prototype.getTransformTo=e.prototype.pe,e.prototype.setLocalTransform=e.prototype.Ue,e.prototype.getDensity=e.prototype.qc,e.prototype.setDensity=e.prototype.te,e.prototype.getAabb=e.prototype.ua,e.prototype.getAabbTo=e.prototype.cb,e.prototype.getGeometry=e.prototype.vc,e.prototype.getRigidBody=e.prototype.Kc,e.prototype.getCollisionGroup=e.prototype.Hb,e.prototype.setCollisionGroup=e.prototype.qe,e.prototype.getCollisionMask=e.prototype.Mb,e.prototype.setCollisionMask=e.prototype.re,e.prototype.getContactCallback=e.prototype.pc,e.prototype.setContactCallback=e.prototype.se,e.prototype.getPrev=e.prototype.fd,e.prototype.getNext=e.prototype.Lc,t.OIMO.ShapeConfig=function(){this.position=new bt,this.rotation=new dt,this.friction=yt.defaultFriction,this.restitution=yt.defaultRestitution,this.density=yt.defaultDensity,this.collisionGroup=yt.defaultCollisionGroup,this.collisionMask=yt.defaultCollisionMask,this.contactCallback=this.geometry=null}}(S);var OIMO=S.OIMO;class Renderable{start(t){this.ref=t,this.addEventListener("enable",this.onEnable),this.addEventListener("disable",this.onDisable)}onEnable(){this.entity.add(this.ref)}onDisable(){this.entity.remove(this.ref)}}class OrthographicCamera$1 extends OrthographicCamera{start(t){this._region=new Vector4,void 0!==t.left&&(this.left=t.left),void 0!==t.right&&(this.right=t.right),void 0!==t.top&&(this.top=t.top),void 0!==t.bottom&&(this.bottom=t.bottom),void 0!==t.near&&(this.near=t.near),void 0!==t.far&&(this.far=t.far),this.viewport=void 0!==t.viewport?t.viewport:new Vector4(0,0,1,1),this.updateProjectionMatrix(),this.addEventListener("enable",this.onEnable),this.addEventListener("disable",this.onDisable),this.addEventListener("sceneadd",this.onEnable),this.addEventListener("sceneremove",this.onDisable)}onEnable(){this.scene._cameras.push(this),this.entity.add(this)}onDisable(){this.scene._cameras.splice(this.scene._cameras.indexOf(this),1),this.entity.remove(this)}updateProjectionMatrix(){super.updateProjectionMatrix(),void 0!==this.entity&&this._updateRegion(this.app.renderer.domElement)}_updateRegion(t){const e=this.viewport;this._region.set(t.width*e.x,t.height*e.y,t.width*e.z,t.height*e.w)}toJSON(t){const e=super.toJSON(t);return e.object.viewport=this.viewport.toArray(),e}fromJSON(t){return t.viewport=(new Vector4).fromArray(t.viewport),t}}class PerspectiveCamera$1 extends PerspectiveCamera{start(t){this._region=new Vector4,this.autoAspect=!0,void 0!==t.fov&&(this.fov=t.fov),void 0!==t.near&&(this.near=t.near),void 0!==t.far&&(this.far=t.far),this.viewport=void 0!==t.viewport?t.viewport:new Vector4(0,0,1,1),void 0!==t.aspect&&(this.aspect=t.aspect),this.updateProjectionMatrix(),this.addEventListener("enable",this.onEnable),this.addEventListener("disable",this.onDisable)}onEnable(){this.scene._cameras.push(this),this.entity.add(this)}onDisable(){this.scene._cameras.splice(this.scene._cameras.indexOf(this),1),this.entity.remove(this)}updateProjectionMatrix(){super.updateProjectionMatrix(),void 0!==this.entity&&this._updateRegion(this.app.renderer.domElement)}_updateRegion(t){const e=this.viewport;this.autoAspect&&(this._aspect=t.width*e.z/(t.height*e.w),super.updateProjectionMatrix()),this._region.set(t.width*e.x,t.height*e.y,t.width*e.z,t.height*e.w)}get aspect(){return this._aspect}set aspect(t){this.autoAspect=!1,this._aspect=t}toJSON(t){const e=super.toJSON(t);return e.object.viewport=this.viewport.toArray(),this.autoAspect&&delete e.object.aspect,e}fromJSON(t){return t.viewport=(new Vector4).fromArray(t.viewport),t}}const vector=new Vector3$1,vector2=new Vector3$1,quat=new Quaternion,quat2=new Quaternion,matrix=new Matrix4;class Physics{constructor(t){this._accumulator=0,this._gravity=void 0!==t.gravity?t.gravity:new Vector3$1(0,-9.80665,0),this._triggers=[],this._world,this.rigidbodies}get gravity(){return this._gravity}set gravity(t){this._world.setGravity(t),this._gravity=t}raycast(t,e,i){this._world.rayCast(t,e,{process(t,e){i(t.collider,e.fraction,(new Vector3$1).copy(e.normal),(new Vector3$1).copy(e.position))}})}_updateScene(t){this._world=t._physicsWorld,this._world.setGravity(this._gravity),this.rigidbodies=t._containers.Rigidbody}_update(t,e){if(this._accumulator+=t,this._accumulator>=e)for(;this._accumulator>=e;){this._world.step(e);for(let t=0,e=this.rigidbodies.length;t<e;t++){let e=this.rigidbodies[t];if(!e._ref.isSleeping()){const t=e.entity,i=t.position,s=e._ref.getPosition();i._x=s.x,i._y=s.y,i._z=s.z;const r=t.quaternion,n=e._ref.getOrientation();r._x=n.x,r._y=n.y,r._z=n.z,r._w=n.w,t.parent!==t.scene&&(vector.copy(i).applyMatrix4(matrix.copy(t.parent.matrixWorld).invert()),i._x=vector.x,i._y=vector.y,i._z=vector.z,quat.copy(r).premultiply(t.parent.getWorldQuaternion(quat2).invert()),r._x=quat.x,r._y=quat.y,r._z=quat.z,r._w=quat.w)}}this._accumulator-=e}}}const quat$1=new Quaternion,vector$1=new Vector3$1,vector2$1=new Vector3$1,massData=new OIMO.MassData,config=new OIMO.RigidBodyConfig;class Rigidbody{start(t){"_physicsRef"in this.entity?this._ref=this.entity._physicsRef:Rigidbody.createRigidbody(this,0),void 0!==t.angularVelocity&&this.setAngularVelocity(t.angularVelocity),void 0!==t.angularDamping&&(this.angularDamping=t.angularDamping),void 0!==t.linearVelocity&&this.setLinearVelocity(t.linearVelocity),void 0!==t.linearDamping&&(this.linearDamping=t.linearDamping),void 0!==t.gravityScale&&(this.gravityScale=t.gravityScale),void 0!==t.autoSleep&&(this.autoSleep=t.autoSleep),this.isKinematic=void 0!==t.isKinematic&&t.isKinematic,void 0!==t.rotationFactor&&this.setRotationFactor(t.rotationFactor),this._ref.mass=void 0!==t.mass?t.mass:1,this.addEventListener("enable",this.onEnable),this.addEventListener("disable",this.onDisable),this.entity.addEventListener("scenechange",this.onSceneChange)}onEnable(){this._isKinematic?this._ref.setType(2):(this._ref.setType(0),this.mass=this._ref.mass),0===this._ref.getNumShapes()&&this.scene._physicsWorld.addRigidBody(this._ref)}onDisable(){this._ref.getNumShapes()>0?this._ref.setType(1):this.scene._physicsWorld.removeRigidBody(this._ref)}onSceneChange(t){this._enabled&&(t.oldScene._physicsWorld.removeRigidBody(this._ref),t.newScene._physicsWorld.addRigidBody(this._ref))}addAngularVelocity(t){this._ref.addAngularVelocity(t)}addLinearVelocity(t){this._ref.addAngularVelocity(t)}applyAngularImpulse(t){this._ref.applyAngularImpulse(t)}applyForce(t,e){this._ref.applyForce(t,e)}applyForceToCenter(t){this._ref.applyForceToCenter(t)}applyImpulse(t,e){this._ref.applyImpulse(t,e)}applyLinearImpulse(t){this._ref.applyLinearImpulse(t)}applyTorque(t){this._ref.applyTorque(t)}get angularDamping(){return this._ref.getAngularDamping()}getAngularVelocity(){const t=new Vector3$1;return this._ref.getAngularVelocityTo(t),t}get gravityScale(){return this._ref.getGravityScale()}get linearDamping(){return this._ref.getLinearDamping()}getLinearVelocity(){const t=new Vector3$1;return this._ref.getLinearVelocityTo(t),t}get localInertia(){const t=this._ref.getLocalInertia();return(new Matrix3).set(t.e00,t.e01,t.e02,t.e10,t.e11,t.e12,t.e20,t.e21,t.e22)}get mass(){return this._ref.mass}get sleepTime(){return this._ref.getSleepTime()}get isKinematic(){return this._isKinematic}set isKinematic(t){this._isKinematic=t,this._ref.setType(t?2:0)}get isSleeping(){return this._ref.isSleeping()}set isSleeping(t){t?this._ref.sleep():this._ref.wakeUp()}rotate(t){this._ref.rotateXyz(t)}set angularDamping(t){this._ref.setAngularDamping(t)}setAngularVelocity(t){this._ref.setAngularVelocity(t)}get autoSleep(){return void 0===this._autoSleep||this._autoSleep}set autoSleep(t){this._autoSleep=t,this._ref.setAutoSleep(t)}set gravityScale(t){this._ref.setGravityScale(t)}set linearDamping(t){this._ref.setLinearDamping(t)}setLinearVelocity(t){this._ref.setLinearVelocity(t)}set mass(t){this._ref.getMassDataTo(massData),massData.mass=t,this._ref.setMassData(massData)}getRotationFactor(){return(new Vector3$1).copy(this._ref.getRotationFactor())}setRotationFactor(t){this._ref.setRotationFactor(t)}toJSON(){return{angularVelocity:this.getAngularVelocity().toArray(),angularDamping:this.angularDamping,linearVelocity:this.getLinearVelocity().toArray(),linearDamping:this.linearDamping,gravityScale:this.gravityScale,autoSleep:this.autoSleep,isKinematic:this.isKinematic,rotationFactor:this.getRotationFactor().toArray(),mass:this.mass}}fromJSON(t){return t.angularVelocity=(new Vector3$1).fromArray(t.angularVelocity),t.linearVelocity=(new Vector3$1).fromArray(t.linearVelocity),t.rotationFactor=(new Vector3$1).fromArray(t.rotationFactor),t}static createRigidbody(t,e){const i=t.entity;i.updateWorldMatrix(),i.matrixWorld.decompose(vector$1,quat$1,vector2$1),config.position=vector$1,config.rotation.fromQuat(quat$1),config.type=e,i._physicsRef=t._ref=new OIMO.RigidBody(config),t._ref.component=t,t._ref.entity=i;const s=i.position;s._entity=i,posProps._x.value=s.x,posProps._y.value=s.y,posProps._z.value=s.z,Object.defineProperties(s,posProps);const r=i.quaternion,n=i.rotation;r._rotation=n,n._quaternion=r,n._entity=r._entity=i,r._onChange(onQuaternionChange),n._onChange(onRotationChange)}}const posProps={_x:{value:0,writable:!0},_y:{value:0,writable:!0},_z:{value:0,writable:!0},x:{get(){return this._x},set(t){this._x=t,this._entity.getWorldPosition(vector$1),this._entity._physicsRef.setPosition(vector$1)}},y:{get(){return this._y},set(t){this._y=t,this._entity.getWorldPosition(vector$1),this._entity._physicsRef.setPosition(vector$1)}},z:{get(){return this._z},set(t){this._z=t,this._entity.getWorldPosition(vector$1),this._entity._physicsRef.setPosition(vector$1)}}};function onQuaternionChange(){this._rotation.setFromQuaternion(this,void 0,!1),this._entity.getWorldQuaternion(quat$1),this._entity._physicsRef.setOrientation(quat$1)}function onRotationChange(){this._quaternion.setFromEuler(this,!1),this._entity.getWorldQuaternion(quat$1),this._entity._physicsRef.setOrientation(quat$1)}const vector$2=new Vector3$1,massData$1=new OIMO.MassData,transform=new OIMO.Transform,shapeConfig=new OIMO.ShapeConfig;shapeConfig.contactCallback={beginContact:t=>contactCallback(t,"collisionenter"),preSolve:t=>contactCallback(t,"collisionpresolve"),postSolve:t=>contactCallback(t,"collisionpostsolve"),endContact:t=>contactCallback(t,"collisionend")};const config$1=new OIMO.RigidBodyConfig;config$1.type=1;const properties={_x:{value:0,writable:!0},_y:{value:0,writable:!0},_z:{value:0,writable:!0},x:{get(){return this._x},set(t){this._x=t;const e=this._colliders;for(let t=0,i=e.length;t<i;t++)e[t]._setShape()}},y:{get(){return this._y},set(t){this._y=t;const e=this._colliders;for(let t=0,i=e.length;t<i;t++)e[t]._setShape()}},z:{get(){return this._z},set(t){this._z=t;const e=this._colliders;for(let t=0,i=e.length;t<i;t++)e[t]._setShape()}}};class Collider{start(t){this._isTrigger=void 0!==t.isTrigger&&t.isTrigger,this._collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this._collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this._center=void 0!==t.center?t.center:new Vector3$1(0,0,0),this._rotation=void 0!==t.rotation?t.rotation:new Euler(0,0,0),this._addDerivedProperties(t),void 0!==t.material&&(this._material=t.material),this._setShape(),this.addEventListener("enable",this.onEnable),this.addEventListener("disable",this.onDisable),this.entity.addEventListener("scenechange",this.onSceneChange)}onEnable(){if(this._isTrigger)this.app.physics._triggers.push(this._shapeRef.getGeometry());else{if(void 0!==this.entity._physicsRef){const t=this.entity._physicsRef;this._ref=t,t.component._enabled||this.scene._physicsWorld.addRigidBody(this._ref)}else Rigidbody.createRigidbody(this,1),this.scene._physicsWorld.addRigidBody(this._ref);this._ref.addShape(this._shapeRef),0===this._ref.getType()&&(this._ref.getMassDataTo(massData$1),massData$1.mass=this._ref.mass,this._ref.setMassData(massData$1))}const t=this.entity.scale;void 0!==t._colliders?t._colliders.push(this):(t._colliders=[this],properties._x.value=t.x,properties._y.value=t.y,properties._z.value=t.z,Object.defineProperties(this.entity.scale,properties))}onDisable(){if(this._isTrigger){const t=this.app.physics._triggers;t.splice(t.indexOf(this._shapeRef.getGeometry()),1)}else{this._ref.removeShape(this._shapeRef),0===this._ref.getType()&&(this._ref.getMassDataTo(massData$1),massData$1.mass=this._ref.mass,this._ref.setMassData(massData$1)),0===this._ref.getNumShapes()&&1===this._ref.getType()&&this.scene._physicsWorld.removeRigidBody(this._ref),delete this._ref;const t=this.entity.scale;1===t._colliders.length?Object.defineProperty(this.entity,"scale",{value:(new Vector3$1).copy(t)}):t._colliders.splice(t._colliders.indexOf(this),1)}}onSceneChange(t){if(this._enabled)if(this._isTrigger){const e=t.oldScene.app.physics._triggers;e.splice(e.indexOf(this._shapeRef.getGeometry()),1),t.newScene.app.physics._triggers.push(this._shapeRef.getGeometry())}else this._ref.removeShape(this._shapeRef),0===this._ref.getNumShapes()&&1===this._ref.getType()&&(t.oldScene._physicsWorld.removeRigidBody(this._ref),t.newScene._physicsWorld.addRigidBody(this._ref))}_setShape(){const t=this.entity.scale,e=Math.max(t.x,t.y,t.z);if(shapeConfig.geometry=this._setGeometry(t,e),shapeConfig.collisionGroup=this._collisionGroup,shapeConfig.collisionMask=this._collisionMask,shapeConfig.position=this._center,shapeConfig.rotation.fromEulerXyz(this._rotation),void 0!==this._shapeRef&&this._enabled)if(this._isTrigger){const t=this.app.physics._triggers;t.splice(t.indexOf(this._shapeRef.getGeometry()),1),this._shapeRef=new OIMO.Shape(shapeConfig),t.push(this._shapeRef.getGeometry())}else this._ref.removeShape(this._shapeRef),this._shapeRef=new OIMO.Shape(shapeConfig),this._ref.addShape(this._shapeRef);else this._shapeRef=new OIMO.Shape(shapeConfig);this._shapeRef.entity=this.entity,this._shapeRef.collider=this,void 0!==this._material&&(this.material=this._material)}get isTrigger(){return this._isTrigger}set isTrigger(t){this.onDisable(),this._isTrigger=t,this.onEnable()}get center(){return this._center}set center(t){this._center=t,this._shapeRef.getLocalTransformTo(transform),transform.setPosition(t),this._shapeRef.setLocalTransform(transform)}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._shapeRef.getLocalTransformTo(transform),transform.setRotationXyz(t),this._shapeRef.setLocalTransform(transform)}get material(){return this._material}set material(t){if(null===t&&(this._shapeRef.setFriction(.2),this._shapeRef.setRestitution(.2)),void 0!==this._material){const t=this._material._colliders;t.splice(t.indexOf(this._shapeRef),1)}t._colliders.push(this._shapeRef),this._shapeRef.setFriction(t._friction),this._shapeRef.setRestitution(t._restitution),this._material=t}get volume(){return this._shapeRef.getGeometry().getVolume()}get mesh(){return this._mesh}set mesh(t){this._mesh=t,this._setShape()}getPoints(){const t=[];for(let e=0,i=this._points.length;e<i;e++)t[e]=this._points.clone();return this._points}setPoints(t){this._points=t,this._setShape()}get halfExtents(){return this._halfHeight}get halfHeight(){return this._halfHeight}get radius(){return this._radius}set halfExtents(t){this._halfExtents=t,this._setShape()}set halfHeight(t){this._halfHeight=t,this._setShape()}set radius(t){this._radius=t,this._setShape()}get bounds(){const t=this._shapeRef.getAabb();return{min:t.getMin(),max:t.getMax()}}get collisionGroup(){return this._collisionGroup}get collisionMask(){return this._collisionMask}set collisionGroup(t){this._collisionGroup=t,this._shapeRef.setCollisionGroup(t)}set collisionMask(t){this._collisionMask=t,this._shapeRef.setCollisionMask(t)}toJSON(){return{isTrigger:this._isTrigger,collisionGroup:this._collisionGroup,collisionMask:this._collisionMask,center:this._center.toArray(),rotation:this._rotation.toArray()}}fromJSON(t){return t.center=(new Vector3$1).fromArray(t.center),t.rotation=(new Euler).fromArray(t.rotation),t}}function contactCallback(t,e){const i=t.getContactConstraint(),s=i.getShape1().entity,r=i.getShape2().entity,n=void 0!==s._listeners&&void 0!==s._listeners[e]&&0!==s._listeners[e].length,a=void 0!==r._listeners&&void 0!==r._listeners[e]&&0!==r._listeners[e].length;if(n||a){const o=i.getShape1().collider,h=i.getShape2().collider,c=new Vector3$1,l=new Vector3$1,u=new Vector3$1,p=t.getManifold();p.getBinormalTo(c),p.getNormalTo(l),p.getTangentTo(u);const d=p.getPoints();for(let t=0,e=d.length;t<e;t++){const e=new Vector3$1,i=d[t];i.getPosition1To(e),i.binormalImpulse=i.getBinormalImpulse(),i.depthImpulse=i.getDepth(),i.normalImpulse=i.getNormalImpulse(),i.tangentImpulse=i.getTangentImpulse(),i.point=e}const f={type:e,entity:r,thisCollider:o,otherCollider:h,binormal:c,normal:l,tangent:u,contacts:d};n&&a?(s.dispatchEvent(f),f.entity=s,f.thisCollider=h,f.thisCollider=o,r.dispatchEvent(f)):n?s.dispatchEvent(f):(f.entity=s,f.thisCollider=h,f.thisCollider=o,r.dispatchEvent(f))}}const vector$3=new Vector3$1;class BoxCollider extends Collider{start(t){t.type="box",super.start(t)}_addDerivedProperties(t){this._halfExtents=void 0!==t.halfExtents?t.halfExtents:new Vector(1,1,1)}_setGeometry(t,e){return new OIMO.BoxGeometry(vector$3.copy(this._halfExtents).multiply(t))}toJSON(){const t=super.toJSON();return t.halfExtents=this._halfExtents.toArray(),t}fromJSON(t){return(t=super.fromJSON(t)).halfExtents=(new Vector3$1).fromArray(t.halfExtents),t}}class CapsuleCollider extends Collider{start(t){t.type="capsule",super.start(t)}_addDerivedProperties(t){this._radius=void 0!==t.radius?t.radius:.5,this._halfHeight=void 0!==t.halfHeight?t.halfHeight:1}_setGeometry(t,e){return new OIMO.CapsuleGeometry(this._radius*e,this._halfHeight*e)}toJSON(){const t=super.toJSON();return t.radius=this._radius,t.halfHeight=this._halfHeight,t}}class ConeCollider extends Collider{start(t){t.type="cone",super.start(t)}_addDerivedProperties(t){this._radius=void 0!==t.radius?t.radius:.5,this._halfHeight=void 0!==t.halfHeight?t.halfHeight:1}_setGeometry(t,e){return new OIMO.ConeGeometry(this._radius*e,this._halfHeight*e)}toJSON(){const t=super.toJSON();return t.radius=this._radius,t.halfHeight=this._halfHeight,t}}class CylinderCollider extends Collider{start(t){t.type="cylinder",super.start(t)}_addDerivedProperties(t){this._radius=void 0!==t.radius?t.radius:.5,this._halfHeight=void 0!==t.halfHeight?t.halfHeight:1}_setGeometry(t,e){return new OIMO.CylinderGeometry(this._radius*e,this._halfHeight*e)}toJSON(){const t=super.toJSON();return t.radius=this._radius,t.halfHeight=this._halfHeight,t}}var ConvexHull=function(){var t,e,i,s,r=0,n=new Vector3$1;function a(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new l,this.unassigned=new l,this.vertices=[]}function o(){this.normal=new Vector3$1,this.midpoint=new Vector3$1,this.area=0,this.constant=0,this.outside=null,this.mark=r,this.edge=null}function h(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function c(t){this.point=t,this.prev=null,this.next=null,this.face=null}function l(){this.head=null,this.tail=null}return Object.assign(a.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.ConvexHull: Points parameter is not an array."),t.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.vertices.push(new c(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse(function(t){var i,s,r,n=t.geometry;if(void 0!==n)if(n.isGeometry){var a=n.vertices;for(i=0,s=a.length;i<s;i++)(r=a[i].clone()).applyMatrix4(t.matrixWorld),e.push(r)}else if(n.isBufferGeometry){var o=n.attributes.position;if(void 0!==o)for(i=0,s=o.count;i<s;i++)(r=new Vector3$1).fromBufferAttribute(o,i).applyMatrix4(t.matrixWorld),e.push(r)}}),this.setFromPoints(e)},containsPoint:function(t){for(var e=this.faces,i=0,s=e.length;i<s;i++){if(e[i].distanceToPoint(t)>this.tolerance)return!1}return!0},intersectRay:function(t,e){for(var i=this.faces,s=-1/0,r=1/0,n=0,a=i.length;n<a;n++){var o=i[n],h=o.distanceToPoint(t.origin),c=o.normal.dot(t.direction);if(h>0&&c>=0)return null;var l=0!==c?-h/c:0;if(!(l<=0)&&(c>0?r=Math.min(l,r):s=Math.max(l,s),s>r))return null}return s!==-1/0?t.at(s,e):t.at(r,e),e},intersectsRay:function(t){return null!==this.intersectRay(t,n)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,i=t.outside;null!==i.next&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var i=this.removeAllVerticesFromFace(t);if(void 0!==i)if(void 0===e)this.unassigned.appendChain(i);else{var s=i;do{var r=s.next;e.distanceToPoint(s.point)>this.tolerance?this.addVertexToFace(s,e):this.unassigned.append(s),s=r}while(null!==s)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var i=e.next,s=this.tolerance,n=null,a=0;a<t.length;a++){var o=t[a];if(o.mark===r){var h=o.distanceToPoint(e.point);if(h>s&&(s=h,n=o),s>1e3*this.tolerance)break}}null!==n&&this.addVertexToFace(e,n),e=i}while(null!==e)}return this},computeExtremes:function(){var t,e,i,s=new Vector3$1,r=new Vector3$1,n=[],a=[];for(t=0;t<3;t++)n[t]=a[t]=this.vertices[0];for(s.copy(this.vertices[0].point),r.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var o=this.vertices[t],h=o.point;for(i=0;i<3;i++)h.getComponent(i)<s.getComponent(i)&&(s.setComponent(i,h.getComponent(i)),n[i]=o);for(i=0;i<3;i++)h.getComponent(i)>r.getComponent(i)&&(r.setComponent(i,h.getComponent(i)),a[i]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(s.x),Math.abs(r.x))+Math.max(Math.abs(s.y),Math.abs(r.y))+Math.max(Math.abs(s.z),Math.abs(r.z))),{min:n,max:a}},computeInitialHull:function(){void 0===t&&(t=new Line3,e=new Plane,i=new Vector3$1);var s,r,n,a,h,c,l,u,p,d=this.vertices,f=this.computeExtremes(),m=f.min,g=f.max,y=0,v=0;for(c=0;c<3;c++)(p=g[c].point.getComponent(c)-m[c].point.getComponent(c))>y&&(y=p,v=c);for(r=m[v],n=g[v],y=0,t.set(r.point,n.point),c=0,l=this.vertices.length;c<l;c++)(s=d[c])!==r&&s!==n&&(t.closestPointToPoint(s.point,!0,i),(p=i.distanceToSquared(s.point))>y&&(y=p,a=s));for(y=-1,e.setFromCoplanarPoints(r.point,n.point,a.point),c=0,l=this.vertices.length;c<l;c++)(s=d[c])!==r&&s!==n&&s!==a&&(p=Math.abs(e.distanceToPoint(s.point)))>y&&(y=p,h=s);var b=[];if(e.distanceToPoint(h.point)<0)for(b.push(o.create(r,n,a),o.create(h,n,r),o.create(h,a,n),o.create(h,r,a)),c=0;c<3;c++)u=(c+1)%3,b[c+1].getEdge(2).setTwin(b[0].getEdge(u)),b[c+1].getEdge(1).setTwin(b[u+1].getEdge(0));else for(b.push(o.create(r,a,n),o.create(h,r,n),o.create(h,n,a),o.create(h,a,r)),c=0;c<3;c++)u=(c+1)%3,b[c+1].getEdge(2).setTwin(b[0].getEdge((3-c)%3)),b[c+1].getEdge(0).setTwin(b[u+1].getEdge(1));for(c=0;c<4;c++)this.faces.push(b[c]);for(c=0,l=d.length;c<l;c++)if((s=d[c])!==r&&s!==n&&s!==a&&s!==h){y=this.tolerance;var x=null;for(u=0;u<4;u++)(p=this.faces[u].distanceToPoint(s.point))>y&&(y=p,x=this.faces[u]);null!==x&&this.addVertexToFace(s,x)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var i=this.faces[e];i.mark===r&&t.push(i)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,i=this.assigned.first().face,s=i.outside;do{var r=i.distanceToPoint(s.point);r>e&&(e=r,t=s),s=s.next}while(null!==s&&s.face===i);return t}},computeHorizon:function(t,e,i,s){var n;this.deleteFaceVertices(i),i.mark=1,n=null===e?e=i.getEdge(0):e.next;do{var a=n.twin,o=a.face;o.mark===r&&(o.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,a,o,s):s.push(n)),n=n.next}while(n!==e);return this},addAdjoiningFace:function(t,e){var i=o.create(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var i=null,s=null,r=0;r<e.length;r++){var n=e[r],a=this.addAdjoiningFace(t,n);null===i?i=a:a.next.setTwin(s),this.newFaces.push(a.face),s=a}return i.next.setTwin(s),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(o,{create:function(t,e,i){var s=new o,r=new h(t,s),n=new h(e,s),a=new h(i,s);return r.next=a.prev=n,n.next=r.prev=a,a.next=n.prev=r,s.edge=r,s.compute()}}),Object.assign(o.prototype,{getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){void 0===s&&(s=new Triangle);var t=this.edge.tail(),e=this.edge.head(),i=this.edge.next.head();return s.set(t.point,e.point,i.point),s.getNormal(this.normal),s.getMidpoint(this.midpoint),this.area=s.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(h.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(l.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),a}();const convexHull=new ConvexHull;class MeshCollider extends Collider{start(t){t.type="mesh",super.start(t)}_addDerivedProperties(t){this._mesh=t.mesh,this._points=t.points}_setGeometry(t,e){if(void 0!==this._points||void 0===this._mesh)throw"MeshCollider: points or mesh must be provided";this._points=convexHull.setFromObject(this._mesh).vertices;for(let e=0,i=this._points.length;e<i;e++)this._points[e]=this._points[e].point.multiply(t);return new OIMO.ConvexHullGeometry(this._points)}toJSON(){const t=super.toJSON();for(let t=0,e=this._points.length;t<e;t++)this._points[t]=this._points[t].toArray();return t.points=this._points,t}fromJSON(t){for(let e=0,i=(t=super.fromJSON(t)).points.length;e<i;e++)t.points[e]=(new Vector3).fromArray(t.points[e]);return t}}class SphereCollider extends Collider{start(t){t.type="sphere",super.start(t)}_addDerivedProperties(t){this._radius=void 0!==t.radius?t.radius:.5}_setGeometry(t,e){return new OIMO.SphereGeometry(this._radius*e)}toJSON(){const t=super.toJSON();return t.radius=this._radius,t}}const configs={cylindrical:new OIMO.CylindricalJointConfig,prismatic:new OIMO.PrismaticJointConfig,ragdoll:new OIMO.RagdollJointConfig,hinge:new OIMO.RevoluteJointConfig,ball:new OIMO.SphericalJointConfig,universal:new OIMO.UniversalJointConfig},rigidbodyConfig=new OIMO.RigidBodyConfig;rigidbodyConfig.type=1;const worldBody=new OIMO.RigidBody(rigidbodyConfig);class Joint{start(t){const e=t.type;configs[e].rigidBody1=this.entity._physicsRef,this._bodyRef2=void 0!==t.linkedEntity&&null!==t.linkedEntity?t.linkedEntity._physicsRef:worldBody,this._allowCollision=!0===t.allowCollision,this._breakForce=void 0!==t.breakForce&&0!==t.breakForce?t.breakForce:0,this._breakTorque=void 0!==t.breakTorque&&0!==t.breakTorque?t.breakTorque:0,this._anchor=void 0!==t.anchor?t.anchor:new Vector3$1,this._linkedAnchor=void 0!==t.linkedAnchor?t.linkedAnchor:new Vector3$1,this._addDerivedProperties(t),this._setJoint(),this.addEventListener("enable",this.onEnable),this.addEventListener("disable",this.onDisable),this.entity.addEventListener("scenechange",this.onSceneChange)}onEnable(){this.scene._physicsWorld.addJoint(this._ref)}onDisable(){this.scene._physicsWorld.removeJoint(this._ref)}onSceneChange(t){this._enabled&&(t.oldScene._physicsWorld.removeJoint(this._ref),t.newScene._physicsWorld.addJoint(this._ref))}_setJoint(){let t=!1;const e=this.type,i=configs[e];i.allowCollision=this._allowCollision,i.breakForce=this._breakForce,i.breakTorque=this._breakTorque,i.localAnchor1=this._anchor,i.localAnchor2=this._linkedAnchor,i.rigidBody2=this._bodyRef2,void 0!==this._ref&&this._enabled&&(this.scene._physicsWorld.removeJoint(this._ref),t=!0),this._setDerivedJoint(i),this._ref.component=this,t&&this.scene._physicsWorld.addJoint(this._ref)}get allowCollision(){return this._allowCollision}set allowCollision(t){this._allowCollision=t,this._ref.setAllowCollision(t)}get anchor(){return this._anchor}set anchor(t){this._anchor=t,this._setJoint()}get linkedAnchor(){return this._linkedAnchor}set linkedAnchor(t){this._linkedAnchor=t,this._setJoint()}get appliedForce(){const t=new Vector3$1;return this._ref.getAppliedForceTo(t),t}get appliedTorque(){const t=new Vector3$1;return this._ref.getAppliedTorqueTo(t),t}get breakForce(){this._breakForce}set breakForce(t){this._breakForce=t,this._ref.setBreakForce(t)}get breakTorque(){this._ref.getBreakTorque()}set breakTorque(t){this._ref.setBreakTorque(t)}get linkedEntity(){const t=this._bodyRef2;return t===worldBody?null:t.entity}set linkedEntity(t){this._bodyRef2=null===t?worldBody:t._physicsRef,this._setJoint()}get axis(){return this._axis}set axis(t){this._axis=t,this._setJoint()}get linkedAxis(){return this._linkedAxis}set linkedAxis(t){this._linkedAxis=t,this._setJoint()}get swingAxis(){return this._swingAxis}set swingAxis(t){this._swingAxis=t,this._setJoint()}get twistAxis(){return this._twistAxis}set twistAxis(t){this._twistAxis=t,this._setJoint()}get linkedTwistAxis(){return this._linkedTwistAxis}set linkedTwistAxis(t){this._linkedTwistAxis=t,this._setJoint()}get maxSwing(){return this._maxSwing}set maxSwing(t){this._maxSwing=t,this._setJoint()}get linkedMaxSwing(){return this._linkedMaxSwing}set linkedMaxSwing(t){this._linkedMaxSwing=t,this._setJoint()}get angle(){return"universal"===this.type?this._ref.getAngle1():this._ref.getAngle()}get linkedAngle(){return this._ref.getAngle2()}toJSON(){return{linkedEntity:this._bodyRef2.UUID,breakForce:this._breakForce,breakTorque:this._breakTorque,anchor:this._anchor.toArray(),linkedAnchor:this._linkedAnchor.toArray()}}fromJSON(t){return t.linkedEntity=this.scene.findById(t.linkedEntity),t.anchor=(new Vector3$1).fromArray(t.anchor),t.linkedAnchor=(new Vector3$1).fromArray(t.linkedAnchor),t}}class SpringDamper{constructor(t=0,e=0){this.frequency=t,this.dampingRatio=e}get useSymplecticEuler(){return!1}set(t=0,e=0){this.frequency=t,this.dampingRatio=e}clone(){return this}}class BallJoint extends Joint{constructor(t){t.type="ball",super.start(t)}_addDerivedProperties(t){this.springDamper=void 0!==t.springDamper?t.springDamper:new SpringDamper}_setDerivedJoint(t){t.springDamper=this.springDamper,this._ref=new OIMO.SphericalJoint(t)}toJSON(){const t=super.toJSON();return t.springDamper=this.springDamper,t}fromJSON(t){return(t=super.fromJSON(t)).springDamper=Object.create(SpringDamper,t.springDamper),t}}class AngularLimit{constructor(t=1,e=0,i,s=0){this.lowerLimit=t,this.upperLimit=e,this.motorSpeed=i,this.motorTorque=s}set(t=1,e=0,i,s=0){this.lowerLimit=t,this.upperLimit=e,this.motorSpeed=i,this.motorTorque=s}clone(){return this}}class LinearLimit{constructor(t=0,e=0,i,s=0){this.lowerLimit=t,this.upperLimit=e,this.motorSpeed=i,this.motorForce=s}set(t=0,e=0,i,s=0){this.lowerLimit=t,this.upperLimit=e,this.motorSpeed=i,this.motorForce=s}clone(){return this}}class CylindricalJoint extends Joint{constructor(t){t.type="cylindrical",super.start(t)}_addDerivedProperties(t){this._axis=void 0!==t.axis?t.axis:new Vector3$1(1,0,0),this._linkedAxis=void 0!==t.linkedAxis?t.linkedAxis:new Vector3$1(1,0,0),this.linearLimit=void 0!==t.linearLimit?t.linearLimit:new LinearLimit,this.linearSpringDamper=void 0!==t.linearSpringDamper?t.linearSpringDamper:new SpringDamper,this.angularLimit=void 0!==t.angularLimit?t.angularLimit:new AngularLimit,this.angularSpringDamper=void 0!==t.angularSpringDamper?t.angularSpringDamper:new SpringDamper}_setDerivedJoint(t){t.localAxis1=this._axis,t.localAxis2=this._linkedAxis,t.translationalLimitMotor=this.linearLimit,t.translationalSpringDamper=this.linearSpringDamper,t.rotationalLimitMotor=this.angularLimit,t.rotationalSpringDamper=this.angularSpringDamper,this._ref=new OIMO.CylindricalJoint(t)}toJSON(){const t=super.toJSON();return t.axis=this._axis.toArray(),t.linkedAxis=this._linkedAxis.toArray(),t.linearLimit=this.linearLimit,t.linearSpringDamper=this.linearSpringDamper,t.angularLimit=this.angularLimit,t.angularSpringDamper=this.angularSpringDamper,t}fromJSON(t){return(t=super.fromJSON(t)).axis=(new Vector3$1).fromArray(t.axis),t.linkedAxis=(new Vector3$1).fromArray(t.linkedAxis),t.linearLimit=Object.create(LinearLimit,t.linearLimit),t.linearSpringDamper=Object.create(SpringDamper,t.linearSpringDamper),t.angularLimit=Object.create(AngularLimit,t.angularLimit),t.angularSpringDamper=Object.create(SpringDamper,t.angularSpringDamper),t}}class PrismaticJoint extends Joint{start(t){t.type="prismatic",super.start(t)}_addDerivedProperties(t){this._axis=void 0!==t.axis?t.axis:new Vector3$1(1,0,0),this._linkedAxis=void 0!==t.linkedAxis?t.linkedAxis:new Vector3$1(1,0,0),this.springDamper=void 0!==t.springDamper?t.springDamper:new SpringDamper,this.linearLimit=void 0!==t.linearLimit?t.linearLimit:new LinearLimit}_setDerivedJoint(t){t.localAxis1=this._axis,t.localAxis2=this._linkedAxis,t.springDamper=this.springDamper,t.limitMotor=this.linearLimit,this._ref=new OIMO.PrismaticJoint(t)}toJSON(){const t=super.toJSON();return t.axis=this._axis.toArray(),t.linkedAxis=this._linkedAxis.toArray(),t.springDamper=this.springDamper,t.linearLimit=this.linearLimit,t}fromJSON(t){return(t=super.fromJSON(t)).axis=(new Vector3$1).fromArray(t.axis),t.linkedAxis=(new Vector3$1).fromArray(t.linkedAxis),t.springDamper=Object.create(SpringDamper,t.springDamper),t.linearLimit=Object.create(LinearLimit,t.linearLimit),t}}class RagdollJoint extends Joint{start(t){t.type="ragdoll",super.start(t)}_addDerivedProperties(t){this._twistAxis=void 0!==t.twistAxis?t.twistAxis:new Vector3$1(1,0,0),this._linkedTwistAxis=void 0!==t.linkedTwistAxis?t.linkedTwistAxis:new Vector3$1(1,0,0),this._swingAxis=void 0!==t.swingAxis?t.swingAxis:new Vector3$1(0,1,0),this._maxSwing=void 0!==t.maxSwing?t.maxSwing:Math.PI,this._linkedMaxSwing=void 0!==t.linkedMaxSwing?t.linkedMaxSwing:Math.PI,this.twistSpringDamper=void 0!==t.twistSpringDamper?t.twistSpringDamper:new SpringDamper,this.swingSpringDamper=void 0!==t.swingSpringDamper?t.swingSpringDamper:new SpringDamper,this.twistLimit=void 0!==t.twistLimit?t.twistLimit:new AngularLimit}_setDerivedJoint(t){t.localTwistAxis1=this._twistAxis,t.localTwistAxis2=this._linkedTwistAxis,t.localSwingAxis1=this._swingAxis,t.maxSwingAngle1=this._maxSwing,t.maxSwingAngle2=this._linkedMaxSwing,t.twistSpringDamper=this.twistSpringDamper,t.swingSpringDamper=this.swingSpringDamper,t.twistLimitMotor=this.twistLimit,this._ref=new OIMO.RagdollJoint(t)}toJSON(){const t=super.toJSON();return t.twistAxis=this._twistAxis.toArray(),t.linkedTwistAxis=this._linkedTwistAxis.toArray(),t.swingAxis=this._swingAxis.toArray(),t.maxSwing=this._maxSwing,t.linkedMaxSwing=this._linkedMaxSwing,t.twistSpringDamper=this.twistSpringDamper,t.swingSpringDamper=this.swingSpringDamper,t.twistLimit=this.twistLimit,t}fromJSON(t){return(t=super.fromJSON(t)).twistAxis=(new Vector3$1).fromArray(t.twistAxis),t.linkedTwistAxis=(new Vector3$1).fromArray(t.linkedTwistAxis),t.swingAxis=(new Vector3$1).fromArray(t.swingAxis),t.twistSpringDamper=Object.create(SpringDamper,t.twistSpringDamper),t.swingSpringDamper=Object.create(SpringDamper,t.swingSpringDamper),t.twistLimit=Object.create(AngularLimit,t.twistLimit),t}}class HingeJoint extends Joint{start(t){start.type="hinge",super.start(t)}_addDerivedProperties(t){this._axis=void 0!==t.axis?t.axis:new Vector3$1(1,0,0),this._linkedAxis=void 0!==t.linkedAxis?t.linkedAxis:new Vector3$1(1,0,0),this.springDamper=void 0!==t.springDamper?t.springDamper:new SpringDamper,this.angularLimit=void 0!==t.angularLimit?t.angularLimit:new AngularLimit}_setDerivedJoint(t){t.localAxis1=this._axis,t.localAxis2=this._linkedAxis,t.springDamper=this.springDamper,t.limitMotor=this.angularLimit,this._ref=new OIMO.RevoluteJoint(t)}toJSON(){const t=super.toJSON();return t.axis=this._axis.toArray(),t.linkedAxis=this._linkedAxis.toArray(),t.springDamper=this.springDamper,t.angularLimit=this.angularLimit,t}fromJSON(t){return(t=super.fromJSON(t)).axis=(new Vector3$1).fromArray(t.axis),t.linkedAxis=(new Vector3$1).fromArray(t.linkedAxis),t.springDamper=Object.create(SpringDamper,t.springDamper),t.angularLimit=Object.create(AngularLimit,t.angularLimit),t}}class UniversalJoint extends Joint{start(t){t.type="universal",super.start(t)}_addDerivedProperties(t){this._axis=void 0!==t.axis?t.axis:new Vector3$1(1,0,0),this._linkedAxis=void 0!==t.linkedAxis?t.linkedAxis:new Vector3$1(1,0,0),this.springDamper=void 0!==t.springDamper?t.springDamper:new SpringDamper,this.linkedSpringDamper=void 0!==t.linkedSpringDamper?t.linkedSpringDamper:new SpringDamper,this.angularLimit=void 0!==t.angularLimit?t.angularLimit:new AngularLimit,this.linkedAngularLimit=void 0!==t.linkedAngularLimit?t.linkedAngularLimit:new AngularLimit}_setDerivedJoint(t){t.localAxis1=this._axis,t.localAxis2=this._linkedAxis,t.springDamper1=this.springDamper,t.springDamper2=this.linkedSpringDamper,t.limitMotor1=this.angularLimit,t.limitMotor2=this.linkedAngularLimit,this._ref=new OIMO.UniversalJoint(t)}toJSON(){const t=super.toJSON();return t.axis=(new Vector3$1).fromArray(t.axis),t.linkedAxis=(new Vector3$1).fromArray(t.linkedAxis),t.springDamper=this.springDamper,t.linkedSpringDamper=this.linkedSpringDamper,t.angularLimit=this.angularLimit,t.linkedAngularLimit=this.linkedAngularLimit,t}fromJSON(t){return(t=super.fromJSON(t)).axis=(new Vector3$1).fromArray(t.axis),t.linkedAxis=(new Vector3$1).fromArray(t.linkedAxis),t.springDamper=Object.create(SpringDamper,t.springDamper),t.linkedSpringDamper=Object.create(SpringDamper,t.linkedSpringDamper),t.angularLimit=Object.create(AngularLimit,t.angularLimit),t.linkedAngularLimit=Object.create(AngularLimit,t.linkedAngularLimit),t}}const ComponentManager={_components:{},add(t,e,i={}){if(t in this._components)throw"component "+t+" already exists";this.properties.componentType.value=t,Object.defineProperties(e.prototype,this.properties),Object.assign(e.prototype,EventDispatcher.prototype),this._components[t]={constructor:e,options:i}},remove(t){t in this._components?delete this._components[t]:console.warn("component "+t+" does not exists")},get(t){return this._components[t]},properties:{componentType:{value:null},_enabled:{value:!0,writable:!0},enabled:{get(){return this._enabled},set(t){if(t!=this._enabled){if(t&&!this.entity._enabled)return console.warn("Component: Can't enable if the entity is disabled");this._enabled=t;const e=this.entity.scene._containers[this.componentType];t?(e.push(this),this.dispatchEvent({type:"enable"})):(e.splice(e.indexOf(this),1),this.dispatchEvent({type:"disable"}))}}},scene:{get(){return this.entity.scene}},app:{get(){return this.entity.scene.app}}}};ComponentManager.add("Renderable",Renderable),ComponentManager.add("OrthographicCamera",OrthographicCamera$1),ComponentManager.add("PerspectiveCamera",PerspectiveCamera$1),ComponentManager.add("Rigidbody",Rigidbody),ComponentManager.add("BoxCollider",BoxCollider),ComponentManager.add("CapsuleCollider",CapsuleCollider),ComponentManager.add("ConeCollider",ConeCollider),ComponentManager.add("CylinderCollider",CylinderCollider),ComponentManager.add("MeshCollider",MeshCollider),ComponentManager.add("SphereCollider",SphereCollider),ComponentManager.add("BallJoint",BallJoint,{requiredComponents:["Rigidbody"]}),ComponentManager.add("CylindricalJoint",CylindricalJoint,{requiredComponents:["Rigidbody"]}),ComponentManager.add("PrismaticJoint",PrismaticJoint,{requiredComponents:["Rigidbody"]}),ComponentManager.add("RagdollJoint",RagdollJoint,{requiredComponents:["Rigidbody"]}),ComponentManager.add("HingeJoint",HingeJoint,{requiredComponents:["Rigidbody"]}),ComponentManager.add("UniversalJoint",UniversalJoint,{requiredComponents:["Rigidbody"]});class Scene$1 extends Scene{constructor(){super(),this._cameras=[],this._containers={};for(const t in ComponentManager._components)this._containers[t]=[];this._physicsWorld=new OIMO.World(2)}_addComponents(t){for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i._enabled){const t=i.componentType,e=this._containers[t];e.splice(e.indexOf(i),1),void 0===this._containers[t]&&(this._containers[t]=[]),this._containers[t].push(i)}}}add(t){return t.scene!==this&&(this._addComponents(t.components),t.dispatchEvent({type:"scenechange",oldScene:t.scene,newScene:this})),t.scene=this,t.dispatchEvent({type:"sceneadd"}),super.add(t)}remove(t){return t._detach(),t.dispatchEvent({type:"sceneremove"}),super.remove(t)}find(t){return this.getObjectByName(t)}findByTag(t){const e=[];return this.traverse(i=>{i instanceof Entity&&i.tags.includes(t)&&e.push(i)}),e}findById(t){return this.getObjectById(t)}findByProperty(t,e){return this.getObjectByProperty(t,e)}}class Renderer extends WebGLRenderer{constructor(t){super(t),this.setPixelRatio(window.devicePixelRatio),this._onResize(),new ResizeObserver(()=>this._onResize()).observe(this.domElement)}_onResize(){const t=this.domElement;if(this.setSize(t.clientWidth,t.clientHeight,!1),"cameras"in this)for(let e=0,i=this.cameras.length;e<i;e++){this.cameras[e]._updateRegion(t)}}_update(){for(let t=0,e=this.cameras.length;t<e;t++){const e=this.cameras[t];this.setViewport(e._region),this.setScissor(e._region),this.setScissorTest(!0),this.render(this.scene,e)}}}class Time{constructor(t){this.fixedTimestep=void 0!==t.fixedTimestep?t.fixedTimestep:.02,this.maxDeltaTime=void 0!==t.maxDeltaTime?t.maxDeltaTime:.1,this.timeScale=void 0!==t.timeScale?t.timeScale:1,this.deltaTime=0,this.lastTimestamp=!1}_update(t){this.deltaTime=(t-(this.lastTimestamp||t))*this.timeScale;const e=this.maxDeltaTime*this.timeScale;return this.deltaTime>e&&(this.deltaTime=e),this.lastTimestamp=t,this.deltaTime}}class Input{constructor(){this.mousePosition=new Vector2,this.mouseDelta=new Vector2,this.wheelDelta=new Vector2,this._mouse=[],this._mouseDown=[],this._mouseUp=[],this._key={},this._keyDown={},this._keyUp={},window.addEventListener("blur",()=>{this._reset()}),document.addEventListener("fullscreenchange",()=>{console.log("here"),this._reset()}),document.addEventListener("mousemove",t=>{this.mouseDelta.set(t.movementX,t.movementY),this.mousePosition.set(t.clientX,t.clientY)}),document.addEventListener("mousedown",t=>{this._mouse[t.button]=!0,this._mouseDown[t.button]=!0}),document.addEventListener("mouseup",t=>{this._mouse[t.button]=!1,this._mouseUp[t.button]=!0}),document.addEventListener("wheel",t=>{this.wheelDelta.set(t.deltaX,t.deltaY)}),document.addEventListener("keydown",()=>{this._key[event.code]=!0,event.repeat||(this._keyDown[event.code]=!0)}),document.addEventListener("keyup",()=>{this._key[event.code]=!1,this._keyUp[event.code]=!0})}_reset(){for(const t in this._keyDown)delete this._keyDown[t];for(const t in this._keyUp)delete this._keyUp[t];this._mouseDown.length=0,this._mouseUp.length=0,this.mouseDelta.set(0,0),this.wheelDelta.set(0,0)}getKey(t){return Boolean(this._key[t])}getKeyDown(t){return t in this._keyDown}getKeyUp(t){return t in this._keyUp}getMouse(t){return Boolean(this._mouse[t])}getMouseDown(t){return Boolean(this._mouseDown[t])}getMouseUp(t){return Boolean(this._mouseUp[t])}}class Application{constructor(t={}){"string"==typeof t.canvas&&(t.canvas=document.getElementById(t.canvas)),this.parameters=t,this.renderer=new Renderer(t),this.time=new Time(t),this.physics=new Physics(t),this.input=new Input,this.autoUpdate=void 0===t.autoUpdate||t.autoUpdate,this.scenes=[],this._currentScene,this.requestID,"undefined"===t.canvas&&document.body.appendChild(this.renderer.domElement),Application.currentApp=this}update(t=0){const e=this.time._update(t);this.physics._update(e,this.time.fixedTimestep*this.time.timeScale);for(const t in this._containers){const i=this._containers[t];if(i[0]&&void 0!==i[0].update)for(let t=0,s=i.length;t<s;t++)i[t].update(e)}this.renderer._update(),this.input._reset(),this.autoUpdate&&window.requestAnimationFrame(t=>this.update(t/1e3))}addScene(t){return t.app=this,this.scenes.push(t),t}removeScene(t){const e=this.scenes.indexOf(t);-1!==e&&(this.scenes.splice(e,1),delete t.app)}setScene(t){return-1===this.scenes.indexOf(t)&&this.addScene(t),this.renderer.scene=this._currentScene=t,this._containers=t._containers,this.physics._updateScene(t),this.renderer.cameras=t._cameras,t}findScene(t){for(let e=0,i=this.scenes.length;e<i;e++)if(this.scenes[e].name===t)return this.scenes[e]}findSceneById(t){return this.findSceneByProperty("id",t)}findSceneByProperty(t,e){for(let i=0,s=this.scenes.length;i<s;i++)if(this.scenes[i][t]===e)return this.scenes[i]}get currentScene(){return this._currentScene}static getApplication(t){return Application._apps[t]}toJSON(){const t={metadata:{type:"App",generator:"Application.toJSON"},scenes:[],currentScene:this.currentScene.uuid,parameters:Object.assign({},this.parameters)};for(let e=0,i=this.scenes.length;e<i;e++)t.scenes[e]=this.scenes[e].toJSON();return void 0!==t.parameters.canvas.id&&(t.parameters.canvas=t.parameters.canvas.id),t}}Application.apps={};class Entity extends Group{constructor(t,e){super(),this.components=[],this.queue=[],this.tags=[],this._enabled=!0,void 0!==t&&(t instanceof Scene$1?t.add(this):this.name=t),e instanceof Scene$1?e.add(this):void 0!==Application.currentApp&&void 0!==Application.currentApp.currentScene&&Application.currentApp.currentScene.add(this),this.addEventListener("sceneadd",this._emptyQueue)}_emptyQueue(){for(;this.queue.length>0;){const t=this.queue[0];this._activateComponent(t.type,t.component,t.data),this.queue.shift()}}_activateComponent(t,e,i){void 0===this.scene._containers[t]&&(this.scene._containers[t]=[]),this.scene._containers[t].push(e),void 0!==e.start&&e.start(i),e.dispatchEvent({type:"enable"})}getComponent(t){const e=this.components;for(let i=0,s=e.length;i<s;i++)if(e[i].componentType===t)return e[i]}getComponents(t){const e=[],i=this.components;for(let s=0,r=i.length;s<r;s++)i[s].componentType===t&&e.push(i[s]);return e}addComponent(t,e={}){const i=ComponentManager._components[t],s=i.options;if(!1===s.allowMultiple&&void 0!==this.getComponent(t))return console.warn("TARO.Entity: allowMultiple Attribute is false");if(void 0!==s.requireComponents){const t=s.requireComponents;for(let e=0,i=t.length;e<i;e++)void 0===this.getComponent(t[e])&&this.addComponent(t[e])}const r=new i.constructor;return Object.defineProperty(r,"entity",{value:this}),this.components.push(r),void 0!==this.scene?this._activateComponent(t,r,e):this.queue.push({type:t,component:r,data:e}),"Renderable"===t?r.ref:r}removeComponent(t){if(t.enabled){const e=t.componentType,i=this.scene._containers[e];i.splice(i.indexOf(t),1)}const e=this.entity.components;e.splice(e.indexOf(t),1),this.dispatchEvent({type:"disable"}),this.dispatchEvent({type:"remove"})}add(t){return t instanceof Entity&&t.scene!==this.scene&&(this.scene._addComponents(t.components),entity.scene=this),super.add(t)}remove(t){return-1!==this.children.indexOf(t)&&(t instanceof Entity&&t._detach(),super.remove(t)),this}_detach(){this.enabled=!1;const t=this.getChildren();for(let e=0,i=t.length;e<i;e++)t[e].enabled=!1;delete this.scene}get enabled(){return this._enabled}set enabled(t){if(t!=this._enabled){if(t&&!this.parent._enabled)return console.warn("TARO.Entity: Can't enable if an ancestor is disabled");this._enabled=t;const e=this.components;for(let i=0,s=e.length;i<s;i++)e[i].enabled=t;const i=this.getChildren();for(let e=0,s=i.length;e<s;e++)i[e].enabled=t;this.dispatchEvent({type:t?"enable":"disable"})}}getChildren(){const t=[],e=this.children;for(let i=0,s=e.length;i<s;i++)e[i]instanceof Entity&&t.push(e[i]);return t}find(t){return this.getObjectByName(t)}findByTag(t){const e=[];return this.traverse(i=>{i instanceof Entity&&i.tags.includes(t)&&e.push(i)}),e}findById(t){return this.getObjectById(t)}findByProperty(t,e){return this.getObjectByProperty(t,e)}get app(){return this.scene.app}toJSON(t){const e=super.toJSON(t),i=e.object,s=i.children;for(let t=0,e=s.length;t<e;t++)void 0===s[t].isEntity&&(s[t].component=!0);if(i.isEntity=!0,0!==this.tags.length&&(i.tags=this.tags),i.enabled=this._enabled,0!==this.components.length){i.components=[];for(let t=0,e=this.components.length;t<e;t++){const e=this.components[t];if(e.isObject3D||void 0!==e.ref&&e.ref.isObject3D)continue;const s={type:e.componentType,data:{}};void 0!==e.toJSON?s.data=e.toJSON():(s.data=Object.assign({},e),delete s.data._listeners),s.enabled=e._enabled,i.components.push(s)}this.components}return e}}class PhysicMaterial{constructor(t,e){this._friction=t,this._restitution=e,this._colliders=[]}get friction(){return this._friction}get restitution(){return this._restitution}set friction(t){this._friction=t;for(let e=0,i=this._colliders.length;e<i;e++)this._colliders[e].setFriction(t)}set restitution(t){this._restitution=t;for(let e=0,i=this._colliders.length;e<i;e++)this._colliders[e].setRestitution(t)}}class AppLoader extends ObjectLoader{constructor(t){super(t),this._entity}parse(t,e){const i=this._app=new Application(t.parameters),s=t.scenes;for(let e=0,r=s.length;e<r;e++){const r=super.parse(s[e]);r.uuid===t.currentScene&&i.setScene(r)}return void 0!==e&&e(i),i}parseObject(t,e,i,s){let r,n,a;function o(t){return void 0===e[t]&&console.warn("TARO.AppLoader: Undefined geometry",t),e[t]}function h(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let s=0,r=t.length;s<r;s++){const r=t[s];void 0===i[r]&&console.warn("TARO.AppLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("TARO.AppLoader: Undefined material",t),i[t]}}switch(t.type){case"Scene":r=new Scene$1,this._app.addScene(r),void 0!==t.background&&Number.isInteger(t.background)&&(r.background=new Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":!0===t.component?(console.log(t),ComponentManager._components.PerspectiveCamera.constructor.prototype.fromJSON(t),r=this._entity.addComponent("PerspectiveCamera",t)):r=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":!0===t.component?(ComponentManager._components.OrthographicCamera.constructor.prototype.fromJSON(t),r=this._entity.addComponent("OrthographicCamera",t)):r=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":r=new DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":r=(new LightProbe).fromJSON(t);break;case"SkinnedMesh":r=new SkinnedMesh(n=o(t.geometry),a=h(t.material)),void 0!==t.bindMode&&(r.bindMode=t.bindMode),void 0!==t.bindMatrix&&r.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(r.skeleton=t.skeleton);break;case"Mesh":r=new Mesh(n=o(t.geometry),a=h(t.material));break;case"InstancedMesh":n=o(t.geometry),a=h(t.material);const e=t.count,i=t.instanceMatrix;(r=new InstancedMesh(n,a,e)).instanceMatrix=new BufferAttribute(new Float32Array(i.array),16);break;case"LOD":r=new LOD;break;case"Line":r=new Line(o(t.geometry),h(t.material));break;case"LineLoop":r=new LineLoop(o(t.geometry),h(t.material));break;case"LineSegments":r=new LineSegments(o(t.geometry),h(t.material));break;case"PointCloud":case"Points":r=new Points(o(t.geometry),h(t.material));break;case"Sprite":r=new Sprite(h(t.material));break;case"Group":if(!0===t.isEntity){this._entity=r=new Entity,void 0!==t.tags&&(r.tags=t.tags),r.enabled=t.enabled;const e=t.components;for(let t=0,i=e.length;t<i;t++){let i=e[t].data;const s=e[t].type,n=ComponentManager._components[s].constructor;void 0!==n.prototype.fromJSON&&n.prototype.fromJSON(i),r.addComponent(s,i)}}else r=new Group;break;case"Bone":r=new Bone;break;default:r=new Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(r.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.layers&&(r.layers.mask=t.layers),void 0!==t.children){const n=t.children;for(let t=0;t<n.length;t++){const a=this.parseObject(n[t],e,i,s);void 0===n[t].component?r.add(a):void 0===a.isCamera&&r.addComponent("Renderable",a)}}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];r.animations.push(s[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(r.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],s=r.getObjectByProperty("uuid",i.object);void 0!==s&&r.addLevel(s,i.distance)}}return r}}export{ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AlphaFormat,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AmbientLightProbe,AngularLimit,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,AppLoader,Application,ArcCurve,ArrayCamera,ArrowHelper,Audio,AudioAnalyser,AudioContext,AudioListener,AudioLoader,AxesHelper,AxisHelper,BackSide,BasicDepthPacking,BasicShadowMap,BinaryTextureLoader,Bone,BooleanKeyframeTrack,BoundingBoxHelper,Box2,Box3,Box3Helper,BoxBufferGeometry,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasRenderer,CanvasTexture,CatmullRomCurve3,CineonToneMapping,CircleBufferGeometry,CircleGeometry,ClampToEdgeWrapping,Clock,ClosedSplineCurve3,Color,ColorKeyframeTrack,ComponentManager,CompressedTexture,CompressedTextureLoader,ConeBufferGeometry,ConeGeometry,CubeCamera,BoxGeometry as CubeGeometry,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubeUVRefractionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderBufferGeometry,CylinderGeometry,Cylindrical,DataTexture,DataTexture2DArray,DataTexture3D,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DodecahedronBufferGeometry,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicBufferAttribute,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EdgesHelper,EllipseCurve,Entity,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher,ExtrudeBufferGeometry,ExtrudeGeometry,Face3,Face4,FaceColors,FileLoader,FlatShading,Float16BufferAttribute,Float32Attribute,Float32BufferAttribute,Float64Attribute,Float64BufferAttribute,FloatType,Fog,FogExp2,Font,FontLoader,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GammaEncoding,Geometry,GeometryUtils,GreaterDepth,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,HemisphereLightProbe,IcosahedronBufferGeometry,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,ImmediateRenderObject,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16Attribute,Int16BufferAttribute,Int32Attribute,Int32BufferAttribute,Int8Attribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,JSONLoader,KeepStencilOp,KeyframeTrack,LOD,LatheBufferGeometry,LatheGeometry,Layers,LensFlare,LessDepth,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LinePieces,LineSegments,LineStrip,LinearEncoding,LinearFilter,LinearInterpolant,LinearLimit,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearToneMapping,Loader,LoaderUtils,LoadingManager,LogLuvEncoding,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils as Math,MathUtils,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshFaceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiMaterial,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeverDepth,NeverStencilFunc,NoBlending,NoColors,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronBufferGeometry,OctahedronGeometry,OneFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,ParametricBufferGeometry,ParametricGeometry,Particle,ParticleBasicMaterial,ParticleSystem,ParticleSystemMaterial,Path,PerspectiveCamera,PhysicMaterial,Plane,PlaneBufferGeometry,PlaneGeometry,PlaneHelper,PointCloud,PointCloudMaterial,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronBufferGeometry,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion,QuaternionKeyframeTrack,QuaternionLinearInterpolant,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGBDEncoding,RGBEEncoding,RGBEFormat,RGBFormat,RGBIntegerFormat,RGBM16Encoding,RGBM7Encoding,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray,Raycaster,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingBufferGeometry,RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format,SRGB8_ALPHA8_ASTC_10x5_Format,SRGB8_ALPHA8_ASTC_10x6_Format,SRGB8_ALPHA8_ASTC_10x8_Format,SRGB8_ALPHA8_ASTC_12x10_Format,SRGB8_ALPHA8_ASTC_12x12_Format,SRGB8_ALPHA8_ASTC_4x4_Format,SRGB8_ALPHA8_ASTC_5x4_Format,SRGB8_ALPHA8_ASTC_5x5_Format,SRGB8_ALPHA8_ASTC_6x5_Format,SRGB8_ALPHA8_ASTC_6x6_Format,SRGB8_ALPHA8_ASTC_8x5_Format,SRGB8_ALPHA8_ASTC_8x6_Format,SRGB8_ALPHA8_ASTC_8x8_Format,Scene$1 as Scene,SceneUtils,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape,ShapeBufferGeometry,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper,SkinnedMesh,SmoothShading,Sphere,SphereBufferGeometry,SphereGeometry,Spherical,SphericalHarmonics3,Spline,SplineCurve,SplineCurve3,SpotLight,SpotLightHelper,SpringDamper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronBufferGeometry,TetrahedronGeometry,TextBufferGeometry,TextGeometry,Texture,TextureLoader,TorusBufferGeometry,TorusGeometry,TorusKnotBufferGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeBufferGeometry,TubeGeometry,UVMapping,Uint16Attribute,Uint16BufferAttribute,Uint32Attribute,Uint32BufferAttribute,Uint8Attribute,Uint8BufferAttribute,Uint8ClampedAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShort565Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3$1 as Vector3,Vector4,VectorKeyframeTrack,Vertex,VertexColors,VideoTexture,WebGL1Renderer,WebGLCubeRenderTarget,WebGLMultisampleRenderTarget,WebGLRenderTarget,WebGLRenderTargetCube,WebGLRenderer,WebGLUtils,WireframeGeometry,WireframeHelper,WrapAroundEnding,XHRLoader,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,sRGBEncoding};