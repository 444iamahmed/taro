<!DOCTYPE html>
<html lang='en'>
	<head>
		<meta charset='UTF-8' />
		<meta name='viewport' content='width=device-width,initial-scale=1' />
		<title>Gravity</title>
		<style>
			html,
			body {
				margin: 0;
				height: 100%;
			}

			#canvas {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<canvas id='canvas'></canvas>
		<script type='module'>
			import * as TARO from '../build/taro.module.js';
			import { OrbitControls } from './js/OrbitControls.js';

			// app setup
			let entity, geo, mat, mesh;

			const app = new TARO.App({
				canvas: document.getElementById('canvas'),
				antialias: true
			});
			const scene = new TARO.Scene();
			app.setScene(scene);
			scene.background = new TARO.Color( 0xe0e0e0 );
			app.physics.gravity.y = 0;

			TARO.registerComponent('orbit', class {
			
				init() {
					// from cannon-es/callbacks.html
					this.moon_to_planet = new TARO.Vector3();
					this.moon = this.entity.getComponent('rigidbody').ref;
				}
				
				fixedUpdate() {
					this.moon.position.negate(this.moon_to_planet);

					const distance = this.moon_to_planet.length();

					this.moon_to_planet.normalize();
					this.moon.force.copy(this.moon_to_planet).scale(1500 / Math.pow(distance, 2), this.moon.force);
				}

			});
			
			// camera
			entity = new TARO.Entity('camera');
			const camera = entity.addComponent('camera').ref;
			camera.position.set(5, 5, 5);
			const controls = new OrbitControls( camera, app.renderer.domElement );
			controls.maxPolarAngle = Math.PI * 0.5;
      
		        // planet
		        entity = new TARO.Entity('planet');
		        entity.addComponent('rigidbody', {mass: 0});
		        entity.addComponent('geometry', {type: 'sphere'});
		        entity.addComponent('material', {color: 'red'});
					    
		        // moon
		        entity = new TARO.Entity('moon');
		        entity.addComponent('rigidbody', {mass: 5, velocity: new TARO.Vector3(0, 8, 0), linearDamping: 0.0});
			entity.addComponent('orbit');
		        entity.addComponent('geometry', {type: 'sphere'});
		        entity.addComponent('material', {color: 'blue'});
		        entity.position.set(-4, 0, 0);
			entity.scale.set(0.2, 0.2, 0.2);

			// start the app
			app.start();

		</script>
	</body>
</html>
